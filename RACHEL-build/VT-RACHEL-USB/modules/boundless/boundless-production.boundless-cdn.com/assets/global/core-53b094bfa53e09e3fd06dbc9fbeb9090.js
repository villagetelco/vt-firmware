/**
 * Diff Match and Patch
 *
 * Copyright 2006 Google Inc.
 * http://code.google.com/p/google-diff-match-patch/
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *   http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
function diff_match_patch(){this.Diff_Timeout=1,this.Diff_EditCost=4,this.Match_Threshold=.5,this.Match_Distance=1e3,this.Patch_DeleteThreshold=.5,this.Patch_Margin=4,this.Match_MaxBits=32}var JSON;/*!
 * Bootstrap v3.3.5 (http://getbootstrap.com)
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under the MIT license
 */
if(JSON||(JSON={}),function(){"use strict";function f(n){return 10>n?"0"+n:n}function quote(string){return escapable.lastIndex=0,escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return"string"==typeof c?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,partial,mind=gap,value=holder[key];switch(value&&"object"==typeof value&&"function"==typeof value.toJSON&&(value=value.toJSON(key)),"function"==typeof rep&&(value=rep.call(holder,key,value)),typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value)return"null";if(gap+=indent,partial=[],"[object Array]"===Object.prototype.toString.apply(value)){for(length=value.length,i=0;length>i;i+=1)partial[i]=str(i,value)||"null";return v=0===partial.length?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]",gap=mind,v}if(rep&&"object"==typeof rep)for(length=rep.length,i=0;length>i;i+=1)"string"==typeof rep[i]&&(k=rep[i],v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));else for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=str(k,value),v&&partial.push(quote(k)+(gap?": ":":")+v));return v=0===partial.length?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}",gap=mind,v}}"function"!=typeof Date.prototype.toJSON&&(Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;"function"!=typeof JSON.stringify&&(JSON.stringify=function(value,replacer,space){var i;if(gap="",indent="","number"==typeof space)for(i=0;space>i;i+=1)indent+=" ";else"string"==typeof space&&(indent=space);if(rep=replacer,replacer&&"function"!=typeof replacer&&("object"!=typeof replacer||"number"!=typeof replacer.length))throw new Error("JSON.stringify");return str("",{"":value})}),"function"!=typeof JSON.parse&&(JSON.parse=function(text,reviver){function walk(holder,key){var k,v,value=holder[key];if(value&&"object"==typeof value)for(k in value)Object.prototype.hasOwnProperty.call(value,k)&&(v=walk(value,k),void 0!==v?value[k]=v:delete value[k]);return reviver.call(holder,key,value)}var j;if(text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})),/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),"function"==typeof reviver?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}(),window.Modernizr=function(window,document,undefined){function setCss(str){mStyle.cssText=str}function is(obj,type){return typeof obj===type}function contains(str,substr){return!!~(""+str).indexOf(substr)}function testProps(props,prefixed){for(var i in props){var prop=props[i];if(!contains(prop,"-")&&mStyle[prop]!==undefined)return"pfx"==prefixed?prop:!0}return!1}function testDOMProps(props,obj,elem){for(var i in props){var item=obj[props[i]];if(item!==undefined)return elem===!1?props[i]:is(item,"function")?item.bind(elem||obj):item}return!1}function testPropsAll(prop,prefixed,elem){var ucProp=prop.charAt(0).toUpperCase()+prop.slice(1),props=(prop+" "+cssomPrefixes.join(ucProp+" ")+ucProp).split(" ");return is(prefixed,"string")||is(prefixed,"undefined")?testProps(props,prefixed):(props=(prop+" "+domPrefixes.join(ucProp+" ")+ucProp).split(" "),testDOMProps(props,prefixed,elem))}function webforms(){Modernizr.input=function(props){for(var i=0,len=props.length;len>i;i++)attrs[props[i]]=!!(props[i]in inputElem);return attrs.list&&(attrs.list=!(!document.createElement("datalist")||!window.HTMLDataListElement)),attrs}("autocomplete autofocus list placeholder max min multiple pattern required step".split(" ")),Modernizr.inputtypes=function(props){for(var bool,inputElemType,defaultView,i=0,len=props.length;len>i;i++)inputElem.setAttribute("type",inputElemType=props[i]),bool="text"!==inputElem.type,bool&&(inputElem.value=smile,inputElem.style.cssText="position:absolute;visibility:hidden;",/^range$/.test(inputElemType)&&inputElem.style.WebkitAppearance!==undefined?(docElement.appendChild(inputElem),defaultView=document.defaultView,bool=defaultView.getComputedStyle&&"textfield"!==defaultView.getComputedStyle(inputElem,null).WebkitAppearance&&0!==inputElem.offsetHeight,docElement.removeChild(inputElem)):/^(search|tel)$/.test(inputElemType)||(bool=/^(url|email)$/.test(inputElemType)?inputElem.checkValidity&&inputElem.checkValidity()===!1:inputElem.value!=smile)),inputs[props[i]]=!!bool;return inputs}("search tel url email datetime date month week time datetime-local number range color".split(" "))}var featureName,hasOwnProp,version="2.6.2",Modernizr={},enableClasses=!0,docElement=document.documentElement,mod="modernizr",modElem=document.createElement(mod),mStyle=modElem.style,inputElem=document.createElement("input"),smile=":)",toString={}.toString,prefixes=" -webkit- -moz- -o- -ms- ".split(" "),omPrefixes="Webkit Moz O ms",cssomPrefixes=omPrefixes.split(" "),domPrefixes=omPrefixes.toLowerCase().split(" "),ns={svg:"http://www.w3.org/2000/svg"},tests={},inputs={},attrs={},classes=[],slice=classes.slice,injectElementWithStyles=function(rule,callback,nodes,testnames){var style,ret,node,docOverflow,div=document.createElement("div"),body=document.body,fakeBody=body||document.createElement("body");if(parseInt(nodes,10))for(;nodes--;)node=document.createElement("div"),node.id=testnames?testnames[nodes]:mod+(nodes+1),div.appendChild(node);return style=["&#173;",'<style id="s',mod,'">',rule,"</style>"].join(""),div.id=mod,(body?div:fakeBody).innerHTML+=style,fakeBody.appendChild(div),body||(fakeBody.style.background="",fakeBody.style.overflow="hidden",docOverflow=docElement.style.overflow,docElement.style.overflow="hidden",docElement.appendChild(fakeBody)),ret=callback(div,rule),body?div.parentNode.removeChild(div):(fakeBody.parentNode.removeChild(fakeBody),docElement.style.overflow=docOverflow),!!ret},testMediaQuery=function(mq){var matchMedia=window.matchMedia||window.msMatchMedia;if(matchMedia)return matchMedia(mq).matches;var bool;return injectElementWithStyles("@media "+mq+" { #"+mod+" { position: absolute; } }",function(node){bool="absolute"==(window.getComputedStyle?getComputedStyle(node,null):node.currentStyle).position}),bool},_hasOwnProperty={}.hasOwnProperty;hasOwnProp=is(_hasOwnProperty,"undefined")||is(_hasOwnProperty.call,"undefined")?function(object,property){return property in object&&is(object.constructor.prototype[property],"undefined")}:function(object,property){return _hasOwnProperty.call(object,property)},Function.prototype.bind||(Function.prototype.bind=function(that){var target=this;if("function"!=typeof target)throw new TypeError;var args=slice.call(arguments,1),bound=function(){if(this instanceof bound){var F=function(){};F.prototype=target.prototype;var self=new F,result=target.apply(self,args.concat(slice.call(arguments)));return Object(result)===result?result:self}return target.apply(that,args.concat(slice.call(arguments)))};return bound}),tests.touch=function(){var bool;return"ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch?bool=!0:injectElementWithStyles(["@media (",prefixes.join("touch-enabled),("),mod,")","{#modernizr{top:9px;position:absolute}}"].join(""),function(node){bool=9===node.offsetTop}),bool},tests.history=function(){return!(!window.history||!history.pushState)},tests.cssanimations=function(){return testPropsAll("animationName")},tests.csscolumns=function(){return testPropsAll("columnCount")},tests.csstransforms=function(){return!!testPropsAll("transform")},tests.csstransforms3d=function(){var ret=!!testPropsAll("perspective");return ret&&"webkitPerspective"in docElement.style&&injectElementWithStyles("@media (transform-3d),(-webkit-transform-3d){#modernizr{left:9px;position:absolute;height:3px;}}",function(node,rule){ret=9===node.offsetLeft&&3===node.offsetHeight}),ret},tests.csstransitions=function(){return testPropsAll("transition")},tests.svg=function(){return!!document.createElementNS&&!!document.createElementNS(ns.svg,"svg").createSVGRect},tests.inlinesvg=function(){var div=document.createElement("div");return div.innerHTML="<svg/>",(div.firstChild&&div.firstChild.namespaceURI)==ns.svg},tests.svgclippaths=function(){return!!document.createElementNS&&/SVGClipPath/.test(toString.call(document.createElementNS(ns.svg,"clipPath")))};for(var feature in tests)hasOwnProp(tests,feature)&&(featureName=feature.toLowerCase(),Modernizr[featureName]=tests[feature](),classes.push((Modernizr[featureName]?"":"no-")+featureName));return Modernizr.input||webforms(),Modernizr.addTest=function(feature,test){if("object"==typeof feature)for(var key in feature)hasOwnProp(feature,key)&&Modernizr.addTest(key,feature[key]);else{if(feature=feature.toLowerCase(),Modernizr[feature]!==undefined)return Modernizr;test="function"==typeof test?test():test,"undefined"!=typeof enableClasses&&enableClasses&&(docElement.className+=" "+(test?"":"no-")+feature),Modernizr[feature]=test}return Modernizr},setCss(""),modElem=inputElem=null,function(window,document){function addStyleSheet(ownerDocument,cssText){var p=ownerDocument.createElement("p"),parent=ownerDocument.getElementsByTagName("head")[0]||ownerDocument.documentElement;return p.innerHTML="x<style>"+cssText+"</style>",parent.insertBefore(p.lastChild,parent.firstChild)}function getElements(){var elements=html5.elements;return"string"==typeof elements?elements.split(" "):elements}function getExpandoData(ownerDocument){var data=expandoData[ownerDocument[expando]];return data||(data={},expanID++,ownerDocument[expando]=expanID,expandoData[expanID]=data),data}function createElement(nodeName,ownerDocument,data){if(ownerDocument||(ownerDocument=document),supportsUnknownElements)return ownerDocument.createElement(nodeName);data||(data=getExpandoData(ownerDocument));var node;return node=data.cache[nodeName]?data.cache[nodeName].cloneNode():saveClones.test(nodeName)?(data.cache[nodeName]=data.createElem(nodeName)).cloneNode():data.createElem(nodeName),node.canHaveChildren&&!reSkip.test(nodeName)?data.frag.appendChild(node):node}function createDocumentFragment(ownerDocument,data){if(ownerDocument||(ownerDocument=document),supportsUnknownElements)return ownerDocument.createDocumentFragment();data=data||getExpandoData(ownerDocument);for(var clone=data.frag.cloneNode(),i=0,elems=getElements(),l=elems.length;l>i;i++)clone.createElement(elems[i]);return clone}function shivMethods(ownerDocument,data){data.cache||(data.cache={},data.createElem=ownerDocument.createElement,data.createFrag=ownerDocument.createDocumentFragment,data.frag=data.createFrag()),ownerDocument.createElement=function(nodeName){return html5.shivMethods?createElement(nodeName,ownerDocument,data):data.createElem(nodeName)},ownerDocument.createDocumentFragment=Function("h,f","return function(){var n=f.cloneNode(),c=n.createElement;h.shivMethods&&("+getElements().join().replace(/\w+/g,function(nodeName){return data.createElem(nodeName),data.frag.createElement(nodeName),'c("'+nodeName+'")'})+");return n}")(html5,data.frag)}function shivDocument(ownerDocument){ownerDocument||(ownerDocument=document);var data=getExpandoData(ownerDocument);return!html5.shivCSS||supportsHtml5Styles||data.hasCSS||(data.hasCSS=!!addStyleSheet(ownerDocument,"article,aside,figcaption,figure,footer,header,hgroup,nav,section{display:block}mark{background:#FF0;color:#000}")),supportsUnknownElements||shivMethods(ownerDocument,data),ownerDocument}var supportsHtml5Styles,supportsUnknownElements,options=window.html5||{},reSkip=/^<|^(?:button|map|select|textarea|object|iframe|option|optgroup)$/i,saveClones=/^(?:a|b|code|div|fieldset|h1|h2|h3|h4|h5|h6|i|label|li|ol|p|q|span|strong|style|table|tbody|td|th|tr|ul)$/i,expando="_html5shiv",expanID=0,expandoData={};!function(){try{var a=document.createElement("a");a.innerHTML="<xyz></xyz>",supportsHtml5Styles="hidden"in a,supportsUnknownElements=1==a.childNodes.length||function(){document.createElement("a");var frag=document.createDocumentFragment();return"undefined"==typeof frag.cloneNode||"undefined"==typeof frag.createDocumentFragment||"undefined"==typeof frag.createElement}()}catch(e){supportsHtml5Styles=!0,supportsUnknownElements=!0}}();var html5={elements:options.elements||"abbr article aside audio bdi canvas data datalist details figcaption figure footer header hgroup mark meter nav output progress section summary time video",shivCSS:options.shivCSS!==!1,supportsUnknownElements:supportsUnknownElements,shivMethods:options.shivMethods!==!1,type:"default",shivDocument:shivDocument,createElement:createElement,createDocumentFragment:createDocumentFragment};window.html5=html5,shivDocument(document)}(this,document),Modernizr._version=version,Modernizr._prefixes=prefixes,Modernizr._domPrefixes=domPrefixes,Modernizr._cssomPrefixes=cssomPrefixes,Modernizr.mq=testMediaQuery,Modernizr.testProp=function(prop){return testProps([prop])},Modernizr.testAllProps=testPropsAll,Modernizr.testStyles=injectElementWithStyles,docElement.className=docElement.className.replace(/(^|\s)no-js(\s|$)/,"$1$2")+(enableClasses?" js "+classes.join(" "):""),Modernizr}(this,this.document),function(a,b,c){function d(a){return"[object Function]"==o.call(a)}function e(a){return"string"==typeof a}function f(){}function g(a){return!a||"loaded"==a||"complete"==a||"uninitialized"==a}function h(){var a=p.shift();q=1,a?a.t?m(function(){("c"==a.t?B.injectCss:B.injectJs)(a.s,0,a.a,a.x,a.e,1)},0):(a(),h()):q=0}function i(a,c,d,e,f,i,j){function k(b){if(!o&&g(l.readyState)&&(u.r=o=1,!q&&h(),l.onload=l.onreadystatechange=null,b)){"img"!=a&&m(function(){t.removeChild(l)},50);for(var d in y[c])y[c].hasOwnProperty(d)&&y[c][d].onload()}}var j=j||B.errorTimeout,l=b.createElement(a),o=0,r=0,u={t:d,s:c,e:f,a:i,x:j};1===y[c]&&(r=1,y[c]=[]),"object"==a?l.data=c:(l.src=c,l.type=a),l.width=l.height="0",l.onerror=l.onload=l.onreadystatechange=function(){k.call(this,r)},p.splice(e,0,u),"img"!=a&&(r||2===y[c]?(t.insertBefore(l,s?null:n),m(k,j)):y[c].push(l))}function j(a,b,c,d,f){return q=0,b=b||"j",e(a)?i("c"==b?v:u,a,b,this.i++,c,d,f):(p.splice(this.i++,0,a),1==p.length&&h()),this}function k(){var a=B;return a.loader={load:j,i:0},a}var A,B,l=b.documentElement,m=a.setTimeout,n=b.getElementsByTagName("script")[0],o={}.toString,p=[],q=0,r="MozAppearance"in l.style,s=r&&!!b.createRange().compareNode,t=s?l:n.parentNode,l=a.opera&&"[object Opera]"==o.call(a.opera),l=!!b.attachEvent&&!l,u=r?"object":l?"script":"img",v=l?"script":u,w=Array.isArray||function(a){return"[object Array]"==o.call(a)},x=[],y={},z={timeout:function(a,b){return b.length&&(a.timeout=b[0]),a}};B=function(a){function b(a){var e,f,g,a=a.split("!"),b=x.length,c=a.pop(),d=a.length,c={url:c,origUrl:c,prefixes:a};for(f=0;d>f;f++)g=a[f].split("="),(e=z[g.shift()])&&(c=e(c,g));for(f=0;b>f;f++)c=x[f](c);return c}function g(a,e,f,g,h){var i=b(a),j=i.autoCallback;i.url.split(".").pop().split("?").shift(),i.bypass||(e&&(e=d(e)?e:e[a]||e[g]||e[a.split("/").pop().split("?")[0]]),i.instead?i.instead(a,e,f,g,h):(y[i.url]?i.noexec=!0:y[i.url]=1,f.load(i.url,i.forceCSS||!i.forceJS&&"css"==i.url.split(".").pop().split("?").shift()?"c":c,i.noexec,i.attrs,i.timeout),(d(e)||d(j))&&f.load(function(){k(),e&&e(i.origUrl,h,g),j&&j(i.origUrl,h,g),y[i.url]=2})))}function h(a,b){function c(a,c){if(a){if(e(a))c||(j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}),g(a,j,b,0,h);else if(Object(a)===a)for(n in m=function(){var c,b=0;for(c in a)a.hasOwnProperty(c)&&b++;return b}(),a)a.hasOwnProperty(n)&&(!c&&!--m&&(d(j)?j=function(){var a=[].slice.call(arguments);k.apply(this,a),l()}:j[n]=function(a){return function(){var b=[].slice.call(arguments);a&&a.apply(this,b),l()}}(k[n])),g(a[n],j,b,n,h))}else!c&&l()}var m,n,h=!!a.test,i=a.load||a.both,j=a.callback||f,k=j,l=a.complete||f;c(h?a.yep:a.nope,!!i),i&&c(i)}var i,j,l=this.yepnope.loader;if(e(a))g(a,0,l,0);else if(w(a))for(i=0;i<a.length;i++)j=a[i],e(j)?g(j,0,l,0):w(j)?B(j):Object(j)===j&&h(j,l);else Object(a)===a&&h(a,l)},B.addPrefix=function(a,b){z[a]=b},B.addFilter=function(a){x.push(a)},B.errorTimeout=1e4,null==b.readyState&&b.addEventListener&&(b.readyState="loading",b.addEventListener("DOMContentLoaded",A=function(){b.removeEventListener("DOMContentLoaded",A,0),b.readyState="complete"},0)),a.yepnope=k(),a.yepnope.executeStack=h,a.yepnope.injectJs=function(a,c,d,e,i,j){var l,o,k=b.createElement("script"),e=e||B.errorTimeout;k.src=a;for(o in d)k.setAttribute(o,d[o]);c=j?h:c||f,k.onreadystatechange=k.onload=function(){!l&&g(k.readyState)&&(l=1,c(),k.onload=k.onreadystatechange=null)},m(function(){l||(l=1,c(1))},e),i?k.onload():n.parentNode.insertBefore(k,n)},a.yepnope.injectCss=function(a,c,d,e,g,i){var j,e=b.createElement("link"),c=i?h:c||f;e.href=a,e.rel="stylesheet",e.type="text/css";for(j in d)e.setAttribute(j,d[j]);g||(n.parentNode.insertBefore(e,n),m(c,0))}}(this,document),Modernizr.load=function(){yepnope.apply(window,[].slice.call(arguments,0))},Modernizr.addTest("placeholder",function(){return!!("placeholder"in(Modernizr.input||document.createElement("input"))&&"placeholder"in(Modernizr.textarea||document.createElement("textarea")))}),/*!
 * jQuery JavaScript Library v2.0.3
 * http://jquery.com/
 *
 * Includes Sizzle.js
 * http://sizzlejs.com/
 *
 * Copyright 2005, 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-07-03T13:30Z
 */
function(window,undefined){function isArraylike(obj){var length=obj.length,type=jQuery.type(obj);return jQuery.isWindow(obj)?!1:1===obj.nodeType&&length?!0:"array"===type||"function"!==type&&(0===length||"number"==typeof length&&length>0&&length-1 in obj)}function createOptions(options){var object=optionsCache[options]={};return jQuery.each(options.match(core_rnotwhite)||[],function(_,flag){object[flag]=!0}),object}function Data(){Object.defineProperty(this.cache={},0,{get:function(){return{}}}),this.expando=jQuery.expando+Math.random()}function dataAttr(elem,key,data){var name;if(data===undefined&&1===elem.nodeType)if(name="data-"+key.replace(rmultiDash,"-$1").toLowerCase(),data=elem.getAttribute(name),"string"==typeof data){try{data="true"===data?!0:"false"===data?!1:"null"===data?null:+data+""===data?+data:rbrace.test(data)?JSON.parse(data):data}catch(e){}data_user.set(elem,key,data)}else data=undefined;return data}function returnTrue(){return!0}function returnFalse(){return!1}function safeActiveElement(){try{return document.activeElement}catch(err){}}function sibling(cur,dir){for(;(cur=cur[dir])&&1!==cur.nodeType;);return cur}function winnow(elements,qualifier,not){if(jQuery.isFunction(qualifier))return jQuery.grep(elements,function(elem,i){return!!qualifier.call(elem,i,elem)!==not});if(qualifier.nodeType)return jQuery.grep(elements,function(elem){return elem===qualifier!==not});if("string"==typeof qualifier){if(isSimple.test(qualifier))return jQuery.filter(qualifier,elements,not);qualifier=jQuery.filter(qualifier,elements)}return jQuery.grep(elements,function(elem){return core_indexOf.call(qualifier,elem)>=0!==not})}function manipulationTarget(elem,content){return jQuery.nodeName(elem,"table")&&jQuery.nodeName(1===content.nodeType?content:content.firstChild,"tr")?elem.getElementsByTagName("tbody")[0]||elem.appendChild(elem.ownerDocument.createElement("tbody")):elem}function disableScript(elem){return elem.type=(null!==elem.getAttribute("type"))+"/"+elem.type,elem}function restoreScript(elem){var match=rscriptTypeMasked.exec(elem.type);return match?elem.type=match[1]:elem.removeAttribute("type"),elem}function setGlobalEval(elems,refElements){for(var l=elems.length,i=0;l>i;i++)data_priv.set(elems[i],"globalEval",!refElements||data_priv.get(refElements[i],"globalEval"))}function cloneCopyEvent(src,dest){var i,l,type,pdataOld,pdataCur,udataOld,udataCur,events;if(1===dest.nodeType){if(data_priv.hasData(src)&&(pdataOld=data_priv.access(src),pdataCur=data_priv.set(dest,pdataOld),events=pdataOld.events)){delete pdataCur.handle,pdataCur.events={};for(type in events)for(i=0,l=events[type].length;l>i;i++)jQuery.event.add(dest,type,events[type][i])}data_user.hasData(src)&&(udataOld=data_user.access(src),udataCur=jQuery.extend({},udataOld),data_user.set(dest,udataCur))}}function getAll(context,tag){var ret=context.getElementsByTagName?context.getElementsByTagName(tag||"*"):context.querySelectorAll?context.querySelectorAll(tag||"*"):[];return tag===undefined||tag&&jQuery.nodeName(context,tag)?jQuery.merge([context],ret):ret}function fixInput(src,dest){var nodeName=dest.nodeName.toLowerCase();"input"===nodeName&&manipulation_rcheckableType.test(src.type)?dest.checked=src.checked:("input"===nodeName||"textarea"===nodeName)&&(dest.defaultValue=src.defaultValue)}function vendorPropName(style,name){if(name in style)return name;for(var capName=name.charAt(0).toUpperCase()+name.slice(1),origName=name,i=cssPrefixes.length;i--;)if(name=cssPrefixes[i]+capName,name in style)return name;return origName}function isHidden(elem,el){return elem=el||elem,"none"===jQuery.css(elem,"display")||!jQuery.contains(elem.ownerDocument,elem)}function getStyles(elem){return window.getComputedStyle(elem,null)}function showHide(elements,show){for(var display,elem,hidden,values=[],index=0,length=elements.length;length>index;index++)elem=elements[index],elem.style&&(values[index]=data_priv.get(elem,"olddisplay"),display=elem.style.display,show?(values[index]||"none"!==display||(elem.style.display=""),""===elem.style.display&&isHidden(elem)&&(values[index]=data_priv.access(elem,"olddisplay",css_defaultDisplay(elem.nodeName)))):values[index]||(hidden=isHidden(elem),(display&&"none"!==display||!hidden)&&data_priv.set(elem,"olddisplay",hidden?display:jQuery.css(elem,"display"))));for(index=0;length>index;index++)elem=elements[index],elem.style&&(show&&"none"!==elem.style.display&&""!==elem.style.display||(elem.style.display=show?values[index]||"":"none"));return elements}function setPositiveNumber(elem,value,subtract){var matches=rnumsplit.exec(value);return matches?Math.max(0,matches[1]-(subtract||0))+(matches[2]||"px"):value}function augmentWidthOrHeight(elem,name,extra,isBorderBox,styles){for(var i=extra===(isBorderBox?"border":"content")?4:"width"===name?1:0,val=0;4>i;i+=2)"margin"===extra&&(val+=jQuery.css(elem,extra+cssExpand[i],!0,styles)),isBorderBox?("content"===extra&&(val-=jQuery.css(elem,"padding"+cssExpand[i],!0,styles)),"margin"!==extra&&(val-=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles))):(val+=jQuery.css(elem,"padding"+cssExpand[i],!0,styles),"padding"!==extra&&(val+=jQuery.css(elem,"border"+cssExpand[i]+"Width",!0,styles)));return val}function getWidthOrHeight(elem,name,extra){var valueIsBorderBox=!0,val="width"===name?elem.offsetWidth:elem.offsetHeight,styles=getStyles(elem),isBorderBox=jQuery.support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles);if(0>=val||null==val){if(val=curCSS(elem,name,styles),(0>val||null==val)&&(val=elem.style[name]),rnumnonpx.test(val))return val;valueIsBorderBox=isBorderBox&&(jQuery.support.boxSizingReliable||val===elem.style[name]),val=parseFloat(val)||0}return val+augmentWidthOrHeight(elem,name,extra||(isBorderBox?"border":"content"),valueIsBorderBox,styles)+"px"}function css_defaultDisplay(nodeName){var doc=document,display=elemdisplay[nodeName];return display||(display=actualDisplay(nodeName,doc),"none"!==display&&display||(iframe=(iframe||jQuery("<iframe frameborder='0' width='0' height='0'/>").css("cssText","display:block !important")).appendTo(doc.documentElement),doc=(iframe[0].contentWindow||iframe[0].contentDocument).document,doc.write("<!doctype html><html><body>"),doc.close(),display=actualDisplay(nodeName,doc),iframe.detach()),elemdisplay[nodeName]=display),display}function actualDisplay(name,doc){var elem=jQuery(doc.createElement(name)).appendTo(doc.body),display=jQuery.css(elem[0],"display");return elem.remove(),display}function buildParams(prefix,obj,traditional,add){var name;if(jQuery.isArray(obj))jQuery.each(obj,function(i,v){traditional||rbracket.test(prefix)?add(prefix,v):buildParams(prefix+"["+("object"==typeof v?i:"")+"]",v,traditional,add)});else if(traditional||"object"!==jQuery.type(obj))add(prefix,obj);else for(name in obj)buildParams(prefix+"["+name+"]",obj[name],traditional,add)}function addToPrefiltersOrTransports(structure){return function(dataTypeExpression,func){"string"!=typeof dataTypeExpression&&(func=dataTypeExpression,dataTypeExpression="*");var dataType,i=0,dataTypes=dataTypeExpression.toLowerCase().match(core_rnotwhite)||[];if(jQuery.isFunction(func))for(;dataType=dataTypes[i++];)"+"===dataType[0]?(dataType=dataType.slice(1)||"*",(structure[dataType]=structure[dataType]||[]).unshift(func)):(structure[dataType]=structure[dataType]||[]).push(func)}}function inspectPrefiltersOrTransports(structure,options,originalOptions,jqXHR){function inspect(dataType){var selected;return inspected[dataType]=!0,jQuery.each(structure[dataType]||[],function(_,prefilterOrFactory){var dataTypeOrTransport=prefilterOrFactory(options,originalOptions,jqXHR);return"string"!=typeof dataTypeOrTransport||seekingTransport||inspected[dataTypeOrTransport]?seekingTransport?!(selected=dataTypeOrTransport):void 0:(options.dataTypes.unshift(dataTypeOrTransport),inspect(dataTypeOrTransport),!1)}),selected}var inspected={},seekingTransport=structure===transports;return inspect(options.dataTypes[0])||!inspected["*"]&&inspect("*")}function ajaxExtend(target,src){var key,deep,flatOptions=jQuery.ajaxSettings.flatOptions||{};for(key in src)src[key]!==undefined&&((flatOptions[key]?target:deep||(deep={}))[key]=src[key]);return deep&&jQuery.extend(!0,target,deep),target}function ajaxHandleResponses(s,jqXHR,responses){for(var ct,type,finalDataType,firstDataType,contents=s.contents,dataTypes=s.dataTypes;"*"===dataTypes[0];)dataTypes.shift(),ct===undefined&&(ct=s.mimeType||jqXHR.getResponseHeader("Content-Type"));if(ct)for(type in contents)if(contents[type]&&contents[type].test(ct)){dataTypes.unshift(type);break}if(dataTypes[0]in responses)finalDataType=dataTypes[0];else{for(type in responses){if(!dataTypes[0]||s.converters[type+" "+dataTypes[0]]){finalDataType=type;break}firstDataType||(firstDataType=type)}finalDataType=finalDataType||firstDataType}return finalDataType?(finalDataType!==dataTypes[0]&&dataTypes.unshift(finalDataType),responses[finalDataType]):void 0}function ajaxConvert(s,response,jqXHR,isSuccess){var conv2,current,conv,tmp,prev,converters={},dataTypes=s.dataTypes.slice();if(dataTypes[1])for(conv in s.converters)converters[conv.toLowerCase()]=s.converters[conv];for(current=dataTypes.shift();current;)if(s.responseFields[current]&&(jqXHR[s.responseFields[current]]=response),!prev&&isSuccess&&s.dataFilter&&(response=s.dataFilter(response,s.dataType)),prev=current,current=dataTypes.shift())if("*"===current)current=prev;else if("*"!==prev&&prev!==current){if(conv=converters[prev+" "+current]||converters["* "+current],!conv)for(conv2 in converters)if(tmp=conv2.split(" "),tmp[1]===current&&(conv=converters[prev+" "+tmp[0]]||converters["* "+tmp[0]])){conv===!0?conv=converters[conv2]:converters[conv2]!==!0&&(current=tmp[0],dataTypes.unshift(tmp[1]));break}if(conv!==!0)if(conv&&s["throws"])response=conv(response);else try{response=conv(response)}catch(e){return{state:"parsererror",error:conv?e:"No conversion from "+prev+" to "+current}}}return{state:"success",data:response}}function createFxNow(){return setTimeout(function(){fxNow=undefined}),fxNow=jQuery.now()}function createTween(value,prop,animation){for(var tween,collection=(tweeners[prop]||[]).concat(tweeners["*"]),index=0,length=collection.length;length>index;index++)if(tween=collection[index].call(animation,prop,value))return tween}function Animation(elem,properties,options){var result,stopped,index=0,length=animationPrefilters.length,deferred=jQuery.Deferred().always(function(){delete tick.elem}),tick=function(){if(stopped)return!1;for(var currentTime=fxNow||createFxNow(),remaining=Math.max(0,animation.startTime+animation.duration-currentTime),temp=remaining/animation.duration||0,percent=1-temp,index=0,length=animation.tweens.length;length>index;index++)animation.tweens[index].run(percent);return deferred.notifyWith(elem,[animation,percent,remaining]),1>percent&&length?remaining:(deferred.resolveWith(elem,[animation]),!1)},animation=deferred.promise({elem:elem,props:jQuery.extend({},properties),opts:jQuery.extend(!0,{specialEasing:{}},options),originalProperties:properties,originalOptions:options,startTime:fxNow||createFxNow(),duration:options.duration,tweens:[],createTween:function(prop,end){var tween=jQuery.Tween(elem,animation.opts,prop,end,animation.opts.specialEasing[prop]||animation.opts.easing);return animation.tweens.push(tween),tween},stop:function(gotoEnd){var index=0,length=gotoEnd?animation.tweens.length:0;if(stopped)return this;for(stopped=!0;length>index;index++)animation.tweens[index].run(1);return gotoEnd?deferred.resolveWith(elem,[animation,gotoEnd]):deferred.rejectWith(elem,[animation,gotoEnd]),this}}),props=animation.props;for(propFilter(props,animation.opts.specialEasing);length>index;index++)if(result=animationPrefilters[index].call(animation,elem,props,animation.opts))return result;return jQuery.map(props,createTween,animation),jQuery.isFunction(animation.opts.start)&&animation.opts.start.call(elem,animation),jQuery.fx.timer(jQuery.extend(tick,{elem:elem,anim:animation,queue:animation.opts.queue})),animation.progress(animation.opts.progress).done(animation.opts.done,animation.opts.complete).fail(animation.opts.fail).always(animation.opts.always)}function propFilter(props,specialEasing){var index,name,easing,value,hooks;for(index in props)if(name=jQuery.camelCase(index),easing=specialEasing[name],value=props[index],jQuery.isArray(value)&&(easing=value[1],value=props[index]=value[0]),index!==name&&(props[name]=value,delete props[index]),hooks=jQuery.cssHooks[name],hooks&&"expand"in hooks){value=hooks.expand(value),delete props[name];for(index in value)index in props||(props[index]=value[index],specialEasing[index]=easing)}else specialEasing[name]=easing}function defaultPrefilter(elem,props,opts){var prop,value,toggle,tween,hooks,oldfire,anim=this,orig={},style=elem.style,hidden=elem.nodeType&&isHidden(elem),dataShow=data_priv.get(elem,"fxshow");opts.queue||(hooks=jQuery._queueHooks(elem,"fx"),null==hooks.unqueued&&(hooks.unqueued=0,oldfire=hooks.empty.fire,hooks.empty.fire=function(){hooks.unqueued||oldfire()}),hooks.unqueued++,anim.always(function(){anim.always(function(){hooks.unqueued--,jQuery.queue(elem,"fx").length||hooks.empty.fire()})})),1===elem.nodeType&&("height"in props||"width"in props)&&(opts.overflow=[style.overflow,style.overflowX,style.overflowY],"inline"===jQuery.css(elem,"display")&&"none"===jQuery.css(elem,"float")&&(style.display="inline-block")),opts.overflow&&(style.overflow="hidden",anim.always(function(){style.overflow=opts.overflow[0],style.overflowX=opts.overflow[1],style.overflowY=opts.overflow[2]}));for(prop in props)if(value=props[prop],rfxtypes.exec(value)){if(delete props[prop],toggle=toggle||"toggle"===value,value===(hidden?"hide":"show")){if("show"!==value||!dataShow||dataShow[prop]===undefined)continue;hidden=!0}orig[prop]=dataShow&&dataShow[prop]||jQuery.style(elem,prop)}if(!jQuery.isEmptyObject(orig)){dataShow?"hidden"in dataShow&&(hidden=dataShow.hidden):dataShow=data_priv.access(elem,"fxshow",{}),toggle&&(dataShow.hidden=!hidden),hidden?jQuery(elem).show():anim.done(function(){jQuery(elem).hide()}),anim.done(function(){var prop;data_priv.remove(elem,"fxshow");for(prop in orig)jQuery.style(elem,prop,orig[prop])});for(prop in orig)tween=createTween(hidden?dataShow[prop]:0,prop,anim),prop in dataShow||(dataShow[prop]=tween.start,hidden&&(tween.end=tween.start,tween.start="width"===prop||"height"===prop?1:0))}}function Tween(elem,options,prop,end,easing){return new Tween.prototype.init(elem,options,prop,end,easing)}function genFx(type,includeWidth){var which,attrs={height:type},i=0;for(includeWidth=includeWidth?1:0;4>i;i+=2-includeWidth)which=cssExpand[i],attrs["margin"+which]=attrs["padding"+which]=type;return includeWidth&&(attrs.opacity=attrs.width=type),attrs}function getWindow(elem){return jQuery.isWindow(elem)?elem:9===elem.nodeType&&elem.defaultView}var rootjQuery,readyList,core_strundefined=typeof undefined,location=window.location,document=window.document,docElem=document.documentElement,_jQuery=window.jQuery,_$=window.$,class2type={},core_deletedIds=[],core_version="2.0.3",core_concat=core_deletedIds.concat,core_push=core_deletedIds.push,core_slice=core_deletedIds.slice,core_indexOf=core_deletedIds.indexOf,core_toString=class2type.toString,core_hasOwn=class2type.hasOwnProperty,core_trim=core_version.trim,jQuery=function(selector,context){return new jQuery.fn.init(selector,context,rootjQuery)},core_pnum=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,core_rnotwhite=/\S+/g,rquickExpr=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]*))$/,rsingleTag=/^<(\w+)\s*\/?>(?:<\/\1>|)$/,rmsPrefix=/^-ms-/,rdashAlpha=/-([\da-z])/gi,fcamelCase=function(all,letter){return letter.toUpperCase()},completed=function(){document.removeEventListener("DOMContentLoaded",completed,!1),window.removeEventListener("load",completed,!1),jQuery.ready()};jQuery.fn=jQuery.prototype={jquery:core_version,constructor:jQuery,init:function(selector,context,rootjQuery){var match,elem;if(!selector)return this;if("string"==typeof selector){if(match="<"===selector.charAt(0)&&">"===selector.charAt(selector.length-1)&&selector.length>=3?[null,selector,null]:rquickExpr.exec(selector),!match||!match[1]&&context)return!context||context.jquery?(context||rootjQuery).find(selector):this.constructor(context).find(selector);if(match[1]){if(context=context instanceof jQuery?context[0]:context,jQuery.merge(this,jQuery.parseHTML(match[1],context&&context.nodeType?context.ownerDocument||context:document,!0)),rsingleTag.test(match[1])&&jQuery.isPlainObject(context))for(match in context)jQuery.isFunction(this[match])?this[match](context[match]):this.attr(match,context[match]);return this}return elem=document.getElementById(match[2]),elem&&elem.parentNode&&(this.length=1,this[0]=elem),this.context=document,this.selector=selector,this}return selector.nodeType?(this.context=this[0]=selector,this.length=1,this):jQuery.isFunction(selector)?rootjQuery.ready(selector):(selector.selector!==undefined&&(this.selector=selector.selector,this.context=selector.context),jQuery.makeArray(selector,this))},selector:"",length:0,toArray:function(){return core_slice.call(this)},get:function(num){return null==num?this.toArray():0>num?this[this.length+num]:this[num]},pushStack:function(elems){var ret=jQuery.merge(this.constructor(),elems);return ret.prevObject=this,ret.context=this.context,ret},each:function(callback,args){return jQuery.each(this,callback,args)},ready:function(fn){return jQuery.ready.promise().done(fn),this},slice:function(){return this.pushStack(core_slice.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},eq:function(i){var len=this.length,j=+i+(0>i?len:0);return this.pushStack(j>=0&&len>j?[this[j]]:[])},map:function(callback){return this.pushStack(jQuery.map(this,function(elem,i){return callback.call(elem,i,elem)}))},end:function(){return this.prevObject||this.constructor(null)},push:core_push,sort:[].sort,splice:[].splice},jQuery.fn.init.prototype=jQuery.fn,jQuery.extend=jQuery.fn.extend=function(){var options,name,src,copy,copyIsArray,clone,target=arguments[0]||{},i=1,length=arguments.length,deep=!1;for("boolean"==typeof target&&(deep=target,target=arguments[1]||{},i=2),"object"==typeof target||jQuery.isFunction(target)||(target={}),length===i&&(target=this,--i);length>i;i++)if(null!=(options=arguments[i]))for(name in options)src=target[name],copy=options[name],target!==copy&&(deep&&copy&&(jQuery.isPlainObject(copy)||(copyIsArray=jQuery.isArray(copy)))?(copyIsArray?(copyIsArray=!1,clone=src&&jQuery.isArray(src)?src:[]):clone=src&&jQuery.isPlainObject(src)?src:{},target[name]=jQuery.extend(deep,clone,copy)):copy!==undefined&&(target[name]=copy));return target},jQuery.extend({expando:"jQuery"+(core_version+Math.random()).replace(/\D/g,""),noConflict:function(deep){return window.$===jQuery&&(window.$=_$),deep&&window.jQuery===jQuery&&(window.jQuery=_jQuery),jQuery},isReady:!1,readyWait:1,holdReady:function(hold){hold?jQuery.readyWait++:jQuery.ready(!0)},ready:function(wait){(wait===!0?--jQuery.readyWait:jQuery.isReady)||(jQuery.isReady=!0,wait!==!0&&--jQuery.readyWait>0||(readyList.resolveWith(document,[jQuery]),jQuery.fn.trigger&&jQuery(document).trigger("ready").off("ready")))},isFunction:function(obj){return"function"===jQuery.type(obj)},isArray:Array.isArray,isWindow:function(obj){return null!=obj&&obj===obj.window},isNumeric:function(obj){return!isNaN(parseFloat(obj))&&isFinite(obj)},type:function(obj){return null==obj?String(obj):"object"==typeof obj||"function"==typeof obj?class2type[core_toString.call(obj)]||"object":typeof obj},isPlainObject:function(obj){if("object"!==jQuery.type(obj)||obj.nodeType||jQuery.isWindow(obj))return!1;try{if(obj.constructor&&!core_hasOwn.call(obj.constructor.prototype,"isPrototypeOf"))return!1}catch(e){return!1}return!0},isEmptyObject:function(obj){var name;for(name in obj)return!1;return!0},error:function(msg){throw new Error(msg)},parseHTML:function(data,context,keepScripts){if(!data||"string"!=typeof data)return null;"boolean"==typeof context&&(keepScripts=context,context=!1),context=context||document;var parsed=rsingleTag.exec(data),scripts=!keepScripts&&[];return parsed?[context.createElement(parsed[1])]:(parsed=jQuery.buildFragment([data],context,scripts),scripts&&jQuery(scripts).remove(),jQuery.merge([],parsed.childNodes))},parseJSON:JSON.parse,parseXML:function(data){var xml,tmp;if(!data||"string"!=typeof data)return null;try{tmp=new DOMParser,xml=tmp.parseFromString(data,"text/xml")}catch(e){xml=undefined}return(!xml||xml.getElementsByTagName("parsererror").length)&&jQuery.error("Invalid XML: "+data),xml},noop:function(){},globalEval:function(code){var script,indirect=eval;code=jQuery.trim(code),code&&(1===code.indexOf("use strict")?(script=document.createElement("script"),script.text=code,document.head.appendChild(script).parentNode.removeChild(script)):indirect(code))},camelCase:function(string){return string.replace(rmsPrefix,"ms-").replace(rdashAlpha,fcamelCase)},nodeName:function(elem,name){return elem.nodeName&&elem.nodeName.toLowerCase()===name.toLowerCase()},each:function(obj,callback,args){var value,i=0,length=obj.length,isArray=isArraylike(obj);if(args){if(isArray)for(;length>i&&(value=callback.apply(obj[i],args),value!==!1);i++);else for(i in obj)if(value=callback.apply(obj[i],args),value===!1)break}else if(isArray)for(;length>i&&(value=callback.call(obj[i],i,obj[i]),value!==!1);i++);else for(i in obj)if(value=callback.call(obj[i],i,obj[i]),value===!1)break;return obj},trim:function(text){return null==text?"":core_trim.call(text)},makeArray:function(arr,results){var ret=results||[];return null!=arr&&(isArraylike(Object(arr))?jQuery.merge(ret,"string"==typeof arr?[arr]:arr):core_push.call(ret,arr)),ret},inArray:function(elem,arr,i){return null==arr?-1:core_indexOf.call(arr,elem,i)},merge:function(first,second){var l=second.length,i=first.length,j=0;if("number"==typeof l)for(;l>j;j++)first[i++]=second[j];else for(;second[j]!==undefined;)first[i++]=second[j++];return first.length=i,first},grep:function(elems,callback,inv){var retVal,ret=[],i=0,length=elems.length;for(inv=!!inv;length>i;i++)retVal=!!callback(elems[i],i),inv!==retVal&&ret.push(elems[i]);return ret},map:function(elems,callback,arg){var value,i=0,length=elems.length,isArray=isArraylike(elems),ret=[];if(isArray)for(;length>i;i++)value=callback(elems[i],i,arg),null!=value&&(ret[ret.length]=value);else for(i in elems)value=callback(elems[i],i,arg),null!=value&&(ret[ret.length]=value);return core_concat.apply([],ret)},guid:1,proxy:function(fn,context){var tmp,args,proxy;return"string"==typeof context&&(tmp=fn[context],context=fn,fn=tmp),jQuery.isFunction(fn)?(args=core_slice.call(arguments,2),proxy=function(){return fn.apply(context||this,args.concat(core_slice.call(arguments)))},proxy.guid=fn.guid=fn.guid||jQuery.guid++,proxy):undefined},access:function(elems,fn,key,value,chainable,emptyGet,raw){var i=0,length=elems.length,bulk=null==key;if("object"===jQuery.type(key)){chainable=!0;for(i in key)jQuery.access(elems,fn,i,key[i],!0,emptyGet,raw)}else if(value!==undefined&&(chainable=!0,jQuery.isFunction(value)||(raw=!0),bulk&&(raw?(fn.call(elems,value),fn=null):(bulk=fn,fn=function(elem,key,value){return bulk.call(jQuery(elem),value)})),fn))for(;length>i;i++)fn(elems[i],key,raw?value:value.call(elems[i],i,fn(elems[i],key)));return chainable?elems:bulk?fn.call(elems):length?fn(elems[0],key):emptyGet},now:Date.now,swap:function(elem,options,callback,args){var ret,name,old={};for(name in options)old[name]=elem.style[name],elem.style[name]=options[name];ret=callback.apply(elem,args||[]);for(name in options)elem.style[name]=old[name];return ret}}),jQuery.ready.promise=function(obj){return readyList||(readyList=jQuery.Deferred(),"complete"===document.readyState?setTimeout(jQuery.ready):(document.addEventListener("DOMContentLoaded",completed,!1),window.addEventListener("load",completed,!1))),readyList.promise(obj)},jQuery.each("Boolean Number String Function Array Date RegExp Object Error".split(" "),function(i,name){class2type["[object "+name+"]"]=name.toLowerCase()}),rootjQuery=jQuery(document),/*!
 * Sizzle CSS Selector Engine v1.9.4-pre
 * http://sizzlejs.com/
 *
 * Copyright 2013 jQuery Foundation, Inc. and other contributors
 * Released under the MIT license
 * http://jquery.org/license
 *
 * Date: 2013-06-03
 */
function(window,undefined){function Sizzle(selector,context,results,seed){var match,elem,m,nodeType,i,groups,old,nid,newContext,newSelector;if((context?context.ownerDocument||context:preferredDoc)!==document&&setDocument(context),context=context||document,results=results||[],!selector||"string"!=typeof selector)return results;if(1!==(nodeType=context.nodeType)&&9!==nodeType)return[];if(documentIsHTML&&!seed){if(match=rquickExpr.exec(selector))if(m=match[1]){if(9===nodeType){if(elem=context.getElementById(m),!elem||!elem.parentNode)return results;if(elem.id===m)return results.push(elem),results}else if(context.ownerDocument&&(elem=context.ownerDocument.getElementById(m))&&contains(context,elem)&&elem.id===m)return results.push(elem),results}else{if(match[2])return push.apply(results,context.getElementsByTagName(selector)),results;if((m=match[3])&&support.getElementsByClassName&&context.getElementsByClassName)return push.apply(results,context.getElementsByClassName(m)),results}if(support.qsa&&(!rbuggyQSA||!rbuggyQSA.test(selector))){if(nid=old=expando,newContext=context,newSelector=9===nodeType&&selector,1===nodeType&&"object"!==context.nodeName.toLowerCase()){for(groups=tokenize(selector),(old=context.getAttribute("id"))?nid=old.replace(rescape,"\\$&"):context.setAttribute("id",nid),nid="[id='"+nid+"'] ",i=groups.length;i--;)groups[i]=nid+toSelector(groups[i]);newContext=rsibling.test(selector)&&context.parentNode||context,newSelector=groups.join(",")}if(newSelector)try{return push.apply(results,newContext.querySelectorAll(newSelector)),results}catch(qsaError){}finally{old||context.removeAttribute("id")}}}return select(selector.replace(rtrim,"$1"),context,results,seed)}function createCache(){function cache(key,value){return keys.push(key+=" ")>Expr.cacheLength&&delete cache[keys.shift()],cache[key]=value}var keys=[];return cache}function markFunction(fn){return fn[expando]=!0,fn}function assert(fn){var div=document.createElement("div");try{return!!fn(div)}catch(e){return!1}finally{div.parentNode&&div.parentNode.removeChild(div),div=null}}function addHandle(attrs,handler){for(var arr=attrs.split("|"),i=attrs.length;i--;)Expr.attrHandle[arr[i]]=handler}function siblingCheck(a,b){var cur=b&&a,diff=cur&&1===a.nodeType&&1===b.nodeType&&(~b.sourceIndex||MAX_NEGATIVE)-(~a.sourceIndex||MAX_NEGATIVE);if(diff)return diff;if(cur)for(;cur=cur.nextSibling;)if(cur===b)return-1;return a?1:-1}function createInputPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&elem.type===type}}function createButtonPseudo(type){return function(elem){var name=elem.nodeName.toLowerCase();return("input"===name||"button"===name)&&elem.type===type}}function createPositionalPseudo(fn){return markFunction(function(argument){return argument=+argument,markFunction(function(seed,matches){for(var j,matchIndexes=fn([],seed.length,argument),i=matchIndexes.length;i--;)seed[j=matchIndexes[i]]&&(seed[j]=!(matches[j]=seed[j]))})})}function setFilters(){}function tokenize(selector,parseOnly){var matched,match,tokens,type,soFar,groups,preFilters,cached=tokenCache[selector+" "];if(cached)return parseOnly?0:cached.slice(0);for(soFar=selector,groups=[],preFilters=Expr.preFilter;soFar;){(!matched||(match=rcomma.exec(soFar)))&&(match&&(soFar=soFar.slice(match[0].length)||soFar),groups.push(tokens=[])),matched=!1,(match=rcombinators.exec(soFar))&&(matched=match.shift(),tokens.push({value:matched,type:match[0].replace(rtrim," ")}),soFar=soFar.slice(matched.length));for(type in Expr.filter)!(match=matchExpr[type].exec(soFar))||preFilters[type]&&!(match=preFilters[type](match))||(matched=match.shift(),tokens.push({value:matched,type:type,matches:match}),soFar=soFar.slice(matched.length));if(!matched)break}return parseOnly?soFar.length:soFar?Sizzle.error(selector):tokenCache(selector,groups).slice(0)}function toSelector(tokens){for(var i=0,len=tokens.length,selector="";len>i;i++)selector+=tokens[i].value;return selector}function addCombinator(matcher,combinator,base){var dir=combinator.dir,checkNonElements=base&&"parentNode"===dir,doneName=done++;return combinator.first?function(elem,context,xml){for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)return matcher(elem,context,xml)}:function(elem,context,xml){var data,cache,outerCache,dirkey=dirruns+" "+doneName;if(xml){for(;elem=elem[dir];)if((1===elem.nodeType||checkNonElements)&&matcher(elem,context,xml))return!0}else for(;elem=elem[dir];)if(1===elem.nodeType||checkNonElements)if(outerCache=elem[expando]||(elem[expando]={}),(cache=outerCache[dir])&&cache[0]===dirkey){if((data=cache[1])===!0||data===cachedruns)return data===!0}else if(cache=outerCache[dir]=[dirkey],cache[1]=matcher(elem,context,xml)||cachedruns,cache[1]===!0)return!0}}function elementMatcher(matchers){return matchers.length>1?function(elem,context,xml){for(var i=matchers.length;i--;)if(!matchers[i](elem,context,xml))return!1;return!0}:matchers[0]}function condense(unmatched,map,filter,context,xml){for(var elem,newUnmatched=[],i=0,len=unmatched.length,mapped=null!=map;len>i;i++)(elem=unmatched[i])&&(!filter||filter(elem,context,xml))&&(newUnmatched.push(elem),mapped&&map.push(i));return newUnmatched}function setMatcher(preFilter,selector,matcher,postFilter,postFinder,postSelector){return postFilter&&!postFilter[expando]&&(postFilter=setMatcher(postFilter)),postFinder&&!postFinder[expando]&&(postFinder=setMatcher(postFinder,postSelector)),markFunction(function(seed,results,context,xml){var temp,i,elem,preMap=[],postMap=[],preexisting=results.length,elems=seed||multipleContexts(selector||"*",context.nodeType?[context]:context,[]),matcherIn=!preFilter||!seed&&selector?elems:condense(elems,preMap,preFilter,context,xml),matcherOut=matcher?postFinder||(seed?preFilter:preexisting||postFilter)?[]:results:matcherIn;if(matcher&&matcher(matcherIn,matcherOut,context,xml),postFilter)for(temp=condense(matcherOut,postMap),postFilter(temp,[],context,xml),i=temp.length;i--;)(elem=temp[i])&&(matcherOut[postMap[i]]=!(matcherIn[postMap[i]]=elem));if(seed){if(postFinder||preFilter){if(postFinder){for(temp=[],i=matcherOut.length;i--;)(elem=matcherOut[i])&&temp.push(matcherIn[i]=elem);postFinder(null,matcherOut=[],temp,xml)}for(i=matcherOut.length;i--;)(elem=matcherOut[i])&&(temp=postFinder?indexOf.call(seed,elem):preMap[i])>-1&&(seed[temp]=!(results[temp]=elem))}}else matcherOut=condense(matcherOut===results?matcherOut.splice(preexisting,matcherOut.length):matcherOut),postFinder?postFinder(null,results,matcherOut,xml):push.apply(results,matcherOut)})}function matcherFromTokens(tokens){for(var checkContext,matcher,j,len=tokens.length,leadingRelative=Expr.relative[tokens[0].type],implicitRelative=leadingRelative||Expr.relative[" "],i=leadingRelative?1:0,matchContext=addCombinator(function(elem){return elem===checkContext},implicitRelative,!0),matchAnyContext=addCombinator(function(elem){return indexOf.call(checkContext,elem)>-1},implicitRelative,!0),matchers=[function(elem,context,xml){return!leadingRelative&&(xml||context!==outermostContext)||((checkContext=context).nodeType?matchContext(elem,context,xml):matchAnyContext(elem,context,xml))}];len>i;i++)if(matcher=Expr.relative[tokens[i].type])matchers=[addCombinator(elementMatcher(matchers),matcher)];else{if(matcher=Expr.filter[tokens[i].type].apply(null,tokens[i].matches),matcher[expando]){for(j=++i;len>j&&!Expr.relative[tokens[j].type];j++);return setMatcher(i>1&&elementMatcher(matchers),i>1&&toSelector(tokens.slice(0,i-1).concat({value:" "===tokens[i-2].type?"*":""})).replace(rtrim,"$1"),matcher,j>i&&matcherFromTokens(tokens.slice(i,j)),len>j&&matcherFromTokens(tokens=tokens.slice(j)),len>j&&toSelector(tokens))}matchers.push(matcher)}return elementMatcher(matchers)}function matcherFromGroupMatchers(elementMatchers,setMatchers){var matcherCachedRuns=0,bySet=setMatchers.length>0,byElement=elementMatchers.length>0,superMatcher=function(seed,context,xml,results,expandContext){var elem,j,matcher,setMatched=[],matchedCount=0,i="0",unmatched=seed&&[],outermost=null!=expandContext,contextBackup=outermostContext,elems=seed||byElement&&Expr.find.TAG("*",expandContext&&context.parentNode||context),dirrunsUnique=dirruns+=null==contextBackup?1:Math.random()||.1;for(outermost&&(outermostContext=context!==document&&context,cachedruns=matcherCachedRuns);null!=(elem=elems[i]);i++){if(byElement&&elem){for(j=0;matcher=elementMatchers[j++];)if(matcher(elem,context,xml)){results.push(elem);break}outermost&&(dirruns=dirrunsUnique,cachedruns=++matcherCachedRuns)}bySet&&((elem=!matcher&&elem)&&matchedCount--,seed&&unmatched.push(elem))}if(matchedCount+=i,bySet&&i!==matchedCount){for(j=0;matcher=setMatchers[j++];)matcher(unmatched,setMatched,context,xml);if(seed){if(matchedCount>0)for(;i--;)unmatched[i]||setMatched[i]||(setMatched[i]=pop.call(results));setMatched=condense(setMatched)}push.apply(results,setMatched),outermost&&!seed&&setMatched.length>0&&matchedCount+setMatchers.length>1&&Sizzle.uniqueSort(results)}return outermost&&(dirruns=dirrunsUnique,outermostContext=contextBackup),unmatched};return bySet?markFunction(superMatcher):superMatcher}function multipleContexts(selector,contexts,results){for(var i=0,len=contexts.length;len>i;i++)Sizzle(selector,contexts[i],results);return results}function select(selector,context,results,seed){var i,tokens,token,type,find,match=tokenize(selector);if(!seed&&1===match.length){if(tokens=match[0]=match[0].slice(0),tokens.length>2&&"ID"===(token=tokens[0]).type&&support.getById&&9===context.nodeType&&documentIsHTML&&Expr.relative[tokens[1].type]){if(context=(Expr.find.ID(token.matches[0].replace(runescape,funescape),context)||[])[0],!context)return results;selector=selector.slice(tokens.shift().value.length)}for(i=matchExpr.needsContext.test(selector)?0:tokens.length;i--&&(token=tokens[i],!Expr.relative[type=token.type]);)if((find=Expr.find[type])&&(seed=find(token.matches[0].replace(runescape,funescape),rsibling.test(tokens[0].type)&&context.parentNode||context))){if(tokens.splice(i,1),selector=seed.length&&toSelector(tokens),!selector)return push.apply(results,seed),results;break}}return compile(selector,match)(seed,context,!documentIsHTML,results,rsibling.test(selector)),results}var i,support,cachedruns,Expr,getText,isXML,compile,outermostContext,sortInput,setDocument,document,docElem,documentIsHTML,rbuggyQSA,rbuggyMatches,matches,contains,expando="sizzle"+-new Date,preferredDoc=window.document,dirruns=0,done=0,classCache=createCache(),tokenCache=createCache(),compilerCache=createCache(),hasDuplicate=!1,sortOrder=function(a,b){return a===b?(hasDuplicate=!0,0):0},strundefined=typeof undefined,MAX_NEGATIVE=1<<31,hasOwn={}.hasOwnProperty,arr=[],pop=arr.pop,push_native=arr.push,push=arr.push,slice=arr.slice,indexOf=arr.indexOf||function(elem){for(var i=0,len=this.length;len>i;i++)if(this[i]===elem)return i;return-1},booleans="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",whitespace="[\\x20\\t\\r\\n\\f]",characterEncoding="(?:\\\\.|[\\w-]|[^\\x00-\\xa0])+",identifier=characterEncoding.replace("w","w#"),attributes="\\["+whitespace+"*("+characterEncoding+")"+whitespace+"*(?:([*^$|!~]?=)"+whitespace+"*(?:(['\"])((?:\\\\.|[^\\\\])*?)\\3|("+identifier+")|)|)"+whitespace+"*\\]",pseudos=":("+characterEncoding+")(?:\\(((['\"])((?:\\\\.|[^\\\\])*?)\\3|((?:\\\\.|[^\\\\()[\\]]|"+attributes.replace(3,8)+")*)|.*)\\)|)",rtrim=new RegExp("^"+whitespace+"+|((?:^|[^\\\\])(?:\\\\.)*)"+whitespace+"+$","g"),rcomma=new RegExp("^"+whitespace+"*,"+whitespace+"*"),rcombinators=new RegExp("^"+whitespace+"*([>+~]|"+whitespace+")"+whitespace+"*"),rsibling=new RegExp(whitespace+"*[+~]"),rattributeQuotes=new RegExp("="+whitespace+"*([^\\]'\"]*)"+whitespace+"*\\]","g"),rpseudo=new RegExp(pseudos),ridentifier=new RegExp("^"+identifier+"$"),matchExpr={ID:new RegExp("^#("+characterEncoding+")"),CLASS:new RegExp("^\\.("+characterEncoding+")"),TAG:new RegExp("^("+characterEncoding.replace("w","w*")+")"),ATTR:new RegExp("^"+attributes),PSEUDO:new RegExp("^"+pseudos),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+whitespace+"*(even|odd|(([+-]|)(\\d*)n|)"+whitespace+"*(?:([+-]|)"+whitespace+"*(\\d+)|))"+whitespace+"*\\)|)","i"),bool:new RegExp("^(?:"+booleans+")$","i"),needsContext:new RegExp("^"+whitespace+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+whitespace+"*((?:-\\d)?\\d*)"+whitespace+"*\\)|)(?=[^-]|$)","i")},rnative=/^[^{]+\{\s*\[native \w/,rquickExpr=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,rinputs=/^(?:input|select|textarea|button)$/i,rheader=/^h\d$/i,rescape=/'|\\/g,runescape=new RegExp("\\\\([\\da-f]{1,6}"+whitespace+"?|("+whitespace+")|.)","ig"),funescape=function(_,escaped,escapedWhitespace){var high="0x"+escaped-65536;return high!==high||escapedWhitespace?escaped:0>high?String.fromCharCode(high+65536):String.fromCharCode(high>>10|55296,1023&high|56320)};try{push.apply(arr=slice.call(preferredDoc.childNodes),preferredDoc.childNodes),arr[preferredDoc.childNodes.length].nodeType}catch(e){push={apply:arr.length?function(target,els){push_native.apply(target,slice.call(els))}:function(target,els){for(var j=target.length,i=0;target[j++]=els[i++];);target.length=j-1}}}isXML=Sizzle.isXML=function(elem){var documentElement=elem&&(elem.ownerDocument||elem).documentElement;return documentElement?"HTML"!==documentElement.nodeName:!1},support=Sizzle.support={},setDocument=Sizzle.setDocument=function(node){var doc=node?node.ownerDocument||node:preferredDoc,parent=doc.defaultView;return doc!==document&&9===doc.nodeType&&doc.documentElement?(document=doc,docElem=doc.documentElement,documentIsHTML=!isXML(doc),parent&&parent.attachEvent&&parent!==parent.top&&parent.attachEvent("onbeforeunload",function(){setDocument()}),support.attributes=assert(function(div){return div.className="i",!div.getAttribute("className")}),support.getElementsByTagName=assert(function(div){return div.appendChild(doc.createComment("")),!div.getElementsByTagName("*").length}),support.getElementsByClassName=assert(function(div){return div.innerHTML="<div class='a'></div><div class='a i'></div>",div.firstChild.className="i",2===div.getElementsByClassName("i").length}),support.getById=assert(function(div){return docElem.appendChild(div).id=expando,!doc.getElementsByName||!doc.getElementsByName(expando).length}),support.getById?(Expr.find.ID=function(id,context){if(typeof context.getElementById!==strundefined&&documentIsHTML){var m=context.getElementById(id);return m&&m.parentNode?[m]:[]}},Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){return elem.getAttribute("id")===attrId}}):(delete Expr.find.ID,Expr.filter.ID=function(id){var attrId=id.replace(runescape,funescape);return function(elem){var node=typeof elem.getAttributeNode!==strundefined&&elem.getAttributeNode("id");return node&&node.value===attrId}}),Expr.find.TAG=support.getElementsByTagName?function(tag,context){return typeof context.getElementsByTagName!==strundefined?context.getElementsByTagName(tag):void 0}:function(tag,context){var elem,tmp=[],i=0,results=context.getElementsByTagName(tag);if("*"===tag){for(;elem=results[i++];)1===elem.nodeType&&tmp.push(elem);return tmp}return results},Expr.find.CLASS=support.getElementsByClassName&&function(className,context){return typeof context.getElementsByClassName!==strundefined&&documentIsHTML?context.getElementsByClassName(className):void 0},rbuggyMatches=[],rbuggyQSA=[],(support.qsa=rnative.test(doc.querySelectorAll))&&(assert(function(div){div.innerHTML="<select><option selected=''></option></select>",div.querySelectorAll("[selected]").length||rbuggyQSA.push("\\["+whitespace+"*(?:value|"+booleans+")"),div.querySelectorAll(":checked").length||rbuggyQSA.push(":checked")}),assert(function(div){var input=doc.createElement("input");input.setAttribute("type","hidden"),div.appendChild(input).setAttribute("t",""),div.querySelectorAll("[t^='']").length&&rbuggyQSA.push("[*^$]="+whitespace+"*(?:''|\"\")"),div.querySelectorAll(":enabled").length||rbuggyQSA.push(":enabled",":disabled"),div.querySelectorAll("*,:x"),rbuggyQSA.push(",.*:")})),(support.matchesSelector=rnative.test(matches=docElem.webkitMatchesSelector||docElem.mozMatchesSelector||docElem.oMatchesSelector||docElem.msMatchesSelector))&&assert(function(div){support.disconnectedMatch=matches.call(div,"div"),matches.call(div,"[s!='']:x"),rbuggyMatches.push("!=",pseudos)}),rbuggyQSA=rbuggyQSA.length&&new RegExp(rbuggyQSA.join("|")),rbuggyMatches=rbuggyMatches.length&&new RegExp(rbuggyMatches.join("|")),contains=rnative.test(docElem.contains)||docElem.compareDocumentPosition?function(a,b){var adown=9===a.nodeType?a.documentElement:a,bup=b&&b.parentNode;return a===bup||!(!bup||1!==bup.nodeType||!(adown.contains?adown.contains(bup):a.compareDocumentPosition&&16&a.compareDocumentPosition(bup)))}:function(a,b){if(b)for(;b=b.parentNode;)if(b===a)return!0;return!1},sortOrder=docElem.compareDocumentPosition?function(a,b){if(a===b)return hasDuplicate=!0,0;var compare=b.compareDocumentPosition&&a.compareDocumentPosition&&a.compareDocumentPosition(b);return compare?1&compare||!support.sortDetached&&b.compareDocumentPosition(a)===compare?a===doc||contains(preferredDoc,a)?-1:b===doc||contains(preferredDoc,b)?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0:4&compare?-1:1:a.compareDocumentPosition?-1:1}:function(a,b){var cur,i=0,aup=a.parentNode,bup=b.parentNode,ap=[a],bp=[b];if(a===b)return hasDuplicate=!0,0;if(!aup||!bup)return a===doc?-1:b===doc?1:aup?-1:bup?1:sortInput?indexOf.call(sortInput,a)-indexOf.call(sortInput,b):0;if(aup===bup)return siblingCheck(a,b);for(cur=a;cur=cur.parentNode;)ap.unshift(cur);for(cur=b;cur=cur.parentNode;)bp.unshift(cur);for(;ap[i]===bp[i];)i++;return i?siblingCheck(ap[i],bp[i]):ap[i]===preferredDoc?-1:bp[i]===preferredDoc?1:0},doc):document},Sizzle.matches=function(expr,elements){return Sizzle(expr,null,null,elements)},Sizzle.matchesSelector=function(elem,expr){if((elem.ownerDocument||elem)!==document&&setDocument(elem),expr=expr.replace(rattributeQuotes,"='$1']"),support.matchesSelector&&documentIsHTML&&(!rbuggyMatches||!rbuggyMatches.test(expr))&&(!rbuggyQSA||!rbuggyQSA.test(expr)))try{var ret=matches.call(elem,expr);if(ret||support.disconnectedMatch||elem.document&&11!==elem.document.nodeType)return ret}catch(e){}return Sizzle(expr,document,null,[elem]).length>0},Sizzle.contains=function(context,elem){return(context.ownerDocument||context)!==document&&setDocument(context),contains(context,elem)},Sizzle.attr=function(elem,name){(elem.ownerDocument||elem)!==document&&setDocument(elem);var fn=Expr.attrHandle[name.toLowerCase()],val=fn&&hasOwn.call(Expr.attrHandle,name.toLowerCase())?fn(elem,name,!documentIsHTML):undefined;return val===undefined?support.attributes||!documentIsHTML?elem.getAttribute(name):(val=elem.getAttributeNode(name))&&val.specified?val.value:null:val},Sizzle.error=function(msg){throw new Error("Syntax error, unrecognized expression: "+msg)},Sizzle.uniqueSort=function(results){var elem,duplicates=[],j=0,i=0;if(hasDuplicate=!support.detectDuplicates,sortInput=!support.sortStable&&results.slice(0),results.sort(sortOrder),hasDuplicate){for(;elem=results[i++];)elem===results[i]&&(j=duplicates.push(i));for(;j--;)results.splice(duplicates[j],1)}return results},getText=Sizzle.getText=function(elem){var node,ret="",i=0,nodeType=elem.nodeType;if(nodeType){if(1===nodeType||9===nodeType||11===nodeType){if("string"==typeof elem.textContent)return elem.textContent;for(elem=elem.firstChild;elem;elem=elem.nextSibling)ret+=getText(elem)}else if(3===nodeType||4===nodeType)return elem.nodeValue}else for(;node=elem[i];i++)ret+=getText(node);return ret},Expr=Sizzle.selectors={cacheLength:50,createPseudo:markFunction,match:matchExpr,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(match){return match[1]=match[1].replace(runescape,funescape),match[3]=(match[4]||match[5]||"").replace(runescape,funescape),"~="===match[2]&&(match[3]=" "+match[3]+" "),match.slice(0,4)},CHILD:function(match){return match[1]=match[1].toLowerCase(),"nth"===match[1].slice(0,3)?(match[3]||Sizzle.error(match[0]),match[4]=+(match[4]?match[5]+(match[6]||1):2*("even"===match[3]||"odd"===match[3])),match[5]=+(match[7]+match[8]||"odd"===match[3])):match[3]&&Sizzle.error(match[0]),match},PSEUDO:function(match){var excess,unquoted=!match[5]&&match[2];return matchExpr.CHILD.test(match[0])?null:(match[3]&&match[4]!==undefined?match[2]=match[4]:unquoted&&rpseudo.test(unquoted)&&(excess=tokenize(unquoted,!0))&&(excess=unquoted.indexOf(")",unquoted.length-excess)-unquoted.length)&&(match[0]=match[0].slice(0,excess),match[2]=unquoted.slice(0,excess)),match.slice(0,3))}},filter:{TAG:function(nodeNameSelector){var nodeName=nodeNameSelector.replace(runescape,funescape).toLowerCase();return"*"===nodeNameSelector?function(){return!0}:function(elem){return elem.nodeName&&elem.nodeName.toLowerCase()===nodeName}},CLASS:function(className){var pattern=classCache[className+" "];return pattern||(pattern=new RegExp("(^|"+whitespace+")"+className+"("+whitespace+"|$)"))&&classCache(className,function(elem){return pattern.test("string"==typeof elem.className&&elem.className||typeof elem.getAttribute!==strundefined&&elem.getAttribute("class")||"")})},ATTR:function(name,operator,check){return function(elem){var result=Sizzle.attr(elem,name);return null==result?"!="===operator:operator?(result+="","="===operator?result===check:"!="===operator?result!==check:"^="===operator?check&&0===result.indexOf(check):"*="===operator?check&&result.indexOf(check)>-1:"$="===operator?check&&result.slice(-check.length)===check:"~="===operator?(" "+result+" ").indexOf(check)>-1:"|="===operator?result===check||result.slice(0,check.length+1)===check+"-":!1):!0}},CHILD:function(type,what,argument,first,last){var simple="nth"!==type.slice(0,3),forward="last"!==type.slice(-4),ofType="of-type"===what;return 1===first&&0===last?function(elem){return!!elem.parentNode}:function(elem,context,xml){var cache,outerCache,node,diff,nodeIndex,start,dir=simple!==forward?"nextSibling":"previousSibling",parent=elem.parentNode,name=ofType&&elem.nodeName.toLowerCase(),useCache=!xml&&!ofType;if(parent){if(simple){for(;dir;){for(node=elem;node=node[dir];)if(ofType?node.nodeName.toLowerCase()===name:1===node.nodeType)return!1;start=dir="only"===type&&!start&&"nextSibling"}return!0}if(start=[forward?parent.firstChild:parent.lastChild],forward&&useCache){for(outerCache=parent[expando]||(parent[expando]={}),cache=outerCache[type]||[],nodeIndex=cache[0]===dirruns&&cache[1],diff=cache[0]===dirruns&&cache[2],node=nodeIndex&&parent.childNodes[nodeIndex];node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop();)if(1===node.nodeType&&++diff&&node===elem){outerCache[type]=[dirruns,nodeIndex,diff];break}}else if(useCache&&(cache=(elem[expando]||(elem[expando]={}))[type])&&cache[0]===dirruns)diff=cache[1];else for(;(node=++nodeIndex&&node&&node[dir]||(diff=nodeIndex=0)||start.pop())&&((ofType?node.nodeName.toLowerCase()!==name:1!==node.nodeType)||!++diff||(useCache&&((node[expando]||(node[expando]={}))[type]=[dirruns,diff]),node!==elem)););return diff-=last,diff===first||diff%first===0&&diff/first>=0}}},PSEUDO:function(pseudo,argument){var args,fn=Expr.pseudos[pseudo]||Expr.setFilters[pseudo.toLowerCase()]||Sizzle.error("unsupported pseudo: "+pseudo);return fn[expando]?fn(argument):fn.length>1?(args=[pseudo,pseudo,"",argument],Expr.setFilters.hasOwnProperty(pseudo.toLowerCase())?markFunction(function(seed,matches){for(var idx,matched=fn(seed,argument),i=matched.length;i--;)idx=indexOf.call(seed,matched[i]),seed[idx]=!(matches[idx]=matched[i])}):function(elem){return fn(elem,0,args)}):fn}},pseudos:{not:markFunction(function(selector){var input=[],results=[],matcher=compile(selector.replace(rtrim,"$1"));return matcher[expando]?markFunction(function(seed,matches,context,xml){for(var elem,unmatched=matcher(seed,null,xml,[]),i=seed.length;i--;)(elem=unmatched[i])&&(seed[i]=!(matches[i]=elem))}):function(elem,context,xml){return input[0]=elem,matcher(input,null,xml,results),!results.pop()}}),has:markFunction(function(selector){return function(elem){return Sizzle(selector,elem).length>0}}),contains:markFunction(function(text){return function(elem){return(elem.textContent||elem.innerText||getText(elem)).indexOf(text)>-1}}),lang:markFunction(function(lang){return ridentifier.test(lang||"")||Sizzle.error("unsupported lang: "+lang),lang=lang.replace(runescape,funescape).toLowerCase(),function(elem){var elemLang;do if(elemLang=documentIsHTML?elem.lang:elem.getAttribute("xml:lang")||elem.getAttribute("lang"))return elemLang=elemLang.toLowerCase(),elemLang===lang||0===elemLang.indexOf(lang+"-");while((elem=elem.parentNode)&&1===elem.nodeType);return!1}}),target:function(elem){var hash=window.location&&window.location.hash;return hash&&hash.slice(1)===elem.id},root:function(elem){return elem===docElem},focus:function(elem){return elem===document.activeElement&&(!document.hasFocus||document.hasFocus())&&!!(elem.type||elem.href||~elem.tabIndex)},enabled:function(elem){return elem.disabled===!1},disabled:function(elem){return elem.disabled===!0},checked:function(elem){var nodeName=elem.nodeName.toLowerCase();return"input"===nodeName&&!!elem.checked||"option"===nodeName&&!!elem.selected},selected:function(elem){return elem.parentNode&&elem.parentNode.selectedIndex,elem.selected===!0},empty:function(elem){for(elem=elem.firstChild;elem;elem=elem.nextSibling)if(elem.nodeName>"@"||3===elem.nodeType||4===elem.nodeType)return!1;return!0},parent:function(elem){return!Expr.pseudos.empty(elem)},header:function(elem){return rheader.test(elem.nodeName)},input:function(elem){return rinputs.test(elem.nodeName)},button:function(elem){var name=elem.nodeName.toLowerCase();return"input"===name&&"button"===elem.type||"button"===name},text:function(elem){var attr;return"input"===elem.nodeName.toLowerCase()&&"text"===elem.type&&(null==(attr=elem.getAttribute("type"))||attr.toLowerCase()===elem.type)},first:createPositionalPseudo(function(){return[0]}),last:createPositionalPseudo(function(matchIndexes,length){return[length-1]}),eq:createPositionalPseudo(function(matchIndexes,length,argument){return[0>argument?argument+length:argument]}),even:createPositionalPseudo(function(matchIndexes,length){for(var i=0;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),odd:createPositionalPseudo(function(matchIndexes,length){for(var i=1;length>i;i+=2)matchIndexes.push(i);return matchIndexes}),lt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;--i>=0;)matchIndexes.push(i);return matchIndexes}),gt:createPositionalPseudo(function(matchIndexes,length,argument){for(var i=0>argument?argument+length:argument;++i<length;)matchIndexes.push(i);return matchIndexes})}},Expr.pseudos.nth=Expr.pseudos.eq;for(i in{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})Expr.pseudos[i]=createInputPseudo(i);for(i in{submit:!0,reset:!0})Expr.pseudos[i]=createButtonPseudo(i);setFilters.prototype=Expr.filters=Expr.pseudos,Expr.setFilters=new setFilters,compile=Sizzle.compile=function(selector,group){var i,setMatchers=[],elementMatchers=[],cached=compilerCache[selector+" "];if(!cached){for(group||(group=tokenize(selector)),i=group.length;i--;)cached=matcherFromTokens(group[i]),cached[expando]?setMatchers.push(cached):elementMatchers.push(cached);cached=compilerCache(selector,matcherFromGroupMatchers(elementMatchers,setMatchers))}return cached},support.sortStable=expando.split("").sort(sortOrder).join("")===expando,support.detectDuplicates=hasDuplicate,setDocument(),support.sortDetached=assert(function(div1){return 1&div1.compareDocumentPosition(document.createElement("div"))}),assert(function(div){return div.innerHTML="<a href='#'></a>","#"===div.firstChild.getAttribute("href")})||addHandle("type|href|height|width",function(elem,name,isXML){return isXML?void 0:elem.getAttribute(name,"type"===name.toLowerCase()?1:2)}),support.attributes&&assert(function(div){return div.innerHTML="<input/>",div.firstChild.setAttribute("value",""),""===div.firstChild.getAttribute("value")})||addHandle("value",function(elem,name,isXML){return isXML||"input"!==elem.nodeName.toLowerCase()?void 0:elem.defaultValue}),assert(function(div){return null==div.getAttribute("disabled")})||addHandle(booleans,function(elem,name,isXML){var val;return isXML?void 0:(val=elem.getAttributeNode(name))&&val.specified?val.value:elem[name]===!0?name.toLowerCase():null}),jQuery.find=Sizzle,jQuery.expr=Sizzle.selectors,jQuery.expr[":"]=jQuery.expr.pseudos,jQuery.unique=Sizzle.uniqueSort,jQuery.text=Sizzle.getText,jQuery.isXMLDoc=Sizzle.isXML,jQuery.contains=Sizzle.contains}(window);var optionsCache={};jQuery.Callbacks=function(options){options="string"==typeof options?optionsCache[options]||createOptions(options):jQuery.extend({},options);var memory,fired,firing,firingStart,firingLength,firingIndex,list=[],stack=!options.once&&[],fire=function(data){for(memory=options.memory&&data,fired=!0,firingIndex=firingStart||0,firingStart=0,firingLength=list.length,firing=!0;list&&firingLength>firingIndex;firingIndex++)if(list[firingIndex].apply(data[0],data[1])===!1&&options.stopOnFalse){memory=!1;break}firing=!1,list&&(stack?stack.length&&fire(stack.shift()):memory?list=[]:self.disable())},self={add:function(){if(list){var start=list.length;!function add(args){jQuery.each(args,function(_,arg){var type=jQuery.type(arg);"function"===type?options.unique&&self.has(arg)||list.push(arg):arg&&arg.length&&"string"!==type&&add(arg)})}(arguments),firing?firingLength=list.length:memory&&(firingStart=start,fire(memory))}return this},remove:function(){return list&&jQuery.each(arguments,function(_,arg){for(var index;(index=jQuery.inArray(arg,list,index))>-1;)list.splice(index,1),firing&&(firingLength>=index&&firingLength--,firingIndex>=index&&firingIndex--)}),this},has:function(fn){return fn?jQuery.inArray(fn,list)>-1:!(!list||!list.length)},empty:function(){return list=[],firingLength=0,this},disable:function(){return list=stack=memory=undefined,this},disabled:function(){return!list},lock:function(){return stack=undefined,memory||self.disable(),this},locked:function(){return!stack},fireWith:function(context,args){return!list||fired&&!stack||(args=args||[],args=[context,args.slice?args.slice():args],firing?stack.push(args):fire(args)),this},fire:function(){return self.fireWith(this,arguments),this},fired:function(){return!!fired}};return self},jQuery.extend({Deferred:function(func){var tuples=[["resolve","done",jQuery.Callbacks("once memory"),"resolved"],["reject","fail",jQuery.Callbacks("once memory"),"rejected"],["notify","progress",jQuery.Callbacks("memory")]],state="pending",promise={state:function(){return state},always:function(){return deferred.done(arguments).fail(arguments),this},then:function(){var fns=arguments;return jQuery.Deferred(function(newDefer){jQuery.each(tuples,function(i,tuple){var action=tuple[0],fn=jQuery.isFunction(fns[i])&&fns[i];deferred[tuple[1]](function(){var returned=fn&&fn.apply(this,arguments);returned&&jQuery.isFunction(returned.promise)?returned.promise().done(newDefer.resolve).fail(newDefer.reject).progress(newDefer.notify):newDefer[action+"With"](this===promise?newDefer.promise():this,fn?[returned]:arguments)})}),fns=null}).promise()},promise:function(obj){return null!=obj?jQuery.extend(obj,promise):promise}},deferred={};return promise.pipe=promise.then,jQuery.each(tuples,function(i,tuple){var list=tuple[2],stateString=tuple[3];promise[tuple[1]]=list.add,stateString&&list.add(function(){state=stateString},tuples[1^i][2].disable,tuples[2][2].lock),deferred[tuple[0]]=function(){return deferred[tuple[0]+"With"](this===deferred?promise:this,arguments),this},deferred[tuple[0]+"With"]=list.fireWith}),promise.promise(deferred),func&&func.call(deferred,deferred),deferred},when:function(subordinate){var progressValues,progressContexts,resolveContexts,i=0,resolveValues=core_slice.call(arguments),length=resolveValues.length,remaining=1!==length||subordinate&&jQuery.isFunction(subordinate.promise)?length:0,deferred=1===remaining?subordinate:jQuery.Deferred(),updateFunc=function(i,contexts,values){return function(value){contexts[i]=this,values[i]=arguments.length>1?core_slice.call(arguments):value,values===progressValues?deferred.notifyWith(contexts,values):--remaining||deferred.resolveWith(contexts,values)}};if(length>1)for(progressValues=new Array(length),progressContexts=new Array(length),resolveContexts=new Array(length);length>i;i++)resolveValues[i]&&jQuery.isFunction(resolveValues[i].promise)?resolveValues[i].promise().done(updateFunc(i,resolveContexts,resolveValues)).fail(deferred.reject).progress(updateFunc(i,progressContexts,progressValues)):--remaining;
return remaining||deferred.resolveWith(resolveContexts,resolveValues),deferred.promise()}}),jQuery.support=function(support){var input=document.createElement("input"),fragment=document.createDocumentFragment(),div=document.createElement("div"),select=document.createElement("select"),opt=select.appendChild(document.createElement("option"));return input.type?(input.type="checkbox",support.checkOn=""!==input.value,support.optSelected=opt.selected,support.reliableMarginRight=!0,support.boxSizingReliable=!0,support.pixelPosition=!1,input.checked=!0,support.noCloneChecked=input.cloneNode(!0).checked,select.disabled=!0,support.optDisabled=!opt.disabled,input=document.createElement("input"),input.value="t",input.type="radio",support.radioValue="t"===input.value,input.setAttribute("checked","t"),input.setAttribute("name","t"),fragment.appendChild(input),support.checkClone=fragment.cloneNode(!0).cloneNode(!0).lastChild.checked,support.focusinBubbles="onfocusin"in window,div.style.backgroundClip="content-box",div.cloneNode(!0).style.backgroundClip="",support.clearCloneStyle="content-box"===div.style.backgroundClip,jQuery(function(){var container,marginDiv,divReset="padding:0;margin:0;border:0;display:block;-webkit-box-sizing:content-box;-moz-box-sizing:content-box;box-sizing:content-box",body=document.getElementsByTagName("body")[0];body&&(container=document.createElement("div"),container.style.cssText="border:0;width:0;height:0;position:absolute;top:0;left:-9999px;margin-top:1px",body.appendChild(container).appendChild(div),div.innerHTML="",div.style.cssText="-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;padding:1px;border:1px;display:block;width:4px;margin-top:1%;position:absolute;top:1%",jQuery.swap(body,null!=body.style.zoom?{zoom:1}:{},function(){support.boxSizing=4===div.offsetWidth}),window.getComputedStyle&&(support.pixelPosition="1%"!==(window.getComputedStyle(div,null)||{}).top,support.boxSizingReliable="4px"===(window.getComputedStyle(div,null)||{width:"4px"}).width,marginDiv=div.appendChild(document.createElement("div")),marginDiv.style.cssText=div.style.cssText=divReset,marginDiv.style.marginRight=marginDiv.style.width="0",div.style.width="1px",support.reliableMarginRight=!parseFloat((window.getComputedStyle(marginDiv,null)||{}).marginRight)),body.removeChild(container))}),support):support}({});var data_user,data_priv,rbrace=/(?:\{[\s\S]*\}|\[[\s\S]*\])$/,rmultiDash=/([A-Z])/g;Data.uid=1,Data.accepts=function(owner){return owner.nodeType?1===owner.nodeType||9===owner.nodeType:!0},Data.prototype={key:function(owner){if(!Data.accepts(owner))return 0;var descriptor={},unlock=owner[this.expando];if(!unlock){unlock=Data.uid++;try{descriptor[this.expando]={value:unlock},Object.defineProperties(owner,descriptor)}catch(e){descriptor[this.expando]=unlock,jQuery.extend(owner,descriptor)}}return this.cache[unlock]||(this.cache[unlock]={}),unlock},set:function(owner,data,value){var prop,unlock=this.key(owner),cache=this.cache[unlock];if("string"==typeof data)cache[data]=value;else if(jQuery.isEmptyObject(cache))jQuery.extend(this.cache[unlock],data);else for(prop in data)cache[prop]=data[prop];return cache},get:function(owner,key){var cache=this.cache[this.key(owner)];return key===undefined?cache:cache[key]},access:function(owner,key,value){var stored;return key===undefined||key&&"string"==typeof key&&value===undefined?(stored=this.get(owner,key),stored!==undefined?stored:this.get(owner,jQuery.camelCase(key))):(this.set(owner,key,value),value!==undefined?value:key)},remove:function(owner,key){var i,name,camel,unlock=this.key(owner),cache=this.cache[unlock];if(key===undefined)this.cache[unlock]={};else{jQuery.isArray(key)?name=key.concat(key.map(jQuery.camelCase)):(camel=jQuery.camelCase(key),key in cache?name=[key,camel]:(name=camel,name=name in cache?[name]:name.match(core_rnotwhite)||[])),i=name.length;for(;i--;)delete cache[name[i]]}},hasData:function(owner){return!jQuery.isEmptyObject(this.cache[owner[this.expando]]||{})},discard:function(owner){owner[this.expando]&&delete this.cache[owner[this.expando]]}},data_user=new Data,data_priv=new Data,jQuery.extend({acceptData:Data.accepts,hasData:function(elem){return data_user.hasData(elem)||data_priv.hasData(elem)},data:function(elem,name,data){return data_user.access(elem,name,data)},removeData:function(elem,name){data_user.remove(elem,name)},_data:function(elem,name,data){return data_priv.access(elem,name,data)},_removeData:function(elem,name){data_priv.remove(elem,name)}}),jQuery.fn.extend({data:function(key,value){var attrs,name,elem=this[0],i=0,data=null;if(key===undefined){if(this.length&&(data=data_user.get(elem),1===elem.nodeType&&!data_priv.get(elem,"hasDataAttrs"))){for(attrs=elem.attributes;i<attrs.length;i++)name=attrs[i].name,0===name.indexOf("data-")&&(name=jQuery.camelCase(name.slice(5)),dataAttr(elem,name,data[name]));data_priv.set(elem,"hasDataAttrs",!0)}return data}return"object"==typeof key?this.each(function(){data_user.set(this,key)}):jQuery.access(this,function(value){var data,camelKey=jQuery.camelCase(key);if(elem&&value===undefined){if(data=data_user.get(elem,key),data!==undefined)return data;if(data=data_user.get(elem,camelKey),data!==undefined)return data;if(data=dataAttr(elem,camelKey,undefined),data!==undefined)return data}else this.each(function(){var data=data_user.get(this,camelKey);data_user.set(this,camelKey,value),-1!==key.indexOf("-")&&data!==undefined&&data_user.set(this,key,value)})},null,value,arguments.length>1,null,!0)},removeData:function(key){return this.each(function(){data_user.remove(this,key)})}}),jQuery.extend({queue:function(elem,type,data){var queue;return elem?(type=(type||"fx")+"queue",queue=data_priv.get(elem,type),data&&(!queue||jQuery.isArray(data)?queue=data_priv.access(elem,type,jQuery.makeArray(data)):queue.push(data)),queue||[]):void 0},dequeue:function(elem,type){type=type||"fx";var queue=jQuery.queue(elem,type),startLength=queue.length,fn=queue.shift(),hooks=jQuery._queueHooks(elem,type),next=function(){jQuery.dequeue(elem,type)};"inprogress"===fn&&(fn=queue.shift(),startLength--),fn&&("fx"===type&&queue.unshift("inprogress"),delete hooks.stop,fn.call(elem,next,hooks)),!startLength&&hooks&&hooks.empty.fire()},_queueHooks:function(elem,type){var key=type+"queueHooks";return data_priv.get(elem,key)||data_priv.access(elem,key,{empty:jQuery.Callbacks("once memory").add(function(){data_priv.remove(elem,[type+"queue",key])})})}}),jQuery.fn.extend({queue:function(type,data){var setter=2;return"string"!=typeof type&&(data=type,type="fx",setter--),arguments.length<setter?jQuery.queue(this[0],type):data===undefined?this:this.each(function(){var queue=jQuery.queue(this,type,data);jQuery._queueHooks(this,type),"fx"===type&&"inprogress"!==queue[0]&&jQuery.dequeue(this,type)})},dequeue:function(type){return this.each(function(){jQuery.dequeue(this,type)})},delay:function(time,type){return time=jQuery.fx?jQuery.fx.speeds[time]||time:time,type=type||"fx",this.queue(type,function(next,hooks){var timeout=setTimeout(next,time);hooks.stop=function(){clearTimeout(timeout)}})},clearQueue:function(type){return this.queue(type||"fx",[])},promise:function(type,obj){var tmp,count=1,defer=jQuery.Deferred(),elements=this,i=this.length,resolve=function(){--count||defer.resolveWith(elements,[elements])};for("string"!=typeof type&&(obj=type,type=undefined),type=type||"fx";i--;)tmp=data_priv.get(elements[i],type+"queueHooks"),tmp&&tmp.empty&&(count++,tmp.empty.add(resolve));return resolve(),defer.promise(obj)}});var nodeHook,boolHook,rclass=/[\t\r\n\f]/g,rreturn=/\r/g,rfocusable=/^(?:input|select|textarea|button)$/i;jQuery.fn.extend({attr:function(name,value){return jQuery.access(this,jQuery.attr,name,value,arguments.length>1)},removeAttr:function(name){return this.each(function(){jQuery.removeAttr(this,name)})},prop:function(name,value){return jQuery.access(this,jQuery.prop,name,value,arguments.length>1)},removeProp:function(name){return this.each(function(){delete this[jQuery.propFix[name]||name]})},addClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed="string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).addClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(core_rnotwhite)||[];len>i;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):" ")){for(j=0;clazz=classes[j++];)cur.indexOf(" "+clazz+" ")<0&&(cur+=clazz+" ");elem.className=jQuery.trim(cur)}return this},removeClass:function(value){var classes,elem,cur,clazz,j,i=0,len=this.length,proceed=0===arguments.length||"string"==typeof value&&value;if(jQuery.isFunction(value))return this.each(function(j){jQuery(this).removeClass(value.call(this,j,this.className))});if(proceed)for(classes=(value||"").match(core_rnotwhite)||[];len>i;i++)if(elem=this[i],cur=1===elem.nodeType&&(elem.className?(" "+elem.className+" ").replace(rclass," "):"")){for(j=0;clazz=classes[j++];)for(;cur.indexOf(" "+clazz+" ")>=0;)cur=cur.replace(" "+clazz+" "," ");elem.className=value?jQuery.trim(cur):""}return this},toggleClass:function(value,stateVal){var type=typeof value;return"boolean"==typeof stateVal&&"string"===type?stateVal?this.addClass(value):this.removeClass(value):jQuery.isFunction(value)?this.each(function(i){jQuery(this).toggleClass(value.call(this,i,this.className,stateVal),stateVal)}):this.each(function(){if("string"===type)for(var className,i=0,self=jQuery(this),classNames=value.match(core_rnotwhite)||[];className=classNames[i++];)self.hasClass(className)?self.removeClass(className):self.addClass(className);else(type===core_strundefined||"boolean"===type)&&(this.className&&data_priv.set(this,"__className__",this.className),this.className=this.className||value===!1?"":data_priv.get(this,"__className__")||"")})},hasClass:function(selector){for(var className=" "+selector+" ",i=0,l=this.length;l>i;i++)if(1===this[i].nodeType&&(" "+this[i].className+" ").replace(rclass," ").indexOf(className)>=0)return!0;return!1},val:function(value){var hooks,ret,isFunction,elem=this[0];{if(arguments.length)return isFunction=jQuery.isFunction(value),this.each(function(i){var val;1===this.nodeType&&(val=isFunction?value.call(this,i,jQuery(this).val()):value,null==val?val="":"number"==typeof val?val+="":jQuery.isArray(val)&&(val=jQuery.map(val,function(value){return null==value?"":value+""})),hooks=jQuery.valHooks[this.type]||jQuery.valHooks[this.nodeName.toLowerCase()],hooks&&"set"in hooks&&hooks.set(this,val,"value")!==undefined||(this.value=val))});if(elem)return hooks=jQuery.valHooks[elem.type]||jQuery.valHooks[elem.nodeName.toLowerCase()],hooks&&"get"in hooks&&(ret=hooks.get(elem,"value"))!==undefined?ret:(ret=elem.value,"string"==typeof ret?ret.replace(rreturn,""):null==ret?"":ret)}}}),jQuery.extend({valHooks:{option:{get:function(elem){var val=elem.attributes.value;return!val||val.specified?elem.value:elem.text}},select:{get:function(elem){for(var value,option,options=elem.options,index=elem.selectedIndex,one="select-one"===elem.type||0>index,values=one?null:[],max=one?index+1:options.length,i=0>index?max:one?index:0;max>i;i++)if(option=options[i],(option.selected||i===index)&&(jQuery.support.optDisabled?!option.disabled:null===option.getAttribute("disabled"))&&(!option.parentNode.disabled||!jQuery.nodeName(option.parentNode,"optgroup"))){if(value=jQuery(option).val(),one)return value;values.push(value)}return values},set:function(elem,value){for(var optionSet,option,options=elem.options,values=jQuery.makeArray(value),i=options.length;i--;)option=options[i],(option.selected=jQuery.inArray(jQuery(option).val(),values)>=0)&&(optionSet=!0);return optionSet||(elem.selectedIndex=-1),values}}},attr:function(elem,name,value){var hooks,ret,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return typeof elem.getAttribute===core_strundefined?jQuery.prop(elem,name,value):(1===nType&&jQuery.isXMLDoc(elem)||(name=name.toLowerCase(),hooks=jQuery.attrHooks[name]||(jQuery.expr.match.bool.test(name)?boolHook:nodeHook)),value===undefined?hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:(ret=jQuery.find.attr(elem,name),null==ret?undefined:ret):null!==value?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:(elem.setAttribute(name,value+""),value):void jQuery.removeAttr(elem,name))},removeAttr:function(elem,value){var name,propName,i=0,attrNames=value&&value.match(core_rnotwhite);if(attrNames&&1===elem.nodeType)for(;name=attrNames[i++];)propName=jQuery.propFix[name]||name,jQuery.expr.match.bool.test(name)&&(elem[propName]=!1),elem.removeAttribute(name)},attrHooks:{type:{set:function(elem,value){if(!jQuery.support.radioValue&&"radio"===value&&jQuery.nodeName(elem,"input")){var val=elem.value;return elem.setAttribute("type",value),val&&(elem.value=val),value}}}},propFix:{"for":"htmlFor","class":"className"},prop:function(elem,name,value){var ret,hooks,notxml,nType=elem.nodeType;if(elem&&3!==nType&&8!==nType&&2!==nType)return notxml=1!==nType||!jQuery.isXMLDoc(elem),notxml&&(name=jQuery.propFix[name]||name,hooks=jQuery.propHooks[name]),value!==undefined?hooks&&"set"in hooks&&(ret=hooks.set(elem,value,name))!==undefined?ret:elem[name]=value:hooks&&"get"in hooks&&null!==(ret=hooks.get(elem,name))?ret:elem[name]},propHooks:{tabIndex:{get:function(elem){return elem.hasAttribute("tabindex")||rfocusable.test(elem.nodeName)||elem.href?elem.tabIndex:-1}}}}),boolHook={set:function(elem,value,name){return value===!1?jQuery.removeAttr(elem,name):elem.setAttribute(name,name),name}},jQuery.each(jQuery.expr.match.bool.source.match(/\w+/g),function(i,name){var getter=jQuery.expr.attrHandle[name]||jQuery.find.attr;jQuery.expr.attrHandle[name]=function(elem,name,isXML){var fn=jQuery.expr.attrHandle[name],ret=isXML?undefined:(jQuery.expr.attrHandle[name]=undefined)!=getter(elem,name,isXML)?name.toLowerCase():null;return jQuery.expr.attrHandle[name]=fn,ret}}),jQuery.support.optSelected||(jQuery.propHooks.selected={get:function(elem){var parent=elem.parentNode;return parent&&parent.parentNode&&parent.parentNode.selectedIndex,null}}),jQuery.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){jQuery.propFix[this.toLowerCase()]=this}),jQuery.each(["radio","checkbox"],function(){jQuery.valHooks[this]={set:function(elem,value){return jQuery.isArray(value)?elem.checked=jQuery.inArray(jQuery(elem).val(),value)>=0:void 0}},jQuery.support.checkOn||(jQuery.valHooks[this].get=function(elem){return null===elem.getAttribute("value")?"on":elem.value})});var rkeyEvent=/^key/,rmouseEvent=/^(?:mouse|contextmenu)|click/,rfocusMorph=/^(?:focusinfocus|focusoutblur)$/,rtypenamespace=/^([^.]*)(?:\.(.+)|)$/;jQuery.event={global:{},add:function(elem,types,handler,data,selector){var handleObjIn,eventHandle,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.get(elem);if(elemData){for(handler.handler&&(handleObjIn=handler,handler=handleObjIn.handler,selector=handleObjIn.selector),handler.guid||(handler.guid=jQuery.guid++),(events=elemData.events)||(events=elemData.events={}),(eventHandle=elemData.handle)||(eventHandle=elemData.handle=function(e){return typeof jQuery===core_strundefined||e&&jQuery.event.triggered===e.type?undefined:jQuery.event.dispatch.apply(eventHandle.elem,arguments)},eventHandle.elem=elem),types=(types||"").match(core_rnotwhite)||[""],t=types.length;t--;)tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type&&(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,special=jQuery.event.special[type]||{},handleObj=jQuery.extend({type:type,origType:origType,data:data,handler:handler,guid:handler.guid,selector:selector,needsContext:selector&&jQuery.expr.match.needsContext.test(selector),namespace:namespaces.join(".")},handleObjIn),(handlers=events[type])||(handlers=events[type]=[],handlers.delegateCount=0,special.setup&&special.setup.call(elem,data,namespaces,eventHandle)!==!1||elem.addEventListener&&elem.addEventListener(type,eventHandle,!1)),special.add&&(special.add.call(elem,handleObj),handleObj.handler.guid||(handleObj.handler.guid=handler.guid)),selector?handlers.splice(handlers.delegateCount++,0,handleObj):handlers.push(handleObj),jQuery.event.global[type]=!0);elem=null}},remove:function(elem,types,handler,selector,mappedTypes){var j,origCount,tmp,events,t,handleObj,special,handlers,type,namespaces,origType,elemData=data_priv.hasData(elem)&&data_priv.get(elem);if(elemData&&(events=elemData.events)){for(types=(types||"").match(core_rnotwhite)||[""],t=types.length;t--;)if(tmp=rtypenamespace.exec(types[t])||[],type=origType=tmp[1],namespaces=(tmp[2]||"").split(".").sort(),type){for(special=jQuery.event.special[type]||{},type=(selector?special.delegateType:special.bindType)||type,handlers=events[type]||[],tmp=tmp[2]&&new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"),origCount=j=handlers.length;j--;)handleObj=handlers[j],!mappedTypes&&origType!==handleObj.origType||handler&&handler.guid!==handleObj.guid||tmp&&!tmp.test(handleObj.namespace)||selector&&selector!==handleObj.selector&&("**"!==selector||!handleObj.selector)||(handlers.splice(j,1),handleObj.selector&&handlers.delegateCount--,special.remove&&special.remove.call(elem,handleObj));origCount&&!handlers.length&&(special.teardown&&special.teardown.call(elem,namespaces,elemData.handle)!==!1||jQuery.removeEvent(elem,type,elemData.handle),delete events[type])}else for(type in events)jQuery.event.remove(elem,type+types[t],handler,selector,!0);jQuery.isEmptyObject(events)&&(delete elemData.handle,data_priv.remove(elem,"events"))}},trigger:function(event,data,elem,onlyHandlers){var i,cur,tmp,bubbleType,ontype,handle,special,eventPath=[elem||document],type=core_hasOwn.call(event,"type")?event.type:event,namespaces=core_hasOwn.call(event,"namespace")?event.namespace.split("."):[];if(cur=tmp=elem=elem||document,3!==elem.nodeType&&8!==elem.nodeType&&!rfocusMorph.test(type+jQuery.event.triggered)&&(type.indexOf(".")>=0&&(namespaces=type.split("."),type=namespaces.shift(),namespaces.sort()),ontype=type.indexOf(":")<0&&"on"+type,event=event[jQuery.expando]?event:new jQuery.Event(type,"object"==typeof event&&event),event.isTrigger=onlyHandlers?2:3,event.namespace=namespaces.join("."),event.namespace_re=event.namespace?new RegExp("(^|\\.)"+namespaces.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,event.result=undefined,event.target||(event.target=elem),data=null==data?[event]:jQuery.makeArray(data,[event]),special=jQuery.event.special[type]||{},onlyHandlers||!special.trigger||special.trigger.apply(elem,data)!==!1)){if(!onlyHandlers&&!special.noBubble&&!jQuery.isWindow(elem)){for(bubbleType=special.delegateType||type,rfocusMorph.test(bubbleType+type)||(cur=cur.parentNode);cur;cur=cur.parentNode)eventPath.push(cur),tmp=cur;tmp===(elem.ownerDocument||document)&&eventPath.push(tmp.defaultView||tmp.parentWindow||window)}for(i=0;(cur=eventPath[i++])&&!event.isPropagationStopped();)event.type=i>1?bubbleType:special.bindType||type,handle=(data_priv.get(cur,"events")||{})[event.type]&&data_priv.get(cur,"handle"),handle&&handle.apply(cur,data),handle=ontype&&cur[ontype],handle&&jQuery.acceptData(cur)&&handle.apply&&handle.apply(cur,data)===!1&&event.preventDefault();return event.type=type,onlyHandlers||event.isDefaultPrevented()||special._default&&special._default.apply(eventPath.pop(),data)!==!1||!jQuery.acceptData(elem)||ontype&&jQuery.isFunction(elem[type])&&!jQuery.isWindow(elem)&&(tmp=elem[ontype],tmp&&(elem[ontype]=null),jQuery.event.triggered=type,elem[type](),jQuery.event.triggered=undefined,tmp&&(elem[ontype]=tmp)),event.result}},dispatch:function(event){event=jQuery.event.fix(event);var i,j,ret,matched,handleObj,handlerQueue=[],args=core_slice.call(arguments),handlers=(data_priv.get(this,"events")||{})[event.type]||[],special=jQuery.event.special[event.type]||{};if(args[0]=event,event.delegateTarget=this,!special.preDispatch||special.preDispatch.call(this,event)!==!1){for(handlerQueue=jQuery.event.handlers.call(this,event,handlers),i=0;(matched=handlerQueue[i++])&&!event.isPropagationStopped();)for(event.currentTarget=matched.elem,j=0;(handleObj=matched.handlers[j++])&&!event.isImmediatePropagationStopped();)(!event.namespace_re||event.namespace_re.test(handleObj.namespace))&&(event.handleObj=handleObj,event.data=handleObj.data,ret=((jQuery.event.special[handleObj.origType]||{}).handle||handleObj.handler).apply(matched.elem,args),ret!==undefined&&(event.result=ret)===!1&&(event.preventDefault(),event.stopPropagation()));return special.postDispatch&&special.postDispatch.call(this,event),event.result}},handlers:function(event,handlers){var i,matches,sel,handleObj,handlerQueue=[],delegateCount=handlers.delegateCount,cur=event.target;if(delegateCount&&cur.nodeType&&(!event.button||"click"!==event.type))for(;cur!==this;cur=cur.parentNode||this)if(cur.disabled!==!0||"click"!==event.type){for(matches=[],i=0;delegateCount>i;i++)handleObj=handlers[i],sel=handleObj.selector+" ",matches[sel]===undefined&&(matches[sel]=handleObj.needsContext?jQuery(sel,this).index(cur)>=0:jQuery.find(sel,this,null,[cur]).length),matches[sel]&&matches.push(handleObj);matches.length&&handlerQueue.push({elem:cur,handlers:matches})}return delegateCount<handlers.length&&handlerQueue.push({elem:this,handlers:handlers.slice(delegateCount)}),handlerQueue},props:"altKey bubbles cancelable ctrlKey currentTarget eventPhase metaKey relatedTarget shiftKey target timeStamp view which".split(" "),fixHooks:{},keyHooks:{props:"char charCode key keyCode".split(" "),filter:function(event,original){return null==event.which&&(event.which=null!=original.charCode?original.charCode:original.keyCode),event}},mouseHooks:{props:"button buttons clientX clientY offsetX offsetY pageX pageY screenX screenY toElement".split(" "),filter:function(event,original){var eventDoc,doc,body,button=original.button;return null==event.pageX&&null!=original.clientX&&(eventDoc=event.target.ownerDocument||document,doc=eventDoc.documentElement,body=eventDoc.body,event.pageX=original.clientX+(doc&&doc.scrollLeft||body&&body.scrollLeft||0)-(doc&&doc.clientLeft||body&&body.clientLeft||0),event.pageY=original.clientY+(doc&&doc.scrollTop||body&&body.scrollTop||0)-(doc&&doc.clientTop||body&&body.clientTop||0)),event.which||button===undefined||(event.which=1&button?1:2&button?3:4&button?2:0),event}},fix:function(event){if(event[jQuery.expando])return event;var i,prop,copy,type=event.type,originalEvent=event,fixHook=this.fixHooks[type];for(fixHook||(this.fixHooks[type]=fixHook=rmouseEvent.test(type)?this.mouseHooks:rkeyEvent.test(type)?this.keyHooks:{}),copy=fixHook.props?this.props.concat(fixHook.props):this.props,event=new jQuery.Event(originalEvent),i=copy.length;i--;)prop=copy[i],event[prop]=originalEvent[prop];return event.target||(event.target=document),3===event.target.nodeType&&(event.target=event.target.parentNode),fixHook.filter?fixHook.filter(event,originalEvent):event},special:{load:{noBubble:!0},focus:{trigger:function(){return this!==safeActiveElement()&&this.focus?(this.focus(),!1):void 0},delegateType:"focusin"},blur:{trigger:function(){return this===safeActiveElement()&&this.blur?(this.blur(),!1):void 0},delegateType:"focusout"},click:{trigger:function(){return"checkbox"===this.type&&this.click&&jQuery.nodeName(this,"input")?(this.click(),!1):void 0},_default:function(event){return jQuery.nodeName(event.target,"a")}},beforeunload:{postDispatch:function(event){event.result!==undefined&&(event.originalEvent.returnValue=event.result)}}},simulate:function(type,elem,event,bubble){var e=jQuery.extend(new jQuery.Event,event,{type:type,isSimulated:!0,originalEvent:{}});bubble?jQuery.event.trigger(e,null,elem):jQuery.event.dispatch.call(elem,e),e.isDefaultPrevented()&&event.preventDefault()}},jQuery.removeEvent=function(elem,type,handle){elem.removeEventListener&&elem.removeEventListener(type,handle,!1)},jQuery.Event=function(src,props){return this instanceof jQuery.Event?(src&&src.type?(this.originalEvent=src,this.type=src.type,this.isDefaultPrevented=src.defaultPrevented||src.getPreventDefault&&src.getPreventDefault()?returnTrue:returnFalse):this.type=src,props&&jQuery.extend(this,props),this.timeStamp=src&&src.timeStamp||jQuery.now(),void(this[jQuery.expando]=!0)):new jQuery.Event(src,props)},jQuery.Event.prototype={isDefaultPrevented:returnFalse,isPropagationStopped:returnFalse,isImmediatePropagationStopped:returnFalse,preventDefault:function(){var e=this.originalEvent;this.isDefaultPrevented=returnTrue,e&&e.preventDefault&&e.preventDefault()},stopPropagation:function(){var e=this.originalEvent;this.isPropagationStopped=returnTrue,e&&e.stopPropagation&&e.stopPropagation()},stopImmediatePropagation:function(){this.isImmediatePropagationStopped=returnTrue,this.stopPropagation()}},jQuery.each({mouseenter:"mouseover",mouseleave:"mouseout"},function(orig,fix){jQuery.event.special[orig]={delegateType:fix,bindType:fix,handle:function(event){var ret,target=this,related=event.relatedTarget,handleObj=event.handleObj;return(!related||related!==target&&!jQuery.contains(target,related))&&(event.type=handleObj.origType,ret=handleObj.handler.apply(this,arguments),event.type=fix),ret}}}),jQuery.support.focusinBubbles||jQuery.each({focus:"focusin",blur:"focusout"},function(orig,fix){var attaches=0,handler=function(event){jQuery.event.simulate(fix,event.target,jQuery.event.fix(event),!0)};jQuery.event.special[fix]={setup:function(){0===attaches++&&document.addEventListener(orig,handler,!0)},teardown:function(){0===--attaches&&document.removeEventListener(orig,handler,!0)}}}),jQuery.fn.extend({on:function(types,selector,data,fn,one){var origFn,type;if("object"==typeof types){"string"!=typeof selector&&(data=data||selector,selector=undefined);for(type in types)this.on(type,selector,data,types[type],one);return this}if(null==data&&null==fn?(fn=selector,data=selector=undefined):null==fn&&("string"==typeof selector?(fn=data,data=undefined):(fn=data,data=selector,selector=undefined)),fn===!1)fn=returnFalse;else if(!fn)return this;return 1===one&&(origFn=fn,fn=function(event){return jQuery().off(event),origFn.apply(this,arguments)},fn.guid=origFn.guid||(origFn.guid=jQuery.guid++)),this.each(function(){jQuery.event.add(this,types,fn,data,selector)})},one:function(types,selector,data,fn){return this.on(types,selector,data,fn,1)},off:function(types,selector,fn){var handleObj,type;if(types&&types.preventDefault&&types.handleObj)return handleObj=types.handleObj,jQuery(types.delegateTarget).off(handleObj.namespace?handleObj.origType+"."+handleObj.namespace:handleObj.origType,handleObj.selector,handleObj.handler),this;if("object"==typeof types){for(type in types)this.off(type,selector,types[type]);return this}return(selector===!1||"function"==typeof selector)&&(fn=selector,selector=undefined),fn===!1&&(fn=returnFalse),this.each(function(){jQuery.event.remove(this,types,fn,selector)})},trigger:function(type,data){return this.each(function(){jQuery.event.trigger(type,data,this)})},triggerHandler:function(type,data){var elem=this[0];return elem?jQuery.event.trigger(type,data,elem,!0):void 0}});var isSimple=/^.[^:#\[\.,]*$/,rparentsprev=/^(?:parents|prev(?:Until|All))/,rneedsContext=jQuery.expr.match.needsContext,guaranteedUnique={children:!0,contents:!0,next:!0,prev:!0};jQuery.fn.extend({find:function(selector){var i,ret=[],self=this,len=self.length;if("string"!=typeof selector)return this.pushStack(jQuery(selector).filter(function(){for(i=0;len>i;i++)if(jQuery.contains(self[i],this))return!0}));for(i=0;len>i;i++)jQuery.find(selector,self[i],ret);return ret=this.pushStack(len>1?jQuery.unique(ret):ret),ret.selector=this.selector?this.selector+" "+selector:selector,ret},has:function(target){var targets=jQuery(target,this),l=targets.length;return this.filter(function(){for(var i=0;l>i;i++)if(jQuery.contains(this,targets[i]))return!0})},not:function(selector){return this.pushStack(winnow(this,selector||[],!0))},filter:function(selector){return this.pushStack(winnow(this,selector||[],!1))},is:function(selector){return!!winnow(this,"string"==typeof selector&&rneedsContext.test(selector)?jQuery(selector):selector||[],!1).length},closest:function(selectors,context){for(var cur,i=0,l=this.length,matched=[],pos=rneedsContext.test(selectors)||"string"!=typeof selectors?jQuery(selectors,context||this.context):0;l>i;i++)for(cur=this[i];cur&&cur!==context;cur=cur.parentNode)if(cur.nodeType<11&&(pos?pos.index(cur)>-1:1===cur.nodeType&&jQuery.find.matchesSelector(cur,selectors))){cur=matched.push(cur);break}return this.pushStack(matched.length>1?jQuery.unique(matched):matched)},index:function(elem){return elem?"string"==typeof elem?core_indexOf.call(jQuery(elem),this[0]):core_indexOf.call(this,elem.jquery?elem[0]:elem):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(selector,context){var set="string"==typeof selector?jQuery(selector,context):jQuery.makeArray(selector&&selector.nodeType?[selector]:selector),all=jQuery.merge(this.get(),set);return this.pushStack(jQuery.unique(all))},addBack:function(selector){return this.add(null==selector?this.prevObject:this.prevObject.filter(selector))}}),jQuery.each({parent:function(elem){var parent=elem.parentNode;return parent&&11!==parent.nodeType?parent:null},parents:function(elem){return jQuery.dir(elem,"parentNode")},parentsUntil:function(elem,i,until){return jQuery.dir(elem,"parentNode",until)},next:function(elem){return sibling(elem,"nextSibling")},prev:function(elem){return sibling(elem,"previousSibling")},nextAll:function(elem){return jQuery.dir(elem,"nextSibling")},prevAll:function(elem){return jQuery.dir(elem,"previousSibling")},nextUntil:function(elem,i,until){return jQuery.dir(elem,"nextSibling",until)},prevUntil:function(elem,i,until){return jQuery.dir(elem,"previousSibling",until)},siblings:function(elem){return jQuery.sibling((elem.parentNode||{}).firstChild,elem)},children:function(elem){return jQuery.sibling(elem.firstChild)},contents:function(elem){return elem.contentDocument||jQuery.merge([],elem.childNodes)}},function(name,fn){jQuery.fn[name]=function(until,selector){var matched=jQuery.map(this,fn,until);return"Until"!==name.slice(-5)&&(selector=until),selector&&"string"==typeof selector&&(matched=jQuery.filter(selector,matched)),this.length>1&&(guaranteedUnique[name]||jQuery.unique(matched),rparentsprev.test(name)&&matched.reverse()),this.pushStack(matched)}}),jQuery.extend({filter:function(expr,elems,not){var elem=elems[0];return not&&(expr=":not("+expr+")"),1===elems.length&&1===elem.nodeType?jQuery.find.matchesSelector(elem,expr)?[elem]:[]:jQuery.find.matches(expr,jQuery.grep(elems,function(elem){return 1===elem.nodeType}))},dir:function(elem,dir,until){for(var matched=[],truncate=until!==undefined;(elem=elem[dir])&&9!==elem.nodeType;)if(1===elem.nodeType){if(truncate&&jQuery(elem).is(until))break;matched.push(elem)}return matched},sibling:function(n,elem){for(var matched=[];n;n=n.nextSibling)1===n.nodeType&&n!==elem&&matched.push(n);return matched}});var rxhtmlTag=/<(?!area|br|col|embed|hr|img|input|link|meta|param)(([\w:]+)[^>]*)\/>/gi,rtagName=/<([\w:]+)/,rhtml=/<|&#?\w+;/,rnoInnerhtml=/<(?:script|style|link)/i,manipulation_rcheckableType=/^(?:checkbox|radio)$/i,rchecked=/checked\s*(?:[^=]|=\s*.checked.)/i,rscriptType=/^$|\/(?:java|ecma)script/i,rscriptTypeMasked=/^true\/(.*)/,rcleanScript=/^\s*<!(?:\[CDATA\[|--)|(?:\]\]|--)>\s*$/g,wrapMap={option:[1,"<select multiple='multiple'>","</select>"],thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};wrapMap.optgroup=wrapMap.option,wrapMap.tbody=wrapMap.tfoot=wrapMap.colgroup=wrapMap.caption=wrapMap.thead,wrapMap.th=wrapMap.td,jQuery.fn.extend({text:function(value){return jQuery.access(this,function(value){return value===undefined?jQuery.text(this):this.empty().append((this[0]&&this[0].ownerDocument||document).createTextNode(value))},null,value,arguments.length)},append:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.appendChild(elem)}})},prepend:function(){return this.domManip(arguments,function(elem){if(1===this.nodeType||11===this.nodeType||9===this.nodeType){var target=manipulationTarget(this,elem);target.insertBefore(elem,target.firstChild)}})},before:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this);
})},after:function(){return this.domManip(arguments,function(elem){this.parentNode&&this.parentNode.insertBefore(elem,this.nextSibling)})},remove:function(selector,keepData){for(var elem,elems=selector?jQuery.filter(selector,this):this,i=0;null!=(elem=elems[i]);i++)keepData||1!==elem.nodeType||jQuery.cleanData(getAll(elem)),elem.parentNode&&(keepData&&jQuery.contains(elem.ownerDocument,elem)&&setGlobalEval(getAll(elem,"script")),elem.parentNode.removeChild(elem));return this},empty:function(){for(var elem,i=0;null!=(elem=this[i]);i++)1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.textContent="");return this},clone:function(dataAndEvents,deepDataAndEvents){return dataAndEvents=null==dataAndEvents?!1:dataAndEvents,deepDataAndEvents=null==deepDataAndEvents?dataAndEvents:deepDataAndEvents,this.map(function(){return jQuery.clone(this,dataAndEvents,deepDataAndEvents)})},html:function(value){return jQuery.access(this,function(value){var elem=this[0]||{},i=0,l=this.length;if(value===undefined&&1===elem.nodeType)return elem.innerHTML;if("string"==typeof value&&!rnoInnerhtml.test(value)&&!wrapMap[(rtagName.exec(value)||["",""])[1].toLowerCase()]){value=value.replace(rxhtmlTag,"<$1></$2>");try{for(;l>i;i++)elem=this[i]||{},1===elem.nodeType&&(jQuery.cleanData(getAll(elem,!1)),elem.innerHTML=value);elem=0}catch(e){}}elem&&this.empty().append(value)},null,value,arguments.length)},replaceWith:function(){var args=jQuery.map(this,function(elem){return[elem.nextSibling,elem.parentNode]}),i=0;return this.domManip(arguments,function(elem){var next=args[i++],parent=args[i++];parent&&(next&&next.parentNode!==parent&&(next=this.nextSibling),jQuery(this).remove(),parent.insertBefore(elem,next))},!0),i?this:this.remove()},detach:function(selector){return this.remove(selector,!0)},domManip:function(args,callback,allowIntersection){args=core_concat.apply([],args);var fragment,first,scripts,hasScripts,node,doc,i=0,l=this.length,set=this,iNoClone=l-1,value=args[0],isFunction=jQuery.isFunction(value);if(isFunction||!(1>=l||"string"!=typeof value||jQuery.support.checkClone)&&rchecked.test(value))return this.each(function(index){var self=set.eq(index);isFunction&&(args[0]=value.call(this,index,self.html())),self.domManip(args,callback,allowIntersection)});if(l&&(fragment=jQuery.buildFragment(args,this[0].ownerDocument,!1,!allowIntersection&&this),first=fragment.firstChild,1===fragment.childNodes.length&&(fragment=first),first)){for(scripts=jQuery.map(getAll(fragment,"script"),disableScript),hasScripts=scripts.length;l>i;i++)node=fragment,i!==iNoClone&&(node=jQuery.clone(node,!0,!0),hasScripts&&jQuery.merge(scripts,getAll(node,"script"))),callback.call(this[i],node,i);if(hasScripts)for(doc=scripts[scripts.length-1].ownerDocument,jQuery.map(scripts,restoreScript),i=0;hasScripts>i;i++)node=scripts[i],rscriptType.test(node.type||"")&&!data_priv.access(node,"globalEval")&&jQuery.contains(doc,node)&&(node.src?jQuery._evalUrl(node.src):jQuery.globalEval(node.textContent.replace(rcleanScript,"")))}return this}}),jQuery.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(name,original){jQuery.fn[name]=function(selector){for(var elems,ret=[],insert=jQuery(selector),last=insert.length-1,i=0;last>=i;i++)elems=i===last?this:this.clone(!0),jQuery(insert[i])[original](elems),core_push.apply(ret,elems.get());return this.pushStack(ret)}}),jQuery.extend({clone:function(elem,dataAndEvents,deepDataAndEvents){var i,l,srcElements,destElements,clone=elem.cloneNode(!0),inPage=jQuery.contains(elem.ownerDocument,elem);if(!(jQuery.support.noCloneChecked||1!==elem.nodeType&&11!==elem.nodeType||jQuery.isXMLDoc(elem)))for(destElements=getAll(clone),srcElements=getAll(elem),i=0,l=srcElements.length;l>i;i++)fixInput(srcElements[i],destElements[i]);if(dataAndEvents)if(deepDataAndEvents)for(srcElements=srcElements||getAll(elem),destElements=destElements||getAll(clone),i=0,l=srcElements.length;l>i;i++)cloneCopyEvent(srcElements[i],destElements[i]);else cloneCopyEvent(elem,clone);return destElements=getAll(clone,"script"),destElements.length>0&&setGlobalEval(destElements,!inPage&&getAll(elem,"script")),clone},buildFragment:function(elems,context,scripts,selection){for(var elem,tmp,tag,wrap,contains,j,i=0,l=elems.length,fragment=context.createDocumentFragment(),nodes=[];l>i;i++)if(elem=elems[i],elem||0===elem)if("object"===jQuery.type(elem))jQuery.merge(nodes,elem.nodeType?[elem]:elem);else if(rhtml.test(elem)){for(tmp=tmp||fragment.appendChild(context.createElement("div")),tag=(rtagName.exec(elem)||["",""])[1].toLowerCase(),wrap=wrapMap[tag]||wrapMap._default,tmp.innerHTML=wrap[1]+elem.replace(rxhtmlTag,"<$1></$2>")+wrap[2],j=wrap[0];j--;)tmp=tmp.lastChild;jQuery.merge(nodes,tmp.childNodes),tmp=fragment.firstChild,tmp.textContent=""}else nodes.push(context.createTextNode(elem));for(fragment.textContent="",i=0;elem=nodes[i++];)if((!selection||-1===jQuery.inArray(elem,selection))&&(contains=jQuery.contains(elem.ownerDocument,elem),tmp=getAll(fragment.appendChild(elem),"script"),contains&&setGlobalEval(tmp),scripts))for(j=0;elem=tmp[j++];)rscriptType.test(elem.type||"")&&scripts.push(elem);return fragment},cleanData:function(elems){for(var data,elem,events,type,key,j,special=jQuery.event.special,i=0;(elem=elems[i])!==undefined;i++){if(Data.accepts(elem)&&(key=elem[data_priv.expando],key&&(data=data_priv.cache[key]))){if(events=Object.keys(data.events||{}),events.length)for(j=0;(type=events[j])!==undefined;j++)special[type]?jQuery.event.remove(elem,type):jQuery.removeEvent(elem,type,data.handle);data_priv.cache[key]&&delete data_priv.cache[key]}delete data_user.cache[elem[data_user.expando]]}},_evalUrl:function(url){return jQuery.ajax({url:url,type:"GET",dataType:"script",async:!1,global:!1,"throws":!0})}}),jQuery.fn.extend({wrapAll:function(html){var wrap;return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapAll(html.call(this,i))}):(this[0]&&(wrap=jQuery(html,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&wrap.insertBefore(this[0]),wrap.map(function(){for(var elem=this;elem.firstElementChild;)elem=elem.firstElementChild;return elem}).append(this)),this)},wrapInner:function(html){return jQuery.isFunction(html)?this.each(function(i){jQuery(this).wrapInner(html.call(this,i))}):this.each(function(){var self=jQuery(this),contents=self.contents();contents.length?contents.wrapAll(html):self.append(html)})},wrap:function(html){var isFunction=jQuery.isFunction(html);return this.each(function(i){jQuery(this).wrapAll(isFunction?html.call(this,i):html)})},unwrap:function(){return this.parent().each(function(){jQuery.nodeName(this,"body")||jQuery(this).replaceWith(this.childNodes)}).end()}});var curCSS,iframe,rdisplayswap=/^(none|table(?!-c[ea]).+)/,rmargin=/^margin/,rnumsplit=new RegExp("^("+core_pnum+")(.*)$","i"),rnumnonpx=new RegExp("^("+core_pnum+")(?!px)[a-z%]+$","i"),rrelNum=new RegExp("^([+-])=("+core_pnum+")","i"),elemdisplay={BODY:"block"},cssShow={position:"absolute",visibility:"hidden",display:"block"},cssNormalTransform={letterSpacing:0,fontWeight:400},cssExpand=["Top","Right","Bottom","Left"],cssPrefixes=["Webkit","O","Moz","ms"];jQuery.fn.extend({css:function(name,value){return jQuery.access(this,function(elem,name,value){var styles,len,map={},i=0;if(jQuery.isArray(name)){for(styles=getStyles(elem),len=name.length;len>i;i++)map[name[i]]=jQuery.css(elem,name[i],!1,styles);return map}return value!==undefined?jQuery.style(elem,name,value):jQuery.css(elem,name)},name,value,arguments.length>1)},show:function(){return showHide(this,!0)},hide:function(){return showHide(this)},toggle:function(state){return"boolean"==typeof state?state?this.show():this.hide():this.each(function(){isHidden(this)?jQuery(this).show():jQuery(this).hide()})}}),jQuery.extend({cssHooks:{opacity:{get:function(elem,computed){if(computed){var ret=curCSS(elem,"opacity");return""===ret?"1":ret}}}},cssNumber:{columnCount:!0,fillOpacity:!0,fontWeight:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,widows:!0,zIndex:!0,zoom:!0},cssProps:{"float":"cssFloat"},style:function(elem,name,value,extra){if(elem&&3!==elem.nodeType&&8!==elem.nodeType&&elem.style){var ret,type,hooks,origName=jQuery.camelCase(name),style=elem.style;return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],value===undefined?hooks&&"get"in hooks&&(ret=hooks.get(elem,!1,extra))!==undefined?ret:style[name]:(type=typeof value,"string"===type&&(ret=rrelNum.exec(value))&&(value=(ret[1]+1)*ret[2]+parseFloat(jQuery.css(elem,name)),type="number"),null==value||"number"===type&&isNaN(value)||("number"!==type||jQuery.cssNumber[origName]||(value+="px"),jQuery.support.clearCloneStyle||""!==value||0!==name.indexOf("background")||(style[name]="inherit"),hooks&&"set"in hooks&&(value=hooks.set(elem,value,extra))===undefined||(style[name]=value)),void 0)}},css:function(elem,name,extra,styles){var val,num,hooks,origName=jQuery.camelCase(name);return name=jQuery.cssProps[origName]||(jQuery.cssProps[origName]=vendorPropName(elem.style,origName)),hooks=jQuery.cssHooks[name]||jQuery.cssHooks[origName],hooks&&"get"in hooks&&(val=hooks.get(elem,!0,extra)),val===undefined&&(val=curCSS(elem,name,styles)),"normal"===val&&name in cssNormalTransform&&(val=cssNormalTransform[name]),""===extra||extra?(num=parseFloat(val),extra===!0||jQuery.isNumeric(num)?num||0:val):val}}),curCSS=function(elem,name,_computed){var width,minWidth,maxWidth,computed=_computed||getStyles(elem),ret=computed?computed.getPropertyValue(name)||computed[name]:undefined,style=elem.style;return computed&&(""!==ret||jQuery.contains(elem.ownerDocument,elem)||(ret=jQuery.style(elem,name)),rnumnonpx.test(ret)&&rmargin.test(name)&&(width=style.width,minWidth=style.minWidth,maxWidth=style.maxWidth,style.minWidth=style.maxWidth=style.width=ret,ret=computed.width,style.width=width,style.minWidth=minWidth,style.maxWidth=maxWidth)),ret},jQuery.each(["height","width"],function(i,name){jQuery.cssHooks[name]={get:function(elem,computed,extra){return computed?0===elem.offsetWidth&&rdisplayswap.test(jQuery.css(elem,"display"))?jQuery.swap(elem,cssShow,function(){return getWidthOrHeight(elem,name,extra)}):getWidthOrHeight(elem,name,extra):void 0},set:function(elem,value,extra){var styles=extra&&getStyles(elem);return setPositiveNumber(elem,value,extra?augmentWidthOrHeight(elem,name,extra,jQuery.support.boxSizing&&"border-box"===jQuery.css(elem,"boxSizing",!1,styles),styles):0)}}}),jQuery(function(){jQuery.support.reliableMarginRight||(jQuery.cssHooks.marginRight={get:function(elem,computed){return computed?jQuery.swap(elem,{display:"inline-block"},curCSS,[elem,"marginRight"]):void 0}}),!jQuery.support.pixelPosition&&jQuery.fn.position&&jQuery.each(["top","left"],function(i,prop){jQuery.cssHooks[prop]={get:function(elem,computed){return computed?(computed=curCSS(elem,prop),rnumnonpx.test(computed)?jQuery(elem).position()[prop]+"px":computed):void 0}}})}),jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.hidden=function(elem){return elem.offsetWidth<=0&&elem.offsetHeight<=0},jQuery.expr.filters.visible=function(elem){return!jQuery.expr.filters.hidden(elem)}),jQuery.each({margin:"",padding:"",border:"Width"},function(prefix,suffix){jQuery.cssHooks[prefix+suffix]={expand:function(value){for(var i=0,expanded={},parts="string"==typeof value?value.split(" "):[value];4>i;i++)expanded[prefix+cssExpand[i]+suffix]=parts[i]||parts[i-2]||parts[0];return expanded}},rmargin.test(prefix)||(jQuery.cssHooks[prefix+suffix].set=setPositiveNumber)});var r20=/%20/g,rbracket=/\[\]$/,rCRLF=/\r?\n/g,rsubmitterTypes=/^(?:submit|button|image|reset|file)$/i,rsubmittable=/^(?:input|select|textarea|keygen)/i;jQuery.fn.extend({serialize:function(){return jQuery.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var elements=jQuery.prop(this,"elements");return elements?jQuery.makeArray(elements):this}).filter(function(){var type=this.type;return this.name&&!jQuery(this).is(":disabled")&&rsubmittable.test(this.nodeName)&&!rsubmitterTypes.test(type)&&(this.checked||!manipulation_rcheckableType.test(type))}).map(function(i,elem){var val=jQuery(this).val();return null==val?null:jQuery.isArray(val)?jQuery.map(val,function(val){return{name:elem.name,value:val.replace(rCRLF,"\r\n")}}):{name:elem.name,value:val.replace(rCRLF,"\r\n")}}).get()}}),jQuery.param=function(a,traditional){var prefix,s=[],add=function(key,value){value=jQuery.isFunction(value)?value():null==value?"":value,s[s.length]=encodeURIComponent(key)+"="+encodeURIComponent(value)};if(traditional===undefined&&(traditional=jQuery.ajaxSettings&&jQuery.ajaxSettings.traditional),jQuery.isArray(a)||a.jquery&&!jQuery.isPlainObject(a))jQuery.each(a,function(){add(this.name,this.value)});else for(prefix in a)buildParams(prefix,a[prefix],traditional,add);return s.join("&").replace(r20,"+")},jQuery.each("blur focus focusin focusout load resize scroll unload click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup error contextmenu".split(" "),function(i,name){jQuery.fn[name]=function(data,fn){return arguments.length>0?this.on(name,null,data,fn):this.trigger(name)}}),jQuery.fn.extend({hover:function(fnOver,fnOut){return this.mouseenter(fnOver).mouseleave(fnOut||fnOver)},bind:function(types,data,fn){return this.on(types,null,data,fn)},unbind:function(types,fn){return this.off(types,null,fn)},delegate:function(selector,types,data,fn){return this.on(types,selector,data,fn)},undelegate:function(selector,types,fn){return 1===arguments.length?this.off(selector,"**"):this.off(types,selector||"**",fn)}});var ajaxLocParts,ajaxLocation,ajax_nonce=jQuery.now(),ajax_rquery=/\?/,rhash=/#.*$/,rts=/([?&])_=[^&]*/,rheaders=/^(.*?):[ \t]*([^\r\n]*)$/gm,rlocalProtocol=/^(?:about|app|app-storage|.+-extension|file|res|widget):$/,rnoContent=/^(?:GET|HEAD)$/,rprotocol=/^\/\//,rurl=/^([\w.+-]+:)(?:\/\/([^\/?#:]*)(?::(\d+)|)|)/,_load=jQuery.fn.load,prefilters={},transports={},allTypes="*/".concat("*");try{ajaxLocation=location.href}catch(e){ajaxLocation=document.createElement("a"),ajaxLocation.href="",ajaxLocation=ajaxLocation.href}ajaxLocParts=rurl.exec(ajaxLocation.toLowerCase())||[],jQuery.fn.load=function(url,params,callback){if("string"!=typeof url&&_load)return _load.apply(this,arguments);var selector,type,response,self=this,off=url.indexOf(" ");return off>=0&&(selector=url.slice(off),url=url.slice(0,off)),jQuery.isFunction(params)?(callback=params,params=undefined):params&&"object"==typeof params&&(type="POST"),self.length>0&&jQuery.ajax({url:url,type:type,dataType:"html",data:params}).done(function(responseText){response=arguments,self.html(selector?jQuery("<div>").append(jQuery.parseHTML(responseText)).find(selector):responseText)}).complete(callback&&function(jqXHR,status){self.each(callback,response||[jqXHR.responseText,status,jqXHR])}),this},jQuery.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(i,type){jQuery.fn[type]=function(fn){return this.on(type,fn)}}),jQuery.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:ajaxLocation,type:"GET",isLocal:rlocalProtocol.test(ajaxLocParts[1]),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":allTypes,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/xml/,html:/html/,json:/json/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":jQuery.parseJSON,"text xml":jQuery.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(target,settings){return settings?ajaxExtend(ajaxExtend(target,jQuery.ajaxSettings),settings):ajaxExtend(jQuery.ajaxSettings,target)},ajaxPrefilter:addToPrefiltersOrTransports(prefilters),ajaxTransport:addToPrefiltersOrTransports(transports),ajax:function(url,options){function done(status,nativeStatusText,responses,headers){var isSuccess,success,error,response,modified,statusText=nativeStatusText;2!==state&&(state=2,timeoutTimer&&clearTimeout(timeoutTimer),transport=undefined,responseHeadersString=headers||"",jqXHR.readyState=status>0?4:0,isSuccess=status>=200&&300>status||304===status,responses&&(response=ajaxHandleResponses(s,jqXHR,responses)),response=ajaxConvert(s,response,jqXHR,isSuccess),isSuccess?(s.ifModified&&(modified=jqXHR.getResponseHeader("Last-Modified"),modified&&(jQuery.lastModified[cacheURL]=modified),modified=jqXHR.getResponseHeader("etag"),modified&&(jQuery.etag[cacheURL]=modified)),204===status||"HEAD"===s.type?statusText="nocontent":304===status?statusText="notmodified":(statusText=response.state,success=response.data,error=response.error,isSuccess=!error)):(error=statusText,(status||!statusText)&&(statusText="error",0>status&&(status=0))),jqXHR.status=status,jqXHR.statusText=(nativeStatusText||statusText)+"",isSuccess?deferred.resolveWith(callbackContext,[success,statusText,jqXHR]):deferred.rejectWith(callbackContext,[jqXHR,statusText,error]),jqXHR.statusCode(statusCode),statusCode=undefined,fireGlobals&&globalEventContext.trigger(isSuccess?"ajaxSuccess":"ajaxError",[jqXHR,s,isSuccess?success:error]),completeDeferred.fireWith(callbackContext,[jqXHR,statusText]),fireGlobals&&(globalEventContext.trigger("ajaxComplete",[jqXHR,s]),--jQuery.active||jQuery.event.trigger("ajaxStop")))}"object"==typeof url&&(options=url,url=undefined),options=options||{};var transport,cacheURL,responseHeadersString,responseHeaders,timeoutTimer,parts,fireGlobals,i,s=jQuery.ajaxSetup({},options),callbackContext=s.context||s,globalEventContext=s.context&&(callbackContext.nodeType||callbackContext.jquery)?jQuery(callbackContext):jQuery.event,deferred=jQuery.Deferred(),completeDeferred=jQuery.Callbacks("once memory"),statusCode=s.statusCode||{},requestHeaders={},requestHeadersNames={},state=0,strAbort="canceled",jqXHR={readyState:0,getResponseHeader:function(key){var match;if(2===state){if(!responseHeaders)for(responseHeaders={};match=rheaders.exec(responseHeadersString);)responseHeaders[match[1].toLowerCase()]=match[2];match=responseHeaders[key.toLowerCase()]}return null==match?null:match},getAllResponseHeaders:function(){return 2===state?responseHeadersString:null},setRequestHeader:function(name,value){var lname=name.toLowerCase();return state||(name=requestHeadersNames[lname]=requestHeadersNames[lname]||name,requestHeaders[name]=value),this},overrideMimeType:function(type){return state||(s.mimeType=type),this},statusCode:function(map){var code;if(map)if(2>state)for(code in map)statusCode[code]=[statusCode[code],map[code]];else jqXHR.always(map[jqXHR.status]);return this},abort:function(statusText){var finalText=statusText||strAbort;return transport&&transport.abort(finalText),done(0,finalText),this}};if(deferred.promise(jqXHR).complete=completeDeferred.add,jqXHR.success=jqXHR.done,jqXHR.error=jqXHR.fail,s.url=((url||s.url||ajaxLocation)+"").replace(rhash,"").replace(rprotocol,ajaxLocParts[1]+"//"),s.type=options.method||options.type||s.method||s.type,s.dataTypes=jQuery.trim(s.dataType||"*").toLowerCase().match(core_rnotwhite)||[""],null==s.crossDomain&&(parts=rurl.exec(s.url.toLowerCase()),s.crossDomain=!(!parts||parts[1]===ajaxLocParts[1]&&parts[2]===ajaxLocParts[2]&&(parts[3]||("http:"===parts[1]?"80":"443"))===(ajaxLocParts[3]||("http:"===ajaxLocParts[1]?"80":"443")))),s.data&&s.processData&&"string"!=typeof s.data&&(s.data=jQuery.param(s.data,s.traditional)),inspectPrefiltersOrTransports(prefilters,s,options,jqXHR),2===state)return jqXHR;fireGlobals=s.global,fireGlobals&&0===jQuery.active++&&jQuery.event.trigger("ajaxStart"),s.type=s.type.toUpperCase(),s.hasContent=!rnoContent.test(s.type),cacheURL=s.url,s.hasContent||(s.data&&(cacheURL=s.url+=(ajax_rquery.test(cacheURL)?"&":"?")+s.data,delete s.data),s.cache===!1&&(s.url=rts.test(cacheURL)?cacheURL.replace(rts,"$1_="+ajax_nonce++):cacheURL+(ajax_rquery.test(cacheURL)?"&":"?")+"_="+ajax_nonce++)),s.ifModified&&(jQuery.lastModified[cacheURL]&&jqXHR.setRequestHeader("If-Modified-Since",jQuery.lastModified[cacheURL]),jQuery.etag[cacheURL]&&jqXHR.setRequestHeader("If-None-Match",jQuery.etag[cacheURL])),(s.data&&s.hasContent&&s.contentType!==!1||options.contentType)&&jqXHR.setRequestHeader("Content-Type",s.contentType),jqXHR.setRequestHeader("Accept",s.dataTypes[0]&&s.accepts[s.dataTypes[0]]?s.accepts[s.dataTypes[0]]+("*"!==s.dataTypes[0]?", "+allTypes+"; q=0.01":""):s.accepts["*"]);for(i in s.headers)jqXHR.setRequestHeader(i,s.headers[i]);if(s.beforeSend&&(s.beforeSend.call(callbackContext,jqXHR,s)===!1||2===state))return jqXHR.abort();strAbort="abort";for(i in{success:1,error:1,complete:1})jqXHR[i](s[i]);if(transport=inspectPrefiltersOrTransports(transports,s,options,jqXHR)){jqXHR.readyState=1,fireGlobals&&globalEventContext.trigger("ajaxSend",[jqXHR,s]),s.async&&s.timeout>0&&(timeoutTimer=setTimeout(function(){jqXHR.abort("timeout")},s.timeout));try{state=1,transport.send(requestHeaders,done)}catch(e){if(!(2>state))throw e;done(-1,e)}}else done(-1,"No Transport");return jqXHR},getJSON:function(url,data,callback){return jQuery.get(url,data,callback,"json")},getScript:function(url,callback){return jQuery.get(url,undefined,callback,"script")}}),jQuery.each(["get","post"],function(i,method){jQuery[method]=function(url,data,callback,type){return jQuery.isFunction(data)&&(type=type||callback,callback=data,data=undefined),jQuery.ajax({url:url,type:method,dataType:type,data:data,success:callback})}}),jQuery.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/(?:java|ecma)script/},converters:{"text script":function(text){return jQuery.globalEval(text),text}}}),jQuery.ajaxPrefilter("script",function(s){s.cache===undefined&&(s.cache=!1),s.crossDomain&&(s.type="GET")}),jQuery.ajaxTransport("script",function(s){if(s.crossDomain){var script,callback;return{send:function(_,complete){script=jQuery("<script>").prop({async:!0,charset:s.scriptCharset,src:s.url}).on("load error",callback=function(evt){script.remove(),callback=null,evt&&complete("error"===evt.type?404:200,evt.type)}),document.head.appendChild(script[0])},abort:function(){callback&&callback()}}}});var oldCallbacks=[],rjsonp=/(=)\?(?=&|$)|\?\?/;jQuery.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var callback=oldCallbacks.pop()||jQuery.expando+"_"+ajax_nonce++;return this[callback]=!0,callback}}),jQuery.ajaxPrefilter("json jsonp",function(s,originalSettings,jqXHR){var callbackName,overwritten,responseContainer,jsonProp=s.jsonp!==!1&&(rjsonp.test(s.url)?"url":"string"==typeof s.data&&!(s.contentType||"").indexOf("application/x-www-form-urlencoded")&&rjsonp.test(s.data)&&"data");return jsonProp||"jsonp"===s.dataTypes[0]?(callbackName=s.jsonpCallback=jQuery.isFunction(s.jsonpCallback)?s.jsonpCallback():s.jsonpCallback,jsonProp?s[jsonProp]=s[jsonProp].replace(rjsonp,"$1"+callbackName):s.jsonp!==!1&&(s.url+=(ajax_rquery.test(s.url)?"&":"?")+s.jsonp+"="+callbackName),s.converters["script json"]=function(){return responseContainer||jQuery.error(callbackName+" was not called"),responseContainer[0]},s.dataTypes[0]="json",overwritten=window[callbackName],window[callbackName]=function(){responseContainer=arguments},jqXHR.always(function(){window[callbackName]=overwritten,s[callbackName]&&(s.jsonpCallback=originalSettings.jsonpCallback,oldCallbacks.push(callbackName)),responseContainer&&jQuery.isFunction(overwritten)&&overwritten(responseContainer[0]),responseContainer=overwritten=undefined}),"script"):void 0}),jQuery.ajaxSettings.xhr=function(){try{return new XMLHttpRequest}catch(e){}};var xhrSupported=jQuery.ajaxSettings.xhr(),xhrSuccessStatus={0:200,1223:204},xhrId=0,xhrCallbacks={};window.ActiveXObject&&jQuery(window).on("unload",function(){for(var key in xhrCallbacks)xhrCallbacks[key]();xhrCallbacks=undefined}),jQuery.support.cors=!!xhrSupported&&"withCredentials"in xhrSupported,jQuery.support.ajax=xhrSupported=!!xhrSupported,jQuery.ajaxTransport(function(options){var callback;return jQuery.support.cors||xhrSupported&&!options.crossDomain?{send:function(headers,complete){var i,id,xhr=options.xhr();if(xhr.open(options.type,options.url,options.async,options.username,options.password),options.xhrFields)for(i in options.xhrFields)xhr[i]=options.xhrFields[i];options.mimeType&&xhr.overrideMimeType&&xhr.overrideMimeType(options.mimeType),options.crossDomain||headers["X-Requested-With"]||(headers["X-Requested-With"]="XMLHttpRequest");for(i in headers)xhr.setRequestHeader(i,headers[i]);callback=function(type){return function(){callback&&(delete xhrCallbacks[id],callback=xhr.onload=xhr.onerror=null,"abort"===type?xhr.abort():"error"===type?complete(xhr.status||404,xhr.statusText):complete(xhrSuccessStatus[xhr.status]||xhr.status,xhr.statusText,"string"==typeof xhr.responseText?{text:xhr.responseText}:undefined,xhr.getAllResponseHeaders()))}},xhr.onload=callback(),xhr.onerror=callback("error"),callback=xhrCallbacks[id=xhrId++]=callback("abort"),xhr.send(options.hasContent&&options.data||null)},abort:function(){callback&&callback()}}:void 0});var fxNow,timerId,rfxtypes=/^(?:toggle|show|hide)$/,rfxnum=new RegExp("^(?:([+-])=|)("+core_pnum+")([a-z%]*)$","i"),rrun=/queueHooks$/,animationPrefilters=[defaultPrefilter],tweeners={"*":[function(prop,value){var tween=this.createTween(prop,value),target=tween.cur(),parts=rfxnum.exec(value),unit=parts&&parts[3]||(jQuery.cssNumber[prop]?"":"px"),start=(jQuery.cssNumber[prop]||"px"!==unit&&+target)&&rfxnum.exec(jQuery.css(tween.elem,prop)),scale=1,maxIterations=20;if(start&&start[3]!==unit){unit=unit||start[3],parts=parts||[],start=+target||1;do scale=scale||".5",start/=scale,jQuery.style(tween.elem,prop,start+unit);while(scale!==(scale=tween.cur()/target)&&1!==scale&&--maxIterations)}return parts&&(start=tween.start=+start||+target||0,tween.unit=unit,tween.end=parts[1]?start+(parts[1]+1)*parts[2]:+parts[2]),tween}]};jQuery.Animation=jQuery.extend(Animation,{tweener:function(props,callback){jQuery.isFunction(props)?(callback=props,props=["*"]):props=props.split(" ");for(var prop,index=0,length=props.length;length>index;index++)prop=props[index],tweeners[prop]=tweeners[prop]||[],tweeners[prop].unshift(callback)},prefilter:function(callback,prepend){prepend?animationPrefilters.unshift(callback):animationPrefilters.push(callback)}}),jQuery.Tween=Tween,Tween.prototype={constructor:Tween,init:function(elem,options,prop,end,easing,unit){this.elem=elem,this.prop=prop,this.easing=easing||"swing",this.options=options,this.start=this.now=this.cur(),this.end=end,this.unit=unit||(jQuery.cssNumber[prop]?"":"px")},cur:function(){var hooks=Tween.propHooks[this.prop];return hooks&&hooks.get?hooks.get(this):Tween.propHooks._default.get(this)},run:function(percent){var eased,hooks=Tween.propHooks[this.prop];return this.options.duration?this.pos=eased=jQuery.easing[this.easing](percent,this.options.duration*percent,0,1,this.options.duration):this.pos=eased=percent,this.now=(this.end-this.start)*eased+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),hooks&&hooks.set?hooks.set(this):Tween.propHooks._default.set(this),this}},Tween.prototype.init.prototype=Tween.prototype,Tween.propHooks={_default:{get:function(tween){var result;return null==tween.elem[tween.prop]||tween.elem.style&&null!=tween.elem.style[tween.prop]?(result=jQuery.css(tween.elem,tween.prop,""),result&&"auto"!==result?result:0):tween.elem[tween.prop]},set:function(tween){jQuery.fx.step[tween.prop]?jQuery.fx.step[tween.prop](tween):tween.elem.style&&(null!=tween.elem.style[jQuery.cssProps[tween.prop]]||jQuery.cssHooks[tween.prop])?jQuery.style(tween.elem,tween.prop,tween.now+tween.unit):tween.elem[tween.prop]=tween.now}}},Tween.propHooks.scrollTop=Tween.propHooks.scrollLeft={set:function(tween){tween.elem.nodeType&&tween.elem.parentNode&&(tween.elem[tween.prop]=tween.now)}},jQuery.each(["toggle","show","hide"],function(i,name){var cssFn=jQuery.fn[name];jQuery.fn[name]=function(speed,easing,callback){return null==speed||"boolean"==typeof speed?cssFn.apply(this,arguments):this.animate(genFx(name,!0),speed,easing,callback)}}),jQuery.fn.extend({fadeTo:function(speed,to,easing,callback){return this.filter(isHidden).css("opacity",0).show().end().animate({opacity:to},speed,easing,callback)},animate:function(prop,speed,easing,callback){var empty=jQuery.isEmptyObject(prop),optall=jQuery.speed(speed,easing,callback),doAnimation=function(){var anim=Animation(this,jQuery.extend({},prop),optall);(empty||data_priv.get(this,"finish"))&&anim.stop(!0)};return doAnimation.finish=doAnimation,empty||optall.queue===!1?this.each(doAnimation):this.queue(optall.queue,doAnimation)},stop:function(type,clearQueue,gotoEnd){var stopQueue=function(hooks){var stop=hooks.stop;delete hooks.stop,stop(gotoEnd)};return"string"!=typeof type&&(gotoEnd=clearQueue,clearQueue=type,type=undefined),clearQueue&&type!==!1&&this.queue(type||"fx",[]),this.each(function(){var dequeue=!0,index=null!=type&&type+"queueHooks",timers=jQuery.timers,data=data_priv.get(this);if(index)data[index]&&data[index].stop&&stopQueue(data[index]);else for(index in data)data[index]&&data[index].stop&&rrun.test(index)&&stopQueue(data[index]);for(index=timers.length;index--;)timers[index].elem!==this||null!=type&&timers[index].queue!==type||(timers[index].anim.stop(gotoEnd),dequeue=!1,timers.splice(index,1));(dequeue||!gotoEnd)&&jQuery.dequeue(this,type)})},finish:function(type){return type!==!1&&(type=type||"fx"),this.each(function(){var index,data=data_priv.get(this),queue=data[type+"queue"],hooks=data[type+"queueHooks"],timers=jQuery.timers,length=queue?queue.length:0;for(data.finish=!0,jQuery.queue(this,type,[]),hooks&&hooks.stop&&hooks.stop.call(this,!0),index=timers.length;index--;)timers[index].elem===this&&timers[index].queue===type&&(timers[index].anim.stop(!0),timers.splice(index,1));for(index=0;length>index;index++)queue[index]&&queue[index].finish&&queue[index].finish.call(this);delete data.finish})}}),jQuery.each({slideDown:genFx("show"),slideUp:genFx("hide"),slideToggle:genFx("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(name,props){jQuery.fn[name]=function(speed,easing,callback){return this.animate(props,speed,easing,callback)}}),jQuery.speed=function(speed,easing,fn){var opt=speed&&"object"==typeof speed?jQuery.extend({},speed):{complete:fn||!fn&&easing||jQuery.isFunction(speed)&&speed,duration:speed,easing:fn&&easing||easing&&!jQuery.isFunction(easing)&&easing};return opt.duration=jQuery.fx.off?0:"number"==typeof opt.duration?opt.duration:opt.duration in jQuery.fx.speeds?jQuery.fx.speeds[opt.duration]:jQuery.fx.speeds._default,(null==opt.queue||opt.queue===!0)&&(opt.queue="fx"),opt.old=opt.complete,opt.complete=function(){jQuery.isFunction(opt.old)&&opt.old.call(this),opt.queue&&jQuery.dequeue(this,opt.queue)},opt},jQuery.easing={linear:function(p){return p},swing:function(p){return.5-Math.cos(p*Math.PI)/2}},jQuery.timers=[],jQuery.fx=Tween.prototype.init,jQuery.fx.tick=function(){var timer,timers=jQuery.timers,i=0;for(fxNow=jQuery.now();i<timers.length;i++)timer=timers[i],timer()||timers[i]!==timer||timers.splice(i--,1);timers.length||jQuery.fx.stop(),fxNow=undefined},jQuery.fx.timer=function(timer){timer()&&jQuery.timers.push(timer)&&jQuery.fx.start()},jQuery.fx.interval=13,jQuery.fx.start=function(){timerId||(timerId=setInterval(jQuery.fx.tick,jQuery.fx.interval))},jQuery.fx.stop=function(){clearInterval(timerId),timerId=null},jQuery.fx.speeds={slow:600,fast:200,_default:400},jQuery.fx.step={},jQuery.expr&&jQuery.expr.filters&&(jQuery.expr.filters.animated=function(elem){return jQuery.grep(jQuery.timers,function(fn){return elem===fn.elem}).length}),jQuery.fn.offset=function(options){if(arguments.length)return options===undefined?this:this.each(function(i){jQuery.offset.setOffset(this,options,i)});var docElem,win,elem=this[0],box={top:0,left:0},doc=elem&&elem.ownerDocument;if(doc)return docElem=doc.documentElement,jQuery.contains(docElem,elem)?(typeof elem.getBoundingClientRect!==core_strundefined&&(box=elem.getBoundingClientRect()),win=getWindow(doc),{top:box.top+win.pageYOffset-docElem.clientTop,left:box.left+win.pageXOffset-docElem.clientLeft}):box},jQuery.offset={setOffset:function(elem,options,i){var curPosition,curLeft,curCSSTop,curTop,curOffset,curCSSLeft,calculatePosition,position=jQuery.css(elem,"position"),curElem=jQuery(elem),props={};"static"===position&&(elem.style.position="relative"),curOffset=curElem.offset(),curCSSTop=jQuery.css(elem,"top"),
curCSSLeft=jQuery.css(elem,"left"),calculatePosition=("absolute"===position||"fixed"===position)&&(curCSSTop+curCSSLeft).indexOf("auto")>-1,calculatePosition?(curPosition=curElem.position(),curTop=curPosition.top,curLeft=curPosition.left):(curTop=parseFloat(curCSSTop)||0,curLeft=parseFloat(curCSSLeft)||0),jQuery.isFunction(options)&&(options=options.call(elem,i,curOffset)),null!=options.top&&(props.top=options.top-curOffset.top+curTop),null!=options.left&&(props.left=options.left-curOffset.left+curLeft),"using"in options?options.using.call(elem,props):curElem.css(props)}},jQuery.fn.extend({position:function(){if(this[0]){var offsetParent,offset,elem=this[0],parentOffset={top:0,left:0};return"fixed"===jQuery.css(elem,"position")?offset=elem.getBoundingClientRect():(offsetParent=this.offsetParent(),offset=this.offset(),jQuery.nodeName(offsetParent[0],"html")||(parentOffset=offsetParent.offset()),parentOffset.top+=jQuery.css(offsetParent[0],"borderTopWidth",!0),parentOffset.left+=jQuery.css(offsetParent[0],"borderLeftWidth",!0)),{top:offset.top-parentOffset.top-jQuery.css(elem,"marginTop",!0),left:offset.left-parentOffset.left-jQuery.css(elem,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var offsetParent=this.offsetParent||docElem;offsetParent&&!jQuery.nodeName(offsetParent,"html")&&"static"===jQuery.css(offsetParent,"position");)offsetParent=offsetParent.offsetParent;return offsetParent||docElem})}}),jQuery.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(method,prop){var top="pageYOffset"===prop;jQuery.fn[method]=function(val){return jQuery.access(this,function(elem,method,val){var win=getWindow(elem);return val===undefined?win?win[prop]:elem[method]:void(win?win.scrollTo(top?window.pageXOffset:val,top?val:window.pageYOffset):elem[method]=val)},method,val,arguments.length,null)}}),jQuery.each({Height:"height",Width:"width"},function(name,type){jQuery.each({padding:"inner"+name,content:type,"":"outer"+name},function(defaultExtra,funcName){jQuery.fn[funcName]=function(margin,value){var chainable=arguments.length&&(defaultExtra||"boolean"!=typeof margin),extra=defaultExtra||(margin===!0||value===!0?"margin":"border");return jQuery.access(this,function(elem,type,value){var doc;return jQuery.isWindow(elem)?elem.document.documentElement["client"+name]:9===elem.nodeType?(doc=elem.documentElement,Math.max(elem.body["scroll"+name],doc["scroll"+name],elem.body["offset"+name],doc["offset"+name],doc["client"+name])):value===undefined?jQuery.css(elem,type,extra):jQuery.style(elem,type,value,extra)},type,chainable?margin:undefined,chainable,null)}})}),jQuery.fn.size=function(){return this.length},jQuery.fn.andSelf=jQuery.fn.addBack,"object"==typeof module&&module&&"object"==typeof module.exports?module.exports=jQuery:"function"==typeof define&&define.amd&&define("jquery",[],function(){return jQuery}),"object"==typeof window&&"object"==typeof window.document&&(window.jQuery=window.$=jQuery)}(window),function($,undefined){"use strict";$.rails!==undefined&&$.error("jquery-ujs has already been loaded!");var rails,$document=$(document);$.rails=rails={linkClickSelector:"a[data-confirm], a[data-method], a[data-remote]:not([disabled]), a[data-disable-with], a[data-disable]",buttonClickSelector:"button[data-remote]:not([form]):not(form button), button[data-confirm]:not([form]):not(form button)",inputChangeSelector:"select[data-remote], input[data-remote], textarea[data-remote]",formSubmitSelector:"form",formInputClickSelector:"form input[type=submit], form input[type=image], form button[type=submit], form button:not([type]), input[type=submit][form], input[type=image][form], button[type=submit][form], button[form]:not([type])",disableSelector:"input[data-disable-with]:enabled, button[data-disable-with]:enabled, textarea[data-disable-with]:enabled, input[data-disable]:enabled, button[data-disable]:enabled, textarea[data-disable]:enabled",enableSelector:"input[data-disable-with]:disabled, button[data-disable-with]:disabled, textarea[data-disable-with]:disabled, input[data-disable]:disabled, button[data-disable]:disabled, textarea[data-disable]:disabled",requiredInputSelector:"input[name][required]:not([disabled]), textarea[name][required]:not([disabled])",fileInputSelector:"input[type=file]:not([disabled])",linkDisableSelector:"a[data-disable-with], a[data-disable]",buttonDisableSelector:"button[data-remote][data-disable-with], button[data-remote][data-disable]",csrfToken:function(){return $("meta[name=csrf-token]").attr("content")},csrfParam:function(){return $("meta[name=csrf-param]").attr("content")},CSRFProtection:function(xhr){var token=rails.csrfToken();token&&xhr.setRequestHeader("X-CSRF-Token",token)},refreshCSRFTokens:function(){$('form input[name="'+rails.csrfParam()+'"]').val(rails.csrfToken())},fire:function(obj,name,data){var event=$.Event(name);return obj.trigger(event,data),event.result!==!1},confirm:function(message){return confirm(message)},ajax:function(options){return $.ajax(options)},href:function(element){return element[0].href},isRemote:function(element){return element.data("remote")!==undefined&&element.data("remote")!==!1},handleRemote:function(element){var method,url,data,withCredentials,dataType,options;if(rails.fire(element,"ajax:before")){if(withCredentials=element.data("with-credentials")||null,dataType=element.data("type")||$.ajaxSettings&&$.ajaxSettings.dataType,element.is("form")){method=element.data("ujs:submit-button-formmethod")||element.attr("method"),url=element.data("ujs:submit-button-formaction")||element.attr("action"),data=$(element[0]).serializeArray();var button=element.data("ujs:submit-button");button&&(data.push(button),element.data("ujs:submit-button",null)),element.data("ujs:submit-button-formmethod",null),element.data("ujs:submit-button-formaction",null)}else element.is(rails.inputChangeSelector)?(method=element.data("method"),url=element.data("url"),data=element.serialize(),element.data("params")&&(data=data+"&"+element.data("params"))):element.is(rails.buttonClickSelector)?(method=element.data("method")||"get",url=element.data("url"),data=element.serialize(),element.data("params")&&(data=data+"&"+element.data("params"))):(method=element.data("method"),url=rails.href(element),data=element.data("params")||null);return options={type:method||"GET",data:data,dataType:dataType,beforeSend:function(xhr,settings){return settings.dataType===undefined&&xhr.setRequestHeader("accept","*/*;q=0.5, "+settings.accepts.script),rails.fire(element,"ajax:beforeSend",[xhr,settings])?void element.trigger("ajax:send",xhr):!1},success:function(data,status,xhr){element.trigger("ajax:success",[data,status,xhr])},complete:function(xhr,status){element.trigger("ajax:complete",[xhr,status])},error:function(xhr,status,error){element.trigger("ajax:error",[xhr,status,error])},crossDomain:rails.isCrossDomain(url)},withCredentials&&(options.xhrFields={withCredentials:withCredentials}),url&&(options.url=url),rails.ajax(options)}return!1},isCrossDomain:function(url){var originAnchor=document.createElement("a");originAnchor.href=location.href;var urlAnchor=document.createElement("a");try{return urlAnchor.href=url,urlAnchor.href=urlAnchor.href,!((!urlAnchor.protocol||":"===urlAnchor.protocol)&&!urlAnchor.host||originAnchor.protocol+"//"+originAnchor.host==urlAnchor.protocol+"//"+urlAnchor.host)}catch(e){return!0}},handleMethod:function(link){var href=rails.href(link),method=link.data("method"),target=link.attr("target"),csrfToken=rails.csrfToken(),csrfParam=rails.csrfParam(),form=$('<form method="post" action="'+href+'"></form>'),metadataInput='<input name="_method" value="'+method+'" type="hidden" />';csrfParam===undefined||csrfToken===undefined||rails.isCrossDomain(href)||(metadataInput+='<input name="'+csrfParam+'" value="'+csrfToken+'" type="hidden" />'),target&&form.attr("target",target),form.hide().append(metadataInput).appendTo("body"),form.submit()},formElements:function(form,selector){return form.is("form")?$(form[0].elements).filter(selector):form.find(selector)},disableFormElements:function(form){rails.formElements(form,rails.disableSelector).each(function(){rails.disableFormElement($(this))})},disableFormElement:function(element){var method,replacement;method=element.is("button")?"html":"val",replacement=element.data("disable-with"),replacement!==undefined&&(element.data("ujs:enable-with",element[method]()),element[method](replacement)),element.prop("disabled",!0),element.data("ujs:disabled",!0)},enableFormElements:function(form){rails.formElements(form,rails.enableSelector).each(function(){rails.enableFormElement($(this))})},enableFormElement:function(element){var method=element.is("button")?"html":"val";element.data("ujs:enable-with")!==undefined&&(element[method](element.data("ujs:enable-with")),element.removeData("ujs:enable-with")),element.prop("disabled",!1),element.removeData("ujs:disabled")},allowAction:function(element){var callback,message=element.data("confirm"),answer=!1;if(!message)return!0;if(rails.fire(element,"confirm")){try{answer=rails.confirm(message)}catch(e){(console.error||console.log).call(console,e.stack||e)}callback=rails.fire(element,"confirm:complete",[answer])}return answer&&callback},blankInputs:function(form,specifiedSelector,nonBlank){var input,valueToCheck,radiosForNameWithNoneSelected,radioName,foundInputs=$(),selector=specifiedSelector||"input,textarea",requiredInputs=form.find(selector),checkedRadioButtonNames={};return requiredInputs.each(function(){input=$(this),input.is("input[type=radio]")?(radioName=input.attr("name"),checkedRadioButtonNames[radioName]||(0===form.find('input[type=radio]:checked[name="'+radioName+'"]').length&&(radiosForNameWithNoneSelected=form.find('input[type=radio][name="'+radioName+'"]'),foundInputs=foundInputs.add(radiosForNameWithNoneSelected)),checkedRadioButtonNames[radioName]=radioName)):(valueToCheck=input.is("input[type=checkbox],input[type=radio]")?input.is(":checked"):!!input.val(),valueToCheck===nonBlank&&(foundInputs=foundInputs.add(input)))}),foundInputs.length?foundInputs:!1},nonBlankInputs:function(form,specifiedSelector){return rails.blankInputs(form,specifiedSelector,!0)},stopEverything:function(e){return $(e.target).trigger("ujs:everythingStopped"),e.stopImmediatePropagation(),!1},disableElement:function(element){var replacement=element.data("disable-with");replacement!==undefined&&(element.data("ujs:enable-with",element.html()),element.html(replacement)),element.bind("click.railsDisable",function(e){return rails.stopEverything(e)}),element.data("ujs:disabled",!0)},enableElement:function(element){element.data("ujs:enable-with")!==undefined&&(element.html(element.data("ujs:enable-with")),element.removeData("ujs:enable-with")),element.unbind("click.railsDisable"),element.removeData("ujs:disabled")}},rails.fire($document,"rails:attachBindings")&&($.ajaxPrefilter(function(options,originalOptions,xhr){options.crossDomain||rails.CSRFProtection(xhr)}),$(window).on("pageshow.rails",function(){$($.rails.enableSelector).each(function(){var element=$(this);element.data("ujs:disabled")&&$.rails.enableFormElement(element)}),$($.rails.linkDisableSelector).each(function(){var element=$(this);element.data("ujs:disabled")&&$.rails.enableElement(element)})}),$document.delegate(rails.linkDisableSelector,"ajax:complete",function(){rails.enableElement($(this))}),$document.delegate(rails.buttonDisableSelector,"ajax:complete",function(){rails.enableFormElement($(this))}),$document.delegate(rails.linkClickSelector,"click.rails",function(e){var link=$(this),method=link.data("method"),data=link.data("params"),metaClick=e.metaKey||e.ctrlKey;if(!rails.allowAction(link))return rails.stopEverything(e);if(!metaClick&&link.is(rails.linkDisableSelector)&&rails.disableElement(link),rails.isRemote(link)){if(metaClick&&(!method||"GET"===method)&&!data)return!0;var handleRemote=rails.handleRemote(link);return handleRemote===!1?rails.enableElement(link):handleRemote.fail(function(){rails.enableElement(link)}),!1}return method?(rails.handleMethod(link),!1):void 0}),$document.delegate(rails.buttonClickSelector,"click.rails",function(e){var button=$(this);if(!rails.allowAction(button)||!rails.isRemote(button))return rails.stopEverything(e);button.is(rails.buttonDisableSelector)&&rails.disableFormElement(button);var handleRemote=rails.handleRemote(button);return handleRemote===!1?rails.enableFormElement(button):handleRemote.fail(function(){rails.enableFormElement(button)}),!1}),$document.delegate(rails.inputChangeSelector,"change.rails",function(e){var link=$(this);return rails.allowAction(link)&&rails.isRemote(link)?(rails.handleRemote(link),!1):rails.stopEverything(e)}),$document.delegate(rails.formSubmitSelector,"submit.rails",function(e){var blankRequiredInputs,nonBlankFileInputs,form=$(this),remote=rails.isRemote(form);if(!rails.allowAction(form))return rails.stopEverything(e);if(form.attr("novalidate")===undefined)if(form.data("ujs:formnovalidate-button")===undefined){if(blankRequiredInputs=rails.blankInputs(form,rails.requiredInputSelector,!1),blankRequiredInputs&&rails.fire(form,"ajax:aborted:required",[blankRequiredInputs]))return rails.stopEverything(e)}else form.data("ujs:formnovalidate-button",undefined);if(remote){if(nonBlankFileInputs=rails.nonBlankInputs(form,rails.fileInputSelector)){setTimeout(function(){rails.disableFormElements(form)},13);var aborted=rails.fire(form,"ajax:aborted:file",[nonBlankFileInputs]);return aborted||setTimeout(function(){rails.enableFormElements(form)},13),aborted}return rails.handleRemote(form),!1}setTimeout(function(){rails.disableFormElements(form)},13)}),$document.delegate(rails.formInputClickSelector,"click.rails",function(event){var button=$(this);if(!rails.allowAction(button))return rails.stopEverything(event);var name=button.attr("name"),data=name?{name:name,value:button.val()}:null,form=button.closest("form");0===form.length&&(form=$("#"+button.attr("form"))),form.data("ujs:submit-button",data),form.data("ujs:formnovalidate-button",button.attr("formnovalidate")),form.data("ujs:submit-button-formaction",button.attr("formaction")),form.data("ujs:submit-button-formmethod",button.attr("formmethod"))}),$document.delegate(rails.formSubmitSelector,"ajax:send.rails",function(event){this===event.target&&rails.disableFormElements($(this))}),$document.delegate(rails.formSubmitSelector,"ajax:complete.rails",function(event){this===event.target&&rails.enableFormElements($(this))}),$(function(){rails.refreshCSRFTokens()}))}(jQuery),function($,w){$.fn.picturefill=function(){var HIGH_DENSITY_PLACEHOLDER=":highdensity",HIGH_DENSITY_VALUE="(-webkit-min-device-pixel-ratio: 1.5), (min--moz-device-pixel-ratio: 1.5), (min-device-pixel-ratio: 1.5), (min-resolution: 144dppx)";if(this.find("span[data-picture]").each(function(){for(var media,sources=this.getElementsByTagName("span"),matches=[],i=0,len=sources.length;len>i;i++)media=sources[i].getAttribute("data-media"),media===HIGH_DENSITY_PLACEHOLDER&&(media=HIGH_DENSITY_VALUE),(!media||Modernizr.mq(media))&&matches.push(sources[i]);var img=this.getElementsByTagName("img")[0];if(matches.length){var match=matches.pop();img||(img=w.document.createElement("img"),img.alt=this.getAttribute("data-alt")),img.src=match.getAttribute("data-src"),match.appendChild(img)}else img&&this.removeChild(img)}),!this.data("picturefill-events-setup")){if(w.addEventListener){var _this=this;w.addEventListener("resize",function(){_this.picturefill()},!1)}this.data("picturefill-events-setup",!0)}return this}}(jQuery,window),/*! jQuery UI - v1.9.1 - 2012-11-14
* http://jqueryui.com
* Includes: jquery.ui.core.js, jquery.ui.widget.js, jquery.ui.mouse.js, jquery.ui.draggable.js, jquery.ui.droppable.js, jquery.ui.sortable.js
* Copyright (c) 2012 jQuery Foundation and other contributors Licensed MIT */
function($,undefined){function focusable(element,isTabIndexNotNaN){var map,mapName,img,nodeName=element.nodeName.toLowerCase();return"area"===nodeName?(map=element.parentNode,mapName=map.name,element.href&&mapName&&"map"===map.nodeName.toLowerCase()?(img=$("img[usemap=#"+mapName+"]")[0],!!img&&visible(img)):!1):(/input|select|textarea|button|object/.test(nodeName)?!element.disabled:"a"===nodeName?element.href||isTabIndexNotNaN:isTabIndexNotNaN)&&visible(element)}function visible(element){return $.expr.filters.visible(element)&&!$(element).parents().andSelf().filter(function(){return"hidden"===$.css(this,"visibility")}).length}var uuid=0,runiqueId=/^ui-id-\d+$/;$.ui=$.ui||{},$.ui.version||($.extend($.ui,{version:"1.9.1",keyCode:{BACKSPACE:8,COMMA:188,DELETE:46,DOWN:40,END:35,ENTER:13,ESCAPE:27,HOME:36,LEFT:37,NUMPAD_ADD:107,NUMPAD_DECIMAL:110,NUMPAD_DIVIDE:111,NUMPAD_ENTER:108,NUMPAD_MULTIPLY:106,NUMPAD_SUBTRACT:109,PAGE_DOWN:34,PAGE_UP:33,PERIOD:190,RIGHT:39,SPACE:32,TAB:9,UP:38}}),$.fn.extend({_focus:$.fn.focus,focus:function(delay,fn){return"number"==typeof delay?this.each(function(){var elem=this;setTimeout(function(){$(elem).focus(),fn&&fn.call(elem)},delay)}):this._focus.apply(this,arguments)},scrollParent:function(){var scrollParent;return scrollParent=$.ui.ie&&/(static|relative)/.test(this.css("position"))||/absolute/.test(this.css("position"))?this.parents().filter(function(){return/(relative|absolute|fixed)/.test($.css(this,"position"))&&/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0):this.parents().filter(function(){return/(auto|scroll)/.test($.css(this,"overflow")+$.css(this,"overflow-y")+$.css(this,"overflow-x"))}).eq(0),/fixed/.test(this.css("position"))||!scrollParent.length?$(document):scrollParent},zIndex:function(zIndex){if(zIndex!==undefined)return this.css("zIndex",zIndex);if(this.length)for(var position,value,elem=$(this[0]);elem.length&&elem[0]!==document;){if(position=elem.css("position"),("absolute"===position||"relative"===position||"fixed"===position)&&(value=parseInt(elem.css("zIndex"),10),!isNaN(value)&&0!==value))return value;elem=elem.parent()}return 0},uniqueId:function(){return this.each(function(){this.id||(this.id="ui-id-"+ ++uuid)})},removeUniqueId:function(){return this.each(function(){runiqueId.test(this.id)&&$(this).removeAttr("id")})}}),$("<a>").outerWidth(1).jquery||$.each(["Width","Height"],function(i,name){function reduce(elem,size,border,margin){return $.each(side,function(){size-=parseFloat($.css(elem,"padding"+this))||0,border&&(size-=parseFloat($.css(elem,"border"+this+"Width"))||0),margin&&(size-=parseFloat($.css(elem,"margin"+this))||0)}),size}var side="Width"===name?["Left","Right"]:["Top","Bottom"],type=name.toLowerCase(),orig={innerWidth:$.fn.innerWidth,innerHeight:$.fn.innerHeight,outerWidth:$.fn.outerWidth,outerHeight:$.fn.outerHeight};$.fn["inner"+name]=function(size){return size===undefined?orig["inner"+name].call(this):this.each(function(){$(this).css(type,reduce(this,size)+"px")})},$.fn["outer"+name]=function(size,margin){return"number"!=typeof size?orig["outer"+name].call(this,size):this.each(function(){$(this).css(type,reduce(this,size,!0,margin)+"px")})}}),$.extend($.expr[":"],{data:$.expr.createPseudo?$.expr.createPseudo(function(dataName){return function(elem){return!!$.data(elem,dataName)}}):function(elem,i,match){return!!$.data(elem,match[3])},focusable:function(element){return focusable(element,!isNaN($.attr(element,"tabindex")))},tabbable:function(element){var tabIndex=$.attr(element,"tabindex"),isTabIndexNaN=isNaN(tabIndex);return(isTabIndexNaN||tabIndex>=0)&&focusable(element,!isTabIndexNaN)}}),$(function(){var body=document.body,div=body.appendChild(div=document.createElement("div"));div.offsetHeight,$.extend(div.style,{minHeight:"100px",height:"auto",padding:0,borderWidth:0}),$.support.minHeight=100===div.offsetHeight,$.support.selectstart="onselectstart"in div,body.removeChild(div).style.display="none"}),function(){var uaMatch=/msie ([\w.]+)/.exec(navigator.userAgent.toLowerCase())||[];$.ui.ie=uaMatch.length?!0:!1,$.ui.ie6=6===parseFloat(uaMatch[1],10)}(),$.fn.extend({disableSelection:function(){return this.bind(($.support.selectstart?"selectstart":"mousedown")+".ui-disableSelection",function(event){event.preventDefault()})},enableSelection:function(){return this.unbind(".ui-disableSelection")}}),$.extend($.ui,{plugin:{add:function(module,option,set){var i,proto=$.ui[module].prototype;for(i in set)proto.plugins[i]=proto.plugins[i]||[],proto.plugins[i].push([option,set[i]])},call:function(instance,name,args){var i,set=instance.plugins[name];if(set&&instance.element[0].parentNode&&11!==instance.element[0].parentNode.nodeType)for(i=0;i<set.length;i++)instance.options[set[i][0]]&&set[i][1].apply(instance.element,args)}},contains:$.contains,hasScroll:function(el,a){if("hidden"===$(el).css("overflow"))return!1;var scroll=a&&"left"===a?"scrollLeft":"scrollTop",has=!1;return el[scroll]>0?!0:(el[scroll]=1,has=el[scroll]>0,el[scroll]=0,has)},isOverAxis:function(x,reference,size){return x>reference&&reference+size>x},isOver:function(y,x,top,left,height,width){return $.ui.isOverAxis(y,top,height)&&$.ui.isOverAxis(x,left,width)}}))}(jQuery),function($,undefined){var uuid=0,slice=Array.prototype.slice,_cleanData=$.cleanData;$.cleanData=function(elems){for(var elem,i=0;null!=(elem=elems[i]);i++)try{$(elem).triggerHandler("remove")}catch(e){}_cleanData(elems)},$.widget=function(name,base,prototype){var fullName,existingConstructor,constructor,basePrototype,namespace=name.split(".")[0];name=name.split(".")[1],fullName=namespace+"-"+name,prototype||(prototype=base,base=$.Widget),$.expr[":"][fullName.toLowerCase()]=function(elem){return!!$.data(elem,fullName)},$[namespace]=$[namespace]||{},existingConstructor=$[namespace][name],constructor=$[namespace][name]=function(options,element){return this._createWidget?void(arguments.length&&this._createWidget(options,element)):new constructor(options,element)},$.extend(constructor,existingConstructor,{version:prototype.version,_proto:$.extend({},prototype),_childConstructors:[]}),basePrototype=new base,basePrototype.options=$.widget.extend({},basePrototype.options),$.each(prototype,function(prop,value){$.isFunction(value)&&(prototype[prop]=function(){var _super=function(){return base.prototype[prop].apply(this,arguments)},_superApply=function(args){return base.prototype[prop].apply(this,args)};return function(){var returnValue,__super=this._super,__superApply=this._superApply;return this._super=_super,this._superApply=_superApply,returnValue=value.apply(this,arguments),this._super=__super,this._superApply=__superApply,returnValue}}())}),constructor.prototype=$.widget.extend(basePrototype,{widgetEventPrefix:basePrototype.widgetEventPrefix||name},prototype,{constructor:constructor,namespace:namespace,widgetName:name,widgetBaseClass:fullName,widgetFullName:fullName}),existingConstructor?($.each(existingConstructor._childConstructors,function(i,child){var childPrototype=child.prototype;$.widget(childPrototype.namespace+"."+childPrototype.widgetName,constructor,child._proto)}),delete existingConstructor._childConstructors):base._childConstructors.push(constructor),$.widget.bridge(name,constructor)},$.widget.extend=function(target){for(var key,value,input=slice.call(arguments,1),inputIndex=0,inputLength=input.length;inputLength>inputIndex;inputIndex++)for(key in input[inputIndex])value=input[inputIndex][key],input[inputIndex].hasOwnProperty(key)&&value!==undefined&&($.isPlainObject(value)?target[key]=$.isPlainObject(target[key])?$.widget.extend({},target[key],value):$.widget.extend({},value):target[key]=value);return target},$.widget.bridge=function(name,object){var fullName=object.prototype.widgetFullName;$.fn[name]=function(options){var isMethodCall="string"==typeof options,args=slice.call(arguments,1),returnValue=this;return options=!isMethodCall&&args.length?$.widget.extend.apply(null,[options].concat(args)):options,isMethodCall?this.each(function(){var methodValue,instance=$.data(this,fullName);return instance?$.isFunction(instance[options])&&"_"!==options.charAt(0)?(methodValue=instance[options].apply(instance,args),methodValue!==instance&&methodValue!==undefined?(returnValue=methodValue&&methodValue.jquery?returnValue.pushStack(methodValue.get()):methodValue,!1):void 0):$.error("no such method '"+options+"' for "+name+" widget instance"):$.error("cannot call methods on "+name+" prior to initialization; attempted to call method '"+options+"'")}):this.each(function(){var instance=$.data(this,fullName);instance?instance.option(options||{})._init():new object(options,this)}),returnValue}},$.Widget=function(){},$.Widget._childConstructors=[],$.Widget.prototype={widgetName:"widget",widgetEventPrefix:"",defaultElement:"<div>",options:{disabled:!1,create:null},_createWidget:function(options,element){element=$(element||this.defaultElement||this)[0],this.element=$(element),this.uuid=uuid++,this.eventNamespace="."+this.widgetName+this.uuid,this.options=$.widget.extend({},this.options,this._getCreateOptions(),options),this.bindings=$(),this.hoverable=$(),this.focusable=$(),element!==this&&($.data(element,this.widgetName,this),$.data(element,this.widgetFullName,this),this._on(this.element,{remove:function(event){event.target===element&&this.destroy()}}),this.document=$(element.style?element.ownerDocument:element.document||element),this.window=$(this.document[0].defaultView||this.document[0].parentWindow)),this._create(),this._trigger("create",null,this._getCreateEventData()),this._init()},_getCreateOptions:$.noop,_getCreateEventData:$.noop,_create:$.noop,_init:$.noop,destroy:function(){this._destroy(),this.element.unbind(this.eventNamespace).removeData(this.widgetName).removeData(this.widgetFullName).removeData($.camelCase(this.widgetFullName)),this.widget().unbind(this.eventNamespace).removeAttr("aria-disabled").removeClass(this.widgetFullName+"-disabled ui-state-disabled"),this.bindings.unbind(this.eventNamespace),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")},_destroy:$.noop,widget:function(){return this.element},option:function(key,value){var parts,curOption,i,options=key;if(0===arguments.length)return $.widget.extend({},this.options);if("string"==typeof key)if(options={},parts=key.split("."),key=parts.shift(),parts.length){for(curOption=options[key]=$.widget.extend({},this.options[key]),i=0;i<parts.length-1;i++)curOption[parts[i]]=curOption[parts[i]]||{},curOption=curOption[parts[i]];if(key=parts.pop(),value===undefined)return curOption[key]===undefined?null:curOption[key];curOption[key]=value}else{if(value===undefined)return this.options[key]===undefined?null:this.options[key];options[key]=value}return this._setOptions(options),this},_setOptions:function(options){var key;for(key in options)this._setOption(key,options[key]);return this},_setOption:function(key,value){return this.options[key]=value,"disabled"===key&&(this.widget().toggleClass(this.widgetFullName+"-disabled ui-state-disabled",!!value).attr("aria-disabled",value),this.hoverable.removeClass("ui-state-hover"),this.focusable.removeClass("ui-state-focus")),this},enable:function(){return this._setOption("disabled",!1)},disable:function(){return this._setOption("disabled",!0)},_on:function(element,handlers){var delegateElement,instance=this;handlers?(element=delegateElement=$(element),this.bindings=this.bindings.add(element)):(handlers=element,element=this.element,delegateElement=this.widget()),$.each(handlers,function(event,handler){function handlerProxy(){return instance.options.disabled===!0||$(this).hasClass("ui-state-disabled")?void 0:("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}"string"!=typeof handler&&(handlerProxy.guid=handler.guid=handler.guid||handlerProxy.guid||$.guid++);var match=event.match(/^(\w+)\s*(.*)$/),eventName=match[1]+instance.eventNamespace,selector=match[2];selector?delegateElement.delegate(selector,eventName,handlerProxy):element.bind(eventName,handlerProxy)})},_off:function(element,eventName){eventName=(eventName||"").split(" ").join(this.eventNamespace+" ")+this.eventNamespace,element.unbind(eventName).undelegate(eventName)},_delay:function(handler,delay){function handlerProxy(){return("string"==typeof handler?instance[handler]:handler).apply(instance,arguments)}var instance=this;return setTimeout(handlerProxy,delay||0)},_hoverable:function(element){this.hoverable=this.hoverable.add(element),this._on(element,{mouseenter:function(event){$(event.currentTarget).addClass("ui-state-hover")},mouseleave:function(event){$(event.currentTarget).removeClass("ui-state-hover")}})},_focusable:function(element){this.focusable=this.focusable.add(element),this._on(element,{focusin:function(event){$(event.currentTarget).addClass("ui-state-focus")},focusout:function(event){$(event.currentTarget).removeClass("ui-state-focus")}})},_trigger:function(type,event,data){var prop,orig,callback=this.options[type];if(data=data||{},event=$.Event(event),event.type=(type===this.widgetEventPrefix?type:this.widgetEventPrefix+type).toLowerCase(),event.target=this.element[0],orig=event.originalEvent)for(prop in orig)prop in event||(event[prop]=orig[prop]);return this.element.trigger(event,data),!($.isFunction(callback)&&callback.apply(this.element[0],[event].concat(data))===!1||event.isDefaultPrevented())}},$.each({show:"fadeIn",hide:"fadeOut"},function(method,defaultEffect){$.Widget.prototype["_"+method]=function(element,options,callback){"string"==typeof options&&(options={effect:options});var hasOptions,effectName=options?options===!0||"number"==typeof options?defaultEffect:options.effect||defaultEffect:method;options=options||{},"number"==typeof options&&(options={duration:options}),hasOptions=!$.isEmptyObject(options),options.complete=callback,options.delay&&element.delay(options.delay),hasOptions&&$.effects&&($.effects.effect[effectName]||$.uiBackCompat!==!1&&$.effects[effectName])?element[method](options):effectName!==method&&element[effectName]?element[effectName](options.duration,options.easing,callback):element.queue(function(next){$(this)[method](),callback&&callback.call(element[0]),next()})}}),$.uiBackCompat!==!1&&($.Widget.prototype._getCreateOptions=function(){return $.metadata&&$.metadata.get(this.element[0])[this.widgetName]})}(jQuery),function($,undefined){var mouseHandled=!1;$(document).mouseup(function(e){mouseHandled=!1}),$.widget("ui.mouse",{version:"1.9.1",options:{cancel:"input,textarea,button,select,option",distance:1,delay:0},_mouseInit:function(){var that=this;this.element.bind("mousedown."+this.widgetName,function(event){return that._mouseDown(event)}).bind("click."+this.widgetName,function(event){return!0===$.data(event.target,that.widgetName+".preventClickEvent")?($.removeData(event.target,that.widgetName+".preventClickEvent"),event.stopImmediatePropagation(),!1):void 0}),this.started=!1},_mouseDestroy:function(){this.element.unbind("."+this.widgetName),this._mouseMoveDelegate&&$(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate)},_mouseDown:function(event){if(!mouseHandled){this._mouseStarted&&this._mouseUp(event),this._mouseDownEvent=event;var that=this,btnIsLeft=1===event.which,elIsCancel="string"==typeof this.options.cancel&&event.target.nodeName?$(event.target).closest(this.options.cancel).length:!1;return btnIsLeft&&!elIsCancel&&this._mouseCapture(event)?(this.mouseDelayMet=!this.options.delay,this.mouseDelayMet||(this._mouseDelayTimer=setTimeout(function(){that.mouseDelayMet=!0},this.options.delay)),this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(event)!==!1,!this._mouseStarted)?(event.preventDefault(),!0):(!0===$.data(event.target,this.widgetName+".preventClickEvent")&&$.removeData(event.target,this.widgetName+".preventClickEvent"),this._mouseMoveDelegate=function(event){return that._mouseMove(event)},this._mouseUpDelegate=function(event){return that._mouseUp(event)},$(document).bind("mousemove."+this.widgetName,this._mouseMoveDelegate).bind("mouseup."+this.widgetName,this._mouseUpDelegate),event.preventDefault(),mouseHandled=!0,!0)):!0}},_mouseMove:function(event){return!$.ui.ie||document.documentMode>=9||event.button?this._mouseStarted?(this._mouseDrag(event),event.preventDefault()):(this._mouseDistanceMet(event)&&this._mouseDelayMet(event)&&(this._mouseStarted=this._mouseStart(this._mouseDownEvent,event)!==!1,this._mouseStarted?this._mouseDrag(event):this._mouseUp(event)),!this._mouseStarted):this._mouseUp(event)},_mouseUp:function(event){return $(document).unbind("mousemove."+this.widgetName,this._mouseMoveDelegate).unbind("mouseup."+this.widgetName,this._mouseUpDelegate),this._mouseStarted&&(this._mouseStarted=!1,event.target===this._mouseDownEvent.target&&$.data(event.target,this.widgetName+".preventClickEvent",!0),this._mouseStop(event)),!1},_mouseDistanceMet:function(event){return Math.max(Math.abs(this._mouseDownEvent.pageX-event.pageX),Math.abs(this._mouseDownEvent.pageY-event.pageY))>=this.options.distance},_mouseDelayMet:function(event){return this.mouseDelayMet},_mouseStart:function(event){},_mouseDrag:function(event){},_mouseStop:function(event){},_mouseCapture:function(event){return!0}})}(jQuery),function($,undefined){$.widget("ui.draggable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"drag",options:{addClasses:!0,appendTo:"parent",axis:!1,connectToSortable:!1,containment:!1,cursor:"auto",cursorAt:!1,grid:!1,handle:!1,helper:"original",iframeFix:!1,opacity:!1,refreshPositions:!1,revert:!1,revertDuration:500,scope:"default",scroll:!0,scrollSensitivity:20,scrollSpeed:20,snap:!1,snapMode:"both",snapTolerance:20,stack:!1,zIndex:!1},_create:function(){"original"!=this.options.helper||/^(?:r|a|f)/.test(this.element.css("position"))||(this.element[0].style.position="relative"),this.options.addClasses&&this.element.addClass("ui-draggable"),this.options.disabled&&this.element.addClass("ui-draggable-disabled"),this._mouseInit()},_destroy:function(){this.element.removeClass("ui-draggable ui-draggable-dragging ui-draggable-disabled"),this._mouseDestroy()},_mouseCapture:function(event){var o=this.options;return this.helper||o.disabled||$(event.target).is(".ui-resizable-handle")?!1:(this.handle=this._getHandle(event),this.handle?($(o.iframeFix===!0?"iframe":o.iframeFix).each(function(){$('<div class="ui-draggable-iframeFix" style="background: #fff;"></div>').css({width:this.offsetWidth+"px",height:this.offsetHeight+"px",position:"absolute",opacity:"0.001",zIndex:1e3}).css($(this).offset()).appendTo("body")}),!0):!1)},_mouseStart:function(event){var o=this.options;return this.helper=this._createHelper(event),this.helper.addClass("ui-draggable-dragging"),this._cacheHelperProportions(),$.ui.ddmanager&&($.ui.ddmanager.current=this),this._cacheMargins(),this.cssPosition=this.helper.css("position"),this.scrollParent=this.helper.scrollParent(),this.offset=this.positionAbs=this.element.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.originalPosition=this.position=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),o.containment&&this._setContainment(),this._trigger("start",event)===!1?(this._clear(),!1):(this._cacheHelperProportions(),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this._mouseDrag(event,!0),$.ui.ddmanager&&$.ui.ddmanager.dragStart(this,event),!0)},_mouseDrag:function(event,noPropagation){if(this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo("absolute"),!noPropagation){var ui=this._uiHash();if(this._trigger("drag",event,ui)===!1)return this._mouseUp({}),!1;this.position=ui.position}return this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px"),$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),!1},_mouseStop:function(event){var dropped=!1;$.ui.ddmanager&&!this.options.dropBehaviour&&(dropped=$.ui.ddmanager.drop(this,event)),this.dropped&&(dropped=this.dropped,this.dropped=!1);for(var element=this.element[0],elementInDom=!1;element&&(element=element.parentNode);)element==document&&(elementInDom=!0);if(!elementInDom&&"original"===this.options.helper)return!1;if("invalid"==this.options.revert&&!dropped||"valid"==this.options.revert&&dropped||this.options.revert===!0||$.isFunction(this.options.revert)&&this.options.revert.call(this.element,dropped)){var that=this;$(this.helper).animate(this.originalPosition,parseInt(this.options.revertDuration,10),function(){that._trigger("stop",event)!==!1&&that._clear()})}else this._trigger("stop",event)!==!1&&this._clear();return!1},_mouseUp:function(event){return $("div.ui-draggable-iframeFix").each(function(){this.parentNode.removeChild(this)}),$.ui.ddmanager&&$.ui.ddmanager.dragStop(this,event),$.ui.mouse.prototype._mouseUp.call(this,event)},cancel:function(){return this.helper.is(".ui-draggable-dragging")?this._mouseUp({}):this._clear(),this},_getHandle:function(event){var handle=this.options.handle&&$(this.options.handle,this.element).length?!1:!0;return $(this.options.handle,this.element).find("*").andSelf().each(function(){this==event.target&&(handle=!0)}),handle},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event])):"clone"==o.helper?this.element.clone().removeAttr("id"):this.element;return helper.parents("body").length||helper.appendTo("parent"==o.appendTo?this.element[0].parentNode:o.appendTo),helper[0]==this.element[0]||/(fixed|absolute)/.test(helper.css("position"))||helper.css("position","absolute"),helper},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var p=this.element.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.element.css("marginLeft"),10)||0,top:parseInt(this.element.css("marginTop"),10)||0,right:parseInt(this.element.css("marginRight"),10)||0,bottom:parseInt(this.element.css("marginBottom"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;if("parent"==o.containment&&(o.containment=this.helper[0].parentNode),("document"==o.containment||"window"==o.containment)&&(this.containment=["document"==o.containment?0:$(window).scrollLeft()-this.offset.relative.left-this.offset.parent.left,"document"==o.containment?0:$(window).scrollTop()-this.offset.relative.top-this.offset.parent.top,("document"==o.containment?0:$(window).scrollLeft())+$("document"==o.containment?document:window).width()-this.helperProportions.width-this.margins.left,("document"==o.containment?0:$(window).scrollTop())+($("document"==o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),/^(document|window|parent)$/.test(o.containment)||o.containment.constructor==Array)o.containment.constructor==Array&&(this.containment=o.containment);else{var c=$(o.containment),ce=c[0];if(!ce)return;var over=(c.offset(),"hidden"!=$(ce).css("overflow"));this.containment=[(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0),(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0),(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left-this.margins.right,(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top-this.margins.bottom],this.relative_container=c}},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"==d?1:-1,scroll=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var o=this.options,scroll="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName),pageX=event.pageX,pageY=event.pageY;if(this.originalPosition){var containment;if(this.containment){if(this.relative_container){var co=this.relative_container.offset();containment=[this.containment[0]+co.left,this.containment[1]+co.top,this.containment[2]+co.left,this.containment[3]+co.top]}else containment=this.containment;event.pageX-this.offset.click.left<containment[0]&&(pageX=containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<containment[1]&&(pageY=containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>containment[2]&&(pageX=containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>containment[3]&&(pageY=containment[3]+this.offset.click.top)}if(o.grid){var top=o.grid[1]?this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1]:this.originalPageY;pageY=containment&&(top-this.offset.click.top<containment[1]||top-this.offset.click.top>containment[3])?top-this.offset.click.top<containment[1]?top+o.grid[1]:top-o.grid[1]:top;var left=o.grid[0]?this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0]:this.originalPageX;pageX=containment&&(left-this.offset.click.left<containment[0]||left-this.offset.click.left>containment[2])?left-this.offset.click.left<containment[0]?left+o.grid[0]:left-o.grid[0]:left}}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_clear:function(){this.helper.removeClass("ui-draggable-dragging"),this.helper[0]==this.element[0]||this.cancelHelperRemoval||this.helper.remove(),this.helper=null,this.cancelHelperRemoval=!1},_trigger:function(type,event,ui){return ui=ui||this._uiHash(),$.ui.plugin.call(this,type,[event,ui]),"drag"==type&&(this.positionAbs=this._convertPositionTo("absolute")),$.Widget.prototype._trigger.call(this,type,event,ui)},plugins:{},_uiHash:function(event){return{helper:this.helper,position:this.position,originalPosition:this.originalPosition,offset:this.positionAbs}}}),$.ui.plugin.add("draggable","connectToSortable",{start:function(event,ui){var inst=$(this).data("draggable"),o=inst.options,uiSortable=$.extend({},ui,{item:inst.element});inst.sortables=[],$(o.connectToSortable).each(function(){var sortable=$.data(this,"sortable");sortable&&!sortable.options.disabled&&(inst.sortables.push({instance:sortable,shouldRevert:sortable.options.revert}),sortable.refreshPositions(),sortable._trigger("activate",event,uiSortable))})},stop:function(event,ui){var inst=$(this).data("draggable"),uiSortable=$.extend({},ui,{item:inst.element});$.each(inst.sortables,function(){this.instance.isOver?(this.instance.isOver=0,inst.cancelHelperRemoval=!0,this.instance.cancelHelperRemoval=!1,this.shouldRevert&&(this.instance.options.revert=!0),this.instance._mouseStop(event),this.instance.options.helper=this.instance.options._helper,"original"==inst.options.helper&&this.instance.currentItem.css({top:"auto",left:"auto"})):(this.instance.cancelHelperRemoval=!1,this.instance._trigger("deactivate",event,uiSortable))})},drag:function(event,ui){var inst=$(this).data("draggable"),that=this;$.each(inst.sortables,function(i){var innermostIntersecting=!1,thisSortable=this;this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this.instance._intersectsWith(this.instance.containerCache)&&(innermostIntersecting=!0,$.each(inst.sortables,function(){return this.instance.positionAbs=inst.positionAbs,this.instance.helperProportions=inst.helperProportions,this.instance.offset.click=inst.offset.click,this!=thisSortable&&this.instance._intersectsWith(this.instance.containerCache)&&$.ui.contains(thisSortable.instance.element[0],this.instance.element[0])&&(innermostIntersecting=!1),innermostIntersecting})),innermostIntersecting?(this.instance.isOver||(this.instance.isOver=1,this.instance.currentItem=$(that).clone().removeAttr("id").appendTo(this.instance.element).data("sortable-item",!0),this.instance.options._helper=this.instance.options.helper,this.instance.options.helper=function(){return ui.helper[0]},event.target=this.instance.currentItem[0],this.instance._mouseCapture(event,!0),this.instance._mouseStart(event,!0,!0),this.instance.offset.click.top=inst.offset.click.top,this.instance.offset.click.left=inst.offset.click.left,this.instance.offset.parent.left-=inst.offset.parent.left-this.instance.offset.parent.left,this.instance.offset.parent.top-=inst.offset.parent.top-this.instance.offset.parent.top,inst._trigger("toSortable",event),inst.dropped=this.instance.element,inst.currentItem=inst.element,this.instance.fromOutside=inst),this.instance.currentItem&&this.instance._mouseDrag(event)):this.instance.isOver&&(this.instance.isOver=0,this.instance.cancelHelperRemoval=!0,this.instance.options.revert=!1,this.instance._trigger("out",event,this.instance._uiHash(this.instance)),this.instance._mouseStop(event,!0),this.instance.options.helper=this.instance.options._helper,this.instance.currentItem.remove(),this.instance.placeholder&&this.instance.placeholder.remove(),inst._trigger("fromSortable",event),inst.dropped=!1)})}}),$.ui.plugin.add("draggable","cursor",{start:function(event,ui){var t=$("body"),o=$(this).data("draggable").options;t.css("cursor")&&(o._cursor=t.css("cursor")),t.css("cursor",o.cursor)},stop:function(event,ui){var o=$(this).data("draggable").options;o._cursor&&$("body").css("cursor",o._cursor)}}),$.ui.plugin.add("draggable","opacity",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;t.css("opacity")&&(o._opacity=t.css("opacity")),t.css("opacity",o.opacity)},stop:function(event,ui){var o=$(this).data("draggable").options;o._opacity&&$(ui.helper).css("opacity",o._opacity)}}),$.ui.plugin.add("draggable","scroll",{start:function(event,ui){var i=$(this).data("draggable");i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName&&(i.overflowOffset=i.scrollParent.offset())},drag:function(event,ui){var i=$(this).data("draggable"),o=i.options,scrolled=!1;i.scrollParent[0]!=document&&"HTML"!=i.scrollParent[0].tagName?(o.axis&&"x"==o.axis||(i.overflowOffset.top+i.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-i.overflowOffset.top<o.scrollSensitivity&&(i.scrollParent[0].scrollTop=scrolled=i.scrollParent[0].scrollTop-o.scrollSpeed)),
o.axis&&"y"==o.axis||(i.overflowOffset.left+i.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-i.overflowOffset.left<o.scrollSensitivity&&(i.scrollParent[0].scrollLeft=scrolled=i.scrollParent[0].scrollLeft-o.scrollSpeed))):(o.axis&&"x"==o.axis||(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed))),o.axis&&"y"==o.axis||(event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed)))),scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(i,event)}}),$.ui.plugin.add("draggable","snap",{start:function(event,ui){var i=$(this).data("draggable"),o=i.options;i.snapElements=[],$(o.snap.constructor!=String?o.snap.items||":data(draggable)":o.snap).each(function(){var $t=$(this),$o=$t.offset();this!=i.element[0]&&i.snapElements.push({item:this,width:$t.outerWidth(),height:$t.outerHeight(),top:$o.top,left:$o.left})})},drag:function(event,ui){for(var inst=$(this).data("draggable"),o=inst.options,d=o.snapTolerance,x1=ui.offset.left,x2=x1+inst.helperProportions.width,y1=ui.offset.top,y2=y1+inst.helperProportions.height,i=inst.snapElements.length-1;i>=0;i--){var l=inst.snapElements[i].left,r=l+inst.snapElements[i].width,t=inst.snapElements[i].top,b=t+inst.snapElements[i].height;if(x1>l-d&&r+d>x1&&y1>t-d&&b+d>y1||x1>l-d&&r+d>x1&&y2>t-d&&b+d>y2||x2>l-d&&r+d>x2&&y1>t-d&&b+d>y1||x2>l-d&&r+d>x2&&y2>t-d&&b+d>y2){if("inner"!=o.snapMode){var ts=Math.abs(t-y2)<=d,bs=Math.abs(b-y1)<=d,ls=Math.abs(l-x2)<=d,rs=Math.abs(r-x1)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t-inst.helperProportions.height,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l-inst.helperProportions.width}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r}).left-inst.margins.left)}var first=ts||bs||ls||rs;if("outer"!=o.snapMode){var ts=Math.abs(t-y1)<=d,bs=Math.abs(b-y2)<=d,ls=Math.abs(l-x1)<=d,rs=Math.abs(r-x2)<=d;ts&&(ui.position.top=inst._convertPositionTo("relative",{top:t,left:0}).top-inst.margins.top),bs&&(ui.position.top=inst._convertPositionTo("relative",{top:b-inst.helperProportions.height,left:0}).top-inst.margins.top),ls&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:l}).left-inst.margins.left),rs&&(ui.position.left=inst._convertPositionTo("relative",{top:0,left:r-inst.helperProportions.width}).left-inst.margins.left)}!inst.snapElements[i].snapping&&(ts||bs||ls||rs||first)&&inst.options.snap.snap&&inst.options.snap.snap.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=ts||bs||ls||rs||first}else inst.snapElements[i].snapping&&inst.options.snap.release&&inst.options.snap.release.call(inst.element,event,$.extend(inst._uiHash(),{snapItem:inst.snapElements[i].item})),inst.snapElements[i].snapping=!1}}}),$.ui.plugin.add("draggable","stack",{start:function(event,ui){var o=$(this).data("draggable").options,group=$.makeArray($(o.stack)).sort(function(a,b){return(parseInt($(a).css("zIndex"),10)||0)-(parseInt($(b).css("zIndex"),10)||0)});if(group.length){var min=parseInt(group[0].style.zIndex)||0;$(group).each(function(i){this.style.zIndex=min+i}),this[0].style.zIndex=min+group.length}}}),$.ui.plugin.add("draggable","zIndex",{start:function(event,ui){var t=$(ui.helper),o=$(this).data("draggable").options;t.css("zIndex")&&(o._zIndex=t.css("zIndex")),t.css("zIndex",o.zIndex)},stop:function(event,ui){var o=$(this).data("draggable").options;o._zIndex&&$(ui.helper).css("zIndex",o._zIndex)}})}(jQuery),function($,undefined){$.widget("ui.droppable",{version:"1.9.1",widgetEventPrefix:"drop",options:{accept:"*",activeClass:!1,addClasses:!0,greedy:!1,hoverClass:!1,scope:"default",tolerance:"intersect"},_create:function(){var o=this.options,accept=o.accept;this.isover=0,this.isout=1,this.accept=$.isFunction(accept)?accept:function(d){return d.is(accept)},this.proportions={width:this.element[0].offsetWidth,height:this.element[0].offsetHeight},$.ui.ddmanager.droppables[o.scope]=$.ui.ddmanager.droppables[o.scope]||[],$.ui.ddmanager.droppables[o.scope].push(this),o.addClasses&&this.element.addClass("ui-droppable")},_destroy:function(){for(var drop=$.ui.ddmanager.droppables[this.options.scope],i=0;i<drop.length;i++)drop[i]==this&&drop.splice(i,1);this.element.removeClass("ui-droppable ui-droppable-disabled")},_setOption:function(key,value){"accept"==key&&(this.accept=$.isFunction(value)?value:function(d){return d.is(value)}),$.Widget.prototype._setOption.apply(this,arguments)},_activate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.addClass(this.options.activeClass),draggable&&this._trigger("activate",event,this.ui(draggable))},_deactivate:function(event){var draggable=$.ui.ddmanager.current;this.options.activeClass&&this.element.removeClass(this.options.activeClass),draggable&&this._trigger("deactivate",event,this.ui(draggable))},_over:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!=this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.addClass(this.options.hoverClass),this._trigger("over",event,this.ui(draggable)))},_out:function(event){var draggable=$.ui.ddmanager.current;draggable&&(draggable.currentItem||draggable.element)[0]!=this.element[0]&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("out",event,this.ui(draggable)))},_drop:function(event,custom){var draggable=custom||$.ui.ddmanager.current;if(!draggable||(draggable.currentItem||draggable.element)[0]==this.element[0])return!1;var childrenIntersection=!1;return this.element.find(":data(droppable)").not(".ui-draggable-dragging").each(function(){var inst=$.data(this,"droppable");return inst.options.greedy&&!inst.options.disabled&&inst.options.scope==draggable.options.scope&&inst.accept.call(inst.element[0],draggable.currentItem||draggable.element)&&$.ui.intersect(draggable,$.extend(inst,{offset:inst.element.offset()}),inst.options.tolerance)?(childrenIntersection=!0,!1):void 0}),childrenIntersection?!1:this.accept.call(this.element[0],draggable.currentItem||draggable.element)?(this.options.activeClass&&this.element.removeClass(this.options.activeClass),this.options.hoverClass&&this.element.removeClass(this.options.hoverClass),this._trigger("drop",event,this.ui(draggable)),this.element):!1},ui:function(c){return{draggable:c.currentItem||c.element,helper:c.helper,position:c.position,offset:c.positionAbs}}}),$.ui.intersect=function(draggable,droppable,toleranceMode){if(!droppable.offset)return!1;var x1=(draggable.positionAbs||draggable.position.absolute).left,x2=x1+draggable.helperProportions.width,y1=(draggable.positionAbs||draggable.position.absolute).top,y2=y1+draggable.helperProportions.height,l=droppable.offset.left,r=l+droppable.proportions.width,t=droppable.offset.top,b=t+droppable.proportions.height;switch(toleranceMode){case"fit":return x1>=l&&r>=x2&&y1>=t&&b>=y2;case"intersect":return l<x1+draggable.helperProportions.width/2&&x2-draggable.helperProportions.width/2<r&&t<y1+draggable.helperProportions.height/2&&y2-draggable.helperProportions.height/2<b;case"pointer":var draggableLeft=(draggable.positionAbs||draggable.position.absolute).left+(draggable.clickOffset||draggable.offset.click).left,draggableTop=(draggable.positionAbs||draggable.position.absolute).top+(draggable.clickOffset||draggable.offset.click).top,isOver=$.ui.isOver(draggableTop,draggableLeft,t,l,droppable.proportions.height,droppable.proportions.width);return isOver;case"touch":return(y1>=t&&b>=y1||y2>=t&&b>=y2||t>y1&&y2>b)&&(x1>=l&&r>=x1||x2>=l&&r>=x2||l>x1&&x2>r);default:return!1}},$.ui.ddmanager={current:null,droppables:{"default":[]},prepareOffsets:function(t,event){var m=$.ui.ddmanager.droppables[t.options.scope]||[],type=event?event.type:null,list=(t.currentItem||t.element).find(":data(droppable)").andSelf();droppablesLoop:for(var i=0;i<m.length;i++)if(!(m[i].options.disabled||t&&!m[i].accept.call(m[i].element[0],t.currentItem||t.element))){for(var j=0;j<list.length;j++)if(list[j]==m[i].element[0]){m[i].proportions.height=0;continue droppablesLoop}m[i].visible="none"!=m[i].element.css("display"),m[i].visible&&("mousedown"==type&&m[i]._activate.call(m[i],event),m[i].offset=m[i].element.offset(),m[i].proportions={width:m[i].element[0].offsetWidth,height:m[i].element[0].offsetHeight})}},drop:function(draggable,event){var dropped=!1;return $.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){this.options&&(!this.options.disabled&&this.visible&&$.ui.intersect(draggable,this,this.options.tolerance)&&(dropped=this._drop.call(this,event)||dropped),!this.options.disabled&&this.visible&&this.accept.call(this.element[0],draggable.currentItem||draggable.element)&&(this.isout=1,this.isover=0,this._deactivate.call(this,event)))}),dropped},dragStart:function(draggable,event){draggable.element.parentsUntil("body").bind("scroll.droppable",function(){draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)})},drag:function(draggable,event){draggable.options.refreshPositions&&$.ui.ddmanager.prepareOffsets(draggable,event),$.each($.ui.ddmanager.droppables[draggable.options.scope]||[],function(){if(!this.options.disabled&&!this.greedyChild&&this.visible){var intersects=$.ui.intersect(draggable,this,this.options.tolerance),c=intersects||1!=this.isover?intersects&&0==this.isover?"isover":null:"isout";if(c){var parentInstance;if(this.options.greedy){var scope=this.options.scope,parent=this.element.parents(":data(droppable)").filter(function(){return $.data(this,"droppable").options.scope===scope});parent.length&&(parentInstance=$.data(parent[0],"droppable"),parentInstance.greedyChild="isover"==c?1:0)}parentInstance&&"isover"==c&&(parentInstance.isover=0,parentInstance.isout=1,parentInstance._out.call(parentInstance,event)),this[c]=1,this["isout"==c?"isover":"isout"]=0,this["isover"==c?"_over":"_out"].call(this,event),parentInstance&&"isout"==c&&(parentInstance.isout=0,parentInstance.isover=1,parentInstance._over.call(parentInstance,event))}}})},dragStop:function(draggable,event){draggable.element.parentsUntil("body").unbind("scroll.droppable"),draggable.options.refreshPositions||$.ui.ddmanager.prepareOffsets(draggable,event)}}}(jQuery),function($,undefined){$.widget("ui.sortable",$.ui.mouse,{version:"1.9.1",widgetEventPrefix:"sort",ready:!1,options:{appendTo:"parent",axis:!1,connectWith:!1,containment:!1,cursor:"auto",cursorAt:!1,dropOnEmpty:!0,forcePlaceholderSize:!1,forceHelperSize:!1,grid:!1,handle:!1,helper:"original",items:"> *",opacity:!1,placeholder:!1,revert:!1,scroll:!0,scrollSensitivity:20,scrollSpeed:20,scope:"default",tolerance:"intersect",zIndex:1e3},_create:function(){var o=this.options;this.containerCache={},this.element.addClass("ui-sortable"),this.refresh(),this.floating=this.items.length?"x"===o.axis||/left|right/.test(this.items[0].item.css("float"))||/inline|table-cell/.test(this.items[0].item.css("display")):!1,this.offset=this.element.offset(),this._mouseInit(),this.ready=!0},_destroy:function(){this.element.removeClass("ui-sortable ui-sortable-disabled"),this._mouseDestroy();for(var i=this.items.length-1;i>=0;i--)this.items[i].item.removeData(this.widgetName+"-item");return this},_setOption:function(key,value){"disabled"===key?(this.options[key]=value,this.widget().toggleClass("ui-sortable-disabled",!!value)):$.Widget.prototype._setOption.apply(this,arguments)},_mouseCapture:function(event,overrideHandle){var that=this;if(this.reverting)return!1;if(this.options.disabled||"static"==this.options.type)return!1;this._refreshItems(event);var currentItem=null;$(event.target).parents().each(function(){return $.data(this,that.widgetName+"-item")==that?(currentItem=$(this),!1):void 0});if($.data(event.target,that.widgetName+"-item")==that&&(currentItem=$(event.target)),!currentItem)return!1;if(this.options.handle&&!overrideHandle){var validHandle=!1;if($(this.options.handle,currentItem).find("*").andSelf().each(function(){this==event.target&&(validHandle=!0)}),!validHandle)return!1}return this.currentItem=currentItem,this._removeCurrentsFromItems(),!0},_mouseStart:function(event,overrideHandle,noActivation){var o=this.options;if(this.currentContainer=this,this.refreshPositions(),this.helper=this._createHelper(event),this._cacheHelperProportions(),this._cacheMargins(),this.scrollParent=this.helper.scrollParent(),this.offset=this.currentItem.offset(),this.offset={top:this.offset.top-this.margins.top,left:this.offset.left-this.margins.left},$.extend(this.offset,{click:{left:event.pageX-this.offset.left,top:event.pageY-this.offset.top},parent:this._getParentOffset(),relative:this._getRelativeOffset()}),this.helper.css("position","absolute"),this.cssPosition=this.helper.css("position"),this.originalPosition=this._generatePosition(event),this.originalPageX=event.pageX,this.originalPageY=event.pageY,o.cursorAt&&this._adjustOffsetFromHelper(o.cursorAt),this.domPosition={prev:this.currentItem.prev()[0],parent:this.currentItem.parent()[0]},this.helper[0]!=this.currentItem[0]&&this.currentItem.hide(),this._createPlaceholder(),o.containment&&this._setContainment(),o.cursor&&($("body").css("cursor")&&(this._storedCursor=$("body").css("cursor")),$("body").css("cursor",o.cursor)),o.opacity&&(this.helper.css("opacity")&&(this._storedOpacity=this.helper.css("opacity")),this.helper.css("opacity",o.opacity)),o.zIndex&&(this.helper.css("zIndex")&&(this._storedZIndex=this.helper.css("zIndex")),this.helper.css("zIndex",o.zIndex)),this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName&&(this.overflowOffset=this.scrollParent.offset()),this._trigger("start",event,this._uiHash()),this._preserveHelperProportions||this._cacheHelperProportions(),!noActivation)for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("activate",event,this._uiHash(this));return $.ui.ddmanager&&($.ui.ddmanager.current=this),$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event),this.dragging=!0,this.helper.addClass("ui-sortable-helper"),this._mouseDrag(event),!0},_mouseDrag:function(event){if(this.position=this._generatePosition(event),this.positionAbs=this._convertPositionTo("absolute"),this.lastPositionAbs||(this.lastPositionAbs=this.positionAbs),this.options.scroll){var o=this.options,scrolled=!1;this.scrollParent[0]!=document&&"HTML"!=this.scrollParent[0].tagName?(this.overflowOffset.top+this.scrollParent[0].offsetHeight-event.pageY<o.scrollSensitivity?this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop+o.scrollSpeed:event.pageY-this.overflowOffset.top<o.scrollSensitivity&&(this.scrollParent[0].scrollTop=scrolled=this.scrollParent[0].scrollTop-o.scrollSpeed),this.overflowOffset.left+this.scrollParent[0].offsetWidth-event.pageX<o.scrollSensitivity?this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft+o.scrollSpeed:event.pageX-this.overflowOffset.left<o.scrollSensitivity&&(this.scrollParent[0].scrollLeft=scrolled=this.scrollParent[0].scrollLeft-o.scrollSpeed)):(event.pageY-$(document).scrollTop()<o.scrollSensitivity?scrolled=$(document).scrollTop($(document).scrollTop()-o.scrollSpeed):$(window).height()-(event.pageY-$(document).scrollTop())<o.scrollSensitivity&&(scrolled=$(document).scrollTop($(document).scrollTop()+o.scrollSpeed)),event.pageX-$(document).scrollLeft()<o.scrollSensitivity?scrolled=$(document).scrollLeft($(document).scrollLeft()-o.scrollSpeed):$(window).width()-(event.pageX-$(document).scrollLeft())<o.scrollSensitivity&&(scrolled=$(document).scrollLeft($(document).scrollLeft()+o.scrollSpeed))),scrolled!==!1&&$.ui.ddmanager&&!o.dropBehaviour&&$.ui.ddmanager.prepareOffsets(this,event)}this.positionAbs=this._convertPositionTo("absolute"),this.options.axis&&"y"==this.options.axis||(this.helper[0].style.left=this.position.left+"px"),this.options.axis&&"x"==this.options.axis||(this.helper[0].style.top=this.position.top+"px");for(var i=this.items.length-1;i>=0;i--){var item=this.items[i],itemElement=item.item[0],intersection=this._intersectsWithPointer(item);if(intersection&&item.instance===this.currentContainer&&itemElement!=this.currentItem[0]&&this.placeholder[1==intersection?"next":"prev"]()[0]!=itemElement&&!$.contains(this.placeholder[0],itemElement)&&("semi-dynamic"==this.options.type?!$.contains(this.element[0],itemElement):!0)){if(this.direction=1==intersection?"down":"up","pointer"!=this.options.tolerance&&!this._intersectsWithSides(item))break;this._rearrange(event,item),this._trigger("change",event,this._uiHash());break}}return this._contactContainers(event),$.ui.ddmanager&&$.ui.ddmanager.drag(this,event),this._trigger("sort",event,this._uiHash()),this.lastPositionAbs=this.positionAbs,!1},_mouseStop:function(event,noPropagation){if(event){if($.ui.ddmanager&&!this.options.dropBehaviour&&$.ui.ddmanager.drop(this,event),this.options.revert){var that=this,cur=this.placeholder.offset();this.reverting=!0,$(this.helper).animate({left:cur.left-this.offset.parent.left-this.margins.left+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollLeft),top:cur.top-this.offset.parent.top-this.margins.top+(this.offsetParent[0]==document.body?0:this.offsetParent[0].scrollTop)},parseInt(this.options.revert,10)||500,function(){that._clear(event)})}else this._clear(event,noPropagation);return!1}},cancel:function(){if(this.dragging){this._mouseUp({target:null}),"original"==this.options.helper?this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper"):this.currentItem.show();for(var i=this.containers.length-1;i>=0;i--)this.containers[i]._trigger("deactivate",null,this._uiHash(this)),this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",null,this._uiHash(this)),this.containers[i].containerCache.over=0)}return this.placeholder&&(this.placeholder[0].parentNode&&this.placeholder[0].parentNode.removeChild(this.placeholder[0]),"original"!=this.options.helper&&this.helper&&this.helper[0].parentNode&&this.helper.remove(),$.extend(this,{helper:null,dragging:!1,reverting:!1,_noFinalSort:null}),this.domPosition.prev?$(this.domPosition.prev).after(this.currentItem):$(this.domPosition.parent).prepend(this.currentItem)),this},serialize:function(o){var items=this._getItemsAsjQuery(o&&o.connected),str=[];return o=o||{},$(items).each(function(){var res=($(o.item||this).attr(o.attribute||"id")||"").match(o.expression||/(.+)[-=_](.+)/);res&&str.push((o.key||res[1]+"[]")+"="+(o.key&&o.expression?res[1]:res[2]))}),!str.length&&o.key&&str.push(o.key+"="),str.join("&")},toArray:function(o){var items=this._getItemsAsjQuery(o&&o.connected),ret=[];return o=o||{},items.each(function(){ret.push($(o.item||this).attr(o.attribute||"id")||"")}),ret},_intersectsWith:function(item){var x1=this.positionAbs.left,x2=x1+this.helperProportions.width,y1=this.positionAbs.top,y2=y1+this.helperProportions.height,l=item.left,r=l+item.width,t=item.top,b=t+item.height,dyClick=this.offset.click.top,dxClick=this.offset.click.left,isOverElement=y1+dyClick>t&&b>y1+dyClick&&x1+dxClick>l&&r>x1+dxClick;return"pointer"==this.options.tolerance||this.options.forcePointerForContainers||"pointer"!=this.options.tolerance&&this.helperProportions[this.floating?"width":"height"]>item[this.floating?"width":"height"]?isOverElement:l<x1+this.helperProportions.width/2&&x2-this.helperProportions.width/2<r&&t<y1+this.helperProportions.height/2&&y2-this.helperProportions.height/2<b},_intersectsWithPointer:function(item){var isOverElementHeight="x"===this.options.axis||$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top,item.height),isOverElementWidth="y"===this.options.axis||$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left,item.width),isOverElement=isOverElementHeight&&isOverElementWidth,verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return isOverElement?this.floating?horizontalDirection&&"right"==horizontalDirection||"down"==verticalDirection?2:1:verticalDirection&&("down"==verticalDirection?2:1):!1},_intersectsWithSides:function(item){var isOverBottomHalf=$.ui.isOverAxis(this.positionAbs.top+this.offset.click.top,item.top+item.height/2,item.height),isOverRightHalf=$.ui.isOverAxis(this.positionAbs.left+this.offset.click.left,item.left+item.width/2,item.width),verticalDirection=this._getDragVerticalDirection(),horizontalDirection=this._getDragHorizontalDirection();return this.floating&&horizontalDirection?"right"==horizontalDirection&&isOverRightHalf||"left"==horizontalDirection&&!isOverRightHalf:verticalDirection&&("down"==verticalDirection&&isOverBottomHalf||"up"==verticalDirection&&!isOverBottomHalf)},_getDragVerticalDirection:function(){var delta=this.positionAbs.top-this.lastPositionAbs.top;return 0!=delta&&(delta>0?"down":"up")},_getDragHorizontalDirection:function(){var delta=this.positionAbs.left-this.lastPositionAbs.left;return 0!=delta&&(delta>0?"right":"left")},refresh:function(event){return this._refreshItems(event),this.refreshPositions(),this},_connectWith:function(){var options=this.options;return options.connectWith.constructor==String?[options.connectWith]:options.connectWith},_getItemsAsjQuery:function(connected){var items=[],queries=[],connectWith=this._connectWith();if(connectWith&&connected)for(var i=connectWith.length-1;i>=0;i--)for(var cur=$(connectWith[i]),j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],this.widgetName);inst&&inst!=this&&!inst.options.disabled&&queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element):$(inst.options.items,inst.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),inst])}queries.push([$.isFunction(this.options.items)?this.options.items.call(this.element,null,{options:this.options,item:this.currentItem}):$(this.options.items,this.element).not(".ui-sortable-helper").not(".ui-sortable-placeholder"),this]);for(var i=queries.length-1;i>=0;i--)queries[i][0].each(function(){items.push(this)});return $(items)},_removeCurrentsFromItems:function(){var list=this.currentItem.find(":data("+this.widgetName+"-item)");this.items=$.grep(this.items,function(item){for(var j=0;j<list.length;j++)if(list[j]==item.item[0])return!1;return!0})},_refreshItems:function(event){this.items=[],this.containers=[this];var items=this.items,queries=[[$.isFunction(this.options.items)?this.options.items.call(this.element[0],event,{item:this.currentItem}):$(this.options.items,this.element),this]],connectWith=this._connectWith();if(connectWith&&this.ready)for(var i=connectWith.length-1;i>=0;i--)for(var cur=$(connectWith[i]),j=cur.length-1;j>=0;j--){var inst=$.data(cur[j],this.widgetName);inst&&inst!=this&&!inst.options.disabled&&(queries.push([$.isFunction(inst.options.items)?inst.options.items.call(inst.element[0],event,{item:this.currentItem}):$(inst.options.items,inst.element),inst]),this.containers.push(inst))}for(var i=queries.length-1;i>=0;i--)for(var targetData=queries[i][1],_queries=queries[i][0],j=0,queriesLength=_queries.length;queriesLength>j;j++){var item=$(_queries[j]);item.data(this.widgetName+"-item",targetData),items.push({item:item,instance:targetData,width:0,height:0,left:0,top:0})}},refreshPositions:function(fast){this.offsetParent&&this.helper&&(this.offset.parent=this._getParentOffset());for(var i=this.items.length-1;i>=0;i--){var item=this.items[i];if(item.instance==this.currentContainer||!this.currentContainer||item.item[0]==this.currentItem[0]){var t=this.options.toleranceElement?$(this.options.toleranceElement,item.item):item.item;fast||(item.width=t.outerWidth(),item.height=t.outerHeight());var p=t.offset();item.left=p.left,item.top=p.top}}if(this.options.custom&&this.options.custom.refreshContainers)this.options.custom.refreshContainers.call(this);else for(var i=this.containers.length-1;i>=0;i--){var p=this.containers[i].element.offset();this.containers[i].containerCache.left=p.left,this.containers[i].containerCache.top=p.top,this.containers[i].containerCache.width=this.containers[i].element.outerWidth(),this.containers[i].containerCache.height=this.containers[i].element.outerHeight()}return this},_createPlaceholder:function(that){that=that||this;var o=that.options;if(!o.placeholder||o.placeholder.constructor==String){var className=o.placeholder;o.placeholder={element:function(){var el=$(document.createElement(that.currentItem[0].nodeName)).addClass(className||that.currentItem[0].className+" ui-sortable-placeholder").removeClass("ui-sortable-helper")[0];return className||(el.style.visibility="hidden"),el},update:function(container,p){(!className||o.forcePlaceholderSize)&&(p.height()||p.height(that.currentItem.innerHeight()-parseInt(that.currentItem.css("paddingTop")||0,10)-parseInt(that.currentItem.css("paddingBottom")||0,10)),p.width()||p.width(that.currentItem.innerWidth()-parseInt(that.currentItem.css("paddingLeft")||0,10)-parseInt(that.currentItem.css("paddingRight")||0,10)))}}}that.placeholder=$(o.placeholder.element.call(that.element,that.currentItem)),that.currentItem.after(that.placeholder),o.placeholder.update(that,that.placeholder)},_contactContainers:function(event){for(var innermostContainer=null,innermostIndex=null,i=this.containers.length-1;i>=0;i--)if(!$.contains(this.currentItem[0],this.containers[i].element[0]))if(this._intersectsWith(this.containers[i].containerCache)){if(innermostContainer&&$.contains(this.containers[i].element[0],innermostContainer.element[0]))continue;innermostContainer=this.containers[i],innermostIndex=i}else this.containers[i].containerCache.over&&(this.containers[i]._trigger("out",event,this._uiHash(this)),this.containers[i].containerCache.over=0);if(innermostContainer)if(1===this.containers.length)this.containers[innermostIndex]._trigger("over",event,this._uiHash(this)),this.containers[innermostIndex].containerCache.over=1;else{for(var dist=1e4,itemWithLeastDistance=null,posProperty=this.containers[innermostIndex].floating?"left":"top",sizeProperty=this.containers[innermostIndex].floating?"width":"height",base=this.positionAbs[posProperty]+this.offset.click[posProperty],j=this.items.length-1;j>=0;j--)if($.contains(this.containers[innermostIndex].element[0],this.items[j].item[0])&&this.items[j].item[0]!=this.currentItem[0]){var cur=this.items[j].item.offset()[posProperty],nearBottom=!1;Math.abs(cur-base)>Math.abs(cur+this.items[j][sizeProperty]-base)&&(nearBottom=!0,cur+=this.items[j][sizeProperty]),Math.abs(cur-base)<dist&&(dist=Math.abs(cur-base),itemWithLeastDistance=this.items[j],this.direction=nearBottom?"up":"down")}if(!itemWithLeastDistance&&!this.options.dropOnEmpty)return;this.currentContainer=this.containers[innermostIndex],itemWithLeastDistance?this._rearrange(event,itemWithLeastDistance,null,!0):this._rearrange(event,null,this.containers[innermostIndex].element,!0),this._trigger("change",event,this._uiHash()),this.containers[innermostIndex]._trigger("change",event,this._uiHash(this)),this.options.placeholder.update(this.currentContainer,this.placeholder),this.containers[innermostIndex]._trigger("over",event,this._uiHash(this)),this.containers[innermostIndex].containerCache.over=1}},_createHelper:function(event){var o=this.options,helper=$.isFunction(o.helper)?$(o.helper.apply(this.element[0],[event,this.currentItem])):"clone"==o.helper?this.currentItem.clone():this.currentItem;return helper.parents("body").length||$("parent"!=o.appendTo?o.appendTo:this.currentItem[0].parentNode)[0].appendChild(helper[0]),helper[0]==this.currentItem[0]&&(this._storedCSS={width:this.currentItem[0].style.width,height:this.currentItem[0].style.height,position:this.currentItem.css("position"),top:this.currentItem.css("top"),left:this.currentItem.css("left")}),(""==helper[0].style.width||o.forceHelperSize)&&helper.width(this.currentItem.width()),(""==helper[0].style.height||o.forceHelperSize)&&helper.height(this.currentItem.height()),helper},_adjustOffsetFromHelper:function(obj){"string"==typeof obj&&(obj=obj.split(" ")),$.isArray(obj)&&(obj={left:+obj[0],top:+obj[1]||0}),"left"in obj&&(this.offset.click.left=obj.left+this.margins.left),"right"in obj&&(this.offset.click.left=this.helperProportions.width-obj.right+this.margins.left),"top"in obj&&(this.offset.click.top=obj.top+this.margins.top),"bottom"in obj&&(this.offset.click.top=this.helperProportions.height-obj.bottom+this.margins.top)},_getParentOffset:function(){this.offsetParent=this.helper.offsetParent();var po=this.offsetParent.offset();return"absolute"==this.cssPosition&&this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])&&(po.left+=this.scrollParent.scrollLeft(),po.top+=this.scrollParent.scrollTop()),(this.offsetParent[0]==document.body||this.offsetParent[0].tagName&&"html"==this.offsetParent[0].tagName.toLowerCase()&&$.ui.ie)&&(po={top:0,left:0}),{top:po.top+(parseInt(this.offsetParent.css("borderTopWidth"),10)||0),left:po.left+(parseInt(this.offsetParent.css("borderLeftWidth"),10)||0)}},_getRelativeOffset:function(){if("relative"==this.cssPosition){var p=this.currentItem.position();return{top:p.top-(parseInt(this.helper.css("top"),10)||0)+this.scrollParent.scrollTop(),left:p.left-(parseInt(this.helper.css("left"),10)||0)+this.scrollParent.scrollLeft()}}return{top:0,left:0}},_cacheMargins:function(){this.margins={left:parseInt(this.currentItem.css("marginLeft"),10)||0,top:parseInt(this.currentItem.css("marginTop"),10)||0}},_cacheHelperProportions:function(){this.helperProportions={width:this.helper.outerWidth(),height:this.helper.outerHeight()}},_setContainment:function(){var o=this.options;if("parent"==o.containment&&(o.containment=this.helper[0].parentNode),("document"==o.containment||"window"==o.containment)&&(this.containment=[0-this.offset.relative.left-this.offset.parent.left,0-this.offset.relative.top-this.offset.parent.top,$("document"==o.containment?document:window).width()-this.helperProportions.width-this.margins.left,($("document"==o.containment?document:window).height()||document.body.parentNode.scrollHeight)-this.helperProportions.height-this.margins.top]),!/^(document|window|parent)$/.test(o.containment)){var ce=$(o.containment)[0],co=$(o.containment).offset(),over="hidden"!=$(ce).css("overflow");this.containment=[co.left+(parseInt($(ce).css("borderLeftWidth"),10)||0)+(parseInt($(ce).css("paddingLeft"),10)||0)-this.margins.left,co.top+(parseInt($(ce).css("borderTopWidth"),10)||0)+(parseInt($(ce).css("paddingTop"),10)||0)-this.margins.top,co.left+(over?Math.max(ce.scrollWidth,ce.offsetWidth):ce.offsetWidth)-(parseInt($(ce).css("borderLeftWidth"),10)||0)-(parseInt($(ce).css("paddingRight"),10)||0)-this.helperProportions.width-this.margins.left,co.top+(over?Math.max(ce.scrollHeight,ce.offsetHeight):ce.offsetHeight)-(parseInt($(ce).css("borderTopWidth"),10)||0)-(parseInt($(ce).css("paddingBottom"),10)||0)-this.helperProportions.height-this.margins.top]}},_convertPositionTo:function(d,pos){pos||(pos=this.position);var mod="absolute"==d?1:-1,scroll=(this.options,"absolute"!=this.cssPosition||this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent),scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);return{top:pos.top+this.offset.relative.top*mod+this.offset.parent.top*mod-("fixed"==this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop())*mod,left:pos.left+this.offset.relative.left*mod+this.offset.parent.left*mod-("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())*mod}},_generatePosition:function(event){var o=this.options,scroll="absolute"!=this.cssPosition||this.scrollParent[0]!=document&&$.contains(this.scrollParent[0],this.offsetParent[0])?this.scrollParent:this.offsetParent,scrollIsRootNode=/(html|body)/i.test(scroll[0].tagName);"relative"!=this.cssPosition||this.scrollParent[0]!=document&&this.scrollParent[0]!=this.offsetParent[0]||(this.offset.relative=this._getRelativeOffset());var pageX=event.pageX,pageY=event.pageY;
if(this.originalPosition&&(this.containment&&(event.pageX-this.offset.click.left<this.containment[0]&&(pageX=this.containment[0]+this.offset.click.left),event.pageY-this.offset.click.top<this.containment[1]&&(pageY=this.containment[1]+this.offset.click.top),event.pageX-this.offset.click.left>this.containment[2]&&(pageX=this.containment[2]+this.offset.click.left),event.pageY-this.offset.click.top>this.containment[3]&&(pageY=this.containment[3]+this.offset.click.top)),o.grid)){var top=this.originalPageY+Math.round((pageY-this.originalPageY)/o.grid[1])*o.grid[1];pageY=this.containment&&(top-this.offset.click.top<this.containment[1]||top-this.offset.click.top>this.containment[3])?top-this.offset.click.top<this.containment[1]?top+o.grid[1]:top-o.grid[1]:top;var left=this.originalPageX+Math.round((pageX-this.originalPageX)/o.grid[0])*o.grid[0];pageX=this.containment&&(left-this.offset.click.left<this.containment[0]||left-this.offset.click.left>this.containment[2])?left-this.offset.click.left<this.containment[0]?left+o.grid[0]:left-o.grid[0]:left}return{top:pageY-this.offset.click.top-this.offset.relative.top-this.offset.parent.top+("fixed"==this.cssPosition?-this.scrollParent.scrollTop():scrollIsRootNode?0:scroll.scrollTop()),left:pageX-this.offset.click.left-this.offset.relative.left-this.offset.parent.left+("fixed"==this.cssPosition?-this.scrollParent.scrollLeft():scrollIsRootNode?0:scroll.scrollLeft())}},_rearrange:function(event,i,a,hardRefresh){a?a[0].appendChild(this.placeholder[0]):i.item[0].parentNode.insertBefore(this.placeholder[0],"down"==this.direction?i.item[0]:i.item[0].nextSibling),this.counter=this.counter?++this.counter:1;var counter=this.counter;this._delay(function(){counter==this.counter&&this.refreshPositions(!hardRefresh)})},_clear:function(event,noPropagation){this.reverting=!1;var delayedTriggers=[];if(!this._noFinalSort&&this.currentItem.parent().length&&this.placeholder.before(this.currentItem),this._noFinalSort=null,this.helper[0]==this.currentItem[0]){for(var i in this._storedCSS)("auto"==this._storedCSS[i]||"static"==this._storedCSS[i])&&(this._storedCSS[i]="");this.currentItem.css(this._storedCSS).removeClass("ui-sortable-helper")}else this.currentItem.show();this.fromOutside&&!noPropagation&&delayedTriggers.push(function(event){this._trigger("receive",event,this._uiHash(this.fromOutside))}),!this.fromOutside&&this.domPosition.prev==this.currentItem.prev().not(".ui-sortable-helper")[0]&&this.domPosition.parent==this.currentItem.parent()[0]||noPropagation||delayedTriggers.push(function(event){this._trigger("update",event,this._uiHash())}),this!==this.currentContainer&&(noPropagation||(delayedTriggers.push(function(event){this._trigger("remove",event,this._uiHash())}),delayedTriggers.push(function(c){return function(event){c._trigger("receive",event,this._uiHash(this))}}.call(this,this.currentContainer)),delayedTriggers.push(function(c){return function(event){c._trigger("update",event,this._uiHash(this))}}.call(this,this.currentContainer))));for(var i=this.containers.length-1;i>=0;i--)noPropagation||delayedTriggers.push(function(c){return function(event){c._trigger("deactivate",event,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over&&(delayedTriggers.push(function(c){return function(event){c._trigger("out",event,this._uiHash(this))}}.call(this,this.containers[i])),this.containers[i].containerCache.over=0);if(this._storedCursor&&$("body").css("cursor",this._storedCursor),this._storedOpacity&&this.helper.css("opacity",this._storedOpacity),this._storedZIndex&&this.helper.css("zIndex","auto"==this._storedZIndex?"":this._storedZIndex),this.dragging=!1,this.cancelHelperRemoval){if(!noPropagation){this._trigger("beforeStop",event,this._uiHash());for(var i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger("stop",event,this._uiHash())}return this.fromOutside=!1,!1}if(noPropagation||this._trigger("beforeStop",event,this._uiHash()),this.placeholder[0].parentNode.removeChild(this.placeholder[0]),this.helper[0]!=this.currentItem[0]&&this.helper.remove(),this.helper=null,!noPropagation){for(var i=0;i<delayedTriggers.length;i++)delayedTriggers[i].call(this,event);this._trigger("stop",event,this._uiHash())}return this.fromOutside=!1,!0},_trigger:function(){$.Widget.prototype._trigger.apply(this,arguments)===!1&&this.cancel()},_uiHash:function(_inst){var inst=_inst||this;return{helper:inst.helper,placeholder:inst.placeholder||$([]),position:inst.position,originalPosition:inst.originalPosition,offset:inst.positionAbs,item:inst.currentItem,sender:_inst?_inst.element:null}}}),/*!
 * jQuery UI Menu 1.9.1
 * http://jqueryui.com
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/menu/
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 */
function($,undefined){var mouseHandled=!1;$.widget("ui.menu",{version:"1.9.1",defaultElement:"<ul>",delay:300,options:{icons:{submenu:"ui-icon-carat-1-e"},menus:"ul",position:{my:"left top",at:"right top"},role:"menu",blur:null,focus:null,select:null},_create:function(){this.activeMenu=this.element,this.element.uniqueId().addClass("ui-menu ui-widget ui-widget-content ui-corner-all").toggleClass("ui-menu-icons",!!this.element.find(".ui-icon").length).attr({role:this.options.role,tabIndex:0}).bind("click"+this.eventNamespace,$.proxy(function(event){this.options.disabled&&event.preventDefault()},this)),this.options.disabled&&this.element.addClass("ui-state-disabled").attr("aria-disabled","true"),this._on({"mousedown .ui-menu-item > a":function(event){event.preventDefault()},"click .ui-state-disabled > a":function(event){event.preventDefault()},"click .ui-menu-item:has(a)":function(event){var target=$(event.target).closest(".ui-menu-item");!mouseHandled&&target.not(".ui-state-disabled").length&&(mouseHandled=!0,this.select(event),target.has(".ui-menu").length?this.expand(event):this.element.is(":focus")||(this.element.trigger("focus",[!0]),this.active&&1===this.active.parents(".ui-menu").length&&clearTimeout(this.timer)))},"mouseenter .ui-menu-item":function(event){var target=$(event.currentTarget);target.siblings().children(".ui-state-active").removeClass("ui-state-active"),this.focus(event,target)},mouseleave:"collapseAll","mouseleave .ui-menu":"collapseAll",focus:function(event,keepActiveItem){var item=this.active||this.element.children(".ui-menu-item").eq(0);keepActiveItem||this.focus(event,item)},blur:function(event){this._delay(function(){$.contains(this.element[0],this.document[0].activeElement)||this.collapseAll(event)})},keydown:"_keydown"}),this.refresh(),this._on(this.document,{click:function(event){$(event.target).closest(".ui-menu").length||this.collapseAll(event),mouseHandled=!1}})},_destroy:function(){this.element.removeAttr("aria-activedescendant").find(".ui-menu").andSelf().removeClass("ui-menu ui-widget ui-widget-content ui-corner-all ui-menu-icons").removeAttr("role").removeAttr("tabIndex").removeAttr("aria-labelledby").removeAttr("aria-expanded").removeAttr("aria-hidden").removeAttr("aria-disabled").removeUniqueId().show(),this.element.find(".ui-menu-item").removeClass("ui-menu-item").removeAttr("role").removeAttr("aria-disabled").children("a").removeUniqueId().removeClass("ui-corner-all ui-state-hover").removeAttr("tabIndex").removeAttr("role").removeAttr("aria-haspopup").children().each(function(){var elem=$(this);elem.data("ui-menu-submenu-carat")&&elem.remove()}),this.element.find(".ui-menu-divider").removeClass("ui-menu-divider ui-widget-content")},_keydown:function(event){function escape(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")}var match,prev,character,skip,regex,preventDefault=!0;switch(event.keyCode){case $.ui.keyCode.PAGE_UP:this.previousPage(event);break;case $.ui.keyCode.PAGE_DOWN:this.nextPage(event);break;case $.ui.keyCode.HOME:this._move("first","first",event);break;case $.ui.keyCode.END:this._move("last","last",event);break;case $.ui.keyCode.UP:this.previous(event);break;case $.ui.keyCode.DOWN:this.next(event);break;case $.ui.keyCode.LEFT:this.collapse(event);break;case $.ui.keyCode.RIGHT:this.active&&!this.active.is(".ui-state-disabled")&&this.expand(event);break;case $.ui.keyCode.ENTER:case $.ui.keyCode.SPACE:this._activate(event);break;case $.ui.keyCode.ESCAPE:this.collapse(event);break;default:preventDefault=!1,prev=this.previousFilter||"",character=String.fromCharCode(event.keyCode),skip=!1,clearTimeout(this.filterTimer),character===prev?skip=!0:character=prev+character,regex=new RegExp("^"+escape(character),"i"),match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text())}),match=skip&&-1!==match.index(this.active.next())?this.active.nextAll(".ui-menu-item"):match,match.length||(character=String.fromCharCode(event.keyCode),regex=new RegExp("^"+escape(character),"i"),match=this.activeMenu.children(".ui-menu-item").filter(function(){return regex.test($(this).children("a").text())})),match.length?(this.focus(event,match),match.length>1?(this.previousFilter=character,this.filterTimer=this._delay(function(){delete this.previousFilter},1e3)):delete this.previousFilter):delete this.previousFilter}preventDefault&&event.preventDefault()},_activate:function(event){this.active.is(".ui-state-disabled")||(this.active.children("a[aria-haspopup='true']").length?this.expand(event):this.select(event))},refresh:function(){var menus,icon=this.options.icons.submenu,submenus=this.element.find(this.options.menus+":not(.ui-menu)").addClass("ui-menu ui-widget ui-widget-content ui-corner-all").hide().attr({role:this.options.role,"aria-hidden":"true","aria-expanded":"false"});menus=submenus.add(this.element),menus.children(":not(.ui-menu-item):has(a)").addClass("ui-menu-item").attr("role","presentation").children("a").uniqueId().addClass("ui-corner-all").attr({tabIndex:-1,role:this._itemRole()}),menus.children(":not(.ui-menu-item)").each(function(){var item=$(this);/[^\-\u2014\u2013\s]/.test(item.text())||item.addClass("ui-widget-content ui-menu-divider")}),menus.children(".ui-state-disabled").attr("aria-disabled","true"),submenus.each(function(){var menu=$(this),item=menu.prev("a"),submenuCarat=$("<span>").addClass("ui-menu-icon ui-icon "+icon).data("ui-menu-submenu-carat",!0);item.attr("aria-haspopup","true").prepend(submenuCarat),menu.attr("aria-labelledby",item.attr("id"))}),this.active&&!$.contains(this.element[0],this.active[0])&&this.blur()},_itemRole:function(){return{menu:"menuitem",listbox:"option"}[this.options.role]},focus:function(event,item){var nested,focused;this.blur(event,event&&"focus"===event.type),this._scrollIntoView(item),this.active=item.first(),focused=this.active.children("a").addClass("ui-state-focus"),this.options.role&&this.element.attr("aria-activedescendant",focused.attr("id")),this.active.parent().closest(".ui-menu-item").children("a:first").addClass("ui-state-active"),event&&"keydown"===event.type?this._close():this.timer=this._delay(function(){this._close()},this.delay),nested=item.children(".ui-menu"),nested.length&&/^mouse/.test(event.type)&&this._startOpening(nested),this.activeMenu=item.parent(),this._trigger("focus",event,{item:item})},_scrollIntoView:function(item){var borderTop,paddingTop,offset,scroll,elementHeight,itemHeight;this._hasScroll()&&(borderTop=parseFloat($.css(this.activeMenu[0],"borderTopWidth"))||0,paddingTop=parseFloat($.css(this.activeMenu[0],"paddingTop"))||0,offset=item.offset().top-this.activeMenu.offset().top-borderTop-paddingTop,scroll=this.activeMenu.scrollTop(),elementHeight=this.activeMenu.height(),itemHeight=item.height(),0>offset?this.activeMenu.scrollTop(scroll+offset):offset+itemHeight>elementHeight&&this.activeMenu.scrollTop(scroll+offset-elementHeight+itemHeight))},blur:function(event,fromFocus){fromFocus||clearTimeout(this.timer),this.active&&(this.active.children("a").removeClass("ui-state-focus"),this.active=null,this._trigger("blur",event,{item:this.active}))},_startOpening:function(submenu){clearTimeout(this.timer),"true"===submenu.attr("aria-hidden")&&(this.timer=this._delay(function(){this._close(),this._open(submenu)},this.delay))},_open:function(submenu){var position=$.extend({of:this.active},this.options.position);clearTimeout(this.timer),this.element.find(".ui-menu").not(submenu.parents(".ui-menu")).hide().attr("aria-hidden","true"),submenu.show().removeAttr("aria-hidden").attr("aria-expanded","true").position(position)},collapseAll:function(event,all){clearTimeout(this.timer),this.timer=this._delay(function(){var currentMenu=all?this.element:$(event&&event.target).closest(this.element.find(".ui-menu"));currentMenu.length||(currentMenu=this.element),this._close(currentMenu),this.blur(event),this.activeMenu=currentMenu},this.delay)},_close:function(startMenu){startMenu||(startMenu=this.active?this.active.parent():this.element),startMenu.find(".ui-menu").hide().attr("aria-hidden","true").attr("aria-expanded","false").end().find("a.ui-state-active").removeClass("ui-state-active")},collapse:function(event){var newItem=this.active&&this.active.parent().closest(".ui-menu-item",this.element);newItem&&newItem.length&&(this._close(),this.focus(event,newItem))},expand:function(event){var newItem=this.active&&this.active.children(".ui-menu ").children(".ui-menu-item").first();newItem&&newItem.length&&(this._open(newItem.parent()),this._delay(function(){this.focus(event,newItem)}))},next:function(event){this._move("next","first",event)},previous:function(event){this._move("prev","last",event)},isFirstItem:function(){return this.active&&!this.active.prevAll(".ui-menu-item").length},isLastItem:function(){return this.active&&!this.active.nextAll(".ui-menu-item").length},_move:function(direction,filter,event){var next;this.active&&(next="first"===direction||"last"===direction?this.active["first"===direction?"prevAll":"nextAll"](".ui-menu-item").eq(-1):this.active[direction+"All"](".ui-menu-item").eq(0)),next&&next.length&&this.active||(next=this.activeMenu.children(".ui-menu-item")[filter]()),this.focus(event,next)},nextPage:function(event){var item,base,height;return this.active?void(this.isLastItem()||(this._hasScroll()?(base=this.active.offset().top,height=this.element.height(),this.active.nextAll(".ui-menu-item").each(function(){return item=$(this),item.offset().top-base-height<0}),this.focus(event,item)):this.focus(event,this.activeMenu.children(".ui-menu-item")[this.active?"last":"first"]()))):void this.next(event)},previousPage:function(event){var item,base,height;return this.active?void(this.isFirstItem()||(this._hasScroll()?(base=this.active.offset().top,height=this.element.height(),this.active.prevAll(".ui-menu-item").each(function(){return item=$(this),item.offset().top-base+height>0}),this.focus(event,item)):this.focus(event,this.activeMenu.children(".ui-menu-item").first()))):void this.next(event)},_hasScroll:function(){return this.element.outerHeight()<this.element.prop("scrollHeight")},select:function(event){this.active=this.active||$(event.target).closest(".ui-menu-item");var ui={item:this.active};this.active.has(".ui-menu").length||this.collapseAll(event,!0),this._trigger("select",event,ui)}})}(jQuery)}(jQuery),/*!
 * jQuery UI Autocomplete 1.9.1
 * http://jqueryui.com
 *
 * Copyright 2012 jQuery Foundation and other contributors
 * Released under the MIT license.
 * http://jquery.org/license
 *
 * http://api.jqueryui.com/autocomplete/
 *
 * Depends:
 *	jquery.ui.core.js
 *	jquery.ui.widget.js
 *	jquery.ui.position.js
 *	jquery.ui.menu.js
 */
function($,undefined){var requestIndex=0;$.widget("ui.autocomplete",{version:"1.9.1",defaultElement:"<input>",options:{appendTo:"body",autoFocus:!1,delay:300,minLength:1,position:{my:"left top",at:"left bottom",collision:"none"},source:null,change:null,close:null,focus:null,open:null,response:null,search:null,select:null},pending:0,_create:function(){var suppressKeyPress,suppressKeyPressRepeat,suppressInput;this.isMultiLine=this._isMultiLine(),this.valueMethod=this.element[this.element.is("input,textarea")?"val":"text"],this.isNewMenu=!0,this.element.addClass("ui-autocomplete-input").attr("autocomplete","off"),this._on(this.element,{keydown:function(event){if(this.element.prop("readOnly"))return suppressKeyPress=!0,suppressInput=!0,void(suppressKeyPressRepeat=!0);suppressKeyPress=!1,suppressInput=!1,suppressKeyPressRepeat=!1;var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:suppressKeyPress=!0,this._move("previousPage",event);break;case keyCode.PAGE_DOWN:suppressKeyPress=!0,this._move("nextPage",event);break;case keyCode.UP:suppressKeyPress=!0,this._keyEvent("previous",event);break;case keyCode.DOWN:suppressKeyPress=!0,this._keyEvent("next",event);break;case keyCode.ENTER:case keyCode.NUMPAD_ENTER:this.menu.active&&(suppressKeyPress=!0,event.preventDefault(),this.menu.select(event));break;case keyCode.TAB:this.menu.active&&this.menu.select(event);break;case keyCode.ESCAPE:this.menu.element.is(":visible")&&(this._value(this.term),this.close(event),event.preventDefault());break;default:suppressKeyPressRepeat=!0,this._searchTimeout(event)}},keypress:function(event){if(suppressKeyPress)return suppressKeyPress=!1,void event.preventDefault();if(!suppressKeyPressRepeat){var keyCode=$.ui.keyCode;switch(event.keyCode){case keyCode.PAGE_UP:this._move("previousPage",event);break;case keyCode.PAGE_DOWN:this._move("nextPage",event);break;case keyCode.UP:this._keyEvent("previous",event);break;case keyCode.DOWN:this._keyEvent("next",event)}}},input:function(event){return suppressInput?(suppressInput=!1,void event.preventDefault()):void this._searchTimeout(event)},focus:function(){this.selectedItem=null,this.previous=this._value()},blur:function(event){return this.cancelBlur?void delete this.cancelBlur:(clearTimeout(this.searching),this.close(event),void this._change(event))}}),this._initSource(),this.menu=$("<ul>").addClass("ui-autocomplete").appendTo(this.document.find(this.options.appendTo||"body")[0]).menu({input:$(),role:null}).zIndex(this.element.zIndex()+1).hide().data("menu"),this._on(this.menu.element,{mousedown:function(event){event.preventDefault(),this.cancelBlur=!0,this._delay(function(){delete this.cancelBlur});var menuElement=this.menu.element[0];$(event.target).closest(".ui-menu-item").length||this._delay(function(){var that=this;this.document.one("mousedown",function(event){event.target===that.element[0]||event.target===menuElement||$.contains(menuElement,event.target)||that.close()})})},menufocus:function(event,ui){if(this.isNewMenu&&(this.isNewMenu=!1,event.originalEvent&&/^mouse/.test(event.originalEvent.type)))return this.menu.blur(),void this.document.one("mousemove",function(){$(event.target).trigger(event.originalEvent)});var item=ui.item.data("ui-autocomplete-item")||ui.item.data("item.autocomplete");!1!==this._trigger("focus",event,{item:item})?event.originalEvent&&/^key/.test(event.originalEvent.type)&&this._value(item.value):this.liveRegion.text(item.value)},menuselect:function(event,ui){var item=ui.item.data("ui-autocomplete-item")||ui.item.data("item.autocomplete"),previous=this.previous;this.element[0]!==this.document[0].activeElement&&(this.element.focus(),this.previous=previous,this._delay(function(){this.previous=previous,this.selectedItem=item})),!1!==this._trigger("select",event,{item:item})&&this._value(item.value),this.term=this._value(),this.close(event),this.selectedItem=item}}),this.liveRegion=$("<span>",{role:"status","aria-live":"polite"}).addClass("ui-helper-hidden-accessible").insertAfter(this.element),$.fn.bgiframe&&this.menu.element.bgiframe(),this._on(this.window,{beforeunload:function(){this.element.removeAttr("autocomplete")}})},_destroy:function(){clearTimeout(this.searching),this.element.removeClass("ui-autocomplete-input").removeAttr("autocomplete"),this.menu.element.remove(),this.liveRegion.remove()},_setOption:function(key,value){this._super(key,value),"source"===key&&this._initSource(),"appendTo"===key&&this.menu.element.appendTo(this.document.find(value||"body")[0]),"disabled"===key&&value&&this.xhr&&this.xhr.abort()},_isMultiLine:function(){return this.element.is("textarea")?!0:this.element.is("input")?!1:this.element.prop("isContentEditable")},_initSource:function(){var array,url,that=this;$.isArray(this.options.source)?(array=this.options.source,this.source=function(request,response){response($.ui.autocomplete.filter(array,request.term))}):"string"==typeof this.options.source?(url=this.options.source,this.source=function(request,response){that.xhr&&that.xhr.abort(),that.xhr=$.ajax({url:url,data:request,dataType:"json",success:function(data){response(data)},error:function(){response([])}})}):this.source=this.options.source},_searchTimeout:function(event){clearTimeout(this.searching),this.searching=this._delay(function(){this.term!==this._value()&&(this.selectedItem=null,this.search(null,event))},this.options.delay)},search:function(value,event){return value=null!=value?value:this._value(),this.term=this._value(),value.length<this.options.minLength?this.close(event):this._trigger("search",event)!==!1?this._search(value):void 0},_search:function(value){this.pending++,this.element.addClass("ui-autocomplete-loading"),this.cancelSearch=!1,this.source({term:value},this._response())},_response:function(){var that=this,index=++requestIndex;return function(content){index===requestIndex&&that.__response(content),that.pending--,that.pending||that.element.removeClass("ui-autocomplete-loading")}},__response:function(content){content&&(content=this._normalize(content)),this._trigger("response",null,{content:content}),!this.options.disabled&&content&&content.length&&!this.cancelSearch?(this._suggest(content),this._trigger("open")):this._close()},close:function(event){this.cancelSearch=!0,this._close(event)},_close:function(event){this.menu.element.is(":visible")&&(this.menu.element.hide(),this.menu.blur(),this.isNewMenu=!0,this._trigger("close",event))},_change:function(event){this.previous!==this._value()&&this._trigger("change",event,{item:this.selectedItem})},_normalize:function(items){return items.length&&items[0].label&&items[0].value?items:$.map(items,function(item){return"string"==typeof item?{label:item,value:item}:$.extend({label:item.label||item.value,value:item.value||item.label},item)})},_suggest:function(items){var ul=this.menu.element.empty().zIndex(this.element.zIndex()+1);this._renderMenu(ul,items),this.menu.refresh(),ul.show(),this._resizeMenu(),ul.position($.extend({of:this.element},this.options.position)),this.options.autoFocus&&this.menu.next()},_resizeMenu:function(){var ul=this.menu.element;ul.outerWidth(Math.max(ul.width("").outerWidth()+1,this.element.outerWidth()))},_renderMenu:function(ul,items){var that=this;$.each(items,function(index,item){that._renderItemData(ul,item)})},_renderItemData:function(ul,item){return this._renderItem(ul,item).data("ui-autocomplete-item",item)},_renderItem:function(ul,item){return $("<li>").append($("<a>").text(item.label)).appendTo(ul)},_move:function(direction,event){return this.menu.element.is(":visible")?this.menu.isFirstItem()&&/^previous/.test(direction)||this.menu.isLastItem()&&/^next/.test(direction)?(this._value(this.term),void this.menu.blur()):void this.menu[direction](event):void this.search(null,event)},widget:function(){return this.menu.element},_value:function(){return this.valueMethod.apply(this.element,arguments)},_keyEvent:function(keyEvent,event){(!this.isMultiLine||this.menu.element.is(":visible"))&&(this._move(keyEvent,event),event.preventDefault())}}),$.extend($.ui.autocomplete,{escapeRegex:function(value){return value.replace(/[\-\[\]{}()*+?.,\\\^$|#\s]/g,"\\$&")},filter:function(array,term){var matcher=new RegExp($.ui.autocomplete.escapeRegex(term),"i");return $.grep(array,function(value){return matcher.test(value.label||value.value||value)})}}),$.widget("ui.autocomplete",$.ui.autocomplete,{options:{messages:{noResults:"No search results.",results:function(amount){return amount+(amount>1?" results are":" result is")+" available, use up and down arrow keys to navigate."}}},__response:function(content){var message;this._superApply(arguments),this.options.disabled||this.cancelSearch||(message=content&&content.length?this.options.messages.results(content.length):this.options.messages.noResults,this.liveRegion.text(message))}})}(jQuery),/*!
 * jQuery Cookie Plugin v1.4.1
 * https://github.com/carhartl/jquery-cookie
 *
 * Copyright 2006, 2014 Klaus Hartl
 * Released under the MIT license
 */
function(factory){"function"==typeof define&&define.amd?define(["jquery"],factory):factory("object"==typeof exports?require("jquery"):jQuery)}(function($){function encode(s){return config.raw?s:encodeURIComponent(s)}function decode(s){return config.raw?s:decodeURIComponent(s)}function stringifyCookieValue(value){return encode(config.json?JSON.stringify(value):String(value))}function parseCookieValue(s){0===s.indexOf('"')&&(s=s.slice(1,-1).replace(/\\"/g,'"').replace(/\\\\/g,"\\"));try{return s=decodeURIComponent(s.replace(pluses," ")),config.json?JSON.parse(s):s}catch(e){}}function read(s,converter){var value=config.raw?s:parseCookieValue(s);return $.isFunction(converter)?converter(value):value}var pluses=/\+/g,config=$.cookie=function(key,value,options){if(arguments.length>1&&!$.isFunction(value)){if(options=$.extend({},config.defaults,options),"number"==typeof options.expires){var days=options.expires,t=options.expires=new Date;t.setTime(+t+864e5*days)}return document.cookie=[encode(key),"=",stringifyCookieValue(value),options.expires?"; expires="+options.expires.toUTCString():"",options.path?"; path="+options.path:"",options.domain?"; domain="+options.domain:"",options.secure?"; secure":""].join("")}for(var result=key?void 0:{},cookies=document.cookie?document.cookie.split("; "):[],i=0,l=cookies.length;l>i;i++){var parts=cookies[i].split("="),name=decode(parts.shift()),cookie=parts.join("=");if(key&&key===name){result=read(cookie,value);break}key||void 0===(cookie=read(cookie))||(result[name]=cookie)}return result};config.defaults={},$.removeCookie=function(key,options){return void 0===$.cookie(key)?!1:($.cookie(key,"",$.extend({},options,{expires:-1})),!$.cookie(key))}}),function(jQuery){window.XDomainRequest&&jQuery.ajaxTransport(function(s){if(s.crossDomain&&s.async){s.timeout&&(s.xdrTimeout=s.timeout,delete s.timeout);var xdr;return{send:function(_,complete){function callback(status,statusText,responses,responseHeaders){xdr.onload=xdr.onerror=xdr.ontimeout=jQuery.noop,xdr=void 0,complete(status,statusText,responses,responseHeaders)}xdr=new XDomainRequest,"POST"!=s.type&&"GET"!=s.type&&(-1==s.url.indexOf("?")?s.url=s.url+"?x-http-method-override="+s.type:s.url=s.url+"&x-http-method-override="+s.type,s.type="POST"),xdr.open(s.type,s.url),xdr.onload=function(){callback(200,"OK",{text:xdr.responseText},"Content-Type: "+xdr.contentType)},xdr.onerror=function(){callback(404,"Unknown to XDR",{text:xdr.responseText},"Content-Type: "+xdr.contentType)},s.xdrTimeout&&(xdr.ontimeout=function(){callback(0,"timeout")},xdr.timeout=s.xdrTimeout),xdr.onprogress=function(){},xdr.send(s.hasContent&&s.data||null)},abort:function(){xdr&&(xdr.onerror=jQuery.noop(),xdr.abort())}}}})}(jQuery),function($){$.queryParam=function(a){if(""==a)return{};for(var b={},i=0;i<a.length;++i){var p=a[i].split("=");2==p.length&&(b[p[0]]=decodeURIComponent(p[1].replace(/\+/g," ")))}return b}(window.location.search.substr(1).split("&"))}(jQuery),new function($){$.fn.add_overlay_field=function(className,value,element){fake_input=$('<input type="text" class="fakeInput" style="position: absolute; left: 0; top: 0;"/>'),fake_input.addClass(className).addClass(element.get(0).className).val(value),$(this).parent().css({position:"relative"}).append(fake_input),fake_input.focus(function(){$(this).prev("input").focus(),$(this).remove()})},$.fn.placeholder=function(settings){settings=settings||{};var key=settings.dataKey||"placeholderValue",attr=settings.attr||"placeholder",className=settings.className||"placeholderInput",values=settings.values||[],block=settings.blockSubmit||!1,blank=settings.blankSubmit||!0,submit=settings.onSubmit||!1,value=settings.value||"",position=settings.cursor_position||0;return this.filter(":input[placeholder]").each(function(index){$.data(this,key,values[index]||$(this).attr(attr))}).each(function(){(""===$.trim($(this).val())||$.trim($(this).val())===$.data(this,key))&&("password"==$(this).attr("type")?$(this).add_overlay_field(className,$.data(this,key),$(this)):$(this).addClass(className).val($.data(this,key)))}).focus(function(){"password"==$(this).attr("type")?($(this).type="password",$(".fakeInput",$(this).parent()).remove()):($.trim($(this).val())===$.data(this,key)&&$(this).removeClass(className).val(value),$.fn.setCursorPosition&&$(this).setCursorPosition(position))}).blur(function(){$.trim($(this).val())===value&&("password"==$(this).attr("type")?$(this).add_overlay_field(className,$.data(this,key),$(this)):$(this).addClass(className).val($.data(this,key)))}).each(function(index,elem){block?new function(e){$(e.form).submit(function(){return $.trim($(e).val())!=$.data(e,key)})}(elem):blank?new function(e){$(e.form).submit(function(){return $.trim($(e).val())==$.data(e,key)&&$(e).removeClass(className).val(""),!0})}(elem):submit&&new function(e){$(e.form).submit(submit)}(elem)})}}(jQuery),/*
 * jQuery autoResize (textarea auto-resizer)
 * @copyright James Padolsey http://james.padolsey.com
 * @version 1.04
 */
function($){$.fn.autoResize=function(options){var settings=$.extend({onResize:function(){},animate:!0,animateDuration:150,animateCallback:function(){},extraSpace:20,limit:1e3},options);return this.filter("textarea").each(function(){var textarea=$(this).css({resize:"none","overflow-y":"hidden"}),origHeight=textarea.height(),clone=function(){var props=["height","width","lineHeight","textDecoration","letterSpacing"],propOb={};return $.each(props,function(i,prop){propOb[prop]=textarea.css(prop)}),textarea.clone().removeAttr("id").removeAttr("name").css({position:"absolute",top:0,left:-9999}).css(propOb).attr("tabIndex","-1").insertBefore(textarea)}(),lastScrollTop=null,updateSize=function(){clone.height(0).val($(this).val()).scrollTop(1e4);var scrollTop=Math.max(clone.scrollTop(),origHeight)+settings.extraSpace,toChange=$(this).add(clone);if(lastScrollTop!==scrollTop){if(lastScrollTop=scrollTop,scrollTop>=settings.limit)return void $(this).css("overflow-y","");settings.onResize.call(this),settings.animate&&"block"===textarea.css("display")?toChange.stop().animate({height:scrollTop},settings.animateDuration,settings.animateCallback):toChange.height(scrollTop)}};textarea.unbind(".dynSiz").bind("keyup.dynSiz",updateSize).bind("keydown.dynSiz",updateSize).bind("change.dynSiz",updateSize)}),this}}(jQuery),/*!
Chosen, a Select Box Enhancer for jQuery and Prototype
by Patrick Filler for Harvest, http://getharvest.com

Version 1.1.0
Full source at https://github.com/harvesthq/chosen
Copyright (c) 2011 Harvest http://getharvest.com

MIT License, https://github.com/harvesthq/chosen/blob/master/LICENSE.md
This file is generated by `grunt build`, do not edit it by hand.
*/
function(){var $,AbstractChosen,Chosen,SelectParser,_ref,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};SelectParser=function(){function SelectParser(){this.options_index=0,this.parsed=[]}return SelectParser.prototype.add_node=function(child){return"OPTGROUP"===child.nodeName.toUpperCase()?this.add_group(child):this.add_option(child)},SelectParser.prototype.add_group=function(group){var group_position,option,_i,_len,_ref,_results;for(group_position=this.parsed.length,this.parsed.push({array_index:group_position,group:!0,label:this.escapeExpression(group.label),children:0,disabled:group.disabled}),_ref=group.childNodes,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)option=_ref[_i],_results.push(this.add_option(option,group_position,group.disabled));return _results},SelectParser.prototype.add_option=function(option,group_position,group_disabled){return"OPTION"===option.nodeName.toUpperCase()?(""!==option.text?(null!=group_position&&(this.parsed[group_position].children+=1),this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,value:option.value,text:option.text,html:option.innerHTML,selected:option.selected,disabled:group_disabled===!0?group_disabled:option.disabled,group_array_index:group_position,classes:option.className,style:option.style.cssText})):this.parsed.push({array_index:this.parsed.length,options_index:this.options_index,empty:!0}),this.options_index+=1):void 0},SelectParser.prototype.escapeExpression=function(text){var map,unsafe_chars;return null==text||text===!1?"":/[\&\<\>\"\'\`]/.test(text)?(map={"<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","`":"&#x60;"},unsafe_chars=/&(?!\w+;)|[\<\>\"\'\`]/g,text.replace(unsafe_chars,function(chr){return map[chr]||"&amp;"})):text},SelectParser}(),SelectParser.select_to_array=function(select){var child,parser,_i,_len,_ref;for(parser=new SelectParser,_ref=select.childNodes,_i=0,_len=_ref.length;_len>_i;_i++)child=_ref[_i],parser.add_node(child);return parser.parsed},AbstractChosen=function(){function AbstractChosen(form_field,options){this.form_field=form_field,this.options=null!=options?options:{},AbstractChosen.browser_is_supported()&&(this.is_multiple=this.form_field.multiple,this.set_default_text(),this.set_default_values(),this.setup(),this.set_up_html(),this.register_observers())}return AbstractChosen.prototype.set_default_values=function(){var _this=this;return this.click_test_action=function(evt){return _this.test_active_click(evt)},this.activate_action=function(evt){return _this.activate_field(evt)},this.active_field=!1,this.mouse_on_container=!1,this.results_showing=!1,this.result_highlighted=null,this.allow_single_deselect=null!=this.options.allow_single_deselect&&null!=this.form_field.options[0]&&""===this.form_field.options[0].text?this.options.allow_single_deselect:!1,this.disable_search_threshold=this.options.disable_search_threshold||0,this.disable_search=this.options.disable_search||!1,this.enable_split_word_search=null!=this.options.enable_split_word_search?this.options.enable_split_word_search:!0,this.group_search=null!=this.options.group_search?this.options.group_search:!0,this.search_contains=this.options.search_contains||!1,this.single_backstroke_delete=null!=this.options.single_backstroke_delete?this.options.single_backstroke_delete:!0,this.max_selected_options=this.options.max_selected_options||1/0,this.inherit_select_classes=this.options.inherit_select_classes||!1,this.display_selected_options=null!=this.options.display_selected_options?this.options.display_selected_options:!0,this.display_disabled_options=null!=this.options.display_disabled_options?this.options.display_disabled_options:!0},AbstractChosen.prototype.set_default_text=function(){return this.form_field.getAttribute("data-placeholder")?this.default_text=this.form_field.getAttribute("data-placeholder"):this.is_multiple?this.default_text=this.options.placeholder_text_multiple||this.options.placeholder_text||AbstractChosen.default_multiple_text:this.default_text=this.options.placeholder_text_single||this.options.placeholder_text||AbstractChosen.default_single_text,this.results_none_found=this.form_field.getAttribute("data-no_results_text")||this.options.no_results_text||AbstractChosen.default_no_result_text},AbstractChosen.prototype.mouse_enter=function(){return this.mouse_on_container=!0},AbstractChosen.prototype.mouse_leave=function(){return this.mouse_on_container=!1},AbstractChosen.prototype.input_focus=function(evt){var _this=this;if(this.is_multiple){if(!this.active_field)return setTimeout(function(){return _this.container_mousedown()},50)}else if(!this.active_field)return this.activate_field()},AbstractChosen.prototype.input_blur=function(evt){var _this=this;return this.mouse_on_container?void 0:(this.active_field=!1,setTimeout(function(){return _this.blur_test()},100))},AbstractChosen.prototype.results_option_build=function(options){var content,data,_i,_len,_ref;for(content="",_ref=this.results_data,_i=0,_len=_ref.length;_len>_i;_i++)data=_ref[_i],content+=data.group?this.result_add_group(data):this.result_add_option(data),(null!=options?options.first:void 0)&&(data.selected&&this.is_multiple?this.choice_build(data):data.selected&&!this.is_multiple&&this.single_set_selected_text(data.text));return content},AbstractChosen.prototype.result_add_option=function(option){var classes,option_el;return option.search_match&&this.include_option_in_results(option)?(classes=[],option.disabled||option.selected&&this.is_multiple||classes.push("active-result"),!option.disabled||option.selected&&this.is_multiple||classes.push("disabled-result"),option.selected&&classes.push("result-selected"),null!=option.group_array_index&&classes.push("group-option"),""!==option.classes&&classes.push(option.classes),option_el=document.createElement("li"),option_el.className=classes.join(" "),option_el.style.cssText=option.style,option_el.setAttribute("data-option-array-index",option.array_index),option_el.innerHTML=option.search_text,this.outerHTML(option_el)):""},AbstractChosen.prototype.result_add_group=function(group){var group_el;return(group.search_match||group.group_match)&&group.active_options>0?(group_el=document.createElement("li"),group_el.className="group-result",group_el.innerHTML=group.search_text,this.outerHTML(group_el)):""},AbstractChosen.prototype.results_update_field=function(){return this.set_default_text(),this.is_multiple||this.results_reset_cleanup(),this.result_clear_highlight(),this.results_build(),this.results_showing?this.winnow_results():void 0},AbstractChosen.prototype.reset_single_select_options=function(){var result,_i,_len,_ref,_results;for(_ref=this.results_data,_results=[],_i=0,_len=_ref.length;_len>_i;_i++)result=_ref[_i],result.selected?_results.push(result.selected=!1):_results.push(void 0);return _results},AbstractChosen.prototype.results_toggle=function(){return this.results_showing?this.results_hide():this.results_show()},AbstractChosen.prototype.results_search=function(evt){return this.results_showing?this.winnow_results():this.results_show()},AbstractChosen.prototype.winnow_results=function(){var escapedSearchText,option,regex,regexAnchor,results,results_group,searchText,startpos,text,zregex,_i,_len,_ref;for(this.no_results_clear(),results=0,searchText=this.get_search_text(),escapedSearchText=searchText.replace(/[-[\]{}()*+?.,\\^$|#\s]/g,"\\$&"),regexAnchor=this.search_contains?"":"^",regex=new RegExp(regexAnchor+escapedSearchText,"i"),zregex=new RegExp(escapedSearchText,"i"),_ref=this.results_data,_i=0,_len=_ref.length;_len>_i;_i++)option=_ref[_i],option.search_match=!1,results_group=null,this.include_option_in_results(option)&&(option.group&&(option.group_match=!1,option.active_options=0),null!=option.group_array_index&&this.results_data[option.group_array_index]&&(results_group=this.results_data[option.group_array_index],0===results_group.active_options&&results_group.search_match&&(results+=1),results_group.active_options+=1),(!option.group||this.group_search)&&(option.search_text=option.group?option.label:option.html,option.search_match=this.search_string_match(option.search_text,regex),option.search_match&&!option.group&&(results+=1),option.search_match?(searchText.length&&(startpos=option.search_text.search(zregex),text=option.search_text.substr(0,startpos+searchText.length)+"</em>"+option.search_text.substr(startpos+searchText.length),option.search_text=text.substr(0,startpos)+"<em>"+text.substr(startpos)),null!=results_group&&(results_group.group_match=!0)):null!=option.group_array_index&&this.results_data[option.group_array_index].search_match&&(option.search_match=!0)));return this.result_clear_highlight(),1>results&&searchText.length?(this.update_results_content(""),this.no_results(searchText)):(this.update_results_content(this.results_option_build()),this.winnow_results_set_highlight())},AbstractChosen.prototype.search_string_match=function(search_string,regex){var part,parts,_i,_len;if(regex.test(search_string))return!0;if(this.enable_split_word_search&&(search_string.indexOf(" ")>=0||0===search_string.indexOf("["))&&(parts=search_string.replace(/\[|\]/g,"").split(" "),parts.length))for(_i=0,_len=parts.length;_len>_i;_i++)if(part=parts[_i],regex.test(part))return!0},AbstractChosen.prototype.choices_count=function(){var option,_i,_len,_ref;if(null!=this.selected_option_count)return this.selected_option_count;for(this.selected_option_count=0,_ref=this.form_field.options,_i=0,_len=_ref.length;_len>_i;_i++)option=_ref[_i],option.selected&&(this.selected_option_count+=1);return this.selected_option_count},AbstractChosen.prototype.choices_click=function(evt){return evt.preventDefault(),this.results_showing||this.is_disabled?void 0:this.results_show()},AbstractChosen.prototype.keyup_checker=function(evt){var stroke,_ref;switch(stroke=null!=(_ref=evt.which)?_ref:evt.keyCode,this.search_field_scale(),stroke){case 8:if(this.is_multiple&&this.backstroke_length<1&&this.choices_count()>0)return this.keydown_backstroke();if(!this.pending_backstroke)return this.result_clear_highlight(),this.results_search();break;case 13:if(evt.preventDefault(),this.results_showing)return this.result_select(evt);break;case 27:return this.results_showing&&this.results_hide(),!0;case 9:case 38:case 40:case 16:case 91:case 17:break;default:return this.results_search()}},AbstractChosen.prototype.clipboard_event_checker=function(evt){var _this=this;return setTimeout(function(){return _this.results_search()},50)},AbstractChosen.prototype.container_width=function(){return null!=this.options.width?this.options.width:""+this.form_field.offsetWidth+"px"},AbstractChosen.prototype.include_option_in_results=function(option){return this.is_multiple&&!this.display_selected_options&&option.selected?!1:!this.display_disabled_options&&option.disabled?!1:option.empty?!1:!0},AbstractChosen.prototype.search_results_touchstart=function(evt){return this.touch_started=!0,this.search_results_mouseover(evt)},AbstractChosen.prototype.search_results_touchmove=function(evt){return this.touch_started=!1,this.search_results_mouseout(evt)},AbstractChosen.prototype.search_results_touchend=function(evt){return this.touch_started?this.search_results_mouseup(evt):void 0},AbstractChosen.prototype.outerHTML=function(element){var tmp;return element.outerHTML?element.outerHTML:(tmp=document.createElement("div"),tmp.appendChild(element),tmp.innerHTML)},AbstractChosen.browser_is_supported=function(){return"Microsoft Internet Explorer"===window.navigator.appName?document.documentMode>=8:/iP(od|hone)/i.test(window.navigator.userAgent)?!1:/Android/i.test(window.navigator.userAgent)&&/Mobile/i.test(window.navigator.userAgent)?!1:!0},AbstractChosen.default_multiple_text="Select Some Options",AbstractChosen.default_single_text="Select an Option",AbstractChosen.default_no_result_text="No results match",AbstractChosen}(),$=jQuery,$.fn.extend({chosen:function(options){return AbstractChosen.browser_is_supported()?this.each(function(input_field){var $this,chosen;$this=$(this),chosen=$this.data("chosen"),"destroy"===options&&chosen?chosen.destroy():chosen||$this.data("chosen",new Chosen(this,options))}):this}}),Chosen=function(_super){function Chosen(){return _ref=Chosen.__super__.constructor.apply(this,arguments)}return __extends(Chosen,_super),Chosen.prototype.setup=function(){return this.form_field_jq=$(this.form_field),this.current_selectedIndex=this.form_field.selectedIndex,this.is_rtl=this.form_field_jq.hasClass("chosen-rtl")},Chosen.prototype.set_up_html=function(){var container_classes,container_props;return container_classes=["chosen-container"],container_classes.push("chosen-container-"+(this.is_multiple?"multi":"single")),this.inherit_select_classes&&this.form_field.className&&container_classes.push(this.form_field.className),this.is_rtl&&container_classes.push("chosen-rtl"),container_props={"class":container_classes.join(" "),style:"width: "+this.container_width()+";",title:this.form_field.title},this.form_field.id.length&&(container_props.id=this.form_field.id.replace(/[^\w]/g,"_")+"_chosen"),this.container=$("<div />",container_props),this.is_multiple?this.container.html('<ul class="chosen-choices"><li class="search-field"><input type="text" value="'+this.default_text+'" class="default" autocomplete="off" style="width:25px;" /></li></ul><div class="chosen-drop"><ul class="chosen-results"></ul></div>'):this.container.html('<a class="chosen-single chosen-default" tabindex="-1"><span>'+this.default_text+'</span><div><b></b></div></a><div class="chosen-drop"><div class="chosen-search"><input type="text" autocomplete="off" /></div><ul class="chosen-results"></ul></div>'),this.form_field_jq.hide().after(this.container),this.dropdown=this.container.find("div.chosen-drop").first(),this.search_field=this.container.find("input").first(),this.search_results=this.container.find("ul.chosen-results").first(),this.search_field_scale(),this.search_no_results=this.container.find("li.no-results").first(),this.is_multiple?(this.search_choices=this.container.find("ul.chosen-choices").first(),this.search_container=this.container.find("li.search-field").first()):(this.search_container=this.container.find("div.chosen-search").first(),this.selected_item=this.container.find(".chosen-single").first()),this.results_build(),this.set_tab_index(),this.set_label_behavior(),this.form_field_jq.trigger("chosen:ready",{chosen:this})},Chosen.prototype.register_observers=function(){var _this=this;return this.container.bind("mousedown.chosen",function(evt){_this.container_mousedown(evt)}),this.container.bind("mouseup.chosen",function(evt){_this.container_mouseup(evt)}),this.container.bind("mouseenter.chosen",function(evt){_this.mouse_enter(evt)}),this.container.bind("mouseleave.chosen",function(evt){_this.mouse_leave(evt)}),this.search_results.bind("mouseup.chosen",function(evt){_this.search_results_mouseup(evt)}),this.search_results.bind("mouseover.chosen",function(evt){_this.search_results_mouseover(evt)}),this.search_results.bind("mouseout.chosen",function(evt){_this.search_results_mouseout(evt)}),this.search_results.bind("mousewheel.chosen DOMMouseScroll.chosen",function(evt){_this.search_results_mousewheel(evt)}),this.search_results.bind("touchstart.chosen",function(evt){_this.search_results_touchstart(evt)}),this.search_results.bind("touchmove.chosen",function(evt){_this.search_results_touchmove(evt)}),this.search_results.bind("touchend.chosen",function(evt){_this.search_results_touchend(evt)}),this.form_field_jq.bind("chosen:updated.chosen",function(evt){_this.results_update_field(evt)}),this.form_field_jq.bind("chosen:activate.chosen",function(evt){_this.activate_field(evt)}),this.form_field_jq.bind("chosen:open.chosen",function(evt){_this.container_mousedown(evt)}),this.form_field_jq.bind("chosen:close.chosen",function(evt){_this.input_blur(evt)}),this.search_field.bind("blur.chosen",function(evt){_this.input_blur(evt)}),this.search_field.bind("keyup.chosen",function(evt){_this.keyup_checker(evt)}),this.search_field.bind("keydown.chosen",function(evt){_this.keydown_checker(evt)}),this.search_field.bind("focus.chosen",function(evt){_this.input_focus(evt)}),this.search_field.bind("cut.chosen",function(evt){_this.clipboard_event_checker(evt)}),this.search_field.bind("paste.chosen",function(evt){_this.clipboard_event_checker(evt)}),this.is_multiple?this.search_choices.bind("click.chosen",function(evt){_this.choices_click(evt)}):this.container.bind("click.chosen",function(evt){evt.preventDefault()})},Chosen.prototype.destroy=function(){return $(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.search_field[0].tabIndex&&(this.form_field_jq[0].tabIndex=this.search_field[0].tabIndex),this.container.remove(),this.form_field_jq.removeData("chosen"),this.form_field_jq.show()},Chosen.prototype.search_field_disabled=function(){return this.is_disabled=this.form_field_jq[0].disabled,this.is_disabled?(this.container.addClass("chosen-disabled"),this.search_field[0].disabled=!0,this.is_multiple||this.selected_item.unbind("focus.chosen",this.activate_action),this.close_field()):(this.container.removeClass("chosen-disabled"),this.search_field[0].disabled=!1,this.is_multiple?void 0:this.selected_item.bind("focus.chosen",this.activate_action))},Chosen.prototype.container_mousedown=function(evt){return this.is_disabled||(evt&&"mousedown"===evt.type&&!this.results_showing&&evt.preventDefault(),null!=evt&&$(evt.target).hasClass("search-choice-close"))?void 0:(this.active_field?this.is_multiple||!evt||$(evt.target)[0]!==this.selected_item[0]&&!$(evt.target).parents("a.chosen-single").length||(evt.preventDefault(),this.results_toggle()):(this.is_multiple&&this.search_field.val(""),$(this.container[0].ownerDocument).bind("click.chosen",this.click_test_action),this.results_show()),this.activate_field())},Chosen.prototype.container_mouseup=function(evt){return"ABBR"!==evt.target.nodeName||this.is_disabled?void 0:this.results_reset(evt)},Chosen.prototype.search_results_mousewheel=function(evt){var delta;return evt.originalEvent&&(delta=-evt.originalEvent.wheelDelta||evt.originalEvent.detail),null!=delta?(evt.preventDefault(),"DOMMouseScroll"===evt.type&&(delta=40*delta),this.search_results.scrollTop(delta+this.search_results.scrollTop())):void 0},Chosen.prototype.blur_test=function(evt){return!this.active_field&&this.container.hasClass("chosen-container-active")?this.close_field():void 0},Chosen.prototype.close_field=function(){return $(this.container[0].ownerDocument).unbind("click.chosen",this.click_test_action),this.active_field=!1,this.results_hide(),this.container.removeClass("chosen-container-active"),this.clear_backstroke(),this.show_search_field_default(),this.search_field_scale()},Chosen.prototype.activate_field=function(){return this.container.addClass("chosen-container-active"),this.active_field=!0,this.search_field.val(this.search_field.val()),this.search_field.focus()},Chosen.prototype.test_active_click=function(evt){var active_container;return active_container=$(evt.target).closest(".chosen-container"),active_container.length&&this.container[0]===active_container[0]?this.active_field=!0:this.close_field()},Chosen.prototype.results_build=function(){return this.parsing=!0,this.selected_option_count=null,this.results_data=SelectParser.select_to_array(this.form_field),this.is_multiple?this.search_choices.find("li.search-choice").remove():this.is_multiple||(this.single_set_selected_text(),this.disable_search||this.form_field.options.length<=this.disable_search_threshold?(this.search_field[0].readOnly=!0,this.container.addClass("chosen-container-single-nosearch")):(this.search_field[0].readOnly=!1,this.container.removeClass("chosen-container-single-nosearch"))),this.update_results_content(this.results_option_build({first:!0})),this.search_field_disabled(),this.show_search_field_default(),this.search_field_scale(),this.parsing=!1},Chosen.prototype.result_do_highlight=function(el){var high_bottom,high_top,maxHeight,visible_bottom,visible_top;if(el.length){if(this.result_clear_highlight(),this.result_highlight=el,this.result_highlight.addClass("highlighted"),maxHeight=parseInt(this.search_results.css("maxHeight"),10),visible_top=this.search_results.scrollTop(),visible_bottom=maxHeight+visible_top,high_top=this.result_highlight.position().top+this.search_results.scrollTop(),high_bottom=high_top+this.result_highlight.outerHeight(),high_bottom>=visible_bottom)return this.search_results.scrollTop(high_bottom-maxHeight>0?high_bottom-maxHeight:0);if(visible_top>high_top)return this.search_results.scrollTop(high_top)}},Chosen.prototype.result_clear_highlight=function(){return this.result_highlight&&this.result_highlight.removeClass("highlighted"),this.result_highlight=null},Chosen.prototype.results_show=function(){return this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.container.addClass("chosen-with-drop"),this.results_showing=!0,this.search_field.focus(),this.search_field.val(this.search_field.val()),this.winnow_results(),this.form_field_jq.trigger("chosen:showing_dropdown",{chosen:this}))},Chosen.prototype.update_results_content=function(content){return this.search_results.html(content)},Chosen.prototype.results_hide=function(){return this.results_showing&&(this.result_clear_highlight(),this.container.removeClass("chosen-with-drop"),this.form_field_jq.trigger("chosen:hiding_dropdown",{chosen:this})),this.results_showing=!1},Chosen.prototype.set_tab_index=function(el){var ti;return this.form_field.tabIndex?(ti=this.form_field.tabIndex,this.form_field.tabIndex=-1,this.search_field[0].tabIndex=ti):void 0},Chosen.prototype.set_label_behavior=function(){var _this=this;return this.form_field_label=this.form_field_jq.parents("label"),!this.form_field_label.length&&this.form_field.id.length&&(this.form_field_label=$("label[for='"+this.form_field.id+"']")),this.form_field_label.length>0?this.form_field_label.bind("click.chosen",function(evt){return _this.is_multiple?_this.container_mousedown(evt):_this.activate_field()}):void 0},Chosen.prototype.show_search_field_default=function(){return this.is_multiple&&this.choices_count()<1&&!this.active_field?(this.search_field.val(this.default_text),this.search_field.addClass("default")):(this.search_field.val(""),this.search_field.removeClass("default"))},Chosen.prototype.search_results_mouseup=function(evt){var target;return target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first(),target.length?(this.result_highlight=target,this.result_select(evt),this.search_field.focus()):void 0},Chosen.prototype.search_results_mouseover=function(evt){var target;return target=$(evt.target).hasClass("active-result")?$(evt.target):$(evt.target).parents(".active-result").first(),target?this.result_do_highlight(target):void 0},Chosen.prototype.search_results_mouseout=function(evt){return $(evt.target).hasClass("active-result")?this.result_clear_highlight():void 0},Chosen.prototype.choice_build=function(item){var choice,close_link,_this=this;return choice=$("<li />",{"class":"search-choice"}).html("<span>"+item.html+"</span>"),item.disabled?choice.addClass("search-choice-disabled"):(close_link=$("<a />",{"class":"search-choice-close","data-option-array-index":item.array_index}),close_link.bind("click.chosen",function(evt){return _this.choice_destroy_link_click(evt)}),choice.append(close_link)),this.search_container.before(choice)},Chosen.prototype.choice_destroy_link_click=function(evt){return evt.preventDefault(),evt.stopPropagation(),this.is_disabled?void 0:this.choice_destroy($(evt.target))},Chosen.prototype.choice_destroy=function(link){return this.result_deselect(link[0].getAttribute("data-option-array-index"))?(this.show_search_field_default(),this.is_multiple&&this.choices_count()>0&&this.search_field.val().length<1&&this.results_hide(),link.parents("li").first().remove(),this.search_field_scale()):void 0},Chosen.prototype.results_reset=function(){return this.reset_single_select_options(),this.form_field.options[0].selected=!0,this.single_set_selected_text(),this.show_search_field_default(),this.results_reset_cleanup(),this.form_field_jq.trigger("change"),this.active_field?this.results_hide():void 0},Chosen.prototype.results_reset_cleanup=function(){return this.current_selectedIndex=this.form_field.selectedIndex,this.selected_item.find("abbr").remove()},Chosen.prototype.result_select=function(evt){var high,item;return this.result_highlight?(high=this.result_highlight,this.result_clear_highlight(),this.is_multiple&&this.max_selected_options<=this.choices_count()?(this.form_field_jq.trigger("chosen:maxselected",{chosen:this}),!1):(this.is_multiple?high.removeClass("active-result"):this.reset_single_select_options(),item=this.results_data[high[0].getAttribute("data-option-array-index")],item.selected=!0,this.form_field.options[item.options_index].selected=!0,this.selected_option_count=null,this.is_multiple?this.choice_build(item):this.single_set_selected_text(item.text),(evt.metaKey||evt.ctrlKey)&&this.is_multiple||this.results_hide(),this.search_field.val(""),(this.is_multiple||this.form_field.selectedIndex!==this.current_selectedIndex)&&this.form_field_jq.trigger("change",{selected:this.form_field.options[item.options_index].value}),this.current_selectedIndex=this.form_field.selectedIndex,this.search_field_scale())):void 0},Chosen.prototype.single_set_selected_text=function(text){return null==text&&(text=this.default_text),text===this.default_text?this.selected_item.addClass("chosen-default"):(this.single_deselect_control_build(),this.selected_item.removeClass("chosen-default")),this.selected_item.find("span").text(text)},Chosen.prototype.result_deselect=function(pos){var result_data;return result_data=this.results_data[pos],this.form_field.options[result_data.options_index].disabled?!1:(result_data.selected=!1,this.form_field.options[result_data.options_index].selected=!1,this.selected_option_count=null,this.result_clear_highlight(),this.results_showing&&this.winnow_results(),this.form_field_jq.trigger("change",{deselected:this.form_field.options[result_data.options_index].value}),this.search_field_scale(),!0)},Chosen.prototype.single_deselect_control_build=function(){return this.allow_single_deselect?(this.selected_item.find("abbr").length||this.selected_item.find("span").first().after('<abbr class="search-choice-close"></abbr>'),this.selected_item.addClass("chosen-single-with-deselect")):void 0},Chosen.prototype.get_search_text=function(){return this.search_field.val()===this.default_text?"":$("<div/>").text($.trim(this.search_field.val())).html()},Chosen.prototype.winnow_results_set_highlight=function(){var do_high,selected_results;return selected_results=this.is_multiple?[]:this.search_results.find(".result-selected.active-result"),do_high=selected_results.length?selected_results.first():this.search_results.find(".active-result").first(),null!=do_high?this.result_do_highlight(do_high):void 0},Chosen.prototype.no_results=function(terms){var no_results_html;return no_results_html=$('<li class="no-results">'+this.results_none_found+' "<span></span>"</li>'),no_results_html.find("span").first().html(terms),this.search_results.append(no_results_html),this.form_field_jq.trigger("chosen:no_results",{chosen:this})},Chosen.prototype.no_results_clear=function(){return this.search_results.find(".no-results").remove()},Chosen.prototype.keydown_arrow=function(){var next_sib;return this.results_showing&&this.result_highlight?(next_sib=this.result_highlight.nextAll("li.active-result").first())?this.result_do_highlight(next_sib):void 0:this.results_show()},Chosen.prototype.keyup_arrow=function(){var prev_sibs;return this.results_showing||this.is_multiple?this.result_highlight?(prev_sibs=this.result_highlight.prevAll("li.active-result"),prev_sibs.length?this.result_do_highlight(prev_sibs.first()):(this.choices_count()>0&&this.results_hide(),this.result_clear_highlight())):void 0:this.results_show()},Chosen.prototype.keydown_backstroke=function(){var next_available_destroy;return this.pending_backstroke?(this.choice_destroy(this.pending_backstroke.find("a").first()),this.clear_backstroke()):(next_available_destroy=this.search_container.siblings("li.search-choice").last(),next_available_destroy.length&&!next_available_destroy.hasClass("search-choice-disabled")?(this.pending_backstroke=next_available_destroy,this.single_backstroke_delete?this.keydown_backstroke():this.pending_backstroke.addClass("search-choice-focus")):void 0)},Chosen.prototype.clear_backstroke=function(){return this.pending_backstroke&&this.pending_backstroke.removeClass("search-choice-focus"),this.pending_backstroke=null},Chosen.prototype.keydown_checker=function(evt){var stroke,_ref1;switch(stroke=null!=(_ref1=evt.which)?_ref1:evt.keyCode,this.search_field_scale(),8!==stroke&&this.pending_backstroke&&this.clear_backstroke(),stroke){case 8:this.backstroke_length=this.search_field.val().length;break;case 9:this.results_showing&&!this.is_multiple&&this.result_select(evt),this.mouse_on_container=!1;break;case 13:evt.preventDefault();break;case 38:evt.preventDefault(),this.keyup_arrow();break;case 40:evt.preventDefault(),this.keydown_arrow()}},Chosen.prototype.search_field_scale=function(){var div,f_width,h,style,style_block,styles,w,_i,_len;if(this.is_multiple){for(h=0,w=0,style_block="position:absolute; left: -1000px; top: -1000px; display:none;",styles=["font-size","font-style","font-weight","font-family","line-height","text-transform","letter-spacing"],_i=0,_len=styles.length;_len>_i;_i++)style=styles[_i],style_block+=style+":"+this.search_field.css(style)+";";return div=$("<div />",{style:style_block}),div.text(this.search_field.val()),$("body").append(div),w=div.width()+25,div.remove(),f_width=this.container.outerWidth(),w>f_width-10&&(w=f_width-10),this.search_field.css({width:w+"px"})}},Chosen}(AbstractChosen)}.call(this),/*!
 * jQuery UI Touch Punch 0.2.2
 *
 * Copyright 2011, Dave Furfero
 * Dual licensed under the MIT or GPL Version 2 licenses.
 *
 * Depends:
 *  jquery.ui.widget.js
 *  jquery.ui.mouse.js
 */
function($){function simulateMouseEvent(event,simulatedType){if(!(event.originalEvent.touches.length>1)){event.preventDefault();var touch=event.originalEvent.changedTouches[0],simulatedEvent=document.createEvent("MouseEvents");simulatedEvent.initMouseEvent(simulatedType,!0,!0,window,1,touch.screenX,touch.screenY,touch.clientX,touch.clientY,!1,!1,!1,!1,0,null),event.target.dispatchEvent(simulatedEvent)}}if($.support.touch="ontouchend"in document,$.support.touch){var touchHandled,mouseProto=$.ui.mouse.prototype,_mouseInit=mouseProto._mouseInit;mouseProto._touchStart=function(event){var self=this;!touchHandled&&self._mouseCapture(event.originalEvent.changedTouches[0])&&(touchHandled=!0,self._touchMoved=!1,simulateMouseEvent(event,"mouseover"),simulateMouseEvent(event,"mousemove"),simulateMouseEvent(event,"mousedown"))},mouseProto._touchMove=function(event){touchHandled&&(this._touchMoved=!0,simulateMouseEvent(event,"mousemove"))},mouseProto._touchEnd=function(event){touchHandled&&(simulateMouseEvent(event,"mouseup"),simulateMouseEvent(event,"mouseout"),this._touchMoved||simulateMouseEvent(event,"click"),touchHandled=!1)},mouseProto._mouseInit=function(){var self=this;self.element.bind("touchstart",$.proxy(self,"_touchStart")).bind("touchmove",$.proxy(self,"_touchMove")).bind("touchend",$.proxy(self,"_touchEnd")),_mouseInit.call(self)}}}(jQuery),function($){function applyFormat(element,options,output,indent){if(!element.tag.isInline&&output.length>0)for(output.push("\n"),i=0;i<indent;i++)output.push("	")}function render(element,options){var indent,output=[],empty=0==element.attributes.length,renderTag=(this.name.concat(void 0==element.tag.rawAttributes?"":element.tag.rawAttributes),element.tag.render&&(0==options.allowedTags.length||$.inArray(element.tag.name,options.allowedTags)>-1)&&(0==options.removeTags.length||-1==$.inArray(element.tag.name,options.removeTags)));if(!element.isRoot&&renderTag&&(output.push("<"),output.push(element.tag.name),$.each(element.attributes,function(){if(-1==$.inArray(this.name,options.removeAttrs)){var m=RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),value=m[2],valueQuote=m[1]||"'";"class"==this.name&&(value=$.grep(value.split(" "),function(c){return $.grep(options.allowedClasses,function(a){return a[0]==c&&(1==a.length||$.inArray(element.tag.name,a[1])>-1)}).length>0}).join(" "),valueQuote="'"),null!=value&&(value.length>0||$.inArray(this.name,element.tag.requiredAttributes)>-1)&&(output.push(" "),output.push(this.name),output.push("="),output.push(valueQuote),output.push(value),output.push(valueQuote))}})),element.tag.isSelfClosing)renderTag&&output.push(" />"),empty=!1;else if(element.tag.isNonClosing)empty=!1;else{!element.isRoot&&renderTag&&output.push(">");var indent=options.formatIndent++;if(element.tag.toProtect){var outputChildren=$.htmlClean.trim(element.children.join("")).replace(/<br>/gi,"\n");output.push(outputChildren),empty=0==outputChildren.length}else{for(var outputChildren=[],i=0;i<element.children.length;i++){var child=element.children[i],text=$.htmlClean.trim(textClean(isText(child)?child:child.childrenToString()));isInline(child)&&i>0&&text.length>0&&(startsWithWhitespace(child)||endsWithWhitespace(element.children[i-1]))&&outputChildren.push(" "),isText(child)?text.length>0&&outputChildren.push(text):(i!=element.children.length-1||"br"!=child.tag.name)&&(options.format&&applyFormat(child,options,outputChildren,indent),outputChildren=outputChildren.concat(render(child,options)))}options.formatIndent--,outputChildren.length>0&&(options.format&&"\n"!=outputChildren[0]&&applyFormat(element,options,output,indent),output=output.concat(outputChildren),empty=!1)}!element.isRoot&&renderTag&&(options.format&&applyFormat(element,options,output,indent-1),output.push("</"),output.push(element.tag.name),output.push(">"))}return!element.tag.allowEmpty&&empty?[]:output}function pop(stack,tagNameArray,index){return index=index||1,$.inArray(stack[stack.length-index].tag.name,tagNameArray)>-1?!0:stack.length-(index+1)>0&&pop(stack,tagNameArray,index+1)?(stack.pop(),!0):!1}function Element(tag){return tag?(this.tag=tag,this.isRoot=!1):(this.tag=new Tag("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(name){for(var i=0;i<this.attributes.length;i++)if(this.attributes[i].name==name)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function Attribute(name,value){return this.name=name,this.value=value,this}function Tag(name,close,rawAttributes,options){if(this.name=name.toLowerCase(),this.isSelfClosing=$.inArray(this.name,tagSelfClosing)>-1,this.isNonClosing=$.inArray(this.name,tagNonClosing)>-1,this.isClosing=void 0!=close&&close.length>0,this.isInline=$.inArray(this.name,tagInline)>-1,this.disallowNest=$.inArray(this.name,tagDisallowNest)>-1,this.requiredParent=tagRequiredParent[$.inArray(this.name,tagRequiredParent)+1],this.allowEmpty=$.inArray(this.name,tagAllowEmpty)>-1,this.toProtect=$.inArray(this.name,tagProtect)>-1,this.rawAttributes=rawAttributes,this.requiredAttributes=tagAttributesRequired[$.inArray(this.name,tagAttributesRequired)+1],options){if(options.tagAttributesCache||(options.tagAttributesCache=[]),-1==$.inArray(this.name,options.tagAttributesCache)){for(var cacheItem=tagAttributes[$.inArray(this.name,tagAttributes)+1].slice(0),i=0;i<options.allowedAttributes.length;i++){var attrName=options.allowedAttributes[i][0];(1==options.allowedAttributes[i].length||$.inArray(this.name,options.allowedAttributes[i][1])>-1)&&-1==$.inArray(attrName,cacheItem)&&cacheItem.push(attrName)}options.tagAttributesCache.push(this.name),options.tagAttributesCache.push(cacheItem)}this.allowedAttributes=options.tagAttributesCache[$.inArray(this.name,options.tagAttributesCache)+1]}return this.render=!0,this}function startsWithWhitespace(item){for(;isElement(item)&&item.children.length>0;)item=item.children[0];return isText(item)&&item.length>0&&$.htmlClean.isWhitespace(item.charAt(0))}function endsWithWhitespace(item){for(;isElement(item)&&item.children.length>0;)item=item.children[item.children.length-1];return isText(item)&&item.length>0&&$.htmlClean.isWhitespace(item.charAt(item.length-1))}function isText(item){return item.constructor==String}function isInline(item){return isText(item)||item.tag.isInline}function isElement(item){return item.constructor==Element}function textClean(text){return text.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}$.fn.htmlClean=function(options){return this.each(function(){$(this);this.value?this.value=$.htmlClean(this.value,options):this.innerHTML=$.htmlClean(this.innerHTML,options)})},$.htmlClean=function(html,options){options=$.extend({},$.htmlClean.defaults,options);var tagMatch,tagsRE=/<(\/)?(\w+:)?([\w]+)([^>]*)>/gi,attrsRE=/(\w+)=(".*?"|'.*?'|[^\s>]*)/gi,root=new Element,stack=[root],container=root;options.bodyOnly&&(tagMatch=/<body[^>]*>((\n|.)*)<\/body>/i.exec(html))&&(html=tagMatch[1]),html=html.concat("<xxx>");for(var lastIndex;tagMatch=tagsRE.exec(html);){var tag=new Tag(tagMatch[3],tagMatch[1],tagMatch[4],options),text=html.substring(lastIndex,tagMatch.index);if(text.length>0){var child=container.children[container.children.length-1];container.children.length>0&&isText(child=container.children[container.children.length-1])?container.children[container.children.length-1]=child.concat(text):container.children.push(text)}if(lastIndex=tagsRE.lastIndex,tag.isClosing)pop(stack,[tag.name])&&(stack.pop(),container=stack[stack.length-1]);else{for(var attrMatch,element=new Element(tag);attrMatch=attrsRE.exec(tag.rawAttributes);){if("style"==attrMatch[1].toLowerCase()&&options.replaceStyles)for(var renderParent=!tag.isInline,i=0;i<options.replaceStyles.length;i++)options.replaceStyles[i][0].test(attrMatch[2])&&(renderParent||(tag.render=!1,renderParent=!0),container.children.push(element),stack.push(element),container=element,tag=new Tag(options.replaceStyles[i][1],"","",options),element=new Element(tag));null!=tag.allowedAttributes&&(0==tag.allowedAttributes.length||$.inArray(attrMatch[1],tag.allowedAttributes)>-1)&&element.attributes.push(new Attribute(attrMatch[1],attrMatch[2]))}$.each(tag.requiredAttributes,function(){var name=this.toString();element.hasAttribute(name)||element.attributes.push(new Attribute(name,""))});for(var repIndex=0;repIndex<options.replace.length;repIndex++)for(var tagIndex=0;tagIndex<options.replace[repIndex][0].length;tagIndex++){var byName="string"==typeof options.replace[repIndex][0][tagIndex];if(byName&&options.replace[repIndex][0][tagIndex]==tag.name||!byName&&options.replace[repIndex][0][tagIndex].test(tagMatch)){tag.render=!1,container.children.push(element),stack.push(element),container=element,tag=new Tag(options.replace[repIndex][1],tagMatch[1],tagMatch[4],options),element=new Element(tag),element.attributes=container.attributes,repIndex=options.replace.length;break}}var add=!0;if(container.isRoot||(container.tag.isInline&&!tag.isInline?add=!1:container.tag.disallowNest&&tag.disallowNest&&!tag.requiredParent?add=!1:tag.requiredParent&&(add=pop(stack,tag.requiredParent))&&(container=stack[stack.length-1])),add)if(container.children.push(element),tag.toProtect)for(;tagMatch2=tagsRE.exec(html);){var tag2=new Tag(tagMatch2[3],tagMatch2[1],tagMatch2[4],options);if(tag2.isClosing&&tag2.name==tag.name){element.children.push(RegExp.leftContext.substring(lastIndex)),lastIndex=tagsRE.lastIndex;break}}else tag.isSelfClosing||tag.isNonClosing||(stack.push(element),container=element)}}return $.htmlClean.trim(render(root,options).join(""))},$.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],allowedAttributes:[],removeAttrs:[],allowedClasses:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]]},$.htmlClean.trim=function(text){return $.htmlClean.trimStart($.htmlClean.trimEnd(text))},$.htmlClean.trimStart=function(text){return text.substring($.htmlClean.trimStartIndex(text))},$.htmlClean.trimStartIndex=function(text){for(var start=0;start<text.length-1&&$.htmlClean.isWhitespace(text.charAt(start));start++);return start},$.htmlClean.trimEnd=function(text){return text.substring(0,$.htmlClean.trimEndIndex(text))},$.htmlClean.trimEndIndex=function(text){for(var end=text.length-1;end>=0&&$.htmlClean.isWhitespace(text.charAt(end));end--);return end+1},$.htmlClean.isWhitespace=function(c){return-1!=$.inArray(c,whitespace)};var tagInline=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","s","samp","select","small","span","strike","strong","sub","sup","tt","u","var"],tagDisallowNest=["h1","h2","h3","h4","h5","h6","p","th","td"],tagAllowEmpty=["th","td"],tagRequiredParent=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"]],tagProtect=["script","style","pre","code"],tagSelfClosing=["br","hr","img","link","meta"],tagNonClosing=["!doctype","?xml"],tagAttributes=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme","charset"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"th",["class","colspan","rowspan"],"td",["class","colspan","rowspan"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"]],tagAttributesRequired=[[],"img",["alt"]],whitespace=["\xa0"," ","	","\n","\r","\f"]}(jQuery),function(){var $,cardFromNumber,cardFromType,cards,defaultFormat,formatBackCardNumber,formatBackExpiry,formatCardNumber,formatExpiry,formatForwardExpiry,formatForwardSlash,hasTextSelected,luhnCheck,reFormatCardNumber,restrictCVC,restrictCardNumber,restrictExpiry,restrictNumeric,setCardType,slice=[].slice,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};$=jQuery,$.payment={},$.payment.fn={},$.fn.payment=function(){var args,method;return method=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],$.payment.fn[method].apply(this,args)},defaultFormat=/(\d{1,4})/g,cards=[{type:"maestro",pattern:/^(5018|5020|5038|6304|6759|676[1-3])/,format:defaultFormat,length:[12,13,14,15,16,17,18,19],cvcLength:[3],luhn:!0},{type:"dinersclub",pattern:/^(36|38|30[0-5])/,format:defaultFormat,length:[14],cvcLength:[3],luhn:!0},{type:"laser",pattern:/^(6706|6771|6709)/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!0},{type:"jcb",pattern:/^35/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"unionpay",pattern:/^62/,format:defaultFormat,length:[16,17,18,19],cvcLength:[3],luhn:!1},{type:"discover",pattern:/^(6011|65|64[4-9]|622)/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"mastercard",pattern:/^5[1-5]/,format:defaultFormat,length:[16],cvcLength:[3],luhn:!0},{type:"amex",pattern:/^3[47]/,format:/(\d{1,4})(\d{1,6})?(\d{1,5})?/,length:[15],cvcLength:[3,4],luhn:!0},{type:"visa",pattern:/^4/,format:defaultFormat,length:[13,14,15,16],cvcLength:[3],luhn:!0}],cardFromNumber=function(num){var card,i,len;for(num=(num+"").replace(/\D/g,""),i=0,len=cards.length;len>i;i++)if(card=cards[i],card.pattern.test(num))return card},cardFromType=function(type){var card,i,len;for(i=0,len=cards.length;len>i;i++)if(card=cards[i],card.type===type)return card},luhnCheck=function(num){var digit,digits,i,len,odd,sum;for(odd=!0,sum=0,digits=(num+"").split("").reverse(),i=0,len=digits.length;len>i;i++)digit=digits[i],digit=parseInt(digit,10),(odd=!odd)&&(digit*=2),digit>9&&(digit-=9),sum+=digit;return sum%10===0},hasTextSelected=function($target){var ref;return null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==$target.prop("selectionEnd")?!0:("undefined"!=typeof document&&null!==document&&null!=(ref=document.selection)&&"function"==typeof ref.createRange?ref.createRange().text:void 0)?!0:!1},reFormatCardNumber=function(e){return setTimeout(function(_this){return function(){var $target,value;return $target=$(e.currentTarget),value=$target.val(),value=$.payment.formatCardNumber(value),$target.val(value)}}(this))},formatCardNumber=function(e){var $target,card,digit,length,re,upperLength,value;return digit=String.fromCharCode(e.which),!/^\d+$/.test(digit)||($target=$(e.currentTarget),value=$target.val(),card=cardFromNumber(value+digit),length=(value.replace(/\D/g,"")+digit).length,upperLength=16,card&&(upperLength=card.length[card.length.length-1]),length>=upperLength||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length)?void 0:(re=card&&"amex"===card.type?/^(\d{4}|\d{4}\s\d{6})$/:/(?:^|\s)(\d{4})$/,re.test(value)?(e.preventDefault(),$target.val(value+" "+digit)):re.test(value+digit)?(e.preventDefault(),$target.val(value+digit+" ")):void 0)},formatBackCardNumber=function(e){var $target,value;return $target=$(e.currentTarget),value=$target.val(),e.meta||8!==e.which||null!=$target.prop("selectionStart")&&$target.prop("selectionStart")!==value.length?void 0:/\d\s$/.test(value)?(e.preventDefault(),$target.val(value.replace(/\d\s$/,""))):/\s\d?$/.test(value)?(e.preventDefault(),$target.val(value.replace(/\s\d?$/,""))):void 0},formatExpiry=function(e){var $target,digit,val;return digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?($target=$(e.currentTarget),val=$target.val()+digit,/^\d$/.test(val)&&"0"!==val&&"1"!==val?(e.preventDefault(),$target.val("0"+val+" / ")):/^\d\d$/.test(val)?(e.preventDefault(),$target.val(val+" / ")):void 0):void 0},formatForwardExpiry=function(e){var $target,digit,val;return digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?($target=$(e.currentTarget),val=$target.val(),/^\d\d$/.test(val)?$target.val(val+" / "):void 0):void 0},formatForwardSlash=function(e){var $target,slash,val;return slash=String.fromCharCode(e.which),"/"===slash?($target=$(e.currentTarget),val=$target.val(),/^\d$/.test(val)&&"0"!==val?$target.val("0"+val+" / "):void 0):void 0},formatBackExpiry=function(e){var $target,value;if(!e.meta&&($target=$(e.currentTarget),value=$target.val(),8===e.which&&(null==$target.prop("selectionStart")||$target.prop("selectionStart")===value.length)))return/\d(\s|\/)+$/.test(value)?(e.preventDefault(),$target.val(value.replace(/\d(\s|\/)*$/,""))):/\s\/\s?\d?$/.test(value)?(e.preventDefault(),$target.val(value.replace(/\s\/\s?\d?$/,""))):void 0},restrictNumeric=function(e){var input;return e.metaKey||e.ctrlKey?!0:32===e.which?!1:0===e.which?!0:e.which<33?!0:(input=String.fromCharCode(e.which),!!/[\d\s]/.test(input))},restrictCardNumber=function(e){var $target,card,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=($target.val()+digit).replace(/\D/g,""),card=cardFromNumber(value),card?value.length<=card.length[card.length.length-1]:value.length<=16):void 0},restrictExpiry=function(e){var $target,digit,value;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)&&!hasTextSelected($target)?(value=$target.val()+digit,value=value.replace(/\D/g,""),value.length>6?!1:void 0):void 0},restrictCVC=function(e){var $target,digit,val;return $target=$(e.currentTarget),digit=String.fromCharCode(e.which),/^\d+$/.test(digit)?(val=$target.val()+digit,val.length<=4):void 0},setCardType=function(e){var $target,allTypes,card,cardType,val;return $target=$(e.currentTarget),val=$target.val(),cardType=$.payment.cardType(val)||"unknown",$target.hasClass(cardType)?void 0:(allTypes=function(){var i,len,results;for(results=[],i=0,len=cards.length;len>i;i++)card=cards[i],results.push(card.type);return results}(),$target.removeClass("unknown"),$target.removeClass(allTypes.join(" ")),$target.addClass(cardType),$target.toggleClass("identified","unknown"!==cardType),$target.trigger("payment.cardType",cardType))},$.payment.fn.formatCardCVC=function(){return this.payment("restrictNumeric"),this.on("keypress",restrictCVC),this},$.payment.fn.formatCardExpiry=function(){return this.payment("restrictNumeric"),this.on("keypress",restrictExpiry),this.on("keypress",formatExpiry),this.on("keypress",formatForwardSlash),this.on("keypress",formatForwardExpiry),this.on("keydown",formatBackExpiry),this},$.payment.fn.formatCardNumber=function(){return this.payment("restrictNumeric"),this.on("keypress",restrictCardNumber),this.on("keypress",formatCardNumber),this.on("keydown",formatBackCardNumber),this.on("keyup",setCardType),this.on("paste",reFormatCardNumber),this},$.payment.fn.restrictNumeric=function(){return this.on("keypress",restrictNumeric),this},$.payment.fn.cardExpiryVal=function(){return $.payment.cardExpiryVal($(this).val())},$.payment.cardExpiryVal=function(value){var month,prefix,ref,year;return value=value.replace(/\s/g,""),ref=value.split("/",2),month=ref[0],year=ref[1],2===(null!=year?year.length:void 0)&&/^\d+$/.test(year)&&(prefix=(new Date).getFullYear(),prefix=prefix.toString().slice(0,2),year=prefix+year),month=parseInt(month,10),year=parseInt(year,10),{month:month,year:year}},$.payment.validateCardNumber=function(num){var card,ref;return num=(num+"").replace(/\s+|-/g,""),/^\d+$/.test(num)?(card=cardFromNumber(num),card?(ref=num.length,indexOf.call(card.length,ref)>=0&&(card.luhn===!1||luhnCheck(num))):!1):!1},$.payment.validateCardExpiry=function(_this){return function(month,year){var currentTime,expiry,prefix,ref;return"object"==typeof month&&"month"in month&&(ref=month,month=ref.month,year=ref.year),month&&year?(month=$.trim(month),year=$.trim(year),/^\d+$/.test(month)&&/^\d+$/.test(year)&&parseInt(month,10)<=12?(2===year.length&&(prefix=(new Date).getFullYear(),prefix=prefix.toString().slice(0,2),year=prefix+year),expiry=new Date(year,month),currentTime=new Date,expiry.setMonth(expiry.getMonth()-1),expiry.setMonth(expiry.getMonth()+1,1),expiry>currentTime):!1):!1}}(this),$.payment.validateCardCVC=function(cvc,type){var ref,ref1;return cvc=$.trim(cvc),/^\d+$/.test(cvc)?type?(ref=cvc.length,indexOf.call(null!=(ref1=cardFromType(type))?ref1.cvcLength:void 0,ref)>=0):cvc.length>=3&&cvc.length<=4:!1},$.payment.cardType=function(num){var ref;return num?(null!=(ref=cardFromNumber(num))?ref.type:void 0)||null:null},$.payment.formatCardNumber=function(num){var card,groups,ref,upperLength;return(card=cardFromNumber(num))?(upperLength=card.length[card.length.length-1],num=num.replace(/\D/g,""),num=num.slice(0,+upperLength+1||9e9),card.format.global?null!=(ref=num.match(card.format))?ref.join(" "):void 0:(groups=card.format.exec(num),null!=groups&&groups.shift(),null!=groups?groups.join(" "):void 0)):num}}.call(this),function($){function both(val){return"object"==typeof val?val:{top:val,left:val}}var $scrollTo=$.scrollTo=function(target,duration,settings){$(window).scrollTo(target,duration,settings)};$scrollTo.defaults={axis:"xy",duration:parseFloat($.fn.jquery)>=1.3?0:1,limit:!0},$scrollTo.window=function(scope){return $(window)._scrollable()},$.fn._scrollable=function(){return this.map(function(){var elem=this,isWin=!elem.nodeName||-1!=$.inArray(elem.nodeName.toLowerCase(),["iframe","#document","html","body"]);if(!isWin)return elem;var doc=(elem.contentWindow||elem).document||elem.ownerDocument||elem;return/webkit/i.test(navigator.userAgent)||"BackCompat"==doc.compatMode?doc.body:doc.documentElement})},$.fn.scrollTo=function(target,duration,settings){return"object"==typeof duration&&(settings=duration,duration=0),"function"==typeof settings&&(settings={onAfter:settings}),"max"==target&&(target=9e9),settings=$.extend({},$scrollTo.defaults,settings),duration=duration||settings.duration,settings.queue=settings.queue&&settings.axis.length>1,settings.queue&&(duration/=2),settings.offset=both(settings.offset),settings.over=both(settings.over),this._scrollable().each(function(){function animate(callback){$elem.animate(attr,duration,settings.easing,callback&&function(){callback.call(this,target,settings)})}if(null!=target){var toff,elem=this,$elem=$(elem),targ=target,attr={},win=$elem.is("html,body");switch(typeof targ){case"number":case"string":if(/^([+-]=?)?\d+(\.\d+)?(px|%)?$/.test(targ)){targ=both(targ);break}if(targ=$(targ,this),!targ.length)return;case"object":(targ.is||targ.style)&&(toff=(targ=$(targ)).offset())}$.each(settings.axis.split(""),function(i,axis){var Pos="x"==axis?"Left":"Top",pos=Pos.toLowerCase(),key="scroll"+Pos,old=elem[key],max=$scrollTo.max(elem,axis);if(toff)attr[key]=toff[pos]+(win?0:old-$elem.offset()[pos]),settings.margin&&(attr[key]-=parseInt(targ.css("margin"+Pos))||0,attr[key]-=parseInt(targ.css("border"+Pos+"Width"))||0),attr[key]+=settings.offset[pos]||0,settings.over[pos]&&(attr[key]+=targ["x"==axis?"width":"height"]()*settings.over[pos]);else{var val=targ[pos];attr[key]=val.slice&&"%"==val.slice(-1)?parseFloat(val)/100*max:val}settings.limit&&/^\d+$/.test(attr[key])&&(attr[key]=attr[key]<=0?0:Math.min(attr[key],max)),!i&&settings.queue&&(old!=attr[key]&&animate(settings.onAfterFirst),delete attr[key])}),animate(settings.onAfter)}}).end()},$scrollTo.max=function(elem,axis){var Dim="x"==axis?"Width":"Height",scroll="scroll"+Dim;if(!$(elem).is("html,body"))return elem[scroll]-$(elem)[Dim.toLowerCase()]();var size="client"+Dim,html=elem.ownerDocument.documentElement,body=elem.ownerDocument.body;return Math.max(html[scroll],body[scroll])-Math.min(html[size],body[size])}}(jQuery),function(d,B,C){function G(a,b,h,c){if("d"!=h){var f=H.exec(b),e="auto"===a.css(h)?0:a.css(h),e="string"==typeof e?x(e):e;"string"==typeof b&&x(b);var c=!0===c?0:e,d=a.is(":hidden"),i=a.translation();return"left"==h&&(c=parseInt(e,10)+i.x),"right"==h&&(c=parseInt(e,10)+i.x),"top"==h&&(c=parseInt(e,10)+i.y),"bottom"==h&&(c=parseInt(e,10)+i.y),f||"show"!=b?!f&&"hide"==b&&(c=0):(c=1,d&&a.css({display:"block",opacity:0})),f?(a=parseFloat(f[2]),f[1]&&(a=("-="===f[1]?-1:1)*a+parseInt(c,10)),a):c}}function I(a,b,h,c,f,e,g,i){var j=a.data(q),j=j&&!u(j)?j:d.extend(!0,{},J),n=f;if(-1<d.inArray(b,y)){var o=j.meta,m=x(a.css(b))||0,l=b+"_o",n=f-m;o[b]=n,o[l]="auto"==a.css(b)?0+n:m+n||0,j.meta=o,g&&0===n&&(n=0-o[l],o[b]=n,o[l]=0)}return a.data(q,K(a,j,b,h,c,n,e,g,i))}function K(a,b,d,c,f,e,g,i,j){var n=!1,g=!0===g&&!0===i,b=b||{};b.original||(b.original={},n=!0),b.properties=b.properties||{},b.secondary=b.secondary||{};for(var i=b.meta,o=b.original,m=b.properties,q=b.secondary,p=l.length-1;p>=0;p--){var k=l[p]+"transition-property",r=l[p]+"transition-duration",s=l[p]+"transition-timing-function",d=g?l[p]+"transform":d;n&&(o[k]=a.css(k)||"",o[r]=a.css(r)||"",o[s]=a.css(s)||""),q[d]=g?(!0===j||!0===z&&!1!==j)&&D?"translate3d("+i.left+"px, "+i.top+"px, 0)":"translate("+i.left+"px,"+i.top+"px)":e,m[k]=(m[k]?m[k]+",":"")+d,m[r]=(m[r]?m[r]+",":"")+c+"ms",m[s]=(m[s]?m[s]+",":"")+f}return b}function L(a){for(var b in a)if(!("width"!=b&&"height"!=b||"show"!=a[b]&&"hide"!=a[b]&&"toggle"!=a[b]))return!0;return!1}function u(a){for(var b in a)return!1;return!0}function x(a){return v=a.match(/\D+$/),parseFloat(a.replace(/px/i,""))}function M(a,b,h){var c=-1<d.inArray(a,N);return"width"!=a&&"height"!=a||b!==parseFloat(h.css(a))||(c=!1),c}var N="top,right,bottom,left,opacity,height,width".split(","),y=["top","right","bottom","left"],l=["","-webkit-","-moz-","-o-"],O=["avoidTransforms","useTranslate3d","leaveTransforms"],H=/^([+-]=)?([\d+-.]+)(.*)$/,P=/([A-Z])/g,J={secondary:{},meta:{top:0,right:0,bottom:0,left:0}},v="px",q="jQe",E=null,A=!1,t=(document.body||document.documentElement).style,w=void 0!==t.WebkitTransition?"webkitTransitionEnd":void 0!==t.OTransition?"oTransitionEnd":"transitionend",F=void 0!==t.WebkitTransition||void 0!==t.MozTransition||void 0!==t.OTransition||void 0!==t.transition,D="WebKitCSSMatrix"in window&&"m11"in new WebKitCSSMatrix,z=D;d.expr&&d.expr.filters&&(E=d.expr.filters.animated,d.expr.filters.animated=function(a){return d(a).data("events")&&d(a).data("events")[w]?!0:E.call(this,a)}),d.extend({toggle3DByDefault:function(){return z=!z},toggleDisabledByDefault:function(){return A=!A}}),d.fn.translation=function(){if(!this[0])return null;var a=window.getComputedStyle(this[0],null),b={x:0,y:0};if(a)for(var d=l.length-1;d>=0;d--){var c=a.getPropertyValue(l[d]+"transform");if(c&&/matrix/i.test(c)){a=c.replace(/^matrix\(/i,"").split(/, |\)$/g),b={x:parseInt(a[4],10),y:parseInt(a[5],10)};break}}return b},d.fn.animate=function(a,b,h,c){var a=a||{},f=!("undefined"!=typeof a.bottom||"undefined"!=typeof a.right),e=d.speed(b,h,c),g=this,i=0,j=function(){i--,0===i&&"function"==typeof e.complete&&e.complete.apply(g[0],arguments)};return("undefined"!=typeof a.avoidCSSTransitions?a.avoidCSSTransitions:A)===!0||!F||u(a)||L(a)||e.duration<=0||d.fn.animate.defaults.avoidTransforms===!0&&a.avoidTransforms!==!1?B.apply(this,arguments):this[e.queue===!0?"queue":"each"](function(){var k,b=d(this),c=d.extend({},e),g=function(){var c=b.data(q)||{original:{}},d={};if(a.leaveTransforms!==!0){for(var e=l.length-1;e>=0;e--)d[l[e]+"transform"]="";if(f&&"undefined"!=typeof c.meta)for(var g,e=0;g=y[e];++e)d[g]=c.meta[g+"_o"]+v}b.unbind(w).css(c.original).css(d).data(q,null),"hide"===a.opacity&&b.css({display:"none",opacity:""}),j.call(b)},h={bounce:"cubic-bezier(0.0, 0.35, .5, 1.3)",linear:"linear",swing:"ease-in-out",easeInQuad:"cubic-bezier(0.550, 0.085, 0.680, 0.530)",easeInCubic:"cubic-bezier(0.550, 0.055, 0.675, 0.190)",easeInQuart:"cubic-bezier(0.895, 0.030, 0.685, 0.220)",easeInQuint:"cubic-bezier(0.755, 0.050, 0.855, 0.060)",easeInSine:"cubic-bezier(0.470, 0.000, 0.745, 0.715)",easeInExpo:"cubic-bezier(0.950, 0.050, 0.795, 0.035)",easeInCirc:"cubic-bezier(0.600, 0.040, 0.980, 0.335)",easeInBack:"cubic-bezier(0.600, -0.280, 0.735, 0.045)",easeOutQuad:"cubic-bezier(0.250, 0.460, 0.450, 0.940)",easeOutCubic:"cubic-bezier(0.215, 0.610, 0.355, 1.000)",easeOutQuart:"cubic-bezier(0.165, 0.840, 0.440, 1.000)",easeOutQuint:"cubic-bezier(0.230, 1.000, 0.320, 1.000)",easeOutSine:"cubic-bezier(0.390, 0.575, 0.565, 1.000)",easeOutExpo:"cubic-bezier(0.190, 1.000, 0.220, 1.000)",easeOutCirc:"cubic-bezier(0.075, 0.820, 0.165, 1.000)",easeOutBack:"cubic-bezier(0.175, 0.885, 0.320, 1.275)",easeInOutQuad:"cubic-bezier(0.455, 0.030, 0.515, 0.955)",easeInOutCubic:"cubic-bezier(0.645, 0.045, 0.355, 1.000)",easeInOutQuart:"cubic-bezier(0.770, 0.000, 0.175, 1.000)",easeInOutQuint:"cubic-bezier(0.860, 0.000, 0.070, 1.000)",easeInOutSine:"cubic-bezier(0.445, 0.050, 0.550, 0.950)",easeInOutExpo:"cubic-bezier(1.000, 0.000, 0.000, 1.000)",easeInOutCirc:"cubic-bezier(0.785, 0.135, 0.150, 0.860)",easeInOutBack:"cubic-bezier(0.680, -0.550, 0.265, 1.550)"},p={},h=h[c.easing||"swing"]?h[c.easing||"swing"]:c.easing||"swing";for(k in a)if(-1===d.inArray(k,O)){var r=d.inArray(k,y)>-1,s=G(b,a[k],k,r&&a.avoidTransforms!==!0);a.avoidTransforms!==!0&&M(k,s,b)?I(b,k,c.duration,h,r&&a.avoidTransforms===!0?s+v:s,r&&a.avoidTransforms!==!0,f,a.useTranslate3d===!0):p[k]=a[k]}if(b.unbind(w),!(k=b.data(q))||u(k)||u(k.secondary))c.queue=!1;else{i++,b.css(k.properties);var t=k.secondary;setTimeout(function(){b.bind(w,g).css(t)})}return u(p)||(i++,B.apply(b,[p,{duration:c.duration,easing:d.easing[c.easing]?c.easing:d.easing.swing?"swing":"linear",complete:j,queue:c.queue}])),!0})},d.fn.animate.defaults={},d.fn.stop=function(a,b,h){return F?(a&&this.queue([]),this.each(function(){var c=d(this),f=c.data(q);if(f&&!u(f)){var e,g={};if(b){if(g=f.secondary,!h&&void 0!==typeof f.meta.left_o||void 0!==typeof f.meta.top_o)for(g.left=void 0!==typeof f.meta.left_o?f.meta.left_o:"auto",g.top=void 0!==typeof f.meta.top_o?f.meta.top_o:"auto",e=l.length-1;e>=0;e--)g[l[e]+"transform"]=""}else if(!u(f.secondary)){var i=window.getComputedStyle(c[0],null);if(i)for(var j in f.secondary)if(f.secondary.hasOwnProperty(j)&&(j=j.replace(P,"-$1").toLowerCase(),g[j]=i.getPropertyValue(j),!h&&/matrix/i.test(g[j])))for(e=g[j].replace(/^matrix\(/i,"").split(/, |\)$/g),g.left=parseFloat(e[4])+parseFloat(c.css("left"))+v||"auto",g.top=parseFloat(e[5])+parseFloat(c.css("top"))+v||"auto",e=l.length-1;e>=0;e--)g[l[e]+"transform"]=""}c.unbind(w).css(f.original).css(g).data(q,null)}else C.apply(c,[a,b])}),this):C.apply(this,[a,b])}}(jQuery,jQuery.fn.animate,jQuery.fn.stop),/*! VelocityJS.org (1.2.1). (C) 2014 Julian Shapiro. MIT @license: en.wikipedia.org/wiki/MIT_License */
/*! VelocityJS.org jQuery Shim (1.0.1). (C) 2014 The jQuery Foundation. MIT @license: en.wikipedia.org/wiki/MIT_License. */
!function(e){function t(e){var t=e.length,r=$.type(e);return"function"===r||$.isWindow(e)?!1:1===e.nodeType&&t?!0:"array"===r||0===t||"number"==typeof t&&t>0&&t-1 in e}if(!e.jQuery){var $=function(e,t){return new $.fn.init(e,t)};$.isWindow=function(e){return null!=e&&e==e.window},$.type=function(e){return null==e?e+"":"object"==typeof e||"function"==typeof e?a[o.call(e)]||"object":typeof e},$.isArray=Array.isArray||function(e){return"array"===$.type(e)},$.isPlainObject=function(e){var t;if(!e||"object"!==$.type(e)||e.nodeType||$.isWindow(e))return!1;try{if(e.constructor&&!n.call(e,"constructor")&&!n.call(e.constructor.prototype,"isPrototypeOf"))return!1}catch(r){return!1}for(t in e);return void 0===t||n.call(e,t)},$.each=function(e,r,a){var n,o=0,i=e.length,s=t(e);if(a){if(s)for(;i>o&&(n=r.apply(e[o],a),n!==!1);o++);else for(o in e)if(n=r.apply(e[o],a),n===!1)break}else if(s)for(;i>o&&(n=r.call(e[o],o,e[o]),n!==!1);o++);else for(o in e)if(n=r.call(e[o],o,e[o]),n===!1)break;return e},$.data=function(e,t,a){if(void 0===a){var n=e[$.expando],o=n&&r[n];if(void 0===t)return o;if(o&&t in o)return o[t]}else if(void 0!==t){var n=e[$.expando]||(e[$.expando]=++$.uuid);return r[n]=r[n]||{},r[n][t]=a,a}},$.removeData=function(e,t){var a=e[$.expando],n=a&&r[a];n&&$.each(t,function(e,t){delete n[t]})},$.extend=function(){var e,t,r,a,n,o,i=arguments[0]||{},s=1,l=arguments.length,u=!1;for("boolean"==typeof i&&(u=i,i=arguments[s]||{},s++),"object"!=typeof i&&"function"!==$.type(i)&&(i={}),s===l&&(i=this,s--);l>s;s++)if(null!=(n=arguments[s]))for(a in n)e=i[a],r=n[a],i!==r&&(u&&r&&($.isPlainObject(r)||(t=$.isArray(r)))?(t?(t=!1,o=e&&$.isArray(e)?e:[]):o=e&&$.isPlainObject(e)?e:{},i[a]=$.extend(u,o,r)):void 0!==r&&(i[a]=r));return i},$.queue=function(e,r,a){function n(e,r){var a=r||[];return null!=e&&(t(Object(e))?!function(e,t){for(var r=+t.length,a=0,n=e.length;r>a;)e[n++]=t[a++];if(r!==r)for(;void 0!==t[a];)e[n++]=t[a++];return e.length=n,e}(a,"string"==typeof e?[e]:e):[].push.call(a,e)),a}if(e){r=(r||"fx")+"queue";var o=$.data(e,r);return a?(!o||$.isArray(a)?o=$.data(e,r,n(a)):o.push(a),o):o||[]}},$.dequeue=function(e,t){$.each(e.nodeType?[e]:e,function(e,r){t=t||"fx";var a=$.queue(r,t),n=a.shift();"inprogress"===n&&(n=a.shift()),n&&("fx"===t&&a.unshift("inprogress"),n.call(r,function(){$.dequeue(r,t)}))})},$.fn=$.prototype={init:function(e){if(e.nodeType)return this[0]=e,this;throw new Error("Not a DOM node.")},offset:function(){var t=this[0].getBoundingClientRect?this[0].getBoundingClientRect():{top:0,left:0};return{top:t.top+(e.pageYOffset||document.scrollTop||0)-(document.clientTop||0),left:t.left+(e.pageXOffset||document.scrollLeft||0)-(document.clientLeft||0)}},position:function(){function e(){for(var e=this.offsetParent||document;e&&"html"===!e.nodeType.toLowerCase&&"static"===e.style.position;)e=e.offsetParent;return e||document}var t=this[0],e=e.apply(t),r=this.offset(),a=/^(?:body|html)$/i.test(e.nodeName)?{top:0,left:0}:$(e).offset();return r.top-=parseFloat(t.style.marginTop)||0,r.left-=parseFloat(t.style.marginLeft)||0,e.style&&(a.top+=parseFloat(e.style.borderTopWidth)||0,a.left+=parseFloat(e.style.borderLeftWidth)||0),{top:r.top-a.top,left:r.left-a.left}}};var r={};$.expando="velocity"+(new Date).getTime(),$.uuid=0;for(var a={},n=a.hasOwnProperty,o=a.toString,i="Boolean Number String Function Array Date RegExp Object Error".split(" "),s=0;s<i.length;s++)a["[object "+i[s]+"]"]=i[s].toLowerCase();$.fn.init.prototype=$.fn,e.Velocity={Utilities:$}}}(window),function(e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define(e):e()}(function(){return function(e,t,r,a){function n(e){for(var t=-1,r=e?e.length:0,a=[];++t<r;){var n=e[t];n&&a.push(n)}return a}function o(e){return g.isWrapped(e)?e=[].slice.call(e):g.isNode(e)&&(e=[e]),e}function i(e){var t=$.data(e,"velocity");return null===t?a:t}function s(e){return function(t){return Math.round(t*e)*(1/e)}}function l(e,r,a,n){function o(e,t){return 1-3*t+3*e}function i(e,t){return 3*t-6*e}function s(e){return 3*e}function l(e,t,r){return((o(t,r)*e+i(t,r))*e+s(t))*e}function u(e,t,r){return 3*o(t,r)*e*e+2*i(t,r)*e+s(t)}function c(t,r){for(var n=0;m>n;++n){var o=u(r,e,a);if(0===o)return r;var i=l(r,e,a)-t;r-=i/o}return r}function p(){for(var t=0;b>t;++t)w[t]=l(t*x,e,a)}function f(t,r,n){var o,i,s=0;do i=r+(n-r)/2,o=l(i,e,a)-t,o>0?n=i:r=i;while(Math.abs(o)>h&&++s<v);return i}function d(t){for(var r=0,n=1,o=b-1;n!=o&&w[n]<=t;++n)r+=x;--n;var i=(t-w[n])/(w[n+1]-w[n]),s=r+i*x,l=u(s,e,a);return l>=y?c(t,s):0==l?s:f(t,r,r+x)}function g(){V=!0,(e!=r||a!=n)&&p()}var m=4,y=.001,h=1e-7,v=10,b=11,x=1/(b-1),S="Float32Array"in t;if(4!==arguments.length)return!1;for(var P=0;4>P;++P)if("number"!=typeof arguments[P]||isNaN(arguments[P])||!isFinite(arguments[P]))return!1;e=Math.min(e,1),a=Math.min(a,1),e=Math.max(e,0),a=Math.max(a,0);var w=S?new Float32Array(b):new Array(b),V=!1,C=function(t){return V||g(),e===r&&a===n?t:0===t?0:1===t?1:l(d(t),r,n)};C.getControlPoints=function(){return[{x:e,y:r},{x:a,y:n}]};var T="generateBezier("+[e,r,a,n]+")";return C.toString=function(){return T},C}function u(e,t){var r=e;return g.isString(e)?v.Easings[e]||(r=!1):r=g.isArray(e)&&1===e.length?s.apply(null,e):g.isArray(e)&&2===e.length?b.apply(null,e.concat([t])):g.isArray(e)&&4===e.length?l.apply(null,e):!1,r===!1&&(r=v.Easings[v.defaults.easing]?v.defaults.easing:h),r}function c(e){if(e){var t=(new Date).getTime(),r=v.State.calls.length;r>1e4&&(v.State.calls=n(v.State.calls));for(var o=0;r>o;o++)if(v.State.calls[o]){var s=v.State.calls[o],l=s[0],u=s[2],f=s[3],d=!!f,m=null;f||(f=v.State.calls[o][3]=t-16);for(var y=Math.min((t-f)/u.duration,1),h=0,b=l.length;b>h;h++){var S=l[h],w=S.element;if(i(w)){var V=!1;if(u.display!==a&&null!==u.display&&"none"!==u.display){if("flex"===u.display){var C=["-webkit-box","-moz-box","-ms-flexbox","-webkit-flex"];$.each(C,function(e,t){x.setPropertyValue(w,"display",t)})}x.setPropertyValue(w,"display",u.display)}u.visibility!==a&&"hidden"!==u.visibility&&x.setPropertyValue(w,"visibility",u.visibility);for(var T in S)if("element"!==T){var A,k=S[T],F=g.isString(k.easing)?v.Easings[k.easing]:k.easing;if(1===y)A=k.endValue;else{var E=k.endValue-k.startValue;if(A=k.startValue+E*F(y,u,E),!d&&A===k.currentValue)continue}if(k.currentValue=A,"tween"===T)m=A;else{if(x.Hooks.registered[T]){var j=x.Hooks.getRoot(T),H=i(w).rootPropertyValueCache[j];H&&(k.rootPropertyValue=H)}var N=x.setPropertyValue(w,T,k.currentValue+(0===parseFloat(A)?"":k.unitType),k.rootPropertyValue,k.scrollData);x.Hooks.registered[T]&&(i(w).rootPropertyValueCache[j]=x.Normalizations.registered[j]?x.Normalizations.registered[j]("extract",null,N[1]):N[1]),"transform"===N[0]&&(V=!0)}}u.mobileHA&&i(w).transformCache.translate3d===a&&(i(w).transformCache.translate3d="(0px, 0px, 0px)",V=!0),V&&x.flushTransformCache(w)}}u.display!==a&&"none"!==u.display&&(v.State.calls[o][2].display=!1),u.visibility!==a&&"hidden"!==u.visibility&&(v.State.calls[o][2].visibility=!1),u.progress&&u.progress.call(s[1],s[1],y,Math.max(0,f+u.duration-t),f,m),1===y&&p(o)}}v.State.isTicking&&P(c)}function p(e,t){if(!v.State.calls[e])return!1;for(var r=v.State.calls[e][0],n=v.State.calls[e][1],o=v.State.calls[e][2],s=v.State.calls[e][4],l=!1,u=0,c=r.length;c>u;u++){var p=r[u].element;if(t||o.loop||("none"===o.display&&x.setPropertyValue(p,"display",o.display),"hidden"===o.visibility&&x.setPropertyValue(p,"visibility",o.visibility)),o.loop!==!0&&($.queue(p)[1]===a||!/\.velocityQueueEntryFlag/i.test($.queue(p)[1]))&&i(p)){i(p).isAnimating=!1,i(p).rootPropertyValueCache={};var f=!1;$.each(x.Lists.transforms3D,function(e,t){var r=/^scale/.test(t)?1:0,n=i(p).transformCache[t];i(p).transformCache[t]!==a&&new RegExp("^\\("+r+"[^.]").test(n)&&(f=!0,delete i(p).transformCache[t])}),o.mobileHA&&(f=!0,delete i(p).transformCache.translate3d),f&&x.flushTransformCache(p),x.Values.removeClass(p,"velocity-animating")}if(!t&&o.complete&&!o.loop&&u===c-1)try{o.complete.call(n,n)}catch(d){setTimeout(function(){throw d},1)}s&&o.loop!==!0&&s(n),o.loop!==!0||t||($.each(i(p).tweensContainer,function(e,t){/^rotate/.test(e)&&360===parseFloat(t.endValue)&&(t.endValue=0,t.startValue=360),/^backgroundPosition/.test(e)&&100===parseFloat(t.endValue)&&"%"===t.unitType&&(t.endValue=0,t.startValue=100)}),v(p,"reverse",{loop:!0,delay:o.delay})),o.queue!==!1&&$.dequeue(p,o.queue)}v.State.calls[e]=!1;for(var g=0,m=v.State.calls.length;m>g;g++)if(v.State.calls[g]!==!1){l=!0;break}l===!1&&(v.State.isTicking=!1,delete v.State.calls,v.State.calls=[])}var $,f=function(){if(r.documentMode)return r.documentMode;for(var e=7;e>4;e--){var t=r.createElement("div");if(t.innerHTML="<!--[if IE "+e+"]><span></span><![endif]-->",t.getElementsByTagName("span").length)return t=null,e}return a}(),d=function(){var e=0;return t.webkitRequestAnimationFrame||t.mozRequestAnimationFrame||function(t){var a,r=(new Date).getTime();return a=Math.max(0,16-(r-e)),e=r+a,setTimeout(function(){t(r+a)},a)}}(),g={isString:function(e){return"string"==typeof e},isArray:Array.isArray||function(e){return"[object Array]"===Object.prototype.toString.call(e)},isFunction:function(e){return"[object Function]"===Object.prototype.toString.call(e)},isNode:function(e){return e&&e.nodeType},isNodeList:function(e){return"object"==typeof e&&/^\[object (HTMLCollection|NodeList|Object)\]$/.test(Object.prototype.toString.call(e))&&e.length!==a&&(0===e.length||"object"==typeof e[0]&&e[0].nodeType>0)},isWrapped:function(e){return e&&(e.jquery||t.Zepto&&t.Zepto.zepto.isZ(e))},isSVG:function(e){return t.SVGElement&&e instanceof t.SVGElement},isEmptyObject:function(e){for(var t in e)return!1;return!0}},m=!1;if(e.fn&&e.fn.jquery?($=e,m=!0):$=t.Velocity.Utilities,8>=f&&!m)throw new Error("Velocity: IE8 and below require jQuery to be loaded before Velocity.");if(7>=f)return void(jQuery.fn.velocity=jQuery.fn.animate);var y=400,h="swing",v={State:{isMobile:/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent),isAndroid:/Android/i.test(navigator.userAgent),isGingerbread:/Android 2\.3\.[3-7]/i.test(navigator.userAgent),isChrome:t.chrome,isFirefox:/Firefox/i.test(navigator.userAgent),prefixElement:r.createElement("div"),prefixMatches:{},scrollAnchor:null,scrollPropertyLeft:null,scrollPropertyTop:null,isTicking:!1,calls:[]},CSS:{},Utilities:$,Redirects:{},Easings:{},Promise:t.Promise,defaults:{queue:"",duration:y,easing:h,begin:a,complete:a,progress:a,display:a,visibility:a,loop:!1,delay:!1,mobileHA:!0,_cacheValues:!0},init:function(e){$.data(e,"velocity",{isSVG:g.isSVG(e),isAnimating:!1,computedStyle:null,tweensContainer:null,rootPropertyValueCache:{},transformCache:{}})},hook:null,mock:!1,version:{major:1,minor:2,patch:1},debug:!1};t.pageYOffset!==a?(v.State.scrollAnchor=t,v.State.scrollPropertyLeft="pageXOffset",v.State.scrollPropertyTop="pageYOffset"):(v.State.scrollAnchor=r.documentElement||r.body.parentNode||r.body,v.State.scrollPropertyLeft="scrollLeft",v.State.scrollPropertyTop="scrollTop");var b=function(){function e(e){return-e.tension*e.x-e.friction*e.v}function t(t,r,a){var n={x:t.x+a.dx*r,v:t.v+a.dv*r,tension:t.tension,friction:t.friction};return{dx:n.v,dv:e(n)}}function r(r,a){var n={dx:r.v,dv:e(r)},o=t(r,.5*a,n),i=t(r,.5*a,o),s=t(r,a,i),l=1/6*(n.dx+2*(o.dx+i.dx)+s.dx),u=1/6*(n.dv+2*(o.dv+i.dv)+s.dv);return r.x=r.x+l*a,r.v=r.v+u*a,r}return function a(e,t,n){var c,p,f,o={x:-1,v:0,tension:null,friction:null},i=[0],s=0,l=1e-4,u=.016;for(e=parseFloat(e)||500,t=parseFloat(t)||20,n=n||null,o.tension=e,o.friction=t,c=null!==n,c?(s=a(e,t),p=s/n*u):p=u;f=r(f||o,p),i.push(1+f.x),s+=16,Math.abs(f.x)>l&&Math.abs(f.v)>l;);return c?function(e){return i[e*(i.length-1)|0]}:s}}();v.Easings={linear:function(e){return e},swing:function(e){return.5-Math.cos(e*Math.PI)/2},spring:function(e){return 1-Math.cos(4.5*e*Math.PI)*Math.exp(6*-e)}},$.each([["ease",[.25,.1,.25,1]],["ease-in",[.42,0,1,1]],["ease-out",[0,0,.58,1]],["ease-in-out",[.42,0,.58,1]],["easeInSine",[.47,0,.745,.715]],["easeOutSine",[.39,.575,.565,1]],["easeInOutSine",[.445,.05,.55,.95]],["easeInQuad",[.55,.085,.68,.53]],["easeOutQuad",[.25,.46,.45,.94]],["easeInOutQuad",[.455,.03,.515,.955]],["easeInCubic",[.55,.055,.675,.19]],["easeOutCubic",[.215,.61,.355,1]],["easeInOutCubic",[.645,.045,.355,1]],["easeInQuart",[.895,.03,.685,.22]],["easeOutQuart",[.165,.84,.44,1]],["easeInOutQuart",[.77,0,.175,1]],["easeInQuint",[.755,.05,.855,.06]],["easeOutQuint",[.23,1,.32,1]],["easeInOutQuint",[.86,0,.07,1]],["easeInExpo",[.95,.05,.795,.035]],["easeOutExpo",[.19,1,.22,1]],["easeInOutExpo",[1,0,0,1]],["easeInCirc",[.6,.04,.98,.335]],["easeOutCirc",[.075,.82,.165,1]],["easeInOutCirc",[.785,.135,.15,.86]]],function(e,t){v.Easings[t[0]]=l.apply(null,t[1])});var x=v.CSS={RegEx:{isHex:/^#([A-f\d]{3}){1,2}$/i,valueUnwrap:/^[A-z]+\((.*)\)$/i,wrappedValueAlreadyExtracted:/[0-9.]+ [0-9.]+ [0-9.]+( [0-9.]+)?/,valueSplit:/([A-z]+\(.+\))|(([A-z0-9#-.]+?)(?=\s|$))/gi},Lists:{colors:["fill","stroke","stopColor","color","backgroundColor","borderColor","borderTopColor","borderRightColor","borderBottomColor","borderLeftColor","outlineColor"],transformsBase:["translateX","translateY","scale","scaleX","scaleY","skewX","skewY","rotateZ"],transforms3D:["transformPerspective","translateZ","scaleZ","rotateX","rotateY"]},Hooks:{templates:{textShadow:["Color X Y Blur","black 0px 0px 0px"],boxShadow:["Color X Y Blur Spread","black 0px 0px 0px 0px"],clip:["Top Right Bottom Left","0px 0px 0px 0px"],backgroundPosition:["X Y","0% 0%"],transformOrigin:["X Y Z","50% 50% 0px"],perspectiveOrigin:["X Y","50% 50%"]},registered:{},register:function(){for(var e=0;e<x.Lists.colors.length;e++){var t="color"===x.Lists.colors[e]?"0 0 0 1":"255 255 255 1";x.Hooks.templates[x.Lists.colors[e]]=["Red Green Blue Alpha",t]}var r,a,n;if(f)for(r in x.Hooks.templates){a=x.Hooks.templates[r],n=a[0].split(" ");var o=a[1].match(x.RegEx.valueSplit);"Color"===n[0]&&(n.push(n.shift()),o.push(o.shift()),x.Hooks.templates[r]=[n.join(" "),o.join(" ")])}for(r in x.Hooks.templates){a=x.Hooks.templates[r],n=a[0].split(" ");for(var e in n){var i=r+n[e],s=e;x.Hooks.registered[i]=[r,s]}}},getRoot:function(e){var t=x.Hooks.registered[e];return t?t[0]:e},cleanRootPropertyValue:function(e,t){return x.RegEx.valueUnwrap.test(t)&&(t=t.match(x.RegEx.valueUnwrap)[1]),x.Values.isCSSNullValue(t)&&(t=x.Hooks.templates[e][1]),t},extractValue:function(e,t){var r=x.Hooks.registered[e];if(r){var a=r[0],n=r[1];return t=x.Hooks.cleanRootPropertyValue(a,t),t.toString().match(x.RegEx.valueSplit)[n]}return t},injectValue:function(e,t,r){var a=x.Hooks.registered[e];if(a){var i,s,n=a[0],o=a[1];return r=x.Hooks.cleanRootPropertyValue(n,r),i=r.toString().match(x.RegEx.valueSplit),i[o]=t,s=i.join(" ")}return r}},Normalizations:{registered:{clip:function(e,t,r){switch(e){case"name":return"clip";case"extract":var a;return x.RegEx.wrappedValueAlreadyExtracted.test(r)?a=r:(a=r.toString().match(x.RegEx.valueUnwrap),a=a?a[1].replace(/,(\s+)?/g," "):r),a;case"inject":return"rect("+r+")"}},blur:function(e,t,r){switch(e){case"name":return v.State.isFirefox?"filter":"-webkit-filter";case"extract":var a=parseFloat(r);if(!a&&0!==a){var n=r.toString().match(/blur\(([0-9]+[A-z]+)\)/i);a=n?n[1]:0}return a;case"inject":return parseFloat(r)?"blur("+r+")":"none"}},opacity:function(e,t,r){if(8>=f)switch(e){case"name":return"filter";case"extract":var a=r.toString().match(/alpha\(opacity=(.*)\)/i);return r=a?a[1]/100:1;case"inject":return t.style.zoom=1,parseFloat(r)>=1?"":"alpha(opacity="+parseInt(100*parseFloat(r),10)+")"}else switch(e){case"name":return"opacity";case"extract":return r;case"inject":return r}}},register:function(){9>=f||v.State.isGingerbread||(x.Lists.transformsBase=x.Lists.transformsBase.concat(x.Lists.transforms3D));for(var e=0;e<x.Lists.transformsBase.length;e++)!function(){var t=x.Lists.transformsBase[e];x.Normalizations.registered[t]=function(e,r,n){switch(e){case"name":return"transform";case"extract":return i(r)===a||i(r).transformCache[t]===a?/^scale/i.test(t)?1:0:i(r).transformCache[t].replace(/[()]/g,"");case"inject":var o=!1;switch(t.substr(0,t.length-1)){case"translate":o=!/(%|px|em|rem|vw|vh|\d)$/i.test(n);break;case"scal":case"scale":v.State.isAndroid&&i(r).transformCache[t]===a&&1>n&&(n=1),o=!/(\d)$/i.test(n);break;case"skew":o=!/(deg|\d)$/i.test(n);break;case"rotate":o=!/(deg|\d)$/i.test(n)}return o||(i(r).transformCache[t]="("+n+")"),i(r).transformCache[t]}}}();for(var e=0;e<x.Lists.colors.length;e++)!function(){var t=x.Lists.colors[e];x.Normalizations.registered[t]=function(e,r,n){switch(e){case"name":return t;case"extract":var o;if(x.RegEx.wrappedValueAlreadyExtracted.test(n))o=n;else{var i,s={black:"rgb(0, 0, 0)",blue:"rgb(0, 0, 255)",gray:"rgb(128, 128, 128)",green:"rgb(0, 128, 0)",red:"rgb(255, 0, 0)",white:"rgb(255, 255, 255)"};/^[A-z]+$/i.test(n)?i=s[n]!==a?s[n]:s.black:x.RegEx.isHex.test(n)?i="rgb("+x.Values.hexToRgb(n).join(" ")+")":/^rgba?\(/i.test(n)||(i=s.black),o=(i||n).toString().match(x.RegEx.valueUnwrap)[1].replace(/,(\s+)?/g," ")}return 8>=f||3!==o.split(" ").length||(o+=" 1"),o;case"inject":return 8>=f?4===n.split(" ").length&&(n=n.split(/\s+/).slice(0,3).join(" ")):3===n.split(" ").length&&(n+=" 1"),(8>=f?"rgb":"rgba")+"("+n.replace(/\s+/g,",").replace(/\.(\d)+(?=,)/g,"")+")"}}}()}},Names:{camelCase:function(e){return e.replace(/-(\w)/g,function(e,t){return t.toUpperCase()})},SVGAttribute:function(e){var t="width|height|x|y|cx|cy|r|rx|ry|x1|x2|y1|y2";return(f||v.State.isAndroid&&!v.State.isChrome)&&(t+="|transform"),new RegExp("^("+t+")$","i").test(e)},prefixCheck:function(e){if(v.State.prefixMatches[e])return[v.State.prefixMatches[e],!0];for(var t=["","Webkit","Moz","ms","O"],r=0,a=t.length;a>r;r++){var n;if(n=0===r?e:t[r]+e.replace(/^\w/,function(e){return e.toUpperCase()}),g.isString(v.State.prefixElement.style[n]))return v.State.prefixMatches[e]=n,[n,!0]}return[e,!1]}},Values:{hexToRgb:function(e){var a,t=/^#?([a-f\d])([a-f\d])([a-f\d])$/i,r=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i;return e=e.replace(t,function(e,t,r,a){return t+t+r+r+a+a}),a=r.exec(e),a?[parseInt(a[1],16),parseInt(a[2],16),parseInt(a[3],16)]:[0,0,0]},isCSSNullValue:function(e){return 0==e||/^(none|auto|transparent|(rgba\(0, ?0, ?0, ?0\)))$/i.test(e)},getUnitType:function(e){return/^(rotate|skew)/i.test(e)?"deg":/(^(scale|scaleX|scaleY|scaleZ|alpha|flexGrow|flexHeight|zIndex|fontWeight)$)|((opacity|red|green|blue|alpha)$)/i.test(e)?"":"px"},getDisplayType:function(e){var t=e&&e.tagName.toString().toLowerCase();return/^(b|big|i|small|tt|abbr|acronym|cite|code|dfn|em|kbd|strong|samp|var|a|bdo|br|img|map|object|q|script|span|sub|sup|button|input|label|select|textarea)$/i.test(t)?"inline":/^(li)$/i.test(t)?"list-item":/^(tr)$/i.test(t)?"table-row":/^(table)$/i.test(t)?"table":/^(tbody)$/i.test(t)?"table-row-group":"block"},addClass:function(e,t){e.classList?e.classList.add(t):e.className+=(e.className.length?" ":"")+t},removeClass:function(e,t){e.classList?e.classList.remove(t):e.className=e.className.toString().replace(new RegExp("(^|\\s)"+t.split(" ").join("|")+"(\\s|$)","gi")," ")}},getPropertyValue:function(e,r,n,o){function s(e,r){function n(){u&&x.setPropertyValue(e,"display","none")}var l=0;if(8>=f)l=$.css(e,r);else{var u=!1;if(/^(width|height)$/.test(r)&&0===x.getPropertyValue(e,"display")&&(u=!0,x.setPropertyValue(e,"display",x.Values.getDisplayType(e))),!o){if("height"===r&&"border-box"!==x.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var c=e.offsetHeight-(parseFloat(x.getPropertyValue(e,"borderTopWidth"))||0)-(parseFloat(x.getPropertyValue(e,"borderBottomWidth"))||0)-(parseFloat(x.getPropertyValue(e,"paddingTop"))||0)-(parseFloat(x.getPropertyValue(e,"paddingBottom"))||0);return n(),c}if("width"===r&&"border-box"!==x.getPropertyValue(e,"boxSizing").toString().toLowerCase()){var p=e.offsetWidth-(parseFloat(x.getPropertyValue(e,"borderLeftWidth"))||0)-(parseFloat(x.getPropertyValue(e,"borderRightWidth"))||0)-(parseFloat(x.getPropertyValue(e,"paddingLeft"))||0)-(parseFloat(x.getPropertyValue(e,"paddingRight"))||0);return n(),p}}var d;d=i(e)===a?t.getComputedStyle(e,null):i(e).computedStyle?i(e).computedStyle:i(e).computedStyle=t.getComputedStyle(e,null),"borderColor"===r&&(r="borderTopColor"),l=9===f&&"filter"===r?d.getPropertyValue(r):d[r],(""===l||null===l)&&(l=e.style[r]),n()}if("auto"===l&&/^(top|right|bottom|left)$/i.test(r)){var g=s(e,"position");("fixed"===g||"absolute"===g&&/top|left/i.test(r))&&(l=$(e).position()[r]+"px")}return l}var l;if(x.Hooks.registered[r]){var u=r,c=x.Hooks.getRoot(u);n===a&&(n=x.getPropertyValue(e,x.Names.prefixCheck(c)[0])),x.Normalizations.registered[c]&&(n=x.Normalizations.registered[c]("extract",e,n)),l=x.Hooks.extractValue(u,n)}else if(x.Normalizations.registered[r]){var p,d;p=x.Normalizations.registered[r]("name",e),"transform"!==p&&(d=s(e,x.Names.prefixCheck(p)[0]),x.Values.isCSSNullValue(d)&&x.Hooks.templates[r]&&(d=x.Hooks.templates[r][1])),l=x.Normalizations.registered[r]("extract",e,d)}if(!/^[\d-]/.test(l))if(i(e)&&i(e).isSVG&&x.Names.SVGAttribute(r))if(/^(height|width)$/i.test(r))try{l=e.getBBox()[r]}catch(g){l=0}else l=e.getAttribute(r);else l=s(e,x.Names.prefixCheck(r)[0]);return x.Values.isCSSNullValue(l)&&(l=0),v.debug>=2&&console.log("Get "+r+": "+l),l},setPropertyValue:function(e,r,a,n,o){var s=r;if("scroll"===r)o.container?o.container["scroll"+o.direction]=a:"Left"===o.direction?t.scrollTo(a,o.alternateValue):t.scrollTo(o.alternateValue,a);else if(x.Normalizations.registered[r]&&"transform"===x.Normalizations.registered[r]("name",e))x.Normalizations.registered[r]("inject",e,a),s="transform",a=i(e).transformCache[r];else{if(x.Hooks.registered[r]){var l=r,u=x.Hooks.getRoot(r);n=n||x.getPropertyValue(e,u),a=x.Hooks.injectValue(l,a,n),r=u}if(x.Normalizations.registered[r]&&(a=x.Normalizations.registered[r]("inject",e,a),r=x.Normalizations.registered[r]("name",e)),s=x.Names.prefixCheck(r)[0],8>=f)try{e.style[s]=a}catch(c){v.debug&&console.log("Browser does not support ["+a+"] for ["+s+"]")}else i(e)&&i(e).isSVG&&x.Names.SVGAttribute(r)?e.setAttribute(r,a):e.style[s]=a;v.debug>=2&&console.log("Set "+r+" ("+s+"): "+a)}return[s,a]},flushTransformCache:function(e){function t(t){return parseFloat(x.getPropertyValue(e,t))}var r="";if((f||v.State.isAndroid&&!v.State.isChrome)&&i(e).isSVG){var a={translate:[t("translateX"),t("translateY")],skewX:[t("skewX")],skewY:[t("skewY")],scale:1!==t("scale")?[t("scale"),t("scale")]:[t("scaleX"),t("scaleY")],rotate:[t("rotateZ"),0,0]};$.each(i(e).transformCache,function(e){/^translate/i.test(e)?e="translate":/^scale/i.test(e)?e="scale":/^rotate/i.test(e)&&(e="rotate"),a[e]&&(r+=e+"("+a[e].join(" ")+") ",delete a[e])})}else{var n,o;$.each(i(e).transformCache,function(t){return n=i(e).transformCache[t],"transformPerspective"===t?(o=n,!0):(9===f&&"rotateZ"===t&&(t="rotate"),void(r+=t+n+" "))}),o&&(r="perspective"+o+" "+r)}x.setPropertyValue(e,"transform",r)}};x.Hooks.register(),x.Normalizations.register(),v.hook=function(e,t,r){var n=a;return e=o(e),$.each(e,function(e,o){if(i(o)===a&&v.init(o),r===a)n===a&&(n=v.CSS.getPropertyValue(o,t));else{var s=v.CSS.setPropertyValue(o,t,r);"transform"===s[0]&&v.CSS.flushTransformCache(o),n=s}}),n};var S=function(){function e(){return l?T.promise||null:f}function n(){function e(e){function p(e,t){var r=a,i=a,s=a;return g.isArray(e)?(r=e[0],!g.isArray(e[1])&&/^[\d-]/.test(e[1])||g.isFunction(e[1])||x.RegEx.isHex.test(e[1])?s=e[1]:(g.isString(e[1])&&!x.RegEx.isHex.test(e[1])||g.isArray(e[1]))&&(i=t?e[1]:u(e[1],o.duration),e[2]!==a&&(s=e[2]))):r=e,t||(i=i||o.easing),g.isFunction(r)&&(r=r.call(n,w,P)),g.isFunction(s)&&(s=s.call(n,w,P)),[r||0,i,s]}function f(e,t){var r,a;return a=(t||"0").toString().toLowerCase().replace(/[%A-z]+$/,function(e){return r=e,""}),r||(r=x.Values.getUnitType(e)),[a,r]}function d(){var e={myParent:n.parentNode||r.body,position:x.getPropertyValue(n,"position"),fontSize:x.getPropertyValue(n,"fontSize")},a=e.position===N.lastPosition&&e.myParent===N.lastParent,o=e.fontSize===N.lastFontSize;N.lastParent=e.myParent,N.lastPosition=e.position,N.lastFontSize=e.fontSize;var s=100,l={};if(o&&a)l.emToPx=N.lastEmToPx,l.percentToPxWidth=N.lastPercentToPxWidth,l.percentToPxHeight=N.lastPercentToPxHeight;else{var u=i(n).isSVG?r.createElementNS("http://www.w3.org/2000/svg","rect"):r.createElement("div");v.init(u),e.myParent.appendChild(u),$.each(["overflow","overflowX","overflowY"],function(e,t){v.CSS.setPropertyValue(u,t,"hidden")}),v.CSS.setPropertyValue(u,"position",e.position),v.CSS.setPropertyValue(u,"fontSize",e.fontSize),v.CSS.setPropertyValue(u,"boxSizing","content-box"),$.each(["minWidth","maxWidth","width","minHeight","maxHeight","height"],function(e,t){v.CSS.setPropertyValue(u,t,s+"%")}),v.CSS.setPropertyValue(u,"paddingLeft",s+"em"),l.percentToPxWidth=N.lastPercentToPxWidth=(parseFloat(x.getPropertyValue(u,"width",null,!0))||1)/s,l.percentToPxHeight=N.lastPercentToPxHeight=(parseFloat(x.getPropertyValue(u,"height",null,!0))||1)/s,l.emToPx=N.lastEmToPx=(parseFloat(x.getPropertyValue(u,"paddingLeft"))||1)/s,e.myParent.removeChild(u)}return null===N.remToPx&&(N.remToPx=parseFloat(x.getPropertyValue(r.body,"fontSize"))||16),null===N.vwToPx&&(N.vwToPx=parseFloat(t.innerWidth)/100,N.vhToPx=parseFloat(t.innerHeight)/100),l.remToPx=N.remToPx,l.vwToPx=N.vwToPx,l.vhToPx=N.vhToPx,v.debug>=1&&console.log("Unit ratios: "+JSON.stringify(l),n),l}if(o.begin&&0===w)try{o.begin.call(m,m)}catch(y){setTimeout(function(){throw y},1)}if("scroll"===k){var C,A,F,S=/^x$/i.test(o.axis)?"Left":"Top",V=parseFloat(o.offset)||0;o.container?g.isWrapped(o.container)||g.isNode(o.container)?(o.container=o.container[0]||o.container,C=o.container["scroll"+S],F=C+$(n).position()[S.toLowerCase()]+V):o.container=null:(C=v.State.scrollAnchor[v.State["scrollProperty"+S]],A=v.State.scrollAnchor[v.State["scrollProperty"+("Left"===S?"Top":"Left")]],F=$(n).offset()[S.toLowerCase()]+V),s={scroll:{rootPropertyValue:!1,startValue:C,currentValue:C,endValue:F,unitType:"",easing:o.easing,scrollData:{container:o.container,direction:S,alternateValue:A}},element:n},v.debug&&console.log("tweensContainer (scroll): ",s.scroll,n)}else if("reverse"===k){if(!i(n).tweensContainer)return void $.dequeue(n,o.queue);"none"===i(n).opts.display&&(i(n).opts.display="auto"),"hidden"===i(n).opts.visibility&&(i(n).opts.visibility="visible"),i(n).opts.loop=!1,i(n).opts.begin=null,i(n).opts.complete=null,b.easing||delete o.easing,b.duration||delete o.duration,o=$.extend({},i(n).opts,o);var E=$.extend(!0,{},i(n).tweensContainer);for(var j in E)if("element"!==j){var H=E[j].startValue;E[j].startValue=E[j].currentValue=E[j].endValue,E[j].endValue=H,g.isEmptyObject(b)||(E[j].easing=o.easing),v.debug&&console.log("reverse tweensContainer ("+j+"): "+JSON.stringify(E[j]),n)}s=E}else if("start"===k){var E;i(n).tweensContainer&&i(n).isAnimating===!0&&(E=i(n).tweensContainer),$.each(h,function(e,t){if(RegExp("^"+x.Lists.colors.join("$|^")+"$").test(e)){var r=p(t,!0),n=r[0],o=r[1],i=r[2];if(x.RegEx.isHex.test(n)){for(var s=["Red","Green","Blue"],l=x.Values.hexToRgb(n),u=i?x.Values.hexToRgb(i):a,c=0;c<s.length;c++){var f=[l[c]];o&&f.push(o),u!==a&&f.push(u[c]),h[e+s[c]]=f}delete h[e]}}});for(var R in h){var O=p(h[R]),z=O[0],q=O[1],M=O[2];R=x.Names.camelCase(R);var I=x.Hooks.getRoot(R),B=!1;if(i(n).isSVG||"tween"===I||x.Names.prefixCheck(I)[1]!==!1||x.Normalizations.registered[I]!==a){(o.display!==a&&null!==o.display&&"none"!==o.display||o.visibility!==a&&"hidden"!==o.visibility)&&/opacity|filter/.test(R)&&!M&&0!==z&&(M=0),o._cacheValues&&E&&E[R]?(M===a&&(M=E[R].endValue+E[R].unitType),B=i(n).rootPropertyValueCache[I]):x.Hooks.registered[R]?M===a?(B=x.getPropertyValue(n,I),M=x.getPropertyValue(n,R,B)):B=x.Hooks.templates[I][1]:M===a&&(M=x.getPropertyValue(n,R));var W,G,D,X=!1;if(W=f(R,M),M=W[0],D=W[1],W=f(R,z),z=W[0].replace(/^([+-\/*])=/,function(e,t){return X=t,""}),G=W[1],M=parseFloat(M)||0,z=parseFloat(z)||0,"%"===G&&(/^(fontSize|lineHeight)$/.test(R)?(z/=100,G="em"):/^scale/.test(R)?(z/=100,G=""):/(Red|Green|Blue)$/i.test(R)&&(z=z/100*255,G="")),/[\/*]/.test(X))G=D;else if(D!==G&&0!==M)if(0===z)G=D;else{l=l||d();var Y=/margin|padding|left|right|width|text|word|letter/i.test(R)||/X$/.test(R)||"x"===R?"x":"y";switch(D){case"%":M*="x"===Y?l.percentToPxWidth:l.percentToPxHeight;break;case"px":break;default:M*=l[D+"ToPx"]}switch(G){case"%":M*=1/("x"===Y?l.percentToPxWidth:l.percentToPxHeight);break;case"px":break;default:M*=1/l[G+"ToPx"]}}switch(X){case"+":z=M+z;break;case"-":z=M-z;break;case"*":z=M*z;break;case"/":z=M/z}s[R]={rootPropertyValue:B,startValue:M,currentValue:M,endValue:z,unitType:G,easing:q},v.debug&&console.log("tweensContainer ("+R+"): "+JSON.stringify(s[R]),n)}else v.debug&&console.log("Skipping ["+I+"] due to a lack of browser support.")}s.element=n}s.element&&(x.Values.addClass(n,"velocity-animating"),L.push(s),""===o.queue&&(i(n).tweensContainer=s,i(n).opts=o),i(n).isAnimating=!0,w===P-1?(v.State.calls.push([L,m,o,null,T.resolver]),v.State.isTicking===!1&&(v.State.isTicking=!0,c())):w++)}var l,n=this,o=$.extend({},v.defaults,b),s={};switch(i(n)===a&&v.init(n),parseFloat(o.delay)&&o.queue!==!1&&$.queue(n,o.queue,function(e){v.velocityQueueEntryFlag=!0,i(n).delayTimer={setTimeout:setTimeout(e,parseFloat(o.delay)),next:e}}),o.duration.toString().toLowerCase()){case"fast":o.duration=200;break;case"normal":o.duration=y;break;case"slow":o.duration=600;break;default:o.duration=parseFloat(o.duration)||1}v.mock!==!1&&(v.mock===!0?o.duration=o.delay=1:(o.duration*=parseFloat(v.mock)||1,o.delay*=parseFloat(v.mock)||1)),o.easing=u(o.easing,o.duration),o.begin&&!g.isFunction(o.begin)&&(o.begin=null),o.progress&&!g.isFunction(o.progress)&&(o.progress=null),o.complete&&!g.isFunction(o.complete)&&(o.complete=null),o.display!==a&&null!==o.display&&(o.display=o.display.toString().toLowerCase(),"auto"===o.display&&(o.display=v.CSS.Values.getDisplayType(n))),o.visibility!==a&&null!==o.visibility&&(o.visibility=o.visibility.toString().toLowerCase()),o.mobileHA=o.mobileHA&&v.State.isMobile&&!v.State.isGingerbread,o.queue===!1?o.delay?setTimeout(e,o.delay):e():$.queue(n,o.queue,function(t,r){return r===!0?(T.promise&&T.resolver(m),!0):(v.velocityQueueEntryFlag=!0,void e(t))}),""!==o.queue&&"fx"!==o.queue||"inprogress"===$.queue(n)[0]||$.dequeue(n)}var l,f,d,m,h,b,s=arguments[0]&&(arguments[0].p||$.isPlainObject(arguments[0].properties)&&!arguments[0].properties.names||g.isString(arguments[0].properties));if(g.isWrapped(this)?(l=!1,d=0,m=this,f=this):(l=!0,d=1,m=s?arguments[0].elements||arguments[0].e:arguments[0]),m=o(m)){s?(h=arguments[0].properties||arguments[0].p,b=arguments[0].options||arguments[0].o):(h=arguments[d],b=arguments[d+1]);var P=m.length,w=0;if(!/^(stop|finish)$/i.test(h)&&!$.isPlainObject(b)){var V=d+1;b={};for(var C=V;C<arguments.length;C++)g.isArray(arguments[C])||!/^(fast|normal|slow)$/i.test(arguments[C])&&!/^\d/.test(arguments[C])?g.isString(arguments[C])||g.isArray(arguments[C])?b.easing=arguments[C]:g.isFunction(arguments[C])&&(b.complete=arguments[C]):b.duration=arguments[C]}var T={promise:null,resolver:null,rejecter:null};l&&v.Promise&&(T.promise=new v.Promise(function(e,t){T.resolver=e,T.rejecter=t}));var k;switch(h){case"scroll":k="scroll";break;case"reverse":k="reverse";break;case"finish":case"stop":$.each(m,function(e,t){i(t)&&i(t).delayTimer&&(clearTimeout(i(t).delayTimer.setTimeout),i(t).delayTimer.next&&i(t).delayTimer.next(),delete i(t).delayTimer)});var A=[];return $.each(v.State.calls,function(e,t){t&&$.each(t[1],function(r,n){var o=b===a?"":b;return o===!0||t[2].queue===o||b===a&&t[2].queue===!1?void $.each(m,function(r,a){a===n&&((b===!0||g.isString(b))&&($.each($.queue(a,g.isString(b)?b:""),function(e,t){g.isFunction(t)&&t(null,!0)}),$.queue(a,g.isString(b)?b:"",[])),"stop"===h?(i(a)&&i(a).tweensContainer&&o!==!1&&$.each(i(a).tweensContainer,function(e,t){t.endValue=t.currentValue}),A.push(e)):"finish"===h&&(t[2].duration=1))}):!0})}),"stop"===h&&($.each(A,function(e,t){p(t,!0)}),T.promise&&T.resolver(m)),e();default:if(!$.isPlainObject(h)||g.isEmptyObject(h)){if(g.isString(h)&&v.Redirects[h]){var F=$.extend({},b),E=F.duration,j=F.delay||0;return F.backwards===!0&&(m=$.extend(!0,[],m).reverse()),$.each(m,function(e,t){parseFloat(F.stagger)?F.delay=j+parseFloat(F.stagger)*e:g.isFunction(F.stagger)&&(F.delay=j+F.stagger.call(t,e,P)),F.drag&&(F.duration=parseFloat(E)||(/^(callout|transition)/.test(h)?1e3:y),F.duration=Math.max(F.duration*(F.backwards?1-e/P:(e+1)/P),.75*F.duration,200)),v.Redirects[h].call(t,t,F||{},e,P,m,T.promise?T:a)}),e()}var H="Velocity: First argument ("+h+") was not a property map, a known action, or a registered redirect. Aborting.";
return T.promise?T.rejecter(new Error(H)):console.log(H),e()}k="start"}var N={lastParent:null,lastPosition:null,lastFontSize:null,lastPercentToPxWidth:null,lastPercentToPxHeight:null,lastEmToPx:null,remToPx:null,vwToPx:null,vhToPx:null},L=[];$.each(m,function(e,t){g.isNode(t)&&n.call(t)});var R,F=$.extend({},v.defaults,b);if(F.loop=parseInt(F.loop),R=2*F.loop-1,F.loop)for(var O=0;R>O;O++){var z={delay:F.delay,progress:F.progress};O===R-1&&(z.display=F.display,z.visibility=F.visibility,z.complete=F.complete),S(m,"reverse",z)}return e()}};v=$.extend(S,v),v.animate=S;var P=t.requestAnimationFrame||d;return v.State.isMobile||r.hidden===a||r.addEventListener("visibilitychange",function(){r.hidden?(P=function(e){return setTimeout(function(){e(!0)},16)},c()):P=t.requestAnimationFrame||d}),e.Velocity=v,e!==t&&(e.fn.velocity=S,e.fn.velocity.defaults=v.defaults),$.each(["Down","Up"],function(e,t){v.Redirects["slide"+t]=function(e,r,n,o,i,s){var l=$.extend({},r),u=l.begin,c=l.complete,p={height:"",marginTop:"",marginBottom:"",paddingTop:"",paddingBottom:""},f={};l.display===a&&(l.display="Down"===t?"inline"===v.CSS.Values.getDisplayType(e)?"inline-block":"block":"none"),l.begin=function(){u&&u.call(i,i);for(var r in p){f[r]=e.style[r];var a=v.CSS.getPropertyValue(e,r);p[r]="Down"===t?[a,0]:[0,a]}f.overflow=e.style.overflow,e.style.overflow="hidden"},l.complete=function(){for(var t in f)e.style[t]=f[t];c&&c.call(i,i),s&&s.resolver(i)},v(e,p,l)}}),$.each(["In","Out"],function(e,t){v.Redirects["fade"+t]=function(e,r,n,o,i,s){var l=$.extend({},r),u={opacity:"In"===t?1:0},c=l.complete;l.complete=n!==o-1?l.begin=null:function(){c&&c.call(i,i),s&&s.resolver(i)},l.display===a&&(l.display="In"===t?"auto":"none"),v(this,u,l)}}),v}(window.jQuery||window.Zepto||window,window,document)}),/*
jQuery Waypoints - v2.0.3
Copyright (c) 2011-2013 Caleb Troughton
Dual licensed under the MIT license and GPL license.
https://github.com/imakewebthings/jquery-waypoints/blob/master/licenses.txt
 */
function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1},slice=[].slice;!function(root,factory){return"function"==typeof define&&define.amd?define("waypoints",["jquery"],function($){return factory($,root)}):factory(root.jQuery,root)}(this,function($,window){var $w,Context,Waypoint,allWaypoints,contextCounter,contextKey,contexts,isTouch,jQMethods,methods,resizeEvent,scrollEvent,waypointCounter,waypointKey,wp,wps;return $w=$(window),isTouch=indexOf.call(window,"ontouchstart")>=0,allWaypoints={horizontal:{},vertical:{}},contextCounter=1,contexts={},contextKey="waypoints-context-id",resizeEvent="resize.waypoints",scrollEvent="scroll.waypoints",waypointCounter=1,waypointKey="waypoints-waypoint-ids",wp="waypoint",wps="waypoints",Context=function(){function Context($element){this.$element=$element,this.element=$element[0],this.didResize=!1,this.didScroll=!1,this.id="context"+contextCounter++,this.oldScroll={x:$element.scrollLeft(),y:$element.scrollTop()},this.waypoints={horizontal:{},vertical:{}},$element.data(contextKey,this.id),contexts[this.id]=this,$element.bind(scrollEvent,function(_this){return function(){var scrollHandler;return _this.didScroll||isTouch?void 0:(_this.didScroll=!0,scrollHandler=function(){return _this.doScroll(),_this.didScroll=!1},window.setTimeout(scrollHandler,$[wps].settings.scrollThrottle))}}(this)),$element.bind(resizeEvent,function(_this){return function(){var resizeHandler;return _this.didResize?void 0:(_this.didResize=!0,resizeHandler=function(){return $[wps]("refresh"),_this.didResize=!1},window.setTimeout(resizeHandler,$[wps].settings.resizeThrottle))}}(this))}return Context.prototype.doScroll=function(){var axes;return axes={horizontal:{newScroll:this.$element.scrollLeft(),oldScroll:this.oldScroll.x,forward:"right",backward:"left"},vertical:{newScroll:this.$element.scrollTop(),oldScroll:this.oldScroll.y,forward:"down",backward:"up"}},!isTouch||axes.vertical.oldScroll&&axes.vertical.newScroll||$[wps]("refresh"),$.each(axes,function(_this){return function(aKey,axis){var direction,isForward,triggered;return triggered=[],isForward=axis.newScroll>axis.oldScroll,direction=isForward?axis.forward:axis.backward,$.each(_this.waypoints[aKey],function(wKey,waypoint){var ref,ref1;return axis.oldScroll<(ref=waypoint.offset)&&ref<=axis.newScroll?triggered.push(waypoint):axis.newScroll<(ref1=waypoint.offset)&&ref1<=axis.oldScroll?triggered.push(waypoint):void 0}),triggered.sort(function(a,b){return a.offset-b.offset}),isForward||triggered.reverse(),$.each(triggered,function(i,waypoint){return waypoint.options.continuous||i===triggered.length-1?waypoint.trigger([direction]):void 0})}}(this)),this.oldScroll={x:axes.horizontal.newScroll,y:axes.vertical.newScroll}},Context.prototype.refresh=function(){var axes,cOffset,isWin;return isWin=$.isWindow(this.element),cOffset=this.$element.offset(),this.doScroll(),axes={horizontal:{contextOffset:isWin?0:cOffset.left,contextScroll:isWin?0:this.oldScroll.x,contextDimension:this.$element.width(),oldScroll:this.oldScroll.x,forward:"right",backward:"left",offsetProp:"left"},vertical:{contextOffset:isWin?0:cOffset.top,contextScroll:isWin?0:this.oldScroll.y,contextDimension:isWin?$[wps]("viewportHeight"):this.$element.height(),oldScroll:this.oldScroll.y,forward:"down",backward:"up",offsetProp:"top"}},$.each(axes,function(_this){return function(aKey,axis){return $.each(_this.waypoints[aKey],function(i,waypoint){var adjustment,elementOffset,oldOffset,ref,ref1;return adjustment=waypoint.options.offset,oldOffset=waypoint.offset,elementOffset=$.isWindow(waypoint.element)?0:waypoint.$element.offset()[axis.offsetProp],$.isFunction(adjustment)?adjustment=adjustment.apply(waypoint.element):"string"==typeof adjustment&&(adjustment=parseFloat(adjustment),waypoint.options.offset.indexOf("%")>-1&&(adjustment=Math.ceil(axis.contextDimension*adjustment/100))),waypoint.offset=elementOffset-axis.contextOffset+axis.contextScroll-adjustment,waypoint.options.onlyOnScroll&&null!=oldOffset||!waypoint.enabled?void 0:null!==oldOffset&&oldOffset<(ref=axis.oldScroll)&&ref<=waypoint.offset?waypoint.trigger([axis.backward]):null!==oldOffset&&oldOffset>(ref1=axis.oldScroll)&&ref1>=waypoint.offset?waypoint.trigger([axis.forward]):null===oldOffset&&axis.oldScroll>=waypoint.offset?waypoint.trigger([axis.forward]):void 0})}}(this))},Context.prototype.checkEmpty=function(){return $.isEmptyObject(this.waypoints.horizontal)&&$.isEmptyObject(this.waypoints.vertical)?(this.$element.unbind([resizeEvent,scrollEvent].join(" ")),delete contexts[this.id]):void 0},Context}(),Waypoint=function(){function Waypoint($element,context,options){var idList,ref;options=$.extend({},$.fn[wp].defaults,options),"bottom-in-view"===options.offset&&(options.offset=function(){var contextHeight;return contextHeight=$[wps]("viewportHeight"),$.isWindow(context.element)||(contextHeight=context.$element.height()),contextHeight-$(this).outerHeight()}),this.$element=$element,this.element=$element[0],this.axis=options.horizontal?"horizontal":"vertical",this.callback=options.handler,this.context=context,this.enabled=options.enabled,this.id="waypoints"+waypointCounter++,this.offset=null,this.options=options,context.waypoints[this.axis][this.id]=this,allWaypoints[this.axis][this.id]=this,idList=null!=(ref=$element.data(waypointKey))?ref:[],idList.push(this.id),$element.data(waypointKey,idList)}return Waypoint.prototype.trigger=function(args){return this.enabled?(null!=this.callback&&this.callback.apply(this.element,args),this.options.triggerOnce?this.destroy():void 0):void 0},Waypoint.prototype.disable=function(){return this.enabled=!1},Waypoint.prototype.enable=function(){return this.context.refresh(),this.enabled=!0},Waypoint.prototype.destroy=function(){return delete allWaypoints[this.axis][this.id],delete this.context.waypoints[this.axis][this.id],this.context.checkEmpty()},Waypoint.getWaypointsByElement=function(element){var all,ids;return(ids=$(element).data(waypointKey))?(all=$.extend({},allWaypoints.horizontal,allWaypoints.vertical),$.map(ids,function(id){return all[id]})):[]},Waypoint}(),methods={init:function(f,options){return null==options&&(options={}),null==options.handler&&(options.handler=f),this.each(function(){var $this,context,contextElement,ref;return $this=$(this),contextElement=null!=(ref=options.context)?ref:$.fn[wp].defaults.context,$.isWindow(contextElement)||(contextElement=$this.closest(contextElement)),contextElement=$(contextElement),context=contexts[contextElement.data(contextKey)],context||(context=new Context(contextElement)),new Waypoint($this,context,options)}),$[wps]("refresh"),this},disable:function(){return methods._invoke(this,"disable")},enable:function(){return methods._invoke(this,"enable")},destroy:function(){return methods._invoke(this,"destroy")},prev:function(axis,selector){return methods._traverse.call(this,axis,selector,function(stack,index,waypoints){return index>0?stack.push(waypoints[index-1]):void 0})},next:function(axis,selector){return methods._traverse.call(this,axis,selector,function(stack,index,waypoints){return index<waypoints.length-1?stack.push(waypoints[index+1]):void 0})},_traverse:function(axis,selector,push){var stack,waypoints;return null==axis&&(axis="vertical"),null==selector&&(selector=window),waypoints=jQMethods.aggregate(selector),stack=[],this.each(function(){var index;return index=$.inArray(this,waypoints[axis]),push(stack,index,waypoints[axis])}),this.pushStack(stack)},_invoke:function($elements,method){return $elements.each(function(){var waypoints;return waypoints=Waypoint.getWaypointsByElement(this),$.each(waypoints,function(i,waypoint){return waypoint[method](),!0})}),this}},$.fn[wp]=function(){var args,method;return method=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],methods[method]?methods[method].apply(this,args):$.isFunction(method)?methods.init.apply(this,arguments):$.isPlainObject(method)?methods.init.apply(this,[null,method]):method?$.error("The "+method+" method does not exist in jQuery Waypoints."):$.error("jQuery Waypoints needs a callback function or handler option.")},$.fn[wp].defaults={context:window,continuous:!0,enabled:!0,horizontal:!1,offset:0,triggerOnce:!1},jQMethods={refresh:function(){return $.each(contexts,function(i,context){return context.refresh()})},viewportHeight:function(){var ref;return null!=(ref=window.innerHeight)?ref:$w.height()},aggregate:function(contextSelector){var collection,ref,waypoints;return collection=allWaypoints,contextSelector&&(collection=null!=(ref=contexts[$(contextSelector).data(contextKey)])?ref.waypoints:void 0),collection?(waypoints={horizontal:[],vertical:[]},$.each(waypoints,function(axis,arr){return $.each(collection[axis],function(key,waypoint){return arr.push(waypoint)}),arr.sort(function(a,b){return a.offset-b.offset}),waypoints[axis]=$.map(arr,function(waypoint){return waypoint.element}),waypoints[axis]=$.unique(waypoints[axis])}),waypoints):[]},above:function(contextSelector){return null==contextSelector&&(contextSelector=window),jQMethods._filter(contextSelector,"vertical",function(context,waypoint){return waypoint.offset<=context.oldScroll.y})},below:function(contextSelector){return null==contextSelector&&(contextSelector=window),jQMethods._filter(contextSelector,"vertical",function(context,waypoint){return waypoint.offset>context.oldScroll.y})},left:function(contextSelector){return null==contextSelector&&(contextSelector=window),jQMethods._filter(contextSelector,"horizontal",function(context,waypoint){return waypoint.offset<=context.oldScroll.x})},right:function(contextSelector){return null==contextSelector&&(contextSelector=window),jQMethods._filter(contextSelector,"horizontal",function(context,waypoint){return waypoint.offset>context.oldScroll.x})},enable:function(){return jQMethods._invoke("enable")},disable:function(){return jQMethods._invoke("disable")},destroy:function(){return jQMethods._invoke("destroy")},extendFn:function(methodName,f){return methods[methodName]=f},_invoke:function(method){var waypoints;return waypoints=$.extend({},allWaypoints.vertical,allWaypoints.horizontal),$.each(waypoints,function(key,waypoint){return waypoint[method](),!0})},_filter:function(selector,axis,test){var context,waypoints;return(context=contexts[$(selector).data(contextKey)])?(waypoints=[],$.each(context.waypoints[axis],function(i,waypoint){return test(context,waypoint)?waypoints.push(waypoint):void 0}),waypoints.sort(function(a,b){return a.offset-b.offset}),$.map(waypoints,function(waypoint){return waypoint.element})):[]}},$[wps]=function(){var args,method;return method=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],jQMethods[method]?jQMethods[method].apply(null,args):jQMethods.aggregate.call(null,method)},$[wps].settings={resizeThrottle:100,scrollThrottle:30},$w.load(function(){return $[wps]("refresh")})})}.call(this),/*
Sticky Elements Shortcut for jQuery Waypoints - v2.0.5
Copyright (c) 2011-2014 Caleb Troughton
Licensed under the MIT license.
https://github.com/imakewebthings/jquery-waypoints/blob/master/licenses.txt
*/
function(){!function(root,factory){return"function"==typeof define&&define.amd?define(["jquery","waypoints"],factory):factory(root.jQuery)}(window,function($){var defaults,wrap;return defaults={wrapper:'<div class="sticky-wrapper" />',stuckClass:"stuck",direction:"down right"},wrap=function($elements,options){var $parent;return $elements.wrap(options.wrapper),$parent=$elements.parent(),$parent.data("isWaypointStickyWrapper",!0)},$.waypoints("extendFn","sticky",function(opt){var $wrap,options,originalHandler;return options=$.extend({},$.fn.waypoint.defaults,defaults,opt),$wrap=wrap(this,options),originalHandler=options.handler,options.handler=function(direction){var $sticky,shouldBeStuck;return $sticky=$(this).children(":first"),shouldBeStuck=-1!==options.direction.indexOf(direction),$sticky.toggleClass(options.stuckClass,shouldBeStuck),$wrap.height(shouldBeStuck?$sticky.outerHeight():""),null!=originalHandler?originalHandler.call(this,direction):void 0},$wrap.waypoint(options),this.data("stuckClass",options.stuckClass)}),$.waypoints("extendFn","unsticky",function(){var $parent;return $parent=this.parent(),$parent.data("isWaypointStickyWrapper")?($parent.waypoint("destroy"),this.unwrap(),this.removeClass(this.data("stuckClass"))):this})})}.call(this),function(){$.fn.serializeObject=function(){var json,patterns,push_counters;return json={},push_counters={},patterns={validate:/^[a-zA-Z][a-zA-Z0-9_]*(?:\[(?:\d*|[a-zA-Z0-9_]+)\])*$/,key:/[a-zA-Z0-9_]+|(?=\[\])/g,push:/^$/,fixed:/^\d+$/,named:/^[a-zA-Z0-9_]+$/},this.build=function(base,key,value){return base[key]=value,base},this.push_counter=function(key){return void 0===push_counters[key]&&(push_counters[key]=0),push_counters[key]++},$.each($(this).serializeArray(),function(_this){return function(i,elem){var k,keys,merge,re,reverse_key;if(patterns.validate.test(elem.name)){for(keys=elem.name.match(patterns.key),merge=elem.value,reverse_key=elem.name;void 0!==(k=keys.pop());)patterns.push.test(k)?(re=new RegExp("\\["+k+"\\]$"),reverse_key=reverse_key.replace(re,""),merge=_this.build([],_this.push_counter(reverse_key),merge)):patterns.fixed.test(k)?merge=_this.build([],k,merge):patterns.named.test(k)&&(merge=_this.build({},k,merge));return json=$.extend(!0,json,merge)}}}(this)),json}}.call(this),/*
 * jQuery File Upload Plugin 5.40.1
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2010, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery","jquery.ui.widget"],factory):factory(window.jQuery)}(function($){"use strict";$.support.fileInput=!(new RegExp("(Android (1\\.[0156]|2\\.[01]))|(Windows Phone (OS 7|8\\.0))|(XBLWP)|(ZuneWP)|(WPDesktop)|(w(eb)?OSBrowser)|(webOS)|(Kindle/(1\\.0|2\\.[05]|3\\.0))").test(window.navigator.userAgent)||$('<input type="file">').prop("disabled")),$.support.xhrFileUpload=!(!window.ProgressEvent||!window.FileReader),$.support.xhrFormDataFileUpload=!!window.FormData,$.support.blobSlice=window.Blob&&(Blob.prototype.slice||Blob.prototype.webkitSlice||Blob.prototype.mozSlice),$.widget("blueimp.fileupload",{options:{dropZone:$(document),pasteZone:$(document),fileInput:void 0,replaceFileInput:!0,paramName:void 0,singleFileUploads:!0,limitMultiFileUploads:void 0,limitMultiFileUploadSize:void 0,limitMultiFileUploadSizeOverhead:512,sequentialUploads:!1,limitConcurrentUploads:void 0,forceIframeTransport:!1,redirect:void 0,redirectParamName:void 0,postMessage:void 0,multipart:!0,maxChunkSize:void 0,uploadedBytes:void 0,recalculateProgress:!0,progressInterval:100,bitrateInterval:500,autoUpload:!0,messages:{uploadedBytes:"Uploaded bytes exceed file size"},i18n:function(message,context){return message=this.messages[message]||message.toString(),context&&$.each(context,function(key,value){message=message.replace("{"+key+"}",value)}),message},formData:function(form){return form.serializeArray()},add:function(e,data){return e.isDefaultPrevented()?!1:void((data.autoUpload||data.autoUpload!==!1&&$(this).fileupload("option","autoUpload"))&&data.process().done(function(){data.submit()}))},processData:!1,contentType:!1,cache:!1},_specialOptions:["fileInput","dropZone","pasteZone","multipart","forceIframeTransport"],_blobSlice:$.support.blobSlice&&function(){var slice=this.slice||this.webkitSlice||this.mozSlice;return slice.apply(this,arguments)},_BitrateTimer:function(){this.timestamp=Date.now?Date.now():(new Date).getTime(),this.loaded=0,this.bitrate=0,this.getBitrate=function(now,loaded,interval){var timeDiff=now-this.timestamp;return(!this.bitrate||!interval||timeDiff>interval)&&(this.bitrate=(loaded-this.loaded)*(1e3/timeDiff)*8,this.loaded=loaded,this.timestamp=now),this.bitrate}},_isXHRUpload:function(options){return!options.forceIframeTransport&&(!options.multipart&&$.support.xhrFileUpload||$.support.xhrFormDataFileUpload)},_getFormData:function(options){var formData;return"function"===$.type(options.formData)?options.formData(options.form):$.isArray(options.formData)?options.formData:"object"===$.type(options.formData)?(formData=[],$.each(options.formData,function(name,value){formData.push({name:name,value:value})}),formData):[]},_getTotal:function(files){var total=0;return $.each(files,function(index,file){total+=file.size||1}),total},_initProgressObject:function(obj){var progress={loaded:0,total:0,bitrate:0};obj._progress?$.extend(obj._progress,progress):obj._progress=progress},_initResponseObject:function(obj){var prop;if(obj._response)for(prop in obj._response)obj._response.hasOwnProperty(prop)&&delete obj._response[prop];else obj._response={}},_onProgress:function(e,data){if(e.lengthComputable){var loaded,now=Date.now?Date.now():(new Date).getTime();if(data._time&&data.progressInterval&&now-data._time<data.progressInterval&&e.loaded!==e.total)return;data._time=now,loaded=Math.floor(e.loaded/e.total*(data.chunkSize||data._progress.total))+(data.uploadedBytes||0),this._progress.loaded+=loaded-data._progress.loaded,this._progress.bitrate=this._bitrateTimer.getBitrate(now,this._progress.loaded,data.bitrateInterval),data._progress.loaded=data.loaded=loaded,data._progress.bitrate=data.bitrate=data._bitrateTimer.getBitrate(now,loaded,data.bitrateInterval),this._trigger("progress",$.Event("progress",{delegatedEvent:e}),data),this._trigger("progressall",$.Event("progressall",{delegatedEvent:e}),this._progress)}},_initProgressListener:function(options){var that=this,xhr=options.xhr?options.xhr():$.ajaxSettings.xhr();xhr.upload&&($(xhr.upload).bind("progress",function(e){var oe=e.originalEvent;e.lengthComputable=oe.lengthComputable,e.loaded=oe.loaded,e.total=oe.total,that._onProgress(e,options)}),options.xhr=function(){return xhr})},_isInstanceOf:function(type,obj){return Object.prototype.toString.call(obj)==="[object "+type+"]"},_initXHRData:function(options){var formData,that=this,file=options.files[0],multipart=options.multipart||!$.support.xhrFileUpload,paramName="array"===$.type(options.paramName)?options.paramName[0]:options.paramName;options.headers=$.extend({},options.headers),options.contentRange&&(options.headers["Content-Range"]=options.contentRange),multipart&&!options.blob&&this._isInstanceOf("File",file)||(options.headers["Content-Disposition"]='attachment; filename="'+encodeURI(file.name)+'"'),multipart?$.support.xhrFormDataFileUpload&&(options.postMessage?(formData=this._getFormData(options),options.blob?formData.push({name:paramName,value:options.blob}):$.each(options.files,function(index,file){formData.push({name:"array"===$.type(options.paramName)&&options.paramName[index]||paramName,value:file})})):(that._isInstanceOf("FormData",options.formData)?formData=options.formData:(formData=new FormData,$.each(this._getFormData(options),function(index,field){formData.append(field.name,field.value)})),options.blob?formData.append(paramName,options.blob,file.name):$.each(options.files,function(index,file){(that._isInstanceOf("File",file)||that._isInstanceOf("Blob",file))&&formData.append("array"===$.type(options.paramName)&&options.paramName[index]||paramName,file,file.uploadName||file.name)})),options.data=formData):(options.contentType=file.type||"application/octet-stream",options.data=options.blob||file),options.blob=null},_initIframeSettings:function(options){var targetHost=$("<a></a>").prop("href",options.url).prop("host");options.dataType="iframe "+(options.dataType||""),options.formData=this._getFormData(options),options.redirect&&targetHost&&targetHost!==location.host&&options.formData.push({name:options.redirectParamName||"redirect",value:options.redirect})},_initDataSettings:function(options){this._isXHRUpload(options)?(this._chunkedUpload(options,!0)||(options.data||this._initXHRData(options),this._initProgressListener(options)),options.postMessage&&(options.dataType="postmessage "+(options.dataType||""))):this._initIframeSettings(options)},_getParamName:function(options){var fileInput=$(options.fileInput),paramName=options.paramName;return paramName?$.isArray(paramName)||(paramName=[paramName]):(paramName=[],fileInput.each(function(){for(var input=$(this),name=input.prop("name")||"files[]",i=(input.prop("files")||[1]).length;i;)paramName.push(name),i-=1}),paramName.length||(paramName=[fileInput.prop("name")||"files[]"])),paramName},_initFormSettings:function(options){options.form&&options.form.length||(options.form=$(options.fileInput.prop("form")),options.form.length||(options.form=$(this.options.fileInput.prop("form")))),options.paramName=this._getParamName(options),options.url||(options.url=options.form.prop("action")||location.href),options.type=(options.type||"string"===$.type(options.form.prop("method"))&&options.form.prop("method")||"").toUpperCase(),"POST"!==options.type&&"PUT"!==options.type&&"PATCH"!==options.type&&(options.type="POST"),options.formAcceptCharset||(options.formAcceptCharset=options.form.attr("accept-charset"))},_getAJAXSettings:function(data){var options=$.extend({},this.options,data);return this._initFormSettings(options),this._initDataSettings(options),options},_getDeferredState:function(deferred){return deferred.state?deferred.state():deferred.isResolved()?"resolved":deferred.isRejected()?"rejected":"pending"},_enhancePromise:function(promise){return promise.success=promise.done,promise.error=promise.fail,promise.complete=promise.always,promise},_getXHRPromise:function(resolveOrReject,context,args){var dfd=$.Deferred(),promise=dfd.promise();return context=context||this.options.context||promise,resolveOrReject===!0?dfd.resolveWith(context,args):resolveOrReject===!1&&dfd.rejectWith(context,args),promise.abort=dfd.promise,this._enhancePromise(promise)},_addConvenienceMethods:function(e,data){var that=this,getPromise=function(args){return $.Deferred().resolveWith(that,args).promise()};data.process=function(resolveFunc,rejectFunc){return(resolveFunc||rejectFunc)&&(data._processQueue=this._processQueue=(this._processQueue||getPromise([this])).pipe(function(){return data.errorThrown?$.Deferred().rejectWith(that,[data]).promise():getPromise(arguments)}).pipe(resolveFunc,rejectFunc)),this._processQueue||getPromise([this])},data.submit=function(){return"pending"!==this.state()&&(data.jqXHR=this.jqXHR=that._trigger("submit",$.Event("submit",{delegatedEvent:e}),this)!==!1&&that._onSend(e,this)),this.jqXHR||that._getXHRPromise()},data.abort=function(){return this.jqXHR?this.jqXHR.abort():(this.errorThrown="abort",that._trigger("fail",null,this),that._getXHRPromise(!1))},data.state=function(){return this.jqXHR?that._getDeferredState(this.jqXHR):this._processQueue?that._getDeferredState(this._processQueue):void 0},data.processing=function(){return!this.jqXHR&&this._processQueue&&"pending"===that._getDeferredState(this._processQueue)},data.progress=function(){return this._progress},data.response=function(){return this._response}},_getUploadedBytes:function(jqXHR){var range=jqXHR.getResponseHeader("Range"),parts=range&&range.split("-"),upperBytesPos=parts&&parts.length>1&&parseInt(parts[1],10);return upperBytesPos&&upperBytesPos+1},_chunkedUpload:function(options,testOnly){options.uploadedBytes=options.uploadedBytes||0;var jqXHR,upload,that=this,file=options.files[0],fs=file.size,ub=options.uploadedBytes,mcs=options.maxChunkSize||fs,slice=this._blobSlice,dfd=$.Deferred(),promise=dfd.promise();return this._isXHRUpload(options)&&slice&&(ub||fs>mcs)&&!options.data?testOnly?!0:ub>=fs?(file.error=options.i18n("uploadedBytes"),this._getXHRPromise(!1,options.context,[null,"error",file.error])):(upload=function(){var o=$.extend({},options),currentLoaded=o._progress.loaded;o.blob=slice.call(file,ub,ub+mcs,file.type),o.chunkSize=o.blob.size,o.contentRange="bytes "+ub+"-"+(ub+o.chunkSize-1)+"/"+fs,that._initXHRData(o),that._initProgressListener(o),jqXHR=(that._trigger("chunksend",null,o)!==!1&&$.ajax(o)||that._getXHRPromise(!1,o.context)).done(function(result,textStatus,jqXHR){ub=that._getUploadedBytes(jqXHR)||ub+o.chunkSize,currentLoaded+o.chunkSize-o._progress.loaded&&that._onProgress($.Event("progress",{lengthComputable:!0,loaded:ub-o.uploadedBytes,total:ub-o.uploadedBytes}),o),options.uploadedBytes=o.uploadedBytes=ub,o.result=result,o.textStatus=textStatus,o.jqXHR=jqXHR,that._trigger("chunkdone",null,o),that._trigger("chunkalways",null,o),fs>ub?upload():dfd.resolveWith(o.context,[result,textStatus,jqXHR])}).fail(function(jqXHR,textStatus,errorThrown){o.jqXHR=jqXHR,o.textStatus=textStatus,o.errorThrown=errorThrown,that._trigger("chunkfail",null,o),that._trigger("chunkalways",null,o),dfd.rejectWith(o.context,[jqXHR,textStatus,errorThrown])})},this._enhancePromise(promise),promise.abort=function(){return jqXHR.abort()},upload(),promise):!1},_beforeSend:function(e,data){0===this._active&&(this._trigger("start"),this._bitrateTimer=new this._BitrateTimer,this._progress.loaded=this._progress.total=0,this._progress.bitrate=0),this._initResponseObject(data),this._initProgressObject(data),data._progress.loaded=data.loaded=data.uploadedBytes||0,data._progress.total=data.total=this._getTotal(data.files)||1,data._progress.bitrate=data.bitrate=0,this._active+=1,this._progress.loaded+=data.loaded,this._progress.total+=data.total},_onDone:function(result,textStatus,jqXHR,options){var total=options._progress.total,response=options._response;options._progress.loaded<total&&this._onProgress($.Event("progress",{lengthComputable:!0,loaded:total,total:total}),options),response.result=options.result=result,response.textStatus=options.textStatus=textStatus,response.jqXHR=options.jqXHR=jqXHR,this._trigger("done",null,options)},_onFail:function(jqXHR,textStatus,errorThrown,options){var response=options._response;options.recalculateProgress&&(this._progress.loaded-=options._progress.loaded,this._progress.total-=options._progress.total),response.jqXHR=options.jqXHR=jqXHR,response.textStatus=options.textStatus=textStatus,response.errorThrown=options.errorThrown=errorThrown,this._trigger("fail",null,options)},_onAlways:function(jqXHRorResult,textStatus,jqXHRorError,options){this._trigger("always",null,options)},_onSend:function(e,data){data.submit||this._addConvenienceMethods(e,data);var jqXHR,aborted,slot,pipe,that=this,options=that._getAJAXSettings(data),send=function(){return that._sending+=1,options._bitrateTimer=new that._BitrateTimer,jqXHR=jqXHR||((aborted||that._trigger("send",$.Event("send",{delegatedEvent:e}),options)===!1)&&that._getXHRPromise(!1,options.context,aborted)||that._chunkedUpload(options)||$.ajax(options)).done(function(result,textStatus,jqXHR){that._onDone(result,textStatus,jqXHR,options)}).fail(function(jqXHR,textStatus,errorThrown){that._onFail(jqXHR,textStatus,errorThrown,options)}).always(function(jqXHRorResult,textStatus,jqXHRorError){if(that._onAlways(jqXHRorResult,textStatus,jqXHRorError,options),that._sending-=1,that._active-=1,options.limitConcurrentUploads&&options.limitConcurrentUploads>that._sending)for(var nextSlot=that._slots.shift();nextSlot;){if("pending"===that._getDeferredState(nextSlot)){nextSlot.resolve();break}nextSlot=that._slots.shift()}0===that._active&&that._trigger("stop")})};return this._beforeSend(e,options),this.options.sequentialUploads||this.options.limitConcurrentUploads&&this.options.limitConcurrentUploads<=this._sending?(this.options.limitConcurrentUploads>1?(slot=$.Deferred(),this._slots.push(slot),pipe=slot.pipe(send)):(this._sequence=this._sequence.pipe(send,send),pipe=this._sequence),pipe.abort=function(){return aborted=[void 0,"abort","abort"],jqXHR?jqXHR.abort():(slot&&slot.rejectWith(options.context,aborted),send())},this._enhancePromise(pipe)):send()},_onAdd:function(e,data){var paramNameSet,paramNameSlice,fileSet,i,that=this,result=!0,options=$.extend({},this.options,data),files=data.files,filesLength=files.length,limit=options.limitMultiFileUploads,limitSize=options.limitMultiFileUploadSize,overhead=options.limitMultiFileUploadSizeOverhead,batchSize=0,paramName=this._getParamName(options),j=0;if(!limitSize||filesLength&&void 0!==files[0].size||(limitSize=void 0),(options.singleFileUploads||limit||limitSize)&&this._isXHRUpload(options))if(options.singleFileUploads||limitSize||!limit)if(!options.singleFileUploads&&limitSize)for(fileSet=[],paramNameSet=[],i=0;filesLength>i;i+=1)batchSize+=files[i].size+overhead,(i+1===filesLength||batchSize+files[i+1].size+overhead>limitSize||limit&&i+1-j>=limit)&&(fileSet.push(files.slice(j,i+1)),paramNameSlice=paramName.slice(j,i+1),paramNameSlice.length||(paramNameSlice=paramName),paramNameSet.push(paramNameSlice),j=i+1,batchSize=0);else paramNameSet=paramName;else for(fileSet=[],paramNameSet=[],i=0;filesLength>i;i+=limit)fileSet.push(files.slice(i,i+limit)),paramNameSlice=paramName.slice(i,i+limit),paramNameSlice.length||(paramNameSlice=paramName),paramNameSet.push(paramNameSlice);else fileSet=[files],paramNameSet=[paramName];return data.originalFiles=files,$.each(fileSet||files,function(index,element){var newData=$.extend({},data);return newData.files=fileSet?element:[element],newData.paramName=paramNameSet[index],that._initResponseObject(newData),that._initProgressObject(newData),that._addConvenienceMethods(e,newData),result=that._trigger("add",$.Event("add",{delegatedEvent:e}),newData)}),result},_replaceFileInput:function(input){var inputClone=input.clone(!0);$("<form></form>").append(inputClone)[0].reset(),input.after(inputClone).detach(),$.cleanData(input.unbind("remove")),this.options.fileInput=this.options.fileInput.map(function(i,el){return el===input[0]?inputClone[0]:el}),input[0]===this.element[0]&&(this.element=inputClone)},_handleFileTreeEntry:function(entry,path){var dirReader,that=this,dfd=$.Deferred(),errorHandler=function(e){e&&!e.entry&&(e.entry=entry),dfd.resolve([e])};return path=path||"",entry.isFile?entry._file?(entry._file.relativePath=path,dfd.resolve(entry._file)):entry.file(function(file){file.relativePath=path,dfd.resolve(file)},errorHandler):entry.isDirectory?(dirReader=entry.createReader(),dirReader.readEntries(function(entries){that._handleFileTreeEntries(entries,path+entry.name+"/").done(function(files){dfd.resolve(files)}).fail(errorHandler)},errorHandler)):dfd.resolve([]),dfd.promise()},_handleFileTreeEntries:function(entries,path){var that=this;return $.when.apply($,$.map(entries,function(entry){return that._handleFileTreeEntry(entry,path)})).pipe(function(){return Array.prototype.concat.apply([],arguments)})},_getDroppedFiles:function(dataTransfer){dataTransfer=dataTransfer||{};var items=dataTransfer.items;return items&&items.length&&(items[0].webkitGetAsEntry||items[0].getAsEntry)?this._handleFileTreeEntries($.map(items,function(item){var entry;return item.webkitGetAsEntry?(entry=item.webkitGetAsEntry(),entry&&(entry._file=item.getAsFile()),entry):item.getAsEntry()})):$.Deferred().resolve($.makeArray(dataTransfer.files)).promise()},_getSingleFileInputFiles:function(fileInput){fileInput=$(fileInput);var files,value,entries=fileInput.prop("webkitEntries")||fileInput.prop("entries");if(entries&&entries.length)return this._handleFileTreeEntries(entries);if(files=$.makeArray(fileInput.prop("files")),files.length)void 0===files[0].name&&files[0].fileName&&$.each(files,function(index,file){file.name=file.fileName,file.size=file.fileSize});else{if(value=fileInput.prop("value"),!value)return $.Deferred().resolve([]).promise();files=[{name:value.replace(/^.*\\/,"")}]}return $.Deferred().resolve(files).promise()},_getFileInputFiles:function(fileInput){return fileInput instanceof $&&1!==fileInput.length?$.when.apply($,$.map(fileInput,this._getSingleFileInputFiles)).pipe(function(){return Array.prototype.concat.apply([],arguments)}):this._getSingleFileInputFiles(fileInput)},_onChange:function(e){var that=this,data={fileInput:$(e.target),form:$(e.target.form)};this._getFileInputFiles(data.fileInput).always(function(files){data.files=files,that.options.replaceFileInput&&that._replaceFileInput(data.fileInput),that._trigger("change",$.Event("change",{delegatedEvent:e}),data)!==!1&&that._onAdd(e,data)})},_onPaste:function(e){var items=e.originalEvent&&e.originalEvent.clipboardData&&e.originalEvent.clipboardData.items,data={files:[]};items&&items.length&&($.each(items,function(index,item){var file=item.getAsFile&&item.getAsFile();file&&data.files.push(file)}),this._trigger("paste",$.Event("paste",{delegatedEvent:e}),data)!==!1&&this._onAdd(e,data))},_onDrop:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var that=this,dataTransfer=e.dataTransfer,data={};dataTransfer&&dataTransfer.files&&dataTransfer.files.length&&(e.preventDefault(),this._getDroppedFiles(dataTransfer).always(function(files){data.files=files,that._trigger("drop",$.Event("drop",{delegatedEvent:e}),data)!==!1&&that._onAdd(e,data)}))},_onDragOver:function(e){e.dataTransfer=e.originalEvent&&e.originalEvent.dataTransfer;var dataTransfer=e.dataTransfer;dataTransfer&&-1!==$.inArray("Files",dataTransfer.types)&&this._trigger("dragover",$.Event("dragover",{delegatedEvent:e}))!==!1&&(e.preventDefault(),dataTransfer.dropEffect="copy")},_initEventHandlers:function(){this._isXHRUpload(this.options)&&(this._on(this.options.dropZone,{dragover:this._onDragOver,drop:this._onDrop}),this._on(this.options.pasteZone,{paste:this._onPaste})),$.support.fileInput&&this._on(this.options.fileInput,{change:this._onChange})},_destroyEventHandlers:function(){this._off(this.options.dropZone,"dragover drop"),this._off(this.options.pasteZone,"paste"),this._off(this.options.fileInput,"change")},_setOption:function(key,value){var reinit=-1!==$.inArray(key,this._specialOptions);reinit&&this._destroyEventHandlers(),this._super(key,value),reinit&&(this._initSpecialOptions(),this._initEventHandlers())},_initSpecialOptions:function(){var options=this.options;void 0===options.fileInput?options.fileInput=this.element.is('input[type="file"]')?this.element:this.element.find('input[type="file"]'):options.fileInput instanceof $||(options.fileInput=$(options.fileInput)),options.dropZone instanceof $||(options.dropZone=$(options.dropZone)),options.pasteZone instanceof $||(options.pasteZone=$(options.pasteZone))},_getRegExp:function(str){var parts=str.split("/"),modifiers=parts.pop();return parts.shift(),new RegExp(parts.join("/"),modifiers)},_isRegExpOption:function(key,value){return"url"!==key&&"string"===$.type(value)&&/^\/.*\/[igm]{0,3}$/.test(value)},_initDataAttributes:function(){var that=this,options=this.options,clone=$(this.element[0].cloneNode(!1));$.each(clone.data(),function(key,value){var dataAttributeName="data-"+key.replace(/([a-z])([A-Z])/g,"$1-$2").toLowerCase();clone.attr(dataAttributeName)&&(that._isRegExpOption(key,value)&&(value=that._getRegExp(value)),options[key]=value)})},_create:function(){this._initDataAttributes(),this._initSpecialOptions(),this._slots=[],this._sequence=this._getXHRPromise(!0),this._sending=this._active=0,this._initProgressObject(this),this._initEventHandlers()},active:function(){return this._active},progress:function(){return this._progress},add:function(data){var that=this;data&&!this.options.disabled&&(data.fileInput&&!data.files?this._getFileInputFiles(data.fileInput).always(function(files){data.files=files,that._onAdd(null,data)}):(data.files=$.makeArray(data.files),this._onAdd(null,data)))},send:function(data){if(data&&!this.options.disabled){if(data.fileInput&&!data.files){var jqXHR,aborted,that=this,dfd=$.Deferred(),promise=dfd.promise();return promise.abort=function(){return aborted=!0,jqXHR?jqXHR.abort():(dfd.reject(null,"abort","abort"),promise)},this._getFileInputFiles(data.fileInput).always(function(files){if(!aborted){if(!files.length)return void dfd.reject();data.files=files,jqXHR=that._onSend(null,data).then(function(result,textStatus,jqXHR){dfd.resolve(result,textStatus,jqXHR)},function(jqXHR,textStatus,errorThrown){dfd.reject(jqXHR,textStatus,errorThrown)})}}),this._enhancePromise(promise)}if(data.files=$.makeArray(data.files),data.files.length)return this._onSend(null,data)}return this._getXHRPromise(!1,data&&data.context)}})}),/*
 * jQuery Iframe Transport Plugin 1.4
 * https://github.com/blueimp/jQuery-File-Upload
 *
 * Copyright 2011, Sebastian Tschan
 * https://blueimp.net
 *
 * Licensed under the MIT license:
 * http://www.opensource.org/licenses/MIT
 */
function(factory){"use strict";"function"==typeof define&&define.amd?define(["jquery"],factory):factory(window.jQuery)}(function($){"use strict";var counter=0;$.ajaxTransport("iframe",function(options){if(options.async&&("POST"===options.type||"GET"===options.type)){var form,iframe;return{send:function(_,completeCallback){form=$('<form style="display:none;"></form>'),iframe=$('<iframe src="javascript:false;" name="iframe-transport-'+(counter+=1)+'"></iframe>').bind("load",function(){var fileInputClones,paramNames=$.isArray(options.paramName)?options.paramName:[options.paramName];iframe.unbind("load").bind("load",function(){var response;try{if(response=iframe.contents(),!response.length||!response[0].firstChild)throw new Error}catch(e){response=void 0}completeCallback(200,"success",{iframe:response}),$('<iframe src="javascript:false;"></iframe>').appendTo(form),form.remove()}),form.prop("target",iframe.prop("name")).prop("action",options.url).prop("method",options.type),options.formData&&$.each(options.formData,function(index,field){$('<input type="hidden"/>').prop("name",field.name).val(field.value).appendTo(form)}),options.fileInput&&options.fileInput.length&&"POST"===options.type&&(fileInputClones=options.fileInput.clone(),options.fileInput.after(function(index){return fileInputClones[index]}),options.paramName&&options.fileInput.each(function(index){$(this).prop("name",paramNames[index]||options.paramName)}),form.append(options.fileInput).prop("enctype","multipart/form-data").prop("encoding","multipart/form-data")),form.submit(),fileInputClones&&fileInputClones.length&&options.fileInput.each(function(index,input){var clone=$(fileInputClones[index]);$(input).prop("name",clone.prop("name")),clone.replaceWith(input)})}),form.append(iframe).appendTo(document.body)},abort:function(){iframe&&iframe.unbind("load").prop("src","javascript".concat(":false;")),form&&form.remove()}}}}),$.ajaxSetup({converters:{"iframe text":function(iframe){return $(iframe[0].body).text()},"iframe json":function(iframe){return $.parseJSON($(iframe[0].body).text())},"iframe html":function(iframe){return $(iframe[0].body).html()},"iframe script":function(iframe){return $.globalEval($(iframe[0].body).text())}}})}),/*! $.noUiSlider
 @version 5.0.0
 @author Leon Gersen https://twitter.com/LeonGersen
 @license WTFPL http://www.wtfpl.net/about/
 @documentation http://refreshless.com/nouislider/
*/
function($){"use strict";if($.zepto&&!$.fn.removeData)throw new ReferenceError("Zepto is loaded without the data module.");$.fn.noUiSlider=function(options,rebuild){function fromPercentage(range,value){return 100*value/(range[1]-range[0])}function toPercentage(range,value){return fromPercentage(range,range[0]<0?value+Math.abs(range[0]):value-range[0])}function isPercentage(range,value){return value*(range[1]-range[0])/100+range[0]}function isInstance(a){return a instanceof $||$.zepto&&$.zepto.isZ(a)}function isNumeric(a){return!isNaN(parseFloat(a))&&isFinite(a)}function call(functions,scope){$.isArray(functions)||(functions=[functions]),$.each(functions,function(){"function"==typeof this&&this.call(scope)})}function setN(target,number){return function(){var val=[null,null];val[number]=$(this).val(),target.val(val,!0)}}function closest(value,to){return Math.round(value/to)*to}function format(value,options){return value=value.toFixed(options.decimals),0===parseFloat(value)&&(value=value.replace("-0","0")),value.replace(".",options.serialization.mark)}function closestHandle(handles,location,style){if(1===handles.length)return handles[0];var total=handles[0].offset()[style]+handles[1].offset()[style];return handles[total/2>location?0:1]}function digits(value,round){return parseFloat(value.toFixed(round))}function fixEvent(e){e.preventDefault();var x,y,touch=0===e.type.indexOf("touch"),mouse=0===e.type.indexOf("mouse"),pointer=0===e.type.indexOf("pointer"),event=e;return 0===e.type.indexOf("MSPointer")&&(pointer=!0),e.originalEvent&&(e=e.originalEvent),touch&&(x=e.changedTouches[0].pageX,y=e.changedTouches[0].pageY),(mouse||pointer)&&(pointer||void 0!==window.pageXOffset||(window.pageXOffset=document.documentElement.scrollLeft,window.pageYOffset=document.documentElement.scrollTop),x=e.clientX+window.pageXOffset,y=e.clientY+window.pageYOffset),$.extend(event,{pointX:x,pointY:y,cursor:mouse})}function attach(events,element,callback,pass){var target=pass.target;return events=events.replace(/\s/g,namespace+" ")+namespace,element.on(events,function(e){var disabled=target.attr("disabled");return disabled=!(void 0===disabled||null===disabled),target.hasClass("noUi-state-tap")||disabled?!1:void callback(fixEvent(e),pass,target.data("base").data("options"))})}function serialize(a){var target=this.target;return void 0===a?this.element.data("value"):(a===!0?a=this.element.data("value"):this.element.data("value",a),void(void 0!==a&&$.each(this.elements,function(){"function"==typeof this?this.call(target,a):this[0][this[1]](a)})))}function storeElement(handle,item,number){if(isInstance(item)){var elements=[],target=handle.data("target");return handle.data("options").direction&&(number=number?0:1),item.each(function(){$(this).on("change"+namespace,setN(target,number)),elements.push([$(this),"val"])}),elements}return"string"==typeof item&&(item=[$('<input type="hidden" name="'+item+'">').appendTo(handle).addClass(clsList[3]).change(function(e){e.stopPropagation()}),"val"]),[item]}function store(handle,i,serialization){var elements=[];return $.each(serialization.to[i],function(index){elements=elements.concat(storeElement(handle,serialization.to[i][index],i))}),{element:handle,elements:elements,target:handle.data("target"),val:serialize}}function block(base,stateless){var target=base.data("target");target.hasClass(clsList[14])||(stateless||(target.addClass(clsList[15]),setTimeout(function(){target.removeClass(clsList[15])},450)),target.addClass(clsList[14]),call(base.data("options").block,target))}function placeHandle(handle,to){var settings=handle.data("options");to=digits(to,7),handle.data("target").removeClass(clsList[14]),handle.css(settings.style,to+"%").data("pct",to),handle.is(":first-child")&&handle.toggleClass(clsList[13],to>50),settings.direction&&(to=100-to),handle.data("store").val(format(isPercentage(settings.range,to),settings))}function setHandle(handle,to){var base=handle.data("base"),settings=base.data("options"),handles=base.data("handles"),lower=0,upper=100;return isNumeric(to)?(settings.step&&(to=closest(to,settings.step)),handles.length>1&&(handle[0]!==handles[0][0]?lower=digits(handles[0].data("pct")+settings.margin,7):upper=digits(handles[1].data("pct")-settings.margin,7)),to=Math.min(Math.max(to,lower),0>upper?100:upper),to===handle.data("pct")?[lower?lower:!1,100===upper?!1:upper]:(placeHandle(handle,to),!0)):!1}function jump(base,handle,to,callbacks){base.addClass(clsList[5]),setTimeout(function(){base.removeClass(clsList[5])},300),setHandle(handle,to),call(callbacks,base.data("target")),base.data("target").change()}function move(event,Dt,Op){var limits,handles=Dt.handles,proposal=event[Dt.point]-Dt.start[Dt.point];if(proposal=100*proposal/Dt.size,1===handles.length){if(limits=setHandle(handles[0],Dt.positions[0]+proposal),limits!==!0)return void($.inArray(handles[0].data("pct"),limits)>=0&&block(Dt.base,!Op.margin))}else{var l1,u1,l2,u2;if(Op.step&&(proposal=closest(proposal,Op.step)),l1=l2=Dt.positions[0]+proposal,u1=u2=Dt.positions[1]+proposal,0>l1?(u1+=-1*l1,l1=0):u1>100&&(l1-=u1-100,u1=100),0>l2&&!l1&&!handles[0].data("pct"))return;if(100===u1&&u2>100&&100===handles[1].data("pct"))return;placeHandle(handles[0],l1),placeHandle(handles[1],u1)}call(Op.slide,Dt.target)}function end(event,Dt,Op){1===Dt.handles.length&&Dt.handles[0].data("grab").removeClass(clsList[4]),event.cursor&&body.css("cursor","").off(namespace),doc.off(namespace),Dt.target.removeClass(clsList[14]+" "+clsList[20]).change(),call(Op.set,Dt.target)}function start(event,Dt,Op){1===Dt.handles.length&&Dt.handles[0].data("grab").addClass(clsList[4]),event.stopPropagation(),attach(actions.move,doc,move,{start:event,base:Dt.base,target:Dt.target,handles:Dt.handles,positions:[Dt.handles[0].data("pct"),Dt.handles[Dt.handles.length-1].data("pct")],point:Op.orientation?"pointY":"pointX",size:Op.orientation?Dt.base.height():Dt.base.width()}),attach(actions.end,doc,end,{target:Dt.target,handles:Dt.handles}),event.cursor&&(body.css("cursor",$(event.target).css("cursor")),Dt.handles.length>1&&Dt.target.addClass(clsList[20]),body.on("selectstart"+namespace,function(){return!1}))}function tap(event,Dt,Op){var handle,to,point,size,base=Dt.base;event.stopPropagation(),Op.orientation?(point=event.pointY,size=base.height()):(point=event.pointX,size=base.width()),handle=closestHandle(base.data("handles"),point,Op.style),to=100*(point-base.offset()[Op.style])/size,jump(base,handle,to,[Op.slide,Op.set])}function edge(event,Dt,Op){var to,i,handles=Dt.base.data("handles");i=Op.orientation?event.pointY:event.pointX,i=i<Dt.base.offset()[Op.style],to=i?0:100,i=i?0:handles.length-1,jump(Dt.base,handles[i],to,[Op.slide,Op.set])}function test(input,sliders){function values(a){return 2!==a.length?!1:(a=[parseFloat(a[0]),parseFloat(a[1])],isNumeric(a[0])&&isNumeric(a[1])?a[1]<a[0]?!1:a:!1)}var serialization={resolution:function(q,o){switch(q){case 1:case.1:case.01:case.001:case 1e-4:case 1e-5:q=q.toString().split("."),o.decimals="1"===q[0]?0:q[1].length;break;case void 0:o.decimals=2;break;default:return!1}return!0},mark:function(q,o,w){if(!q)return o[w].mark=".",!0;switch(q){case".":case",":return!0;default:return!1}},to:function(q,o,w){function ser(r){return isInstance(r)||"string"==typeof r||"function"==typeof r||r===!1||isInstance(r[0])&&"function"==typeof r[0][r[1]]}function filter(value){var items=[[],[]];return ser(value)?items[0].push(value):$.each(value,function(i,val){i>1||(ser(val)?items[i].push(val):items[i]=items[i].concat(val))}),items}if(q){var i,j;for(q=filter(q),o.direction&&q[1].length&&q.reverse(),i=0;i<o.handles;i++)for(j=0;j<q[i].length;j++){if(!ser(q[i][j]))return!1;q[i][j]||q[i].splice(j,1)}o[w].to=q}else o[w].to=[[],[]];return!0}},tests={handles:{r:!0,t:function(q){return q=parseInt(q,10),1===q||2===q}},range:{r:!0,t:function(q,o,w){return o[w]=values(q),o[w]&&o[w][0]!==o[w][1]}},start:{r:!0,t:function(q,o,w){return 1===o.handles?($.isArray(q)&&(q=q[0]),q=parseFloat(q),o.start=[q],isNumeric(q)):(o[w]=values(q),!!o[w])}},connect:{r:!0,t:function(q,o,w){if("lower"===q)o[w]=1;else if("upper"===q)o[w]=2;else if(q===!0)o[w]=3;else{if(q!==!1)return!1;o[w]=0}return!0}},orientation:{t:function(q,o,w){switch(q){case"horizontal":o[w]=0;break;case"vertical":o[w]=1;break;default:return!1}return!0}},margin:{r:!0,t:function(q,o,w){return q=parseFloat(q),o[w]=fromPercentage(o.range,q),isNumeric(q)}},direction:{r:!0,t:function(q,o,w){switch(q){case"ltr":o[w]=0;break;case"rtl":o[w]=1,o.connect=[0,2,1,3][o.connect];break;default:return!1}return!0}},behaviour:{r:!0,t:function(q,o,w){return o[w]={tap:q!==(q=q.replace("tap","")),extend:q!==(q=q.replace("extend","")),drag:q!==(q=q.replace("drag","")),fixed:q!==(q=q.replace("fixed",""))},!q.replace("none","").replace(/\-/g,"")}},serialization:{r:!0,t:function(q,o,w){return serialization.to(q.to,o,w)&&serialization.resolution(q.resolution,o)&&serialization.mark(q.mark,o,w)}},slide:{t:function(q){return $.isFunction(q)}},set:{t:function(q){return $.isFunction(q)}},block:{t:function(q){return $.isFunction(q)}},step:{t:function(q,o,w){return q=parseFloat(q),o[w]=fromPercentage(o.range,q),isNumeric(q)}}};$.each(tests,function(name,test){var value=input[name],isSet=void 0!==value;if(test.r&&!isSet||isSet&&!test.t(value,input,name))throw console&&console.log&&console.group&&(console.group("Invalid noUiSlider initialisation:"),console.log("Option:	",name),console.log("Value:	",value),console.log("Slider(s):	",sliders),console.groupEnd()),new RangeError("noUiSlider")})}function create(options){return this.data("options",$.extend(!0,{},options)),options=$.extend({handles:2,margin:0,connect:!1,direction:"ltr",behaviour:"tap",orientation:"horizontal"},options),options.serialization=options.serialization||{},test(options,this),options.style=options.orientation?"top":"left",this.each(function(){var i,dragable,handle,target=$(this),handles=[],base=$("<div/>").appendTo(target);if(target.data("base"))throw new Error("Slider was already initialized.");for(target.data("base",base).addClass([clsList[6],clsList[16+options.direction],clsList[10+options.orientation]].join(" ")),i=0;i<options.handles;i++)handle=$("<div><div/></div>").appendTo(base),handle.addClass(clsList[1]),handle.children().addClass([clsList[2],clsList[2]+clsList[7+options.direction+(options.direction?-1*i:i)]].join(" ")),handle.data({base:base,target:target,options:options,grab:handle.children(),pct:-1}).attr("data-style",options.style),handle.data({store:store(handle,i,options.serialization)}),handles.push(handle);switch(options.connect){case 1:target.addClass(clsList[9]),handles[0].addClass(clsList[12]);break;case 3:handles[1].addClass(clsList[12]);case 2:handles[0].addClass(clsList[9]);case 0:target.addClass(clsList[12])}if(base.addClass(clsList[0]).data({target:target,options:options,handles:handles}),target.val(options.start),!options.behaviour.fixed)for(i=0;i<handles.length;i++)attach(actions.start,handles[i].children(),start,{base:base,target:target,handles:[handles[i]]});options.behaviour.tap&&attach(actions.start,base,tap,{base:base,target:target}),options.behaviour.extend&&(target.addClass(clsList[19]),options.behaviour.tap&&attach(actions.start,target,edge,{base:base,target:target})),options.behaviour.drag&&(dragable=base.find("."+clsList[9]).addClass(clsList[18]),options.behaviour.fixed&&(dragable=dragable.add(base.children().not(dragable).data("grab"))),attach(actions.start,dragable,start,{base:base,target:target,handles:handles}))})}function getValue(){var base=$(this).data("base"),answer=[];return $.each(base.data("handles"),function(){answer.push($(this).data("store").val())}),1===answer.length?answer[0]:base.data("options").direction?answer.reverse():answer}function setValue(args,set){return $.isArray(args)||(args=[args]),this.each(function(){var to,i,b=$(this).data("base"),handles=Array.prototype.slice.call(b.data("handles"),0),settings=b.data("options");for(handles.length>1&&(handles[2]=handles[0]),settings.direction&&args.reverse(),i=0;i<handles.length;i++)to=args[i%2],null!==to&&void 0!==to&&("string"===$.type(to)&&(to=to.replace(",",".")),to=toPercentage(settings.range,parseFloat(to)),settings.direction&&(to=100-to),setHandle(handles[i],to)!==!0&&handles[i].data("store").val(!0),set===!0&&call(settings.set,$(this)))})}function destroy(target){var elements=[[target,""]];$.each(target.data("base").data("handles"),function(){elements=elements.concat($(this).data("store").elements)}),$.each(elements,function(){this.length>1&&this[0].off(namespace)}),target.removeClass(clsList.join(" ")),target.empty().removeData("base options")}function build(options){return this.each(function(){var values=$(this).val()||!1,current=$(this).data("options"),setup=$.extend({},current,options);values!==!1&&destroy($(this)),options&&($(this).noUiSlider(setup),values!==!1&&setup.start===current.start&&$(this).val(values))})}var doc=$(document),body=$("body"),namespace=".nui",$VAL=$.fn.val,clsList=["noUi-base","noUi-origin","noUi-handle","noUi-input","noUi-active","noUi-state-tap","noUi-target","-lower","-upper","noUi-connect","noUi-horizontal","noUi-vertical","noUi-background","noUi-stacking","noUi-block","noUi-state-blocked","noUi-ltr","noUi-rtl","noUi-dragable","noUi-extended","noUi-state-drag"],actions=window.navigator.pointerEnabled?{start:"pointerdown",move:"pointermove",end:"pointerup"}:window.navigator.msPointerEnabled?{start:"MSPointerDown",move:"MSPointerMove",end:"MSPointerUp"}:{start:"mousedown touchstart",move:"mousemove touchmove",end:"mouseup touchend"};return $.fn.val=function(){return this.hasClass(clsList[6])?arguments.length?setValue.apply(this,arguments):getValue.apply(this):$VAL.apply(this,arguments)},(rebuild?build:create).call(this,options)}}(window.jQuery||window.Zepto),function(f){function l(g,h){function d(a){e||(e=!0,c.start&&c.start(a,b))}function i(a,j){e&&(clearTimeout(k),k=setTimeout(function(){e=!1,c.stop&&c.stop(a,b)},j>=0?j:c.delay))}var k,c=f.extend({start:null,stop:null,delay:400},h),b=f(g),e=!1;b.keypress(d),b.keydown(function(a){(8===a.keyCode||46===a.keyCode)&&d(a)}),b.keyup(i),b.blur(function(a){i(a,0)})}f.fn.typing=function(g){return this.each(function(h,d){l(d,g)})}}(jQuery),function(factory){"function"==typeof define&&define.amd?define(factory):window.purl=factory()}(function(){function parseUri(url,strictMode){for(var str=decodeURI(url),res=parser[strictMode?"strict":"loose"].exec(str),uri={attr:{},param:{},seg:{}},i=14;i--;)uri.attr[key[i]]=res[i]||"";return uri.param.query=parseString(uri.attr.query),uri.param.fragment=parseString(uri.attr.fragment),uri.seg.path=uri.attr.path.replace(/^\/+|\/+$/g,"").split("/"),uri.seg.fragment=uri.attr.fragment.replace(/^\/+|\/+$/g,"").split("/"),uri.attr.base=uri.attr.host?(uri.attr.protocol?uri.attr.protocol+"://"+uri.attr.host:uri.attr.host)+(uri.attr.port?":"+uri.attr.port:""):"",uri}function getAttrName(elm){var tn=elm.tagName;return"undefined"!=typeof tn?tag2attr[tn.toLowerCase()]:tn}function promote(parent,key){if(0===parent[key].length)return parent[key]={};var t={};for(var i in parent[key])t[i]=parent[key][i];return parent[key]=t,t}function parse(parts,parent,key,val){var part=parts.shift();if(part){var obj=parent[key]=parent[key]||[];"]"==part?isArray(obj)?""!==val&&obj.push(val):"object"==typeof obj?obj[keys(obj).length]=val:obj=parent[key]=[parent[key],val]:~part.indexOf("]")?(part=part.substr(0,part.length-1),!isint.test(part)&&isArray(obj)&&(obj=promote(parent,key)),parse(parts,obj,part,val)):(!isint.test(part)&&isArray(obj)&&(obj=promote(parent,key)),parse(parts,obj,part,val))}else isArray(parent[key])?parent[key].push(val):"object"==typeof parent[key]?parent[key]=val:"undefined"==typeof parent[key]?parent[key]=val:parent[key]=[parent[key],val]}function merge(parent,key,val){if(~key.indexOf("]")){var parts=key.split("[");parse(parts,parent,"base",val)}else{if(!isint.test(key)&&isArray(parent.base)){var t={};for(var k in parent.base)t[k]=parent.base[k];parent.base=t}""!==key&&set(parent.base,key,val)}return parent}function parseString(str){return reduce(String(str).split(/&|;/),function(ret,pair){try{pair=decodeURIComponent(pair.replace(/\+/g," "))}catch(e){}var eql=pair.indexOf("="),brace=lastBraceInKey(pair),key=pair.substr(0,brace||eql),val=pair.substr(brace||eql,pair.length);return val=val.substr(val.indexOf("=")+1,val.length),""===key&&(key=pair,val=""),merge(ret,key,val)},{base:{}}).base}function set(obj,key,val){var v=obj[key];"undefined"==typeof v?obj[key]=val:isArray(v)?v.push(val):obj[key]=[v,val]}function lastBraceInKey(str){for(var brace,c,len=str.length,i=0;len>i;++i)if(c=str[i],"]"==c&&(brace=!1),"["==c&&(brace=!0),"="==c&&!brace)return i}function reduce(obj,accumulator){for(var i=0,l=obj.length>>0,curr=arguments[2];l>i;)i in obj&&(curr=accumulator.call(void 0,curr,obj[i],i,obj)),++i;return curr}function isArray(vArg){return"[object Array]"===Object.prototype.toString.call(vArg)}function keys(obj){var key_array=[];for(var prop in obj)obj.hasOwnProperty(prop)&&key_array.push(prop);return key_array}function purl(url,strictMode){return 1===arguments.length&&url===!0&&(strictMode=!0,url=void 0),strictMode=strictMode||!1,url=url||window.location.toString(),{data:parseUri(url,strictMode),attr:function(attr){return attr=aliases[attr]||attr,"undefined"!=typeof attr?this.data.attr[attr]:this.data.attr},param:function(param){return"undefined"!=typeof param?this.data.param.query[param]:this.data.param.query},fparam:function(param){return"undefined"!=typeof param?this.data.param.fragment[param]:this.data.param.fragment},segment:function(seg){return"undefined"==typeof seg?this.data.seg.path:(seg=0>seg?this.data.seg.path.length+seg:seg-1,this.data.seg.path[seg])},fsegment:function(seg){return"undefined"==typeof seg?this.data.seg.fragment:(seg=0>seg?this.data.seg.fragment.length+seg:seg-1,this.data.seg.fragment[seg])}}}var tag2attr={a:"href",img:"src",form:"action",base:"href",script:"src",iframe:"src",link:"href",embed:"src",object:"data"},key=["source","protocol","authority","userInfo","user","password","host","port","relative","path","directory","file","query","fragment"],aliases={anchor:"fragment"},parser={strict:/^(?:([^:\/?#]+):)?(?:\/\/((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?))?((((?:[^?#\/]*\/)*)([^?#]*))(?:\?([^#]*))?(?:#(.*))?)/,loose:/^(?:(?![^:@]+:[^:@\/]*@)([^:\/?#.]+):)?(?:\/\/)?((?:(([^:@]*):?([^:@]*))?@)?([^:\/?#]*)(?::(\d*))?)(((\/(?:[^?#](?![^?#\/]*\.[^?#\/.]+(?:[?#]|$)))*\/?)?([^?#\/]*))(?:\?([^#]*))?(?:#(.*))?)/},isint=/^[0-9]+$/;return purl.jQuery=function($){null!=$&&($.fn.url=function(strictMode){var url="";return this.length&&(url=$(this).attr(getAttrName(this[0]))||""),purl(url,strictMode)},$.url=purl)},purl.jQuery(window.jQuery),purl}),function(){var a;a={},a=function(){function a(a){var b,c;a&&(this.awayTimeout=parseInt(a.awayTimeout,10),this.onAway=a.onAway,this.onAwayBack=a.onAwayBack,this.onVisible=a.onVisible,this.onHidden=a.onHidden),c=this,b=function(){return c.onActive()},window.onclick=b,window.onmousemove=b,window.onmouseenter=b,window.onkeydown=b,window.onscroll=b,window.onmousewheel=b,this.startAwayTimeout(),document.addEventListener("visibilitychange",function(){return c.handleVisibilityChange()},!1),document.addEventListener("webkitvisibilitychange",function(){return c.handleVisibilityChange()},!1),document.addEventListener("msvisibilitychange",function(){return c.handleVisibilityChange()},!1)}return a.isAway=!1,a.awayTimeout=3e3,a.awayTimestamp=0,a.awayTimer=null,a.onAway=null,a.onAwayBack=null,a.onVisible=null,a.onHidden=null,a.prototype.onActive=function(){return this.awayTimestamp=(new Date).getTime()+this.awayTimeout,this.isAway&&(this.onAwayBack&&this.onAwayBack(),this.startAwayTimeout()),this.isAway=!1,!0},a.prototype.startAwayTimeout=function(){var a;return this.awayTimestamp=(new Date).getTime()+this.awayTimeout,null!==this.awayTimer&&clearTimeout(this.awayTimer),a=this,this.awayTimer=setTimeout(function(){return a.checkAway()},this.awayTimeout+100)},a.prototype.setAwayTimeout=function(a){return this.awayTimeout=parseInt(a,10),this.startAwayTimeout()},a.prototype.checkAway=function(){var a,b;if(b=(new Date).getTime(),b<this.awayTimestamp)this.isAway=!1,a=this,this.awayTimer=setTimeout(function(){return a.checkAway()},this.awayTimestamp-b+100);else if(null!==this.awayTimer&&clearTimeout(this.awayTimer),this.isAway=!0,this.onAway)return this.onAway()},a.prototype.handleVisibilityChange=function(){if(document.hidden||document.msHidden||document.webkitHidden){if(this.onHidden)return this.onHidden()}else if(this.onVisible)return this.onVisible()},a}(),window.Idle=a}.call(this),function(){function baseCompareAscending(value,other){if(value!==other){var valIsReflexive=value===value,othIsReflexive=other===other;if(value>other||!valIsReflexive||value===undefined&&othIsReflexive)return 1;if(other>value||!othIsReflexive||other===undefined&&valIsReflexive)return-1}return 0}function baseFindIndex(array,predicate,fromRight){for(var length=array.length,index=fromRight?length:-1;fromRight?index--:++index<length;)if(predicate(array[index],index,array))return index;return-1}function baseIndexOf(array,value,fromIndex){if(value!==value)return indexOfNaN(array,fromIndex);for(var index=fromIndex-1,length=array.length;++index<length;)if(array[index]===value)return index;return-1}function baseIsFunction(value){return"function"==typeof value||!1}function baseToString(value){return"string"==typeof value?value:null==value?"":value+""}function charAtCallback(string){return string.charCodeAt(0)}function charsLeftIndex(string,chars){for(var index=-1,length=string.length;++index<length&&chars.indexOf(string.charAt(index))>-1;);return index}function charsRightIndex(string,chars){for(var index=string.length;index--&&chars.indexOf(string.charAt(index))>-1;);return index}function compareAscending(object,other){return baseCompareAscending(object.criteria,other.criteria)||object.index-other.index}function compareMultiple(object,other,orders){for(var index=-1,objCriteria=object.criteria,othCriteria=other.criteria,length=objCriteria.length,ordersLength=orders.length;++index<length;){var result=baseCompareAscending(objCriteria[index],othCriteria[index]);if(result)return index>=ordersLength?result:result*(orders[index]?1:-1)}return object.index-other.index}function deburrLetter(letter){return deburredLetters[letter]}function escapeHtmlChar(chr){return htmlEscapes[chr]}function escapeStringChar(chr){return"\\"+stringEscapes[chr]}function indexOfNaN(array,fromIndex,fromRight){for(var length=array.length,index=fromIndex+(fromRight?0:-1);fromRight?index--:++index<length;){var other=array[index];if(other!==other)return index}return-1}function isObjectLike(value){return!!value&&"object"==typeof value}function isSpace(charCode){return 160>=charCode&&charCode>=9&&13>=charCode||32==charCode||160==charCode||5760==charCode||6158==charCode||charCode>=8192&&(8202>=charCode||8232==charCode||8233==charCode||8239==charCode||8287==charCode||12288==charCode||65279==charCode)}function replaceHolders(array,placeholder){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;)array[index]===placeholder&&(array[index]=PLACEHOLDER,result[++resIndex]=index);return result}function sortedUniq(array,iteratee){for(var seen,index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;index&&seen===computed||(seen=computed,result[++resIndex]=value)}return result}function trimmedLeftIndex(string){for(var index=-1,length=string.length;++index<length&&isSpace(string.charCodeAt(index)););return index}function trimmedRightIndex(string){for(var index=string.length;index--&&isSpace(string.charCodeAt(index)););return index}function unescapeHtmlChar(chr){return htmlUnescapes[chr]}function runInContext(context){function lodash(value){if(isObjectLike(value)&&!isArray(value)&&!(value instanceof LazyWrapper)){if(value instanceof LodashWrapper)return value;if(hasOwnProperty.call(value,"__chain__")&&hasOwnProperty.call(value,"__wrapped__"))return wrapperClone(value)}return new LodashWrapper(value)}function baseLodash(){}function LodashWrapper(value,chainAll,actions){this.__wrapped__=value,this.__actions__=actions||[],this.__chain__=!!chainAll}function LazyWrapper(value){this.__wrapped__=value,this.__actions__=null,this.__dir__=1,this.__dropCount__=0,this.__filtered__=!1,this.__iteratees__=null,this.__takeCount__=POSITIVE_INFINITY,this.__views__=null}function lazyClone(){var actions=this.__actions__,iteratees=this.__iteratees__,views=this.__views__,result=new LazyWrapper(this.__wrapped__);return result.__actions__=actions?arrayCopy(actions):null,result.__dir__=this.__dir__,result.__filtered__=this.__filtered__,result.__iteratees__=iteratees?arrayCopy(iteratees):null,result.__takeCount__=this.__takeCount__,result.__views__=views?arrayCopy(views):null,result}function lazyReverse(){if(this.__filtered__){var result=new LazyWrapper(this);result.__dir__=-1,result.__filtered__=!0}else result=this.clone(),result.__dir__*=-1;return result}function lazyValue(){var array=this.__wrapped__.value();if(!isArray(array))return baseWrapperValue(array,this.__actions__);var dir=this.__dir__,isRight=0>dir,view=getView(0,array.length,this.__views__),start=view.start,end=view.end,length=end-start,index=isRight?end:start-1,takeCount=nativeMin(length,this.__takeCount__),iteratees=this.__iteratees__,iterLength=iteratees?iteratees.length:0,resIndex=0,result=[];outer:for(;length--&&takeCount>resIndex;){index+=dir;for(var iterIndex=-1,value=array[index];++iterIndex<iterLength;){var data=iteratees[iterIndex],iteratee=data.iteratee,type=data.type;if(type==LAZY_DROP_WHILE_FLAG){if(data.done&&(isRight?index>data.index:index<data.index)&&(data.count=0,data.done=!1),data.index=index,!data.done){var limit=data.limit;if(!(data.done=limit>-1?data.count++>=limit:!iteratee(value)))continue outer}}else{var computed=iteratee(value);if(type==LAZY_MAP_FLAG)value=computed;else if(!computed){if(type==LAZY_FILTER_FLAG)continue outer;break outer}}}result[resIndex++]=value}return result}function MapCache(){this.__data__={}}function mapDelete(key){return this.has(key)&&delete this.__data__[key]}function mapGet(key){return"__proto__"==key?undefined:this.__data__[key]}function mapHas(key){return"__proto__"!=key&&hasOwnProperty.call(this.__data__,key)}function mapSet(key,value){return"__proto__"!=key&&(this.__data__[key]=value),this}function SetCache(values){var length=values?values.length:0;for(this.data={hash:nativeCreate(null),set:new Set};length--;)this.push(values[length])}function cacheIndexOf(cache,value){var data=cache.data,result="string"==typeof value||isObject(value)?data.set.has(value):data.hash[value];return result?0:-1}function cachePush(value){var data=this.data;"string"==typeof value||isObject(value)?data.set.add(value):data.hash[value]=!0}function arrayCopy(source,array){var index=-1,length=source.length;for(array||(array=Array(length));++index<length;)array[index]=source[index];return array}function arrayEach(array,iteratee){for(var index=-1,length=array.length;++index<length&&iteratee(array[index],index,array)!==!1;);return array}function arrayEachRight(array,iteratee){for(var length=array.length;length--&&iteratee(array[length],length,array)!==!1;);return array}function arrayEvery(array,predicate){for(var index=-1,length=array.length;++index<length;)if(!predicate(array[index],index,array))return!1;return!0}function arrayFilter(array,predicate){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];predicate(value,index,array)&&(result[++resIndex]=value)}return result}function arrayMap(array,iteratee){for(var index=-1,length=array.length,result=Array(length);++index<length;)result[index]=iteratee(array[index],index,array);return result}function arrayMax(array){for(var index=-1,length=array.length,result=NEGATIVE_INFINITY;++index<length;){var value=array[index];value>result&&(result=value)}return result}function arrayMin(array){for(var index=-1,length=array.length,result=POSITIVE_INFINITY;++index<length;){var value=array[index];result>value&&(result=value)}return result}function arrayReduce(array,iteratee,accumulator,initFromArray){var index=-1,length=array.length;for(initFromArray&&length&&(accumulator=array[++index]);++index<length;)accumulator=iteratee(accumulator,array[index],index,array);return accumulator}function arrayReduceRight(array,iteratee,accumulator,initFromArray){var length=array.length;for(initFromArray&&length&&(accumulator=array[--length]);length--;)accumulator=iteratee(accumulator,array[length],length,array);return accumulator}function arraySome(array,predicate){for(var index=-1,length=array.length;++index<length;)if(predicate(array[index],index,array))return!0;return!1}function arraySum(array){for(var length=array.length,result=0;length--;)result+=+array[length]||0;return result}function assignDefaults(objectValue,sourceValue){return objectValue===undefined?sourceValue:objectValue}function assignOwnDefaults(objectValue,sourceValue,key,object){return objectValue!==undefined&&hasOwnProperty.call(object,key)?objectValue:sourceValue}function assignWith(object,source,customizer){var props=keys(source);push.apply(props,getSymbols(source));for(var index=-1,length=props.length;++index<length;){var key=props[index],value=object[key],result=customizer(value,source[key],key,object,source);(result===result?result===value:value!==value)&&(value!==undefined||key in object)||(object[key]=result)}return object}function baseAt(collection,props){for(var index=-1,isNil=null==collection,isArr=!isNil&&isArrayLike(collection),length=isArr&&collection.length,propsLength=props.length,result=Array(propsLength);++index<propsLength;){var key=props[index];isArr?result[index]=isIndex(key,length)?collection[key]:undefined:result[index]=isNil?undefined:collection[key]}return result}function baseCopy(source,props,object){object||(object={});for(var index=-1,length=props.length;++index<length;){var key=props[index];object[key]=source[key]}return object}function baseCallback(func,thisArg,argCount){var type=typeof func;return"function"==type?thisArg===undefined?func:bindCallback(func,thisArg,argCount):null==func?identity:"object"==type?baseMatches(func):thisArg===undefined?property(func):baseMatchesProperty(func,thisArg)}function baseClone(value,isDeep,customizer,key,object,stackA,stackB){var result;if(customizer&&(result=object?customizer(value,key,object):customizer(value)),result!==undefined)return result;if(!isObject(value))return value;var isArr=isArray(value);if(isArr){if(result=initCloneArray(value),!isDeep)return arrayCopy(value,result)}else{var tag=objToString.call(value),isFunc=tag==funcTag;if(tag!=objectTag&&tag!=argsTag&&(!isFunc||object))return cloneableTags[tag]?initCloneByTag(value,tag,isDeep):object?value:{};if(result=initCloneObject(isFunc?{}:value),!isDeep)return baseAssign(result,value)}stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==value)return stackB[length];return stackA.push(value),stackB.push(result),(isArr?arrayEach:baseForOwn)(value,function(subValue,key){result[key]=baseClone(subValue,isDeep,customizer,key,value,stackA,stackB)}),result}function baseDelay(func,wait,args){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return setTimeout(function(){func.apply(undefined,args)},wait)}function baseDifference(array,values){var length=array?array.length:0,result=[];if(!length)return result;var index=-1,indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,cache=isCommon&&values.length>=200?createCache(values):null,valuesLength=values.length;cache&&(indexOf=cacheIndexOf,isCommon=!1,values=cache);outer:for(;++index<length;){var value=array[index];if(isCommon&&value===value){for(var valuesIndex=valuesLength;valuesIndex--;)if(values[valuesIndex]===value)continue outer;result.push(value)}else indexOf(values,value,0)<0&&result.push(value)}return result}function baseEvery(collection,predicate){var result=!0;return baseEach(collection,function(value,index,collection){return result=!!predicate(value,index,collection)}),result}function baseFill(array,value,start,end){var length=array.length;for(start=null==start?0:+start||0,0>start&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:+end||0,0>end&&(end+=length),length=start>end?0:end>>>0,start>>>=0;length>start;)array[start++]=value;return array}function baseFilter(collection,predicate){var result=[];return baseEach(collection,function(value,index,collection){predicate(value,index,collection)&&result.push(value)}),result}function baseFind(collection,predicate,eachFunc,retKey){var result;return eachFunc(collection,function(value,key,collection){
return predicate(value,key,collection)?(result=retKey?key:value,!1):void 0}),result}function baseFlatten(array,isDeep,isStrict){for(var index=-1,length=array.length,resIndex=-1,result=[];++index<length;){var value=array[index];if(isObjectLike(value)&&isArrayLike(value)&&(isStrict||isArray(value)||isArguments(value))){isDeep&&(value=baseFlatten(value,isDeep,isStrict));for(var valIndex=-1,valLength=value.length;++valIndex<valLength;)result[++resIndex]=value[valIndex]}else isStrict||(result[++resIndex]=value)}return result}function baseForIn(object,iteratee){return baseFor(object,iteratee,keysIn)}function baseForOwn(object,iteratee){return baseFor(object,iteratee,keys)}function baseForOwnRight(object,iteratee){return baseForRight(object,iteratee,keys)}function baseFunctions(object,props){for(var index=-1,length=props.length,resIndex=-1,result=[];++index<length;){var key=props[index];isFunction(object[key])&&(result[++resIndex]=key)}return result}function baseGet(object,path,pathKey){if(null!=object){pathKey!==undefined&&pathKey in toObject(object)&&(path=[pathKey]);for(var index=-1,length=path.length;null!=object&&++index<length;)object=object[path[index]];return index&&index==length?object:undefined}}function baseIsEqual(value,other,customizer,isLoose,stackA,stackB){if(value===other)return!0;var valType=typeof value,othType=typeof other;return"function"!=valType&&"object"!=valType&&"function"!=othType&&"object"!=othType||null==value||null==other?value!==value&&other!==other:baseIsEqualDeep(value,other,baseIsEqual,customizer,isLoose,stackA,stackB)}function baseIsEqualDeep(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objIsArr=isArray(object),othIsArr=isArray(other),objTag=arrayTag,othTag=arrayTag;objIsArr||(objTag=objToString.call(object),objTag==argsTag?objTag=objectTag:objTag!=objectTag&&(objIsArr=isTypedArray(object))),othIsArr||(othTag=objToString.call(other),othTag==argsTag?othTag=objectTag:othTag!=objectTag&&(othIsArr=isTypedArray(other)));var objIsObj=objTag==objectTag,othIsObj=othTag==objectTag,isSameTag=objTag==othTag;if(isSameTag&&!objIsArr&&!objIsObj)return equalByTag(object,other,objTag);if(!isLoose){var valWrapped=objIsObj&&hasOwnProperty.call(object,"__wrapped__"),othWrapped=othIsObj&&hasOwnProperty.call(other,"__wrapped__");if(valWrapped||othWrapped)return equalFunc(valWrapped?object.value():object,othWrapped?other.value():other,customizer,isLoose,stackA,stackB)}if(!isSameTag)return!1;stackA||(stackA=[]),stackB||(stackB=[]);for(var length=stackA.length;length--;)if(stackA[length]==object)return stackB[length]==other;stackA.push(object),stackB.push(other);var result=(objIsArr?equalArrays:equalObjects)(object,other,equalFunc,customizer,isLoose,stackA,stackB);return stackA.pop(),stackB.pop(),result}function baseIsMatch(object,props,values,strictCompareFlags,customizer){for(var index=-1,length=props.length,noCustomizer=!customizer;++index<length;)if(noCustomizer&&strictCompareFlags[index]?values[index]!==object[props[index]]:!(props[index]in object))return!1;for(index=-1;++index<length;){var key=props[index],objValue=object[key],srcValue=values[index];if(noCustomizer&&strictCompareFlags[index])var result=objValue!==undefined||key in object;else result=customizer?customizer(objValue,srcValue,key):undefined,result===undefined&&(result=baseIsEqual(srcValue,objValue,customizer,!0));if(!result)return!1}return!0}function baseMap(collection,iteratee){var index=-1,result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value,key,collection){result[++index]=iteratee(value,key,collection)}),result}function baseMatches(source){var props=keys(source),length=props.length;if(!length)return constant(!0);if(1==length){var key=props[0],value=source[key];if(isStrictComparable(value))return function(object){return null==object?!1:object[key]===value&&(value!==undefined||key in toObject(object))}}for(var values=Array(length),strictCompareFlags=Array(length);length--;)value=source[props[length]],values[length]=value,strictCompareFlags[length]=isStrictComparable(value);return function(object){return null!=object&&baseIsMatch(toObject(object),props,values,strictCompareFlags)}}function baseMatchesProperty(path,value){var isArr=isArray(path),isCommon=isKey(path)&&isStrictComparable(value),pathKey=path+"";return path=toPath(path),function(object){if(null==object)return!1;var key=pathKey;if(object=toObject(object),(isArr||!isCommon)&&!(key in object)){if(object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),null==object)return!1;key=last(path),object=toObject(object)}return object[key]===value?value!==undefined||key in object:baseIsEqual(value,object[key],null,!0)}}function baseMerge(object,source,customizer,stackA,stackB){if(!isObject(object))return object;var isSrcArr=isArrayLike(source)&&(isArray(source)||isTypedArray(source));if(!isSrcArr){var props=keys(source);push.apply(props,getSymbols(source))}return arrayEach(props||source,function(srcValue,key){if(props&&(key=srcValue,srcValue=source[key]),isObjectLike(srcValue))stackA||(stackA=[]),stackB||(stackB=[]),baseMergeDeep(object,source,key,baseMerge,customizer,stackA,stackB);else{var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;isCommon&&(result=srcValue),!isSrcArr&&result===undefined||!isCommon&&(result===result?result===value:value!==value)||(object[key]=result)}}),object}function baseMergeDeep(object,source,key,mergeFunc,customizer,stackA,stackB){for(var length=stackA.length,srcValue=source[key];length--;)if(stackA[length]==srcValue)return void(object[key]=stackB[length]);var value=object[key],result=customizer?customizer(value,srcValue,key,object,source):undefined,isCommon=result===undefined;isCommon&&(result=srcValue,isArrayLike(srcValue)&&(isArray(srcValue)||isTypedArray(srcValue))?result=isArray(value)?value:isArrayLike(value)?arrayCopy(value):[]:isPlainObject(srcValue)||isArguments(srcValue)?result=isArguments(value)?toPlainObject(value):isPlainObject(value)?value:{}:isCommon=!1),stackA.push(srcValue),stackB.push(result),isCommon?object[key]=mergeFunc(result,srcValue,customizer,stackA,stackB):(result===result?result!==value:value===value)&&(object[key]=result)}function baseProperty(key){return function(object){return null==object?undefined:object[key]}}function basePropertyDeep(path){var pathKey=path+"";return path=toPath(path),function(object){return baseGet(object,path,pathKey)}}function basePullAt(array,indexes){for(var length=array?indexes.length:0;length--;){var index=parseFloat(indexes[length]);if(index!=previous&&isIndex(index)){var previous=index;splice.call(array,index,1)}}return array}function baseRandom(min,max){return min+floor(nativeRandom()*(max-min+1))}function baseReduce(collection,iteratee,accumulator,initFromCollection,eachFunc){return eachFunc(collection,function(value,index,collection){accumulator=initFromCollection?(initFromCollection=!1,value):iteratee(accumulator,value,index,collection)}),accumulator}function baseSlice(array,start,end){var index=-1,length=array.length;start=null==start?0:+start||0,0>start&&(start=-start>length?0:length+start),end=end===undefined||end>length?length:+end||0,0>end&&(end+=length),length=start>end?0:end-start>>>0,start>>>=0;for(var result=Array(length);++index<length;)result[index]=array[index+start];return result}function baseSome(collection,predicate){var result;return baseEach(collection,function(value,index,collection){return result=predicate(value,index,collection),!result}),!!result}function baseSortBy(array,comparer){var length=array.length;for(array.sort(comparer);length--;)array[length]=array[length].value;return array}function baseSortByOrder(collection,iteratees,orders){var callback=getCallback(),index=-1;iteratees=arrayMap(iteratees,function(iteratee){return callback(iteratee)});var result=baseMap(collection,function(value){var criteria=arrayMap(iteratees,function(iteratee){return iteratee(value)});return{criteria:criteria,index:++index,value:value}});return baseSortBy(result,function(object,other){return compareMultiple(object,other,orders)})}function baseSum(collection,iteratee){var result=0;return baseEach(collection,function(value,index,collection){result+=+iteratee(value,index,collection)||0}),result}function baseUniq(array,iteratee){var index=-1,indexOf=getIndexOf(),length=array.length,isCommon=indexOf==baseIndexOf,isLarge=isCommon&&length>=200,seen=isLarge?createCache():null,result=[];seen?(indexOf=cacheIndexOf,isCommon=!1):(isLarge=!1,seen=iteratee?[]:result);outer:for(;++index<length;){var value=array[index],computed=iteratee?iteratee(value,index,array):value;if(isCommon&&value===value){for(var seenIndex=seen.length;seenIndex--;)if(seen[seenIndex]===computed)continue outer;iteratee&&seen.push(computed),result.push(value)}else indexOf(seen,computed,0)<0&&((iteratee||isLarge)&&seen.push(computed),result.push(value))}return result}function baseValues(object,props){for(var index=-1,length=props.length,result=Array(length);++index<length;)result[index]=object[props[index]];return result}function baseWhile(array,predicate,isDrop,fromRight){for(var length=array.length,index=fromRight?length:-1;(fromRight?index--:++index<length)&&predicate(array[index],index,array););return isDrop?baseSlice(array,fromRight?0:index,fromRight?index+1:length):baseSlice(array,fromRight?index+1:0,fromRight?length:index)}function baseWrapperValue(value,actions){var result=value;result instanceof LazyWrapper&&(result=result.value());for(var index=-1,length=actions.length;++index<length;){var args=[result],action=actions[index];push.apply(args,action.args),result=action.func.apply(action.thisArg,args)}return result}function binaryIndex(array,value,retHighest){var low=0,high=array?array.length:low;if("number"==typeof value&&value===value&&HALF_MAX_ARRAY_LENGTH>=high){for(;high>low;){var mid=low+high>>>1,computed=array[mid];(retHighest?value>=computed:value>computed)?low=mid+1:high=mid}return high}return binaryIndexBy(array,value,identity,retHighest)}function binaryIndexBy(array,value,iteratee,retHighest){value=iteratee(value);for(var low=0,high=array?array.length:0,valIsNaN=value!==value,valIsUndef=value===undefined;high>low;){var mid=floor((low+high)/2),computed=iteratee(array[mid]),isReflexive=computed===computed;if(valIsNaN)var setLow=isReflexive||retHighest;else setLow=valIsUndef?isReflexive&&(retHighest||computed!==undefined):retHighest?value>=computed:value>computed;setLow?low=mid+1:high=mid}return nativeMin(high,MAX_ARRAY_INDEX)}function bindCallback(func,thisArg,argCount){if("function"!=typeof func)return identity;if(thisArg===undefined)return func;switch(argCount){case 1:return function(value){return func.call(thisArg,value)};case 3:return function(value,index,collection){return func.call(thisArg,value,index,collection)};case 4:return function(accumulator,value,index,collection){return func.call(thisArg,accumulator,value,index,collection)};case 5:return function(value,other,key,object,source){return func.call(thisArg,value,other,key,object,source)}}return function(){return func.apply(thisArg,arguments)}}function bufferClone(buffer){return bufferSlice.call(buffer,0)}function composeArgs(args,partials,holders){for(var holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),leftIndex=-1,leftLength=partials.length,result=Array(argsLength+leftLength);++leftIndex<leftLength;)result[leftIndex]=partials[leftIndex];for(;++argsIndex<holdersLength;)result[holders[argsIndex]]=args[argsIndex];for(;argsLength--;)result[leftIndex++]=args[argsIndex++];return result}function composeArgsRight(args,partials,holders){for(var holdersIndex=-1,holdersLength=holders.length,argsIndex=-1,argsLength=nativeMax(args.length-holdersLength,0),rightIndex=-1,rightLength=partials.length,result=Array(argsLength+rightLength);++argsIndex<argsLength;)result[argsIndex]=args[argsIndex];for(var offset=argsIndex;++rightIndex<rightLength;)result[offset+rightIndex]=partials[rightIndex];for(;++holdersIndex<holdersLength;)result[offset+holders[holdersIndex]]=args[argsIndex++];return result}function createAggregator(setter,initializer){return function(collection,iteratee,thisArg){var result=initializer?initializer():{};if(iteratee=getCallback(iteratee,thisArg,3),isArray(collection))for(var index=-1,length=collection.length;++index<length;){var value=collection[index];setter(result,value,iteratee(value,index,collection),collection)}else baseEach(collection,function(value,key,collection){setter(result,value,iteratee(value,key,collection),collection)});return result}}function createAssigner(assigner){return restParam(function(object,sources){var index=-1,length=null==object?0:sources.length,customizer=length>2&&sources[length-2],guard=length>2&&sources[2],thisArg=length>1&&sources[length-1];for("function"==typeof customizer?(customizer=bindCallback(customizer,thisArg,5),length-=2):(customizer="function"==typeof thisArg?thisArg:null,length-=customizer?1:0),guard&&isIterateeCall(sources[0],sources[1],guard)&&(customizer=3>length?null:customizer,length=1);++index<length;){var source=sources[index];source&&assigner(object,source,customizer)}return object})}function createBaseEach(eachFunc,fromRight){return function(collection,iteratee){var length=collection?getLength(collection):0;if(!isLength(length))return eachFunc(collection,iteratee);for(var index=fromRight?length:-1,iterable=toObject(collection);(fromRight?index--:++index<length)&&iteratee(iterable[index],index,iterable)!==!1;);return collection}}function createBaseFor(fromRight){return function(object,iteratee,keysFunc){for(var iterable=toObject(object),props=keysFunc(object),length=props.length,index=fromRight?length:-1;fromRight?index--:++index<length;){var key=props[index];if(iteratee(iterable[key],key,iterable)===!1)break}return object}}function createBindWrapper(func,thisArg){function wrapper(){var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(thisArg,arguments)}var Ctor=createCtorWrapper(func);return wrapper}function createCompounder(callback){return function(string){for(var index=-1,array=words(deburr(string)),length=array.length,result="";++index<length;)result=callback(result,array[index],index);return result}}function createCtorWrapper(Ctor){return function(){var thisBinding=baseCreate(Ctor.prototype),result=Ctor.apply(thisBinding,arguments);return isObject(result)?result:thisBinding}}function createCurry(flag){function curryFunc(func,arity,guard){guard&&isIterateeCall(func,arity,guard)&&(arity=null);var result=createWrapper(func,flag,null,null,null,null,null,arity);return result.placeholder=curryFunc.placeholder,result}return curryFunc}function createExtremum(arrayFunc,isMin){return function(collection,iteratee,thisArg){thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=null);var func=getCallback(),noIteratee=null==iteratee;if(func===baseCallback&&noIteratee||(noIteratee=!1,iteratee=func(iteratee,thisArg,3)),noIteratee){var isArr=isArray(collection);if(isArr||!isString(collection))return arrayFunc(isArr?collection:toIterable(collection));iteratee=charAtCallback}return extremumBy(collection,iteratee,isMin)}}function createFind(eachFunc,fromRight){return function(collection,predicate,thisArg){if(predicate=getCallback(predicate,thisArg,3),isArray(collection)){var index=baseFindIndex(collection,predicate,fromRight);return index>-1?collection[index]:undefined}return baseFind(collection,predicate,eachFunc)}}function createFindIndex(fromRight){return function(array,predicate,thisArg){return array&&array.length?(predicate=getCallback(predicate,thisArg,3),baseFindIndex(array,predicate,fromRight)):-1}}function createFindKey(objectFunc){return function(object,predicate,thisArg){return predicate=getCallback(predicate,thisArg,3),baseFind(object,predicate,objectFunc,!0)}}function createFlow(fromRight){return function(){var length=arguments.length;if(!length)return function(){return arguments[0]};for(var wrapper,index=fromRight?length:-1,leftIndex=0,funcs=Array(length);fromRight?index--:++index<length;){var func=funcs[leftIndex++]=arguments[index];if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var funcName=wrapper?"":getFuncName(func);wrapper="wrapper"==funcName?new LodashWrapper([]):wrapper}for(index=wrapper?-1:length;++index<length;){func=funcs[index],funcName=getFuncName(func);var data="wrapper"==funcName?getData(func):null;wrapper=data&&isLaziable(data[0])&&data[1]==(ARY_FLAG|CURRY_FLAG|PARTIAL_FLAG|REARG_FLAG)&&!data[4].length&&1==data[9]?wrapper[getFuncName(data[0])].apply(wrapper,data[3]):1==func.length&&isLaziable(func)?wrapper[funcName]():wrapper.thru(func)}return function(){var args=arguments;if(wrapper&&1==args.length&&isArray(args[0]))return wrapper.plant(args[0]).value();for(var index=0,result=funcs[index].apply(this,args);++index<length;)result=funcs[index].call(this,result);return result}}}function createForEach(arrayFunc,eachFunc){return function(collection,iteratee,thisArg){return"function"==typeof iteratee&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee):eachFunc(collection,bindCallback(iteratee,thisArg,3))}}function createForIn(objectFunc){return function(object,iteratee,thisArg){return("function"!=typeof iteratee||thisArg!==undefined)&&(iteratee=bindCallback(iteratee,thisArg,3)),objectFunc(object,iteratee,keysIn)}}function createForOwn(objectFunc){return function(object,iteratee,thisArg){return("function"!=typeof iteratee||thisArg!==undefined)&&(iteratee=bindCallback(iteratee,thisArg,3)),objectFunc(object,iteratee)}}function createObjectMapper(isMapKeys){return function(object,iteratee,thisArg){var result={};return iteratee=getCallback(iteratee,thisArg,3),baseForOwn(object,function(value,key,object){var mapped=iteratee(value,key,object);key=isMapKeys?mapped:key,value=isMapKeys?value:mapped,result[key]=value}),result}}function createPadDir(fromRight){return function(string,length,chars){return string=baseToString(string),(fromRight?string:"")+createPadding(string,length,chars)+(fromRight?"":string)}}function createPartial(flag){var partialFunc=restParam(function(func,partials){var holders=replaceHolders(partials,partialFunc.placeholder);return createWrapper(func,flag,null,partials,holders)});return partialFunc}function createReduce(arrayFunc,eachFunc){return function(collection,iteratee,accumulator,thisArg){var initFromArray=arguments.length<3;return"function"==typeof iteratee&&thisArg===undefined&&isArray(collection)?arrayFunc(collection,iteratee,accumulator,initFromArray):baseReduce(collection,getCallback(iteratee,thisArg,4),accumulator,initFromArray,eachFunc)}}function createHybridWrapper(func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity){function wrapper(){for(var length=arguments.length,index=length,args=Array(length);index--;)args[index]=arguments[index];if(partials&&(args=composeArgs(args,partials,holders)),partialsRight&&(args=composeArgsRight(args,partialsRight,holdersRight)),isCurry||isCurryRight){var placeholder=wrapper.placeholder,argsHolders=replaceHolders(args,placeholder);if(length-=argsHolders.length,arity>length){var newArgPos=argPos?arrayCopy(argPos):null,newArity=nativeMax(arity-length,0),newsHolders=isCurry?argsHolders:null,newHoldersRight=isCurry?null:argsHolders,newPartials=isCurry?args:null,newPartialsRight=isCurry?null:args;bitmask|=isCurry?PARTIAL_FLAG:PARTIAL_RIGHT_FLAG,bitmask&=~(isCurry?PARTIAL_RIGHT_FLAG:PARTIAL_FLAG),isCurryBound||(bitmask&=~(BIND_FLAG|BIND_KEY_FLAG));var newData=[func,bitmask,thisArg,newPartials,newsHolders,newPartialsRight,newHoldersRight,newArgPos,ary,newArity],result=createHybridWrapper.apply(undefined,newData);return isLaziable(func)&&setData(result,newData),result.placeholder=placeholder,result}}var thisBinding=isBind?thisArg:this;isBindKey&&(func=thisBinding[key]),argPos&&(args=reorder(args,argPos)),isAry&&ary<args.length&&(args.length=ary);var fn=this&&this!==root&&this instanceof wrapper?Ctor||createCtorWrapper(func):func;return fn.apply(thisBinding,args)}var isAry=bitmask&ARY_FLAG,isBind=bitmask&BIND_FLAG,isBindKey=bitmask&BIND_KEY_FLAG,isCurry=bitmask&CURRY_FLAG,isCurryBound=bitmask&CURRY_BOUND_FLAG,isCurryRight=bitmask&CURRY_RIGHT_FLAG,Ctor=!isBindKey&&createCtorWrapper(func),key=func;return wrapper}function createPadding(string,length,chars){var strLength=string.length;if(length=+length,strLength>=length||!nativeIsFinite(length))return"";var padLength=length-strLength;return chars=null==chars?" ":chars+"",repeat(chars,ceil(padLength/chars.length)).slice(0,padLength)}function createPartialWrapper(func,bitmask,thisArg,partials){function wrapper(){for(var argsIndex=-1,argsLength=arguments.length,leftIndex=-1,leftLength=partials.length,args=Array(argsLength+leftLength);++leftIndex<leftLength;)args[leftIndex]=partials[leftIndex];for(;argsLength--;)args[leftIndex++]=arguments[++argsIndex];var fn=this&&this!==root&&this instanceof wrapper?Ctor:func;return fn.apply(isBind?thisArg:this,args)}var isBind=bitmask&BIND_FLAG,Ctor=createCtorWrapper(func);return wrapper}function createSortedIndex(retHighest){return function(array,value,iteratee,thisArg){var func=getCallback(iteratee);return func===baseCallback&&null==iteratee?binaryIndex(array,value,retHighest):binaryIndexBy(array,value,func(iteratee,thisArg,1),retHighest)}}function createWrapper(func,bitmask,thisArg,partials,holders,argPos,ary,arity){var isBindKey=bitmask&BIND_KEY_FLAG;if(!isBindKey&&"function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);var length=partials?partials.length:0;if(length||(bitmask&=~(PARTIAL_FLAG|PARTIAL_RIGHT_FLAG),partials=holders=null),length-=holders?holders.length:0,bitmask&PARTIAL_RIGHT_FLAG){var partialsRight=partials,holdersRight=holders;partials=holders=null}var data=isBindKey?null:getData(func),newData=[func,bitmask,thisArg,partials,holders,partialsRight,holdersRight,argPos,ary,arity];if(data&&(mergeData(newData,data),bitmask=newData[1],arity=newData[9]),newData[9]=null==arity?isBindKey?0:func.length:nativeMax(arity-length,0)||0,bitmask==BIND_FLAG)var result=createBindWrapper(newData[0],newData[2]);else result=bitmask!=PARTIAL_FLAG&&bitmask!=(BIND_FLAG|PARTIAL_FLAG)||newData[4].length?createHybridWrapper.apply(undefined,newData):createPartialWrapper.apply(undefined,newData);var setter=data?baseSetData:setData;return setter(result,newData)}function equalArrays(array,other,equalFunc,customizer,isLoose,stackA,stackB){var index=-1,arrLength=array.length,othLength=other.length,result=!0;if(arrLength!=othLength&&!(isLoose&&othLength>arrLength))return!1;for(;result&&++index<arrLength;){var arrValue=array[index],othValue=other[index];if(result=undefined,customizer&&(result=isLoose?customizer(othValue,arrValue,index):customizer(arrValue,othValue,index)),result===undefined)if(isLoose)for(var othIndex=othLength;othIndex--&&(othValue=other[othIndex],!(result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB))););else result=arrValue&&arrValue===othValue||equalFunc(arrValue,othValue,customizer,isLoose,stackA,stackB)}return!!result}function equalByTag(object,other,tag){switch(tag){case boolTag:case dateTag:return+object==+other;case errorTag:return object.name==other.name&&object.message==other.message;case numberTag:return object!=+object?other!=+other:object==+other;case regexpTag:case stringTag:return object==other+""}return!1}function equalObjects(object,other,equalFunc,customizer,isLoose,stackA,stackB){var objProps=keys(object),objLength=objProps.length,othProps=keys(other),othLength=othProps.length;if(objLength!=othLength&&!isLoose)return!1;for(var skipCtor=isLoose,index=-1;++index<objLength;){var key=objProps[index],result=isLoose?key in other:hasOwnProperty.call(other,key);if(result){var objValue=object[key],othValue=other[key];result=undefined,customizer&&(result=isLoose?customizer(othValue,objValue,key):customizer(objValue,othValue,key)),result===undefined&&(result=objValue&&objValue===othValue||equalFunc(objValue,othValue,customizer,isLoose,stackA,stackB))}if(!result)return!1;skipCtor||(skipCtor="constructor"==key)}if(!skipCtor){var objCtor=object.constructor,othCtor=other.constructor;if(objCtor!=othCtor&&"constructor"in object&&"constructor"in other&&!("function"==typeof objCtor&&objCtor instanceof objCtor&&"function"==typeof othCtor&&othCtor instanceof othCtor))return!1}return!0}function extremumBy(collection,iteratee,isMin){var exValue=isMin?POSITIVE_INFINITY:NEGATIVE_INFINITY,computed=exValue,result=computed;return baseEach(collection,function(value,index,collection){var current=iteratee(value,index,collection);((isMin?computed>current:current>computed)||current===exValue&&current===result)&&(computed=current,result=value)}),result}function getCallback(func,thisArg,argCount){var result=lodash.callback||callback;return result=result===callback?baseCallback:result,argCount?result(func,thisArg,argCount):result}function getIndexOf(collection,target,fromIndex){var result=lodash.indexOf||indexOf;return result=result===indexOf?baseIndexOf:result,collection?result(collection,target,fromIndex):result}function getView(start,end,transforms){for(var index=-1,length=transforms?transforms.length:0;++index<length;){var data=transforms[index],size=data.size;switch(data.type){case"drop":start+=size;break;case"dropRight":end-=size;break;case"take":end=nativeMin(end,start+size);break;case"takeRight":start=nativeMax(start,end-size)}}return{start:start,end:end}}function initCloneArray(array){var length=array.length,result=new array.constructor(length);return length&&"string"==typeof array[0]&&hasOwnProperty.call(array,"index")&&(result.index=array.index,result.input=array.input),result}function initCloneObject(object){var Ctor=object.constructor;return"function"==typeof Ctor&&Ctor instanceof Ctor||(Ctor=Object),new Ctor}function initCloneByTag(object,tag,isDeep){var Ctor=object.constructor;switch(tag){case arrayBufferTag:return bufferClone(object);case boolTag:case dateTag:return new Ctor(+object);case float32Tag:case float64Tag:case int8Tag:case int16Tag:case int32Tag:case uint8Tag:case uint8ClampedTag:case uint16Tag:case uint32Tag:var buffer=object.buffer;return new Ctor(isDeep?bufferClone(buffer):buffer,object.byteOffset,object.length);case numberTag:case stringTag:return new Ctor(object);case regexpTag:var result=new Ctor(object.source,reFlags.exec(object));result.lastIndex=object.lastIndex}return result}function invokePath(object,path,args){null==object||isKey(path,object)||(path=toPath(path),object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),path=last(path));var func=null==object?object:object[path];return null==func?undefined:func.apply(object,args)}function isArrayLike(value){return null!=value&&isLength(getLength(value))}function isIndex(value,length){return value=+value,length=null==length?MAX_SAFE_INTEGER:length,value>-1&&value%1==0&&length>value}function isIterateeCall(value,index,object){if(!isObject(object))return!1;var type=typeof index;if("number"==type?isArrayLike(object)&&isIndex(index,object.length):"string"==type&&index in object){var other=object[index];return value===value?value===other:other!==other}return!1}function isKey(value,object){var type=typeof value;if("string"==type&&reIsPlainProp.test(value)||"number"==type)return!0;if(isArray(value))return!1;var result=!reIsDeepProp.test(value);return result||null!=object&&value in toObject(object)}function isLaziable(func){var funcName=getFuncName(func);return!!funcName&&func===lodash[funcName]&&funcName in LazyWrapper.prototype}function isLength(value){return"number"==typeof value&&value>-1&&value%1==0&&MAX_SAFE_INTEGER>=value}function isStrictComparable(value){return value===value&&!isObject(value)}function mergeData(data,source){var bitmask=data[1],srcBitmask=source[1],newBitmask=bitmask|srcBitmask,isCommon=ARY_FLAG>newBitmask,isCombo=srcBitmask==ARY_FLAG&&bitmask==CURRY_FLAG||srcBitmask==ARY_FLAG&&bitmask==REARG_FLAG&&data[7].length<=source[8]||srcBitmask==(ARY_FLAG|REARG_FLAG)&&bitmask==CURRY_FLAG;if(!isCommon&&!isCombo)return data;srcBitmask&BIND_FLAG&&(data[2]=source[2],newBitmask|=bitmask&BIND_FLAG?0:CURRY_BOUND_FLAG);var value=source[3];if(value){var partials=data[3];data[3]=partials?composeArgs(partials,value,source[4]):arrayCopy(value),data[4]=partials?replaceHolders(data[3],PLACEHOLDER):arrayCopy(source[4])}return value=source[5],value&&(partials=data[5],data[5]=partials?composeArgsRight(partials,value,source[6]):arrayCopy(value),data[6]=partials?replaceHolders(data[5],PLACEHOLDER):arrayCopy(source[6])),value=source[7],value&&(data[7]=arrayCopy(value)),srcBitmask&ARY_FLAG&&(data[8]=null==data[8]?source[8]:nativeMin(data[8],source[8])),null==data[9]&&(data[9]=source[9]),data[0]=source[0],data[1]=newBitmask,data}function pickByArray(object,props){object=toObject(object);for(var index=-1,length=props.length,result={};++index<length;){var key=props[index];key in object&&(result[key]=object[key])}return result}function pickByCallback(object,predicate){var result={};return baseForIn(object,function(value,key,object){predicate(value,key,object)&&(result[key]=value)}),result}function reorder(array,indexes){for(var arrLength=array.length,length=nativeMin(indexes.length,arrLength),oldArray=arrayCopy(array);length--;){var index=indexes[length];array[length]=isIndex(index,arrLength)?oldArray[index]:undefined}return array}function shimIsPlainObject(value){var Ctor;lodash.support;if(!isObjectLike(value)||objToString.call(value)!=objectTag||!hasOwnProperty.call(value,"constructor")&&(Ctor=value.constructor,"function"==typeof Ctor&&!(Ctor instanceof Ctor)))return!1;var result;return baseForIn(value,function(subValue,key){result=key}),result===undefined||hasOwnProperty.call(value,result)}function shimKeys(object){for(var props=keysIn(object),propsLength=props.length,length=propsLength&&object.length,support=lodash.support,allowIndexes=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object)),index=-1,result=[];++index<propsLength;){var key=props[index];(allowIndexes&&isIndex(key,length)||hasOwnProperty.call(object,key))&&result.push(key)}return result}function toIterable(value){return null==value?[]:isArrayLike(value)?isObject(value)?value:Object(value):values(value)}function toObject(value){return isObject(value)?value:Object(value)}function toPath(value){if(isArray(value))return value;var result=[];return baseToString(value).replace(rePropName,function(match,number,quote,string){result.push(quote?string.replace(reEscapeChar,"$1"):number||match)}),result}function wrapperClone(wrapper){return wrapper instanceof LazyWrapper?wrapper.clone():new LodashWrapper(wrapper.__wrapped__,wrapper.__chain__,arrayCopy(wrapper.__actions__))}function chunk(array,size,guard){size=(guard?isIterateeCall(array,size,guard):null==size)?1:nativeMax(+size||1,1);for(var index=0,length=array?array.length:0,resIndex=-1,result=Array(ceil(length/size));length>index;)result[++resIndex]=baseSlice(array,index,index+=size);return result}function compact(array){for(var index=-1,length=array?array.length:0,resIndex=-1,result=[];++index<length;){var value=array[index];value&&(result[++resIndex]=value)}return result}function drop(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,0>n?0:n)):[]}function dropRight(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),n=length-(+n||0),baseSlice(array,0,0>n?0:n)):[]}function dropRightWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!0,!0):[]}function dropWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!0):[]}function fill(array,value,start,end){var length=array?array.length:0;return length?(start&&"number"!=typeof start&&isIterateeCall(array,value,start)&&(start=0,end=length),baseFill(array,value,start,end)):[]}function first(array){return array?array[0]:undefined}function flatten(array,isDeep,guard){var length=array?array.length:0;return guard&&isIterateeCall(array,isDeep,guard)&&(isDeep=!1),length?baseFlatten(array,isDeep):[]}function flattenDeep(array){var length=array?array.length:0;return length?baseFlatten(array,!0):[]}function indexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;if("number"==typeof fromIndex)fromIndex=0>fromIndex?nativeMax(length+fromIndex,0):fromIndex;else if(fromIndex){var index=binaryIndex(array,value),other=array[index];return(value===value?value===other:other!==other)?index:-1}return baseIndexOf(array,value,fromIndex||0)}function initial(array){return dropRight(array,1);
}function intersection(){for(var args=[],argsIndex=-1,argsLength=arguments.length,caches=[],indexOf=getIndexOf(),isCommon=indexOf==baseIndexOf,result=[];++argsIndex<argsLength;){var value=arguments[argsIndex];isArrayLike(value)&&(args.push(value),caches.push(isCommon&&value.length>=120?createCache(argsIndex&&value):null))}if(argsLength=args.length,2>argsLength)return result;var array=args[0],index=-1,length=array?array.length:0,seen=caches[0];outer:for(;++index<length;)if(value=array[index],(seen?cacheIndexOf(seen,value):indexOf(result,value,0))<0){for(argsIndex=argsLength;--argsIndex;){var cache=caches[argsIndex];if((cache?cacheIndexOf(cache,value):indexOf(args[argsIndex],value,0))<0)continue outer}seen&&seen.push(value),result.push(value)}return result}function last(array){var length=array?array.length:0;return length?array[length-1]:undefined}function lastIndexOf(array,value,fromIndex){var length=array?array.length:0;if(!length)return-1;var index=length;if("number"==typeof fromIndex)index=(0>fromIndex?nativeMax(length+fromIndex,0):nativeMin(fromIndex||0,length-1))+1;else if(fromIndex){index=binaryIndex(array,value,!0)-1;var other=array[index];return(value===value?value===other:other!==other)?index:-1}if(value!==value)return indexOfNaN(array,index,!0);for(;index--;)if(array[index]===value)return index;return-1}function pull(){var args=arguments,array=args[0];if(!array||!array.length)return array;for(var index=0,indexOf=getIndexOf(),length=args.length;++index<length;)for(var fromIndex=0,value=args[index];(fromIndex=indexOf(array,value,fromIndex))>-1;)splice.call(array,fromIndex,1);return array}function remove(array,predicate,thisArg){var result=[];if(!array||!array.length)return result;var index=-1,indexes=[],length=array.length;for(predicate=getCallback(predicate,thisArg,3);++index<length;){var value=array[index];predicate(value,index,array)&&(result.push(value),indexes.push(index))}return basePullAt(array,indexes),result}function rest(array){return drop(array,1)}function slice(array,start,end){var length=array?array.length:0;return length?(end&&"number"!=typeof end&&isIterateeCall(array,start,end)&&(start=0,end=length),baseSlice(array,start,end)):[]}function take(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),baseSlice(array,0,0>n?0:n)):[]}function takeRight(array,n,guard){var length=array?array.length:0;return length?((guard?isIterateeCall(array,n,guard):null==n)&&(n=1),n=length-(+n||0),baseSlice(array,0>n?0:n)):[]}function takeRightWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3),!1,!0):[]}function takeWhile(array,predicate,thisArg){return array&&array.length?baseWhile(array,getCallback(predicate,thisArg,3)):[]}function uniq(array,isSorted,iteratee,thisArg){var length=array?array.length:0;if(!length)return[];null!=isSorted&&"boolean"!=typeof isSorted&&(thisArg=iteratee,iteratee=isIterateeCall(array,isSorted,thisArg)?null:isSorted,isSorted=!1);var func=getCallback();return(func!==baseCallback||null!=iteratee)&&(iteratee=func(iteratee,thisArg,3)),isSorted&&getIndexOf()==baseIndexOf?sortedUniq(array,iteratee):baseUniq(array,iteratee)}function unzip(array){if(!array||!array.length)return[];var index=-1,length=0;array=arrayFilter(array,function(group){return isArrayLike(group)?(length=nativeMax(group.length,length),!0):void 0});for(var result=Array(length);++index<length;)result[index]=arrayMap(array,baseProperty(index));return result}function unzipWith(array,iteratee,thisArg){var length=array?array.length:0;if(!length)return[];var result=unzip(array);return null==iteratee?result:(iteratee=bindCallback(iteratee,thisArg,4),arrayMap(result,function(group){return arrayReduce(group,iteratee,undefined,!0)}))}function xor(){for(var index=-1,length=arguments.length;++index<length;){var array=arguments[index];if(isArrayLike(array))var result=result?baseDifference(result,array).concat(baseDifference(array,result)):array}return result?baseUniq(result):[]}function zipObject(props,values){var index=-1,length=props?props.length:0,result={};for(!length||values||isArray(props[0])||(values=[]);++index<length;){var key=props[index];values?result[key]=values[index]:key&&(result[key[0]]=key[1])}return result}function chain(value){var result=lodash(value);return result.__chain__=!0,result}function tap(value,interceptor,thisArg){return interceptor.call(thisArg,value),value}function thru(value,interceptor,thisArg){return interceptor.call(thisArg,value)}function wrapperChain(){return chain(this)}function wrapperCommit(){return new LodashWrapper(this.value(),this.__chain__)}function wrapperPlant(value){for(var result,parent=this;parent instanceof baseLodash;){var clone=wrapperClone(parent);result?previous.__wrapped__=clone:result=clone;var previous=clone;parent=parent.__wrapped__}return previous.__wrapped__=value,result}function wrapperReverse(){var value=this.__wrapped__;return value instanceof LazyWrapper?(this.__actions__.length&&(value=new LazyWrapper(this)),new LodashWrapper(value.reverse(),this.__chain__)):this.thru(function(value){return value.reverse()})}function wrapperToString(){return this.value()+""}function wrapperValue(){return baseWrapperValue(this.__wrapped__,this.__actions__)}function every(collection,predicate,thisArg){var func=isArray(collection)?arrayEvery:baseEvery;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=null),("function"!=typeof predicate||thisArg!==undefined)&&(predicate=getCallback(predicate,thisArg,3)),func(collection,predicate)}function filter(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=getCallback(predicate,thisArg,3),func(collection,predicate)}function findWhere(collection,source){return find(collection,baseMatches(source))}function includes(collection,target,fromIndex,guard){var length=collection?getLength(collection):0;return isLength(length)||(collection=values(collection),length=collection.length),length?(fromIndex="number"!=typeof fromIndex||guard&&isIterateeCall(target,fromIndex,guard)?0:0>fromIndex?nativeMax(length+fromIndex,0):fromIndex||0,"string"==typeof collection||!isArray(collection)&&isString(collection)?length>fromIndex&&collection.indexOf(target,fromIndex)>-1:getIndexOf(collection,target,fromIndex)>-1):!1}function map(collection,iteratee,thisArg){var func=isArray(collection)?arrayMap:baseMap;return iteratee=getCallback(iteratee,thisArg,3),func(collection,iteratee)}function pluck(collection,path){return map(collection,property(path))}function reject(collection,predicate,thisArg){var func=isArray(collection)?arrayFilter:baseFilter;return predicate=getCallback(predicate,thisArg,3),func(collection,function(value,index,collection){return!predicate(value,index,collection)})}function sample(collection,n,guard){if(guard?isIterateeCall(collection,n,guard):null==n){collection=toIterable(collection);var length=collection.length;return length>0?collection[baseRandom(0,length-1)]:undefined}var result=shuffle(collection);return result.length=nativeMin(0>n?0:+n||0,result.length),result}function shuffle(collection){collection=toIterable(collection);for(var index=-1,length=collection.length,result=Array(length);++index<length;){var rand=baseRandom(0,index);index!=rand&&(result[index]=result[rand]),result[rand]=collection[index]}return result}function size(collection){var length=collection?getLength(collection):0;return isLength(length)?length:keys(collection).length}function some(collection,predicate,thisArg){var func=isArray(collection)?arraySome:baseSome;return thisArg&&isIterateeCall(collection,predicate,thisArg)&&(predicate=null),("function"!=typeof predicate||thisArg!==undefined)&&(predicate=getCallback(predicate,thisArg,3)),func(collection,predicate)}function sortBy(collection,iteratee,thisArg){if(null==collection)return[];thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=null);var index=-1;iteratee=getCallback(iteratee,thisArg,3);var result=baseMap(collection,function(value,key,collection){return{criteria:iteratee(value,key,collection),index:++index,value:value}});return baseSortBy(result,compareAscending)}function sortByOrder(collection,iteratees,orders,guard){return null==collection?[]:(guard&&isIterateeCall(iteratees,orders,guard)&&(orders=null),isArray(iteratees)||(iteratees=null==iteratees?[]:[iteratees]),isArray(orders)||(orders=null==orders?[]:[orders]),baseSortByOrder(collection,iteratees,orders))}function where(collection,source){return filter(collection,baseMatches(source))}function after(n,func){if("function"!=typeof func){if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);var temp=n;n=func,func=temp}return n=nativeIsFinite(n=+n)?n:0,function(){return--n<1?func.apply(this,arguments):void 0}}function ary(func,n,guard){return guard&&isIterateeCall(func,n,guard)&&(n=null),n=func&&null==n?func.length:nativeMax(+n||0,0),createWrapper(func,ARY_FLAG,null,null,null,null,n)}function before(n,func){var result;if("function"!=typeof func){if("function"!=typeof n)throw new TypeError(FUNC_ERROR_TEXT);var temp=n;n=func,func=temp}return function(){return--n>0&&(result=func.apply(this,arguments)),1>=n&&(func=null),result}}function debounce(func,wait,options){function cancel(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId&&clearTimeout(maxTimeoutId),maxTimeoutId=timeoutId=trailingCall=undefined}function delayed(){var remaining=wait-(now()-stamp);if(0>=remaining||remaining>wait){maxTimeoutId&&clearTimeout(maxTimeoutId);var isCalled=trailingCall;maxTimeoutId=timeoutId=trailingCall=undefined,isCalled&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))}else timeoutId=setTimeout(delayed,remaining)}function maxDelayed(){timeoutId&&clearTimeout(timeoutId),maxTimeoutId=timeoutId=trailingCall=undefined,(trailing||maxWait!==wait)&&(lastCalled=now(),result=func.apply(thisArg,args),timeoutId||maxTimeoutId||(args=thisArg=null))}function debounced(){if(args=arguments,stamp=now(),thisArg=this,trailingCall=trailing&&(timeoutId||!leading),maxWait===!1)var leadingCall=leading&&!timeoutId;else{maxTimeoutId||leading||(lastCalled=stamp);var remaining=maxWait-(stamp-lastCalled),isCalled=0>=remaining||remaining>maxWait;isCalled?(maxTimeoutId&&(maxTimeoutId=clearTimeout(maxTimeoutId)),lastCalled=stamp,result=func.apply(thisArg,args)):maxTimeoutId||(maxTimeoutId=setTimeout(maxDelayed,remaining))}return isCalled&&timeoutId?timeoutId=clearTimeout(timeoutId):timeoutId||wait===maxWait||(timeoutId=setTimeout(delayed,wait)),leadingCall&&(isCalled=!0,result=func.apply(thisArg,args)),!isCalled||timeoutId||maxTimeoutId||(args=thisArg=null),result}var args,maxTimeoutId,result,stamp,thisArg,timeoutId,trailingCall,lastCalled=0,maxWait=!1,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);if(wait=0>wait?0:+wait||0,options===!0){var leading=!0;trailing=!1}else isObject(options)&&(leading=options.leading,maxWait="maxWait"in options&&nativeMax(+options.maxWait||0,wait),trailing="trailing"in options?options.trailing:trailing);return debounced.cancel=cancel,debounced}function memoize(func,resolver){if("function"!=typeof func||resolver&&"function"!=typeof resolver)throw new TypeError(FUNC_ERROR_TEXT);var memoized=function(){var args=arguments,cache=memoized.cache,key=resolver?resolver.apply(this,args):args[0];if(cache.has(key))return cache.get(key);var result=func.apply(this,args);return cache.set(key,result),result};return memoized.cache=new memoize.Cache,memoized}function negate(predicate){if("function"!=typeof predicate)throw new TypeError(FUNC_ERROR_TEXT);return function(){return!predicate.apply(this,arguments)}}function once(func){return before(2,func)}function restParam(func,start){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return start=nativeMax(start===undefined?func.length-1:+start||0,0),function(){for(var args=arguments,index=-1,length=nativeMax(args.length-start,0),rest=Array(length);++index<length;)rest[index]=args[start+index];switch(start){case 0:return func.call(this,rest);case 1:return func.call(this,args[0],rest);case 2:return func.call(this,args[0],args[1],rest)}var otherArgs=Array(start+1);for(index=-1;++index<start;)otherArgs[index]=args[index];return otherArgs[start]=rest,func.apply(this,otherArgs)}}function spread(func){if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return function(array){return func.apply(this,array)}}function throttle(func,wait,options){var leading=!0,trailing=!0;if("function"!=typeof func)throw new TypeError(FUNC_ERROR_TEXT);return options===!1?leading=!1:isObject(options)&&(leading="leading"in options?!!options.leading:leading,trailing="trailing"in options?!!options.trailing:trailing),debounceOptions.leading=leading,debounceOptions.maxWait=+wait,debounceOptions.trailing=trailing,debounce(func,wait,debounceOptions)}function wrap(value,wrapper){return wrapper=null==wrapper?identity:wrapper,createWrapper(wrapper,PARTIAL_FLAG,null,[value],[])}function clone(value,isDeep,customizer,thisArg){return isDeep&&"boolean"!=typeof isDeep&&isIterateeCall(value,isDeep,customizer)?isDeep=!1:"function"==typeof isDeep&&(thisArg=customizer,customizer=isDeep,isDeep=!1),customizer="function"==typeof customizer&&bindCallback(customizer,thisArg,1),baseClone(value,isDeep,customizer)}function cloneDeep(value,customizer,thisArg){return customizer="function"==typeof customizer&&bindCallback(customizer,thisArg,1),baseClone(value,!0,customizer)}function isArguments(value){return isObjectLike(value)&&isArrayLike(value)&&objToString.call(value)==argsTag}function isBoolean(value){return value===!0||value===!1||isObjectLike(value)&&objToString.call(value)==boolTag}function isDate(value){return isObjectLike(value)&&objToString.call(value)==dateTag}function isElement(value){return!!value&&1===value.nodeType&&isObjectLike(value)&&objToString.call(value).indexOf("Element")>-1}function isEmpty(value){return null==value?!0:isArrayLike(value)&&(isArray(value)||isString(value)||isArguments(value)||isObjectLike(value)&&isFunction(value.splice))?!value.length:!keys(value).length}function isEqual(value,other,customizer,thisArg){if(customizer="function"==typeof customizer&&bindCallback(customizer,thisArg,3),!customizer&&isStrictComparable(value)&&isStrictComparable(other))return value===other;var result=customizer?customizer(value,other):undefined;return result===undefined?baseIsEqual(value,other,customizer):!!result}function isError(value){return isObjectLike(value)&&"string"==typeof value.message&&objToString.call(value)==errorTag}function isObject(value){var type=typeof value;return"function"==type||!!value&&"object"==type}function isMatch(object,source,customizer,thisArg){var props=keys(source),length=props.length;if(!length)return!0;if(null==object)return!1;if(customizer="function"==typeof customizer&&bindCallback(customizer,thisArg,3),object=toObject(object),!customizer&&1==length){var key=props[0],value=source[key];if(isStrictComparable(value))return value===object[key]&&(value!==undefined||key in object)}for(var values=Array(length),strictCompareFlags=Array(length);length--;)value=values[length]=source[props[length]],strictCompareFlags[length]=isStrictComparable(value);return baseIsMatch(object,props,values,strictCompareFlags,customizer)}function isNaN(value){return isNumber(value)&&value!=+value}function isNative(value){return null==value?!1:objToString.call(value)==funcTag?reIsNative.test(fnToString.call(value)):isObjectLike(value)&&reIsHostCtor.test(value)}function isNull(value){return null===value}function isNumber(value){return"number"==typeof value||isObjectLike(value)&&objToString.call(value)==numberTag}function isRegExp(value){return isObjectLike(value)&&objToString.call(value)==regexpTag}function isString(value){return"string"==typeof value||isObjectLike(value)&&objToString.call(value)==stringTag}function isTypedArray(value){return isObjectLike(value)&&isLength(value.length)&&!!typedArrayTags[objToString.call(value)]}function isUndefined(value){return value===undefined}function toArray(value){var length=value?getLength(value):0;return isLength(length)?length?arrayCopy(value):[]:values(value)}function toPlainObject(value){return baseCopy(value,keysIn(value))}function create(prototype,properties,guard){var result=baseCreate(prototype);return guard&&isIterateeCall(prototype,properties,guard)&&(properties=null),properties?baseAssign(result,properties):result}function functions(object){return baseFunctions(object,keysIn(object))}function get(object,path,defaultValue){var result=null==object?undefined:baseGet(object,toPath(path),path+"");return result===undefined?defaultValue:result}function has(object,path){if(null==object)return!1;var result=hasOwnProperty.call(object,path);return result||isKey(path)||(path=toPath(path),object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),path=last(path),result=null!=object&&hasOwnProperty.call(object,path)),result}function invert(object,multiValue,guard){guard&&isIterateeCall(object,multiValue,guard)&&(multiValue=null);for(var index=-1,props=keys(object),length=props.length,result={};++index<length;){var key=props[index],value=object[key];multiValue?hasOwnProperty.call(result,value)?result[value].push(key):result[value]=[key]:result[value]=key}return result}function keysIn(object){if(null==object)return[];isObject(object)||(object=Object(object));var length=object.length;length=length&&isLength(length)&&(isArray(object)||support.nonEnumArgs&&isArguments(object))&&length||0;for(var Ctor=object.constructor,index=-1,isProto="function"==typeof Ctor&&Ctor.prototype===object,result=Array(length),skipIndexes=length>0;++index<length;)result[index]=index+"";for(var key in object)skipIndexes&&isIndex(key,length)||"constructor"==key&&(isProto||!hasOwnProperty.call(object,key))||result.push(key);return result}function pairs(object){for(var index=-1,props=keys(object),length=props.length,result=Array(length);++index<length;){var key=props[index];result[index]=[key,object[key]]}return result}function result(object,path,defaultValue){var result=null==object?undefined:object[path];return result===undefined&&(null==object||isKey(path,object)||(path=toPath(path),object=1==path.length?object:baseGet(object,baseSlice(path,0,-1)),result=null==object?undefined:object[last(path)]),result=result===undefined?defaultValue:result),isFunction(result)?result.call(object):result}function set(object,path,value){if(null==object)return object;var pathKey=path+"";path=null!=object[pathKey]||isKey(path,object)?[pathKey]:toPath(path);for(var index=-1,length=path.length,endIndex=length-1,nested=object;null!=nested&&++index<length;){var key=path[index];isObject(nested)&&(index==endIndex?nested[key]=value:null==nested[key]&&(nested[key]=isIndex(path[index+1])?[]:{})),nested=nested[key]}return object}function transform(object,iteratee,accumulator,thisArg){var isArr=isArray(object)||isTypedArray(object);if(iteratee=getCallback(iteratee,thisArg,4),null==accumulator)if(isArr||isObject(object)){var Ctor=object.constructor;accumulator=isArr?isArray(object)?new Ctor:[]:baseCreate(isFunction(Ctor)&&Ctor.prototype)}else accumulator={};return(isArr?arrayEach:baseForOwn)(object,function(value,index,object){return iteratee(accumulator,value,index,object)}),accumulator}function values(object){return baseValues(object,keys(object))}function valuesIn(object){return baseValues(object,keysIn(object))}function inRange(value,start,end){return start=+start||0,"undefined"==typeof end?(end=start,start=0):end=+end||0,value>=nativeMin(start,end)&&value<nativeMax(start,end)}function random(min,max,floating){floating&&isIterateeCall(min,max,floating)&&(max=floating=null);var noMin=null==min,noMax=null==max;if(null==floating&&(noMax&&"boolean"==typeof min?(floating=min,min=1):"boolean"==typeof max&&(floating=max,noMax=!0)),noMin&&noMax&&(max=1,noMax=!1),min=+min||0,noMax?(max=min,min=0):max=+max||0,floating||min%1||max%1){var rand=nativeRandom();return nativeMin(min+rand*(max-min+parseFloat("1e-"+((rand+"").length-1))),max)}return baseRandom(min,max)}function capitalize(string){return string=baseToString(string),string&&string.charAt(0).toUpperCase()+string.slice(1)}function deburr(string){return string=baseToString(string),string&&string.replace(reLatin1,deburrLetter).replace(reComboMark,"")}function endsWith(string,target,position){string=baseToString(string),target+="";var length=string.length;return position=position===undefined?length:nativeMin(0>position?0:+position||0,length),position-=target.length,position>=0&&string.indexOf(target,position)==position}function escape(string){return string=baseToString(string),string&&reHasUnescapedHtml.test(string)?string.replace(reUnescapedHtml,escapeHtmlChar):string}function escapeRegExp(string){return string=baseToString(string),string&&reHasRegExpChars.test(string)?string.replace(reRegExpChars,"\\$&"):string}function pad(string,length,chars){string=baseToString(string),length=+length;var strLength=string.length;if(strLength>=length||!nativeIsFinite(length))return string;var mid=(length-strLength)/2,leftLength=floor(mid),rightLength=ceil(mid);return chars=createPadding("",rightLength,chars),chars.slice(0,leftLength)+string+chars}function parseInt(string,radix,guard){return guard&&isIterateeCall(string,radix,guard)&&(radix=0),nativeParseInt(string,radix)}function repeat(string,n){var result="";if(string=baseToString(string),n=+n,1>n||!string||!nativeIsFinite(n))return result;do n%2&&(result+=string),n=floor(n/2),string+=string;while(n);return result}function startsWith(string,target,position){return string=baseToString(string),position=null==position?0:nativeMin(0>position?0:+position||0,string.length),string.lastIndexOf(target,position)==position}function template(string,options,otherOptions){var settings=lodash.templateSettings;otherOptions&&isIterateeCall(string,options,otherOptions)&&(options=otherOptions=null),string=baseToString(string),options=assignWith(baseAssign({},otherOptions||options),settings,assignOwnDefaults);var isEscaping,isEvaluating,imports=assignWith(baseAssign({},options.imports),settings.imports,assignOwnDefaults),importsKeys=keys(imports),importsValues=baseValues(imports,importsKeys),index=0,interpolate=options.interpolate||reNoMatch,source="__p += '",reDelimiters=RegExp((options.escape||reNoMatch).source+"|"+interpolate.source+"|"+(interpolate===reInterpolate?reEsTemplate:reNoMatch).source+"|"+(options.evaluate||reNoMatch).source+"|$","g"),sourceURL="//# sourceURL="+("sourceURL"in options?options.sourceURL:"lodash.templateSources["+ ++templateCounter+"]")+"\n";string.replace(reDelimiters,function(match,escapeValue,interpolateValue,esTemplateValue,evaluateValue,offset){return interpolateValue||(interpolateValue=esTemplateValue),source+=string.slice(index,offset).replace(reUnescapedString,escapeStringChar),escapeValue&&(isEscaping=!0,source+="' +\n__e("+escapeValue+") +\n'"),evaluateValue&&(isEvaluating=!0,source+="';\n"+evaluateValue+";\n__p += '"),interpolateValue&&(source+="' +\n((__t = ("+interpolateValue+")) == null ? '' : __t) +\n'"),index=offset+match.length,match}),source+="';\n";var variable=options.variable;variable||(source="with (obj) {\n"+source+"\n}\n"),source=(isEvaluating?source.replace(reEmptyStringLeading,""):source).replace(reEmptyStringMiddle,"$1").replace(reEmptyStringTrailing,"$1;"),source="function("+(variable||"obj")+") {\n"+(variable?"":"obj || (obj = {});\n")+"var __t, __p = ''"+(isEscaping?", __e = _.escape":"")+(isEvaluating?", __j = Array.prototype.join;\nfunction print() { __p += __j.call(arguments, '') }\n":";\n")+source+"return __p\n}";var result=attempt(function(){return Function(importsKeys,sourceURL+"return "+source).apply(undefined,importsValues)});if(result.source=source,isError(result))throw result;return result}function trim(string,chars,guard){var value=string;return(string=baseToString(string))?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string),trimmedRightIndex(string)+1):(chars+="",string.slice(charsLeftIndex(string,chars),charsRightIndex(string,chars)+1)):string}function trimLeft(string,chars,guard){var value=string;return string=baseToString(string),string?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(trimmedLeftIndex(string)):string.slice(charsLeftIndex(string,chars+"")):string}function trimRight(string,chars,guard){var value=string;return string=baseToString(string),string?(guard?isIterateeCall(value,chars,guard):null==chars)?string.slice(0,trimmedRightIndex(string)+1):string.slice(0,charsRightIndex(string,chars+"")+1):string}function trunc(string,options,guard){guard&&isIterateeCall(string,options,guard)&&(options=null);var length=DEFAULT_TRUNC_LENGTH,omission=DEFAULT_TRUNC_OMISSION;if(null!=options)if(isObject(options)){var separator="separator"in options?options.separator:separator;length="length"in options?+options.length||0:length,omission="omission"in options?baseToString(options.omission):omission}else length=+options||0;if(string=baseToString(string),length>=string.length)return string;var end=length-omission.length;if(1>end)return omission;var result=string.slice(0,end);if(null==separator)return result+omission;if(isRegExp(separator)){if(string.slice(end).search(separator)){var match,newEnd,substring=string.slice(0,end);for(separator.global||(separator=RegExp(separator.source,(reFlags.exec(separator)||"")+"g")),separator.lastIndex=0;match=separator.exec(substring);)newEnd=match.index;result=result.slice(0,null==newEnd?end:newEnd)}}else if(string.indexOf(separator,end)!=end){var index=result.lastIndexOf(separator);index>-1&&(result=result.slice(0,index))}return result+omission}function unescape(string){return string=baseToString(string),string&&reHasEscapedHtml.test(string)?string.replace(reEscapedHtml,unescapeHtmlChar):string}function words(string,pattern,guard){return guard&&isIterateeCall(string,pattern,guard)&&(pattern=null),string=baseToString(string),string.match(pattern||reWords)||[]}function callback(func,thisArg,guard){return guard&&isIterateeCall(func,thisArg,guard)&&(thisArg=null),isObjectLike(func)?matches(func):baseCallback(func,thisArg)}function constant(value){return function(){return value}}function identity(value){return value}function matches(source){return baseMatches(baseClone(source,!0))}function matchesProperty(path,value){return baseMatchesProperty(path,baseClone(value,!0))}function mixin(object,source,options){if(null==options){var isObj=isObject(source),props=isObj&&keys(source),methodNames=props&&props.length&&baseFunctions(source,props);(methodNames?methodNames.length:isObj)||(methodNames=!1,options=source,source=object,object=this)}methodNames||(methodNames=baseFunctions(source,keys(source)));var chain=!0,index=-1,isFunc=isFunction(object),length=methodNames.length;options===!1?chain=!1:isObject(options)&&"chain"in options&&(chain=options.chain);for(;++index<length;){var methodName=methodNames[index],func=source[methodName];object[methodName]=func,isFunc&&(object.prototype[methodName]=function(func){return function(){var chainAll=this.__chain__;if(chain||chainAll){var result=object(this.__wrapped__),actions=result.__actions__=arrayCopy(this.__actions__);return actions.push({func:func,args:arguments,thisArg:object}),result.__chain__=chainAll,result}var args=[this.value()];return push.apply(args,arguments),func.apply(object,args)}}(func))}return object}function noConflict(){return context._=oldDash,this}function noop(){}function property(path){return isKey(path)?baseProperty(path):basePropertyDeep(path)}function propertyOf(object){return function(path){return baseGet(object,toPath(path),path+"")}}function range(start,end,step){step&&isIterateeCall(start,end,step)&&(end=step=null),start=+start||0,step=null==step?1:+step||0,null==end?(end=start,start=0):end=+end||0;for(var index=-1,length=nativeMax(ceil((end-start)/(step||1)),0),result=Array(length);++index<length;)result[index]=start,start+=step;return result}function times(n,iteratee,thisArg){if(n=floor(n),1>n||!nativeIsFinite(n))return[];var index=-1,result=Array(nativeMin(n,MAX_ARRAY_LENGTH));for(iteratee=bindCallback(iteratee,thisArg,1);++index<n;)MAX_ARRAY_LENGTH>index?result[index]=iteratee(index):iteratee(index);return result}function uniqueId(prefix){var id=++idCounter;return baseToString(prefix)+id}function add(augend,addend){return(+augend||0)+(+addend||0)}function sum(collection,iteratee,thisArg){thisArg&&isIterateeCall(collection,iteratee,thisArg)&&(iteratee=null);var func=getCallback(),noIteratee=null==iteratee;return func===baseCallback&&noIteratee||(noIteratee=!1,iteratee=func(iteratee,thisArg,3)),noIteratee?arraySum(isArray(collection)?collection:toIterable(collection)):baseSum(collection,iteratee)}context=context?_.defaults(root.Object(),context,_.pick(root,contextProps)):root;var Array=context.Array,Date=context.Date,Error=context.Error,Function=context.Function,Math=context.Math,Number=context.Number,Object=context.Object,RegExp=context.RegExp,String=context.String,TypeError=context.TypeError,arrayProto=Array.prototype,objectProto=Object.prototype,stringProto=String.prototype,document=(document=context.window)&&document.document,fnToString=Function.prototype.toString,hasOwnProperty=objectProto.hasOwnProperty,idCounter=0,objToString=objectProto.toString,oldDash=context._,reIsNative=RegExp("^"+escapeRegExp(objToString).replace(/toString|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),ArrayBuffer=isNative(ArrayBuffer=context.ArrayBuffer)&&ArrayBuffer,bufferSlice=isNative(bufferSlice=ArrayBuffer&&new ArrayBuffer(0).slice)&&bufferSlice,ceil=Math.ceil,clearTimeout=context.clearTimeout,floor=Math.floor,getOwnPropertySymbols=isNative(getOwnPropertySymbols=Object.getOwnPropertySymbols)&&getOwnPropertySymbols,getPrototypeOf=isNative(getPrototypeOf=Object.getPrototypeOf)&&getPrototypeOf,push=arrayProto.push,preventExtensions=isNative(preventExtensions=Object.preventExtensions)&&preventExtensions,propertyIsEnumerable=objectProto.propertyIsEnumerable,Set=isNative(Set=context.Set)&&Set,setTimeout=context.setTimeout,splice=arrayProto.splice,Uint8Array=isNative(Uint8Array=context.Uint8Array)&&Uint8Array,WeakMap=isNative(WeakMap=context.WeakMap)&&WeakMap,Float64Array=function(){try{var func=isNative(func=context.Float64Array)&&func,result=new func(new ArrayBuffer(10),0,1)&&func}catch(e){}return result}(),nativeAssign=function(){var func=preventExtensions&&isNative(func=Object.assign)&&func;try{if(func){var object=preventExtensions({1:0});object[0]=1}}catch(e){try{func(object,"xo")}catch(e){}return!object[1]&&func}return!1}(),nativeIsArray=isNative(nativeIsArray=Array.isArray)&&nativeIsArray,nativeCreate=isNative(nativeCreate=Object.create)&&nativeCreate,nativeIsFinite=context.isFinite,nativeKeys=isNative(nativeKeys=Object.keys)&&nativeKeys,nativeMax=Math.max,nativeMin=Math.min,nativeNow=isNative(nativeNow=Date.now)&&nativeNow,nativeNumIsFinite=isNative(nativeNumIsFinite=Number.isFinite)&&nativeNumIsFinite,nativeParseInt=context.parseInt,nativeRandom=Math.random,NEGATIVE_INFINITY=Number.NEGATIVE_INFINITY,POSITIVE_INFINITY=Number.POSITIVE_INFINITY,MAX_ARRAY_LENGTH=Math.pow(2,32)-1,MAX_ARRAY_INDEX=MAX_ARRAY_LENGTH-1,HALF_MAX_ARRAY_LENGTH=MAX_ARRAY_LENGTH>>>1,FLOAT64_BYTES_PER_ELEMENT=Float64Array?Float64Array.BYTES_PER_ELEMENT:0,MAX_SAFE_INTEGER=Math.pow(2,53)-1,metaMap=WeakMap&&new WeakMap,realNames={},support=lodash.support={};!function(x){var Ctor=function(){this.x=x},args=arguments,props=[];Ctor.prototype={valueOf:x,y:x};for(var key in new Ctor)props.push(key);support.funcDecomp=/\bthis\b/.test(function(){return this}),support.funcNames="string"==typeof Function.name;try{support.dom=11===document.createDocumentFragment().nodeType}catch(e){support.dom=!1}try{support.nonEnumArgs=!propertyIsEnumerable.call(args,1)}catch(e){support.nonEnumArgs=!0}}(1,0),lodash.templateSettings={escape:reEscape,evaluate:reEvaluate,interpolate:reInterpolate,variable:"",imports:{_:lodash}};var baseAssign=nativeAssign||function(object,source){return null==source?object:baseCopy(source,getSymbols(source),baseCopy(source,keys(source),object))},baseCreate=function(){function Object(){}return function(prototype){if(isObject(prototype)){Object.prototype=prototype;var result=new Object;Object.prototype=null}return result||context.Object()}}(),baseEach=createBaseEach(baseForOwn),baseEachRight=createBaseEach(baseForOwnRight,!0),baseFor=createBaseFor(),baseForRight=createBaseFor(!0),baseSetData=metaMap?function(func,data){return metaMap.set(func,data),func}:identity;bufferSlice||(bufferClone=ArrayBuffer&&Uint8Array?function(buffer){var byteLength=buffer.byteLength,floatLength=Float64Array?floor(byteLength/FLOAT64_BYTES_PER_ELEMENT):0,offset=floatLength*FLOAT64_BYTES_PER_ELEMENT,result=new ArrayBuffer(byteLength);
if(floatLength){var view=new Float64Array(result,0,floatLength);view.set(new Float64Array(buffer,0,floatLength))}return byteLength!=offset&&(view=new Uint8Array(result,offset),view.set(new Uint8Array(buffer,offset))),result}:constant(null));var createCache=nativeCreate&&Set?function(values){return new SetCache(values)}:constant(null),getData=metaMap?function(func){return metaMap.get(func)}:noop,getFuncName=function(){return support.funcNames?"constant"==constant.name?baseProperty("name"):function(func){for(var result=func.name,array=realNames[result],length=array?array.length:0;length--;){var data=array[length],otherFunc=data.func;if(null==otherFunc||otherFunc==func)return data.name}return result}:constant("")}(),getLength=baseProperty("length"),getSymbols=getOwnPropertySymbols?function(object){return getOwnPropertySymbols(toObject(object))}:constant([]),setData=function(){var count=0,lastCalled=0;return function(key,value){var stamp=now(),remaining=HOT_SPAN-(stamp-lastCalled);if(lastCalled=stamp,remaining>0){if(++count>=HOT_COUNT)return key}else count=0;return baseSetData(key,value)}}(),difference=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,baseFlatten(values,!1,!0)):[]}),findIndex=createFindIndex(),findLastIndex=createFindIndex(!0),pullAt=restParam(function(array,indexes){indexes=baseFlatten(indexes);var result=baseAt(array,indexes);return basePullAt(array,indexes.sort(baseCompareAscending)),result}),sortedIndex=createSortedIndex(),sortedLastIndex=createSortedIndex(!0),union=restParam(function(arrays){return baseUniq(baseFlatten(arrays,!1,!0))}),without=restParam(function(array,values){return isArrayLike(array)?baseDifference(array,values):[]}),zip=restParam(unzip),zipWith=restParam(function(arrays){var length=arrays.length,iteratee=arrays[length-2],thisArg=arrays[length-1];return length>2&&"function"==typeof iteratee?length-=2:(iteratee=length>1&&"function"==typeof thisArg?(--length,thisArg):undefined,thisArg=undefined),arrays.length=length,unzipWith(arrays,iteratee,thisArg)}),at=restParam(function(collection,props){return baseAt(collection,baseFlatten(props))}),countBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?++result[key]:result[key]=1}),find=createFind(baseEach),findLast=createFind(baseEachRight,!0),forEach=createForEach(arrayEach,baseEach),forEachRight=createForEach(arrayEachRight,baseEachRight),groupBy=createAggregator(function(result,value,key){hasOwnProperty.call(result,key)?result[key].push(value):result[key]=[value]}),indexBy=createAggregator(function(result,value,key){result[key]=value}),invoke=restParam(function(collection,path,args){var index=-1,isFunc="function"==typeof path,isProp=isKey(path),result=isArrayLike(collection)?Array(collection.length):[];return baseEach(collection,function(value){var func=isFunc?path:isProp&&null!=value&&value[path];result[++index]=func?func.apply(value,args):invokePath(value,path,args)}),result}),partition=createAggregator(function(result,value,key){result[key?0:1].push(value)},function(){return[[],[]]}),reduce=createReduce(arrayReduce,baseEach),reduceRight=createReduce(arrayReduceRight,baseEachRight),sortByAll=restParam(function(collection,iteratees){if(null==collection)return[];var guard=iteratees[2];return guard&&isIterateeCall(iteratees[0],iteratees[1],guard)&&(iteratees.length=1),baseSortByOrder(collection,baseFlatten(iteratees),[])}),now=nativeNow||function(){return(new Date).getTime()},bind=restParam(function(func,thisArg,partials){var bitmask=BIND_FLAG;if(partials.length){var holders=replaceHolders(partials,bind.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(func,bitmask,thisArg,partials,holders)}),bindAll=restParam(function(object,methodNames){methodNames=methodNames.length?baseFlatten(methodNames):functions(object);for(var index=-1,length=methodNames.length;++index<length;){var key=methodNames[index];object[key]=createWrapper(object[key],BIND_FLAG,object)}return object}),bindKey=restParam(function(object,key,partials){var bitmask=BIND_FLAG|BIND_KEY_FLAG;if(partials.length){var holders=replaceHolders(partials,bindKey.placeholder);bitmask|=PARTIAL_FLAG}return createWrapper(key,bitmask,object,partials,holders)}),curry=createCurry(CURRY_FLAG),curryRight=createCurry(CURRY_RIGHT_FLAG),defer=restParam(function(func,args){return baseDelay(func,1,args)}),delay=restParam(function(func,wait,args){return baseDelay(func,wait,args)}),flow=createFlow(),flowRight=createFlow(!0),partial=createPartial(PARTIAL_FLAG),partialRight=createPartial(PARTIAL_RIGHT_FLAG),rearg=restParam(function(func,indexes){return createWrapper(func,REARG_FLAG,null,null,null,baseFlatten(indexes))}),isArray=nativeIsArray||function(value){return isObjectLike(value)&&isLength(value.length)&&objToString.call(value)==arrayTag};support.dom||(isElement=function(value){return!!value&&1===value.nodeType&&isObjectLike(value)&&!isPlainObject(value)});var isFinite=nativeNumIsFinite||function(value){return"number"==typeof value&&nativeIsFinite(value)},isFunction=baseIsFunction(/x/)||Uint8Array&&!baseIsFunction(Uint8Array)?function(value){return objToString.call(value)==funcTag}:baseIsFunction,isPlainObject=getPrototypeOf?function(value){if(!value||objToString.call(value)!=objectTag)return!1;var valueOf=value.valueOf,objProto=isNative(valueOf)&&(objProto=getPrototypeOf(valueOf))&&getPrototypeOf(objProto);return objProto?value==objProto||getPrototypeOf(value)==objProto:shimIsPlainObject(value)}:shimIsPlainObject,assign=createAssigner(function(object,source,customizer){return customizer?assignWith(object,source,customizer):baseAssign(object,source)}),defaults=restParam(function(args){var object=args[0];return null==object?object:(args.push(assignDefaults),assign.apply(undefined,args))}),findKey=createFindKey(baseForOwn),findLastKey=createFindKey(baseForOwnRight),forIn=createForIn(baseFor),forInRight=createForIn(baseForRight),forOwn=createForOwn(baseForOwn),forOwnRight=createForOwn(baseForOwnRight),keys=nativeKeys?function(object){var Ctor=null!=object&&object.constructor;return"function"==typeof Ctor&&Ctor.prototype===object||"function"!=typeof object&&isArrayLike(object)?shimKeys(object):isObject(object)?nativeKeys(object):[]}:shimKeys,mapKeys=createObjectMapper(!0),mapValues=createObjectMapper(),merge=createAssigner(baseMerge),omit=restParam(function(object,props){if(null==object)return{};if("function"!=typeof props[0]){var props=arrayMap(baseFlatten(props),String);return pickByArray(object,baseDifference(keysIn(object),props))}var predicate=bindCallback(props[0],props[1],3);return pickByCallback(object,function(value,key,object){return!predicate(value,key,object)})}),pick=restParam(function(object,props){return null==object?{}:"function"==typeof props[0]?pickByCallback(object,bindCallback(props[0],props[1],3)):pickByArray(object,baseFlatten(props))}),camelCase=createCompounder(function(result,word,index){return word=word.toLowerCase(),result+(index?word.charAt(0).toUpperCase()+word.slice(1):word)}),kebabCase=createCompounder(function(result,word,index){return result+(index?"-":"")+word.toLowerCase()}),padLeft=createPadDir(),padRight=createPadDir(!0);8!=nativeParseInt(whitespace+"08")&&(parseInt=function(string,radix,guard){return(guard?isIterateeCall(string,radix,guard):null==radix)?radix=0:radix&&(radix=+radix),string=trim(string),nativeParseInt(string,radix||(reHasHexPrefix.test(string)?16:10))});var snakeCase=createCompounder(function(result,word,index){return result+(index?"_":"")+word.toLowerCase()}),startCase=createCompounder(function(result,word,index){return result+(index?" ":"")+(word.charAt(0).toUpperCase()+word.slice(1))}),attempt=restParam(function(func,args){try{return func.apply(undefined,args)}catch(e){return isError(e)?e:new Error(e)}}),method=restParam(function(path,args){return function(object){return invokePath(object,path,args)}}),methodOf=restParam(function(object,args){return function(path){return invokePath(object,path,args)}}),max=createExtremum(arrayMax),min=createExtremum(arrayMin,!0);return lodash.prototype=baseLodash.prototype,LodashWrapper.prototype=baseCreate(baseLodash.prototype),LodashWrapper.prototype.constructor=LodashWrapper,LazyWrapper.prototype=baseCreate(baseLodash.prototype),LazyWrapper.prototype.constructor=LazyWrapper,MapCache.prototype["delete"]=mapDelete,MapCache.prototype.get=mapGet,MapCache.prototype.has=mapHas,MapCache.prototype.set=mapSet,SetCache.prototype.push=cachePush,memoize.Cache=MapCache,lodash.after=after,lodash.ary=ary,lodash.assign=assign,lodash.at=at,lodash.before=before,lodash.bind=bind,lodash.bindAll=bindAll,lodash.bindKey=bindKey,lodash.callback=callback,lodash.chain=chain,lodash.chunk=chunk,lodash.compact=compact,lodash.constant=constant,lodash.countBy=countBy,lodash.create=create,lodash.curry=curry,lodash.curryRight=curryRight,lodash.debounce=debounce,lodash.defaults=defaults,lodash.defer=defer,lodash.delay=delay,lodash.difference=difference,lodash.drop=drop,lodash.dropRight=dropRight,lodash.dropRightWhile=dropRightWhile,lodash.dropWhile=dropWhile,lodash.fill=fill,lodash.filter=filter,lodash.flatten=flatten,lodash.flattenDeep=flattenDeep,lodash.flow=flow,lodash.flowRight=flowRight,lodash.forEach=forEach,lodash.forEachRight=forEachRight,lodash.forIn=forIn,lodash.forInRight=forInRight,lodash.forOwn=forOwn,lodash.forOwnRight=forOwnRight,lodash.functions=functions,lodash.groupBy=groupBy,lodash.indexBy=indexBy,lodash.initial=initial,lodash.intersection=intersection,lodash.invert=invert,lodash.invoke=invoke,lodash.keys=keys,lodash.keysIn=keysIn,lodash.map=map,lodash.mapKeys=mapKeys,lodash.mapValues=mapValues,lodash.matches=matches,lodash.matchesProperty=matchesProperty,lodash.memoize=memoize,lodash.merge=merge,lodash.method=method,lodash.methodOf=methodOf,lodash.mixin=mixin,lodash.negate=negate,lodash.omit=omit,lodash.once=once,lodash.pairs=pairs,lodash.partial=partial,lodash.partialRight=partialRight,lodash.partition=partition,lodash.pick=pick,lodash.pluck=pluck,lodash.property=property,lodash.propertyOf=propertyOf,lodash.pull=pull,lodash.pullAt=pullAt,lodash.range=range,lodash.rearg=rearg,lodash.reject=reject,lodash.remove=remove,lodash.rest=rest,lodash.restParam=restParam,lodash.set=set,lodash.shuffle=shuffle,lodash.slice=slice,lodash.sortBy=sortBy,lodash.sortByAll=sortByAll,lodash.sortByOrder=sortByOrder,lodash.spread=spread,lodash.take=take,lodash.takeRight=takeRight,lodash.takeRightWhile=takeRightWhile,lodash.takeWhile=takeWhile,lodash.tap=tap,lodash.throttle=throttle,lodash.thru=thru,lodash.times=times,lodash.toArray=toArray,lodash.toPlainObject=toPlainObject,lodash.transform=transform,lodash.union=union,lodash.uniq=uniq,lodash.unzip=unzip,lodash.unzipWith=unzipWith,lodash.values=values,lodash.valuesIn=valuesIn,lodash.where=where,lodash.without=without,lodash.wrap=wrap,lodash.xor=xor,lodash.zip=zip,lodash.zipObject=zipObject,lodash.zipWith=zipWith,lodash.backflow=flowRight,lodash.collect=map,lodash.compose=flowRight,lodash.each=forEach,lodash.eachRight=forEachRight,lodash.extend=assign,lodash.iteratee=callback,lodash.methods=functions,lodash.object=zipObject,lodash.select=filter,lodash.tail=rest,lodash.unique=uniq,mixin(lodash,lodash),lodash.add=add,lodash.attempt=attempt,lodash.camelCase=camelCase,lodash.capitalize=capitalize,lodash.clone=clone,lodash.cloneDeep=cloneDeep,lodash.deburr=deburr,lodash.endsWith=endsWith,lodash.escape=escape,lodash.escapeRegExp=escapeRegExp,lodash.every=every,lodash.find=find,lodash.findIndex=findIndex,lodash.findKey=findKey,lodash.findLast=findLast,lodash.findLastIndex=findLastIndex,lodash.findLastKey=findLastKey,lodash.findWhere=findWhere,lodash.first=first,lodash.get=get,lodash.has=has,lodash.identity=identity,lodash.includes=includes,lodash.indexOf=indexOf,lodash.inRange=inRange,lodash.isArguments=isArguments,lodash.isArray=isArray,lodash.isBoolean=isBoolean,lodash.isDate=isDate,lodash.isElement=isElement,lodash.isEmpty=isEmpty,lodash.isEqual=isEqual,lodash.isError=isError,lodash.isFinite=isFinite,lodash.isFunction=isFunction,lodash.isMatch=isMatch,lodash.isNaN=isNaN,lodash.isNative=isNative,lodash.isNull=isNull,lodash.isNumber=isNumber,lodash.isObject=isObject,lodash.isPlainObject=isPlainObject,lodash.isRegExp=isRegExp,lodash.isString=isString,lodash.isTypedArray=isTypedArray,lodash.isUndefined=isUndefined,lodash.kebabCase=kebabCase,lodash.last=last,lodash.lastIndexOf=lastIndexOf,lodash.max=max,lodash.min=min,lodash.noConflict=noConflict,lodash.noop=noop,lodash.now=now,lodash.pad=pad,lodash.padLeft=padLeft,lodash.padRight=padRight,lodash.parseInt=parseInt,lodash.random=random,lodash.reduce=reduce,lodash.reduceRight=reduceRight,lodash.repeat=repeat,lodash.result=result,lodash.runInContext=runInContext,lodash.size=size,lodash.snakeCase=snakeCase,lodash.some=some,lodash.sortedIndex=sortedIndex,lodash.sortedLastIndex=sortedLastIndex,lodash.startCase=startCase,lodash.startsWith=startsWith,lodash.sum=sum,lodash.template=template,lodash.trim=trim,lodash.trimLeft=trimLeft,lodash.trimRight=trimRight,lodash.trunc=trunc,lodash.unescape=unescape,lodash.uniqueId=uniqueId,lodash.words=words,lodash.all=every,lodash.any=some,lodash.contains=includes,lodash.detect=find,lodash.foldl=reduce,lodash.foldr=reduceRight,lodash.head=first,lodash.include=includes,lodash.inject=reduce,mixin(lodash,function(){var source={};return baseForOwn(lodash,function(func,methodName){lodash.prototype[methodName]||(source[methodName]=func)}),source}(),!1),lodash.sample=sample,lodash.prototype.sample=function(n){return this.__chain__||null!=n?this.thru(function(value){return sample(value,n)}):sample(this.value())},lodash.VERSION=VERSION,arrayEach(["bind","bindKey","curry","curryRight","partial","partialRight"],function(methodName){lodash[methodName].placeholder=lodash}),arrayEach(["dropWhile","filter","map","takeWhile"],function(methodName,type){var isFilter=type!=LAZY_MAP_FLAG,isDropWhile=type==LAZY_DROP_WHILE_FLAG;LazyWrapper.prototype[methodName]=function(iteratee,thisArg){var filtered=this.__filtered__,result=filtered&&isDropWhile?new LazyWrapper(this):this.clone(),iteratees=result.__iteratees__||(result.__iteratees__=[]);return iteratees.push({done:!1,count:0,index:0,iteratee:getCallback(iteratee,thisArg,1),limit:-1,type:type}),result.__filtered__=filtered||isFilter,result}}),arrayEach(["drop","take"],function(methodName,index){var whileName=methodName+"While";LazyWrapper.prototype[methodName]=function(n){var filtered=this.__filtered__,result=filtered&&!index?this.dropWhile():this.clone();if(n=null==n?1:nativeMax(floor(n)||0,0),filtered)index?result.__takeCount__=nativeMin(result.__takeCount__,n):last(result.__iteratees__).limit=n;else{var views=result.__views__||(result.__views__=[]);views.push({size:n,type:methodName+(result.__dir__<0?"Right":"")})}return result},LazyWrapper.prototype[methodName+"Right"]=function(n){return this.reverse()[methodName](n).reverse()},LazyWrapper.prototype[methodName+"RightWhile"]=function(predicate,thisArg){return this.reverse()[whileName](predicate,thisArg).reverse()}}),arrayEach(["first","last"],function(methodName,index){var takeName="take"+(index?"Right":"");LazyWrapper.prototype[methodName]=function(){return this[takeName](1).value()[0]}}),arrayEach(["initial","rest"],function(methodName,index){var dropName="drop"+(index?"":"Right");LazyWrapper.prototype[methodName]=function(){return this[dropName](1)}}),arrayEach(["pluck","where"],function(methodName,index){var operationName=index?"filter":"map",createCallback=index?baseMatches:property;LazyWrapper.prototype[methodName]=function(value){return this[operationName](createCallback(value))}}),LazyWrapper.prototype.compact=function(){return this.filter(identity)},LazyWrapper.prototype.reject=function(predicate,thisArg){return predicate=getCallback(predicate,thisArg,1),this.filter(function(value){return!predicate(value)})},LazyWrapper.prototype.slice=function(start,end){start=null==start?0:+start||0;var result=this;return 0>start?result=this.takeRight(-start):start&&(result=this.drop(start)),end!==undefined&&(end=+end||0,result=0>end?result.dropRight(-end):result.take(end-start)),result},LazyWrapper.prototype.toArray=function(){return this.drop(0)},baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var checkIteratee=/^(?:filter|map|reject)|While$/.test(methodName),retUnwrapped=/^(?:first|last)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments,chainAll=this.__chain__,value=this.__wrapped__,isHybrid=!!this.__actions__.length,isLazy=value instanceof LazyWrapper,iteratee=args[0],useLazy=isLazy||isArray(value);useLazy&&checkIteratee&&"function"==typeof iteratee&&1!=iteratee.length&&(isLazy=useLazy=!1);var onlyLazy=isLazy&&!isHybrid;if(retUnwrapped&&!chainAll)return onlyLazy?func.call(value):lodashFunc.call(lodash,this.value());var interceptor=function(value){var otherArgs=[value];return push.apply(otherArgs,args),lodashFunc.apply(lodash,otherArgs)};if(useLazy){var wrapper=onlyLazy?value:new LazyWrapper(this),result=func.apply(wrapper,args);if(!retUnwrapped&&(isHybrid||result.__actions__)){var actions=result.__actions__||(result.__actions__=[]);actions.push({func:thru,args:[interceptor],thisArg:lodash})}return new LodashWrapper(result,chainAll)}return this.thru(interceptor)}}}),arrayEach(["concat","join","pop","push","replace","shift","sort","splice","split","unshift"],function(methodName){var func=(/^(?:replace|split)$/.test(methodName)?stringProto:arrayProto)[methodName],chainName=/^(?:push|sort|unshift)$/.test(methodName)?"tap":"thru",retUnwrapped=/^(?:join|pop|replace|shift)$/.test(methodName);lodash.prototype[methodName]=function(){var args=arguments;return retUnwrapped&&!this.__chain__?func.apply(this.value(),args):this[chainName](function(value){return func.apply(value,args)})}}),baseForOwn(LazyWrapper.prototype,function(func,methodName){var lodashFunc=lodash[methodName];if(lodashFunc){var key=lodashFunc.name,names=realNames[key]||(realNames[key]=[]);names.push({name:methodName,func:lodashFunc})}}),realNames[createHybridWrapper(null,BIND_KEY_FLAG).name]=[{name:"wrapper",func:null}],LazyWrapper.prototype.clone=lazyClone,LazyWrapper.prototype.reverse=lazyReverse,LazyWrapper.prototype.value=lazyValue,lodash.prototype.chain=wrapperChain,lodash.prototype.commit=wrapperCommit,lodash.prototype.plant=wrapperPlant,lodash.prototype.reverse=wrapperReverse,lodash.prototype.toString=wrapperToString,lodash.prototype.run=lodash.prototype.toJSON=lodash.prototype.valueOf=lodash.prototype.value=wrapperValue,lodash.prototype.collect=lodash.prototype.map,lodash.prototype.head=lodash.prototype.first,lodash.prototype.select=lodash.prototype.filter,lodash.prototype.tail=lodash.prototype.rest,lodash}var undefined,VERSION="3.8.0",BIND_FLAG=1,BIND_KEY_FLAG=2,CURRY_BOUND_FLAG=4,CURRY_FLAG=8,CURRY_RIGHT_FLAG=16,PARTIAL_FLAG=32,PARTIAL_RIGHT_FLAG=64,ARY_FLAG=128,REARG_FLAG=256,DEFAULT_TRUNC_LENGTH=30,DEFAULT_TRUNC_OMISSION="...",HOT_COUNT=150,HOT_SPAN=16,LAZY_DROP_WHILE_FLAG=0,LAZY_FILTER_FLAG=1,LAZY_MAP_FLAG=2,FUNC_ERROR_TEXT="Expected a function",PLACEHOLDER="__lodash_placeholder__",argsTag="[object Arguments]",arrayTag="[object Array]",boolTag="[object Boolean]",dateTag="[object Date]",errorTag="[object Error]",funcTag="[object Function]",mapTag="[object Map]",numberTag="[object Number]",objectTag="[object Object]",regexpTag="[object RegExp]",setTag="[object Set]",stringTag="[object String]",weakMapTag="[object WeakMap]",arrayBufferTag="[object ArrayBuffer]",float32Tag="[object Float32Array]",float64Tag="[object Float64Array]",int8Tag="[object Int8Array]",int16Tag="[object Int16Array]",int32Tag="[object Int32Array]",uint8Tag="[object Uint8Array]",uint8ClampedTag="[object Uint8ClampedArray]",uint16Tag="[object Uint16Array]",uint32Tag="[object Uint32Array]",reEmptyStringLeading=/\b__p \+= '';/g,reEmptyStringMiddle=/\b(__p \+=) '' \+/g,reEmptyStringTrailing=/(__e\(.*?\)|\b__t\)) \+\n'';/g,reEscapedHtml=/&(?:amp|lt|gt|quot|#39|#96);/g,reUnescapedHtml=/[&<>"'`]/g,reHasEscapedHtml=RegExp(reEscapedHtml.source),reHasUnescapedHtml=RegExp(reUnescapedHtml.source),reEscape=/<%-([\s\S]+?)%>/g,reEvaluate=/<%([\s\S]+?)%>/g,reInterpolate=/<%=([\s\S]+?)%>/g,reIsDeepProp=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\n\\]|\\.)*?\1)\]/,reIsPlainProp=/^\w*$/,rePropName=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\n\\]|\\.)*?)\2)\]/g,reRegExpChars=/[.*+?^${}()|[\]\/\\]/g,reHasRegExpChars=RegExp(reRegExpChars.source),reComboMark=/[\u0300-\u036f\ufe20-\ufe23]/g,reEscapeChar=/\\(\\)?/g,reEsTemplate=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,reFlags=/\w*$/,reHasHexPrefix=/^0[xX]/,reIsHostCtor=/^\[object .+?Constructor\]$/,reLatin1=/[\xc0-\xd6\xd8-\xde\xdf-\xf6\xf8-\xff]/g,reNoMatch=/($^)/,reUnescapedString=/['\n\r\u2028\u2029\\]/g,reWords=function(){var upper="[A-Z\\xc0-\\xd6\\xd8-\\xde]",lower="[a-z\\xdf-\\xf6\\xf8-\\xff]+";return RegExp(upper+"+(?="+upper+lower+")|"+upper+"?"+lower+"|"+upper+"+|[0-9]+","g")}(),whitespace=" 	\f\xa0\ufeff\n\r\u2028\u2029\u1680\u180e\u2000\u2001\u2002\u2003\u2004\u2005\u2006\u2007\u2008\u2009\u200a\u202f\u205f\u3000",contextProps=["Array","ArrayBuffer","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Math","Number","Object","RegExp","Set","String","_","clearTimeout","document","isFinite","parseInt","setTimeout","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","window"],templateCounter=-1,typedArrayTags={};typedArrayTags[float32Tag]=typedArrayTags[float64Tag]=typedArrayTags[int8Tag]=typedArrayTags[int16Tag]=typedArrayTags[int32Tag]=typedArrayTags[uint8Tag]=typedArrayTags[uint8ClampedTag]=typedArrayTags[uint16Tag]=typedArrayTags[uint32Tag]=!0,typedArrayTags[argsTag]=typedArrayTags[arrayTag]=typedArrayTags[arrayBufferTag]=typedArrayTags[boolTag]=typedArrayTags[dateTag]=typedArrayTags[errorTag]=typedArrayTags[funcTag]=typedArrayTags[mapTag]=typedArrayTags[numberTag]=typedArrayTags[objectTag]=typedArrayTags[regexpTag]=typedArrayTags[setTag]=typedArrayTags[stringTag]=typedArrayTags[weakMapTag]=!1;var cloneableTags={};cloneableTags[argsTag]=cloneableTags[arrayTag]=cloneableTags[arrayBufferTag]=cloneableTags[boolTag]=cloneableTags[dateTag]=cloneableTags[float32Tag]=cloneableTags[float64Tag]=cloneableTags[int8Tag]=cloneableTags[int16Tag]=cloneableTags[int32Tag]=cloneableTags[numberTag]=cloneableTags[objectTag]=cloneableTags[regexpTag]=cloneableTags[stringTag]=cloneableTags[uint8Tag]=cloneableTags[uint8ClampedTag]=cloneableTags[uint16Tag]=cloneableTags[uint32Tag]=!0,cloneableTags[errorTag]=cloneableTags[funcTag]=cloneableTags[mapTag]=cloneableTags[setTag]=cloneableTags[weakMapTag]=!1;var debounceOptions={leading:!1,maxWait:0,trailing:!1},deburredLetters={"\xc0":"A","\xc1":"A","\xc2":"A","\xc3":"A","\xc4":"A","\xc5":"A","\xe0":"a","\xe1":"a","\xe2":"a","\xe3":"a","\xe4":"a","\xe5":"a","\xc7":"C","\xe7":"c","\xd0":"D","\xf0":"d","\xc8":"E","\xc9":"E","\xca":"E","\xcb":"E","\xe8":"e","\xe9":"e","\xea":"e","\xeb":"e","\xcc":"I","\xcd":"I","\xce":"I","\xcf":"I","\xec":"i","\xed":"i","\xee":"i","\xef":"i","\xd1":"N","\xf1":"n","\xd2":"O","\xd3":"O","\xd4":"O","\xd5":"O","\xd6":"O","\xd8":"O","\xf2":"o","\xf3":"o","\xf4":"o","\xf5":"o","\xf6":"o","\xf8":"o","\xd9":"U","\xda":"U","\xdb":"U","\xdc":"U","\xf9":"u","\xfa":"u","\xfb":"u","\xfc":"u","\xdd":"Y","\xfd":"y","\xff":"y","\xc6":"Ae","\xe6":"ae","\xde":"Th","\xfe":"th","\xdf":"ss"},htmlEscapes={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","`":"&#96;"},htmlUnescapes={"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'","&#96;":"`"},objectTypes={"function":!0,object:!0},stringEscapes={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},freeExports=objectTypes[typeof exports]&&exports&&!exports.nodeType&&exports,freeModule=objectTypes[typeof module]&&module&&!module.nodeType&&module,freeGlobal=freeExports&&freeModule&&"object"==typeof global&&global&&global.Object&&global,freeSelf=objectTypes[typeof self]&&self&&self.Object&&self,freeWindow=objectTypes[typeof window]&&window&&window.Object&&window,moduleExports=freeModule&&freeModule.exports===freeExports&&freeExports,root=freeGlobal||freeWindow!==(this&&this.window)&&freeWindow||freeSelf||this,_=runInContext();"function"==typeof define&&"object"==typeof define.amd&&define.amd?(root._=_,define(function(){return _})):freeExports&&freeModule?moduleExports?(freeModule.exports=_)._=_:freeExports._=_:root._=_}.call(this),function(a){function b(a,b){var c=(65535&a)+(65535&b),d=(a>>16)+(b>>16)+(c>>16);return d<<16|65535&c}function c(a,b){return a<<b|a>>>32-b}function d(a,d,e,f,g,h){return b(c(b(b(d,a),b(f,h)),g),e)}function e(a,b,c,e,f,g,h){return d(b&c|~b&e,a,b,f,g,h)}function f(a,b,c,e,f,g,h){return d(b&e|c&~e,a,b,f,g,h)}function g(a,b,c,e,f,g,h){return d(b^c^e,a,b,f,g,h)}function h(a,b,c,e,f,g,h){return d(c^(b|~e),a,b,f,g,h)}function i(a,c){a[c>>5]|=128<<c%32,a[(c+64>>>9<<4)+14]=c;var d,i,j,k,l,m=1732584193,n=-271733879,o=-1732584194,p=271733878;for(d=0;d<a.length;d+=16)i=m,j=n,k=o,l=p,m=e(m,n,o,p,a[d],7,-680876936),p=e(p,m,n,o,a[d+1],12,-389564586),o=e(o,p,m,n,a[d+2],17,606105819),n=e(n,o,p,m,a[d+3],22,-1044525330),m=e(m,n,o,p,a[d+4],7,-176418897),p=e(p,m,n,o,a[d+5],12,1200080426),o=e(o,p,m,n,a[d+6],17,-1473231341),n=e(n,o,p,m,a[d+7],22,-45705983),m=e(m,n,o,p,a[d+8],7,1770035416),p=e(p,m,n,o,a[d+9],12,-1958414417),o=e(o,p,m,n,a[d+10],17,-42063),n=e(n,o,p,m,a[d+11],22,-1990404162),m=e(m,n,o,p,a[d+12],7,1804603682),p=e(p,m,n,o,a[d+13],12,-40341101),o=e(o,p,m,n,a[d+14],17,-1502002290),n=e(n,o,p,m,a[d+15],22,1236535329),m=f(m,n,o,p,a[d+1],5,-165796510),p=f(p,m,n,o,a[d+6],9,-1069501632),o=f(o,p,m,n,a[d+11],14,643717713),n=f(n,o,p,m,a[d],20,-373897302),m=f(m,n,o,p,a[d+5],5,-701558691),p=f(p,m,n,o,a[d+10],9,38016083),o=f(o,p,m,n,a[d+15],14,-660478335),n=f(n,o,p,m,a[d+4],20,-405537848),m=f(m,n,o,p,a[d+9],5,568446438),p=f(p,m,n,o,a[d+14],9,-1019803690),o=f(o,p,m,n,a[d+3],14,-187363961),n=f(n,o,p,m,a[d+8],20,1163531501),m=f(m,n,o,p,a[d+13],5,-1444681467),p=f(p,m,n,o,a[d+2],9,-51403784),o=f(o,p,m,n,a[d+7],14,1735328473),n=f(n,o,p,m,a[d+12],20,-1926607734),m=g(m,n,o,p,a[d+5],4,-378558),p=g(p,m,n,o,a[d+8],11,-2022574463),o=g(o,p,m,n,a[d+11],16,1839030562),n=g(n,o,p,m,a[d+14],23,-35309556),m=g(m,n,o,p,a[d+1],4,-1530992060),p=g(p,m,n,o,a[d+4],11,1272893353),o=g(o,p,m,n,a[d+7],16,-155497632),n=g(n,o,p,m,a[d+10],23,-1094730640),m=g(m,n,o,p,a[d+13],4,681279174),p=g(p,m,n,o,a[d],11,-358537222),o=g(o,p,m,n,a[d+3],16,-722521979),n=g(n,o,p,m,a[d+6],23,76029189),m=g(m,n,o,p,a[d+9],4,-640364487),p=g(p,m,n,o,a[d+12],11,-421815835),o=g(o,p,m,n,a[d+15],16,530742520),n=g(n,o,p,m,a[d+2],23,-995338651),m=h(m,n,o,p,a[d],6,-198630844),p=h(p,m,n,o,a[d+7],10,1126891415),o=h(o,p,m,n,a[d+14],15,-1416354905),n=h(n,o,p,m,a[d+5],21,-57434055),m=h(m,n,o,p,a[d+12],6,1700485571),p=h(p,m,n,o,a[d+3],10,-1894986606),o=h(o,p,m,n,a[d+10],15,-1051523),n=h(n,o,p,m,a[d+1],21,-2054922799),m=h(m,n,o,p,a[d+8],6,1873313359),p=h(p,m,n,o,a[d+15],10,-30611744),o=h(o,p,m,n,a[d+6],15,-1560198380),n=h(n,o,p,m,a[d+13],21,1309151649),m=h(m,n,o,p,a[d+4],6,-145523070),p=h(p,m,n,o,a[d+11],10,-1120210379),o=h(o,p,m,n,a[d+2],15,718787259),n=h(n,o,p,m,a[d+9],21,-343485551),m=b(m,i),n=b(n,j),o=b(o,k),p=b(p,l);return[m,n,o,p]}function j(a){var b,c="";for(b=0;b<32*a.length;b+=8)c+=String.fromCharCode(a[b>>5]>>>b%32&255);return c}function k(a){var b,c=[];for(c[(a.length>>2)-1]=void 0,b=0;b<c.length;b+=1)c[b]=0;for(b=0;b<8*a.length;b+=8)c[b>>5]|=(255&a.charCodeAt(b/8))<<b%32;return c}function l(a){return j(i(k(a),8*a.length))}function m(a,b){var c,g,d=k(a),e=[],f=[];for(e[15]=f[15]=void 0,d.length>16&&(d=i(d,8*a.length)),c=0;16>c;c+=1)e[c]=909522486^d[c],f[c]=1549556828^d[c];return g=i(e.concat(k(b)),512+8*b.length),j(i(f.concat(g),640))}function n(a){var d,e,b="0123456789abcdef",c="";for(e=0;e<a.length;e+=1)d=a.charCodeAt(e),c+=b.charAt(d>>>4&15)+b.charAt(15&d);return c}function o(a){return unescape(encodeURIComponent(a))}function p(a){return l(o(a))}function q(a){return n(p(a))}function r(a,b){return m(o(a),o(b))}function s(a,b){return n(r(a,b))}function t(a,b,c){return b?c?r(b,a):s(b,a):c?p(a):q(a)}"function"==typeof define&&define.amd?define(function(){return t}):a.md5=t}(this),function(){var slice=[].slice;window.HAML=function(){function HAML(){}return HAML.escape=function(text){return(""+text).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#39;").replace(/\//g,"&#47;")},HAML.cleanValue=function(text){switch(text){case null:case void 0:return"";case!0:case!1:return"\x93"+text;default:return text}},HAML.extend=function(){var i,key,len,obj,source,sources,val;for(obj=arguments[0],sources=2<=arguments.length?slice.call(arguments,1):[],i=0,len=sources.length;len>i;i++){source=sources[i];for(key in source)val=source[key],obj[key]=val}return obj},HAML.globals=function(){return{}},HAML.context=function(locals){return this.extend({},HAML.globals(),locals)},HAML.preserve=function(text){return text.replace(/\n/g,"&#x000A;")},HAML.findAndPreserve=function(text){var tags;return tags="textarea,pre".split(",").join("|"),text=text.replace(/\r/g,"").replace(RegExp("<("+tags+")>([\\s\\S]*?)<\\/\\1>","g"),function(str,tag,content){return"<"+tag+">"+window.HAML.preserve(content)+"</"+tag+">"})},HAML.surround=function(start,end,fn){var ref;return start+(null!=(ref=fn.call(this))?ref.replace(/^\s+|\s+$/g,""):void 0)+end},HAML.succeed=function(end,fn){var ref;return(null!=(ref=fn.call(this))?ref.replace(/\s+$/g,""):void 0)+end},HAML.precede=function(start,fn){var ref;return start+(null!=(ref=fn.call(this))?ref.replace(/^\s+/g,""):void 0)},HAML.reference=function(object,prefix){var id,name,ref,result;return name=prefix?prefix+"_":"",name+="function"==typeof object.hamlObjectRef?object.hamlObjectRef():((null!=(ref=object.constructor)?ref.name:void 0)||"object").replace(/\W+/g,"_").replace(/([a-z\d])([A-Z])/g,"$1_$2").toLowerCase(),id="function"==typeof object.to_key?object.to_key():"function"==typeof object.id?object.id():object.id?object.id:object,result="class='"+name+"'",id?result+=" id='"+name+"_"+id+"'":void 0},HAML}()}.call(this),function($){function swipeDirection(x1,x2,y1,y2){return Math.abs(x1-x2)>=Math.abs(y1-y2)?x1-x2>0?"Left":"Right":y1-y2>0?"Up":"Down"}function longTap(){longTapTimeout=null,touch.last&&(touch.el.trigger("longTap"),touch={})}function cancelLongTap(){longTapTimeout&&clearTimeout(longTapTimeout),longTapTimeout=null}function cancelAll(){touchTimeout&&clearTimeout(touchTimeout),tapTimeout&&clearTimeout(tapTimeout),swipeTimeout&&clearTimeout(swipeTimeout),longTapTimeout&&clearTimeout(longTapTimeout),touchTimeout=tapTimeout=swipeTimeout=longTapTimeout=null,touch={}}function isPrimaryTouch(event){return("touch"==event.pointerType||event.pointerType==event.MSPOINTER_TYPE_TOUCH)&&event.isPrimary}function isPointerEventType(e,type){return e.type=="pointer"+type||e.type.toLowerCase()=="mspointer"+type}var touchTimeout,tapTimeout,swipeTimeout,longTapTimeout,gesture,touch={},longTapDelay=750;$(document).ready(function(){var now,delta,firstTouch,_isPointerType,deltaX=0,deltaY=0;"MSGesture"in window&&(gesture=new MSGesture,gesture.target=document.body),$(document).bind("MSGestureEnd",function(e){var swipeDirectionFromVelocity=e.velocityX>1?"Right":e.velocityX<-1?"Left":e.velocityY>1?"Down":e.velocityY<-1?"Up":null;swipeDirectionFromVelocity&&(touch.el.trigger("swipe"),touch.el.trigger("swipe"+swipeDirectionFromVelocity))}).on("touchstart MSPointerDown pointerdown",function(e){e=e.originalEvent,(!(_isPointerType=isPointerEventType(e,"down"))||isPrimaryTouch(e))&&(firstTouch=_isPointerType?e:e.touches[0],e.touches&&1===e.touches.length&&touch.x2&&(touch.x2=void 0,touch.y2=void 0),now=Date.now(),delta=now-(touch.last||now),touch.el=$("tagName"in firstTouch.target?firstTouch.target:firstTouch.target.parentNode),touchTimeout&&clearTimeout(touchTimeout),touch.x1=firstTouch.pageX,touch.y1=firstTouch.pageY,delta>0&&250>=delta&&(touch.isDoubleTap=!0),touch.last=now,longTapTimeout=setTimeout(longTap,longTapDelay),gesture&&_isPointerType&&gesture.addPointer(e.pointerId))}).on("touchmove MSPointerMove pointermove",function(e){e=e.originalEvent,(!(_isPointerType=isPointerEventType(e,"move"))||isPrimaryTouch(e))&&(firstTouch=_isPointerType?e:e.touches[0],cancelLongTap(),touch.x2=firstTouch.pageX,touch.y2=firstTouch.pageY,deltaX+=Math.abs(touch.x1-touch.x2),deltaY+=Math.abs(touch.y1-touch.y2))}).on("touchend MSPointerUp pointerup",function(e){(!(_isPointerType=isPointerEventType(e,"up"))||isPrimaryTouch(e))&&(cancelLongTap(),touch.x2&&Math.abs(touch.x1-touch.x2)>30||touch.y2&&Math.abs(touch.y1-touch.y2)>30?swipeTimeout=setTimeout(function(){touch.el.trigger("swipe"),touch.el.trigger("swipe"+swipeDirection(touch.x1,touch.x2,touch.y1,touch.y2)),
touch={}},0):"last"in touch&&(30>deltaX&&30>deltaY?tapTimeout=setTimeout(function(){var event=$.Event("tap");event.cancelTouch=cancelAll,touch.el.trigger(event),touch.isDoubleTap?(touch.el&&touch.el.trigger("doubleTap"),touch={}):touchTimeout=setTimeout(function(){touchTimeout=null,touch.el&&touch.el.trigger("singleTap"),touch={}},250)},0):touch={}),deltaX=deltaY=0)}).on("touchcancel MSPointerCancel pointercancel",cancelAll),$(window).on("scroll",cancelAll)}),["swipe","swipeLeft","swipeRight","swipeUp","swipeDown","doubleTap","tap","singleTap","longTap"].forEach(function(eventName){$.fn[eventName]=function(callback){return this.on(eventName,callback)}})}(jQuery),function(){var Backbone,root=this,previousBackbone=root.Backbone,array=[],slice=(array.push,array.slice);array.splice;Backbone="undefined"!=typeof exports?exports:root.Backbone={},Backbone.VERSION="1.1.0";var _=root._;_||"undefined"==typeof require||(_=require("underscore")),Backbone.$=root.jQuery||root.Zepto||root.ender||root.$,Backbone.noConflict=function(){return root.Backbone=previousBackbone,this},Backbone.emulateHTTP=!1,Backbone.emulateJSON=!1;var Events=Backbone.Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var events=this._events[name]||(this._events[name]=[]);return events.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context)},off:function(name,callback,context){var retain,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events={},this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],events=this._events[name]){if(this._events[name]=retain=[],callback||context)for(j=0,k=events.length;k>j;j++)ev=events[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&retain.push(ev);retain.length||delete this._events[name]}return this},trigger:function(name){if(!this._events)return this;var args=slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},stopListening:function(obj,name,callback){var listeningTo=this._listeningTo;if(!listeningTo)return this;var remove=!name&&!callback;callback||"object"!=typeof name||(callback=this),obj&&((listeningTo={})[obj._listenId]=obj);for(var id in listeningTo)obj=listeningTo[id],obj.off(name,callback,this),(remove||_.isEmpty(obj._events))&&delete this._listeningTo[id];return this}},eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name){for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));return!1}if(eventSplitter.test(name)){for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest));return!1}return!0},triggerEvents=function(events,args){var ev,i=-1,l=events.length,a1=args[0],a2=args[1],a3=args[2];switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,a1,a2,a3);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}},listenMethods={listenTo:"on",listenToOnce:"once"};_.each(listenMethods,function(implementation,method){Events[method]=function(obj,name,callback){var listeningTo=this._listeningTo||(this._listeningTo={}),id=obj._listenId||(obj._listenId=_.uniqueId("l"));return listeningTo[id]=obj,callback||"object"!=typeof name||(callback=this),obj[implementation](name,callback,this),this}}),Events.bind=Events.on,Events.unbind=Events.off,_.extend(Backbone,Events);var Model=Backbone.Model=function(attributes,options){var attrs=attributes||{};options||(options={}),this.cid=_.uniqueId("c"),this.attributes={},options.collection&&(this.collection=options.collection),options.parse&&(attrs=this.parse(attrs,options)||{}),attrs=_.defaults({},attrs,_.result(this,"defaults")),this.set(attrs,options),this.changed={},this.initialize.apply(this,arguments)};_.extend(Model.prototype,Events,{changed:null,validationError:null,idAttribute:"id",initialize:function(){},toJSON:function(options){return _.clone(this.attributes)},sync:function(){return Backbone.sync.apply(this,arguments)},get:function(attr){return this.attributes[attr]},escape:function(attr){return _.escape(this.get(attr))},has:function(attr){return null!=this.get(attr)},set:function(key,val,options){var attr,attrs,unset,changes,silent,changing,prev,current;if(null==key)return this;if("object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options||(options={}),!this._validate(attrs,options))return!1;unset=options.unset,silent=options.silent,changes=[],changing=this._changing,this._changing=!0,changing||(this._previousAttributes=_.clone(this.attributes),this.changed={}),current=this.attributes,prev=this._previousAttributes,this.idAttribute in attrs&&(this.id=attrs[this.idAttribute]);for(attr in attrs)val=attrs[attr],_.isEqual(current[attr],val)||changes.push(attr),_.isEqual(prev[attr],val)?delete this.changed[attr]:this.changed[attr]=val,unset?delete current[attr]:current[attr]=val;if(!silent){changes.length&&(this._pending=!0);for(var i=0,l=changes.length;l>i;i++)this.trigger("change:"+changes[i],this,current[changes[i]],options)}if(changing)return this;if(!silent)for(;this._pending;)this._pending=!1,this.trigger("change",this,options);return this._pending=!1,this._changing=!1,this},unset:function(attr,options){return this.set(attr,void 0,_.extend({},options,{unset:!0}))},clear:function(options){var attrs={};for(var key in this.attributes)attrs[key]=void 0;return this.set(attrs,_.extend({},options,{unset:!0}))},hasChanged:function(attr){return null==attr?!_.isEmpty(this.changed):_.has(this.changed,attr)},changedAttributes:function(diff){if(!diff)return this.hasChanged()?_.clone(this.changed):!1;var val,changed=!1,old=this._changing?this._previousAttributes:this.attributes;for(var attr in diff)_.isEqual(old[attr],val=diff[attr])||((changed||(changed={}))[attr]=val);return changed},previous:function(attr){return null!=attr&&this._previousAttributes?this._previousAttributes[attr]:null},previousAttributes:function(){return _.clone(this._previousAttributes)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){return model.set(model.parse(resp,options),options)?(success&&success(model,resp,options),void model.trigger("sync",model,resp,options)):!1},wrapError(this,options),this.sync("read",this,options)},save:function(key,val,options){var attrs,method,xhr,attributes=this.attributes;if(null==key||"object"==typeof key?(attrs=key,options=val):(attrs={})[key]=val,options=_.extend({validate:!0},options),attrs&&!options.wait){if(!this.set(attrs,options))return!1}else if(!this._validate(attrs,options))return!1;attrs&&options.wait&&(this.attributes=_.extend({},attributes,attrs)),void 0===options.parse&&(options.parse=!0);var model=this,success=options.success;return options.success=function(resp){model.attributes=attributes;var serverAttrs=model.parse(resp,options);return options.wait&&(serverAttrs=_.extend(attrs||{},serverAttrs)),_.isObject(serverAttrs)&&!model.set(serverAttrs,options)?!1:(success&&success(model,resp,options),void model.trigger("sync",model,resp,options))},wrapError(this,options),method=this.isNew()?"create":options.patch?"patch":"update","patch"===method&&(options.attrs=attrs),xhr=this.sync(method,this,options),attrs&&options.wait&&(this.attributes=attributes),xhr},destroy:function(options){options=options?_.clone(options):{};var model=this,success=options.success,destroy=function(){model.trigger("destroy",model,model.collection,options)};if(options.success=function(resp){(options.wait||model.isNew())&&destroy(),success&&success(model,resp,options),model.isNew()||model.trigger("sync",model,resp,options)},this.isNew())return options.success(),!1;wrapError(this,options);var xhr=this.sync("delete",this,options);return options.wait||destroy(),xhr},url:function(){var base=_.result(this,"urlRoot")||_.result(this.collection,"url")||urlError();return this.isNew()?base:base+("/"===base.charAt(base.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},isValid:function(options){return this._validate({},_.extend(options||{},{validate:!0}))},_validate:function(attrs,options){if(!options.validate||!this.validate)return!0;attrs=_.extend({},this.attributes,attrs);var error=this.validationError=this.validate(attrs,options)||null;return error?(this.trigger("invalid",this,error,_.extend(options,{validationError:error})),!1):!0}});var modelMethods=["keys","values","pairs","invert","pick","omit"];_.each(modelMethods,function(method){Model.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.attributes),_[method].apply(_,args)}});var Collection=Backbone.Collection=function(models,options){options||(options={}),options.model&&(this.model=options.model),void 0!==options.comparator&&(this.comparator=options.comparator),this._reset(),this.initialize.apply(this,arguments),models&&this.reset(models,_.extend({silent:!0},options))},setOptions={add:!0,remove:!0,merge:!0},addOptions={add:!0,remove:!1};_.extend(Collection.prototype,Events,{model:Model,initialize:function(){},toJSON:function(options){return this.map(function(model){return model.toJSON(options)})},sync:function(){return Backbone.sync.apply(this,arguments)},add:function(models,options){return this.set(models,_.extend({merge:!1},options,addOptions))},remove:function(models,options){var singular=!_.isArray(models);models=singular?[models]:_.clone(models),options||(options={});var i,l,index,model;for(i=0,l=models.length;l>i;i++)model=models[i]=this.get(models[i]),model&&(delete this._byId[model.id],delete this._byId[model.cid],index=this.indexOf(model),this.models.splice(index,1),this.length--,options.silent||(options.index=index,model.trigger("remove",model,this,options)),this._removeReference(model));return singular?models[0]:models},set:function(models,options){options=_.defaults({},options,setOptions),options.parse&&(models=this.parse(models,options));var singular=!_.isArray(models);models=singular?models?[models]:[]:_.clone(models);var i,l,id,model,attrs,existing,sort,at=options.at,targetModel=this.model,sortable=this.comparator&&null==at&&options.sort!==!1,sortAttr=_.isString(this.comparator)?this.comparator:null,toAdd=[],toRemove=[],modelMap={},add=options.add,merge=options.merge,remove=options.remove,order=!sortable&&add&&remove?[]:!1;for(i=0,l=models.length;l>i;i++){if(attrs=models[i],id=attrs instanceof Model?model=attrs:attrs[targetModel.prototype.idAttribute],existing=this.get(id))remove&&(modelMap[existing.cid]=!0),merge&&(attrs=attrs===model?model.attributes:attrs,options.parse&&(attrs=existing.parse(attrs,options)),existing.set(attrs,options),sortable&&!sort&&existing.hasChanged(sortAttr)&&(sort=!0)),models[i]=existing;else if(add){if(model=models[i]=this._prepareModel(attrs,options),!model)continue;toAdd.push(model),model.on("all",this._onModelEvent,this),this._byId[model.cid]=model,null!=model.id&&(this._byId[model.id]=model)}order&&order.push(existing||model)}if(remove){for(i=0,l=this.length;l>i;++i)modelMap[(model=this.models[i]).cid]||toRemove.push(model);toRemove.length&&this.remove(toRemove,options)}if(toAdd.length||order&&order.length)if(sortable&&(sort=!0),this.length+=toAdd.length,null!=at)for(i=0,l=toAdd.length;l>i;i++)this.models.splice(at+i,0,toAdd[i]);else{order&&(this.models.length=0);var orderedModels=order||toAdd;for(i=0,l=orderedModels.length;l>i;i++)this.models.push(orderedModels[i])}if(sort&&this.sort({silent:!0}),!options.silent){for(i=0,l=toAdd.length;l>i;i++)(model=toAdd[i]).trigger("add",model,this,options);(sort||order&&order.length)&&this.trigger("sort",this,options)}return singular?models[0]:models},reset:function(models,options){options||(options={});for(var i=0,l=this.models.length;l>i;i++)this._removeReference(this.models[i]);return options.previousModels=this.models,this._reset(),models=this.add(models,_.extend({silent:!0},options)),options.silent||this.trigger("reset",this,options),models},push:function(model,options){return this.add(model,_.extend({at:this.length},options))},pop:function(options){var model=this.at(this.length-1);return this.remove(model,options),model},unshift:function(model,options){return this.add(model,_.extend({at:0},options))},shift:function(options){var model=this.at(0);return this.remove(model,options),model},slice:function(){return slice.apply(this.models,arguments)},get:function(obj){return null==obj?void 0:this._byId[obj.id]||this._byId[obj.cid]||this._byId[obj]},at:function(index){return this.models[index]},where:function(attrs,first){return _.isEmpty(attrs)?first?void 0:[]:this[first?"find":"filter"](function(model){for(var key in attrs)if(attrs[key]!==model.get(key))return!1;return!0})},findWhere:function(attrs){return this.where(attrs,!0)},sort:function(options){if(!this.comparator)throw new Error("Cannot sort a set without a comparator");return options||(options={}),_.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(_.bind(this.comparator,this)),options.silent||this.trigger("sort",this,options),this},pluck:function(attr){return _.invoke(this.models,"get",attr)},fetch:function(options){options=options?_.clone(options):{},void 0===options.parse&&(options.parse=!0);var success=options.success,collection=this;return options.success=function(resp){var method=options.reset?"reset":"set";collection[method](resp,options),success&&success(collection,resp,options),collection.trigger("sync",collection,resp,options)},wrapError(this,options),this.sync("read",this,options)},create:function(model,options){if(options=options?_.clone(options):{},!(model=this._prepareModel(model,options)))return!1;options.wait||this.add(model,options);var collection=this,success=options.success;return options.success=function(model,resp,options){options.wait&&collection.add(model,options),success&&success(model,resp,options)},model.save(null,options),model},parse:function(resp,options){return resp},clone:function(){return new this.constructor(this.models)},_reset:function(){this.length=0,this.models=[],this._byId={}},_prepareModel:function(attrs,options){if(attrs instanceof Model)return attrs.collection||(attrs.collection=this),attrs;options=options?_.clone(options):{},options.collection=this;var model=new this.model(attrs,options);return model.validationError?(this.trigger("invalid",this,model.validationError,options),!1):model},_removeReference:function(model){this===model.collection&&delete model.collection,model.off("all",this._onModelEvent,this)},_onModelEvent:function(event,model,collection,options){("add"!==event&&"remove"!==event||collection===this)&&("destroy"===event&&this.remove(model,options),model&&event==="change:"+model.idAttribute&&(delete this._byId[model.previous(model.idAttribute)],null!=model.id&&(this._byId[model.id]=model)),this.trigger.apply(this,arguments))}});var methods=["forEach","each","map","collect","reduce","foldl","inject","reduceRight","foldr","find","detect","filter","select","reject","every","all","some","any","include","contains","invoke","max","min","toArray","size","first","head","take","initial","rest","tail","drop","last","without","difference","indexOf","shuffle","lastIndexOf","isEmpty","chain"];_.each(methods,function(method){Collection.prototype[method]=function(){var args=slice.call(arguments);return args.unshift(this.models),_[method].apply(_,args)}});var attributeMethods=["groupBy","countBy","sortBy"];_.each(attributeMethods,function(method){Collection.prototype[method]=function(value,context){var iterator=_.isFunction(value)?value:function(model){return model.get(value)};return _[method](this.models,iterator,context)}});var View=Backbone.View=function(options){this.cid=_.uniqueId("view"),options||(options={}),_.extend(this,_.pick(options,viewOptions)),this._ensureElement(),this.initialize.apply(this,arguments),this.delegateEvents()},delegateEventSplitter=/^(\S+)\s*(.*)$/,viewOptions=["model","collection","el","id","attributes","className","tagName","events"];_.extend(View.prototype,Events,{tagName:"div",$:function(selector){return this.$el.find(selector)},initialize:function(){},render:function(){return this},remove:function(){return this.$el.remove(),this.stopListening(),this},setElement:function(element,delegate){return this.$el&&this.undelegateEvents(),this.$el=element instanceof Backbone.$?element:Backbone.$(element),this.el=this.$el[0],delegate!==!1&&this.delegateEvents(),this},delegateEvents:function(events){if(!events&&!(events=_.result(this,"events")))return this;this.undelegateEvents();for(var key in events){var method=events[key];if(_.isFunction(method)||(method=this[events[key]]),method){var match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2];method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?this.$el.on(eventName,method):this.$el.on(eventName,selector,method)}}return this},undelegateEvents:function(){return this.$el.off(".delegateEvents"+this.cid),this},_ensureElement:function(){if(this.el)this.setElement(_.result(this,"el"),!1);else{var attrs=_.extend({},_.result(this,"attributes"));this.id&&(attrs.id=_.result(this,"id")),this.className&&(attrs["class"]=_.result(this,"className"));var $el=Backbone.$("<"+_.result(this,"tagName")+">").attr(attrs);this.setElement($el,!1)}}}),Backbone.sync=function(method,model,options){var type=methodMap[method];_.defaults(options||(options={}),{emulateHTTP:Backbone.emulateHTTP,emulateJSON:Backbone.emulateJSON});var params={type:type,dataType:"json"};if(options.url||(params.url=_.result(model,"url")||urlError()),null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(params.contentType="application/json",params.data=JSON.stringify(options.attrs||model.toJSON(options))),options.emulateJSON&&(params.contentType="application/x-www-form-urlencoded",params.data=params.data?{model:params.data}:{}),options.emulateHTTP&&("PUT"===type||"DELETE"===type||"PATCH"===type)){params.type="POST",options.emulateJSON&&(params.data._method=type);var beforeSend=options.beforeSend;options.beforeSend=function(xhr){return xhr.setRequestHeader("X-HTTP-Method-Override",type),beforeSend?beforeSend.apply(this,arguments):void 0}}"GET"===params.type||options.emulateJSON||(params.processData=!1),"PATCH"===params.type&&noXhrPatch&&(params.xhr=function(){return new ActiveXObject("Microsoft.XMLHTTP")});var xhr=options.xhr=Backbone.ajax(_.extend(params,options));return model.trigger("request",model,xhr,options),xhr};var noXhrPatch=!("undefined"==typeof window||!window.ActiveXObject||window.XMLHttpRequest&&(new XMLHttpRequest).dispatchEvent),methodMap={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};Backbone.ajax=function(){return Backbone.$.ajax.apply(Backbone.$,arguments)};var Router=Backbone.Router=function(options){options||(options={}),options.routes&&(this.routes=options.routes),this._bindRoutes(),this.initialize.apply(this,arguments)},optionalParam=/\((.*?)\)/g,namedParam=/(\(\?)?:\w+/g,splatParam=/\*\w+/g,escapeRegExp=/[\-{}\[\]+?.,\\\^$|#\s]/g;_.extend(Router.prototype,Events,{initialize:function(){},route:function(route,name,callback){_.isRegExp(route)||(route=this._routeToRegExp(route)),_.isFunction(name)&&(callback=name,name=""),callback||(callback=this[name]);var router=this;return Backbone.history.route(route,function(fragment){var args=router._extractParameters(route,fragment);callback&&callback.apply(router,args),router.trigger.apply(router,["route:"+name].concat(args)),router.trigger("route",name,args),Backbone.history.trigger("route",router,name,args)}),this},navigate:function(fragment,options){return Backbone.history.navigate(fragment,options),this},_bindRoutes:function(){if(this.routes){this.routes=_.result(this,"routes");for(var route,routes=_.keys(this.routes);null!=(route=routes.pop());)this.route(route,this.routes[route])}},_routeToRegExp:function(route){return route=route.replace(escapeRegExp,"\\$&").replace(optionalParam,"(?:$1)?").replace(namedParam,function(match,optional){return optional?match:"([^/]+)"}).replace(splatParam,"(.*?)"),new RegExp("^"+route+"$")},_extractParameters:function(route,fragment){var params=route.exec(fragment).slice(1);return _.map(params,function(param){return param?decodeURIComponent(param):null})}});var History=Backbone.History=function(){this.handlers=[],_.bindAll(this,"checkUrl"),"undefined"!=typeof window&&(this.location=window.location,this.history=window.history)},routeStripper=/^[#\/]|\s+$/g,rootStripper=/^\/+|\/+$/g,isExplorer=/msie [\w.]+/,trailingSlash=/\/$/,pathStripper=/[?#].*$/;History.started=!1,_.extend(History.prototype,Events,{interval:50,getHash:function(window){var match=(window||this).location.href.match(/#(.*)$/);return match?match[1]:""},getFragment:function(fragment,forcePushState){if(null==fragment)if(this._hasPushState||!this._wantsHashChange||forcePushState){fragment=this.location.pathname;var root=this.root.replace(trailingSlash,"");fragment.indexOf(root)||(fragment=fragment.slice(root.length))}else fragment=this.getHash();return fragment.replace(routeStripper,"")},start:function(options){if(History.started)throw new Error("Backbone.history has already been started");History.started=!0,this.options=_.extend({root:"/"},this.options,options),this.root=this.options.root,this._wantsHashChange=this.options.hashChange!==!1,this._wantsPushState=!!this.options.pushState,this._hasPushState=!!(this.options.pushState&&this.history&&this.history.pushState);var fragment=this.getFragment(),docMode=document.documentMode,oldIE=isExplorer.exec(navigator.userAgent.toLowerCase())&&(!docMode||7>=docMode);this.root=("/"+this.root+"/").replace(rootStripper,"/"),oldIE&&this._wantsHashChange&&(this.iframe=Backbone.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(fragment)),this._hasPushState?Backbone.$(window).on("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange"in window&&!oldIE?Backbone.$(window).on("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval)),this.fragment=fragment;var loc=this.location,atRoot=loc.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState){if(!this._hasPushState&&!atRoot)return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0;this._hasPushState&&atRoot&&loc.hash&&(this.fragment=this.getHash().replace(routeStripper,""),this.history.replaceState({},document.title,this.root+this.fragment+loc.search))}return this.options.silent?void 0:this.loadUrl()},stop:function(){Backbone.$(window).off("popstate",this.checkUrl).off("hashchange",this.checkUrl),clearInterval(this._checkUrlInterval),History.started=!1},route:function(route,callback){this.handlers.unshift({route:route,callback:callback})},checkUrl:function(e){var current=this.getFragment();return current===this.fragment&&this.iframe&&(current=this.getFragment(this.getHash(this.iframe))),current===this.fragment?!1:(this.iframe&&this.navigate(current),void this.loadUrl())},loadUrl:function(fragment){return fragment=this.fragment=this.getFragment(fragment),_.any(this.handlers,function(handler){return handler.route.test(fragment)?(handler.callback(fragment),!0):void 0})},navigate:function(fragment,options){if(!History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(fragment=fragment.replace(pathStripper,""),this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},_updateHash:function(location,fragment,replace){if(replace){var href=location.href.replace(/(javascript:|#).*$/,"");location.replace(href+"#"+fragment)}else location.hash="#"+fragment}}),Backbone.history=new History;var extend=function(protoProps,staticProps){var child,parent=this;child=protoProps&&_.has(protoProps,"constructor")?protoProps.constructor:function(){return parent.apply(this,arguments)},_.extend(child,parent,staticProps);var Surrogate=function(){this.constructor=child};return Surrogate.prototype=parent.prototype,child.prototype=new Surrogate,protoProps&&_.extend(child.prototype,protoProps),child.__super__=parent.prototype,child};Model.extend=Collection.extend=Router.extend=View.extend=History.extend=extend;var urlError=function(){throw new Error('A "url" property or function must be specified')},wrapError=function(model,options){var error=options.error;options.error=function(resp){error&&error(model,resp,options),model.trigger("error",model,resp,options)}}}.call(this),Backbone.History.prototype.navigate=function(fragment,options){if(!Backbone.History.started)return!1;options&&options!==!0||(options={trigger:!!options});var url=this.root+(fragment=this.getFragment(fragment||""));if(this.fragment!==fragment){if(this.fragment=fragment,""===fragment&&"/"!==url&&(url=url.slice(0,-1)),this._hasPushState)this.history[options.replace?"replaceState":"pushState"]({},document.title,url);else{if(!this._wantsHashChange)return this.location.assign(url);this._updateHash(this.location,fragment,options.replace),this.iframe&&fragment!==this.getFragment(this.getHash(this.iframe))&&(options.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,fragment,options.replace))}return options.trigger?this.loadUrl(fragment):void 0}},function($){Backbone._sync=Backbone.sync,Backbone.sync=function(method,model,options){if(!options.noCSRF){var beforeSend=options.beforeSend;options.beforeSend=function(xhr){var token=$('meta[name="csrf-token"]').attr("content");return token&&xhr.setRequestHeader("X-CSRF-Token",token),beforeSend?beforeSend.apply(this,arguments):void 0}}return null!=options.data||!model||"create"!==method&&"update"!==method&&"patch"!==method||(options.contentType="application/json",data=JSON.stringify(options.attrs||model.toJSON(options)),model.paramRoot?(data={},data[model.paramRoot]=model.toJSON(options)):data=model.toJSON(),options.data=JSON.stringify(data)),Backbone._sync(method,model,options)}}(jQuery),function($,Backbone){Backbone.InteractiveList=Backbone.View.extend({initialize:function(options){this.options=options,this.template=options.template,this.collection||(this.collection=new Backbone.Collection),this.collection.url=options.url},render:function(){var view=this,click=this.options.click,filter=this.options.filter,limit=this.options.limit;return this.refresh(function(){if(view.$el.empty(),0==this.collection.length)this.trigger("not-found");else{var lis=document.createDocumentFragment();_.each(this.collection.filter(function(model){return!_.isFunction(filter)||filter.call(view,model)}),function(model,i){if(!limit||limit>i){var $li=$(view.template(model.attributes));_.isFunction(click)&&$li.on("mousedown",function(){click.call(view,model,i)}).on("mouseover",function(){$(this).siblings().removeClass("selected"),$(this).addClass("selected")}),lis.appendChild($li[0])}}),view.$el.append(lis)}this.$el.show(),this.trigger("render")}),this},refresh:function(callback){var view=this;!this.collection.url||this.lastUrl&&this.lastUrl==_.result(this.collection.url)?callback.call(view):this.collection.fetch({success:function(){view.lastUrl=_.result(view.collection.url),callback.call(view)}})}}),Backbone.AutocompleteList=Backbone.View.extend({initialize:function(options){this.options=options;var view=this;this.timer=null,this.term=this.$el.val(),void 0===this.options.filter&&(this.options.filter=function(model){return-1!=view.options.value.call(model,model).toLowerCase().indexOf(view.$el.val().toLowerCase())}),this.options.click=this.options.click||_.bind(function(model){this.results.hide(),this.$selected().removeClass("selected"),this.$el.val(options.value.call(model,model)),this.term=this.$el.val(),this.$el.focus(),this.trigger("selected",model)},this),this.results=options.results||$("<div>",{"class":"autocomplete-results"}).css({position:"absolute",zIndex:1,left:this.$el.offset().left,top:this.$el.offset().top+this.$el.outerHeight(),width:this.$el.outerWidth()}).appendTo($("body")),this.resultsView=new Backbone.InteractiveList(_.defaults({el:this.results},this.options)).on("render",this.next,this)},events:{keyup:"keyup",keydown:"keydown",blur:"blur"},$selected:function(){return this.resultsView.$(".selected")},keyup:function(){var resultsView=this.resultsView;return this.term!=this.$el.val()&&(this.term=this.$el.val(),clearTimeout(this.timer),!this.options.minLength||this.term.length>=this.options.minLength?this.timer=setTimeout(function(){resultsView.render()},this.options.delay):this.results.hide()),!0},keydown:function(e){return 27==e.keyCode?(this.blur(),!1):(13==e.keyCode||9==e.keyCode)&&this.$selected().length>0?(this.$selected().mousedown(),!1):40==e.keyCode?(this.next(),!1):38==e.keyCode?(this.previous(),!1):!0},next:function(){var next=this.$selected().removeClass("selected").next();0==next.length&&(next=this.results.children().first()),next.addClass("selected"),this.scroll()},previous:function(){var prev=this.$selected().removeClass("selected").prev();0==prev.length&&(prev=this.results.children().last()),prev.addClass("selected"),this.scroll()},blur:function(e){var view=this;view.resultsView.trigger("hiding")},scroll:function(){1==this.$selected().length&&(this.$selected().position().top+this.$selected().height()>this.results.height()?this.results.scrollTop(this.results.scrollTop()+this.$selected().position().top+this.$selected().height()-this.results.height()):this.$selected().position().top<0&&this.results.scrollTop(this.results.scrollTop()+this.$selected().position().top))}})}(window.jQuery,window.Backbone),/*!
 * Knockout JavaScript library v3.2.0
 * (c) Steven Sanderson - http://knockoutjs.com/
 * License: MIT (http://www.opensource.org/licenses/mit-license.php)
 */
function(){!function(p){var s=this||(0,eval)("this"),v=s.document,L=s.navigator,w=s.jQuery,D=s.JSON;!function(p){"function"==typeof require&&"object"==typeof exports&&"object"==typeof module?p(module.exports||exports,require):"function"==typeof define&&define.amd?define(["exports","require"],p):p(s.ko={})}(function(M,N){function H(a,d){return null===a||typeof a in R?a===d:!1}function S(a,d){var c;return function(){c||(c=setTimeout(function(){c=p,a()},d))}}function T(a,d){var c;return function(){clearTimeout(c),c=setTimeout(a,d)}}function I(b,d,c,e){a.d[b]={init:function(b,h,k,f,m){var l,q;return a.s(function(){var f=a.a.c(h()),k=!c!=!f,z=!q;(z||d||k!==l)&&(z&&a.Y.la()&&(q=a.a.ia(a.f.childNodes(b),!0)),k?(z||a.f.T(b,a.a.ia(q)),a.Ca(e?e(m,f):m,b)):a.f.ja(b),l=k)},null,{o:b}),{controlsDescendantBindings:!0}}},a.h.ha[b]=!1,a.f.Q[b]=!0}var a="undefined"!=typeof M?M:{};a.b=function(b,d){for(var c=b.split("."),e=a,g=0;g<c.length-1;g++)e=e[c[g]];e[c[c.length-1]]=d},a.A=function(a,d,c){a[d]=c},a.version="3.2.0",a.b("version",a.version),a.a=function(){function b(a,b){for(var c in a)a.hasOwnProperty(c)&&b(c,a[c])}function d(a,b){if(b)for(var c in b)b.hasOwnProperty(c)&&(a[c]=b[c]);return a}function c(a,b){return a.__proto__=b,a}var e={__proto__:[]}instanceof Array,g={},h={};g[L&&/Firefox\/2/i.test(L.userAgent)?"KeyboardEvent":"UIEvents"]=["keyup","keydown","keypress"],g.MouseEvents="click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave".split(" "),b(g,function(a,b){if(b.length)for(var c=0,d=b.length;d>c;c++)h[b[c]]=a});var k={propertychange:!0},f=v&&function(){for(var a=3,b=v.createElement("div"),c=b.getElementsByTagName("i");b.innerHTML="<!--[if gt IE "+ ++a+"]><i></i><![endif]-->",c[0];);return a>4?a:p}();return{vb:["authenticity_token",/^__RequestVerificationToken(_.*)?$/],u:function(a,b){for(var c=0,d=a.length;d>c;c++)b(a[c],c)},m:function(a,b){if("function"==typeof Array.prototype.indexOf)return Array.prototype.indexOf.call(a,b);for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1},qb:function(a,b,c){for(var d=0,f=a.length;f>d;d++)if(b.call(c,a[d],d))return a[d];return null},ua:function(m,b){var c=a.a.m(m,b);c>0?m.splice(c,1):0===c&&m.shift()},rb:function(m){m=m||[];for(var b=[],c=0,d=m.length;d>c;c++)0>a.a.m(b,m[c])&&b.push(m[c]);return b},Da:function(a,b){a=a||[];for(var c=[],d=0,f=a.length;f>d;d++)c.push(b(a[d],d));return c},ta:function(a,b){a=a||[];for(var c=[],d=0,f=a.length;f>d;d++)b(a[d],d)&&c.push(a[d]);return c},ga:function(a,b){if(b instanceof Array)a.push.apply(a,b);else for(var c=0,d=b.length;d>c;c++)a.push(b[c]);return a},ea:function(b,c,d){var f=a.a.m(a.a.Xa(b),c);0>f?d&&b.push(c):d||b.splice(f,1)},xa:e,extend:d,za:c,Aa:e?c:d,G:b,na:function(a,b){if(!a)return a;var d,c={};for(d in a)a.hasOwnProperty(d)&&(c[d]=b(a[d],d,a));return c},Ka:function(b){for(;b.firstChild;)a.removeNode(b.firstChild)},oc:function(b){b=a.a.S(b);for(var c=v.createElement("div"),d=0,f=b.length;f>d;d++)c.appendChild(a.R(b[d]));return c},ia:function(b,c){for(var d=0,f=b.length,e=[];f>d;d++){var k=b[d].cloneNode(!0);e.push(c?a.R(k):k)}return e},T:function(b,c){if(a.a.Ka(b),c)for(var d=0,f=c.length;f>d;d++)b.appendChild(c[d])},Lb:function(b,c){var d=b.nodeType?[b]:b;if(0<d.length){for(var f=d[0],e=f.parentNode,k=0,g=c.length;g>k;k++)e.insertBefore(c[k],f);for(k=0,g=d.length;g>k;k++)a.removeNode(d[k])}},ka:function(a,b){if(a.length){for(b=8===b.nodeType&&b.parentNode||b;a.length&&a[0].parentNode!==b;)a.shift();if(1<a.length){var c=a[0],d=a[a.length-1];for(a.length=0;c!==d;)if(a.push(c),c=c.nextSibling,!c)return;a.push(d)}}return a},Nb:function(a,b){7>f?a.setAttribute("selected",b):a.selected=b},cb:function(a){return null===a||a===p?"":a.trim?a.trim():a.toString().replace(/^[\s\xa0]+|[\s\xa0]+$/g,"")},vc:function(a,b){return a=a||"",b.length>a.length?!1:a.substring(0,b.length)===b},cc:function(a,b){if(a===b)return!0;if(11===a.nodeType)return!1;if(b.contains)return b.contains(3===a.nodeType?a.parentNode:a);if(b.compareDocumentPosition)return 16==(16&b.compareDocumentPosition(a));for(;a&&a!=b;)a=a.parentNode;return!!a},Ja:function(b){return a.a.cc(b,b.ownerDocument.documentElement)},ob:function(b){return!!a.a.qb(b,a.a.Ja)},t:function(a){return a&&a.tagName&&a.tagName.toLowerCase()},n:function(b,c,d){var e=f&&k[c];if(!e&&w)w(b).bind(c,d);else if(e||"function"!=typeof b.addEventListener){if("undefined"==typeof b.attachEvent)throw Error("Browser doesn't support addEventListener or attachEvent");var g=function(a){d.call(b,a)},h="on"+c;b.attachEvent(h,g),a.a.w.da(b,function(){b.detachEvent(h,g)})}else b.addEventListener(c,d,!1)},oa:function(b,c){if(!b||!b.nodeType)throw Error("element must be a DOM node when calling triggerEvent");var d;if("input"===a.a.t(b)&&b.type&&"click"==c.toLowerCase()?(d=b.type,d="checkbox"==d||"radio"==d):d=!1,w&&!d)w(b).trigger(c);else if("function"==typeof v.createEvent){if("function"!=typeof b.dispatchEvent)throw Error("The supplied element doesn't support dispatchEvent");d=v.createEvent(h[c]||"HTMLEvents"),d.initEvent(c,!0,!0,s,0,0,0,0,0,!1,!1,!1,!1,0,b),b.dispatchEvent(d)}else if(d&&b.click)b.click();else{if("undefined"==typeof b.fireEvent)throw Error("Browser doesn't support triggering events");b.fireEvent("on"+c)}},c:function(b){return a.C(b)?b():b},Xa:function(b){return a.C(b)?b.v():b},Ba:function(b,c,d){if(c){var f=/\S+/g,e=b.className.match(f)||[];a.a.u(c.match(f),function(b){a.a.ea(e,b,d)}),b.className=e.join(" ")}},bb:function(b,c){var d=a.a.c(c);(null===d||d===p)&&(d="");var f=a.f.firstChild(b);!f||3!=f.nodeType||a.f.nextSibling(f)?a.f.T(b,[b.ownerDocument.createTextNode(d)]):f.data=d,a.a.fc(b)},Mb:function(a,b){if(a.name=b,7>=f)try{a.mergeAttributes(v.createElement("<input name='"+a.name+"'/>"),!1)}catch(c){}},fc:function(a){f>=9&&(a=1==a.nodeType?a:a.parentNode,a.style&&(a.style.zoom=a.style.zoom))},dc:function(a){if(f){var b=a.style.width;a.style.width=0,a.style.width=b}},sc:function(b,c){b=a.a.c(b),c=a.a.c(c);for(var d=[],f=b;c>=f;f++)d.push(f);return d},S:function(a){for(var b=[],c=0,d=a.length;d>c;c++)b.push(a[c]);return b},yc:6===f,zc:7===f,L:f,xb:function(b,c){for(var d=a.a.S(b.getElementsByTagName("input")).concat(a.a.S(b.getElementsByTagName("textarea"))),f="string"==typeof c?function(a){return a.name===c}:function(a){return c.test(a.name)},e=[],k=d.length-1;k>=0;k--)f(d[k])&&e.push(d[k]);return e},pc:function(b){return"string"==typeof b&&(b=a.a.cb(b))?D&&D.parse?D.parse(b):new Function("return "+b)():null},eb:function(b,c,d){if(!D||!D.stringify)throw Error("Cannot find JSON.stringify(). Some browsers (e.g., IE < 8) don't support it natively, but you can overcome this by adding a script reference to json2.js, downloadable from http://www.json.org/json2.js");return D.stringify(a.a.c(b),c,d)},qc:function(c,d,f){f=f||{};var e=f.params||{},k=f.includeFields||this.vb,g=c;if("object"==typeof c&&"form"===a.a.t(c))for(var g=c.action,h=k.length-1;h>=0;h--)for(var r=a.a.xb(c,k[h]),E=r.length-1;E>=0;E--)e[r[E].name]=r[E].value;d=a.a.c(d);var y=v.createElement("form");y.style.display="none",y.action=g,y.method="post";for(var p in d)c=v.createElement("input"),c.type="hidden",c.name=p,c.value=a.a.eb(a.a.c(d[p])),y.appendChild(c);b(e,function(a,b){var c=v.createElement("input");c.type="hidden",c.name=a,c.value=b,y.appendChild(c)}),v.body.appendChild(y),f.submitter?f.submitter(y):y.submit(),setTimeout(function(){y.parentNode.removeChild(y)},0)}}}(),a.b("utils",a.a),a.b("utils.arrayForEach",a.a.u),a.b("utils.arrayFirst",a.a.qb),a.b("utils.arrayFilter",a.a.ta),a.b("utils.arrayGetDistinctValues",a.a.rb),a.b("utils.arrayIndexOf",a.a.m),a.b("utils.arrayMap",a.a.Da),a.b("utils.arrayPushAll",a.a.ga),a.b("utils.arrayRemoveItem",a.a.ua),a.b("utils.extend",a.a.extend),a.b("utils.fieldsIncludedWithJsonPost",a.a.vb),a.b("utils.getFormFields",a.a.xb),a.b("utils.peekObservable",a.a.Xa),a.b("utils.postJson",a.a.qc),a.b("utils.parseJson",a.a.pc),a.b("utils.registerEventHandler",a.a.n),a.b("utils.stringifyJson",a.a.eb),a.b("utils.range",a.a.sc),a.b("utils.toggleDomNodeCssClass",a.a.Ba),a.b("utils.triggerEvent",a.a.oa),a.b("utils.unwrapObservable",a.a.c),a.b("utils.objectForEach",a.a.G),a.b("utils.addOrRemoveItem",a.a.ea),a.b("unwrap",a.a.c),Function.prototype.bind||(Function.prototype.bind=function(a){var d=this,c=Array.prototype.slice.call(arguments);return a=c.shift(),function(){return d.apply(a,c.concat(Array.prototype.slice.call(arguments)))}}),a.a.e=new function(){function a(b,h){var k=b[c];if(!k||"null"===k||!e[k]){if(!h)return p;k=b[c]="ko"+d++,e[k]={}}return e[k]}var d=0,c="__ko__"+(new Date).getTime(),e={};return{get:function(c,d){var e=a(c,!1);return e===p?p:e[d]},set:function(c,d,e){(e!==p||a(c,!1)!==p)&&(a(c,!0)[d]=e)},clear:function(a){var b=a[c];return b?(delete e[b],a[c]=null,!0):!1},F:function(){return d++ +c}}},a.b("utils.domData",a.a.e),a.b("utils.domData.clear",a.a.e.clear),a.a.w=new function(){function b(b,d){var f=a.a.e.get(b,c);return f===p&&d&&(f=[],a.a.e.set(b,c,f)),f}function d(c){var e=b(c,!1);if(e)for(var e=e.slice(0),f=0;f<e.length;f++)e[f](c);if(a.a.e.clear(c),a.a.w.cleanExternalData(c),g[c.nodeType])for(e=c.firstChild;c=e;)e=c.nextSibling,8===c.nodeType&&d(c)}var c=a.a.e.F(),e={1:!0,8:!0,9:!0},g={1:!0,9:!0};return{da:function(a,c){if("function"!=typeof c)throw Error("Callback must be a function");b(a,!0).push(c)},Kb:function(d,e){var f=b(d,!1);f&&(a.a.ua(f,e),0==f.length&&a.a.e.set(d,c,p))},R:function(b){if(e[b.nodeType]&&(d(b),g[b.nodeType])){var c=[];a.a.ga(c,b.getElementsByTagName("*"));for(var f=0,m=c.length;m>f;f++)d(c[f])}return b},removeNode:function(b){a.R(b),b.parentNode&&b.parentNode.removeChild(b)},cleanExternalData:function(a){w&&"function"==typeof w.cleanData&&w.cleanData([a])}}},a.R=a.a.w.R,a.removeNode=a.a.w.removeNode,a.b("cleanNode",a.R),a.b("removeNode",a.removeNode),a.b("utils.domNodeDisposal",a.a.w),a.b("utils.domNodeDisposal.addDisposeCallback",a.a.w.da),a.b("utils.domNodeDisposal.removeDisposeCallback",a.a.w.Kb),function(){a.a.ba=function(b){var d;if(w){if(w.parseHTML)d=w.parseHTML(b)||[];else if((d=w.clean([b]))&&d[0]){for(b=d[0];b.parentNode&&11!==b.parentNode.nodeType;)b=b.parentNode;b.parentNode&&b.parentNode.removeChild(b)}}else{var c=a.a.cb(b).toLowerCase();for(d=v.createElement("div"),c=c.match(/^<(thead|tbody|tfoot)/)&&[1,"<table>","</table>"]||!c.indexOf("<tr")&&[2,"<table><tbody>","</tbody></table>"]||(!c.indexOf("<td")||!c.indexOf("<th"))&&[3,"<table><tbody><tr>","</tr></tbody></table>"]||[0,"",""],b="ignored<div>"+c[1]+b+c[2]+"</div>","function"==typeof s.innerShiv?d.appendChild(s.innerShiv(b)):d.innerHTML=b;c[0]--;)d=d.lastChild;d=a.a.S(d.lastChild.childNodes)}return d},a.a.$a=function(b,d){if(a.a.Ka(b),d=a.a.c(d),null!==d&&d!==p)if("string"!=typeof d&&(d=d.toString()),w)w(b).html(d);else for(var c=a.a.ba(d),e=0;e<c.length;e++)b.appendChild(c[e])}}(),a.b("utils.parseHtmlFragment",a.a.ba),a.b("utils.setHtml",a.a.$a),a.D=function(){function b(c,d){if(c)if(8==c.nodeType){var g=a.D.Gb(c.nodeValue);null!=g&&d.push({bc:c,mc:g})}else if(1==c.nodeType)for(var g=0,h=c.childNodes,k=h.length;k>g;g++)b(h[g],d)}var d={};return{Ua:function(a){if("function"!=typeof a)throw Error("You can only pass a function to ko.memoization.memoize()");var b=(4294967296*(1+Math.random())|0).toString(16).substring(1)+(4294967296*(1+Math.random())|0).toString(16).substring(1);return d[b]=a,"<!--[ko_memo:"+b+"]-->"},Rb:function(a,b){var g=d[a];if(g===p)throw Error("Couldn't find any memo with ID "+a+". Perhaps it's already been unmemoized.");try{return g.apply(null,b||[]),!0}finally{delete d[a]}},Sb:function(c,d){var g=[];b(c,g);for(var h=0,k=g.length;k>h;h++){var f=g[h].bc,m=[f];d&&a.a.ga(m,d),a.D.Rb(g[h].mc,m),f.nodeValue="",f.parentNode&&f.parentNode.removeChild(f)}},Gb:function(a){return(a=a.match(/^\[ko_memo\:(.*?)\]$/))?a[1]:null}}}(),a.b("memoization",a.D),a.b("memoization.memoize",a.D.Ua),a.b("memoization.unmemoize",a.D.Rb),a.b("memoization.parseMemoText",a.D.Gb),a.b("memoization.unmemoizeDomNodeAndDescendants",a.D.Sb),a.La={throttle:function(b,d){b.throttleEvaluation=d;var c=null;return a.j({read:b,write:function(a){clearTimeout(c),c=setTimeout(function(){b(a)},d)}})},rateLimit:function(a,d){var c,e,g;"number"==typeof d?c=d:(c=d.timeout,e=d.method),g="notifyWhenChangesStop"==e?T:S,a.Ta(function(a){return g(a,c)})},notify:function(a,d){a.equalityComparer="always"==d?null:H}};var R={undefined:1,"boolean":1,number:1,string:1};a.b("extenders",a.La),a.Pb=function(b,d,c){this.target=b,this.wa=d,this.ac=c,this.Cb=!1,a.A(this,"dispose",this.K)},a.Pb.prototype.K=function(){this.Cb=!0,this.ac()},a.P=function(){a.a.Aa(this,a.P.fn),this.M={}};var G="change",A={U:function(b,d,c){var e=this;c=c||G;var g=new a.Pb(e,d?b.bind(d):b,function(){a.a.ua(e.M[c],g),e.nb&&e.nb()});return e.va&&e.va(c),e.M[c]||(e.M[c]=[]),e.M[c].push(g),g},notifySubscribers:function(b,d){if(d=d||G,this.Ab(d))try{a.k.Ea();for(var g,c=this.M[d].slice(0),e=0;g=c[e];++e)g.Cb||g.wa(b)}finally{a.k.end()}},Ta:function(b){var e,g,h,d=this,c=a.C(d);d.qa||(d.qa=d.notifySubscribers,d.notifySubscribers=function(a,b){b&&b!==G?"beforeChange"===b?d.kb(a):d.qa(a,b):d.lb(a)});var k=b(function(){c&&h===d&&(h=d()),e=!1,d.Pa(g,h)&&d.qa(g=h)});d.lb=function(a){e=!0,h=a,k()},d.kb=function(a){e||(g=a,d.qa(a,"beforeChange"))}},Ab:function(a){return this.M[a]&&this.M[a].length},yb:function(){var b=0;return a.a.G(this.M,function(a,c){b+=c.length}),b},Pa:function(a,d){return!this.equalityComparer||!this.equalityComparer(a,d)},extend:function(b){var d=this;return b&&a.a.G(b,function(b,e){var g=a.La[b];"function"==typeof g&&(d=g(d,e)||d)}),d}};a.A(A,"subscribe",A.U),a.A(A,"extend",A.extend),a.A(A,"getSubscriptionsCount",A.yb),a.a.xa&&a.a.za(A,Function.prototype),a.P.fn=A,a.Db=function(a){return null!=a&&"function"==typeof a.U&&"function"==typeof a.notifySubscribers},a.b("subscribable",a.P),a.b("isSubscribable",a.Db),a.Y=a.k=function(){function b(a){c.push(e),e=a}function d(){e=c.pop()}var e,c=[],g=0;return{Ea:b,end:d,Jb:function(b){if(e){if(!a.Db(b))throw Error("Only subscribable things can act as dependencies");e.wa(b,b.Vb||(b.Vb=++g))}},B:function(a,c,f){try{return b(),a.apply(c,f||[])}finally{d()}},la:function(){return e?e.s.la():void 0},ma:function(){return e?e.ma:void 0}}}(),a.b("computedContext",a.Y),a.b("computedContext.getDependenciesCount",a.Y.la),a.b("computedContext.isInitial",a.Y.ma),a.b("computedContext.isSleeping",a.Y.Ac),a.p=function(b){function d(){return 0<arguments.length?(d.Pa(c,arguments[0])&&(d.X(),c=arguments[0],d.W()),this):(a.k.Jb(d),c)}var c=b;return a.P.call(d),a.a.Aa(d,a.p.fn),d.v=function(){return c},d.W=function(){d.notifySubscribers(c)},d.X=function(){d.notifySubscribers(c,"beforeChange")},a.A(d,"peek",d.v),a.A(d,"valueHasMutated",d.W),a.A(d,"valueWillMutate",d.X),d},a.p.fn={equalityComparer:H};var F=a.p.rc="__ko_proto__";a.p.fn[F]=a.p,a.a.xa&&a.a.za(a.p.fn,a.P.fn),a.Ma=function(b,d){return null===b||b===p||b[F]===p?!1:b[F]===d?!0:a.Ma(b[F],d)},a.C=function(b){return a.Ma(b,a.p)},a.Ra=function(b){return"function"==typeof b&&b[F]===a.p||"function"==typeof b&&b[F]===a.j&&b.hc?!0:!1},a.b("observable",a.p),a.b("isObservable",a.C),a.b("isWriteableObservable",a.Ra),a.b("isWritableObservable",a.Ra),a.aa=function(b){if(b=b||[],"object"!=typeof b||!("length"in b))throw Error("The argument passed when initializing an observable array must be an array, or null, or undefined.");return b=a.p(b),a.a.Aa(b,a.aa.fn),b.extend({trackArrayChanges:!0})},a.aa.fn={remove:function(b){for(var d=this.v(),c=[],e="function"!=typeof b||a.C(b)?function(a){return a===b}:b,g=0;g<d.length;g++){var h=d[g];e(h)&&(0===c.length&&this.X(),c.push(h),d.splice(g,1),g--)}return c.length&&this.W(),c},removeAll:function(b){if(b===p){var d=this.v(),c=d.slice(0);return this.X(),d.splice(0,d.length),this.W(),c}return b?this.remove(function(c){return 0<=a.a.m(b,c)}):[]},destroy:function(b){var d=this.v(),c="function"!=typeof b||a.C(b)?function(a){return a===b}:b;this.X();for(var e=d.length-1;e>=0;e--)c(d[e])&&(d[e]._destroy=!0);this.W()},destroyAll:function(b){return b===p?this.destroy(function(){return!0}):b?this.destroy(function(d){return 0<=a.a.m(b,d)}):[]},indexOf:function(b){var d=this();return a.a.m(d,b)},replace:function(a,d){var c=this.indexOf(a);c>=0&&(this.X(),this.v()[c]=d,this.W())}},a.a.u("pop push reverse shift sort splice unshift".split(" "),function(b){a.aa.fn[b]=function(){var a=this.v();return this.X(),this.sb(a,b,arguments),a=a[b].apply(a,arguments),this.W(),a}}),a.a.u(["slice"],function(b){a.aa.fn[b]=function(){var a=this();return a[b].apply(a,arguments)}}),a.a.xa&&a.a.za(a.aa.fn,a.p.fn),a.b("observableArray",a.aa);var J="arrayChange";a.La.trackArrayChanges=function(b){function d(){if(!c){c=!0;var d=b.notifySubscribers;b.notifySubscribers=function(a,b){return b&&b!==G||++g,d.apply(this,arguments)};var f=[].concat(b.v()||[]);e=null,b.U(function(c){if(c=[].concat(c||[]),b.Ab(J)){var d;(!e||g>1)&&(e=a.a.Fa(f,c,{sparse:!0})),d=e,d.length&&b.notifySubscribers(d,J)}f=c,e=null,g=0})}}if(!b.sb){var c=!1,e=null,g=0,h=b.U;b.U=b.subscribe=function(a,b,c){return c===J&&d(),h.apply(this,arguments)},b.sb=function(b,d,m){function l(a,b,c){return q[q.length]={status:a,value:b,index:c}}if(c&&!g){var q=[],h=b.length,t=m.length,z=0;switch(d){case"push":z=h;case"unshift":for(d=0;t>d;d++)l("added",m[d],z+d);break;case"pop":z=h-1;case"shift":h&&l("deleted",b[z],z);break;case"splice":d=Math.min(Math.max(0,0>m[0]?h+m[0]:m[0]),h);for(var h=1===t?h:Math.min(d+(m[1]||0),h),t=d+t-2,z=Math.max(h,t),u=[],r=[],E=2;z>d;++d,++E)h>d&&r.push(l("deleted",b[d],d)),t>d&&u.push(l("added",m[E],d));a.a.wb(r,u);break;default:return}e=q}}}},a.s=a.j=function(b,d,c){function e(){a.a.G(v,function(a,b){b.K()}),v={}}function g(){e(),C=0,u=!0,n=!1}function h(){var a=f.throttleEvaluation;a&&a>=0?(clearTimeout(P),P=setTimeout(k,a)):f.ib?f.ib():k()}function k(b){if(t){if(E)throw Error("A 'pure' computed must not be called recursively")}else if(!u){if(w&&w()){if(!z)return void s()}else z=!1;if(t=!0,y)try{var c={};a.k.Ea({wa:function(a,b){c[b]||(c[b]=1,++C)},s:f,ma:p}),C=0,q=r.call(d)}finally{a.k.end(),t=!1}else try{var e=v,m=C;a.k.Ea({wa:function(a,b){u||(m&&e[b]?(v[b]=e[b],++C,delete e[b],--m):v[b]||(v[b]=a.U(h),++C))},s:f,ma:E?p:!C}),v={},C=0;try{var l=d?r.call(d):r()}finally{a.k.end(),m&&a.a.G(e,function(a,b){b.K()}),n=!1}f.Pa(q,l)&&(f.notifySubscribers(q,"beforeChange"),q=l,!0!==b&&f.notifySubscribers(q))}finally{t=!1}C||s()}}function f(){if(0<arguments.length){if("function"!=typeof O)throw Error("Cannot write a value to a ko.computed unless you specify a 'write' option. If you wish to read the current value, don't pass any parameters.");return O.apply(d,arguments),this}return a.k.Jb(f),n&&k(!0),q}function m(){return n&&!C&&k(!0),q}function l(){return n||C>0}var q,n=!0,t=!1,z=!1,u=!1,r=b,E=!1,y=!1;if(r&&"object"==typeof r?(c=r,r=c.read):(c=c||{},r||(r=c.read)),"function"!=typeof r)throw Error("Pass a function that returns the value of the ko.computed");var O=c.write,x=c.disposeWhenNodeIsRemoved||c.o||null,B=c.disposeWhen||c.Ia,w=B,s=g,v={},C=0,P=null;d||(d=c.owner),a.P.call(f),a.a.Aa(f,a.j.fn),f.v=m,f.la=function(){return C},f.hc="function"==typeof c.write,f.K=function(){s()},f.Z=l;var A=f.Ta;return f.Ta=function(a){A.call(f,a),f.ib=function(){f.kb(q),n=!0,f.lb(f)}},c.pure?(y=E=!0,f.va=function(){y&&(y=!1,k(!0))},f.nb=function(){f.yb()||(e(),y=n=!0)}):c.deferEvaluation&&(f.va=function(){m(),delete f.va}),a.A(f,"peek",f.v),a.A(f,"dispose",f.K),a.A(f,"isActive",f.Z),a.A(f,"getDependenciesCount",f.la),x&&(z=!0,x.nodeType&&(w=function(){return!a.a.Ja(x)||B&&B()})),y||c.deferEvaluation||k(),x&&l()&&x.nodeType&&(s=function(){a.a.w.Kb(x,s),g()},a.a.w.da(x,s)),f},a.jc=function(b){return a.Ma(b,a.j)},A=a.p.rc,a.j[A]=a.p,a.j.fn={equalityComparer:H},a.j.fn[A]=a.j,a.a.xa&&a.a.za(a.j.fn,a.P.fn),a.b("dependentObservable",a.j),a.b("computed",a.j),a.b("isComputed",a.jc),a.Ib=function(b,d){return"function"==typeof b?a.s(b,d,{pure:!0}):(b=a.a.extend({},b),b.pure=!0,a.s(b,d))},a.b("pureComputed",a.Ib),function(){function b(a,g,h){if(h=h||new c,a=g(a),"object"!=typeof a||null===a||a===p||a instanceof Date||a instanceof String||a instanceof Number||a instanceof Boolean)return a;var k=a instanceof Array?[]:{};return h.save(a,k),d(a,function(c){var d=g(a[c]);switch(typeof d){case"boolean":case"number":case"string":case"function":k[c]=d;break;case"object":case"undefined":var l=h.get(d);k[c]=l!==p?l:b(d,g,h)}}),k}function d(a,b){if(a instanceof Array){for(var c=0;c<a.length;c++)b(c);"function"==typeof a.toJSON&&b("toJSON")}else for(c in a)b(c)}function c(){this.keys=[],this.hb=[]}a.Qb=function(c){if(0==arguments.length)throw Error("When calling ko.toJS, pass the object you want to convert.");return b(c,function(b){for(var c=0;a.C(b)&&10>c;c++)b=b();return b})},a.toJSON=function(b,c,d){return b=a.Qb(b),a.a.eb(b,c,d)},c.prototype={save:function(b,c){var d=a.a.m(this.keys,b);d>=0?this.hb[d]=c:(this.keys.push(b),this.hb.push(c))},get:function(b){return b=a.a.m(this.keys,b),b>=0?this.hb[b]:p}}}(),a.b("toJS",a.Qb),a.b("toJSON",a.toJSON),function(){a.i={q:function(b){switch(a.a.t(b)){case"option":return!0===b.__ko__hasDomDataOptionValue__?a.a.e.get(b,a.d.options.Va):7>=a.a.L?b.getAttributeNode("value")&&b.getAttributeNode("value").specified?b.value:b.text:b.value;case"select":return 0<=b.selectedIndex?a.i.q(b.options[b.selectedIndex]):p;default:return b.value}},ca:function(b,d,c){switch(a.a.t(b)){case"option":switch(typeof d){case"string":a.a.e.set(b,a.d.options.Va,p),"__ko__hasDomDataOptionValue__"in b&&delete b.__ko__hasDomDataOptionValue__,b.value=d;break;default:a.a.e.set(b,a.d.options.Va,d),b.__ko__hasDomDataOptionValue__=!0,b.value="number"==typeof d?d:""}break;case"select":(""===d||null===d)&&(d=p);for(var k,e=-1,g=0,h=b.options.length;h>g;++g)if(k=a.i.q(b.options[g]),k==d||""==k&&d===p){e=g;break}(c||e>=0||d===p&&1<b.size)&&(b.selectedIndex=e);break;default:(null===d||d===p)&&(d=""),b.value=d}}}}(),a.b("selectExtensions",a.i),a.b("selectExtensions.readValue",a.i.q),a.b("selectExtensions.writeValue",a.i.ca),a.h=function(){function b(b){b=a.a.cb(b),123===b.charCodeAt(0)&&(b=b.slice(1,-1));var k,n,c=[],d=b.match(e),t=0;if(d){d.push(",");for(var u,z=0;u=d[z];++z){var r=u.charCodeAt(0);if(44===r){if(0>=t){k&&c.push(n?{key:k,value:n.join("")}:{unknown:k}),k=n=t=0;continue}}else if(58===r){if(!n)continue}else if(47===r&&z&&1<u.length)(r=d[z-1].match(g))&&!h[r[0]]&&(b=b.substr(b.indexOf(u)+1),d=b.match(e),d.push(","),z=-1,u="/");else if(40===r||123===r||91===r)++t;else if(41===r||125===r||93===r)--t;else if(!k&&!n){k=34===r||39===r?u.slice(1,-1):u;continue}n?n.push(u):n=[u]}}return c}var d=["true","false","null","undefined"],c=/^(?:[$_a-z][$\w]*|(.+)(\.\s*[$_a-z][$\w]*|\[.+\]))$/i,e=RegExp("\"(?:[^\"\\\\]|\\\\.)*\"|'(?:[^'\\\\]|\\\\.)*'|/(?:[^/\\\\]|\\\\.)*/w*|[^\\s:,/][^,\"'{}()/:[\\]]*[^\\s,\"'{}()/:[\\]]|[^\\s]","g"),g=/[\])"'A-Za-z0-9_$]+$/,h={"in":1,"return":1,"typeof":1},k={};return{ha:[],V:k,Wa:b,ya:function(f,m){function e(b,m){var f;if(!z){var u=a.getBindingHandler(b);if(u&&u.preprocess&&!(m=u.preprocess(m,b,e)))return;(u=k[b])&&(f=m,0<=a.a.m(d,f)?f=!1:(u=f.match(c),f=null===u?!1:u[1]?"Object("+u[1]+")"+u[2]:f),u=f),u&&h.push("'"+b+"':function(_z){"+f+"=_z}")}t&&(m="function(){return "+m+" }"),g.push("'"+b+"':"+m)}m=m||{};var g=[],h=[],t=m.valueAccessors,z=m.bindingParams,u="string"==typeof f?b(f):f;return a.a.u(u,function(a){e(a.key||a.unknown,a.value)}),h.length&&e("_ko_property_writers","{"+h.join(",")+" }"),g.join(",")},lc:function(a,b){for(var c=0;c<a.length;c++)if(a[c].key==b)return!0;return!1},pa:function(b,c,d,e,k){b&&a.C(b)?!a.Ra(b)||k&&b.v()===e||b(e):(b=c.get("_ko_property_writers"))&&b[d]&&b[d](e)}}}(),a.b("expressionRewriting",a.h),a.b("expressionRewriting.bindingRewriteValidators",a.h.ha),a.b("expressionRewriting.parseObjectLiteral",a.h.Wa),a.b("expressionRewriting.preProcessBindings",a.h.ya),a.b("expressionRewriting._twoWayBindings",a.h.V),a.b("jsonExpressionRewriting",a.h),a.b("jsonExpressionRewriting.insertPropertyAccessorsIntoJson",a.h.ya),function(){function b(a){return 8==a.nodeType&&h.test(g?a.text:a.nodeValue)}function d(a){return 8==a.nodeType&&k.test(g?a.text:a.nodeValue)}function c(a,c){for(var f=a,e=1,k=[];f=f.nextSibling;){if(d(f)&&(e--,0===e))return k;k.push(f),b(f)&&e++}if(!c)throw Error("Cannot find closing comment tag to match: "+a.nodeValue);return null}function e(a,b){var d=c(a,b);return d?0<d.length?d[d.length-1].nextSibling:a.nextSibling:null}var g=v&&"<!--test-->"===v.createComment("test").text,h=g?/^\x3c!--\s*ko(?:\s+([\s\S]+))?\s*--\x3e$/:/^\s*ko(?:\s+([\s\S]+))?\s*$/,k=g?/^\x3c!--\s*\/ko\s*--\x3e$/:/^\s*\/ko\s*$/,f={ul:!0,ol:!0};a.f={Q:{},childNodes:function(a){return b(a)?c(a):a.childNodes},ja:function(c){if(b(c)){c=a.f.childNodes(c);for(var d=0,f=c.length;f>d;d++)a.removeNode(c[d])}else a.a.Ka(c)},T:function(c,d){if(b(c)){a.f.ja(c);for(var f=c.nextSibling,e=0,k=d.length;k>e;e++)f.parentNode.insertBefore(d[e],f)}else a.a.T(c,d)},Hb:function(a,c){b(a)?a.parentNode.insertBefore(c,a.nextSibling):a.firstChild?a.insertBefore(c,a.firstChild):a.appendChild(c)},Bb:function(c,d,f){f?b(c)?c.parentNode.insertBefore(d,f.nextSibling):f.nextSibling?c.insertBefore(d,f.nextSibling):c.appendChild(d):a.f.Hb(c,d)},firstChild:function(a){return b(a)?!a.nextSibling||d(a.nextSibling)?null:a.nextSibling:a.firstChild},nextSibling:function(a){return b(a)&&(a=e(a)),a.nextSibling&&d(a.nextSibling)?null:a.nextSibling},gc:b,xc:function(a){return(a=(g?a.text:a.nodeValue).match(h))?a[1]:null},Fb:function(c){if(f[a.a.t(c)]){var k=c.firstChild;if(k)do if(1===k.nodeType){var g;g=k.firstChild;var h=null;if(g)do if(h)h.push(g);else if(b(g)){var t=e(g,!0);t?g=t:h=[g]}else d(g)&&(h=[g]);while(g=g.nextSibling);if(g=h)for(h=k.nextSibling,t=0;t<g.length;t++)h?c.insertBefore(g[t],h):c.appendChild(g[t])}while(k=k.nextSibling)}}}}(),a.b("virtualElements",a.f),a.b("virtualElements.allowedBindings",a.f.Q),a.b("virtualElements.emptyNode",a.f.ja),a.b("virtualElements.insertAfter",a.f.Bb),a.b("virtualElements.prepend",a.f.Hb),a.b("virtualElements.setDomNodeChildren",a.f.T),function(){a.J=function(){this.Yb={}},a.a.extend(a.J.prototype,{nodeHasBindings:function(b){switch(b.nodeType){case 1:return null!=b.getAttribute("data-bind")||a.g.getComponentNameForNode(b);case 8:return a.f.gc(b);default:return!1}},getBindings:function(b,d){var c=this.getBindingsString(b,d),c=c?this.parseBindingsString(c,d,b):null;return a.g.mb(c,b,d,!1)},getBindingAccessors:function(b,d){var c=this.getBindingsString(b,d),c=c?this.parseBindingsString(c,d,b,{valueAccessors:!0}):null;return a.g.mb(c,b,d,!0)},getBindingsString:function(b){switch(b.nodeType){case 1:return b.getAttribute("data-bind");case 8:return a.f.xc(b);default:return null}},parseBindingsString:function(b,d,c,e){try{var k,g=this.Yb,h=b+(e&&e.valueAccessors||"");if(!(k=g[h])){var f,m="with($context){with($data||{}){return{"+a.h.ya(b,e)+"}}}";f=new Function("$context","$element",m),k=g[h]=f}return k(d,c)}catch(l){throw l.message="Unable to parse bindings.\nBindings value: "+b+"\nMessage: "+l.message,l}}}),a.J.instance=new a.J}(),a.b("bindingProvider",a.J),function(){function b(a){return function(){return a}}function d(a){return a()}function c(b){return a.a.na(a.k.B(b),function(a,c){return function(){return b()[c]}})}function e(a,b){return c(this.getBindings.bind(this,a,b))}function g(b,c,d){var f,e=a.f.firstChild(c),k=a.J.instance,g=k.preprocessNode;if(g){for(;f=e;)e=a.f.nextSibling(f),g.call(k,f);e=a.f.firstChild(c)}for(;f=e;)e=a.f.nextSibling(f),h(b,f,d)}function h(b,c,d){var e=!0,k=1===c.nodeType;k&&a.f.Fb(c),(k&&d||a.J.instance.nodeHasBindings(c))&&(e=f(c,null,b,d).shouldBindDescendants),e&&!l[a.a.t(c)]&&g(b,c,!k)}function k(b){var c=[],d={},f=[];return a.a.G(b,function y(e){if(!d[e]){var k=a.getBindingHandler(e);k&&(k.after&&(f.push(e),a.a.u(k.after,function(c){if(b[c]){if(-1!==a.a.m(f,c))throw Error("Cannot combine the following bindings, because they have a cyclic dependency: "+f.join(", "));y(c)}}),f.length--),c.push({key:e,zb:k})),d[e]=!0}}),c}function f(b,c,f,g){var m=a.a.e.get(b,q);if(!c){if(m)throw Error("You cannot apply bindings multiple times to the same element.");a.a.e.set(b,q,!0)}!m&&g&&a.Ob(b,f);var l;if(c&&"function"!=typeof c)l=c;else{var h=a.J.instance,n=h.getBindingAccessors||e,s=a.j(function(){return(l=c?c(f,b):n.call(h,b,f))&&f.I&&f.I(),l},null,{o:b});l&&s.Z()||(s=null)}var v;if(l){var w=s?function(a){return function(){return d(s()[a])}}:function(a){return l[a]},A=function(){return a.a.na(s?s():l,d)};A.get=function(a){return l[a]&&d(w(a))},A.has=function(a){return a in l},g=k(l),a.a.u(g,function(c){var d=c.zb.init,e=c.zb.update,k=c.key;if(8===b.nodeType&&!a.f.Q[k])throw Error("The binding '"+k+"' cannot be used with virtual elements");try{"function"==typeof d&&a.k.B(function(){var a=d(b,w(k),A,f.$data,f);if(a&&a.controlsDescendantBindings){if(v!==p)throw Error("Multiple bindings ("+v+" and "+k+") are trying to control descendant bindings of the same element. You cannot use these bindings together on the same element.");v=k}}),"function"==typeof e&&a.j(function(){e(b,w(k),A,f.$data,f)},null,{o:b})}catch(g){throw g.message='Unable to process binding "'+k+": "+l[k]+'"\nMessage: '+g.message,g}})}return{shouldBindDescendants:v===p}}function m(b){return b&&b instanceof a.N?b:new a.N(b)}a.d={};var l={script:!0};a.getBindingHandler=function(b){return a.d[b]},a.N=function(b,c,d,f){var g,e=this,k="function"==typeof b&&!a.C(b),m=a.j(function(){var g=k?b():b,l=a.a.c(g);return c?(c.I&&c.I(),a.a.extend(e,c),m&&(e.I=m)):(e.$parents=[],e.$root=l,e.ko=a),e.$rawData=g,e.$data=l,d&&(e[d]=l),f&&f(e,c,l),e.$data},null,{Ia:function(){return g&&!a.a.ob(g)},o:!0});m.Z()&&(e.I=m,m.equalityComparer=null,g=[],m.Tb=function(b){g.push(b),a.a.w.da(b,function(b){a.a.ua(g,b),g.length||(m.K(),e.I=m=p)})})},a.N.prototype.createChildContext=function(b,c,d){return new a.N(b,this,c,function(a,b){a.$parentContext=b,a.$parent=b.$data,a.$parents=(b.$parents||[]).slice(0),a.$parents.unshift(a.$parent),d&&d(a)})},a.N.prototype.extend=function(b){return new a.N(this.I||this.$data,this,null,function(c,d){c.$rawData=d.$rawData,a.a.extend(c,"function"==typeof b?b():b)})};var q=a.a.e.F(),n=a.a.e.F();a.Ob=function(b,c){return 2!=arguments.length?a.a.e.get(b,n):(a.a.e.set(b,n,c),void(c.I&&c.I.Tb(b)))},a.ra=function(b,c,d){return 1===b.nodeType&&a.f.Fb(b),f(b,c,m(d),!0)},a.Wb=function(d,f,e){return e=m(e),a.ra(d,"function"==typeof f?c(f.bind(null,e,d)):a.a.na(f,b),e)},a.Ca=function(a,b){1!==b.nodeType&&8!==b.nodeType||g(m(a),b,!0)},a.pb=function(a,b){if(!w&&s.jQuery&&(w=s.jQuery),b&&1!==b.nodeType&&8!==b.nodeType)throw Error("ko.applyBindings: first parameter should be your view model; second parameter should be a DOM node");b=b||s.document.body,h(m(a),b,!0)},a.Ha=function(b){switch(b.nodeType){case 1:case 8:var c=a.Ob(b);if(c)return c;if(b.parentNode)return a.Ha(b.parentNode)}return p},a.$b=function(b){return(b=a.Ha(b))?b.$data:p},a.b("bindingHandlers",a.d),a.b("applyBindings",a.pb),a.b("applyBindingsToDescendants",a.Ca),a.b("applyBindingAccessorsToNode",a.ra),a.b("applyBindingsToNode",a.Wb),a.b("contextFor",a.Ha),a.b("dataFor",a.$b)}(),function(b){function d(d,f){var l,e=g.hasOwnProperty(d)?g[d]:b;e||(e=g[d]=new a.P,c(d,function(a){h[d]=a,delete g[d],l?e.notifySubscribers(a):setTimeout(function(){e.notifySubscribers(a)},0)}),l=!0),e.U(f)}function c(a,b){e("getConfig",[a],function(c){c?e("loadComponent",[a,c],function(a){b(a)}):b(null)})}function e(c,d,g,l){l||(l=a.g.loaders.slice(0));var h=l.shift();if(h){var n=h[c];if(n){var t=!1;if(n.apply(h,d.concat(function(a){t?g(null):null!==a?g(a):e(c,d,g,l)}))!==b&&(t=!0,!h.suppressLoaderExceptions))throw Error("Component loaders must supply values by invoking the callback, not by returning values synchronously.")}else e(c,d,g,l)}else g(null)}var g={},h={};a.g={get:function(a,c){var e=h.hasOwnProperty(a)?h[a]:b;e?setTimeout(function(){c(e)},0):d(a,c)},tb:function(a){delete h[a]},jb:e},a.g.loaders=[],a.b("components",a.g),a.b("components.get",a.g.get),a.b("components.clearCachedDefinition",a.g.tb)}(),function(){function b(b,c,d,e){function k(){0===--u&&e(h)}var h={},u=2,r=d.template;d=d.viewModel,r?g(c,r,function(c){a.g.jb("loadTemplate",[b,c],function(a){h.template=a,k()})}):k(),d?g(c,d,function(c){a.g.jb("loadViewModel",[b,c],function(a){h[f]=a,k()})}):k()}function d(a,b,c){if("function"==typeof b)c(function(a){return new b(a)});else if("function"==typeof b[f])c(b[f]);else if("instance"in b){var e=b.instance;c(function(){return e})}else"viewModel"in b?d(a,b.viewModel,c):a("Unknown viewModel value: "+b)}function c(b){switch(a.a.t(b)){case"script":return a.a.ba(b.text);case"textarea":return a.a.ba(b.value);case"template":if(e(b.content))return a.a.ia(b.content.childNodes);
}return a.a.ia(b.childNodes)}function e(a){return s.DocumentFragment?a instanceof DocumentFragment:a&&11===a.nodeType}function g(a,b,c){"string"==typeof b.require?N||s.require?(N||s.require)([b.require],c):a("Uses require, but no AMD loader is present"):c(b)}function h(a){return function(b){throw Error("Component '"+a+"': "+b)}}var k={};a.g.tc=function(b,c){if(!c)throw Error("Invalid configuration for "+b);if(a.g.Qa(b))throw Error("Component "+b+" is already registered");k[b]=c},a.g.Qa=function(a){return a in k},a.g.wc=function(b){delete k[b],a.g.tb(b)},a.g.ub={getConfig:function(a,b){b(k.hasOwnProperty(a)?k[a]:null)},loadComponent:function(a,c,d){var e=h(a);g(e,c,function(c){b(a,e,c,d)})},loadTemplate:function(b,d,f){if(b=h(b),"string"==typeof d)f(a.a.ba(d));else if(d instanceof Array)f(d);else if(e(d))f(a.a.S(d.childNodes));else if(d.element)if(d=d.element,s.HTMLElement?d instanceof HTMLElement:d&&d.tagName&&1===d.nodeType)f(c(d));else if("string"==typeof d){var k=v.getElementById(d);k?f(c(k)):b("Cannot find element with ID "+d)}else b("Unknown element type: "+d);else b("Unknown template value: "+d)},loadViewModel:function(a,b,c){d(h(a),b,c)}};var f="createViewModel";a.b("components.register",a.g.tc),a.b("components.isRegistered",a.g.Qa),a.b("components.unregister",a.g.wc),a.b("components.defaultLoader",a.g.ub),a.g.loaders.push(a.g.ub),a.g.Ub=k}(),function(){function b(b,e){var g=b.getAttribute("params");if(g){var g=d.parseBindingsString(g,e,b,{valueAccessors:!0,bindingParams:!0}),g=a.a.na(g,function(d){return a.s(d,null,{o:b})}),h=a.a.na(g,function(d){return d.Z()?a.s(function(){return a.a.c(d())},null,{o:b}):d.v()});return h.hasOwnProperty("$raw")||(h.$raw=g),h}return{$raw:{}}}a.g.getComponentNameForNode=function(b){return b=a.a.t(b),a.g.Qa(b)&&b},a.g.mb=function(c,d,g,h){if(1===d.nodeType){var k=a.g.getComponentNameForNode(d);if(k){if(c=c||{},c.component)throw Error('Cannot use the "component" binding on a custom element matching a component');var f={name:k,params:b(d,g)};c.component=h?function(){return f}:f}}return c};var d=new a.J;9>a.a.L&&(a.g.register=function(a){return function(b){return v.createElement(b),a.apply(this,arguments)}}(a.g.register),v.createDocumentFragment=function(b){return function(){var h,d=b(),g=a.g.Ub;for(h in g)g.hasOwnProperty(h)&&d.createElement(h);return d}}(v.createDocumentFragment))}(),function(){var b=0;a.d.component={init:function(d,c,e,g,h){function k(){var a=f&&f.dispose;"function"==typeof a&&a.call(f),m=null}var f,m;return a.a.w.da(d,k),a.s(function(){var g,n,e=a.a.c(c());if("string"==typeof e?g=e:(g=a.a.c(e.name),n=a.a.c(e.params)),!g)throw Error("No component name specified");var t=m=++b;a.g.get(g,function(b){if(m===t){if(k(),!b)throw Error("Unknown component '"+g+"'");var c=b.template;if(!c)throw Error("Component '"+g+"' has no template");c=a.a.ia(c),a.f.T(d,c);var c=n,e=b.createViewModel;b=e?e.call(b,c,{element:d}):c,c=h.createChildContext(b),f=b,a.Ca(c,d)}})},null,{o:d}),{controlsDescendantBindings:!0}}},a.f.Q.component=!0}();var Q={"class":"className","for":"htmlFor"};a.d.attr={update:function(b,d){var c=a.a.c(d())||{};a.a.G(c,function(c,d){d=a.a.c(d);var h=!1===d||null===d||d===p;h&&b.removeAttribute(c),8>=a.a.L&&c in Q?(c=Q[c],h?b.removeAttribute(c):b[c]=d):h||b.setAttribute(c,d.toString()),"name"===c&&a.a.Mb(b,h?"":d.toString())})}},function(){a.d.checked={after:["value","attr"],init:function(b,d,c){function e(){var e=b.checked,k=q?h():e;if(!a.Y.ma()&&(!f||e)){var g=a.k.B(d);m?l!==k?(e&&(a.a.ea(g,k,!0),a.a.ea(g,l,!1)),l=k):a.a.ea(g,k,e):a.h.pa(g,c,"checked",k,!0)}}function g(){var c=a.a.c(d());b.checked=m?0<=a.a.m(c,h()):k?c:h()===c}var h=a.Ib(function(){return c.has("checkedValue")?a.a.c(c.get("checkedValue")):c.has("value")?a.a.c(c.get("value")):b.value}),k="checkbox"==b.type,f="radio"==b.type;if(k||f){var m=k&&a.a.c(d())instanceof Array,l=m?h():p,q=f||m;f&&!b.name&&a.d.uniqueName.init(b,function(){return!0}),a.s(e,null,{o:b}),a.a.n(b,"click",e),a.s(g,null,{o:b})}}},a.h.V.checked=!0,a.d.checkedValue={update:function(b,d){b.value=a.a.c(d())}}}(),a.d.css={update:function(b,d){var c=a.a.c(d());"object"==typeof c?a.a.G(c,function(c,d){d=a.a.c(d),a.a.Ba(b,c,d)}):(c=String(c||""),a.a.Ba(b,b.__ko__cssValue,!1),b.__ko__cssValue=c,a.a.Ba(b,c,!0))}},a.d.enable={update:function(b,d){var c=a.a.c(d());c&&b.disabled?b.removeAttribute("disabled"):c||b.disabled||(b.disabled=!0)}},a.d.disable={update:function(b,d){a.d.enable.update(b,function(){return!a.a.c(d())})}},a.d.event={init:function(b,d,c,e,g){var h=d()||{};a.a.G(h,function(k){"string"==typeof k&&a.a.n(b,k,function(b){var h,l=d()[k];if(l){try{var q=a.a.S(arguments);e=g.$data,q.unshift(e),h=l.apply(e,q)}finally{!0!==h&&(b.preventDefault?b.preventDefault():b.returnValue=!1)}!1===c.get(k+"Bubble")&&(b.cancelBubble=!0,b.stopPropagation&&b.stopPropagation())}})})}},a.d.foreach={Eb:function(b){return function(){var d=b(),c=a.a.Xa(d);return c&&"number"!=typeof c.length?(a.a.c(d),{foreach:c.data,as:c.as,includeDestroyed:c.includeDestroyed,afterAdd:c.afterAdd,beforeRemove:c.beforeRemove,afterRender:c.afterRender,beforeMove:c.beforeMove,afterMove:c.afterMove,templateEngine:a.O.Oa}):{foreach:d,templateEngine:a.O.Oa}}},init:function(b,d){return a.d.template.init(b,a.d.foreach.Eb(d))},update:function(b,d,c,e,g){return a.d.template.update(b,a.d.foreach.Eb(d),c,e,g)}},a.h.ha.foreach=!1,a.f.Q.foreach=!0,a.d.hasfocus={init:function(b,d,c){function e(e){b.__ko_hasfocusUpdating=!0;var f=b.ownerDocument;if("activeElement"in f){var g;try{g=f.activeElement}catch(h){g=f.body}e=g===b}f=d(),a.h.pa(f,c,"hasfocus",e,!0),b.__ko_hasfocusLastValue=e,b.__ko_hasfocusUpdating=!1}var g=e.bind(null,!0),h=e.bind(null,!1);a.a.n(b,"focus",g),a.a.n(b,"focusin",g),a.a.n(b,"blur",h),a.a.n(b,"focusout",h)},update:function(b,d){var c=!!a.a.c(d());b.__ko_hasfocusUpdating||b.__ko_hasfocusLastValue===c||(c?b.focus():b.blur(),a.k.B(a.a.oa,null,[b,c?"focusin":"focusout"]))}},a.h.V.hasfocus=!0,a.d.hasFocus=a.d.hasfocus,a.h.V.hasFocus=!0,a.d.html={init:function(){return{controlsDescendantBindings:!0}},update:function(b,d){a.a.$a(b,d())}},I("if"),I("ifnot",!1,!0),I("with",!0,!1,function(a,d){return a.createChildContext(d)});var K={};a.d.options={init:function(b){if("select"!==a.a.t(b))throw Error("options binding applies only to SELECT elements");for(;0<b.length;)b.remove(0);return{controlsDescendantBindings:!0}},update:function(b,d,c){function e(){return a.a.ta(b.options,function(a){return a.selected})}function g(a,b,c){var d=typeof b;return"function"==d?b(a):"string"==d?a[b]:c}function h(c,d){if(q.length){var e=0<=a.a.m(q,a.i.q(d[0]));a.a.Nb(d[0],e),n&&!e&&a.k.B(a.a.oa,null,[b,"change"])}}var k=0!=b.length&&b.multiple?b.scrollTop:null,f=a.a.c(d()),m=c.get("optionsIncludeDestroyed");d={};var l,q;q=b.multiple?a.a.Da(e(),a.i.q):0<=b.selectedIndex?[a.i.q(b.options[b.selectedIndex])]:[],f&&("undefined"==typeof f.length&&(f=[f]),l=a.a.ta(f,function(b){return m||b===p||null===b||!a.a.c(b._destroy)}),c.has("optionsCaption")&&(f=a.a.c(c.get("optionsCaption")),null!==f&&f!==p&&l.unshift(K)));var n=!1;d.beforeRemove=function(a){b.removeChild(a)},f=h,c.has("optionsAfterRender")&&(f=function(b,d){h(0,d),a.k.B(c.get("optionsAfterRender"),null,[d[0],b!==K?b:p])}),a.a.Za(b,l,function(d,e,f){return f.length&&(q=f[0].selected?[a.i.q(f[0])]:[],n=!0),e=b.ownerDocument.createElement("option"),d===K?(a.a.bb(e,c.get("optionsCaption")),a.i.ca(e,p)):(f=g(d,c.get("optionsValue"),d),a.i.ca(e,a.a.c(f)),d=g(d,c.get("optionsText"),f),a.a.bb(e,d)),[e]},d,f),a.k.B(function(){c.get("valueAllowUnset")&&c.has("value")?a.i.ca(b,a.a.c(c.get("value")),!0):(b.multiple?q.length&&e().length<q.length:q.length&&0<=b.selectedIndex?a.i.q(b.options[b.selectedIndex])!==q[0]:q.length||0<=b.selectedIndex)&&a.a.oa(b,"change")}),a.a.dc(b),k&&20<Math.abs(k-b.scrollTop)&&(b.scrollTop=k)}},a.d.options.Va=a.a.e.F(),a.d.selectedOptions={after:["options","foreach"],init:function(b,d,c){a.a.n(b,"change",function(){var e=d(),g=[];a.a.u(b.getElementsByTagName("option"),function(b){b.selected&&g.push(a.i.q(b))}),a.h.pa(e,c,"selectedOptions",g)})},update:function(b,d){if("select"!=a.a.t(b))throw Error("values binding applies only to SELECT elements");var c=a.a.c(d());c&&"number"==typeof c.length&&a.a.u(b.getElementsByTagName("option"),function(b){var d=0<=a.a.m(c,a.i.q(b));a.a.Nb(b,d)})}},a.h.V.selectedOptions=!0,a.d.style={update:function(b,d){var c=a.a.c(d()||{});a.a.G(c,function(c,d){d=a.a.c(d),(null===d||d===p||!1===d)&&(d=""),b.style[c]=d})}},a.d.submit={init:function(b,d,c,e,g){if("function"!=typeof d())throw Error("The value for a submit binding must be a function");a.a.n(b,"submit",function(a){var c,e=d();try{c=e.call(g.$data,b)}finally{!0!==c&&(a.preventDefault?a.preventDefault():a.returnValue=!1)}})}},a.d.text={init:function(){return{controlsDescendantBindings:!0}},update:function(b,d){a.a.bb(b,d())}},a.f.Q.text=!0,function(){if(s&&s.navigator)var b=function(a){return a?parseFloat(a[1]):void 0},d=s.opera&&s.opera.version&&parseInt(s.opera.version()),c=s.navigator.userAgent,e=b(c.match(/^(?:(?!chrome).)*version\/([^ ]*) safari/i)),g=b(c.match(/Firefox\/([^ ]*)/));if(10>a.a.L)var h=a.a.e.F(),k=a.a.e.F(),f=function(b){var c=this.activeElement;(c=c&&a.a.e.get(c,k))&&c(b)},m=function(b,c){var d=b.ownerDocument;a.a.e.get(d,h)||(a.a.e.set(d,h,!0),a.a.n(d,"selectionchange",f)),a.a.e.set(b,k,c)};a.d.textInput={init:function(b,c,f){function k(c,d){a.a.n(b,c,d)}function h(){var d=a.a.c(c());(null===d||d===p)&&(d=""),v!==p&&d===v?setTimeout(h,4):b.value!==d&&(s=d,b.value=d)}function u(){y||(v=b.value,y=setTimeout(r,4))}function r(){clearTimeout(y),v=y=p;var d=b.value;s!==d&&(s=d,a.h.pa(c(),f,"textInput",d))}var y,v,s=b.value;10>a.a.L?(k("propertychange",function(a){"value"===a.propertyName&&r()}),8==a.a.L&&(k("keyup",r),k("keydown",r)),8<=a.a.L&&(m(b,r),k("dragend",u))):(k("input",r),5>e&&"textarea"===a.a.t(b)?(k("keydown",u),k("paste",u),k("cut",u)):11>d?k("keydown",u):4>g&&(k("DOMAutoComplete",r),k("dragdrop",r),k("drop",r))),k("change",r),a.s(h,null,{o:b})}},a.h.V.textInput=!0,a.d.textinput={preprocess:function(a,b,c){c("textInput",a)}}}(),a.d.uniqueName={init:function(b,d){if(d()){var c="ko_unique_"+ ++a.d.uniqueName.Zb;a.a.Mb(b,c)}}},a.d.uniqueName.Zb=0,a.d.value={after:["options","foreach"],init:function(b,d,c){if("input"!=b.tagName.toLowerCase()||"checkbox"!=b.type&&"radio"!=b.type){var e=["change"],g=c.get("valueUpdate"),h=!1,k=null;g&&("string"==typeof g&&(g=[g]),a.a.ga(e,g),e=a.a.rb(e));var f=function(){k=null,h=!1;var e=d(),f=a.i.q(b);a.h.pa(e,c,"value",f)};!a.a.L||"input"!=b.tagName.toLowerCase()||"text"!=b.type||"off"==b.autocomplete||b.form&&"off"==b.form.autocomplete||-1!=a.a.m(e,"propertychange")||(a.a.n(b,"propertychange",function(){h=!0}),a.a.n(b,"focus",function(){h=!1}),a.a.n(b,"blur",function(){h&&f()})),a.a.u(e,function(c){var d=f;a.a.vc(c,"after")&&(d=function(){k=a.i.q(b),setTimeout(f,0)},c=c.substring(5)),a.a.n(b,c,d)});var m=function(){var e=a.a.c(d()),f=a.i.q(b);if(null!==k&&e===k)setTimeout(m,0);else if(e!==f)if("select"===a.a.t(b)){var g=c.get("valueAllowUnset"),f=function(){a.i.ca(b,e,g)};f(),g||e===a.i.q(b)?setTimeout(f,0):a.k.B(a.a.oa,null,[b,"change"])}else a.i.ca(b,e)};a.s(m,null,{o:b})}else a.ra(b,{checkedValue:d})},update:function(){}},a.h.V.value=!0,a.d.visible={update:function(b,d){var c=a.a.c(d()),e="none"!=b.style.display;c&&!e?b.style.display="":!c&&e&&(b.style.display="none")}},function(b){a.d[b]={init:function(d,c,e,g,h){return a.d.event.init.call(this,d,function(){var a={};return a[b]=c(),a},e,g,h)}}}("click"),a.H=function(){},a.H.prototype.renderTemplateSource=function(){throw Error("Override renderTemplateSource")},a.H.prototype.createJavaScriptEvaluatorBlock=function(){throw Error("Override createJavaScriptEvaluatorBlock")},a.H.prototype.makeTemplateSource=function(b,d){if("string"==typeof b){d=d||v;var c=d.getElementById(b);if(!c)throw Error("Cannot find template with ID "+b);return new a.r.l(c)}if(1==b.nodeType||8==b.nodeType)return new a.r.fa(b);throw Error("Unknown template type: "+b)},a.H.prototype.renderTemplate=function(a,d,c,e){return a=this.makeTemplateSource(a,e),this.renderTemplateSource(a,d,c)},a.H.prototype.isTemplateRewritten=function(a,d){return!1===this.allowTemplateRewriting?!0:this.makeTemplateSource(a,d).data("isRewritten")},a.H.prototype.rewriteTemplate=function(a,d,c){a=this.makeTemplateSource(a,c),d=d(a.text()),a.text(d),a.data("isRewritten",!0)},a.b("templateEngine",a.H),a.fb=function(){function b(b,c,d,k){b=a.h.Wa(b);for(var f=a.h.ha,m=0;m<b.length;m++){var l=b[m].key;if(f.hasOwnProperty(l)){var q=f[l];if("function"==typeof q){if(l=q(b[m].value))throw Error(l)}else if(!q)throw Error("This template engine does not support the '"+l+"' binding within its templates")}}return d="ko.__tr_ambtns(function($context,$element){return(function(){return{ "+a.h.ya(b,{valueAccessors:!0})+" } })()},'"+d.toLowerCase()+"')",k.createJavaScriptEvaluatorBlock(d)+c}var d=/(<([a-z]+\d*)(?:\s+(?!data-bind\s*=\s*)[a-z0-9\-]+(?:=(?:\"[^\"]*\"|\'[^\']*\'))?)*\s+)data-bind\s*=\s*(["'])([\s\S]*?)\3/gi,c=/\x3c!--\s*ko\b\s*([\s\S]*?)\s*--\x3e/g;return{ec:function(b,c,d){c.isTemplateRewritten(b,d)||c.rewriteTemplate(b,function(b){return a.fb.nc(b,c)},d)},nc:function(a,g){return a.replace(d,function(a,c,d,e,l){return b(l,c,d,g)}).replace(c,function(a,c){return b(c,"<!-- ko -->","#comment",g)})},Xb:function(b,c){return a.D.Ua(function(d,k){var f=d.nextSibling;f&&f.nodeName.toLowerCase()===c&&a.ra(f,b,k)})}}}(),a.b("__tr_ambtns",a.fb.Xb),function(){a.r={},a.r.l=function(a){this.l=a},a.r.l.prototype.text=function(){var b=a.a.t(this.l),b="script"===b?"text":"textarea"===b?"value":"innerHTML";if(0==arguments.length)return this.l[b];var d=arguments[0];"innerHTML"===b?a.a.$a(this.l,d):this.l[b]=d};var b=a.a.e.F()+"_";a.r.l.prototype.data=function(c){return 1===arguments.length?a.a.e.get(this.l,b+c):void a.a.e.set(this.l,b+c,arguments[1])};var d=a.a.e.F();a.r.fa=function(a){this.l=a},a.r.fa.prototype=new a.r.l,a.r.fa.prototype.text=function(){if(0==arguments.length){var b=a.a.e.get(this.l,d)||{};return b.gb===p&&b.Ga&&(b.gb=b.Ga.innerHTML),b.gb}a.a.e.set(this.l,d,{gb:arguments[0]})},a.r.l.prototype.nodes=function(){return 0==arguments.length?(a.a.e.get(this.l,d)||{}).Ga:void a.a.e.set(this.l,d,{Ga:arguments[0]})},a.b("templateSources",a.r),a.b("templateSources.domElement",a.r.l),a.b("templateSources.anonymousTemplate",a.r.fa)}(),function(){function b(b,c,d){var e;for(c=a.f.nextSibling(c);b&&(e=b)!==c;)b=a.f.nextSibling(e),d(e,b)}function d(c,d){if(c.length){var e=c[0],g=c[c.length-1],h=e.parentNode,n=a.J.instance,t=n.preprocessNode;if(t){if(b(e,g,function(a,b){var c=a.previousSibling,d=t.call(n,a);d&&(a===e&&(e=d[0]||b),a===g&&(g=d[d.length-1]||c))}),c.length=0,!e)return;e===g?c.push(e):(c.push(e,g),a.a.ka(c,h))}b(e,g,function(b){1!==b.nodeType&&8!==b.nodeType||a.pb(d,b)}),b(e,g,function(b){1!==b.nodeType&&8!==b.nodeType||a.D.Sb(b,[d])}),a.a.ka(c,h)}}function c(a){return a.nodeType?a:0<a.length?a[0]:null}function e(b,e,h,l,q){q=q||{};var n=b&&c(b),n=n&&n.ownerDocument,t=q.templateEngine||g;if(a.fb.ec(h,t,n),h=t.renderTemplate(h,l,q,n),"number"!=typeof h.length||0<h.length&&"number"!=typeof h[0].nodeType)throw Error("Template engine must return an array of DOM nodes");switch(n=!1,e){case"replaceChildren":a.f.T(b,h),n=!0;break;case"replaceNode":a.a.Lb(b,h),n=!0;break;case"ignoreTargetNode":break;default:throw Error("Unknown renderMode: "+e)}return n&&(d(h,l),q.afterRender&&a.k.B(q.afterRender,null,[h,l.$data])),h}var g;a.ab=function(b){if(b!=p&&!(b instanceof a.H))throw Error("templateEngine must inherit from ko.templateEngine");g=b},a.Ya=function(b,d,h,l,q){if(h=h||{},(h.templateEngine||g)==p)throw Error("Set a template engine before calling renderTemplate");if(q=q||"replaceChildren",l){var n=c(l);return a.j(function(){var g=d&&d instanceof a.N?d:new a.N(a.a.c(d)),p=a.C(b)?b():"function"==typeof b?b(g.$data,g):b,g=e(l,q,p,g,h);"replaceNode"==q&&(l=g,n=c(l))},null,{Ia:function(){return!n||!a.a.Ja(n)},o:n&&"replaceNode"==q?n.parentNode:n})}return a.D.Ua(function(c){a.Ya(b,d,h,c,"replaceNode")})},a.uc=function(b,c,g,h,q){function n(a,b){d(b,s),g.afterRender&&g.afterRender(b,a)}function t(c,d){s=q.createChildContext(c,g.as,function(a){a.$index=d});var f=a.C(b)?b():"function"==typeof b?b(c,s):b;return e(null,"ignoreTargetNode",f,s,g)}var s;return a.j(function(){var b=a.a.c(c)||[];"undefined"==typeof b.length&&(b=[b]),b=a.a.ta(b,function(b){return g.includeDestroyed||b===p||null===b||!a.a.c(b._destroy)}),a.k.B(a.a.Za,null,[h,b,t,g,n])},null,{o:h})};var h=a.a.e.F();a.d.template={init:function(b,c){var d=a.a.c(c());return"string"==typeof d||d.name?a.f.ja(b):(d=a.f.childNodes(b),d=a.a.oc(d),new a.r.fa(b).nodes(d)),{controlsDescendantBindings:!0}},update:function(b,c,d,e,g){var t,n=c();c=a.a.c(n),d=!0,e=null,"string"==typeof c?c={}:(n=c.name,"if"in c&&(d=a.a.c(c["if"])),d&&"ifnot"in c&&(d=!a.a.c(c.ifnot)),t=a.a.c(c.data)),"foreach"in c?e=a.uc(n||b,d&&c.foreach||[],c,b,g):d?(g="data"in c?g.createChildContext(t,c.as):g,e=a.Ya(n||b,g,c,b)):a.f.ja(b),g=e,(t=a.a.e.get(b,h))&&"function"==typeof t.K&&t.K(),a.a.e.set(b,h,g&&g.Z()?g:p)}},a.h.ha.template=function(b){return b=a.h.Wa(b),1==b.length&&b[0].unknown||a.h.lc(b,"name")?null:"This template engine does not support anonymous templates nested within its templates"},a.f.Q.template=!0}(),a.b("setTemplateEngine",a.ab),a.b("renderTemplate",a.Ya),a.a.wb=function(a,d,c){if(a.length&&d.length){var e,g,h,k,f;for(e=g=0;(!c||c>e)&&(k=a[g]);++g){for(h=0;f=d[h];++h)if(k.value===f.value){k.moved=f.index,f.moved=k.index,d.splice(h,1),e=h=0;break}e+=h}}},a.a.Fa=function(){function b(b,c,e,g,h){var l,n,r,v,w,k=Math.min,f=Math.max,m=[],q=b.length,p=c.length,s=p-q||1,u=q+p+1;for(l=0;q>=l;l++)for(v=r,m.push(r=[]),w=k(p,l+s),n=f(0,l-1);w>=n;n++)r[n]=n?l?b[l-1]===c[n-1]?v[n-1]:k(v[n]||u,r[n-1]||u)+1:n+1:l+1;for(k=[],f=[],s=[],l=q,n=p;l||n;)p=m[l][n]-1,n&&p===m[l][n-1]?f.push(k[k.length]={status:e,value:c[--n],index:n}):l&&p===m[l-1][n]?s.push(k[k.length]={status:g,value:b[--l],index:l}):(--n,--l,h.sparse||k.push({status:"retained",value:c[n]}));return a.a.wb(f,s,10*q),k.reverse()}return function(a,c,e){return e="boolean"==typeof e?{dontLimitMoves:e}:e||{},a=a||[],c=c||[],a.length<=c.length?b(a,c,"added","deleted",e):b(c,a,"deleted","added",e)}}(),a.b("utils.compareArrays",a.a.Fa),function(){function b(b,d,g,h,k){var f=[],m=a.j(function(){var l=d(g,k,a.a.ka(f,b))||[];0<f.length&&(a.a.Lb(f,l),h&&a.k.B(h,null,[g,l,k])),f.length=0,a.a.ga(f,l)},null,{o:b,Ia:function(){return!a.a.ob(f)}});return{$:f,j:m.Z()?m:p}}var d=a.a.e.F();a.a.Za=function(c,e,g,h,k){function f(b,d){x=q[d],r!==d&&(A[b]=x),x.Na(r++),a.a.ka(x.$,c),s.push(x),w.push(x)}function m(b,c){if(b)for(var d=0,e=c.length;e>d;d++)c[d]&&a.a.u(c[d].$,function(a){b(a,d,c[d].sa)})}e=e||[],h=h||{};var l=a.a.e.get(c,d)===p,q=a.a.e.get(c,d)||[],n=a.a.Da(q,function(a){return a.sa}),t=a.a.Fa(n,e,h.dontLimitMoves),s=[],u=0,r=0,v=[],w=[];e=[];for(var x,D,F,A=[],n=[],B=0;D=t[B];B++)switch(F=D.moved,D.status){case"deleted":F===p&&(x=q[u],x.j&&x.j.K(),v.push.apply(v,a.a.ka(x.$,c)),h.beforeRemove&&(e[B]=x,w.push(x))),u++;break;case"retained":f(B,u++);break;case"added":F!==p?f(B,F):(x={sa:D.value,Na:a.p(r++)},s.push(x),w.push(x),l||(n[B]=x))}m(h.beforeMove,A),a.a.u(v,h.beforeRemove?a.R:a.removeNode);for(var G,B=0,l=a.f.firstChild(c);x=w[B];B++){for(x.$||a.a.extend(x,b(c,g,x.sa,k,x.Na)),u=0;t=x.$[u];l=t.nextSibling,G=t,u++)t!==l&&a.f.Bb(c,t,G);!x.ic&&k&&(k(x.sa,x.$,x.Na),x.ic=!0)}m(h.beforeRemove,e),m(h.afterMove,A),m(h.afterAdd,n),a.a.e.set(c,d,s)}}(),a.b("utils.setDomNodeChildrenFromArrayMapping",a.a.Za),a.O=function(){this.allowTemplateRewriting=!1},a.O.prototype=new a.H,a.O.prototype.renderTemplateSource=function(b){var d=(9>a.a.L?0:b.nodes)?b.nodes():null;return d?a.a.S(d.cloneNode(!0).childNodes):(b=b.text(),a.a.ba(b))},a.O.Oa=new a.O,a.ab(a.O.Oa),a.b("nativeTemplateEngine",a.O),function(){a.Sa=function(){var a=this.kc=function(){if(!w||!w.tmpl)return 0;try{if(0<=w.tmpl.tag.tmpl.open.toString().indexOf("__"))return 2}catch(a){}return 1}();this.renderTemplateSource=function(b,e,g){if(g=g||{},2>a)throw Error("Your version of jQuery.tmpl is too old. Please upgrade to jQuery.tmpl 1.0.0pre or later.");var h=b.data("precompiled");return h||(h=b.text()||"",h=w.template(null,"{{ko_with $item.koBindingContext}}"+h+"{{/ko_with}}"),b.data("precompiled",h)),b=[e.$data],e=w.extend({koBindingContext:e},g.templateOptions),e=w.tmpl(h,b,e),e.appendTo(v.createElement("div")),w.fragments={},e},this.createJavaScriptEvaluatorBlock=function(a){return"{{ko_code ((function() { return "+a+" })()) }}"},this.addTemplate=function(a,b){v.write("<script type='text/html' id='"+a+"'>"+b+"</script>")},a>0&&(w.tmpl.tag.ko_code={open:"__.push($1 || '');"},w.tmpl.tag.ko_with={open:"with($1) {",close:"} "})},a.Sa.prototype=new a.H;var b=new a.Sa;0<b.kc&&a.ab(b),a.b("jqueryTmplTemplateEngine",a.Sa)}()})}()}(),!function(a){"function"==typeof define&&define.amd?define(["knockout","jquery","jquery.ui.sortable"],a):a(window.ko,jQuery)}(function(a,b){var c="ko_sortItem",d="ko_sourceIndex",e="ko_sortList",f="ko_parentList",g="ko_dragItem",h=a.utils.unwrapObservable,i=a.utils.domData.get,j=a.utils.domData.set,k=function(b,d){a.utils.arrayForEach(b,function(a){1===a.nodeType&&(j(a,c,d),j(a,f,i(a.parentNode,e)))})},l=function(b,c){var d,e={},f=h(b())||{};return f.data?(e[c]=f.data,e.name=f.template):e[c]=b(),a.utils.arrayForEach(["afterAdd","afterRender","as","beforeRemove","includeDestroyed","templateEngine","templateOptions"],function(b){e[b]=f[b]||a.bindingHandlers.sortable[b]}),"foreach"===c&&(e.afterRender?(d=e.afterRender,e.afterRender=function(a,b){k.call(b,a,b),d.call(b,a,b)}):e.afterRender=k),e},m=function(a,b){var c=h(b);if(c)for(var d=0;a>d;d++)c[d]&&h(c[d]._destroy)&&a++;return a};a.bindingHandlers.sortable={init:function(k,n,o,p,q){var r,s,t=b(k),u=h(n())||{},v=l(n,"foreach"),w={};t.contents().each(function(){this&&1!==this.nodeType&&k.removeChild(this)}),b.extend(!0,w,a.bindingHandlers.sortable),u.options&&w.options&&(a.utils.extend(w.options,u.options),delete u.options),a.utils.extend(w,u),w.connectClass&&(a.isObservable(w.allowDrop)||"function"==typeof w.allowDrop)?a.computed({read:function(){var b=h(w.allowDrop),c="function"==typeof b?b.call(this,v.foreach):b;a.utils.toggleDomNodeCssClass(k,w.connectClass,c)},disposeWhenNodeIsRemoved:k},this):a.utils.toggleDomNodeCssClass(k,w.connectClass,w.allowDrop),a.bindingHandlers.template.init(k,function(){return v},o,p,q),r=w.options.start,s=w.options.update;var x=setTimeout(function(){var l;t.sortable(a.utils.extend(w.options,{start:function(b,c){var e=c.item[0];j(e,d,a.utils.arrayIndexOf(c.item.parent().children(),e)),c.item.find("input:focus").change(),r&&r.apply(this,arguments)},receive:function(a,b){l=i(b.item[0],g),l&&(l.clone&&(l=l.clone()),w.dragged&&(l=w.dragged.call(this,l,a,b)||l))},update:function(g,h){var k,n,o,p,q,r=h.item[0],t=h.item.parent()[0],u=i(r,c)||l;if(l=null,u&&(this===t||b.contains(this,t))){if(k=i(r,f),o=i(r,d),n=i(r.parentNode,e),p=a.utils.arrayIndexOf(h.item.parent().children(),r),v.includeDestroyed||(o=m(o,k),p=m(p,n)),(w.beforeMove||w.afterMove)&&(q={item:u,sourceParent:k,sourceParentNode:k&&h.sender||r.parentNode,sourceIndex:o,targetParent:n,targetIndex:p,cancelDrop:!1},w.beforeMove&&w.beforeMove.call(this,q,g,h)),k?b(k===n?this:h.sender).sortable("cancel"):b(r).remove(),q&&q.cancelDrop)return;p>=0&&(k&&(k.splice(o,1),a.processAllDeferredBindingUpdates&&a.processAllDeferredBindingUpdates()),n.splice(p,0,u)),j(r,c,null),a.processAllDeferredBindingUpdates&&a.processAllDeferredBindingUpdates(),w.afterMove&&w.afterMove.call(this,q,g,h)}s&&s.apply(this,arguments)},connectWith:w.connectClass?"."+w.connectClass:!1})),void 0!==w.isEnabled&&a.computed({read:function(){t.sortable(h(w.isEnabled)?"enable":"disable")},disposeWhenNodeIsRemoved:k})},0);return a.utils.domNodeDisposal.addDisposeCallback(k,function(){(t.data("ui-sortable")||t.data("sortable"))&&t.sortable("destroy"),clearTimeout(x)}),{controlsDescendantBindings:!0}},update:function(b,c,d,f,g){var h=l(c,"foreach");j(b,e,h.foreach),a.bindingHandlers.template.update(b,function(){return h},d,f,g)},connectClass:"ko_container",allowDrop:!0,afterMove:null,beforeMove:null,options:{}},a.bindingHandlers.draggable={init:function(c,d,e,f,i){var k=h(d())||{},m=k.options||{},n=a.utils.extend({},a.bindingHandlers.draggable.options),o=l(d,"data"),p=k.connectClass||a.bindingHandlers.draggable.connectClass,q=void 0!==k.isEnabled?k.isEnabled:a.bindingHandlers.draggable.isEnabled;return k=k.data||k,j(c,g,k),a.utils.extend(n,m),n.connectToSortable=p?"."+p:!1,b(c).draggable(n),void 0!==q&&a.computed({read:function(){b(c).draggable(h(q)?"enable":"disable")},disposeWhenNodeIsRemoved:c}),a.bindingHandlers.template.init(c,function(){return o},e,f,i)},update:function(b,c,d,e,f){var g=l(c,"data");return a.bindingHandlers.template.update(b,function(){return g},d,e,f)},connectClass:a.bindingHandlers.sortable.connectClass,options:{helper:"clone"}}}),/*
  knockback-core.js 0.19.2
  Copyright (c)  2011-2014 Kevin Malakoff.
  License: MIT (http://www.opensource.org/licenses/mit-license.php)
  Source: https://github.com/kmalakoff/knockback
  Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
  Optional dependencies: Backbone.ModelRef.js and BackboneORM.
*/
function(root,factory){"object"==typeof exports&&"object"==typeof module?module.exports=factory(require("knockout"),require("backbone"),require("underscore"),function(){try{return require("jquery")}catch(e){}}()):"function"==typeof define&&define.amd?define(["knockout","backbone","underscore"],function(__WEBPACK_EXTERNAL_MODULE_15__,__WEBPACK_EXTERNAL_MODULE_16__,__WEBPACK_EXTERNAL_MODULE_17__){return factory(__WEBPACK_EXTERNAL_MODULE_15__,__WEBPACK_EXTERNAL_MODULE_16__,__WEBPACK_EXTERNAL_MODULE_17__,root.jQuery)}):"object"==typeof exports?exports.kb=factory(require("knockout"),require("backbone"),require("underscore"),function(){try{return require("jquery")}catch(e){}}()):root.kb=factory(root.ko,root.Backbone,root._,root.jQuery)}(this,function(__WEBPACK_EXTERNAL_MODULE_15__,__WEBPACK_EXTERNAL_MODULE_16__,__WEBPACK_EXTERNAL_MODULE_17__,__WEBPACK_EXTERNAL_MODULE_18__){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){__webpack_require__(1),__webpack_require__(2),__webpack_require__(3),__webpack_require__(4),__webpack_require__(5),__webpack_require__(6),__webpack_require__(7),__webpack_require__(8),__webpack_require__(9),__webpack_require__(10),__webpack_require__(11),__webpack_require__(12),__webpack_require__(13),module.exports=__webpack_require__(14)},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var COMPARE_ASCENDING,COMPARE_DESCENDING,COMPARE_EQUAL,KEYS_PUBLISH,kb,ko,_,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}},__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,COMPARE_EQUAL=0,COMPARE_ASCENDING=-1,COMPARE_DESCENDING=1,KEYS_PUBLISH=["destroy","shareOptions","filters","comparator","sortAttribute","viewModelByModel","hasViewModels"],kb.compare=function(value_a,value_b){return _.isString(value_a)?value_a.localeCompare(""+value_b):_.isString(value_b)?value_b.localeCompare(""+value_a):value_a===value_b?COMPARE_EQUAL:value_b>value_a?COMPARE_ASCENDING:COMPARE_DESCENDING},kb.CollectionObservable=function(){function CollectionObservable(collection,options){return this._onCollectionChange=__bind(this._onCollectionChange,this),kb.ignore(function(_this){return function(){var create_options,observable,_ref1;return!_.isUndefined(options)||collection instanceof kb.Collection?_.isArray(collection)&&(collection=new kb.Collection(collection)):(_ref1=[new kb.Collection,collection],collection=_ref1[0],options=_ref1[1]),options||(options={}),observable=kb.utils.wrappedObservable(_this,ko.observableArray([])),observable.__kb_is_co=!0,_this.in_edit=0,_this.__kb||(_this.__kb={}),options=kb.utils.collapseOptions(options),options.auto_compact&&(_this.auto_compact=!0),options.sort_attribute?_this._comparator=ko.observable(_this._attributeComparator(options.sort_attribute)):_this._comparator=ko.observable(options.comparator),options.filters?_this._filters=ko.observableArray(_.isArray(options.filters)?options.filters:options.filters?[options.filters]:void 0):_this._filters=ko.observableArray([]),create_options=_this.create_options={store:kb.Store.useOptionsOrCreate(options,collection,observable)},_this.path=options.path,create_options.factory=kb.utils.wrappedFactory(observable,_this._shareOrCreateFactory(options)),create_options.path=kb.utils.pathJoin(options.path,"models"),create_options.creator=create_options.factory.creatorForPath(null,create_options.path),create_options.creator&&(_this.models_only=create_options.creator.models_only),kb.publishMethods(observable,_this,KEYS_PUBLISH),_this._collection=ko.observable(collection),observable.collection=_this.collection=ko.computed({read:function(){return _this._collection()},write:function(new_collection){return kb.ignore(function(){var previous_collection;if((previous_collection=_this._collection())!==new_collection)return previous_collection&&previous_collection.unbind("all",_this._onCollectionChange),new_collection&&new_collection.bind("all",_this._onCollectionChange),_this._collection(new_collection)})}}),collection&&collection.bind("all",_this._onCollectionChange),_this._mapper=ko.computed(function(){var comparator,current_collection,filter,filters,models,view_models,_i,_len;if(comparator=_this._comparator(),filters=_this._filters())for(_i=0,_len=filters.length;_len>_i;_i++)filter=filters[_i],ko.utils.unwrapObservable(filter);return current_collection=_this._collection(),_this.in_edit?void 0:(observable=kb.utils.wrappedObservable(_this),current_collection&&(models=current_collection.models),models&&0!==current_collection.models.length?(models=_.filter(models,function(model){return!filters.length||_this._selectModel(model)}),view_models=comparator?_.map(models,function(model){return _this._createViewModel(model)}).sort(comparator):_this.models_only?filters.length?models:models.slice():_.map(models,function(model){return _this._createViewModel(model)})):view_models=[],_this.in_edit++,observable(view_models),_this.in_edit--)}),observable.subscribe(_.bind(_this._onObservableArrayChange,_this)),!kb.statistics||kb.statistics.register("CollectionObservable",_this),observable}}(this))}return CollectionObservable.extend=kb.extend,CollectionObservable.prototype.destroy=function(){var array,collection,observable;return this.__kb_released=!0,observable=kb.utils.wrappedObservable(this),collection=kb.peek(this._collection),collection&&(collection.unbind("all",this._onCollectionChange),array=kb.peek(observable),array.splice(0,array.length)),this.collection.dispose(),this._collection=observable.collection=this.collection=null,this._mapper.dispose(),this._mapper=null,kb.release(this._filters),this._filters=null,this._comparator(null),this._comparator=null,this.create_options=null,observable.collection=null,kb.utils.wrappedDestroy(this),!kb.statistics||kb.statistics.unregister("CollectionObservable",this)},CollectionObservable.prototype.shareOptions=function(){var observable;return observable=kb.utils.wrappedObservable(this),{store:kb.utils.wrappedStore(observable),factory:kb.utils.wrappedFactory(observable)}},CollectionObservable.prototype.filters=function(filters){return filters?this._filters(_.isArray(filters)?filters:[filters]):this._filters([])},CollectionObservable.prototype.comparator=function(comparator){return this._comparator(comparator)},CollectionObservable.prototype.sortAttribute=function(sort_attribute){return this._comparator(sort_attribute?this._attributeComparator(sort_attribute):null)},CollectionObservable.prototype.viewModelByModel=function(model){var id_attribute;return this.models_only?null:(id_attribute=model.hasOwnProperty(model.idAttribute)?model.idAttribute:"cid",_.find(kb.peek(kb.utils.wrappedObservable(this)),function(test){var _ref1;return(null!=test&&null!=(_ref1=test.__kb)?_ref1.object:void 0)?test.__kb.object[id_attribute]===model[id_attribute]:!1}))},CollectionObservable.prototype.hasViewModels=function(){return!this.models_only},CollectionObservable.prototype.compact=function(){return kb.ignore(function(_this){return function(){var observable;return observable=kb.utils.wrappedObservable(_this),kb.utils.wrappedStoreIsOwned(observable)?(kb.utils.wrappedStore(observable).clear(),_this._collection.notifySubscribers(_this._collection())):void 0}}(this))},CollectionObservable.prototype._shareOrCreateFactory=function(options){var absolute_models_path,existing_creator,factories,factory;if(absolute_models_path=kb.utils.pathJoin(options.path,"models"),factories=options.factories,(factory=options.factory)&&(existing_creator=factory.creatorForPath(null,absolute_models_path))&&(!factories||factories.models===existing_creator)){if(!factories)return factory;if(factory.hasPathMappings(factories,options.path))return factory}return factory=new kb.Factory(options.factory),factories&&factory.addPathMappings(factories,options.path),factory.creatorForPath(null,absolute_models_path)||(options.hasOwnProperty("models_only")?options.models_only?factory.addPathMapping(absolute_models_path,{models_only:!0}):factory.addPathMapping(absolute_models_path,kb.ViewModel):options.view_model?factory.addPathMapping(absolute_models_path,options.view_model):options.create?factory.addPathMapping(absolute_models_path,{create:options.create}):factory.addPathMapping(absolute_models_path,kb.ViewModel)),factory},CollectionObservable.prototype._onCollectionChange=function(event,arg){return kb.ignore(function(_this){return function(){var collection,comparator,observable,view_model;if(!_this.in_edit)switch(event){case"reset":_this.auto_compact?_this.compact():_this._collection.notifySubscribers(_this._collection());break;case"sort":case"resort":_this._collection.notifySubscribers(_this._collection());break;case"new":case"add":if(!_this._selectModel(arg))return;if(observable=kb.utils.wrappedObservable(_this),collection=_this._collection(),-1===collection.indexOf(arg))return;if(view_model=_this.viewModelByModel(arg))return;_this.in_edit++,(comparator=_this._comparator())?(observable().push(_this._createViewModel(arg)),observable.sort(comparator)):observable.splice(collection.indexOf(arg),0,_this._createViewModel(arg)),_this.in_edit--;break;case"remove":case"destroy":_this._onModelRemove(arg);break;case"change":_this._selectModel(arg)?(view_model=_this.models_only?arg:_this.viewModelByModel(arg),view_model?(comparator=_this._comparator())&&(observable=kb.utils.wrappedObservable(_this),_this.in_edit++,observable.sort(comparator),_this.in_edit--):_this._onCollectionChange("add",arg)):_this._onModelRemove(arg)}}}(this))},CollectionObservable.prototype._onModelRemove=function(model){var observable,view_model;return(view_model=this.models_only?model:this.viewModelByModel(model))?(observable=kb.utils.wrappedObservable(this),this.in_edit++,observable.remove(view_model),this.in_edit--):void 0},CollectionObservable.prototype._onObservableArrayChange=function(models_or_view_models){return kb.ignore(function(_this){return function(){var collection,has_filters,model,models,observable,view_model,view_models,_i,_len;if(!_this.in_edit&&(_this.models_only&&(!models_or_view_models.length||kb.utils.hasModelSignature(models_or_view_models[0]))||!_this.models_only&&(!models_or_view_models.length||_.isObject(models_or_view_models[0])&&!kb.utils.hasModelSignature(models_or_view_models[0]))||kb._throwUnexpected(_this,"incorrect type passed"),observable=kb.utils.wrappedObservable(_this),collection=kb.peek(_this._collection),has_filters=kb.peek(_this._filters).length,collection)){if(view_models=models_or_view_models,_this.models_only)models=_.filter(models_or_view_models,function(model){return!has_filters||_this._selectModel(model)});else for(!has_filters||(view_models=[]),models=[],_i=0,_len=models_or_view_models.length;_len>_i;_i++){if(view_model=models_or_view_models[_i],model=kb.utils.wrappedObject(view_model),has_filters){if(!_this._selectModel(model))continue;view_models.push(view_model)}_this.create_options.store.findOrReplace(model,_this.create_options.creator,view_model),models.push(model)}_this.in_edit++,models_or_view_models.length===view_models.length||observable(view_models),_.isEqual(collection.models,models)||collection.reset(models),_this.in_edit--}}}(this))},CollectionObservable.prototype._attributeComparator=function(sort_attribute){var modelAttributeCompare;return modelAttributeCompare=function(model_a,model_b){var attribute_name;return attribute_name=ko.utils.unwrapObservable(sort_attribute),kb.compare(model_a.get(attribute_name),model_b.get(attribute_name))},this.models_only?modelAttributeCompare:function(model_a,model_b){return modelAttributeCompare(kb.utils.wrappedModel(model_a),kb.utils.wrappedModel(model_b))}},CollectionObservable.prototype._createViewModel=function(model){return this.models_only?model:this.create_options.store.findOrCreate(model,this.create_options)},CollectionObservable.prototype._selectModel=function(model){var filter,filters,_i,_len,_ref1;for(filters=kb.peek(this._filters),_i=0,_len=filters.length;_len>_i;_i++)if(filter=filters[_i],filter=kb.peek(filter),_.isFunction(filter)){if(!filter(model))return!1}else if(_.isArray(filter)){if(_ref1=model.id,__indexOf.call(filter,_ref1)<0)return!1}else if(model.id!==filter)return!1;return!0},CollectionObservable}(),kb.collectionObservable=function(collection,options){return new kb.CollectionObservable(collection,options)}},function(module,exports,__webpack_require__){var ALL_ORMS,kb,key,ko,value,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,ALL_ORMS={"default":null,"backbone-orm":null,"backbone-associations":__webpack_require__(19),"backbone-relational":__webpack_require__(20),supermodel:__webpack_require__(21)},kb.orm=ALL_ORMS["default"];for(key in ALL_ORMS)if(value=ALL_ORMS[key],value&&value.isAvailable()){kb.orm=value;break}module.exports=function(options){var orm;null==options&&(options={});for(key in options)switch(value=options[key],key){case"orm":if(_.isString(value)){if(!ALL_ORMS.hasOwnProperty(value)){console.log("Knockback configure: could not find orm: "+value+". Available: "+_.keys(ALL_ORMS).join(", "));continue}if((orm=ALL_ORMS[value])&&!orm.isAvailable()){console.log("Knockback configure: could not enable orm "+value+". Make sure it is included before Knockback");continue}kb.orm=orm;continue}kb.orm=value;break;default:kb[key]=value}}},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,ko,_,_ref,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,kb.EventWatcher=function(){function EventWatcher(emitter,obj,callback_options){this._unbindCallbacks=__bind(this._unbindCallbacks,this),this._onModelUnloaded=__bind(this._onModelUnloaded,this),this._onModelLoaded=__bind(this._onModelLoaded,this),this.__kb||(this.__kb={}),this.__kb.callbacks={},this.ee=null,callback_options&&this.registerCallbacks(obj,callback_options),emitter&&this.emitter(emitter)}return EventWatcher.useOptionsOrCreate=function(options,emitter,obj,callback_options){return options.event_watcher?(options.event_watcher.emitter()!==emitter&&options.event_watcher.model_ref!==emitter&&kb._throwUnexpected(this,"emitter not matching"),kb.utils.wrappedEventWatcher(obj,options.event_watcher).registerCallbacks(obj,callback_options)):(kb.utils.wrappedEventWatcherIsOwned(obj,!0),kb.utils.wrappedEventWatcher(obj,new kb.EventWatcher(emitter)).registerCallbacks(obj,callback_options))},EventWatcher.prototype.destroy=function(){return this.emitter(null),this.__kb.callbacks=null,kb.utils.wrappedDestroy(this)},EventWatcher.prototype.emitter=function(new_emitter){return 0===arguments.length||this.ee===new_emitter?this.ee:(this.model_ref&&(this.model_ref.unbind("loaded",this._onModelLoaded),this.model_ref.unbind("unloaded",this._onModelUnloaded),this.model_ref.release(),this.model_ref=null),kb.Backbone&&kb.Backbone.ModelRef&&new_emitter instanceof kb.Backbone.ModelRef?(this.model_ref=new_emitter,this.model_ref.retain(),this.model_ref.bind("loaded",this._onModelLoaded),this.model_ref.bind("unloaded",this._onModelUnloaded),new_emitter=this.model_ref.model()||null):delete this.model_ref,this.ee!==new_emitter&&(new_emitter?this._onModelLoaded(new_emitter):this._onModelUnloaded(this.ee)),new_emitter)},EventWatcher.prototype.registerCallbacks=function(obj,callback_info){var event_name,event_names,model,_fn,_i,_len;for(obj||kb._throwMissing(this,"obj"),callback_info||kb._throwMissing(this,"callback_info"),event_names=callback_info.event_selector?callback_info.event_selector.split(" "):["change"],model=this.ee,_fn=function(_this){return function(event_name){var callbacks,info;return(callbacks=_this.__kb.callbacks[event_name])||(callbacks=_this.__kb.callbacks[event_name]={model:null,list:[],fn:function(model){var info,_j,_len1,_ref1;for(_ref1=callbacks.list,_j=0,_len1=_ref1.length;_len1>_j;_j++)info=_ref1[_j],info.update&&(model&&info.key&&model.hasChanged&&!model.hasChanged(ko.utils.unwrapObservable(info.key))||(!kb.statistics||kb.statistics.addModelEvent({name:event_name,model:model,key:info.key,path:info.path}),info.update()));return null}}),callbacks.list.push(info=_.defaults({obj:obj},callback_info)),model?_this._onModelLoaded(model):void 0}}(this),_i=0,_len=event_names.length;_len>_i;_i++)event_name=event_names[_i],event_name&&_fn(event_name);return this},EventWatcher.prototype.releaseCallbacks=function(obj){var callbacks,event_name,_ref1;this.ee=null,_ref1=this.__kb.callbacks;for(event_name in _ref1)callbacks=_ref1[event_name],this._unbindCallbacks(event_name,callbacks,kb.wasReleased(obj));return delete this.__kb.callbacks},EventWatcher.prototype._onModelLoaded=function(model){var callbacks,event_name,info,_i,_len,_ref1,_ref2,_ref3;this.ee=model,_ref1=this.__kb.callbacks;for(event_name in _ref1)for(callbacks=_ref1[event_name],callbacks.model&&callbacks.model!==model&&this._unbindCallbacks(event_name,callbacks,!0),callbacks.model||(callbacks.model=model,model.bind(event_name,callbacks.fn)),_ref2=callbacks.list,_i=0,_len=_ref2.length;_len>_i;_i++)info=_ref2[_i],info.unbind_fn||(info.unbind_fn=null!=(_ref3=kb.orm)?_ref3.bind(model,info.key,info.update,info.path):void 0),info.emitter&&info.emitter(model)},EventWatcher.prototype._onModelUnloaded=function(model){var callbacks,event_name,_ref1;if(this.ee===model){this.ee=null,_ref1=this.__kb.callbacks;for(event_name in _ref1)callbacks=_ref1[event_name],this._unbindCallbacks(event_name,callbacks)}},EventWatcher.prototype._unbindCallbacks=function(event_name,callbacks,skip_emitter){var info,_i,_len,_ref1;for(callbacks.model&&(callbacks.model.unbind(event_name,callbacks.fn),callbacks.model=null),_ref1=callbacks.list,_i=0,_len=_ref1.length;_len>_i;_i++)info=_ref1[_i],info.unbind_fn&&(info.unbind_fn(),info.unbind_fn=null),!info.emitter||skip_emitter||kb.wasReleased(info.obj)||info.emitter(null)},EventWatcher}(),kb.emitterObservable=function(emitter,observable){return new kb.EventWatcher(emitter,observable)}},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,_;_=(kb=__webpack_require__(6))._,kb.Factory=function(){function Factory(parent_factory){this.parent_factory=parent_factory,this.paths={}}return Factory.useOptionsOrCreate=function(options,obj,owner_path){var factory;return options.factory&&(!options.factories||options.factories&&options.factory.hasPathMappings(options.factories,owner_path))?kb.utils.wrappedFactory(obj,options.factory):(factory=kb.utils.wrappedFactory(obj,new kb.Factory(options.factory)),options.factories&&factory.addPathMappings(options.factories,owner_path),factory)},Factory.prototype.hasPath=function(path){return this.paths.hasOwnProperty(path)||this.parent_factory&&this.parent_factory.hasPath(path)},Factory.prototype.addPathMapping=function(path,create_info){return this.paths[path]=create_info},Factory.prototype.addPathMappings=function(factories,owner_path){var create_info,path;for(path in factories)create_info=factories[path],this.paths[kb.utils.pathJoin(owner_path,path)]=create_info},Factory.prototype.hasPathMappings=function(factories,owner_path){var all_exist,creator,existing_creator,path;all_exist=!0;for(path in factories)creator=factories[path],all_exist&=(existing_creator=this.creatorForPath(null,kb.utils.pathJoin(owner_path,path)))&&creator===existing_creator;return all_exist},Factory.prototype.creatorForPath=function(obj,path){var creator;return(creator=this.paths[path])?creator.view_model?creator.view_model:creator:this.parent_factory&&(creator=this.parent_factory.creatorForPath(obj,path))?creator:null},Factory}()},function(module,exports,__webpack_require__){(function(global){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var $,kb,ko,onReady,window,_,_ko_applyBindings,_ref;window=null!=window?window:global,_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,$=_ref.$,kb.RECUSIVE_AUTO_INJECT=!0,ko.bindingHandlers.inject={init:function(element,value_accessor,all_bindings_accessor,view_model){return kb.Inject.inject(ko.utils.unwrapObservable(value_accessor()),view_model,element,value_accessor,all_bindings_accessor)}},kb.Inject=function(){function Inject(){}return Inject.inject=function(data,view_model,element,value_accessor,all_bindings_accessor,nested){var inject;return inject=function(data){var key,target,value;if(_.isFunction(data))view_model=new data(view_model,element,value_accessor,all_bindings_accessor),kb.releaseOnNodeRemove(view_model,element);else{data.view_model&&(view_model=new data.view_model(view_model,element,value_accessor,all_bindings_accessor),kb.releaseOnNodeRemove(view_model,element));for(key in data)value=data[key],"view_model"!==key&&("create"===key?value(view_model,element,value_accessor,all_bindings_accessor):_.isObject(value)&&!_.isFunction(value)?(target=nested||value&&value.create?{}:view_model,view_model[key]=kb.Inject.inject(value,target,element,value_accessor,all_bindings_accessor,!0)):view_model[key]=value)}return view_model},nested?inject(data):kb.ignore(function(){return inject(data)})},Inject.injectViewModels=function(root){var afterBinding,app,beforeBinding,data,expression,findElements,options,results,_i,_len;for(results=[],findElements=function(el){var attr,child_el,_i,_len,_ref1;for(el.__kb_injected||el.attributes&&(attr=_.find(el.attributes,function(attr){return"kb-inject"===attr.name}))&&(el.__kb_injected=!0,results.push({el:el,view_model:{},binding:attr.value})),_ref1=el.childNodes,_i=0,_len=_ref1.length;_len>_i;_i++)child_el=_ref1[_i],findElements(child_el)},!root&&(null!=window?window.document:void 0)&&(root=window.document),findElements(root),_i=0,_len=results.length;_len>_i;_i++)app=results[_i],(expression=app.binding)&&(expression.search(/[:]/)<0||(expression="{"+expression+"}"),data=new Function("","return ( "+expression+" )")(),data||(data={}),!data.options||(options=data.options,delete data.options),options||(options={}),app.view_model=kb.Inject.inject(data,app.view_model,app.el,null,null,!0),afterBinding=app.view_model.afterBinding||options.afterBinding,beforeBinding=app.view_model.beforeBinding||options.beforeBinding),beforeBinding&&beforeBinding(app.view_model,app.el,options),kb.applyBindings(app.view_model,app.el,options),afterBinding&&afterBinding(app.view_model,app.el,options);return results},Inject}(),_ko_applyBindings=ko.applyBindings,ko.applyBindings=function(context,element){var results;return results=kb.RECUSIVE_AUTO_INJECT?kb.injectViewModels(element):[],results.length?void 0:_ko_applyBindings.apply(this,arguments)},kb.injectViewModels=kb.Inject.injectViewModels,"undefined"!=typeof document&&null!==document&&($?$(function(){return kb.injectViewModels()}):(onReady=function(){return"complete"!==document.readyState?setTimeout(onReady,0):kb.injectViewModels()})())}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){(function(global){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var Backbone,copyProps,kb,ko,window,_;window=null!=window?window:global,ko=__webpack_require__(15),copyProps=function(dest,source){var key,value;for(key in source)value=source[key],dest[key]=value;return dest};var ctor=function(){},inherits=function(parent,protoProps,staticProps){var child;return child=protoProps&&protoProps.hasOwnProperty("constructor")?protoProps.constructor:function(){parent.apply(this,arguments)},copyProps(child,parent),ctor.prototype=parent.prototype,child.prototype=new ctor,protoProps&&copyProps(child.prototype,protoProps),staticProps&&copyProps(child,staticProps),child.prototype.constructor=child,child.__super__=parent.prototype,child},extend=function(protoProps,classProps){var child=inherits(this,protoProps,classProps);return child.extend=this.extend,child};module.exports=kb=function(){function kb(){}var _ref;return kb.VERSION="0.19.2",kb.TYPE_UNKNOWN=0,kb.TYPE_SIMPLE=1,kb.TYPE_ARRAY=2,kb.TYPE_MODEL=3,kb.TYPE_COLLECTION=4,kb.wasReleased=function(obj){return!obj||obj.__kb_released},kb.isReleaseable=function(obj,depth){var key,value;if(null==depth&&(depth=0),!obj||obj!==Object(obj)||obj.__kb_released)return!1;if(ko.isObservable(obj)||obj instanceof kb.ViewModel)return!0;if("function"==typeof obj||obj instanceof kb.Model||obj instanceof kb.Collection)return!1;if("function"==typeof obj.dispose||"function"==typeof obj.destroy||"function"==typeof obj.release)return!0;if(1>depth)for(key in obj)if(value=obj[key],"__kb"!==key&&kb.isReleaseable(value,depth+1))return!0;return!1},kb.release=function(obj){var array,index,value;if(kb.isReleaseable(obj))if(_.isArray(obj))for(index in obj)value=obj[index],kb.isReleaseable(value)&&(obj[index]=null,kb.release(value));else{if(obj.__kb_released=!0,ko.isObservable(obj)&&_.isArray(array=kb.peek(obj))){if(obj.__kb_is_co||obj.__kb_is_o&&obj.valueType()===kb.TYPE_COLLECTION)return obj.destroy();for(index in array)value=array[index],kb.isReleaseable(value)&&(array[index]=null,kb.release(value));return void("function"==typeof obj.dispose&&obj.dispose())}"function"==typeof obj.release?obj.release():"function"==typeof obj.destroy?obj.destroy():"function"==typeof obj.dispose?obj.dispose():ko.isObservable(obj)||this.releaseKeys(obj)}},kb.releaseKeys=function(obj){var key,value;for(key in obj)value=obj[key],"__kb"!==key&&kb.isReleaseable(value)&&(obj[key]=null,kb.release(value))},kb.releaseOnNodeRemove=function(view_model,node){return view_model||kb._throwUnexpected(this,"missing view model"),node||kb._throwUnexpected(this,"missing node"),ko.utils.domNodeDisposal.addDisposeCallback(node,function(){return kb.release(view_model)})},kb.renderTemplate=function(template,view_model,options){var document,el,observable;return null==options&&(options={}),(document=null!=window?window.document:void 0)?(el=document.createElement("div"),observable=ko.renderTemplate(template,view_model,options,el,"replaceChildren"),1===el.childNodes.length&&(el=el.childNodes[0]),kb.releaseOnNodeRemove(view_model,el),observable.dispose(),view_model.afterRender&&!options.afterRender&&view_model.afterRender(el),el):"undefined"!=typeof console&&null!==console?console.log("renderTemplate: document is undefined"):void 0},kb.applyBindings=function(view_model,node){return ko.applyBindings(view_model,node),kb.releaseOnNodeRemove(view_model,node)},kb.getValue=function(model,key,args){var _ref;if(model)return _.isFunction(model[key])&&(null!=(_ref=kb.orm)?_ref.useFunction(model,key):void 0)?model[key]():args?model.get.apply(model,_.map([key].concat(args),function(value){return kb.peek(value)})):model.get(key)},kb.setValue=function(model,key,value){var attributes,_ref;if(model)return _.isFunction(model[key])&&(null!=(_ref=kb.orm)?_ref.useFunction(model,key):void 0)?model[key](value):((attributes={})[key]=value,model.set(attributes))},kb.ignore=(null!=(_ref=ko.dependencyDetection)?_ref.ignore:void 0)||function(callback,callbackTarget,callbackArgs){var value;return value=null,ko.computed(function(){return value=callback.apply(callbackTarget,callbackArgs||[])}).dispose(),value},kb.extend=extend,kb._throwMissing=function(instance,message){throw""+(_.isString(instance)?instance:instance.constructor.name)+": "+message+" is missing"},kb._throwUnexpected=function(instance,message){throw""+(_.isString(instance)?instance:instance.constructor.name)+": "+message+" is unexpected"},kb.publishMethods=function(observable,instance,methods){var fn,_i,_len;for(_i=0,_len=methods.length;_len>_i;_i++)fn=methods[_i],observable[fn]=kb._.bind(instance[fn],instance)},kb.peek=function(obs){return ko.isObservable(obs)?obs.peek?obs.peek():kb.ignore(function(){return obs()}):obs},kb}(),window.Parse?(Backbone=kb.Parse=window.Parse,_=kb._=window.Parse._):(Backbone=kb.Backbone=__webpack_require__(16),_=kb._=__webpack_require__(17)),kb.ko=ko,kb.Collection=Backbone.Collection,kb.Model=Backbone.Object||Backbone.Model,kb.Events=Backbone.Events,kb.$=window.jQuery||window.$;try{kb.$||(kb.$=__webpack_require__(18))}catch(_error){}}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,ko,_extend,_ref,_ref1;ko=(kb=__webpack_require__(6)).ko,(null!=(_ref=ko.subscribable)&&null!=(_ref1=_ref.fn)?_ref1.extend:void 0)&&(_extend=ko.subscribable.fn.extend,ko.subscribable.fn.extend=function(){var target,_dispose;return target=_extend.apply(this,arguments),target!==this&&kb.isReleaseable(this)&&(_dispose=target.dispose,target.dispose=function(_this){return function(){return null!=_dispose&&_dispose.apply(target,arguments),kb.release(_this)}}(this)),target})},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var KEYS_INFO,KEYS_PUBLISH,TypedValue,kb,ko,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,TypedValue=__webpack_require__(11),KEYS_PUBLISH=["value","valueType","destroy"],KEYS_INFO=["args","read","write"],kb.Observable=function(){function Observable(model,key_or_info,options,_vm){return this._vm=null!=_vm?_vm:{},kb.ignore(function(_this){return function(){var create_options,event_watcher,key,observable,_i,_len;for(key_or_info||kb._throwMissing(_this,"key_or_info"),_this.key=key_or_info.key||key_or_info,_i=0,_len=KEYS_INFO.length;_len>_i;_i++)key=KEYS_INFO[_i],key_or_info[key]&&(_this[key]=key_or_info[key]);return create_options=kb.utils.collapseOptions(options),event_watcher=create_options.event_watcher,delete create_options.event_watcher,_this._value=new TypedValue(create_options),_this._model=ko.observable(),observable=kb.utils.wrappedObservable(_this,ko.computed({read:function(){var arg,args,_j,_len1,_model,_ref1,_ref2;for(_model=_this._model(),_ref1=args=[_this.key].concat(_this.args||[]),_j=0,_len1=_ref1.length;_len1>_j;_j++)arg=_ref1[_j],ko.utils.unwrapObservable(arg);return null!=(_ref2=kb.utils.wrappedEventWatcher(_this))&&_ref2.emitter(_model||null),_this.read?_this.update(_this.read.apply(_this._vm,args)):_.isUndefined(_model)||kb.ignore(function(){return _this.update(kb.getValue(_model,kb.peek(_this.key),_this.args))}),_this._value.value()},write:function(new_value){return kb.ignore(function(){var unwrapped_new_value,_model;return unwrapped_new_value=kb.utils.unwrapModels(new_value),_model=kb.peek(_this._model),_this.write?(_this.write.call(_this._vm,unwrapped_new_value),new_value=kb.getValue(_model,kb.peek(_this.key),_this.args)):_model&&kb.setValue(_model,kb.peek(_this.key),unwrapped_new_value),_this.update(new_value)})},owner:_this._vm})),observable.__kb_is_o=!0,create_options.store=kb.utils.wrappedStore(observable,create_options.store),create_options.path=kb.utils.pathJoin(create_options.path,_this.key),create_options.factories&&("function"==typeof create_options.factories||create_options.factories.create)?(create_options.factory=kb.utils.wrappedFactory(observable,new kb.Factory(create_options.factory)),create_options.factory.addPathMapping(create_options.path,create_options.factories)):create_options.factory=kb.Factory.useOptionsOrCreate(create_options,observable,create_options.path),delete create_options.factories,kb.publishMethods(observable,_this,KEYS_PUBLISH),observable.model=_this.model=ko.computed({read:function(){return ko.utils.unwrapObservable(_this._model)},write:function(new_model){return kb.ignore(function(){var new_value;if(!_this.__kb_released&&kb.peek(_this._model)!==new_model)return new_value=kb.getValue(new_model,kb.peek(_this.key),_this.args),_this._model(new_model),new_model?_.isUndefined(new_value)?void 0:_this.update(new_value):_this.update(null)})}}),kb.EventWatcher.useOptionsOrCreate({event_watcher:event_watcher},model||null,_this,{emitter:_this.model,update:function(){return kb.ignore(function(){return _this.update()})},key:_this.key,path:create_options.path}),_this._value.rawValue()||_this._value.update(),kb.LocalizedObservable&&key_or_info.localizer&&(observable=new key_or_info.localizer(observable)),kb.DefaultObservable&&key_or_info.hasOwnProperty("default")&&(observable=kb.defaultObservable(observable,key_or_info["default"])),observable}}(this))}return Observable.prototype.destroy=function(){var observable;return observable=kb.utils.wrappedObservable(this),this.__kb_released=!0,this._value.destroy(),this._value=null,this.model.dispose(),this.model=observable.model=null,kb.utils.wrappedDestroy(this)},Observable.prototype.value=function(){return this._value.rawValue()},Observable.prototype.valueType=function(){return this._value.valueType(kb.peek(this._model),kb.peek(this.key))},Observable.prototype.update=function(new_value){return this.__kb_released?void 0:(arguments.length||(new_value=kb.getValue(kb.peek(this._model),kb.peek(this.key))),this._value.update(new_value))},Observable}(),kb.observable=function(model,key,options,view_model){return new kb.Observable(model,key,options,view_model)}},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,_;_=(kb=__webpack_require__(6))._,module.exports=kb.Statistics=function(){function Statistics(){this.model_events_tracker=[],this.registered_tracker={}}return Statistics.prototype.clear=function(){return this.model_events_tracker=[]},Statistics.prototype.addModelEvent=function(event){return this.model_events_tracker.push(event)},Statistics.prototype.modelEventsStatsString=function(){var event_groups,key,stats_string,value;stats_string="",stats_string+="Total Count: "+this.model_events_tracker.length,event_groups=_.groupBy(this.model_events_tracker,function(test){return"event name: '"+test.name+"', attribute name: '"+test.key+"'"});for(key in event_groups)value=event_groups[key],stats_string+="\n "+key+", count: "+value.length;return stats_string},Statistics.prototype.register=function(key,obj){return this.registeredTracker(key).push(obj)},Statistics.prototype.unregister=function(key,obj){var index,type_tracker;return type_tracker=this.registeredTracker(key),index=_.indexOf(type_tracker,obj),0>index&&"undefined"!=typeof console&&null!==console&&console.log("kb.Statistics: failed to unregister type: "+key),type_tracker.splice(index,1)},Statistics.prototype.registeredCount=function(type){var count,type_tracker,_ref;if(type)return this.registeredTracker(type).length;count=0,_ref=this.registered_tracker[type];for(type in _ref)type_tracker=_ref[type],count+=type_tracker.length;return count},Statistics.prototype.registeredStatsString=function(success_message){var stats_string,type,type_tracker,written,_ref;stats_string="",_ref=this.registered_tracker;for(type in _ref)type_tracker=_ref[type],type_tracker.length&&(written&&(stats_string+="\n "),stats_string+=""+(type?type:"No Name")+": "+type_tracker.length,written=!0);return stats_string?stats_string:success_message},Statistics.prototype.registeredTracker=function(key){var type_tracker;return this.registered_tracker.hasOwnProperty(key)?this.registered_tracker[key]:(type_tracker=[],this.registered_tracker[key]=type_tracker,type_tracker)},Statistics.eventsStats=function(obj,key){var events,node,stats,tail,_i,_len,_ref;for(stats={count:0},events=obj._events||obj._callbacks||{},_ref=key?[key]:_.keys(events),_i=0,_len=_ref.length;_len>_i;_i++)if(key=_ref[_i],node=events[key]){if(_.isArray(node))stats[key]=_.compact(node).length;else for(stats[key]=0,tail=node.tail;(node=node.next)!==tail;)stats[key]++;stats.count+=stats[key]}return stats},Statistics}()},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,ko,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,module.exports=kb.Store=function(){function Store(){this.observable_records=[],this.replaced_observables=[]}return Store.useOptionsOrCreate=function(options,obj,observable){return options.store?(options.store.register(obj,observable,options),kb.utils.wrappedStore(observable,options.store)):(kb.utils.wrappedStoreIsOwned(observable,!0),kb.utils.wrappedStore(observable,new kb.Store))},Store.prototype.destroy=function(){return this.clear()},Store.prototype.clear=function(){var observable_records,record,replaced_observables,_i,_len,_ref1,_ref2;for(_ref1=[this.observable_records,[]],observable_records=_ref1[0],this.observable_records=_ref1[1],_i=0,_len=observable_records.length;_len>_i;_i++)record=observable_records[_i],kb.release(record.observable);_ref2=[this.replaced_observables,[]],replaced_observables=_ref2[0],this.replaced_observables=_ref2[1],kb.release(replaced_observables)},Store.prototype.compact=function(){var record,removals,_i,_len,_ref1,_ref2;for(removals=[],_ref1=this.observable_records,_i=0,_len=_ref1.length;_len>_i;_i++)record=_ref1[_i],(null!=(_ref2=record.observable)?_ref2.__kb_released:void 0)&&removals.push(record);removals.length&&(this.observable_records=_.difference(this.observable_records,removals))},Store.prototype.register=function(obj,observable,options){var creator;if(observable&&!ko.isObservable(observable)&&!observable.__kb_is_co)return kb.utils.wrappedObject(observable,obj),obj||(observable.__kb_null=!0),creator=options.creator?options.creator:options.path&&options.factory?options.factory.creatorForPath(obj,options.path):null,creator||(creator=observable.constructor),this.observable_records.push({obj:obj,observable:observable,creator:creator}),observable},Store.prototype.findIndex=function(obj,creator){var index,record,removals,_ref1;if(removals=[],!obj||obj instanceof kb.Model){_ref1=this.observable_records;for(index in _ref1)if(record=_ref1[index],record.observable)if(record.observable.__kb_released)removals.push(record);else if((obj||record.observable.__kb_null)&&(!obj||!record.observable.__kb_null&&record.obj===obj)&&(record.creator===creator||record.creator.create&&record.creator.create===creator.create))return removals.length?(this.observable_records=_.difference(this.observable_records,removals),_.indexOf(this.observable_records,record)):index}return removals.length&&(this.observable_records=_.difference(this.observable_records,removals)),-1},Store.prototype.find=function(obj,creator){var index;return(index=this.findIndex(obj,creator))<0?null:this.observable_records[index].observable},Store.prototype.isRegistered=function(observable){var record,_i,_len,_ref1;for(_ref1=this.observable_records,_i=0,_len=_ref1.length;_len>_i;_i++)if(record=_ref1[_i],record.observable===observable)return!0;return!1},Store.prototype.findOrCreate=function(obj,options){var creator,observable;return options.store=this,options.creator||(options.creator=kb.utils.inferCreator(obj,options.factory,options.path)),!options.creator&&obj instanceof kb.Model&&(options.creator=kb.ViewModel),(creator=options.creator)?creator.models_only?obj:(creator&&(observable=this.find(obj,creator)),observable?observable:(observable=kb.ignore(function(_this){return function(){return observable=creator.create?creator.create(obj,options):new creator(obj,options),observable||ko.observable(null)}}(this)),ko.isObservable(observable)||this.isRegistered(observable)||this.register(obj,observable,options),observable)):kb.utils.createFromDefaultCreator(obj,options)},Store.prototype.findOrReplace=function(obj,creator,observable){var index,record;return obj||kb._throwUnexpected(this,"obj missing"),(index=this.findIndex(obj,creator))<0?this.register(obj,observable,{creator:creator}):(record=this.observable_records[index],kb.utils.wrappedObject(record.observable)===obj||kb._throwUnexpected(this,"different object"),record.observable!==observable&&(record.observable.constructor===observable.constructor||kb._throwUnexpected(this,"replacing different type"),this.replaced_observables.push(record.observable),record.observable=observable),observable)},Store}()},function(module,exports,__webpack_require__){var TypedValue,kb,ko,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,module.exports=TypedValue=function(){function TypedValue(create_options){this.create_options=create_options,this._vo=ko.observable(null)}return TypedValue.prototype.destroy=function(){return this.__kb_released=!0,kb.release(this.__kb_value),this.__kb_value=null},TypedValue.prototype.value=function(){return ko.utils.unwrapObservable(this._vo())},TypedValue.prototype.rawValue=function(){return this.__kb_value},TypedValue.prototype.valueType=function(model,key){var new_value;return new_value=kb.getValue(model,key),this.value_type||this._updateValueObservable(new_value),this.value_type},TypedValue.prototype.update=function(new_value){var new_type,value;if(!this.__kb_released){switch(void 0!==new_value||(new_value=null),new_type=kb.utils.valueType(new_value),(!this.__kb_value||this.__kb_value.__kb_released||this.__kb_value.__kb_null&&new_value)&&(this.__kb_value=void 0,this.value_type=void 0),value=this.__kb_value,this.value_type){case kb.TYPE_COLLECTION:if(this.value_type===kb.TYPE_COLLECTION&&new_type===kb.TYPE_ARRAY)return value(new_value);if((new_type===kb.TYPE_COLLECTION||_.isNull(new_value))&&_.isFunction(value.collection))return void(kb.peek(value.collection)!==new_value&&value.collection(new_value));break;case kb.TYPE_MODEL:if(new_type===kb.TYPE_MODEL||_.isNull(new_value))return void(_.isFunction(value.model)?kb.peek(value.model)!==new_value&&value.model(new_value):kb.utils.wrappedObject(value)!==new_value&&this._updateValueObservable(new_value))}if(this.value_type!==new_type||_.isUndefined(this.value_type)){if(kb.peek(value)!==new_value)return this._updateValueObservable(new_value)}else if(kb.peek(value)!==new_value)return value(new_value)}},TypedValue.prototype._updateValueObservable=function(new_value){var create_options,creator,previous_value,value;return create_options=this.create_options,creator=create_options.creator=kb.utils.inferCreator(new_value,create_options.factory,create_options.path),this.value_type=kb.TYPE_UNKNOWN,previous_value=this.__kb_value,this.__kb_value=void 0,previous_value&&kb.release(previous_value),creator?create_options.store?value=create_options.store.findOrCreate(new_value,create_options):creator.models_only?(value=new_value,this.value_type=kb.TYPE_SIMPLE):value=creator.create?creator.create(new_value,create_options):new creator(new_value,create_options):_.isArray(new_value)?(this.value_type=kb.TYPE_ARRAY,value=ko.observableArray(new_value)):(this.value_type=kb.TYPE_SIMPLE,value=ko.observable(new_value)),this.value_type===kb.TYPE_UNKNOWN&&(ko.isObservable(value)?value.__kb_is_co?this.value_type=kb.TYPE_COLLECTION:this.value_type=kb.TYPE_SIMPLE:(this.value_type=kb.TYPE_MODEL,"function"!=typeof value.model&&kb.utils.wrappedObject(value,new_value))),this.__kb_value=value,this._vo(value)},TypedValue}()},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,ko,_,_argumentsAddKey,_keyArrayToObject,_mergeArray,_mergeObject,_ref,_wrappedKey;_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,_wrappedKey=kb._wrappedKey=function(obj,key,value){return 2===arguments.length?obj&&obj.__kb&&obj.__kb.hasOwnProperty(key)?obj.__kb[key]:void 0:(obj||kb._throwUnexpected(this,"no obj for wrapping "+key),obj.__kb||(obj.__kb={}),obj.__kb[key]=value,value)},_argumentsAddKey=function(args,key){return Array.prototype.splice.call(args,1,0,key),args},_mergeArray=function(result,key,value){return result[key]||(result[key]=[]),_.isArray(value)||(value=[value]),result[key]=result[key].length?_.union(result[key],value):value,result},_mergeObject=function(result,key,value){return result[key]||(result[key]={}),_.extend(result[key],value)},_keyArrayToObject=function(value){var item,result,_i,_len;for(result={},_i=0,_len=value.length;_len>_i;_i++)item=value[_i],result[item]={key:item};return result},kb.utils=function(){function utils(){}return utils.wrappedObservable=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"observable"))},utils.wrappedObject=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"object"))},utils.wrappedModel=function(obj,value){return 1===arguments.length?(value=_wrappedKey(obj,"object"),_.isUndefined(value)?obj:value):_wrappedKey(obj,"object",value)},utils.wrappedStore=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"store"))},utils.wrappedStoreIsOwned=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"store_is_owned"))},utils.wrappedFactory=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"factory"))},utils.wrappedEventWatcher=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"event_watcher"))},utils.wrappedEventWatcherIsOwned=function(obj,value){return _wrappedKey.apply(this,_argumentsAddKey(arguments,"event_watcher_is_owned"))},utils.wrappedDestroy=function(obj){var __kb;if(obj.__kb)return obj.__kb.event_watcher&&obj.__kb.event_watcher.releaseCallbacks(obj),__kb=obj.__kb,obj.__kb=null,__kb.observable&&(__kb.observable.destroy=__kb.observable.release=null,this.wrappedDestroy(__kb.observable),__kb.observable=null),__kb.factory=null,__kb.event_watcher_is_owned&&__kb.event_watcher.destroy(),__kb.event_watcher=null,__kb.store_is_owned&&__kb.store.destroy(),__kb.store=null},utils.valueType=function(observable){return observable?observable.__kb_is_o?observable.valueType():observable.__kb_is_co||observable instanceof kb.Collection?kb.TYPE_COLLECTION:observable instanceof kb.ViewModel||observable instanceof kb.Model?kb.TYPE_MODEL:_.isArray(observable)?kb.TYPE_ARRAY:kb.TYPE_SIMPLE:kb.TYPE_UNKNOWN},utils.pathJoin=function(path1,path2){return(path1?"."!==path1[path1.length-1]?""+path1+".":path1:"")+path2},utils.optionsPathJoin=function(options,path){return _.defaults({path:this.pathJoin(options.path,path)},options)},utils.inferCreator=function(value,factory,path){var creator;return factory&&(creator=factory.creatorForPath(value,path))?creator:value?value instanceof kb.Model?kb.ViewModel:value instanceof kb.Collection?kb.CollectionObservable:null:null},utils.createFromDefaultCreator=function(obj,options){return obj instanceof kb.Model?kb.viewModel(obj,options):obj instanceof kb.Collection?kb.collectionObservable(obj,options):_.isArray(obj)?ko.observableArray(obj):ko.observable(obj)},utils.hasModelSignature=function(obj){return obj&&obj.attributes&&!obj.models&&"function"==typeof obj.get&&"function"==typeof obj.trigger},utils.hasCollectionSignature=function(obj){return obj&&obj.models&&"function"==typeof obj.get&&"function"==typeof obj.trigger},utils.collapseOptions=function(options){var key,result,value,_ref1;for(result={},options={options:options};options.options;){_ref1=options.options;for(key in _ref1)switch(value=_ref1[key],key){case"internals":case"requires":case"excludes":case"statics":_mergeArray(result,key,value);break;case"keys":_.isObject(value)&&!_.isArray(value)||_.isObject(result[key])&&!_.isArray(result[key])?(_.isObject(value)||(value=[value]),_.isArray(value)&&(value=_keyArrayToObject(value)),_.isArray(result[key])&&(result[key]=_keyArrayToObject(result[key])),_mergeObject(result,key,value)):_mergeArray(result,key,value);break;case"factories":_.isFunction(value)?result[key]=value:_mergeObject(result,key,value);break;case"static_defaults":_mergeObject(result,key,value);break;case"options":break;default:result[key]=value}options=options.options}return result},utils.unwrapModels=function(obj){var key,result,value;if(!obj)return obj;if(obj.__kb)return"object"in obj.__kb?obj.__kb.object:obj;if(_.isArray(obj))return _.map(obj,function(test){return kb.utils.unwrapModels(test)});if(_.isObject(obj)&&obj.constructor==={}.constructor){result={};for(key in obj)value=obj[key],result[key]=kb.utils.unwrapModels(value);return result}return obj},utils}()},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var KEYS_OPTIONS,assignViewModelKey,createObservable,createOptions,createStaticObservables,kb,ko,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,ko=_ref.ko,createOptions=function(_this){return function(vm){return{store:kb.utils.wrappedStore(vm),factory:kb.utils.wrappedFactory(vm),path:vm.__kb.path,event_watcher:kb.utils.wrappedEventWatcher(vm)}}}(this),assignViewModelKey=function(vm,key){var vm_key;return vm_key=vm.__kb.internals&&_.contains(vm.__kb.internals,key)?"_"+key:key,vm.__kb.view_model.hasOwnProperty(vm_key)?void 0:(vm.__kb.view_model[vm_key]=null,vm_key)},createObservable=function(vm,model,key,create_options){var vm_key;if((!vm.__kb.excludes||!_.contains(vm.__kb.excludes,key))&&(!vm.__kb.statics||!_.contains(vm.__kb.statics,key))&&(vm_key=assignViewModelKey(vm,key)))return vm[vm_key]=vm.__kb.view_model[vm_key]=kb.observable(model,key,create_options,vm)},createStaticObservables=function(vm,model){var key,vm_key,_i,_len,_ref1;for(_ref1=vm.__kb.statics,_i=0,_len=_ref1.length;_len>_i;_i++)key=_ref1[_i],(vm_key=assignViewModelKey(vm,key))&&(model.has(vm_key)?vm[vm_key]=vm.__kb.view_model[vm_key]=model.get(vm_key):vm.__kb.static_defaults&&vm_key in vm.__kb.static_defaults?vm[vm_key]=vm.__kb.view_model[vm_key]=vm.__kb.static_defaults[vm_key]:delete vm.__kb.view_model[vm_key])},KEYS_OPTIONS=["keys","internals","excludes","statics","static_defaults"],kb.ViewModel=function(){function ViewModel(model,options,view_model){return null==options&&(options={}),kb.ignore(function(_this){return function(){var create_options,event_watcher,key,_i,_len,_model;for(!model||model instanceof kb.Model||"function"==typeof model.get&&"function"==typeof model.bind||kb._throwUnexpected(_this,"not a model"),options=_.isArray(options)?{keys:options}:kb.utils.collapseOptions(options),_this.__kb||(_this.__kb={}),_this.__kb.view_model=view_model||_this,_i=0,_len=KEYS_OPTIONS.length;_len>_i;_i++)key=KEYS_OPTIONS[_i],options.hasOwnProperty(key)&&(_this.__kb[key]=options[key]);return kb.Store.useOptionsOrCreate(options,model,_this),_this.__kb.path=options.path,kb.Factory.useOptionsOrCreate(options,_this,options.path),_model=kb._wrappedKey(_this,"_model",ko.observable()),_this.model=ko.computed({read:function(){return ko.utils.unwrapObservable(_model)},write:function(new_model){return kb.ignore(function(){return kb.utils.wrappedObject(_this)!==new_model&&!kb.wasReleased(_this)&&event_watcher?_this.__kb_null?void(!new_model||kb._throwUnexpected(_this,"model set on shared null")):(event_watcher.emitter(new_model),kb.utils.wrappedObject(_this,event_watcher.ee),_model(event_watcher.ee),!event_watcher.ee||_this.createObservables(event_watcher.ee)):void 0})}}),event_watcher=kb.utils.wrappedEventWatcher(_this,new kb.EventWatcher(model,_this,{emitter:_this._model,update:function(){return kb.ignore(function(){return!(null!=event_watcher?event_watcher.ee:void 0)||_this.createObservables(null!=event_watcher?event_watcher.ee:void 0)})}})),kb.utils.wrappedObject(_this,model=event_watcher.ee),_model(event_watcher.ee),create_options=createOptions(_this),!options.requires||_this.createObservables(model,options.requires,create_options),!_this.__kb.internals||_this.createObservables(model,_this.__kb.internals,create_options),!options.mappings||_this.createObservables(model,options.mappings,create_options),!_this.__kb.statics||createStaticObservables(_this,model),_this.createObservables(model,_this.__kb.keys,create_options),!kb.statistics||kb.statistics.register("ViewModel",_this),_this}}(this))}return ViewModel.extend=kb.extend,ViewModel.prototype.destroy=function(){var vm_key;if(this.__kb_released=!0,this.__kb.view_model!==this)for(vm_key in this.__kb.vm_keys)this.__kb.view_model[vm_key]=null;return this.__kb.view_model=null,kb.releaseKeys(this),kb.utils.wrappedDestroy(this),!kb.statistics||kb.statistics.unregister("ViewModel",this)},ViewModel.prototype.shareOptions=function(){return{store:kb.utils.wrappedStore(this),factory:kb.utils.wrappedFactory(this)}},ViewModel.prototype.createObservables=function(model,keys,create_options){var key,mapping_info,rel_keys,vm_key,_i,_j,_len,_len1,_ref1;if(create_options||(create_options=createOptions(this)),keys)if(_.isArray(keys))for(_j=0,_len1=keys.length;_len1>_j;_j++)key=keys[_j],createObservable(this,model,key,create_options);else for(key in keys)mapping_info=keys[key],(vm_key=assignViewModelKey(this,key))&&(_.isString(mapping_info)||mapping_info.key||(mapping_info.key=vm_key),this[vm_key]=this.__kb.view_model[vm_key]=kb.observable(model,mapping_info,create_options,this));else{if(this.__kb.keys||!model)return;for(key in model.attributes)createObservable(this,model,key,create_options);if(rel_keys=null!=(_ref1=kb.orm)&&"function"==typeof _ref1.keys?_ref1.keys(model):void 0)for(_i=0,_len=rel_keys.length;_len>_i;_i++)key=rel_keys[_i],createObservable(this,model,key,create_options)}},ViewModel}(),kb.viewModel=function(model,options,view_model){return new kb.ViewModel(model,options,view_model)}},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var kb,key,_i,_len,_ref;if(module.exports=kb=__webpack_require__(6),kb.configure=__webpack_require__(2),kb.modules={underscore:kb._,backbone:kb.Parse||kb.Backbone,knockout:kb.ko},"undefined"!=typeof window&&null!==window)for(_ref=["_","Backbone","Parse","ko","$"],_i=0,_len=_ref.length;_len>_i;_i++)key=_ref[_i],kb[key]&&!window.hasOwnProperty(key)&&(window[key]=kb[key])},function(module,exports,__webpack_require__){module.exports=__WEBPACK_EXTERNAL_MODULE_15__},function(module,exports,__webpack_require__){module.exports=__WEBPACK_EXTERNAL_MODULE_16__},function(module,exports,__webpack_require__){module.exports=__WEBPACK_EXTERNAL_MODULE_17__},function(module,exports,__webpack_require__){if("undefined"==typeof __WEBPACK_EXTERNAL_MODULE_18__){var e=new Error('Cannot find module "undefined"');throw e.code="MODULE_NOT_FOUND",e}module.exports=__WEBPACK_EXTERNAL_MODULE_18__},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var AssociatedModel,Backbone,BackboneAssociations,kb,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,Backbone=_ref.Backbone,AssociatedModel=null,module.exports=BackboneAssociations=function(){function BackboneAssociations(){}return BackboneAssociations.isAvailable=function(){return!!(AssociatedModel=null!=Backbone?Backbone.AssociatedModel:void 0)},BackboneAssociations.keys=function(model){return model instanceof AssociatedModel?_.map(model.relations,function(test){return test.key}):null},BackboneAssociations.relationType=function(model,key){var relation;return model instanceof AssociatedModel&&(relation=_.find(model.relations,function(test){return test.key===key}))?"Many"===relation.type?kb.TYPE_COLLECTION:kb.TYPE_MODEL:null},BackboneAssociations}()},function(module,exports,__webpack_require__){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var Backbone,BackboneRelational,RelationalModel,kb,_,_ref;_ref=kb=__webpack_require__(6),_=_ref._,Backbone=_ref.Backbone,RelationalModel=null,module.exports=BackboneRelational=function(){function BackboneRelational(){}return BackboneRelational.isAvailable=function(){return!!(RelationalModel=null!=Backbone?Backbone.RelationalModel:void 0)},BackboneRelational.relationType=function(model,key){var relation;return model instanceof RelationalModel&&(relation=_.find(model.getRelations(),function(test){return test.key===key}))?relation.collectionType||_.isArray(relation.keyContents)?kb.TYPE_COLLECTION:kb.TYPE_MODEL:null},BackboneRelational.bind=function(model,key,update,path){var event,events,rel_fn,type,_i,_len;if(!(type=this.relationType(model,key)))return null;if(rel_fn=function(model){return!kb.statistics||kb.statistics.addModelEvent({name:"update (relational)",model:model,key:key,path:path}),update()},events=kb.Backbone.Relation.prototype.sanitizeOptions?["update","add","remove"]:["change","add","remove"],type===kb.TYPE_COLLECTION)for(_i=0,_len=events.length;_len>_i;_i++)event=events[_i],model.bind(""+event+":"+key,rel_fn);else model.bind(""+events[0]+":"+key,rel_fn);return function(){var _j,_len1;if(type===kb.TYPE_COLLECTION)for(_j=0,_len1=events.length;_len1>_j;_j++)event=events[_j],model.unbind(""+event+":"+key,rel_fn);else model.unbind(""+events[0]+":"+key,rel_fn)}},BackboneRelational}()},function(module,exports,__webpack_require__){(function(global){/*
    knockback.js 0.19.2
    Copyright (c)  2011-2014 Kevin Malakoff.
    License: MIT (http://www.opensource.org/licenses/mit-license.php)
    Source: https://github.com/kmalakoff/knockback
    Dependencies: Knockout.js, Backbone.js, and Underscore.js (or LoDash.js).
    Optional dependencies: Backbone.ModelRef.js and BackboneORM.
   */
var Supermodel,kb,root,_;root="undefined"!=typeof window&&null!==window?window:global,_=(kb=__webpack_require__(6))._,Supermodel=null,module.exports=Supermodel=function(){function Supermodel(){}return Supermodel.isAvailable=function(){return!!(Supermodel=root.Supermodel)},Supermodel.keys=function(model){return model instanceof Supermodel.Model?_.keys(model.constructor.associations()):null},Supermodel.relationType=function(model,key){var relation;return model instanceof Supermodel.Model&&(relation=model.constructor.associations()[key])?relation.add?kb.TYPE_COLLECTION:kb.TYPE_MODEL:null},Supermodel.bind=function(model,key,update,path){var rel_fn,type;return(type=this.relationType(model,key))?(rel_fn=function(model,other){var previous,relation;return!kb.statistics||kb.statistics.addModelEvent({name:"update (supermodel)",model:model,key:key,path:path}),relation=model.constructor.associations()[key],previous=model[relation.store],model[relation.store]=other,update(other),model[relation.store]=previous},type===kb.TYPE_MODEL?(model.bind("associate:"+key,rel_fn),function(){return model.unbind("associate:"+key,rel_fn)}):void 0):null},Supermodel.useFunction=function(model,key){return!!this.relationType(model,key)},Supermodel}()}).call(exports,function(){return this}())}])}),
//! moment.js
//! version : 2.4.0
//! authors : Tim Wood, Iskren Chernev, Moment.js contributors
//! license : MIT
//! momentjs.com
function(undefined){function padToken(func,count){return function(a){return leftZeroFill(func.call(this,a),count)}}function ordinalizeToken(func,period){return function(a){return this.lang().ordinal(func.call(this,a),period)}}function Language(){}function Moment(config){checkOverflow(config),extend(this,config)}function Duration(duration){var normalizedInput=normalizeObjectUnits(duration),years=normalizedInput.year||0,months=normalizedInput.month||0,weeks=normalizedInput.week||0,days=normalizedInput.day||0,hours=normalizedInput.hour||0,minutes=normalizedInput.minute||0,seconds=normalizedInput.second||0,milliseconds=normalizedInput.millisecond||0;this._input=duration,this._milliseconds=+milliseconds+1e3*seconds+6e4*minutes+36e5*hours,this._days=+days+7*weeks,this._months=+months+12*years,this._data={},this._bubble()}function extend(a,b){for(var i in b)b.hasOwnProperty(i)&&(a[i]=b[i]);return b.hasOwnProperty("toString")&&(a.toString=b.toString),b.hasOwnProperty("valueOf")&&(a.valueOf=b.valueOf),a}function absRound(number){return 0>number?Math.ceil(number):Math.floor(number)}function leftZeroFill(number,targetLength){for(var output=number+"";output.length<targetLength;)output="0"+output;return output}function addOrSubtractDurationFromMoment(mom,duration,isAdding,ignoreUpdateOffset){var minutes,hours,milliseconds=duration._milliseconds,days=duration._days,months=duration._months;milliseconds&&mom._d.setTime(+mom._d+milliseconds*isAdding),(days||months)&&(minutes=mom.minute(),hours=mom.hour()),days&&mom.date(mom.date()+days*isAdding),months&&mom.month(mom.month()+months*isAdding),milliseconds&&!ignoreUpdateOffset&&moment.updateOffset(mom),(days||months)&&(mom.minute(minutes),mom.hour(hours))}function isArray(input){return"[object Array]"===Object.prototype.toString.call(input)}function isDate(input){return"[object Date]"===Object.prototype.toString.call(input)||input instanceof Date}function compareArrays(array1,array2,dontConvert){var i,len=Math.min(array1.length,array2.length),lengthDiff=Math.abs(array1.length-array2.length),diffs=0;for(i=0;len>i;i++)(dontConvert&&array1[i]!==array2[i]||!dontConvert&&toInt(array1[i])!==toInt(array2[i]))&&diffs++;return diffs+lengthDiff}function normalizeUnits(units){if(units){var lowered=units.toLowerCase().replace(/(.)s$/,"$1");units=unitAliases[units]||camelFunctions[lowered]||lowered}return units}function normalizeObjectUnits(inputObject){var normalizedProp,prop,normalizedInput={};for(prop in inputObject)inputObject.hasOwnProperty(prop)&&(normalizedProp=normalizeUnits(prop),normalizedProp&&(normalizedInput[normalizedProp]=inputObject[prop]));return normalizedInput}function makeList(field){var count,setter;if(0===field.indexOf("week"))count=7,setter="day";else{if(0!==field.indexOf("month"))return;count=12,setter="month"}moment[field]=function(format,index){var i,getter,method=moment.fn._lang[field],results=[];if("number"==typeof format&&(index=format,format=undefined),getter=function(i){var m=moment().utc().set(setter,i);return method.call(moment.fn._lang,m,format||"")},null!=index)return getter(index);for(i=0;count>i;i++)results.push(getter(i));return results}}function toInt(argumentForCoercion){var coercedNumber=+argumentForCoercion,value=0;return 0!==coercedNumber&&isFinite(coercedNumber)&&(value=coercedNumber>=0?Math.floor(coercedNumber):Math.ceil(coercedNumber)),value}function daysInMonth(year,month){return new Date(Date.UTC(year,month+1,0)).getUTCDate()}function daysInYear(year){return isLeapYear(year)?366:365}function isLeapYear(year){return year%4===0&&year%100!==0||year%400===0}function checkOverflow(m){var overflow;m._a&&-2===m._pf.overflow&&(overflow=m._a[MONTH]<0||m._a[MONTH]>11?MONTH:m._a[DATE]<1||m._a[DATE]>daysInMonth(m._a[YEAR],m._a[MONTH])?DATE:m._a[HOUR]<0||m._a[HOUR]>23?HOUR:m._a[MINUTE]<0||m._a[MINUTE]>59?MINUTE:m._a[SECOND]<0||m._a[SECOND]>59?SECOND:m._a[MILLISECOND]<0||m._a[MILLISECOND]>999?MILLISECOND:-1,m._pf._overflowDayOfYear&&(YEAR>overflow||overflow>DATE)&&(overflow=DATE),m._pf.overflow=overflow)}function initializeParsingFlags(config){config._pf={empty:!1,unusedTokens:[],unusedInput:[],overflow:-2,charsLeftOver:0,nullInput:!1,invalidMonth:null,invalidFormat:!1,userInvalidated:!1,iso:!1}}function isValid(m){return null==m._isValid&&(m._isValid=!isNaN(m._d.getTime())&&m._pf.overflow<0&&!m._pf.empty&&!m._pf.invalidMonth&&!m._pf.nullInput&&!m._pf.invalidFormat&&!m._pf.userInvalidated,m._strict&&(m._isValid=m._isValid&&0===m._pf.charsLeftOver&&0===m._pf.unusedTokens.length)),m._isValid}function normalizeLanguage(key){return key?key.toLowerCase().replace("_","-"):key}function loadLang(key,values){return values.abbr=key,languages[key]||(languages[key]=new Language),languages[key].set(values),languages[key]}function unloadLang(key){delete languages[key]}function getLangDefinition(key){var j,lang,next,split,i=0,get=function(k){if(!languages[k]&&hasModule)try{require("./lang/"+k)}catch(e){}return languages[k]};if(!key)return moment.fn._lang;if(!isArray(key)){if(lang=get(key))return lang;key=[key]}for(;i<key.length;){for(split=normalizeLanguage(key[i]).split("-"),j=split.length,next=normalizeLanguage(key[i+1]),next=next?next.split("-"):null;j>0;){if(lang=get(split.slice(0,j).join("-")))return lang;if(next&&next.length>=j&&compareArrays(split,next,!0)>=j-1)break;j--}i++}return moment.fn._lang}function removeFormattingTokens(input){return input.match(/\[[\s\S]/)?input.replace(/^\[|\]$/g,""):input.replace(/\\/g,"")}function makeFormatFunction(format){var i,length,array=format.match(formattingTokens);for(i=0,length=array.length;length>i;i++)formatTokenFunctions[array[i]]?array[i]=formatTokenFunctions[array[i]]:array[i]=removeFormattingTokens(array[i]);return function(mom){var output="";for(i=0;length>i;i++)output+=array[i]instanceof Function?array[i].call(mom,format):array[i];return output}}function formatMoment(m,format){return m.isValid()?(format=expandFormat(format,m.lang()),formatFunctions[format]||(formatFunctions[format]=makeFormatFunction(format)),formatFunctions[format](m)):m.lang().invalidDate()}function expandFormat(format,lang){function replaceLongDateFormatTokens(input){return lang.longDateFormat(input)||input}var i=5;for(localFormattingTokens.lastIndex=0;i>=0&&localFormattingTokens.test(format);)format=format.replace(localFormattingTokens,replaceLongDateFormatTokens),localFormattingTokens.lastIndex=0,i-=1;return format}function getParseRegexForToken(token,config){var a;switch(token){case"DDDD":return parseTokenThreeDigits;case"YYYY":case"GGGG":case"gggg":return parseTokenFourDigits;case"YYYYY":case"GGGGG":case"ggggg":return parseTokenSixDigits;case"S":case"SS":case"SSS":case"DDD":return parseTokenOneToThreeDigits;case"MMM":case"MMMM":case"dd":case"ddd":case"dddd":return parseTokenWord;case"a":case"A":return getLangDefinition(config._l)._meridiemParse;case"X":return parseTokenTimestampMs;case"Z":case"ZZ":return parseTokenTimezone;case"T":return parseTokenT;case"SSSS":return parseTokenDigits;case"MM":case"DD":case"YY":case"GG":case"gg":case"HH":case"hh":case"mm":case"ss":case"M":case"D":case"d":case"H":case"h":case"m":case"s":case"w":case"ww":case"W":case"WW":case"e":case"E":return parseTokenOneOrTwoDigits;default:return a=new RegExp(regexpEscape(unescapeFormat(token.replace("\\","")),"i"))}}function timezoneMinutesFromString(string){var tzchunk=(parseTokenTimezone.exec(string)||[])[0],parts=(tzchunk+"").match(parseTimezoneChunker)||["-",0,0],minutes=+(60*parts[1])+toInt(parts[2]);return"+"===parts[0]?-minutes:minutes}function addTimeToArrayFromToken(token,input,config){var a,datePartArray=config._a;switch(token){case"M":case"MM":null!=input&&(datePartArray[MONTH]=toInt(input)-1);break;case"MMM":case"MMMM":a=getLangDefinition(config._l).monthsParse(input),null!=a?datePartArray[MONTH]=a:config._pf.invalidMonth=input;break;case"D":case"DD":null!=input&&(datePartArray[DATE]=toInt(input));break;case"DDD":case"DDDD":null!=input&&(config._dayOfYear=toInt(input));break;case"YY":datePartArray[YEAR]=toInt(input)+(toInt(input)>68?1900:2e3);break;case"YYYY":case"YYYYY":datePartArray[YEAR]=toInt(input);break;case"a":case"A":config._isPm=getLangDefinition(config._l).isPM(input);break;case"H":case"HH":case"h":case"hh":datePartArray[HOUR]=toInt(input);break;case"m":case"mm":datePartArray[MINUTE]=toInt(input);break;case"s":case"ss":datePartArray[SECOND]=toInt(input);break;case"S":case"SS":case"SSS":case"SSSS":datePartArray[MILLISECOND]=toInt(1e3*("0."+input));break;case"X":config._d=new Date(1e3*parseFloat(input));break;case"Z":case"ZZ":config._useUTC=!0,config._tzm=timezoneMinutesFromString(input);break;case"w":case"ww":case"W":case"WW":case"d":case"dd":case"ddd":case"dddd":case"e":case"E":token=token.substr(0,1);case"gg":case"gggg":case"GG":case"GGGG":case"GGGGG":token=token.substr(0,2),input&&(config._w=config._w||{},config._w[token]=input)}}function dateFromConfig(config){var i,date,currentDate,yearToUse,fixYear,w,temp,lang,weekday,week,input=[];if(!config._d){for(currentDate=currentDateArray(config),config._w&&null==config._a[DATE]&&null==config._a[MONTH]&&(fixYear=function(val){return val?val.length<3?parseInt(val,10)>68?"19"+val:"20"+val:val:null==config._a[YEAR]?moment().weekYear():config._a[YEAR]},w=config._w,null!=w.GG||null!=w.W||null!=w.E?temp=dayOfYearFromWeeks(fixYear(w.GG),w.W||1,w.E,4,1):(lang=getLangDefinition(config._l),weekday=null!=w.d?parseWeekday(w.d,lang):null!=w.e?parseInt(w.e,10)+lang._week.dow:0,week=parseInt(w.w,10)||1,null!=w.d&&weekday<lang._week.dow&&week++,temp=dayOfYearFromWeeks(fixYear(w.gg),week,weekday,lang._week.doy,lang._week.dow)),config._a[YEAR]=temp.year,config._dayOfYear=temp.dayOfYear),config._dayOfYear&&(yearToUse=null==config._a[YEAR]?currentDate[YEAR]:config._a[YEAR],config._dayOfYear>daysInYear(yearToUse)&&(config._pf._overflowDayOfYear=!0),date=makeUTCDate(yearToUse,0,config._dayOfYear),config._a[MONTH]=date.getUTCMonth(),config._a[DATE]=date.getUTCDate()),i=0;3>i&&null==config._a[i];++i)config._a[i]=input[i]=currentDate[i];for(;7>i;i++)config._a[i]=input[i]=null==config._a[i]?2===i?1:0:config._a[i];input[HOUR]+=toInt((config._tzm||0)/60),input[MINUTE]+=toInt((config._tzm||0)%60),config._d=(config._useUTC?makeUTCDate:makeDate).apply(null,input)}}function dateFromObject(config){var normalizedInput;config._d||(normalizedInput=normalizeObjectUnits(config._i),config._a=[normalizedInput.year,normalizedInput.month,normalizedInput.day,normalizedInput.hour,normalizedInput.minute,normalizedInput.second,normalizedInput.millisecond],dateFromConfig(config))}function currentDateArray(config){var now=new Date;return config._useUTC?[now.getUTCFullYear(),now.getUTCMonth(),now.getUTCDate()]:[now.getFullYear(),now.getMonth(),now.getDate()]}function makeDateFromStringAndFormat(config){config._a=[],config._pf.empty=!0;var i,parsedInput,tokens,token,skipped,lang=getLangDefinition(config._l),string=""+config._i,stringLength=string.length,totalParsedInputLength=0;for(tokens=expandFormat(config._f,lang).match(formattingTokens)||[],i=0;i<tokens.length;i++)token=tokens[i],parsedInput=(getParseRegexForToken(token,config).exec(string)||[])[0],parsedInput&&(skipped=string.substr(0,string.indexOf(parsedInput)),skipped.length>0&&config._pf.unusedInput.push(skipped),string=string.slice(string.indexOf(parsedInput)+parsedInput.length),totalParsedInputLength+=parsedInput.length),formatTokenFunctions[token]?(parsedInput?config._pf.empty=!1:config._pf.unusedTokens.push(token),addTimeToArrayFromToken(token,parsedInput,config)):config._strict&&!parsedInput&&config._pf.unusedTokens.push(token);config._pf.charsLeftOver=stringLength-totalParsedInputLength,string.length>0&&config._pf.unusedInput.push(string),config._isPm&&config._a[HOUR]<12&&(config._a[HOUR]+=12),config._isPm===!1&&12===config._a[HOUR]&&(config._a[HOUR]=0),dateFromConfig(config),checkOverflow(config)}function unescapeFormat(s){return s.replace(/\\(\[)|\\(\])|\[([^\]\[]*)\]|\\(.)/g,function(matched,p1,p2,p3,p4){return p1||p2||p3||p4})}function regexpEscape(s){return s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&")}function makeDateFromStringAndArray(config){var tempConfig,bestMoment,scoreToBeat,i,currentScore;if(0===config._f.length)return config._pf.invalidFormat=!0,void(config._d=new Date(NaN));for(i=0;i<config._f.length;i++)currentScore=0,tempConfig=extend({},config),initializeParsingFlags(tempConfig),tempConfig._f=config._f[i],makeDateFromStringAndFormat(tempConfig),isValid(tempConfig)&&(currentScore+=tempConfig._pf.charsLeftOver,currentScore+=10*tempConfig._pf.unusedTokens.length,tempConfig._pf.score=currentScore,(null==scoreToBeat||scoreToBeat>currentScore)&&(scoreToBeat=currentScore,bestMoment=tempConfig));extend(config,bestMoment||tempConfig)}function makeDateFromString(config){var i,string=config._i,match=isoRegex.exec(string);if(match){for(config._pf.iso=!0,i=4;i>0;i--)if(match[i]){config._f=isoDates[i-1]+(match[6]||" ");break}for(i=0;4>i;i++)if(isoTimes[i][1].exec(string)){config._f+=isoTimes[i][0];break}parseTokenTimezone.exec(string)&&(config._f+="Z"),makeDateFromStringAndFormat(config)}else config._d=new Date(string)}function makeDateFromInput(config){var input=config._i,matched=aspNetJsonRegex.exec(input);input===undefined?config._d=new Date:matched?config._d=new Date(+matched[1]):"string"==typeof input?makeDateFromString(config):isArray(input)?(config._a=input.slice(0),dateFromConfig(config)):isDate(input)?config._d=new Date(+input):"object"==typeof input?dateFromObject(config):config._d=new Date(input)}function makeDate(y,m,d,h,M,s,ms){var date=new Date(y,m,d,h,M,s,ms);return 1970>y&&date.setFullYear(y),date}function makeUTCDate(y){var date=new Date(Date.UTC.apply(null,arguments));return 1970>y&&date.setUTCFullYear(y),date}function parseWeekday(input,language){if("string"==typeof input)if(isNaN(input)){if(input=language.weekdaysParse(input),"number"!=typeof input)return null}else input=parseInt(input,10);return input}function substituteTimeAgo(string,number,withoutSuffix,isFuture,lang){return lang.relativeTime(number||1,!!withoutSuffix,string,isFuture)}function relativeTime(milliseconds,withoutSuffix,lang){var seconds=round(Math.abs(milliseconds)/1e3),minutes=round(seconds/60),hours=round(minutes/60),days=round(hours/24),years=round(days/365),args=45>seconds&&["s",seconds]||1===minutes&&["m"]||45>minutes&&["mm",minutes]||1===hours&&["h"]||22>hours&&["hh",hours]||1===days&&["d"]||25>=days&&["dd",days]||45>=days&&["M"]||345>days&&["MM",round(days/30)]||1===years&&["y"]||["yy",years];return args[2]=withoutSuffix,args[3]=milliseconds>0,args[4]=lang,substituteTimeAgo.apply({},args)}function weekOfYear(mom,firstDayOfWeek,firstDayOfWeekOfYear){var adjustedMoment,end=firstDayOfWeekOfYear-firstDayOfWeek,daysToDayOfWeek=firstDayOfWeekOfYear-mom.day();return daysToDayOfWeek>end&&(daysToDayOfWeek-=7),end-7>daysToDayOfWeek&&(daysToDayOfWeek+=7),adjustedMoment=moment(mom).add("d",daysToDayOfWeek),{week:Math.ceil(adjustedMoment.dayOfYear()/7),year:adjustedMoment.year()}}function dayOfYearFromWeeks(year,week,weekday,firstDayOfWeekOfYear,firstDayOfWeek){var daysToAdd,dayOfYear,d=new Date(Date.UTC(year,0)).getUTCDay();return weekday=null!=weekday?weekday:firstDayOfWeek,daysToAdd=firstDayOfWeek-d+(d>firstDayOfWeekOfYear?7:0),dayOfYear=7*(week-1)+(weekday-firstDayOfWeek)+daysToAdd+1,{year:dayOfYear>0?year:year-1,dayOfYear:dayOfYear>0?dayOfYear:daysInYear(year-1)+dayOfYear}}function makeMoment(config){var input=config._i,format=config._f;return"undefined"==typeof config._pf&&initializeParsingFlags(config),null===input?moment.invalid({nullInput:!0}):("string"==typeof input&&(config._i=input=getLangDefinition().preparse(input)),moment.isMoment(input)?(config=extend({},input),config._d=new Date(+input._d)):format?isArray(format)?makeDateFromStringAndArray(config):makeDateFromStringAndFormat(config):makeDateFromInput(config),new Moment(config))}function makeGetterAndSetter(name,key){moment.fn[name]=moment.fn[name+"s"]=function(input){var utc=this._isUTC?"UTC":"";return null!=input?(this._d["set"+utc+key](input),moment.updateOffset(this),this):this._d["get"+utc+key]()}}function makeDurationGetter(name){moment.duration.fn[name]=function(){return this._data[name]}}function makeDurationAsGetter(name,factor){moment.duration.fn["as"+name]=function(){return+this/factor}}function makeGlobal(deprecate){var warned=!1,local_moment=moment;"undefined"==typeof ender&&(deprecate?this.moment=function(){return!warned&&console&&console.warn&&(warned=!0,console.warn("Accessing Moment through the global scope is deprecated, and will be removed in an upcoming release.")),local_moment.apply(null,arguments)}:this.moment=moment)}for(var moment,i,VERSION="2.4.0",round=Math.round,YEAR=0,MONTH=1,DATE=2,HOUR=3,MINUTE=4,SECOND=5,MILLISECOND=6,languages={},hasModule="undefined"!=typeof module&&module.exports,aspNetJsonRegex=/^\/?Date\((\-?\d+)/i,aspNetTimeSpanJsonRegex=/(\-)?(?:(\d*)\.)?(\d+)\:(\d+)(?:\:(\d+)\.?(\d{3})?)?/,isoDurationRegex=/^(-)?P(?:(?:([0-9,.]*)Y)?(?:([0-9,.]*)M)?(?:([0-9,.]*)D)?(?:T(?:([0-9,.]*)H)?(?:([0-9,.]*)M)?(?:([0-9,.]*)S)?)?|([0-9,.]*)W)$/,formattingTokens=/(\[[^\[]*\])|(\\)?(Mo|MM?M?M?|Do|DDDo|DD?D?D?|ddd?d?|do?|w[o|w]?|W[o|W]?|YYYYY|YYYY|YY|gg(ggg?)?|GG(GGG?)?|e|E|a|A|hh?|HH?|mm?|ss?|S{1,4}|X|zz?|ZZ?|.)/g,localFormattingTokens=/(\[[^\[]*\])|(\\)?(LT|LL?L?L?|l{1,4})/g,parseTokenOneOrTwoDigits=/\d\d?/,parseTokenOneToThreeDigits=/\d{1,3}/,parseTokenThreeDigits=/\d{3}/,parseTokenFourDigits=/\d{1,4}/,parseTokenSixDigits=/[+\-]?\d{1,6}/,parseTokenDigits=/\d+/,parseTokenWord=/[0-9]*['a-z\u00A0-\u05FF\u0700-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]+|[\u0600-\u06FF\/]+(\s*?[\u0600-\u06FF]+){1,2}/i,parseTokenTimezone=/Z|[\+\-]\d\d:?\d\d/i,parseTokenT=/T/i,parseTokenTimestampMs=/[\+\-]?\d+(\.\d{1,3})?/,isoRegex=/^\s*\d{4}-(?:(\d\d-\d\d)|(W\d\d$)|(W\d\d-\d)|(\d\d\d))((T| )(\d\d(:\d\d(:\d\d(\.\d+)?)?)?)?([\+\-]\d\d:?\d\d|Z)?)?$/,isoFormat="YYYY-MM-DDTHH:mm:ssZ",isoDates=["YYYY-MM-DD","GGGG-[W]WW","GGGG-[W]WW-E","YYYY-DDD"],isoTimes=[["HH:mm:ss.SSSS",/(T| )\d\d:\d\d:\d\d\.\d{1,3}/],["HH:mm:ss",/(T| )\d\d:\d\d:\d\d/],["HH:mm",/(T| )\d\d:\d\d/],["HH",/(T| )\d\d/]],parseTimezoneChunker=/([\+\-]|\d\d)/gi,proxyGettersAndSetters="Date|Hours|Minutes|Seconds|Milliseconds".split("|"),unitMillisecondFactors={Milliseconds:1,Seconds:1e3,Minutes:6e4,Hours:36e5,Days:864e5,Months:2592e6,Years:31536e6},unitAliases={ms:"millisecond",s:"second",m:"minute",h:"hour",d:"day",D:"date",w:"week",W:"isoWeek",M:"month",y:"year",DDD:"dayOfYear",e:"weekday",E:"isoWeekday",gg:"weekYear",GG:"isoWeekYear"},camelFunctions={dayofyear:"dayOfYear",isoweekday:"isoWeekday",isoweek:"isoWeek",weekyear:"weekYear",isoweekyear:"isoWeekYear"},formatFunctions={},ordinalizeTokens="DDD w W M D d".split(" "),paddedTokens="M D H h m s w W".split(" "),formatTokenFunctions={M:function(){return this.month()+1},MMM:function(format){return this.lang().monthsShort(this,format)},MMMM:function(format){return this.lang().months(this,format)},D:function(){return this.date()},DDD:function(){return this.dayOfYear()},d:function(){return this.day()},dd:function(format){return this.lang().weekdaysMin(this,format)},ddd:function(format){return this.lang().weekdaysShort(this,format)},dddd:function(format){return this.lang().weekdays(this,format)},w:function(){return this.week()},W:function(){return this.isoWeek()},YY:function(){return leftZeroFill(this.year()%100,2)},YYYY:function(){return leftZeroFill(this.year(),4)},YYYYY:function(){return leftZeroFill(this.year(),5)},gg:function(){return leftZeroFill(this.weekYear()%100,2)},gggg:function(){return this.weekYear()},ggggg:function(){return leftZeroFill(this.weekYear(),5)},GG:function(){return leftZeroFill(this.isoWeekYear()%100,2)},GGGG:function(){return this.isoWeekYear()},GGGGG:function(){return leftZeroFill(this.isoWeekYear(),5)},e:function(){return this.weekday()},E:function(){return this.isoWeekday()},a:function(){return this.lang().meridiem(this.hours(),this.minutes(),!0)},A:function(){return this.lang().meridiem(this.hours(),this.minutes(),!1)},H:function(){return this.hours()},h:function(){return this.hours()%12||12},m:function(){return this.minutes()},s:function(){return this.seconds()},S:function(){return toInt(this.milliseconds()/100)},SS:function(){return leftZeroFill(toInt(this.milliseconds()/10),2)},SSS:function(){return leftZeroFill(this.milliseconds(),3)},SSSS:function(){return leftZeroFill(this.milliseconds(),3)},Z:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+leftZeroFill(toInt(a/60),2)+":"+leftZeroFill(toInt(a)%60,2)},ZZ:function(){var a=-this.zone(),b="+";return 0>a&&(a=-a,b="-"),b+leftZeroFill(toInt(10*a/6),4)},z:function(){return this.zoneAbbr()},zz:function(){return this.zoneName()},X:function(){return this.unix()}},lists=["months","monthsShort","weekdays","weekdaysShort","weekdaysMin"];ordinalizeTokens.length;)i=ordinalizeTokens.pop(),formatTokenFunctions[i+"o"]=ordinalizeToken(formatTokenFunctions[i],i);for(;paddedTokens.length;)i=paddedTokens.pop(),formatTokenFunctions[i+i]=padToken(formatTokenFunctions[i],2);for(formatTokenFunctions.DDDD=padToken(formatTokenFunctions.DDD,3),extend(Language.prototype,{set:function(config){var prop,i;for(i in config)prop=config[i],"function"==typeof prop?this[i]=prop:this["_"+i]=prop},_months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),months:function(m){return this._months[m.month()]},_monthsShort:"Jan_Feb_Mar_Apr_May_Jun_Jul_Aug_Sep_Oct_Nov_Dec".split("_"),monthsShort:function(m){return this._monthsShort[m.month()]},monthsParse:function(monthName){var i,mom,regex;for(this._monthsParse||(this._monthsParse=[]),i=0;12>i;i++)if(this._monthsParse[i]||(mom=moment.utc([2e3,i]),regex="^"+this.months(mom,"")+"|^"+this.monthsShort(mom,""),this._monthsParse[i]=new RegExp(regex.replace(".",""),"i")),this._monthsParse[i].test(monthName))return i},_weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),weekdays:function(m){return this._weekdays[m.day()]},_weekdaysShort:"Sun_Mon_Tue_Wed_Thu_Fri_Sat".split("_"),weekdaysShort:function(m){return this._weekdaysShort[m.day()]},_weekdaysMin:"Su_Mo_Tu_We_Th_Fr_Sa".split("_"),weekdaysMin:function(m){return this._weekdaysMin[m.day()]},weekdaysParse:function(weekdayName){var i,mom,regex;for(this._weekdaysParse||(this._weekdaysParse=[]),i=0;7>i;i++)if(this._weekdaysParse[i]||(mom=moment([2e3,1]).day(i),regex="^"+this.weekdays(mom,"")+"|^"+this.weekdaysShort(mom,"")+"|^"+this.weekdaysMin(mom,""),this._weekdaysParse[i]=new RegExp(regex.replace(".",""),"i")),this._weekdaysParse[i].test(weekdayName))return i},_longDateFormat:{LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D YYYY",LLL:"MMMM D YYYY LT",LLLL:"dddd, MMMM D YYYY LT"},longDateFormat:function(key){var output=this._longDateFormat[key];return!output&&this._longDateFormat[key.toUpperCase()]&&(output=this._longDateFormat[key.toUpperCase()].replace(/MMMM|MM|DD|dddd/g,function(val){return val.slice(1)}),this._longDateFormat[key]=output),output},isPM:function(input){return"p"===(input+"").toLowerCase().charAt(0)},_meridiemParse:/[ap]\.?m?\.?/i,meridiem:function(hours,minutes,isLower){return hours>11?isLower?"pm":"PM":isLower?"am":"AM"},_calendar:{sameDay:"[Today at] LT",nextDay:"[Tomorrow at] LT",nextWeek:"dddd [at] LT",lastDay:"[Yesterday at] LT",lastWeek:"[Last] dddd [at] LT",sameElse:"L"},calendar:function(key,mom){var output=this._calendar[key];return"function"==typeof output?output.apply(mom):output},_relativeTime:{future:"in %s",past:"%s ago",s:"a few seconds",m:"a minute",mm:"%d minutes",h:"an hour",hh:"%d hours",d:"a day",dd:"%d days",M:"a month",MM:"%d months",y:"a year",yy:"%d years"},relativeTime:function(number,withoutSuffix,string,isFuture){var output=this._relativeTime[string];return"function"==typeof output?output(number,withoutSuffix,string,isFuture):output.replace(/%d/i,number)},pastFuture:function(diff,output){var format=this._relativeTime[diff>0?"future":"past"];return"function"==typeof format?format(output):format.replace(/%s/i,output)},ordinal:function(number){return this._ordinal.replace("%d",number)},_ordinal:"%d",preparse:function(string){return string},postformat:function(string){return string},week:function(mom){return weekOfYear(mom,this._week.dow,this._week.doy).week},_week:{dow:0,doy:6},_invalidDate:"Invalid date",invalidDate:function(){return this._invalidDate}}),moment=function(input,format,lang,strict){return"boolean"==typeof lang&&(strict=lang,lang=undefined),makeMoment({_i:input,_f:format,_l:lang,_strict:strict,_isUTC:!1})},moment.utc=function(input,format,lang,strict){var m;return"boolean"==typeof lang&&(strict=lang,lang=undefined),m=makeMoment({_useUTC:!0,_isUTC:!0,_l:lang,_i:input,_f:format,_strict:strict}).utc()},moment.unix=function(input){return moment(1e3*input)},moment.duration=function(input,key){var sign,ret,parseIso,isDuration=moment.isDuration(input),isNumber="number"==typeof input,duration=isDuration?input._input:isNumber?{}:input,match=null;return isNumber?key?duration[key]=input:duration.milliseconds=input:(match=aspNetTimeSpanJsonRegex.exec(input))?(sign="-"===match[1]?-1:1,duration={y:0,d:toInt(match[DATE])*sign,h:toInt(match[HOUR])*sign,m:toInt(match[MINUTE])*sign,s:toInt(match[SECOND])*sign,ms:toInt(match[MILLISECOND])*sign}):(match=isoDurationRegex.exec(input))&&(sign="-"===match[1]?-1:1,parseIso=function(inp){var res=inp&&parseFloat(inp.replace(",","."));return(isNaN(res)?0:res)*sign},duration={y:parseIso(match[2]),M:parseIso(match[3]),d:parseIso(match[4]),h:parseIso(match[5]),m:parseIso(match[6]),s:parseIso(match[7]),w:parseIso(match[8])}),ret=new Duration(duration),isDuration&&input.hasOwnProperty("_lang")&&(ret._lang=input._lang),ret},moment.version=VERSION,moment.defaultFormat=isoFormat,moment.updateOffset=function(){},moment.lang=function(key,values){var r;return key?(values?loadLang(normalizeLanguage(key),values):null===values?(unloadLang(key),key="en"):languages[key]||getLangDefinition(key),r=moment.duration.fn._lang=moment.fn._lang=getLangDefinition(key),r._abbr):moment.fn._lang._abbr},moment.langData=function(key){return key&&key._lang&&key._lang._abbr&&(key=key._lang._abbr),getLangDefinition(key)},moment.isMoment=function(obj){return obj instanceof Moment},moment.isDuration=function(obj){return obj instanceof Duration},i=lists.length-1;i>=0;--i)makeList(lists[i]);for(moment.normalizeUnits=function(units){return normalizeUnits(units)},moment.invalid=function(flags){var m=moment.utc(NaN);return null!=flags?extend(m._pf,flags):m._pf.userInvalidated=!0,m},moment.parseZone=function(input){return moment(input).parseZone()},extend(moment.fn=Moment.prototype,{clone:function(){return moment(this)},valueOf:function(){return+this._d+6e4*(this._offset||0)},unix:function(){return Math.floor(+this/1e3)},toString:function(){return this.clone().lang("en").format("ddd MMM DD YYYY HH:mm:ss [GMT]ZZ")},toDate:function(){return this._offset?new Date(+this):this._d},toISOString:function(){return formatMoment(moment(this).utc(),"YYYY-MM-DD[T]HH:mm:ss.SSS[Z]")},toArray:function(){var m=this;return[m.year(),m.month(),m.date(),m.hours(),m.minutes(),m.seconds(),m.milliseconds()]},isValid:function(){return isValid(this)},isDSTShifted:function(){return this._a?this.isValid()&&compareArrays(this._a,(this._isUTC?moment.utc(this._a):moment(this._a)).toArray())>0:!1},parsingFlags:function(){return extend({},this._pf)},invalidAt:function(){return this._pf.overflow},utc:function(){return this.zone(0)},local:function(){return this.zone(0),this._isUTC=!1,this},format:function(inputString){var output=formatMoment(this,inputString||moment.defaultFormat);return this.lang().postformat(output)},add:function(input,val){var dur;return dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val),addOrSubtractDurationFromMoment(this,dur,1),this},subtract:function(input,val){var dur;return dur="string"==typeof input?moment.duration(+val,input):moment.duration(input,val),addOrSubtractDurationFromMoment(this,dur,-1),this},diff:function(input,units,asFloat){var diff,output,that=this._isUTC?moment(input).zone(this._offset||0):moment(input).local(),zoneDiff=6e4*(this.zone()-that.zone());return units=normalizeUnits(units),"year"===units||"month"===units?(diff=432e5*(this.daysInMonth()+that.daysInMonth()),output=12*(this.year()-that.year())+(this.month()-that.month()),output+=(this-moment(this).startOf("month")-(that-moment(that).startOf("month")))/diff,output-=6e4*(this.zone()-moment(this).startOf("month").zone()-(that.zone()-moment(that).startOf("month").zone()))/diff,"year"===units&&(output/=12)):(diff=this-that,output="second"===units?diff/1e3:"minute"===units?diff/6e4:"hour"===units?diff/36e5:"day"===units?(diff-zoneDiff)/864e5:"week"===units?(diff-zoneDiff)/6048e5:diff),asFloat?output:absRound(output)},from:function(time,withoutSuffix){return moment.duration(this.diff(time)).lang(this.lang()._abbr).humanize(!withoutSuffix)},fromNow:function(withoutSuffix){return this.from(moment(),withoutSuffix)},calendar:function(){var diff=this.diff(moment().zone(this.zone()).startOf("day"),"days",!0),format=-6>diff?"sameElse":-1>diff?"lastWeek":0>diff?"lastDay":1>diff?"sameDay":2>diff?"nextDay":7>diff?"nextWeek":"sameElse";return this.format(this.lang().calendar(format,this))},isLeapYear:function(){return isLeapYear(this.year())},isDST:function(){return this.zone()<this.clone().month(0).zone()||this.zone()<this.clone().month(5).zone()},day:function(input){var day=this._isUTC?this._d.getUTCDay():this._d.getDay();return null!=input?(input=parseWeekday(input,this.lang()),this.add({d:input-day})):day},month:function(input){var dayOfMonth,utc=this._isUTC?"UTC":"";return null!=input?"string"==typeof input&&(input=this.lang().monthsParse(input),"number"!=typeof input)?this:(dayOfMonth=this.date(),this.date(1),this._d["set"+utc+"Month"](input),this.date(Math.min(dayOfMonth,this.daysInMonth())),moment.updateOffset(this),this):this._d["get"+utc+"Month"]()},startOf:function(units){switch(units=normalizeUnits(units)){case"year":this.month(0);case"month":this.date(1);case"week":case"isoWeek":case"day":this.hours(0);case"hour":this.minutes(0);case"minute":this.seconds(0);case"second":this.milliseconds(0)}return"week"===units?this.weekday(0):"isoWeek"===units&&this.isoWeekday(1),this},endOf:function(units){return units=normalizeUnits(units),this.startOf(units).add("isoWeek"===units?"week":units,1).subtract("ms",1)},isAfter:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)>+moment(input).startOf(units)},isBefore:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)<+moment(input).startOf(units)},isSame:function(input,units){return units="undefined"!=typeof units?units:"millisecond",+this.clone().startOf(units)===+moment(input).startOf(units)},min:function(other){return other=moment.apply(null,arguments),this>other?this:other},max:function(other){return other=moment.apply(null,arguments),other>this?this:other},zone:function(input){var offset=this._offset||0;return null==input?this._isUTC?offset:this._d.getTimezoneOffset():("string"==typeof input&&(input=timezoneMinutesFromString(input)),Math.abs(input)<16&&(input=60*input),this._offset=input,this._isUTC=!0,offset!==input&&addOrSubtractDurationFromMoment(this,moment.duration(offset-input,"m"),1,!0),this)},zoneAbbr:function(){return this._isUTC?"UTC":""},zoneName:function(){return this._isUTC?"Coordinated Universal Time":""},parseZone:function(){return"string"==typeof this._i&&this.zone(this._i),this},hasAlignedHourOffset:function(input){return input=input?moment(input).zone():0,(this.zone()-input)%60===0},daysInMonth:function(){return daysInMonth(this.year(),this.month())},dayOfYear:function(input){var dayOfYear=round((moment(this).startOf("day")-moment(this).startOf("year"))/864e5)+1;return null==input?dayOfYear:this.add("d",input-dayOfYear)},weekYear:function(input){var year=weekOfYear(this,this.lang()._week.dow,this.lang()._week.doy).year;return null==input?year:this.add("y",input-year)},isoWeekYear:function(input){var year=weekOfYear(this,1,4).year;return null==input?year:this.add("y",input-year)},week:function(input){var week=this.lang().week(this);return null==input?week:this.add("d",7*(input-week))},isoWeek:function(input){var week=weekOfYear(this,1,4).week;return null==input?week:this.add("d",7*(input-week))},weekday:function(input){var weekday=(this.day()+7-this.lang()._week.dow)%7;return null==input?weekday:this.add("d",input-weekday)},isoWeekday:function(input){return null==input?this.day()||7:this.day(this.day()%7?input:input-7)},get:function(units){return units=normalizeUnits(units),this[units]()},set:function(units,value){return units=normalizeUnits(units),"function"==typeof this[units]&&this[units](value),
this},lang:function(key){return key===undefined?this._lang:(this._lang=getLangDefinition(key),this)}}),i=0;i<proxyGettersAndSetters.length;i++)makeGetterAndSetter(proxyGettersAndSetters[i].toLowerCase().replace(/s$/,""),proxyGettersAndSetters[i]);makeGetterAndSetter("year","FullYear"),moment.fn.days=moment.fn.day,moment.fn.months=moment.fn.month,moment.fn.weeks=moment.fn.week,moment.fn.isoWeeks=moment.fn.isoWeek,moment.fn.toJSON=moment.fn.toISOString,extend(moment.duration.fn=Duration.prototype,{_bubble:function(){var seconds,minutes,hours,years,milliseconds=this._milliseconds,days=this._days,months=this._months,data=this._data;data.milliseconds=milliseconds%1e3,seconds=absRound(milliseconds/1e3),data.seconds=seconds%60,minutes=absRound(seconds/60),data.minutes=minutes%60,hours=absRound(minutes/60),data.hours=hours%24,days+=absRound(hours/24),data.days=days%30,months+=absRound(days/30),data.months=months%12,years=absRound(months/12),data.years=years},weeks:function(){return absRound(this.days()/7)},valueOf:function(){return this._milliseconds+864e5*this._days+this._months%12*2592e6+31536e6*toInt(this._months/12)},humanize:function(withSuffix){var difference=+this,output=relativeTime(difference,!withSuffix,this.lang());return withSuffix&&(output=this.lang().pastFuture(difference,output)),this.lang().postformat(output)},add:function(input,val){var dur=moment.duration(input,val);return this._milliseconds+=dur._milliseconds,this._days+=dur._days,this._months+=dur._months,this._bubble(),this},subtract:function(input,val){var dur=moment.duration(input,val);return this._milliseconds-=dur._milliseconds,this._days-=dur._days,this._months-=dur._months,this._bubble(),this},get:function(units){return units=normalizeUnits(units),this[units.toLowerCase()+"s"]()},as:function(units){return units=normalizeUnits(units),this["as"+units.charAt(0).toUpperCase()+units.slice(1)+"s"]()},lang:moment.fn.lang,toIsoString:function(){var years=Math.abs(this.years()),months=Math.abs(this.months()),days=Math.abs(this.days()),hours=Math.abs(this.hours()),minutes=Math.abs(this.minutes()),seconds=Math.abs(this.seconds()+this.milliseconds()/1e3);return this.asSeconds()?(this.asSeconds()<0?"-":"")+"P"+(years?years+"Y":"")+(months?months+"M":"")+(days?days+"D":"")+(hours||minutes||seconds?"T":"")+(hours?hours+"H":"")+(minutes?minutes+"M":"")+(seconds?seconds+"S":""):"P0D"}});for(i in unitMillisecondFactors)unitMillisecondFactors.hasOwnProperty(i)&&(makeDurationAsGetter(i,unitMillisecondFactors[i]),makeDurationGetter(i.toLowerCase()));makeDurationAsGetter("Weeks",6048e5),moment.duration.fn.asMonths=function(){return(+this-31536e6*this.years())/2592e6+12*this.years()},moment.lang("en",{ordinal:function(number){var b=number%10,output=1===toInt(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th";return number+output}}),hasModule?(module.exports=moment,makeGlobal(!0)):"function"==typeof define&&define.amd?define("moment",function(require,exports,module){return module.config().noGlobal!==!0&&makeGlobal(module.config().noGlobal===undefined),moment}):makeGlobal()}.call(this),"undefined"==typeof jQuery)throw new Error("Bootstrap's JavaScript requires jQuery");+function($){"use strict";var version=$.fn.jquery.split(" ")[0].split(".");if(version[0]<2&&version[1]<9||1==version[0]&&9==version[1]&&version[2]<1)throw new Error("Bootstrap's JavaScript requires jQuery version 1.9.1 or higher")}(jQuery),/* ========================================================================
 * Bootstrap: transition.js v3.3.5
 * http://getbootstrap.com/javascript/#transitions
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function transitionEnd(){var el=document.createElement("bootstrap"),transEndEventNames={WebkitTransition:"webkitTransitionEnd",MozTransition:"transitionend",OTransition:"oTransitionEnd otransitionend",transition:"transitionend"};for(var name in transEndEventNames)if(void 0!==el.style[name])return{end:transEndEventNames[name]};return!1}$.fn.emulateTransitionEnd=function(duration){var called=!1,$el=this;$(this).one("bsTransitionEnd",function(){called=!0});var callback=function(){called||$($el).trigger($.support.transition.end)};return setTimeout(callback,duration),this},$(function(){$.support.transition=transitionEnd(),$.support.transition&&($.event.special.bsTransitionEnd={bindType:$.support.transition.end,delegateType:$.support.transition.end,handle:function(e){return $(e.target).is(this)?e.handleObj.handler.apply(this,arguments):void 0}})})}(jQuery),/* ========================================================================
 * Bootstrap: alert.js v3.3.5
 * http://getbootstrap.com/javascript/#alerts
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.alert");data||$this.data("bs.alert",data=new Alert(this)),"string"==typeof option&&data[option].call($this)})}var dismiss='[data-dismiss="alert"]',Alert=function(el){$(el).on("click",dismiss,this.close)};Alert.VERSION="3.3.5",Alert.TRANSITION_DURATION=150,Alert.prototype.close=function(e){function removeElement(){$parent.detach().trigger("closed.bs.alert").remove()}var $this=$(this),selector=$this.attr("data-target");selector||(selector=$this.attr("href"),selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,""));var $parent=$(selector);e&&e.preventDefault(),$parent.length||($parent=$this.closest(".alert")),$parent.trigger(e=$.Event("close.bs.alert")),e.isDefaultPrevented()||($parent.removeClass("in"),$.support.transition&&$parent.hasClass("fade")?$parent.one("bsTransitionEnd",removeElement).emulateTransitionEnd(Alert.TRANSITION_DURATION):removeElement())};var old=$.fn.alert;$.fn.alert=Plugin,$.fn.alert.Constructor=Alert,$.fn.alert.noConflict=function(){return $.fn.alert=old,this},$(document).on("click.bs.alert.data-api",dismiss,Alert.prototype.close)}(jQuery),/* ========================================================================
 * Bootstrap: button.js v3.3.5
 * http://getbootstrap.com/javascript/#buttons
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.button"),options="object"==typeof option&&option;data||$this.data("bs.button",data=new Button(this,options)),"toggle"==option?data.toggle():option&&data.setState(option)})}var Button=function(element,options){this.$element=$(element),this.options=$.extend({},Button.DEFAULTS,options),this.isLoading=!1};Button.VERSION="3.3.5",Button.DEFAULTS={loadingText:"loading..."},Button.prototype.setState=function(state){var d="disabled",$el=this.$element,val=$el.is("input")?"val":"html",data=$el.data();state+="Text",null==data.resetText&&$el.data("resetText",$el[val]()),setTimeout($.proxy(function(){$el[val](null==data[state]?this.options[state]:data[state]),"loadingText"==state?(this.isLoading=!0,$el.addClass(d).attr(d,d)):this.isLoading&&(this.isLoading=!1,$el.removeClass(d).removeAttr(d))},this),0)},Button.prototype.toggle=function(){var changed=!0,$parent=this.$element.closest('[data-toggle="buttons"]');if($parent.length){var $input=this.$element.find("input");"radio"==$input.prop("type")?($input.prop("checked")&&(changed=!1),$parent.find(".active").removeClass("active"),this.$element.addClass("active")):"checkbox"==$input.prop("type")&&($input.prop("checked")!==this.$element.hasClass("active")&&(changed=!1),this.$element.toggleClass("active")),$input.prop("checked",this.$element.hasClass("active")),changed&&$input.trigger("change")}else this.$element.attr("aria-pressed",!this.$element.hasClass("active")),this.$element.toggleClass("active")};var old=$.fn.button;$.fn.button=Plugin,$.fn.button.Constructor=Button,$.fn.button.noConflict=function(){return $.fn.button=old,this},$(document).on("click.bs.button.data-api",'[data-toggle^="button"]',function(e){var $btn=$(e.target);$btn.hasClass("btn")||($btn=$btn.closest(".btn")),Plugin.call($btn,"toggle"),$(e.target).is('input[type="radio"]')||$(e.target).is('input[type="checkbox"]')||e.preventDefault()}).on("focus.bs.button.data-api blur.bs.button.data-api",'[data-toggle^="button"]',function(e){$(e.target).closest(".btn").toggleClass("focus",/^focus(in)?$/.test(e.type))})}(jQuery),/* ========================================================================
 * Bootstrap: carousel.js v3.3.5
 * http://getbootstrap.com/javascript/#carousel
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.carousel"),options=$.extend({},Carousel.DEFAULTS,$this.data(),"object"==typeof option&&option),action="string"==typeof option?option:options.slide;data||$this.data("bs.carousel",data=new Carousel(this,options)),"number"==typeof option?data.to(option):action?data[action]():options.interval&&data.pause().cycle()})}var Carousel=function(element,options){this.$element=$(element),this.$indicators=this.$element.find(".carousel-indicators"),this.options=options,this.paused=null,this.sliding=null,this.interval=null,this.$active=null,this.$items=null,this.options.keyboard&&this.$element.on("keydown.bs.carousel",$.proxy(this.keydown,this)),"hover"==this.options.pause&&!("ontouchstart"in document.documentElement)&&this.$element.on("mouseenter.bs.carousel",$.proxy(this.pause,this)).on("mouseleave.bs.carousel",$.proxy(this.cycle,this))};Carousel.VERSION="3.3.5",Carousel.TRANSITION_DURATION=600,Carousel.DEFAULTS={interval:5e3,pause:"hover",wrap:!0,keyboard:!0},Carousel.prototype.keydown=function(e){if(!/input|textarea/i.test(e.target.tagName)){switch(e.which){case 37:this.prev();break;case 39:this.next();break;default:return}e.preventDefault()}},Carousel.prototype.cycle=function(e){return e||(this.paused=!1),this.interval&&clearInterval(this.interval),this.options.interval&&!this.paused&&(this.interval=setInterval($.proxy(this.next,this),this.options.interval)),this},Carousel.prototype.getItemIndex=function(item){return this.$items=item.parent().children(".item"),this.$items.index(item||this.$active)},Carousel.prototype.getItemForDirection=function(direction,active){var activeIndex=this.getItemIndex(active),willWrap="prev"==direction&&0===activeIndex||"next"==direction&&activeIndex==this.$items.length-1;if(willWrap&&!this.options.wrap)return active;var delta="prev"==direction?-1:1,itemIndex=(activeIndex+delta)%this.$items.length;return this.$items.eq(itemIndex)},Carousel.prototype.to=function(pos){var that=this,activeIndex=this.getItemIndex(this.$active=this.$element.find(".item.active"));return pos>this.$items.length-1||0>pos?void 0:this.sliding?this.$element.one("slid.bs.carousel",function(){that.to(pos)}):activeIndex==pos?this.pause().cycle():this.slide(pos>activeIndex?"next":"prev",this.$items.eq(pos))},Carousel.prototype.pause=function(e){return e||(this.paused=!0),this.$element.find(".next, .prev").length&&$.support.transition&&(this.$element.trigger($.support.transition.end),this.cycle(!0)),this.interval=clearInterval(this.interval),this},Carousel.prototype.next=function(){return this.sliding?void 0:this.slide("next")},Carousel.prototype.prev=function(){return this.sliding?void 0:this.slide("prev")},Carousel.prototype.slide=function(type,next){var $active=this.$element.find(".item.active"),$next=next||this.getItemForDirection(type,$active),isCycling=this.interval,direction="next"==type?"left":"right",that=this;if($next.hasClass("active"))return this.sliding=!1;var relatedTarget=$next[0],slideEvent=$.Event("slide.bs.carousel",{relatedTarget:relatedTarget,direction:direction});if(this.$element.trigger(slideEvent),!slideEvent.isDefaultPrevented()){if(this.sliding=!0,isCycling&&this.pause(),this.$indicators.length){this.$indicators.find(".active").removeClass("active");var $nextIndicator=$(this.$indicators.children()[this.getItemIndex($next)]);$nextIndicator&&$nextIndicator.addClass("active")}var slidEvent=$.Event("slid.bs.carousel",{relatedTarget:relatedTarget,direction:direction});return $.support.transition&&this.$element.hasClass("slide")?($next.addClass(type),$next[0].offsetWidth,$active.addClass(direction),$next.addClass(direction),$active.one("bsTransitionEnd",function(){$next.removeClass([type,direction].join(" ")).addClass("active"),$active.removeClass(["active",direction].join(" ")),that.sliding=!1,setTimeout(function(){that.$element.trigger(slidEvent)},0)}).emulateTransitionEnd(Carousel.TRANSITION_DURATION)):($active.removeClass("active"),$next.addClass("active"),this.sliding=!1,this.$element.trigger(slidEvent)),isCycling&&this.cycle(),this}};var old=$.fn.carousel;$.fn.carousel=Plugin,$.fn.carousel.Constructor=Carousel,$.fn.carousel.noConflict=function(){return $.fn.carousel=old,this};var clickHandler=function(e){var href,$this=$(this),$target=$($this.attr("data-target")||(href=$this.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,""));if($target.hasClass("carousel")){var options=$.extend({},$target.data(),$this.data()),slideIndex=$this.attr("data-slide-to");slideIndex&&(options.interval=!1),Plugin.call($target,options),slideIndex&&$target.data("bs.carousel").to(slideIndex),e.preventDefault()}};$(document).on("click.bs.carousel.data-api","[data-slide]",clickHandler).on("click.bs.carousel.data-api","[data-slide-to]",clickHandler),$(window).on("load",function(){$('[data-ride="carousel"]').each(function(){var $carousel=$(this);Plugin.call($carousel,$carousel.data())})})}(jQuery),/* ========================================================================
 * Bootstrap: collapse.js v3.3.5
 * http://getbootstrap.com/javascript/#collapse
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function getTargetFromTrigger($trigger){var href,target=$trigger.attr("data-target")||(href=$trigger.attr("href"))&&href.replace(/.*(?=#[^\s]+$)/,"");return $(target)}function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.collapse"),options=$.extend({},Collapse.DEFAULTS,$this.data(),"object"==typeof option&&option);!data&&options.toggle&&/show|hide/.test(option)&&(options.toggle=!1),data||$this.data("bs.collapse",data=new Collapse(this,options)),"string"==typeof option&&data[option]()})}var Collapse=function(element,options){this.$element=$(element),this.options=$.extend({},Collapse.DEFAULTS,options),this.$trigger=$('[data-toggle="collapse"][href="#'+element.id+'"],[data-toggle="collapse"][data-target="#'+element.id+'"]'),this.transitioning=null,this.options.parent?this.$parent=this.getParent():this.addAriaAndCollapsedClass(this.$element,this.$trigger),this.options.toggle&&this.toggle()};Collapse.VERSION="3.3.5",Collapse.TRANSITION_DURATION=350,Collapse.DEFAULTS={toggle:!0},Collapse.prototype.dimension=function(){var hasWidth=this.$element.hasClass("width");return hasWidth?"width":"height"},Collapse.prototype.show=function(){if(!this.transitioning&&!this.$element.hasClass("in")){var activesData,actives=this.$parent&&this.$parent.children(".panel").children(".in, .collapsing");if(!(actives&&actives.length&&(activesData=actives.data("bs.collapse"),activesData&&activesData.transitioning))){var startEvent=$.Event("show.bs.collapse");if(this.$element.trigger(startEvent),!startEvent.isDefaultPrevented()){actives&&actives.length&&(Plugin.call(actives,"hide"),activesData||actives.data("bs.collapse",null));var dimension=this.dimension();this.$element.removeClass("collapse").addClass("collapsing")[dimension](0).attr("aria-expanded",!0),this.$trigger.removeClass("collapsed").attr("aria-expanded",!0),this.transitioning=1;var complete=function(){this.$element.removeClass("collapsing").addClass("collapse in")[dimension](""),this.transitioning=0,this.$element.trigger("shown.bs.collapse")};if(!$.support.transition)return complete.call(this);var scrollSize=$.camelCase(["scroll",dimension].join("-"));this.$element.one("bsTransitionEnd",$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION)[dimension](this.$element[0][scrollSize])}}}},Collapse.prototype.hide=function(){if(!this.transitioning&&this.$element.hasClass("in")){var startEvent=$.Event("hide.bs.collapse");if(this.$element.trigger(startEvent),!startEvent.isDefaultPrevented()){var dimension=this.dimension();this.$element[dimension](this.$element[dimension]())[0].offsetHeight,this.$element.addClass("collapsing").removeClass("collapse in").attr("aria-expanded",!1),this.$trigger.addClass("collapsed").attr("aria-expanded",!1),this.transitioning=1;var complete=function(){this.transitioning=0,this.$element.removeClass("collapsing").addClass("collapse").trigger("hidden.bs.collapse")};return $.support.transition?void this.$element[dimension](0).one("bsTransitionEnd",$.proxy(complete,this)).emulateTransitionEnd(Collapse.TRANSITION_DURATION):complete.call(this)}}},Collapse.prototype.toggle=function(){this[this.$element.hasClass("in")?"hide":"show"]()},Collapse.prototype.getParent=function(){return $(this.options.parent).find('[data-toggle="collapse"][data-parent="'+this.options.parent+'"]').each($.proxy(function(i,element){var $element=$(element);this.addAriaAndCollapsedClass(getTargetFromTrigger($element),$element)},this)).end()},Collapse.prototype.addAriaAndCollapsedClass=function($element,$trigger){var isOpen=$element.hasClass("in");$element.attr("aria-expanded",isOpen),$trigger.toggleClass("collapsed",!isOpen).attr("aria-expanded",isOpen)};var old=$.fn.collapse;$.fn.collapse=Plugin,$.fn.collapse.Constructor=Collapse,$.fn.collapse.noConflict=function(){return $.fn.collapse=old,this},$(document).on("click.bs.collapse.data-api",'[data-toggle="collapse"]',function(e){var $this=$(this);$this.attr("data-target")||e.preventDefault();var $target=getTargetFromTrigger($this),data=$target.data("bs.collapse"),option=data?"toggle":$this.data();Plugin.call($target,option)})}(jQuery),/* ========================================================================
 * Bootstrap: dropdown.js v3.3.5
 * http://getbootstrap.com/javascript/#dropdowns
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function getParent($this){var selector=$this.attr("data-target");selector||(selector=$this.attr("href"),selector=selector&&/#[A-Za-z]/.test(selector)&&selector.replace(/.*(?=#[^\s]*$)/,""));var $parent=selector&&$(selector);return $parent&&$parent.length?$parent:$this.parent()}function clearMenus(e){e&&3===e.which||($(backdrop).remove(),$(toggle).each(function(){var $this=$(this),$parent=getParent($this),relatedTarget={relatedTarget:this};$parent.hasClass("open")&&(e&&"click"==e.type&&/input|textarea/i.test(e.target.tagName)&&$.contains($parent[0],e.target)||($parent.trigger(e=$.Event("hide.bs.dropdown",relatedTarget)),e.isDefaultPrevented()||($this.attr("aria-expanded","false"),$parent.removeClass("open").trigger("hidden.bs.dropdown",relatedTarget))))}))}function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.dropdown");data||$this.data("bs.dropdown",data=new Dropdown(this)),"string"==typeof option&&data[option].call($this)})}var backdrop=".dropdown-backdrop",toggle='[data-toggle="dropdown"]',Dropdown=function(element){$(element).on("click.bs.dropdown",this.toggle)};Dropdown.VERSION="3.3.5",Dropdown.prototype.toggle=function(e){var $this=$(this);if(!$this.is(".disabled, :disabled")){var $parent=getParent($this),isActive=$parent.hasClass("open");if(clearMenus(),!isActive){"ontouchstart"in document.documentElement&&!$parent.closest(".navbar-nav").length&&$(document.createElement("div")).addClass("dropdown-backdrop").insertAfter($(this)).on("click",clearMenus);var relatedTarget={relatedTarget:this};if($parent.trigger(e=$.Event("show.bs.dropdown",relatedTarget)),e.isDefaultPrevented())return;$this.trigger("focus").attr("aria-expanded","true"),$parent.toggleClass("open").trigger("shown.bs.dropdown",relatedTarget)}return!1}},Dropdown.prototype.keydown=function(e){if(/(38|40|27|32)/.test(e.which)&&!/input|textarea/i.test(e.target.tagName)){var $this=$(this);if(e.preventDefault(),e.stopPropagation(),!$this.is(".disabled, :disabled")){var $parent=getParent($this),isActive=$parent.hasClass("open");if(!isActive&&27!=e.which||isActive&&27==e.which)return 27==e.which&&$parent.find(toggle).trigger("focus"),$this.trigger("click");var desc=" li:not(.disabled):visible a",$items=$parent.find(".dropdown-menu"+desc);if($items.length){var index=$items.index(e.target);38==e.which&&index>0&&index--,40==e.which&&index<$items.length-1&&index++,~index||(index=0),$items.eq(index).trigger("focus")}}}};var old=$.fn.dropdown;$.fn.dropdown=Plugin,$.fn.dropdown.Constructor=Dropdown,$.fn.dropdown.noConflict=function(){return $.fn.dropdown=old,this},$(document).on("click.bs.dropdown.data-api",clearMenus).on("click.bs.dropdown.data-api",".dropdown form",function(e){e.stopPropagation()}).on("click.bs.dropdown.data-api",toggle,Dropdown.prototype.toggle).on("keydown.bs.dropdown.data-api",toggle,Dropdown.prototype.keydown).on("keydown.bs.dropdown.data-api",".dropdown-menu",Dropdown.prototype.keydown)}(jQuery),/* ========================================================================
 * Bootstrap: modal.js v3.3.5
 * http://getbootstrap.com/javascript/#modals
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option,_relatedTarget){return this.each(function(){var $this=$(this),data=$this.data("bs.modal"),options=$.extend({},Modal.DEFAULTS,$this.data(),"object"==typeof option&&option);data||$this.data("bs.modal",data=new Modal(this,options)),"string"==typeof option?data[option](_relatedTarget):options.show&&data.show(_relatedTarget)})}var Modal=function(element,options){this.options=options,this.$body=$(document.body),this.$element=$(element),this.$dialog=this.$element.find(".modal-dialog"),this.$backdrop=null,this.isShown=null,this.originalBodyPad=null,this.scrollbarWidth=0,this.ignoreBackdropClick=!1,this.options.remote&&this.$element.find(".modal-content").load(this.options.remote,$.proxy(function(){this.$element.trigger("loaded.bs.modal")},this))};Modal.VERSION="3.3.5",Modal.TRANSITION_DURATION=300,Modal.BACKDROP_TRANSITION_DURATION=150,Modal.DEFAULTS={backdrop:!0,keyboard:!0,show:!0},Modal.prototype.toggle=function(_relatedTarget){return this.isShown?this.hide():this.show(_relatedTarget)},Modal.prototype.show=function(_relatedTarget){var that=this,e=$.Event("show.bs.modal",{relatedTarget:_relatedTarget});this.$element.trigger(e),this.isShown||e.isDefaultPrevented()||(this.isShown=!0,this.checkScrollbar(),this.setScrollbar(),this.$body.addClass("modal-open"),this.escape(),this.resize(),this.$element.on("click.dismiss.bs.modal",'[data-dismiss="modal"]',$.proxy(this.hide,this)),this.$dialog.on("mousedown.dismiss.bs.modal",function(){that.$element.one("mouseup.dismiss.bs.modal",function(e){$(e.target).is(that.$element)&&(that.ignoreBackdropClick=!0)})}),this.backdrop(function(){var transition=$.support.transition&&that.$element.hasClass("fade");that.$element.parent().length||that.$element.appendTo(that.$body),that.$element.show().scrollTop(0),that.adjustDialog(),transition&&that.$element[0].offsetWidth,that.$element.addClass("in"),that.enforceFocus();var e=$.Event("shown.bs.modal",{relatedTarget:_relatedTarget});transition?that.$dialog.one("bsTransitionEnd",function(){that.$element.trigger("focus").trigger(e)}).emulateTransitionEnd(Modal.TRANSITION_DURATION):that.$element.trigger("focus").trigger(e)}))},Modal.prototype.hide=function(e){e&&e.preventDefault(),e=$.Event("hide.bs.modal"),this.$element.trigger(e),this.isShown&&!e.isDefaultPrevented()&&(this.isShown=!1,this.escape(),this.resize(),$(document).off("focusin.bs.modal"),this.$element.removeClass("in").off("click.dismiss.bs.modal").off("mouseup.dismiss.bs.modal"),this.$dialog.off("mousedown.dismiss.bs.modal"),$.support.transition&&this.$element.hasClass("fade")?this.$element.one("bsTransitionEnd",$.proxy(this.hideModal,this)).emulateTransitionEnd(Modal.TRANSITION_DURATION):this.hideModal())},Modal.prototype.enforceFocus=function(){$(document).off("focusin.bs.modal").on("focusin.bs.modal",$.proxy(function(e){this.$element[0]===e.target||this.$element.has(e.target).length||this.$element.trigger("focus")},this))},Modal.prototype.escape=function(){this.isShown&&this.options.keyboard?this.$element.on("keydown.dismiss.bs.modal",$.proxy(function(e){27==e.which&&this.hide()},this)):this.isShown||this.$element.off("keydown.dismiss.bs.modal")},Modal.prototype.resize=function(){this.isShown?$(window).on("resize.bs.modal",$.proxy(this.handleUpdate,this)):$(window).off("resize.bs.modal")},Modal.prototype.hideModal=function(){var that=this;this.$element.hide(),this.backdrop(function(){that.$body.removeClass("modal-open"),that.resetAdjustments(),that.resetScrollbar(),that.$element.trigger("hidden.bs.modal")})},Modal.prototype.removeBackdrop=function(){this.$backdrop&&this.$backdrop.remove(),this.$backdrop=null},Modal.prototype.backdrop=function(callback){var that=this,animate=this.$element.hasClass("fade")?"fade":"";if(this.isShown&&this.options.backdrop){var doAnimate=$.support.transition&&animate;if(this.$backdrop=$(document.createElement("div")).addClass("modal-backdrop "+animate).appendTo(this.$body),this.$element.on("click.dismiss.bs.modal",$.proxy(function(e){return this.ignoreBackdropClick?void(this.ignoreBackdropClick=!1):void(e.target===e.currentTarget&&("static"==this.options.backdrop?this.$element[0].focus():this.hide()))},this)),doAnimate&&this.$backdrop[0].offsetWidth,this.$backdrop.addClass("in"),!callback)return;doAnimate?this.$backdrop.one("bsTransitionEnd",callback).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callback()}else if(!this.isShown&&this.$backdrop){this.$backdrop.removeClass("in");var callbackRemove=function(){that.removeBackdrop(),callback&&callback()};$.support.transition&&this.$element.hasClass("fade")?this.$backdrop.one("bsTransitionEnd",callbackRemove).emulateTransitionEnd(Modal.BACKDROP_TRANSITION_DURATION):callbackRemove()}else callback&&callback()},Modal.prototype.handleUpdate=function(){this.adjustDialog()},Modal.prototype.adjustDialog=function(){var modalIsOverflowing=this.$element[0].scrollHeight>document.documentElement.clientHeight;this.$element.css({paddingLeft:!this.bodyIsOverflowing&&modalIsOverflowing?this.scrollbarWidth:"",paddingRight:this.bodyIsOverflowing&&!modalIsOverflowing?this.scrollbarWidth:""})},Modal.prototype.resetAdjustments=function(){this.$element.css({paddingLeft:"",paddingRight:""})},Modal.prototype.checkScrollbar=function(){var fullWindowWidth=window.innerWidth;if(!fullWindowWidth){var documentElementRect=document.documentElement.getBoundingClientRect();fullWindowWidth=documentElementRect.right-Math.abs(documentElementRect.left)}this.bodyIsOverflowing=document.body.clientWidth<fullWindowWidth,this.scrollbarWidth=this.measureScrollbar()},Modal.prototype.setScrollbar=function(){var bodyPad=parseInt(this.$body.css("padding-right")||0,10);this.originalBodyPad=document.body.style.paddingRight||"",this.bodyIsOverflowing&&this.$body.css("padding-right",bodyPad+this.scrollbarWidth)},Modal.prototype.resetScrollbar=function(){this.$body.css("padding-right",this.originalBodyPad)},Modal.prototype.measureScrollbar=function(){var scrollDiv=document.createElement("div");scrollDiv.className="modal-scrollbar-measure",this.$body.append(scrollDiv);var scrollbarWidth=scrollDiv.offsetWidth-scrollDiv.clientWidth;return this.$body[0].removeChild(scrollDiv),scrollbarWidth};var old=$.fn.modal;$.fn.modal=Plugin,$.fn.modal.Constructor=Modal,$.fn.modal.noConflict=function(){return $.fn.modal=old,this},$(document).on("click.bs.modal.data-api",'[data-toggle="modal"]',function(e){var $this=$(this),href=$this.attr("href"),$target=$($this.attr("data-target")||href&&href.replace(/.*(?=#[^\s]+$)/,"")),option=$target.data("bs.modal")?"toggle":$.extend({remote:!/#/.test(href)&&href},$target.data(),$this.data());$this.is("a")&&e.preventDefault(),$target.one("show.bs.modal",function(showEvent){showEvent.isDefaultPrevented()||$target.one("hidden.bs.modal",function(){$this.is(":visible")&&$this.trigger("focus")})}),Plugin.call($target,option,this)})}(jQuery),/* ========================================================================
 * Bootstrap: tooltip.js v3.3.5
 * http://getbootstrap.com/javascript/#tooltip
 * Inspired by the original jQuery.tipsy by Jason Frame
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.tooltip"),options="object"==typeof option&&option;(data||!/destroy|hide/.test(option))&&(data||$this.data("bs.tooltip",data=new Tooltip(this,options)),"string"==typeof option&&data[option]())})}var Tooltip=function(element,options){this.type=null,this.options=null,this.enabled=null,this.timeout=null,this.hoverState=null,this.$element=null,this.inState=null,this.init("tooltip",element,options)};Tooltip.VERSION="3.3.5",Tooltip.TRANSITION_DURATION=150,Tooltip.DEFAULTS={animation:!0,placement:"top",selector:!1,template:'<div class="tooltip" role="tooltip"><div class="tooltip-arrow"></div><div class="tooltip-inner"></div></div>',trigger:"hover focus",title:"",delay:0,html:!1,container:!1,viewport:{selector:"body",padding:0}},Tooltip.prototype.init=function(type,element,options){if(this.enabled=!0,this.type=type,this.$element=$(element),this.options=this.getOptions(options),this.$viewport=this.options.viewport&&$($.isFunction(this.options.viewport)?this.options.viewport.call(this,this.$element):this.options.viewport.selector||this.options.viewport),this.inState={click:!1,hover:!1,focus:!1},this.$element[0]instanceof document.constructor&&!this.options.selector)throw new Error("`selector` option must be specified when initializing "+this.type+" on the window.document object!");for(var triggers=this.options.trigger.split(" "),i=triggers.length;i--;){var trigger=triggers[i];if("click"==trigger)this.$element.on("click."+this.type,this.options.selector,$.proxy(this.toggle,this));else if("manual"!=trigger){var eventIn="hover"==trigger?"mouseenter":"focusin",eventOut="hover"==trigger?"mouseleave":"focusout";this.$element.on(eventIn+"."+this.type,this.options.selector,$.proxy(this.enter,this)),this.$element.on(eventOut+"."+this.type,this.options.selector,$.proxy(this.leave,this))}}this.options.selector?this._options=$.extend({},this.options,{trigger:"manual",selector:""}):this.fixTitle()},Tooltip.prototype.getDefaults=function(){return Tooltip.DEFAULTS},Tooltip.prototype.getOptions=function(options){return options=$.extend({},this.getDefaults(),this.$element.data(),options),options.delay&&"number"==typeof options.delay&&(options.delay={show:options.delay,hide:options.delay}),options},Tooltip.prototype.getDelegateOptions=function(){var options={},defaults=this.getDefaults();return this._options&&$.each(this._options,function(key,value){defaults[key]!=value&&(options[key]=value)}),options},Tooltip.prototype.enter=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data("bs."+this.type);return self||(self=new this.constructor(obj.currentTarget,this.getDelegateOptions()),$(obj.currentTarget).data("bs."+this.type,self)),obj instanceof $.Event&&(self.inState["focusin"==obj.type?"focus":"hover"]=!0),self.tip().hasClass("in")||"in"==self.hoverState?void(self.hoverState="in"):(clearTimeout(self.timeout),self.hoverState="in",self.options.delay&&self.options.delay.show?void(self.timeout=setTimeout(function(){"in"==self.hoverState&&self.show()},self.options.delay.show)):self.show())},Tooltip.prototype.isInStateTrue=function(){for(var key in this.inState)if(this.inState[key])return!0;return!1},Tooltip.prototype.leave=function(obj){var self=obj instanceof this.constructor?obj:$(obj.currentTarget).data("bs."+this.type);return self||(self=new this.constructor(obj.currentTarget,this.getDelegateOptions()),$(obj.currentTarget).data("bs."+this.type,self)),obj instanceof $.Event&&(self.inState["focusout"==obj.type?"focus":"hover"]=!1),self.isInStateTrue()?void 0:(clearTimeout(self.timeout),self.hoverState="out",self.options.delay&&self.options.delay.hide?void(self.timeout=setTimeout(function(){"out"==self.hoverState&&self.hide()},self.options.delay.hide)):self.hide())},Tooltip.prototype.show=function(){var e=$.Event("show.bs."+this.type);if(this.hasContent()&&this.enabled){this.$element.trigger(e);var inDom=$.contains(this.$element[0].ownerDocument.documentElement,this.$element[0]);if(e.isDefaultPrevented()||!inDom)return;var that=this,$tip=this.tip(),tipId=this.getUID(this.type);this.setContent(),$tip.attr("id",tipId),this.$element.attr("aria-describedby",tipId),this.options.animation&&$tip.addClass("fade");var placement="function"==typeof this.options.placement?this.options.placement.call(this,$tip[0],this.$element[0]):this.options.placement,autoToken=/\s?auto?\s?/i,autoPlace=autoToken.test(placement);autoPlace&&(placement=placement.replace(autoToken,"")||"top"),$tip.detach().css({top:0,left:0,display:"block"}).addClass(placement).data("bs."+this.type,this),this.options.container?$tip.appendTo(this.options.container):$tip.insertAfter(this.$element),this.$element.trigger("inserted.bs."+this.type);var pos=this.getPosition(),actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;if(autoPlace){var orgPlacement=placement,viewportDim=this.getPosition(this.$viewport);placement="bottom"==placement&&pos.bottom+actualHeight>viewportDim.bottom?"top":"top"==placement&&pos.top-actualHeight<viewportDim.top?"bottom":"right"==placement&&pos.right+actualWidth>viewportDim.width?"left":"left"==placement&&pos.left-actualWidth<viewportDim.left?"right":placement,$tip.removeClass(orgPlacement).addClass(placement)}var calculatedOffset=this.getCalculatedOffset(placement,pos,actualWidth,actualHeight);this.applyPlacement(calculatedOffset,placement);var complete=function(){var prevHoverState=that.hoverState;that.$element.trigger("shown.bs."+that.type),that.hoverState=null,"out"==prevHoverState&&that.leave(that)};$.support.transition&&this.$tip.hasClass("fade")?$tip.one("bsTransitionEnd",complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete()}},Tooltip.prototype.applyPlacement=function(offset,placement){var $tip=this.tip(),width=$tip[0].offsetWidth,height=$tip[0].offsetHeight,marginTop=parseInt($tip.css("margin-top"),10),marginLeft=parseInt($tip.css("margin-left"),10);isNaN(marginTop)&&(marginTop=0),isNaN(marginLeft)&&(marginLeft=0),offset.top+=marginTop,offset.left+=marginLeft,$.offset.setOffset($tip[0],$.extend({using:function(props){$tip.css({top:Math.round(props.top),left:Math.round(props.left)})}},offset),0),$tip.addClass("in");var actualWidth=$tip[0].offsetWidth,actualHeight=$tip[0].offsetHeight;"top"==placement&&actualHeight!=height&&(offset.top=offset.top+height-actualHeight);var delta=this.getViewportAdjustedDelta(placement,offset,actualWidth,actualHeight);delta.left?offset.left+=delta.left:offset.top+=delta.top;var isVertical=/top|bottom/.test(placement),arrowDelta=isVertical?2*delta.left-width+actualWidth:2*delta.top-height+actualHeight,arrowOffsetPosition=isVertical?"offsetWidth":"offsetHeight";$tip.offset(offset),this.replaceArrow(arrowDelta,$tip[0][arrowOffsetPosition],isVertical)},Tooltip.prototype.replaceArrow=function(delta,dimension,isVertical){this.arrow().css(isVertical?"left":"top",50*(1-delta/dimension)+"%").css(isVertical?"top":"left","")},Tooltip.prototype.setContent=function(){var $tip=this.tip(),title=this.getTitle();$tip.find(".tooltip-inner")[this.options.html?"html":"text"](title),$tip.removeClass("fade in top bottom left right")},Tooltip.prototype.hide=function(callback){function complete(){"in"!=that.hoverState&&$tip.detach(),that.$element.removeAttr("aria-describedby").trigger("hidden.bs."+that.type),callback&&callback()}var that=this,$tip=$(this.$tip),e=$.Event("hide.bs."+this.type);return this.$element.trigger(e),e.isDefaultPrevented()?void 0:($tip.removeClass("in"),$.support.transition&&$tip.hasClass("fade")?$tip.one("bsTransitionEnd",complete).emulateTransitionEnd(Tooltip.TRANSITION_DURATION):complete(),this.hoverState=null,this)},Tooltip.prototype.fixTitle=function(){var $e=this.$element;($e.attr("title")||"string"!=typeof $e.attr("data-original-title"))&&$e.attr("data-original-title",$e.attr("title")||"").attr("title","")},Tooltip.prototype.hasContent=function(){return this.getTitle()},Tooltip.prototype.getPosition=function($element){$element=$element||this.$element;var el=$element[0],isBody="BODY"==el.tagName,elRect=el.getBoundingClientRect();null==elRect.width&&(elRect=$.extend({},elRect,{width:elRect.right-elRect.left,height:elRect.bottom-elRect.top}));var elOffset=isBody?{top:0,left:0}:$element.offset(),scroll={scroll:isBody?document.documentElement.scrollTop||document.body.scrollTop:$element.scrollTop()},outerDims=isBody?{width:$(window).width(),height:$(window).height()}:null;return $.extend({},elRect,scroll,outerDims,elOffset)},Tooltip.prototype.getCalculatedOffset=function(placement,pos,actualWidth,actualHeight){return"bottom"==placement?{top:pos.top+pos.height,left:pos.left+pos.width/2-actualWidth/2}:"top"==placement?{top:pos.top-actualHeight,left:pos.left+pos.width/2-actualWidth/2}:"left"==placement?{top:pos.top+pos.height/2-actualHeight/2,left:pos.left-actualWidth}:{top:pos.top+pos.height/2-actualHeight/2,left:pos.left+pos.width}},Tooltip.prototype.getViewportAdjustedDelta=function(placement,pos,actualWidth,actualHeight){var delta={top:0,left:0};if(!this.$viewport)return delta;var viewportPadding=this.options.viewport&&this.options.viewport.padding||0,viewportDimensions=this.getPosition(this.$viewport);if(/right|left/.test(placement)){var topEdgeOffset=pos.top-viewportPadding-viewportDimensions.scroll,bottomEdgeOffset=pos.top+viewportPadding-viewportDimensions.scroll+actualHeight;topEdgeOffset<viewportDimensions.top?delta.top=viewportDimensions.top-topEdgeOffset:bottomEdgeOffset>viewportDimensions.top+viewportDimensions.height&&(delta.top=viewportDimensions.top+viewportDimensions.height-bottomEdgeOffset)}else{var leftEdgeOffset=pos.left-viewportPadding,rightEdgeOffset=pos.left+viewportPadding+actualWidth;leftEdgeOffset<viewportDimensions.left?delta.left=viewportDimensions.left-leftEdgeOffset:rightEdgeOffset>viewportDimensions.right&&(delta.left=viewportDimensions.left+viewportDimensions.width-rightEdgeOffset)}return delta},Tooltip.prototype.getTitle=function(){var title,$e=this.$element,o=this.options;return title=$e.attr("data-original-title")||("function"==typeof o.title?o.title.call($e[0]):o.title)},Tooltip.prototype.getUID=function(prefix){do prefix+=~~(1e6*Math.random());while(document.getElementById(prefix));return prefix},Tooltip.prototype.tip=function(){if(!this.$tip&&(this.$tip=$(this.options.template),1!=this.$tip.length))throw new Error(this.type+" `template` option must consist of exactly 1 top-level element!");return this.$tip},Tooltip.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".tooltip-arrow")},Tooltip.prototype.enable=function(){this.enabled=!0},Tooltip.prototype.disable=function(){this.enabled=!1},Tooltip.prototype.toggleEnabled=function(){this.enabled=!this.enabled},Tooltip.prototype.toggle=function(e){var self=this;e&&(self=$(e.currentTarget).data("bs."+this.type),self||(self=new this.constructor(e.currentTarget,this.getDelegateOptions()),$(e.currentTarget).data("bs."+this.type,self))),e?(self.inState.click=!self.inState.click,self.isInStateTrue()?self.enter(self):self.leave(self)):self.tip().hasClass("in")?self.leave(self):self.enter(self)},Tooltip.prototype.destroy=function(){var that=this;clearTimeout(this.timeout),this.hide(function(){that.$element.off("."+that.type).removeData("bs."+that.type),that.$tip&&that.$tip.detach(),that.$tip=null,that.$arrow=null,that.$viewport=null})};var old=$.fn.tooltip;$.fn.tooltip=Plugin,$.fn.tooltip.Constructor=Tooltip,$.fn.tooltip.noConflict=function(){return $.fn.tooltip=old,this}}(jQuery),/* ========================================================================
 * Bootstrap: popover.js v3.3.5
 * http://getbootstrap.com/javascript/#popovers
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.popover"),options="object"==typeof option&&option;(data||!/destroy|hide/.test(option))&&(data||$this.data("bs.popover",data=new Popover(this,options)),"string"==typeof option&&data[option]())})}var Popover=function(element,options){this.init("popover",element,options)};if(!$.fn.tooltip)throw new Error("Popover requires tooltip.js");Popover.VERSION="3.3.5",Popover.DEFAULTS=$.extend({},$.fn.tooltip.Constructor.DEFAULTS,{placement:"right",trigger:"click",content:"",template:'<div class="popover" role="tooltip"><div class="arrow"></div><h3 class="popover-title"></h3><div class="popover-content"></div></div>'}),Popover.prototype=$.extend({},$.fn.tooltip.Constructor.prototype),Popover.prototype.constructor=Popover,Popover.prototype.getDefaults=function(){return Popover.DEFAULTS},Popover.prototype.setContent=function(){var $tip=this.tip(),title=this.getTitle(),content=this.getContent();$tip.find(".popover-title")[this.options.html?"html":"text"](title),$tip.find(".popover-content").children().detach().end()[this.options.html?"string"==typeof content?"html":"append":"text"](content),$tip.removeClass("fade top bottom left right in"),$tip.find(".popover-title").html()||$tip.find(".popover-title").hide()},Popover.prototype.hasContent=function(){return this.getTitle()||this.getContent()},Popover.prototype.getContent=function(){var $e=this.$element,o=this.options;return $e.attr("data-content")||("function"==typeof o.content?o.content.call($e[0]):o.content)},Popover.prototype.arrow=function(){return this.$arrow=this.$arrow||this.tip().find(".arrow")};var old=$.fn.popover;$.fn.popover=Plugin,$.fn.popover.Constructor=Popover,$.fn.popover.noConflict=function(){return $.fn.popover=old,this}}(jQuery),/* ========================================================================
 * Bootstrap: scrollspy.js v3.3.5
 * http://getbootstrap.com/javascript/#scrollspy
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function ScrollSpy(element,options){this.$body=$(document.body),this.$scrollElement=$($(element).is(document.body)?window:element),this.options=$.extend({},ScrollSpy.DEFAULTS,options),this.selector=(this.options.target||"")+" .nav li > a",this.offsets=[],this.targets=[],this.activeTarget=null,this.scrollHeight=0,this.$scrollElement.on("scroll.bs.scrollspy",$.proxy(this.process,this)),this.refresh(),this.process()}function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.scrollspy"),options="object"==typeof option&&option;data||$this.data("bs.scrollspy",data=new ScrollSpy(this,options)),"string"==typeof option&&data[option]()})}ScrollSpy.VERSION="3.3.5",ScrollSpy.DEFAULTS={offset:10},ScrollSpy.prototype.getScrollHeight=function(){return this.$scrollElement[0].scrollHeight||Math.max(this.$body[0].scrollHeight,document.documentElement.scrollHeight)},ScrollSpy.prototype.refresh=function(){var that=this,offsetMethod="offset",offsetBase=0;this.offsets=[],this.targets=[],this.scrollHeight=this.getScrollHeight(),$.isWindow(this.$scrollElement[0])||(offsetMethod="position",offsetBase=this.$scrollElement.scrollTop()),this.$body.find(this.selector).map(function(){var $el=$(this),href=$el.data("target")||$el.attr("href"),$href=/^#./.test(href)&&$(href);return $href&&$href.length&&$href.is(":visible")&&[[$href[offsetMethod]().top+offsetBase,href]]||null}).sort(function(a,b){return a[0]-b[0]}).each(function(){that.offsets.push(this[0]),that.targets.push(this[1])})},ScrollSpy.prototype.process=function(){var i,scrollTop=this.$scrollElement.scrollTop()+this.options.offset,scrollHeight=this.getScrollHeight(),maxScroll=this.options.offset+scrollHeight-this.$scrollElement.height(),offsets=this.offsets,targets=this.targets,activeTarget=this.activeTarget;if(this.scrollHeight!=scrollHeight&&this.refresh(),scrollTop>=maxScroll)return activeTarget!=(i=targets[targets.length-1])&&this.activate(i);if(activeTarget&&scrollTop<offsets[0])return this.activeTarget=null,this.clear();for(i=offsets.length;i--;)activeTarget!=targets[i]&&scrollTop>=offsets[i]&&(void 0===offsets[i+1]||scrollTop<offsets[i+1])&&this.activate(targets[i])},ScrollSpy.prototype.activate=function(target){this.activeTarget=target,this.clear();var selector=this.selector+'[data-target="'+target+'"],'+this.selector+'[href="'+target+'"]',active=$(selector).parents("li").addClass("active");active.parent(".dropdown-menu").length&&(active=active.closest("li.dropdown").addClass("active")),active.trigger("activate.bs.scrollspy")},ScrollSpy.prototype.clear=function(){$(this.selector).parentsUntil(this.options.target,".active").removeClass("active")};var old=$.fn.scrollspy;$.fn.scrollspy=Plugin,$.fn.scrollspy.Constructor=ScrollSpy,$.fn.scrollspy.noConflict=function(){return $.fn.scrollspy=old,this},$(window).on("load.bs.scrollspy.data-api",function(){$('[data-spy="scroll"]').each(function(){var $spy=$(this);Plugin.call($spy,$spy.data())})})}(jQuery),/* ========================================================================
 * Bootstrap: tab.js v3.3.5
 * http://getbootstrap.com/javascript/#tabs
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.tab");data||$this.data("bs.tab",data=new Tab(this)),"string"==typeof option&&data[option]()})}var Tab=function(element){this.element=$(element)};Tab.VERSION="3.3.5",Tab.TRANSITION_DURATION=150,Tab.prototype.show=function(){var $this=this.element,$ul=$this.closest("ul:not(.dropdown-menu)"),selector=$this.data("target");if(selector||(selector=$this.attr("href"),selector=selector&&selector.replace(/.*(?=#[^\s]*$)/,"")),!$this.parent("li").hasClass("active")){var $previous=$ul.find(".active:last a"),hideEvent=$.Event("hide.bs.tab",{relatedTarget:$this[0]}),showEvent=$.Event("show.bs.tab",{relatedTarget:$previous[0]});if($previous.trigger(hideEvent),$this.trigger(showEvent),!showEvent.isDefaultPrevented()&&!hideEvent.isDefaultPrevented()){var $target=$(selector);this.activate($this.closest("li"),$ul),this.activate($target,$target.parent(),function(){$previous.trigger({type:"hidden.bs.tab",relatedTarget:$this[0]}),$this.trigger({type:"shown.bs.tab",relatedTarget:$previous[0]})})}}},Tab.prototype.activate=function(element,container,callback){function next(){$active.removeClass("active").find("> .dropdown-menu > .active").removeClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!1),element.addClass("active").find('[data-toggle="tab"]').attr("aria-expanded",!0),transition?(element[0].offsetWidth,element.addClass("in")):element.removeClass("fade"),element.parent(".dropdown-menu").length&&element.closest("li.dropdown").addClass("active").end().find('[data-toggle="tab"]').attr("aria-expanded",!0),callback&&callback()}var $active=container.find("> .active"),transition=callback&&$.support.transition&&($active.length&&$active.hasClass("fade")||!!container.find("> .fade").length);$active.length&&transition?$active.one("bsTransitionEnd",next).emulateTransitionEnd(Tab.TRANSITION_DURATION):next(),$active.removeClass("in")};var old=$.fn.tab;$.fn.tab=Plugin,$.fn.tab.Constructor=Tab,$.fn.tab.noConflict=function(){return $.fn.tab=old,this};var clickHandler=function(e){e.preventDefault(),Plugin.call($(this),"show")};$(document).on("click.bs.tab.data-api",'[data-toggle="tab"]',clickHandler).on("click.bs.tab.data-api",'[data-toggle="pill"]',clickHandler)}(jQuery),/* ========================================================================
 * Bootstrap: affix.js v3.3.5
 * http://getbootstrap.com/javascript/#affix
 * ========================================================================
 * Copyright 2011-2015 Twitter, Inc.
 * Licensed under MIT (https://github.com/twbs/bootstrap/blob/master/LICENSE)
 * ======================================================================== */
+function($){"use strict";function Plugin(option){return this.each(function(){var $this=$(this),data=$this.data("bs.affix"),options="object"==typeof option&&option;data||$this.data("bs.affix",data=new Affix(this,options)),"string"==typeof option&&data[option]()})}var Affix=function(element,options){this.options=$.extend({},Affix.DEFAULTS,options),this.$target=$(this.options.target).on("scroll.bs.affix.data-api",$.proxy(this.checkPosition,this)).on("click.bs.affix.data-api",$.proxy(this.checkPositionWithEventLoop,this)),this.$element=$(element),this.affixed=null,this.unpin=null,this.pinnedOffset=null,this.checkPosition()};Affix.VERSION="3.3.5",Affix.RESET="affix affix-top affix-bottom",Affix.DEFAULTS={offset:0,target:window},Affix.prototype.getState=function(scrollHeight,height,offsetTop,offsetBottom){var scrollTop=this.$target.scrollTop(),position=this.$element.offset(),targetHeight=this.$target.height();if(null!=offsetTop&&"top"==this.affixed)return offsetTop>scrollTop?"top":!1;if("bottom"==this.affixed)return null!=offsetTop?scrollTop+this.unpin<=position.top?!1:"bottom":scrollHeight-offsetBottom>=scrollTop+targetHeight?!1:"bottom";var initializing=null==this.affixed,colliderTop=initializing?scrollTop:position.top,colliderHeight=initializing?targetHeight:height;return null!=offsetTop&&offsetTop>=scrollTop?"top":null!=offsetBottom&&colliderTop+colliderHeight>=scrollHeight-offsetBottom?"bottom":!1},Affix.prototype.getPinnedOffset=function(){if(this.pinnedOffset)return this.pinnedOffset;this.$element.removeClass(Affix.RESET).addClass("affix");var scrollTop=this.$target.scrollTop(),position=this.$element.offset();return this.pinnedOffset=position.top-scrollTop},Affix.prototype.checkPositionWithEventLoop=function(){setTimeout($.proxy(this.checkPosition,this),1)},Affix.prototype.checkPosition=function(){if(this.$element.is(":visible")){var height=this.$element.height(),offset=this.options.offset,offsetTop=offset.top,offsetBottom=offset.bottom,scrollHeight=Math.max($(document).height(),$(document.body).height());"object"!=typeof offset&&(offsetBottom=offsetTop=offset),"function"==typeof offsetTop&&(offsetTop=offset.top(this.$element)),"function"==typeof offsetBottom&&(offsetBottom=offset.bottom(this.$element));var affix=this.getState(scrollHeight,height,offsetTop,offsetBottom);if(this.affixed!=affix){null!=this.unpin&&this.$element.css("top","");var affixType="affix"+(affix?"-"+affix:""),e=$.Event(affixType+".bs.affix");if(this.$element.trigger(e),e.isDefaultPrevented())return;this.affixed=affix,this.unpin="bottom"==affix?this.getPinnedOffset():null,this.$element.removeClass(Affix.RESET).addClass(affixType).trigger(affixType.replace("affix","affixed")+".bs.affix")}"bottom"==affix&&this.$element.offset({top:scrollHeight-height-offsetBottom})}};var old=$.fn.affix;$.fn.affix=Plugin,$.fn.affix.Constructor=Affix,$.fn.affix.noConflict=function(){return $.fn.affix=old,this},$(window).on("load",function(){$('[data-spy="affix"]').each(function(){var $spy=$(this),data=$spy.data();data.offset=data.offset||{},null!=data.offsetBottom&&(data.offset.bottom=data.offsetBottom),null!=data.offsetTop&&(data.offset.top=data.offsetTop),Plugin.call($spy,data)})})}(jQuery),/*!
 * Timepicker Component for Twitter Bootstrap
 *
 * Copyright 2013 Joris de Wit
 *
 * Contributors https://github.com/jdewit/bootstrap-timepicker/graphs/contributors
 *
 * For the full copyright and license information, please view the LICENSE
 * file that was distributed with this source code.
 */
function($,window,document,undefined){"use strict";var Timepicker=function(element,options){this.widget="",this.$element=$(element),this.defaultTime=options.defaultTime,this.disableFocus=options.disableFocus,this.disableMousewheel=options.disableMousewheel,this.isOpen=options.isOpen,this.minuteStep=options.minuteStep,this.modalBackdrop=options.modalBackdrop,this.secondStep=options.secondStep,this.showInputs=options.showInputs,this.showMeridian=options.showMeridian,this.showSeconds=options.showSeconds,this.template=options.template,this.appendWidgetTo=options.appendWidgetTo,this.showWidgetOnAddonClick=options.showWidgetOnAddonClick,this._init()};Timepicker.prototype={constructor:Timepicker,_init:function(){var self=this;this.showWidgetOnAddonClick&&(this.$element.parent().hasClass("input-append")||this.$element.parent().hasClass("input-prepend"))?(this.$element.parent(".input-append, .input-prepend").find(".add-on").on({"click.timepicker":$.proxy(this.showWidget,this)}),this.$element.on({"focus.timepicker":$.proxy(this.highlightUnit,this),"click.timepicker":$.proxy(this.highlightUnit,this),"keydown.timepicker":$.proxy(this.elementKeydown,this),"blur.timepicker":$.proxy(this.blurElement,this)}),this.disableMousewheel||this.$element.on({"mousewheel.timepicker DOMMouseScroll.timepicker":$.proxy(this.mousewheel,this)})):this.template?(this.$element.on({"focus.timepicker":$.proxy(this.showWidget,this),"click.timepicker":$.proxy(this.showWidget,this),"blur.timepicker":$.proxy(this.blurElement,this)}),this.disableMousewheel||this.$element.on({"mousewheel.timepicker DOMMouseScroll.timepicker":$.proxy(this.mousewheel,this)})):(this.$element.on({"focus.timepicker":$.proxy(this.highlightUnit,this),"click.timepicker":$.proxy(this.highlightUnit,this),"keydown.timepicker":$.proxy(this.elementKeydown,this),"blur.timepicker":$.proxy(this.blurElement,this)}),this.disableMousewheel||this.$element.on({"mousewheel.timepicker DOMMouseScroll.timepicker":$.proxy(this.mousewheel,this)})),this.template!==!1?this.$widget=$(this.getTemplate()).prependTo(this.$element.parents(this.appendWidgetTo)).on("click",$.proxy(this.widgetClick,this)):this.$widget=!1,this.showInputs&&this.$widget!==!1&&this.$widget.find("input").each(function(){$(this).on({"click.timepicker":function(){$(this).select()},"keydown.timepicker":$.proxy(self.widgetKeydown,self),"keyup.timepicker":$.proxy(self.widgetKeyup,self)})}),this.setDefaultTime(this.defaultTime)},blurElement:function(){this.highlightedUnit=null,this.updateFromElementVal()},clear:function(){this.hour="",this.minute="",this.second="",this.meridian="",this.$element.val("")},decrementHour:function(){if(this.showMeridian)if(1===this.hour)this.hour=12;else{if(12===this.hour)return this.hour--,this.toggleMeridian();if(0===this.hour)return this.hour=11,this.toggleMeridian();this.hour--}else this.hour<=0?this.hour=23:this.hour--},decrementMinute:function(step){var newVal;newVal=step?this.minute-step:this.minute-this.minuteStep,0>newVal?(this.decrementHour(),this.minute=newVal+60):this.minute=newVal},decrementSecond:function(){var newVal=this.second-this.secondStep;0>newVal?(this.decrementMinute(!0),this.second=newVal+60):this.second=newVal},elementKeydown:function(e){switch(e.keyCode){case 9:case 27:this.updateFromElementVal();break;case 37:e.preventDefault(),this.highlightPrevUnit();break;case 38:switch(e.preventDefault(),this.highlightedUnit){case"hour":this.incrementHour(),this.highlightHour();break;case"minute":this.incrementMinute(),this.highlightMinute();break;case"second":this.incrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update();break;case 39:e.preventDefault(),this.highlightNextUnit();break;case 40:switch(e.preventDefault(),this.highlightedUnit){case"hour":this.decrementHour(),this.highlightHour();break;case"minute":this.decrementMinute(),this.highlightMinute();break;case"second":this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian()}this.update()}},getCursorPosition:function(){var input=this.$element.get(0);if("selectionStart"in input)return input.selectionStart;if(document.selection){input.focus();var sel=document.selection.createRange(),selLen=document.selection.createRange().text.length;return sel.moveStart("character",-input.value.length),sel.text.length-selLen}},getTemplate:function(){var template,hourTemplate,minuteTemplate,secondTemplate,meridianTemplate,templateContent;switch(this.showInputs?(hourTemplate='<input type="text" class="bootstrap-timepicker-hour" maxlength="2"/>',minuteTemplate='<input type="text" class="bootstrap-timepicker-minute" maxlength="2"/>',secondTemplate='<input type="text" class="bootstrap-timepicker-second" maxlength="2"/>',meridianTemplate='<input type="text" class="bootstrap-timepicker-meridian" maxlength="2"/>'):(hourTemplate='<span class="bootstrap-timepicker-hour"></span>',minuteTemplate='<span class="bootstrap-timepicker-minute"></span>',secondTemplate='<span class="bootstrap-timepicker-second"></span>',meridianTemplate='<span class="bootstrap-timepicker-meridian"></span>'),templateContent='<table><tr><td><a href="#" data-action="incrementHour"><i class="icon-chevron-up"></i></a></td><td class="separator">&nbsp;</td><td><a href="#" data-action="incrementMinute"><i class="icon-chevron-up"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="incrementSecond"><i class="icon-chevron-up"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td class="meridian-column"><a href="#" data-action="toggleMeridian"><i class="icon-chevron-up"></i></a></td>':"")+"</tr><tr><td>"+hourTemplate+'</td> <td class="separator">:</td><td>'+minuteTemplate+"</td> "+(this.showSeconds?'<td class="separator">:</td><td>'+secondTemplate+"</td>":"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td>'+meridianTemplate+"</td>":"")+'</tr><tr><td><a href="#" data-action="decrementHour"><i class="icon-chevron-down"></i></a></td><td class="separator"></td><td><a href="#" data-action="decrementMinute"><i class="icon-chevron-down"></i></a></td>'+(this.showSeconds?'<td class="separator">&nbsp;</td><td><a href="#" data-action="decrementSecond"><i class="icon-chevron-down"></i></a></td>':"")+(this.showMeridian?'<td class="separator">&nbsp;</td><td><a href="#" data-action="toggleMeridian"><i class="icon-chevron-down"></i></a></td>':"")+"</tr></table>",this.template){case"modal":template='<div class="bootstrap-timepicker-widget modal hide fade in" data-backdrop="'+(this.modalBackdrop?"true":"false")+'"><div class="modal-header"><a href="#" class="close" data-dismiss="modal">\xd7</a><h3>Pick a Time</h3></div><div class="modal-content">'+templateContent+'</div><div class="modal-footer"><a href="#" class="btn btn-primary" data-dismiss="modal">OK</a></div></div>';break;case"dropdown":template='<div class="bootstrap-timepicker-widget dropdown-menu">'+templateContent+"</div>"}return template},getTime:function(){return this.hour||this.minute||this.second?this.hour+":"+(1===this.minute.toString().length?"0"+this.minute:this.minute)+(this.showSeconds?":"+(1===this.second.toString().length?"0"+this.second:this.second):"")+(this.showMeridian?" "+this.meridian:""):""},hideWidget:function(){this.isOpen!==!1&&(this.$element.trigger({type:"hide.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}}),"modal"===this.template&&this.$widget.modal?this.$widget.modal("hide"):this.$widget.removeClass("open"),$(document).off("mousedown.timepicker, touchend.timepicker"),this.isOpen=!1)},highlightUnit:function(){this.position=this.getCursorPosition(),this.position>=0&&this.position<=2?this.highlightHour():this.position>=3&&this.position<=5?this.highlightMinute():this.position>=6&&this.position<=8?this.showSeconds?this.highlightSecond():this.highlightMeridian():this.position>=9&&this.position<=11&&this.highlightMeridian()},highlightNextUnit:function(){switch(this.highlightedUnit){case"hour":this.highlightMinute();break;case"minute":this.showSeconds?this.highlightSecond():this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"second":this.showMeridian?this.highlightMeridian():this.highlightHour();break;case"meridian":this.highlightHour()}},highlightPrevUnit:function(){switch(this.highlightedUnit){case"hour":this.showMeridian?this.highlightMeridian():this.showSeconds?this.highlightSecond():this.highlightMinute();break;case"minute":this.highlightHour();break;case"second":this.highlightMinute();break;case"meridian":this.showSeconds?this.highlightSecond():this.highlightMinute()}},highlightHour:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="hour",$element.setSelectionRange&&setTimeout(function(){self.hour<10?$element.setSelectionRange(0,1):$element.setSelectionRange(0,2)},0)},highlightMinute:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="minute",$element.setSelectionRange&&setTimeout(function(){self.hour<10?$element.setSelectionRange(2,4):$element.setSelectionRange(3,5)},0)},highlightSecond:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="second",$element.setSelectionRange&&setTimeout(function(){self.hour<10?$element.setSelectionRange(5,7):$element.setSelectionRange(6,8)},0)},highlightMeridian:function(){var $element=this.$element.get(0),self=this;this.highlightedUnit="meridian",$element.setSelectionRange&&(this.showSeconds?setTimeout(function(){self.hour<10?$element.setSelectionRange(8,10):$element.setSelectionRange(9,11)},0):setTimeout(function(){self.hour<10?$element.setSelectionRange(5,7):$element.setSelectionRange(6,8)},0))},incrementHour:function(){if(this.showMeridian){if(11===this.hour)return this.hour++,this.toggleMeridian();12===this.hour&&(this.hour=0)}return 23===this.hour?void(this.hour=0):void this.hour++},incrementMinute:function(step){var newVal;newVal=step?this.minute+step:this.minute+this.minuteStep-this.minute%this.minuteStep,newVal>59?(this.incrementHour(),this.minute=newVal-60):this.minute=newVal},incrementSecond:function(){var newVal=this.second+this.secondStep-this.second%this.secondStep;newVal>59?(this.incrementMinute(!0),this.second=newVal-60):this.second=newVal},mousewheel:function(e){e.preventDefault(),e.stopPropagation();var delta=e.originalEvent.wheelDelta||-e.originalEvent.detail,scrollTo=null;switch("mousewheel"===e.type?scrollTo=-1*e.originalEvent.wheelDelta:"DOMMouseScroll"===e.type&&(scrollTo=40*e.originalEvent.detail),scrollTo&&(e.preventDefault(),$(this).scrollTop(scrollTo+$(this).scrollTop())),this.highlightedUnit){case"minute":delta>0?this.incrementMinute():this.decrementMinute(),this.highlightMinute();break;case"second":delta>0?this.incrementSecond():this.decrementSecond(),this.highlightSecond();break;case"meridian":this.toggleMeridian(),this.highlightMeridian();break;default:delta>0?this.incrementHour():this.decrementHour(),this.highlightHour()}return!1},remove:function(){$("document").off(".timepicker"),this.$widget&&this.$widget.remove(),delete this.$element.data().timepicker},setDefaultTime:function(defaultTime){if(this.$element.val())this.updateFromElementVal();else if("current"===defaultTime){var dTime=new Date,hours=dTime.getHours(),minutes=dTime.getMinutes(),seconds=dTime.getSeconds(),meridian="AM";0!==seconds&&(seconds=Math.ceil(dTime.getSeconds()/this.secondStep)*this.secondStep,60===seconds&&(minutes+=1,seconds=0)),0!==minutes&&(minutes=Math.ceil(dTime.getMinutes()/this.minuteStep)*this.minuteStep,60===minutes&&(hours+=1,minutes=0)),this.showMeridian&&(0===hours?hours=12:hours>=12?(hours>12&&(hours-=12),meridian="PM"):meridian="AM"),this.hour=hours,this.minute=minutes,this.second=seconds,this.meridian=meridian,this.update()}else defaultTime===!1?(this.hour=0,this.minute=0,this.second=0,this.meridian="AM"):this.setTime(defaultTime)},setTime:function(time,ignoreWidget){if(!time)return void this.clear();var timeArray,hour,minute,second,meridian;"object"==typeof time&&time.getMonth?(hour=time.getHours(),minute=time.getMinutes(),second=time.getSeconds(),this.showMeridian&&(meridian="AM",hour>12&&(meridian="PM",hour%=12),12===hour&&(meridian="PM"))):(meridian=null!==time.match(/p/i)?"PM":"AM",time=time.replace(/[^0-9\:]/g,""),timeArray=time.split(":"),hour=timeArray[0]?timeArray[0].toString():timeArray.toString(),minute=timeArray[1]?timeArray[1].toString():"",second=timeArray[2]?timeArray[2].toString():"",hour.length>4&&(second=hour.substr(4,2)),hour.length>2&&(minute=hour.substr(2,2),hour=hour.substr(0,2)),minute.length>2&&(second=minute.substr(2,2),minute=minute.substr(0,2)),second.length>2&&(second=second.substr(2,2)),hour=parseInt(hour,10),minute=parseInt(minute,10),second=parseInt(second,10),isNaN(hour)&&(hour=0),isNaN(minute)&&(minute=0),isNaN(second)&&(second=0),this.showMeridian?1>hour?hour=1:hour>12&&(hour=12):(hour>=24?hour=23:0>hour&&(hour=0),13>hour&&"PM"===meridian&&(hour+=12)),0>minute?minute=0:minute>=60&&(minute=59),this.showSeconds&&(isNaN(second)?second=0:0>second?second=0:second>=60&&(second=59))),this.hour=hour,this.minute=minute,this.second=second,this.meridian=meridian,this.update(ignoreWidget)},showWidget:function(){if(!this.isOpen&&!this.$element.is(":disabled")){var self=this;$(document).on("mousedown.timepicker, touchend.timepicker",function(e){0===$(e.target).closest(".bootstrap-timepicker-widget").length&&self.hideWidget()}),this.$element.trigger({type:"show.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}}),this.disableFocus&&this.$element.blur(),this.hour||(this.defaultTime?this.setDefaultTime(this.defaultTime):this.setTime("0:0:0")),"modal"===this.template&&this.$widget.modal?this.$widget.modal("show").on("hidden",$.proxy(this.hideWidget,this)):this.isOpen===!1&&this.$widget.addClass("open"),this.isOpen=!0}},toggleMeridian:function(){this.meridian="AM"===this.meridian?"PM":"AM"},update:function(ignoreWidget){this.updateElement(),ignoreWidget||this.updateWidget(),this.$element.trigger({type:"changeTime.timepicker",time:{value:this.getTime(),hours:this.hour,minutes:this.minute,seconds:this.second,meridian:this.meridian}})},updateElement:function(){this.$element.val(this.getTime()).change()},updateFromElementVal:function(){this.setTime(this.$element.val())},updateWidget:function(){if(this.$widget!==!1){var hour=this.hour,minute=1===this.minute.toString().length?"0"+this.minute:this.minute,second=1===this.second.toString().length?"0"+this.second:this.second;this.showInputs?(this.$widget.find("input.bootstrap-timepicker-hour").val(hour),this.$widget.find("input.bootstrap-timepicker-minute").val(minute),this.showSeconds&&this.$widget.find("input.bootstrap-timepicker-second").val(second),this.showMeridian&&this.$widget.find("input.bootstrap-timepicker-meridian").val(this.meridian)):(this.$widget.find("span.bootstrap-timepicker-hour").text(hour),this.$widget.find("span.bootstrap-timepicker-minute").text(minute),this.showSeconds&&this.$widget.find("span.bootstrap-timepicker-second").text(second),this.showMeridian&&this.$widget.find("span.bootstrap-timepicker-meridian").text(this.meridian))}},updateFromWidgetInputs:function(){if(this.$widget!==!1){var t=this.$widget.find("input.bootstrap-timepicker-hour").val()+":"+this.$widget.find("input.bootstrap-timepicker-minute").val()+(this.showSeconds?":"+this.$widget.find("input.bootstrap-timepicker-second").val():"")+(this.showMeridian?this.$widget.find("input.bootstrap-timepicker-meridian").val():"");this.setTime(t,!0)}},widgetClick:function(e){e.stopPropagation(),e.preventDefault();var $input=$(e.target),action=$input.closest("a").data("action");action&&this[action](),this.update(),$input.is("input")&&$input.get(0).setSelectionRange(0,2)},widgetKeydown:function(e){var $input=$(e.target),name=$input.attr("class").replace("bootstrap-timepicker-","");switch(e.keyCode){case 9:if(this.showMeridian&&"meridian"===name||this.showSeconds&&"second"===name||!this.showMeridian&&!this.showSeconds&&"minute"===name)return this.hideWidget();break;case 27:this.hideWidget();break;case 38:switch(e.preventDefault(),name){case"hour":this.incrementHour();break;case"minute":this.incrementMinute();break;case"second":this.incrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),$input.get(0).setSelectionRange(0,2);break;case 40:switch(e.preventDefault(),name){case"hour":this.decrementHour();break;case"minute":this.decrementMinute();break;case"second":this.decrementSecond();break;case"meridian":this.toggleMeridian()}this.setTime(this.getTime()),$input.get(0).setSelectionRange(0,2)}},widgetKeyup:function(e){(65===e.keyCode||77===e.keyCode||80===e.keyCode||46===e.keyCode||8===e.keyCode||e.keyCode>=46&&e.keyCode<=57)&&this.updateFromWidgetInputs()}},$.fn.timepicker=function(option){var args=Array.apply(null,arguments);return args.shift(),this.each(function(){var $this=$(this),data=$this.data("timepicker"),options="object"==typeof option&&option;data||$this.data("timepicker",data=new Timepicker(this,$.extend({},$.fn.timepicker.defaults,options,$(this).data()))),"string"==typeof option&&data[option].apply(data,args)})},$.fn.timepicker.defaults={defaultTime:"current",disableFocus:!1,disableMousewheel:!1,isOpen:!1,minuteStep:15,modalBackdrop:!1,secondStep:15,showSeconds:!1,showInputs:!0,showMeridian:!0,template:"dropdown",appendWidgetTo:".bootstrap-timepicker",showWidgetOnAddonClick:!0},$.fn.timepicker.Constructor=Timepicker}(jQuery,window,document),/* ========================================================================
 * bootstrap-switch - v3.3.2
 * http://www.bootstrap-switch.org
 * ========================================================================
 * Copyright 2012-2013 Mattia Larentis
 *
 * ========================================================================
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 * ========================================================================
 */
function(){var __slice=[].slice;!function($,window){"use strict";var BootstrapSwitch;return BootstrapSwitch=function(){function BootstrapSwitch(element,options){null==options&&(options={}),this.$element=$(element),this.options=$.extend({},$.fn.bootstrapSwitch.defaults,{state:this.$element.is(":checked"),size:this.$element.data("size"),animate:this.$element.data("animate"),disabled:this.$element.is(":disabled"),readonly:this.$element.is("[readonly]"),indeterminate:this.$element.data("indeterminate"),inverse:this.$element.data("inverse"),radioAllOff:this.$element.data("radio-all-off"),onColor:this.$element.data("on-color"),offColor:this.$element.data("off-color"),onText:this.$element.data("on-text"),offText:this.$element.data("off-text"),labelText:this.$element.data("label-text"),handleWidth:this.$element.data("handle-width"),labelWidth:this.$element.data("label-width"),baseClass:this.$element.data("base-class"),wrapperClass:this.$element.data("wrapper-class")},options),this.$wrapper=$("<div>",{"class":function(_this){return function(){var classes;return classes=[""+_this.options.baseClass].concat(_this._getClasses(_this.options.wrapperClass)),classes.push(_this.options.state?""+_this.options.baseClass+"-on":""+_this.options.baseClass+"-off"),null!=_this.options.size&&classes.push(""+_this.options.baseClass+"-"+_this.options.size),_this.options.disabled&&classes.push(""+_this.options.baseClass+"-disabled"),_this.options.readonly&&classes.push(""+_this.options.baseClass+"-readonly"),_this.options.indeterminate&&classes.push(""+_this.options.baseClass+"-indeterminate"),_this.options.inverse&&classes.push(""+_this.options.baseClass+"-inverse"),_this.$element.attr("id")&&classes.push(""+_this.options.baseClass+"-id-"+_this.$element.attr("id")),classes.join(" ")}}(this)()}),this.$container=$("<div>",{"class":""+this.options.baseClass+"-container"}),this.$on=$("<span>",{html:this.options.onText,"class":""+this.options.baseClass+"-handle-on "+this.options.baseClass+"-"+this.options.onColor}),this.$off=$("<span>",{html:this.options.offText,"class":""+this.options.baseClass+"-handle-off "+this.options.baseClass+"-"+this.options.offColor}),this.$label=$("<span>",{html:this.options.labelText,"class":""+this.options.baseClass+"-label"}),this.$element.on("init.bootstrapSwitch",function(_this){return function(){return _this.options.onInit.apply(element,arguments)}}(this)),this.$element.on("switchChange.bootstrapSwitch",function(_this){return function(){return _this.options.onSwitchChange.apply(element,arguments)}}(this)),this.$container=this.$element.wrap(this.$container).parent(),this.$wrapper=this.$container.wrap(this.$wrapper).parent(),this.$element.before(this.options.inverse?this.$off:this.$on).before(this.$label).before(this.options.inverse?this.$on:this.$off),this.options.indeterminate&&this.$element.prop("indeterminate",!0),this._init(),this._elementHandlers(),this._handleHandlers(),this._labelHandlers(),this._formHandler(),this._externalLabelHandler(),this.$element.trigger("init.bootstrapSwitch")}return BootstrapSwitch.prototype._constructor=BootstrapSwitch,BootstrapSwitch.prototype.state=function(value,skip){return"undefined"==typeof value?this.options.state:this.options.disabled||this.options.readonly?this.$element:this.options.state&&!this.options.radioAllOff&&this.$element.is(":radio")?this.$element:(this.options.indeterminate&&this.indeterminate(!1),value=!!value,this.$element.prop("checked",value).trigger("change.bootstrapSwitch",skip),this.$element)},BootstrapSwitch.prototype.toggleState=function(skip){return this.options.disabled||this.options.readonly?this.$element:this.options.indeterminate?(this.indeterminate(!1),this.state(!0)):this.$element.prop("checked",!this.options.state).trigger("change.bootstrapSwitch",skip)},BootstrapSwitch.prototype.size=function(value){return"undefined"==typeof value?this.options.size:(null!=this.options.size&&this.$wrapper.removeClass(""+this.options.baseClass+"-"+this.options.size),value&&this.$wrapper.addClass(""+this.options.baseClass+"-"+value),this._width(),this._containerPosition(),this.options.size=value,this.$element)},BootstrapSwitch.prototype.animate=function(value){return"undefined"==typeof value?this.options.animate:(value=!!value,value===this.options.animate?this.$element:this.toggleAnimate())},BootstrapSwitch.prototype.toggleAnimate=function(){return this.options.animate=!this.options.animate,this.$wrapper.toggleClass(""+this.options.baseClass+"-animate"),this.$element},BootstrapSwitch.prototype.disabled=function(value){return"undefined"==typeof value?this.options.disabled:(value=!!value,value===this.options.disabled?this.$element:this.toggleDisabled())},BootstrapSwitch.prototype.toggleDisabled=function(){return this.options.disabled=!this.options.disabled,this.$element.prop("disabled",this.options.disabled),this.$wrapper.toggleClass(""+this.options.baseClass+"-disabled"),this.$element},BootstrapSwitch.prototype.readonly=function(value){return"undefined"==typeof value?this.options.readonly:(value=!!value,value===this.options.readonly?this.$element:this.toggleReadonly())},BootstrapSwitch.prototype.toggleReadonly=function(){return this.options.readonly=!this.options.readonly,this.$element.prop("readonly",this.options.readonly),this.$wrapper.toggleClass(""+this.options.baseClass+"-readonly"),this.$element},BootstrapSwitch.prototype.indeterminate=function(value){return"undefined"==typeof value?this.options.indeterminate:(value=!!value,value===this.options.indeterminate?this.$element:this.toggleIndeterminate())},BootstrapSwitch.prototype.toggleIndeterminate=function(){return this.options.indeterminate=!this.options.indeterminate,this.$element.prop("indeterminate",this.options.indeterminate),this.$wrapper.toggleClass(""+this.options.baseClass+"-indeterminate"),this._containerPosition(),this.$element},BootstrapSwitch.prototype.inverse=function(value){return"undefined"==typeof value?this.options.inverse:(value=!!value,value===this.options.inverse?this.$element:this.toggleInverse())},BootstrapSwitch.prototype.toggleInverse=function(){var $off,$on;return this.$wrapper.toggleClass(""+this.options.baseClass+"-inverse"),$on=this.$on.clone(!0),$off=this.$off.clone(!0),this.$on.replaceWith($off),this.$off.replaceWith($on),this.$on=$off,this.$off=$on,this.options.inverse=!this.options.inverse,this.$element},BootstrapSwitch.prototype.onColor=function(value){var color;return color=this.options.onColor,"undefined"==typeof value?color:(null!=color&&this.$on.removeClass(""+this.options.baseClass+"-"+color),this.$on.addClass(""+this.options.baseClass+"-"+value),this.options.onColor=value,this.$element)},BootstrapSwitch.prototype.offColor=function(value){var color;return color=this.options.offColor,"undefined"==typeof value?color:(null!=color&&this.$off.removeClass(""+this.options.baseClass+"-"+color),this.$off.addClass(""+this.options.baseClass+"-"+value),this.options.offColor=value,this.$element)},BootstrapSwitch.prototype.onText=function(value){return"undefined"==typeof value?this.options.onText:(this.$on.html(value),this._width(),this._containerPosition(),this.options.onText=value,this.$element)},BootstrapSwitch.prototype.offText=function(value){return"undefined"==typeof value?this.options.offText:(this.$off.html(value),this._width(),this._containerPosition(),this.options.offText=value,this.$element)},BootstrapSwitch.prototype.labelText=function(value){return"undefined"==typeof value?this.options.labelText:(this.$label.html(value),this._width(),this.options.labelText=value,this.$element)},BootstrapSwitch.prototype.handleWidth=function(value){return"undefined"==typeof value?this.options.handleWidth:(this.options.handleWidth=value,this._width(),this._containerPosition(),this.$element)},BootstrapSwitch.prototype.labelWidth=function(value){return"undefined"==typeof value?this.options.labelWidth:(this.options.labelWidth=value,this._width(),this._containerPosition(),this.$element)},BootstrapSwitch.prototype.baseClass=function(value){return this.options.baseClass},BootstrapSwitch.prototype.wrapperClass=function(value){return"undefined"==typeof value?this.options.wrapperClass:(value||(value=$.fn.bootstrapSwitch.defaults.wrapperClass),this.$wrapper.removeClass(this._getClasses(this.options.wrapperClass).join(" ")),this.$wrapper.addClass(this._getClasses(value).join(" ")),this.options.wrapperClass=value,this.$element)},BootstrapSwitch.prototype.radioAllOff=function(value){return"undefined"==typeof value?this.options.radioAllOff:(value=!!value,value===this.options.radioAllOff?this.$element:(this.options.radioAllOff=value,this.$element))},BootstrapSwitch.prototype.onInit=function(value){return"undefined"==typeof value?this.options.onInit:(value||(value=$.fn.bootstrapSwitch.defaults.onInit),this.options.onInit=value,this.$element)},BootstrapSwitch.prototype.onSwitchChange=function(value){return"undefined"==typeof value?this.options.onSwitchChange:(value||(value=$.fn.bootstrapSwitch.defaults.onSwitchChange),this.options.onSwitchChange=value,this.$element)},BootstrapSwitch.prototype.destroy=function(){var $form;return $form=this.$element.closest("form"),$form.length&&$form.off("reset.bootstrapSwitch").removeData("bootstrap-switch"),this.$container.children().not(this.$element).remove(),this.$element.unwrap().unwrap().off(".bootstrapSwitch").removeData("bootstrap-switch"),this.$element},BootstrapSwitch.prototype._width=function(){var $handles,handleWidth;return $handles=this.$on.add(this.$off),$handles.add(this.$label).css("width",""),handleWidth="auto"===this.options.handleWidth?Math.max(this.$on.width(),this.$off.width()):this.options.handleWidth,$handles.width(handleWidth),this.$label.width(function(_this){return function(index,width){return"auto"!==_this.options.labelWidth?_this.options.labelWidth:handleWidth>width?handleWidth:width}}(this)),this._handleWidth=this.$on.outerWidth(),this._labelWidth=this.$label.outerWidth(),this.$container.width(2*this._handleWidth+this._labelWidth),this.$wrapper.width(this._handleWidth+this._labelWidth)},BootstrapSwitch.prototype._containerPosition=function(state,callback){return null==state&&(state=this.options.state),this.$container.css("margin-left",function(_this){return function(){var values;return values=[0,"-"+_this._handleWidth+"px"],_this.options.indeterminate?"-"+_this._handleWidth/2+"px":state?_this.options.inverse?values[1]:values[0]:_this.options.inverse?values[0]:values[1]}}(this)),callback?setTimeout(function(){return callback()},50):void 0},BootstrapSwitch.prototype._init=function(){var init,initInterval;return init=function(_this){return function(){return _this._width(),_this._containerPosition(null,function(){return _this.options.animate?_this.$wrapper.addClass(""+_this.options.baseClass+"-animate"):void 0})}}(this),this.$wrapper.is(":visible")?init():initInterval=window.setInterval(function(_this){return function(){return _this.$wrapper.is(":visible")?(init(),window.clearInterval(initInterval)):void 0}}(this),50)},BootstrapSwitch.prototype._elementHandlers=function(){return this.$element.on({"change.bootstrapSwitch":function(_this){return function(e,skip){var state;return e.preventDefault(),e.stopImmediatePropagation(),state=_this.$element.is(":checked"),_this._containerPosition(state),state!==_this.options.state?(_this.options.state=state,_this.$wrapper.toggleClass(""+_this.options.baseClass+"-off").toggleClass(""+_this.options.baseClass+"-on"),skip?void 0:(_this.$element.is(":radio")&&$("[name='"+_this.$element.attr("name")+"']").not(_this.$element).prop("checked",!1).trigger("change.bootstrapSwitch",!0),_this.$element.trigger("switchChange.bootstrapSwitch",[state]))):void 0}}(this),"focus.bootstrapSwitch":function(_this){return function(e){return e.preventDefault(),_this.$wrapper.addClass(""+_this.options.baseClass+"-focused")}}(this),"blur.bootstrapSwitch":function(_this){return function(e){return e.preventDefault(),_this.$wrapper.removeClass(""+_this.options.baseClass+"-focused")}}(this),"keydown.bootstrapSwitch":function(_this){return function(e){if(e.which&&!_this.options.disabled&&!_this.options.readonly)switch(e.which){case 37:return e.preventDefault(),e.stopImmediatePropagation(),_this.state(!1);case 39:return e.preventDefault(),e.stopImmediatePropagation(),_this.state(!0)}}}(this)})},BootstrapSwitch.prototype._handleHandlers=function(){return this.$on.on("click.bootstrapSwitch",function(_this){return function(event){return event.preventDefault(),event.stopPropagation(),_this.state(!1),_this.$element.trigger("focus.bootstrapSwitch")}}(this)),this.$off.on("click.bootstrapSwitch",function(_this){return function(event){return event.preventDefault(),event.stopPropagation(),_this.state(!0),_this.$element.trigger("focus.bootstrapSwitch")}}(this))},BootstrapSwitch.prototype._labelHandlers=function(){return this.$label.on({"mousedown.bootstrapSwitch touchstart.bootstrapSwitch":function(_this){return function(e){return _this._dragStart||_this.options.disabled||_this.options.readonly?void 0:(e.preventDefault(),e.stopPropagation(),_this._dragStart=(e.pageX||e.originalEvent.touches[0].pageX)-parseInt(_this.$container.css("margin-left"),10),_this.options.animate&&_this.$wrapper.removeClass(""+_this.options.baseClass+"-animate"),_this.$element.trigger("focus.bootstrapSwitch"))}}(this),"mousemove.bootstrapSwitch touchmove.bootstrapSwitch":function(_this){return function(e){var difference;if(null!=_this._dragStart&&(e.preventDefault(),difference=(e.pageX||e.originalEvent.touches[0].pageX)-_this._dragStart,!(difference<-_this._handleWidth||difference>0)))return _this._dragEnd=difference,_this.$container.css("margin-left",""+_this._dragEnd+"px")}}(this),"mouseup.bootstrapSwitch touchend.bootstrapSwitch":function(_this){return function(e){var state;if(_this._dragStart)return e.preventDefault(),_this.options.animate&&_this.$wrapper.addClass(""+_this.options.baseClass+"-animate"),_this._dragEnd?(state=_this._dragEnd>-(_this._handleWidth/2),_this._dragEnd=!1,_this.state(_this.options.inverse?!state:state)):_this.state(!_this.options.state),_this._dragStart=!1}}(this),"mouseleave.bootstrapSwitch":function(_this){return function(e){return _this.$label.trigger("mouseup.bootstrapSwitch")}}(this)})},BootstrapSwitch.prototype._externalLabelHandler=function(){var $externalLabel;return $externalLabel=this.$element.closest("label"),$externalLabel.on("click",function(_this){return function(event){return event.preventDefault(),event.stopImmediatePropagation(),event.target===$externalLabel[0]?_this.toggleState():void 0}}(this))},BootstrapSwitch.prototype._formHandler=function(){var $form;return $form=this.$element.closest("form"),$form.data("bootstrap-switch")?void 0:$form.on("reset.bootstrapSwitch",function(){return window.setTimeout(function(){return $form.find("input").filter(function(){return $(this).data("bootstrap-switch")}).each(function(){return $(this).bootstrapSwitch("state",this.checked)})},1)}).data("bootstrap-switch",!0)},BootstrapSwitch.prototype._getClasses=function(classes){var c,cls,_i,_len;if(!$.isArray(classes))return[""+this.options.baseClass+"-"+classes];for(cls=[],_i=0,_len=classes.length;_len>_i;_i++)c=classes[_i],cls.push(""+this.options.baseClass+"-"+c);return cls},BootstrapSwitch}(),$.fn.bootstrapSwitch=function(){var args,option,ret;return option=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],ret=this,this.each(function(){var $this,data;return $this=$(this),data=$this.data("bootstrap-switch"),data||$this.data("bootstrap-switch",data=new BootstrapSwitch(this,option)),"string"==typeof option?ret=data[option].apply(data,args):void 0}),ret},$.fn.bootstrapSwitch.Constructor=BootstrapSwitch,$.fn.bootstrapSwitch.defaults={state:!0,size:null,animate:!0,disabled:!1,readonly:!1,indeterminate:!1,inverse:!1,radioAllOff:!1,onColor:"primary",offColor:"default",onText:"ON",offText:"OFF",labelText:"&nbsp;",handleWidth:"auto",labelWidth:"auto",baseClass:"bootstrap-switch",wrapperClass:"wrapper",onInit:function(){},onSwitchChange:function(){}}}(window.jQuery,window)}.call(this),/**
 * Copyright (c) 2011-2014 Felix Gnass
 * Licensed under the MIT license
 */
function(root,factory){"object"==typeof exports?module.exports=factory():"function"==typeof define&&define.amd?define(factory):root.Spinner=factory()}(this,function(){"use strict";function createEl(tag,prop){var n,el=document.createElement(tag||"div");for(n in prop)el[n]=prop[n];return el}function ins(parent){for(var i=1,n=arguments.length;n>i;i++)parent.appendChild(arguments[i]);return parent}function addAnimation(alpha,trail,i,lines){var name=["opacity",trail,~~(100*alpha),i,lines].join("-"),start=.01+i/lines*100,z=Math.max(1-(1-alpha)/trail*(100-start),alpha),prefix=useCssAnimations.substring(0,useCssAnimations.indexOf("Animation")).toLowerCase(),pre=prefix&&"-"+prefix+"-"||"";return animations[name]||(sheet.insertRule("@"+pre+"keyframes "+name+"{0%{opacity:"+z+"}"+start+"%{opacity:"+alpha+"}"+(start+.01)+"%{opacity:1}"+(start+trail)%100+"%{opacity:"+alpha+"}100%{opacity:"+z+"}}",sheet.cssRules.length),animations[name]=1),name}function vendor(el,prop){var pp,i,s=el.style;for(prop=prop.charAt(0).toUpperCase()+prop.slice(1),i=0;i<prefixes.length;i++)if(pp=prefixes[i]+prop,void 0!==s[pp])return pp;return void 0!==s[prop]?prop:void 0}function css(el,prop){for(var n in prop)el.style[vendor(el,n)||n]=prop[n];return el}function merge(obj){for(var i=1;i<arguments.length;i++){var def=arguments[i];for(var n in def)void 0===obj[n]&&(obj[n]=def[n])}return obj}function getColor(color,idx){return"string"==typeof color?color:color[idx%color.length]}function Spinner(o){this.opts=merge(o||{},Spinner.defaults,defaults)}function initVML(){function vml(tag,attr){return createEl("<"+tag+' xmlns="urn:schemas-microsoft.com:vml" class="spin-vml">',attr)}sheet.addRule(".spin-vml","behavior:url(#default#VML)"),Spinner.prototype.lines=function(el,o){function grp(){return css(vml("group",{coordsize:s+" "+s,coordorigin:-r+" "+-r}),{width:s,height:s})}function seg(i,dx,filter){ins(g,ins(css(grp(),{rotation:360/o.lines*i+"deg",left:~~dx}),ins(css(vml("roundrect",{arcsize:o.corners}),{width:r,height:o.width,left:o.radius,top:-o.width>>1,filter:filter}),vml("fill",{color:getColor(o.color,i),opacity:o.opacity}),vml("stroke",{opacity:0}))))}var i,r=o.length+o.width,s=2*r,margin=2*-(o.width+o.length)+"px",g=css(grp(),{position:"absolute",top:margin,left:margin});if(o.shadow)for(i=1;i<=o.lines;i++)seg(i,-2,"progid:DXImageTransform.Microsoft.Blur(pixelradius=2,makeshadow=1,shadowopacity=.3)");for(i=1;i<=o.lines;i++)seg(i);return ins(el,g)},Spinner.prototype.opacity=function(el,i,val,o){var c=el.firstChild;o=o.shadow&&o.lines||0,c&&i+o<c.childNodes.length&&(c=c.childNodes[i+o],c=c&&c.firstChild,c=c&&c.firstChild,c&&(c.opacity=val))}}var useCssAnimations,prefixes=["webkit","Moz","ms","O"],animations={},sheet=function(){var el=createEl("style",{type:"text/css"});return ins(document.getElementsByTagName("head")[0],el),el.sheet||el.styleSheet}(),defaults={lines:12,length:7,width:5,radius:10,rotate:0,corners:1,color:"#000",direction:1,speed:1,trail:100,opacity:.25,fps:20,zIndex:2e9,className:"spinner",top:"50%",left:"50%",position:"absolute"};Spinner.defaults={},merge(Spinner.prototype,{spin:function(target){this.stop();var self=this,o=self.opts,el=self.el=css(createEl(0,{className:o.className}),{position:o.position,width:0,zIndex:o.zIndex});o.radius+o.length+o.width;if(target&&(target.insertBefore(el,target.firstChild||null),css(el,{left:o.left,top:o.top})),el.setAttribute("role","progressbar"),self.lines(el,self.opts),!useCssAnimations){var alpha,i=0,start=(o.lines-1)*(1-o.direction)/2,fps=o.fps,f=fps/o.speed,ostep=(1-o.opacity)/(f*o.trail/100),astep=f/o.lines;!function anim(){i++;for(var j=0;j<o.lines;j++)alpha=Math.max(1-(i+(o.lines-j)*astep)%f*ostep,o.opacity),self.opacity(el,j*o.direction+start,alpha,o);self.timeout=self.el&&setTimeout(anim,~~(1e3/fps))}()}return self},stop:function(){var el=this.el;return el&&(clearTimeout(this.timeout),el.parentNode&&el.parentNode.removeChild(el),this.el=void 0),this},lines:function(el,o){function fill(color,shadow){return css(createEl(),{position:"absolute",width:o.length+o.width+"px",height:o.width+"px",background:color,boxShadow:shadow,transformOrigin:"left",transform:"rotate("+~~(360/o.lines*i+o.rotate)+"deg) translate("+o.radius+"px,0)",borderRadius:(o.corners*o.width>>1)+"px"})}for(var seg,i=0,start=(o.lines-1)*(1-o.direction)/2;i<o.lines;i++)seg=css(createEl(),{position:"absolute",top:1+~(o.width/2)+"px",transform:o.hwaccel?"translate3d(0,0,0)":"",opacity:o.opacity,animation:useCssAnimations&&addAnimation(o.opacity,o.trail,start+i*o.direction,o.lines)+" "+1/o.speed+"s linear infinite"}),o.shadow&&ins(seg,css(fill("#000","0 0 4px #000"),{top:"2px"})),ins(el,ins(seg,fill(getColor(o.color,i),"0 0 1px rgba(0,0,0,.1)")));return el},opacity:function(el,i,val){i<el.childNodes.length&&(el.childNodes[i].style.opacity=val)}});var probe=css(createEl("group"),{behavior:"url(#default#VML)"});return!vendor(probe,"transform")&&probe.adj?initVML():useCssAnimations=vendor(probe,"animation"),Spinner}),"undefined"==typeof owl&&(owl={}),owl.pluralize=function(){function capitalizeSame(word,sampleWord){return sampleWord.match(/^[A-Z]/)?word.charAt(0).toUpperCase()+word.slice(1):word}function toKeys(keys){keys=keys.split(",");for(var keysLength=keys.length,table={},i=0;keysLength>i;i++)table[keys[i]]=1;return table}function pluralize(word,count,plural){if(""===word)return"";if(1===count)return word;if("string"==typeof plural)return plural;var lowerWord=word.toLowerCase();if(lowerWord in userDefined)return capitalizeSame(userDefined[lowerWord],word);if(word.match(/^[A-Z]$/))return word+"'s";if(word.match(/fish$|ois$|sheep$|deer$|pox$|itis$/i))return word;if(word.match(/^[A-Z][a-z]*ese$/))return word;if(lowerWord in uninflected)return word;if(lowerWord in irregular)return capitalizeSame(irregular[lowerWord],word);for(var suffixRulesLength=suffixRules.length,i=0;suffixRulesLength>i;i++){var rule=suffixRules[i];if(word.match(rule[0]))return word.replace(rule[0],rule[1])}return word+"s"}var userDefined={},uninflected=toKeys("aircraft,advice,blues,corn,molasses,equipment,gold,information,cotton,jewelry,kin,legislation,luck,luggage,moose,music,offspring,rice,silver,trousers,wheat,bison,bream,breeches,britches,carp,chassis,clippers,cod,contretemps,corps,debris,diabetes,djinn,eland,elk,flounder,gallows,graffiti,headquarters,herpes,high,homework,innings,jackanapes,mackerel,measles,mews,mumps,news,pincers,pliers,proceedings,rabies,salmon,scissors,sea,series,shears,species,swine,trout,tuna,whiting,wildebeest,pike,oats,tongs,dregs,snuffers,victuals,tweezers,vespers,pinchers,bellows,cattle"),irregular={I:"we",you:"you",he:"they",it:"they",me:"us",you:"you",him:"them",them:"them",myself:"ourselves",yourself:"yourselves",himself:"themselves",herself:"themselves",itself:"themselves",themself:"themselves",oneself:"oneselves",child:"children",dwarf:"dwarfs",mongoose:"mongooses",mythos:"mythoi",ox:"oxen",soliloquy:"soliloquies",trilby:"trilbys",person:"people",forum:"forums",syllabus:"syllabi",alumnus:"alumni",genus:"genera",viscus:"viscera",stigma:"stigmata"},suffixRules=[[/man$/i,"men"],[/([lm])ouse$/i,"$1ice"],[/tooth$/i,"teeth"],[/goose$/i,"geese"],[/foot$/i,"feet"],[/zoon$/i,"zoa"],[/([tcsx])is$/i,"$1es"],[/ix$/i,"ices"],[/^(cod|mur|sil|vert)ex$/i,"$1ices"],[/^(agend|addend|memorand|millenni|dat|extrem|bacteri|desiderat|strat|candelabr|errat|ov|symposi)um$/i,"$1a"],[/^(apheli|hyperbat|periheli|asyndet|noumen|phenomen|criteri|organ|prolegomen|\w+hedr)on$/i,"$1a"],[/^(alumn|alg|vertebr)a$/i,"$1ae"],[/([cs]h|ss|x)$/i,"$1es"],[/([aeo]l|[^d]ea|ar)f$/i,"$1ves"],[/([nlw]i)fe$/i,"$1ves"],[/([aeiou])y$/i,"$1ys"],[/(^[A-Z][a-z]*)y$/,"$1ys"],[/y$/i,"ies"],[/([aeiou])o$/i,"$1os"],[/^(pian|portic|albin|generalissim|manifest|archipelag|ghett|medic|armadill|guan|octav|command|infern|phot|ditt|jumb|pr|dynam|ling|quart|embry|lumbag|rhin|fiasc|magnet|styl|alt|contralt|sopran|bass|crescend|temp|cant|sol|kimon)o$/i,"$1os"],[/o$/i,"oes"],[/s$/i,"ses"]];return pluralize.define=function(word,plural){userDefined[word.toLowerCase()]=plural},pluralize}(),/*! messenger 1.3.3 */
function(){var localMessenger,_prevMessenger=window.Messenger;localMessenger=window.Messenger=function(){return localMessenger._call.apply(this,arguments)},window.Messenger.noConflict=function(){return window.Messenger=_prevMessenger,localMessenger}}(),/*
 * This file contains shims for when Underscore and Backbone
 * are not included.
 *
 * Portions taken from Underscore.js and Backbone.js
 * Both of which are Copyright (c) 2009-2013 Jeremy Ashkenas, DocumentCloud
 */
window.Messenger._=function(){if(window._)return window._;var ArrayProto=Array.prototype,ObjProto=Object.prototype,FuncProto=Function.prototype,slice=(ArrayProto.push,ArrayProto.slice),toString=(ArrayProto.concat,ObjProto.toString),nativeForEach=(ObjProto.hasOwnProperty,ArrayProto.forEach),nativeFilter=(ArrayProto.map,ArrayProto.reduce,ArrayProto.reduceRight,ArrayProto.filter),nativeKeys=(ArrayProto.every,ArrayProto.some,ArrayProto.indexOf,ArrayProto.lastIndexOf,Array.isArray,Object.keys),nativeBind=FuncProto.bind,_={},breaker={},each=_.each=_.forEach=function(obj,iterator,context){if(null!=obj)if(nativeForEach&&obj.forEach===nativeForEach)obj.forEach(iterator,context);else if(obj.length===+obj.length){for(var i=0,l=obj.length;l>i;i++)if(iterator.call(context,obj[i],i,obj)===breaker)return}else for(var key in obj)if(_.has(obj,key)&&iterator.call(context,obj[key],key,obj)===breaker)return};_.result=function(object,property){if(null==object)return null;var value=object[property];return _.isFunction(value)?value.call(object):value},_.once=function(func){var memo,ran=!1;return function(){return ran?memo:(ran=!0,memo=func.apply(this,arguments),func=null,memo)}};var idCounter=0;return _.uniqueId=function(prefix){var id=++idCounter+"";return prefix?prefix+id:id},_.filter=_.select=function(obj,iterator,context){var results=[];return null==obj?results:nativeFilter&&obj.filter===nativeFilter?obj.filter(iterator,context):(each(obj,function(value,index,list){iterator.call(context,value,index,list)&&(results[results.length]=value)}),results)},each(["Arguments","Function","String","Number","Date","RegExp"],function(name){_["is"+name]=function(obj){return toString.call(obj)=="[object "+name+"]"}}),_.defaults=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)null==obj[prop]&&(obj[prop]=source[prop])}),obj},_.extend=function(obj){return each(slice.call(arguments,1),function(source){if(source)for(var prop in source)obj[prop]=source[prop]}),obj},_.keys=nativeKeys||function(obj){if(obj!==Object(obj))throw new TypeError("Invalid object");var keys=[];for(var key in obj)_.has(obj,key)&&(keys[keys.length]=key);return keys},_.bind=function(func,context){if(func.bind===nativeBind&&nativeBind)return nativeBind.apply(func,slice.call(arguments,1));var args=slice.call(arguments,2);return function(){return func.apply(context,args.concat(slice.call(arguments)))}},_.isObject=function(obj){return obj===Object(obj)},_}(),window.Messenger.Events=function(){if(window.Backbone&&Backbone.Events)return Backbone.Events;var eventsShim=function(){var eventSplitter=/\s+/,eventsApi=function(obj,action,name,rest){if(!name)return!0;if("object"==typeof name)for(var key in name)obj[action].apply(obj,[key,name[key]].concat(rest));else{if(!eventSplitter.test(name))return!0;for(var names=name.split(eventSplitter),i=0,l=names.length;l>i;i++)obj[action].apply(obj,[names[i]].concat(rest))}},triggerEvents=function(events,args){var ev,i=-1,l=events.length;switch(args.length){case 0:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx);return;case 1:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,args[0]);return;case 2:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,args[0],args[1]);return;case 3:for(;++i<l;)(ev=events[i]).callback.call(ev.ctx,args[0],args[1],args[2]);return;default:for(;++i<l;)(ev=events[i]).callback.apply(ev.ctx,args)}},Events={on:function(name,callback,context){if(!eventsApi(this,"on",name,[callback,context])||!callback)return this;this._events||(this._events={});var list=this._events[name]||(this._events[name]=[]);return list.push({callback:callback,context:context,ctx:context||this}),this},once:function(name,callback,context){if(!eventsApi(this,"once",name,[callback,context])||!callback)return this;var self=this,once=_.once(function(){self.off(name,once),callback.apply(this,arguments)});return once._callback=callback,this.on(name,once,context),this},off:function(name,callback,context){var list,ev,events,names,i,l,j,k;if(!this._events||!eventsApi(this,"off",name,[callback,context]))return this;if(!name&&!callback&&!context)return this._events={},this;for(names=name?[name]:_.keys(this._events),i=0,l=names.length;l>i;i++)if(name=names[i],list=this._events[name]){if(events=[],callback||context)for(j=0,k=list.length;k>j;j++)ev=list[j],(callback&&callback!==ev.callback&&callback!==ev.callback._callback||context&&context!==ev.context)&&events.push(ev);this._events[name]=events}return this},trigger:function(name){if(!this._events)return this;var args=Array.prototype.slice.call(arguments,1);if(!eventsApi(this,"trigger",name,args))return this;var events=this._events[name],allEvents=this._events.all;return events&&triggerEvents(events,args),allEvents&&triggerEvents(allEvents,arguments),this},listenTo:function(obj,name,callback){var listeners=this._listeners||(this._listeners={}),id=obj._listenerId||(obj._listenerId=_.uniqueId("l"));return listeners[id]=obj,obj.on(name,"object"==typeof name?this:callback,this),this},stopListening:function(obj,name,callback){var listeners=this._listeners;if(listeners){if(obj)obj.off(name,"object"==typeof name?this:callback,this),name||callback||delete listeners[obj._listenerId];else{"object"==typeof name&&(callback=this);for(var id in listeners)listeners[id].off(name,callback,this);this._listeners={}}return this}}};return Events.bind=Events.on,Events.unbind=Events.off,Events};return eventsShim()}(),function(){var $,ActionMessenger,BaseView,Events,RetryingMessage,_,_Message,_Messenger,_ref,_ref1,_ref2,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},__slice=[].slice,__indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};$=jQuery,_=null!=(_ref=window._)?_ref:window.Messenger._,Events=null!=(_ref1="undefined"!=typeof Backbone&&null!==Backbone?Backbone.Events:void 0)?_ref1:window.Messenger.Events,BaseView=function(){function BaseView(options){$.extend(this,Events),_.isObject(options)&&(options.el&&this.setElement(options.el),this.model=options.model),this.initialize.apply(this,arguments)}return BaseView.prototype.setElement=function(el){return this.$el=$(el),this.el=this.$el[0]},BaseView.prototype.delegateEvents=function(events){var delegateEventSplitter,eventName,key,match,method,selector,_results;if(events||(events=_.result(this,"events"))){delegateEventSplitter=/^(\S+)\s*(.*)$/,this.undelegateEvents(),_results=[];for(key in events){if(method=events[key],_.isFunction(method)||(method=this[events[key]]),!method)throw new Error("Method "+events[key]+" does not exist");match=key.match(delegateEventSplitter),eventName=match[1],selector=match[2],method=_.bind(method,this),eventName+=".delegateEvents"+this.cid,""===selector?_results.push(this.$el.on(eventName,method)):_results.push(this.$el.on(eventName,selector,method))}return _results}},BaseView.prototype.undelegateEvents=function(){return this.$el.off(".delegateEvents"+this.cid)},BaseView.prototype.remove=function(){return this.undelegateEvents(),this.$el.remove()},BaseView}(),_Message=function(_super){function _Message(){return _Message.__super__.constructor.apply(this,arguments)}return __extends(_Message,_super),_Message.prototype.defaults={hideAfter:10,scroll:!0},_Message.prototype.initialize=function(opts){return null==opts&&(opts={}),this.shown=!1,this.rendered=!1,this.messenger=opts.messenger,this.options=$.extend({},this.options,opts,this.defaults)},_Message.prototype.show=function(){var wasShown;return this.rendered||this.render(),this.$message.removeClass("messenger-hidden"),wasShown=this.shown,this.shown=!0,wasShown?void 0:this.trigger("show")},_Message.prototype.hide=function(){var wasShown;if(this.rendered)return this.$message.addClass("messenger-hidden"),wasShown=this.shown,this.shown=!1,wasShown?this.trigger("hide"):void 0},_Message.prototype.cancel=function(){return this.hide()},_Message.prototype.update=function(opts){var _ref2,_this=this;return _.isString(opts)&&(opts={message:opts}),$.extend(this.options,opts),this.lastUpdate=new Date,this.rendered=!1,this.events=null!=(_ref2=this.options.events)?_ref2:{},this.render(),this.actionsToEvents(),this.delegateEvents(),this.checkClickable(),this.options.hideAfter?(this.$message.addClass("messenger-will-hide-after"),null!=this._hideTimeout&&clearTimeout(this._hideTimeout),this._hideTimeout=setTimeout(function(){return _this.hide()},1e3*this.options.hideAfter)):this.$message.removeClass("messenger-will-hide-after"),this.options.hideOnNavigate?(this.$message.addClass("messenger-will-hide-on-navigate"),null!=("undefined"!=typeof Backbone&&null!==Backbone?Backbone.history:void 0)&&Backbone.history.on("route",function(){return _this.hide()})):this.$message.removeClass("messenger-will-hide-on-navigate"),this.trigger("update",this)},_Message.prototype.scrollTo=function(){return this.options.scroll?$.scrollTo(this.$el,{duration:400,offset:{left:0,top:-20}}):void 0},_Message.prototype.timeSinceUpdate=function(){return this.lastUpdate?new Date-this.lastUpdate:null},_Message.prototype.actionsToEvents=function(){var act,name,_ref2,_results,_this=this;_ref2=this.options.actions,_results=[];for(name in _ref2)act=_ref2[name],_results.push(this.events['click [data-action="'+name+'"] a']=function(act){return function(e){return e.preventDefault(),e.stopPropagation(),_this.trigger("action:"+name,act,e),act.action.call(_this,e,_this)}}(act));return _results},_Message.prototype.checkClickable=function(){var evt,name,_ref2,_results;_ref2=this.events,_results=[];for(name in _ref2)evt=_ref2[name],"click"===name?_results.push(this.$message.addClass("messenger-clickable")):_results.push(void 0);return _results},_Message.prototype.undelegateEvents=function(){var _ref2;return _Message.__super__.undelegateEvents.apply(this,arguments),null!=(_ref2=this.$message)?_ref2.removeClass("messenger-clickable"):void 0},_Message.prototype.parseActions=function(){var act,actions,n_act,name,_ref2,_ref3;actions=[],_ref2=this.options.actions;for(name in _ref2)act=_ref2[name],n_act=$.extend({},act),n_act.name=name,null==(_ref3=n_act.label)&&(n_act.label=name),actions.push(n_act);return actions},_Message.prototype.template=function(opts){var $action,$actions,$cancel,$link,$message,$text,action,_i,_len,_ref2,_this=this;for($message=$("<div class='messenger-message message alert "+opts.type+" message-"+opts.type+" alert-"+opts.type+"'>"),$message.attr("role","alert"),opts.type&&$message.attr("aria-label",opts.type),opts.showCloseButton&&($cancel=$('<button type="button" class="close" data-dismiss="alert">&times;</button>'),$cancel.click(function(){return _this.cancel(),!0}),$message.append($cancel)),$text=$('<div class="messenger-message-inner">'+opts.message+"</div>"),$message.append($text),opts.actions.length&&($actions=$('<div class="messenger-actions">')),_ref2=opts.actions,_i=0,_len=_ref2.length;_len>_i;_i++)action=_ref2[_i],$action=$("<span>"),$action.attr("data-action",""+action.name),$link=$("<a>"),$link.html(action.label),$action.append($('<span class="messenger-phrase">')),$action.append($link),$actions.append($action);return $message.append($actions),$message},_Message.prototype.render=function(){var opts;if(!this.rendered)return this._hasSlot||(this.setElement(this.messenger._reserveMessageSlot(this)),this._hasSlot=!0),opts=$.extend({},this.options,{actions:this.parseActions()}),this.$message=$(this.template(opts)),this.$el.html(this.$message),this.shown=!0,this.rendered=!0,this.trigger("render")},_Message}(BaseView),RetryingMessage=function(_super){function RetryingMessage(){return RetryingMessage.__super__.constructor.apply(this,arguments)}return __extends(RetryingMessage,_super),RetryingMessage.prototype.initialize=function(){return RetryingMessage.__super__.initialize.apply(this,arguments),this._timers={}},RetryingMessage.prototype.cancel=function(){return this.clearTimers(),this.hide(),null!=this._actionInstance&&null!=this._actionInstance.abort?this._actionInstance.abort():void 0},RetryingMessage.prototype.clearTimers=function(){var name,timer,_ref2,_ref3;_ref2=this._timers;for(name in _ref2)timer=_ref2[name],clearTimeout(timer);return this._timers={},null!=(_ref3=this.$message)?_ref3.removeClass("messenger-retry-soon messenger-retry-later"):void 0},RetryingMessage.prototype.render=function(){var action,name,_ref2,_results;RetryingMessage.__super__.render.apply(this,arguments),this.clearTimers(),_ref2=this.options.actions,_results=[];for(name in _ref2)action=_ref2[name],action.auto?_results.push(this.startCountdown(name,action)):_results.push(void 0);return _results},RetryingMessage.prototype.renderPhrase=function(action,time){var phrase;return phrase=action.phrase.replace("TIME",this.formatTime(time))},RetryingMessage.prototype.formatTime=function(time){var pluralize;return pluralize=function(num,str){return num=Math.floor(num),1!==num&&(str+="s"),"in "+num+" "+str},0===Math.floor(time)?"now...":60>time?pluralize(time,"second"):(time/=60,60>time?pluralize(time,"minute"):(time/=60,pluralize(time,"hour")))},RetryingMessage.prototype.startCountdown=function(name,action){var $phrase,remaining,tick,_ref2,_this=this;if(null==this._timers[name])return $phrase=this.$message.find("[data-action='"+name+"'] .messenger-phrase"),remaining=null!=(_ref2=action.delay)?_ref2:3,10>=remaining?(this.$message.removeClass("messenger-retry-later"),this.$message.addClass("messenger-retry-soon")):(this.$message.removeClass("messenger-retry-soon"),this.$message.addClass("messenger-retry-later")),(tick=function(){var delta;return $phrase.text(_this.renderPhrase(action,remaining)),remaining>0?(delta=Math.min(remaining,1),remaining-=delta,_this._timers[name]=setTimeout(tick,1e3*delta)):(_this.$message.removeClass("messenger-retry-soon messenger-retry-later"),delete _this._timers[name],action.action())})()},RetryingMessage}(_Message),_Messenger=function(_super){function _Messenger(){return _Messenger.__super__.constructor.apply(this,arguments)}return __extends(_Messenger,_super),_Messenger.prototype.tagName="ul",_Messenger.prototype.className="messenger",_Messenger.prototype.messageDefaults={type:"info"},_Messenger.prototype.initialize=function(options){return this.options=null!=options?options:{},this.history=[],this.messageDefaults=$.extend({},this.messageDefaults,this.options.messageDefaults)},_Messenger.prototype.render=function(){return this.updateMessageSlotClasses()},_Messenger.prototype.findById=function(id){return _.filter(this.history,function(rec){return rec.msg.options.id===id})},_Messenger.prototype._reserveMessageSlot=function(msg){var $slot,dmsg,_this=this;for($slot=$("<li>"),$slot.addClass("messenger-message-slot"),this.$el.prepend($slot),this.history.push({msg:msg,$slot:$slot}),this._enforceIdConstraint(msg),msg.on("update",function(){return _this._enforceIdConstraint(msg)});this.options.maxMessages&&this.history.length>this.options.maxMessages;)dmsg=this.history.shift(),dmsg.msg.remove(),dmsg.$slot.remove();return $slot},_Messenger.prototype._enforceIdConstraint=function(msg){var entry,_i,_len,_msg,_ref2;if(null!=msg.options.id)for(_ref2=this.history,_i=0,_len=_ref2.length;_len>_i;_i++)if(entry=_ref2[_i],_msg=entry.msg,null!=_msg.options.id&&_msg.options.id===msg.options.id&&msg!==_msg){if(msg.options.singleton)return void msg.hide();_msg.hide()}},_Messenger.prototype.newMessage=function(opts){var msg,_ref2,_ref3,_ref4,_this=this;return null==opts&&(opts={}),opts.messenger=this,_Message=null!=(_ref2=null!=(_ref3=Messenger.themes[null!=(_ref4=opts.theme)?_ref4:this.options.theme])?_ref3.Message:void 0)?_ref2:RetryingMessage,msg=new _Message(opts),msg.on("show",function(){return opts.scrollTo&&"fixed"!==_this.$el.css("position")?msg.scrollTo():void 0}),msg.on("hide show render",this.updateMessageSlotClasses,this),msg},_Messenger.prototype.updateMessageSlotClasses=function(){var anyShown,last,rec,willBeFirst,_i,_len,_ref2;for(willBeFirst=!0,last=null,anyShown=!1,_ref2=this.history,_i=0,_len=_ref2.length;_len>_i;_i++)rec=_ref2[_i],rec.$slot.removeClass("messenger-first messenger-last messenger-shown"),rec.msg.shown&&rec.msg.rendered&&(rec.$slot.addClass("messenger-shown"),anyShown=!0,last=rec,willBeFirst&&(willBeFirst=!1,rec.$slot.addClass("messenger-first")));return null!=last&&last.$slot.addClass("messenger-last"),this.$el[""+(anyShown?"remove":"add")+"Class"]("messenger-empty")},_Messenger.prototype.hideAll=function(){var rec,_i,_len,_ref2,_results;for(_ref2=this.history,_results=[],_i=0,_len=_ref2.length;_len>_i;_i++)rec=_ref2[_i],_results.push(rec.msg.hide());return _results},_Messenger.prototype.post=function(opts){var msg;return _.isString(opts)&&(opts={message:opts}),opts=$.extend(!0,{},this.messageDefaults,opts),msg=this.newMessage(opts),msg.update(opts),msg},_Messenger}(BaseView),ActionMessenger=function(_super){function ActionMessenger(){return ActionMessenger.__super__.constructor.apply(this,arguments)}return __extends(ActionMessenger,_super),ActionMessenger.prototype.doDefaults={progressMessage:null,successMessage:null,errorMessage:"Error connecting to the server.",showSuccessWithoutError:!0,retry:{auto:!0,allow:!0},action:$.ajax},ActionMessenger.prototype.hookBackboneAjax=function(msgr_opts){var _ajax,_this=this;if(null==msgr_opts&&(msgr_opts={}),null==window.Backbone)throw"Expected Backbone to be defined";return msgr_opts=_.defaults(msgr_opts,{id:"BACKBONE_ACTION",errorMessage:!1,successMessage:"Request completed successfully.",showSuccessWithoutError:!1}),_ajax=function(options){var sync_msgr_opts;return sync_msgr_opts=_.extend({},msgr_opts,options.messenger),_this["do"](sync_msgr_opts,options)},null!=Backbone.ajax?(Backbone.ajax._withoutMessenger&&(Backbone.ajax=Backbone.ajax._withoutMessenger),(null==msgr_opts.action||msgr_opts.action===this.doDefaults.action)&&(msgr_opts.action=Backbone.ajax),_ajax._withoutMessenger=Backbone.ajax,Backbone.ajax=_ajax):Backbone.sync=_.wrap(Backbone.sync,function(){var args,_old_ajax,_old_sync;return _old_sync=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],_old_ajax=$.ajax,$.ajax=_ajax,_old_sync.call.apply(_old_sync,[this].concat(__slice.call(args))),$.ajax=_old_ajax})},ActionMessenger.prototype._getHandlerResponse=function(returnVal){return returnVal===!1?!1:returnVal===!0||null==returnVal?!0:returnVal},ActionMessenger.prototype._parseEvents=function(events){var desc,firstSpace,func,label,out,type,_ref2;null==events&&(events={}),out={};for(label in events)func=events[label],firstSpace=label.indexOf(" "),type=label.substring(0,firstSpace),desc=label.substring(firstSpace+1),null==(_ref2=out[type])&&(out[type]={}),out[type][desc]=func;return out},ActionMessenger.prototype._normalizeResponse=function(){var data,elem,resp,type,xhr,_i,_len;for(resp=1<=arguments.length?__slice.call(arguments,0):[],type=null,xhr=null,data=null,_i=0,_len=resp.length;_len>_i;_i++)elem=resp[_i],"success"===elem||"timeout"===elem||"abort"===elem?type=elem:null!=(null!=elem?elem.readyState:void 0)&&null!=(null!=elem?elem.responseText:void 0)?xhr=elem:_.isObject(elem)&&(data=elem);return[type,data,xhr]},ActionMessenger.prototype.run=function(){var args,attr,events,getMessageText,handler,handlers,m_opts,msg,old,opts,promiseAttrs,type,_i,_len,_ref2,_ref3,_this=this;if(m_opts=arguments[0],opts=arguments[1],args=3<=arguments.length?__slice.call(arguments,2):[],null==opts&&(opts={}),m_opts=$.extend(!0,{},this.messageDefaults,this.doDefaults,null!=m_opts?m_opts:{}),events=this._parseEvents(m_opts.events),getMessageText=function(type,xhr){var message;return message=m_opts[type+"Message"],_.isFunction(message)?message.call(_this,type,xhr):message},msg=null!=(_ref2=m_opts.messageInstance)?_ref2:this.newMessage(m_opts),null!=m_opts.id&&(msg.options.id=m_opts.id),null!=m_opts.progressMessage&&msg.update($.extend({},m_opts,{message:getMessageText("progress",null),type:"info"})),handlers={},_.each(["error","success"],function(type){return handlers[type]=function(){var data,defaultOpts,handlerResp,msgOpts,reason,resp,responseOpts,xhr,_base,_ref10,_ref3,_ref4,_ref5,_ref6,_ref7,_ref8,_ref9;return resp=1<=arguments.length?__slice.call(arguments,0):[],(null!=(_ref3=opts[type])?_ref3._originalHandler:void 0)&&(opts[type]=opts[type]._originalHandler),_ref4=_this._normalizeResponse.apply(_this,resp),reason=_ref4[0],data=_ref4[1],xhr=_ref4[2],"success"===type&&null==msg.errorCount&&m_opts.showSuccessWithoutError===!1&&(m_opts.successMessage=null),"error"===type&&(null==(_ref5=m_opts.errorCount)&&(m_opts.errorCount=0),m_opts.errorCount+=1),handlerResp=m_opts.returnsPromise?resp[0]:"function"==typeof(_base=opts[type])._originalHandler?_base._originalHandler.apply(_base,resp):void 0,responseOpts=_this._getHandlerResponse(handlerResp),_.isString(responseOpts)&&(responseOpts={message:responseOpts}),"error"!==type||0!==(null!=xhr?xhr.status:void 0)&&"abort"!==reason?"error"===type&&null!=m_opts.ignoredErrorCodes&&(_ref6=null!=xhr?xhr.status:void 0,__indexOf.call(m_opts.ignoredErrorCodes,_ref6)>=0)?void msg.hide():(defaultOpts={message:getMessageText(type,xhr),type:type,events:null!=(_ref7=events[type])?_ref7:{},hideOnNavigate:"success"===type},msgOpts=$.extend({},m_opts,defaultOpts,responseOpts),"number"==typeof(null!=(_ref8=msgOpts.retry)?_ref8.allow:void 0)&&msgOpts.retry.allow--,"error"===type&&(null!=xhr?xhr.status:void 0)>=500&&(null!=(_ref9=msgOpts.retry)?_ref9.allow:void 0)?(null==msgOpts.retry.delay&&(msgOpts.errorCount<4?msgOpts.retry.delay=10:msgOpts.retry.delay=300),msgOpts.hideAfter&&(null==(_ref10=msgOpts._hideAfter)&&(msgOpts._hideAfter=msgOpts.hideAfter),msgOpts.hideAfter=msgOpts._hideAfter+msgOpts.retry.delay),msgOpts._retryActions=!0,msgOpts.actions={retry:{label:"retry now",phrase:"Retrying TIME",auto:msgOpts.retry.auto,delay:msgOpts.retry.delay,action:function(){return msgOpts.messageInstance=msg,setTimeout(function(){return _this["do"].apply(_this,[msgOpts,opts].concat(__slice.call(args)))},0)}},cancel:{action:function(){return msg.cancel()}}}):msgOpts._retryActions&&(delete msgOpts.actions.retry,delete msgOpts.actions.cancel,delete m_opts._retryActions),msg.update(msgOpts),responseOpts&&msgOpts.message?(Messenger(),msg.show()):msg.hide()):void msg.hide()}}),!m_opts.returnsPromise)for(type in handlers)handler=handlers[type],old=opts[type],opts[type]=handler,opts[type]._originalHandler=old;for(msg._actionInstance=m_opts.action.apply(m_opts,[opts].concat(__slice.call(args))),m_opts.returnsPromise&&msg._actionInstance.then(handlers.success,handlers.error),promiseAttrs=["done","progress","fail","state","then"],_i=0,_len=promiseAttrs.length;_len>_i;_i++)attr=promiseAttrs[_i],null!=msg[attr]&&delete msg[attr],msg[attr]=null!=(_ref3=msg._actionInstance)?_ref3[attr]:void 0;return msg},ActionMessenger.prototype["do"]=ActionMessenger.prototype.run,ActionMessenger.prototype.ajax=function(){var args,m_opts;return m_opts=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],m_opts.action=$.ajax,this.run.apply(this,[m_opts].concat(__slice.call(args)))},ActionMessenger.prototype.expectPromise=function(action,m_opts){return m_opts=_.extend({},m_opts,{action:action,returnsPromise:!0}),this.run(m_opts)},ActionMessenger}(_Messenger),$.fn.messenger=function(){var $el,args,func,instance,opts,_ref2,_ref3,_ref4;return func=arguments[0],args=2<=arguments.length?__slice.call(arguments,1):[],null==func&&(func={}),$el=this,null!=func&&_.isString(func)?(_ref4=$el.data("messenger"))[func].apply(_ref4,args):(opts=func,null==$el.data("messenger")&&(_Messenger=null!=(_ref2=null!=(_ref3=Messenger.themes[opts.theme])?_ref3.Messenger:void 0)?_ref2:ActionMessenger,$el.data("messenger",instance=new _Messenger($.extend({el:$el},opts))),instance.render()),$el.data("messenger"))},window.Messenger._call=function(opts){var $el,$parent,choosen_loc,chosen_loc,classes,defaultOpts,inst,loc,locations,_i,_len;if(defaultOpts={extraClasses:"messenger-fixed messenger-on-bottom messenger-on-right",theme:"future",maxMessages:9,parentLocations:["body"]},opts=$.extend(defaultOpts,$._messengerDefaults,Messenger.options,opts),null!=opts.theme&&(opts.extraClasses+=" messenger-theme-"+opts.theme),inst=opts.instance||Messenger.instance,null==opts.instance){for(locations=opts.parentLocations,$parent=null,choosen_loc=null,_i=0,_len=locations.length;_len>_i;_i++)if(loc=locations[_i],$parent=$(loc),$parent.length){chosen_loc=loc;break}inst?$(inst._location)!==$(chosen_loc)&&(inst.$el.detach(),$parent.prepend(inst.$el)):($el=$("<ul>"),$parent.prepend($el),$el.attr("role","log"),$el.attr("aria-live","polite"),$el.attr("aria-relevant","additions"),inst=$el.messenger(opts),inst._location=chosen_loc,Messenger.instance=inst)}return null!=inst._addedClasses&&inst.$el.removeClass(inst._addedClasses),inst.$el.addClass(classes=""+inst.className+" "+opts.extraClasses),inst._addedClasses=classes,inst},$.extend(Messenger,{Message:RetryingMessage,Messenger:ActionMessenger,themes:null!=(_ref2=Messenger.themes)?_ref2:{}}),$.globalMessenger=window.Messenger=Messenger}.call(this),function(){var $,FutureMessage,spinner_template,__hasProp={}.hasOwnProperty,__extends=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)__hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child};$=jQuery,spinner_template='<div class="messenger-spinner">\n    <span class="messenger-spinner-side messenger-spinner-side-left">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n    <span class="messenger-spinner-side messenger-spinner-side-right">\n        <span class="messenger-spinner-fill"></span>\n    </span>\n</div>',FutureMessage=function(_super){function FutureMessage(){return FutureMessage.__super__.constructor.apply(this,arguments)}return __extends(FutureMessage,_super),FutureMessage.prototype.template=function(opts){var $message;return $message=FutureMessage.__super__.template.apply(this,arguments),$message.append($(spinner_template)),$message},FutureMessage}(window.Messenger.Message),window.Messenger.themes.future={Message:FutureMessage}}.call(this),function(global){"use strict";function _decode(string){for(var value,extra,output=[],counter=0,length=string.length;length>counter;)value=string.charCodeAt(counter++),55296==(63488&value)&&length>counter?(extra=string.charCodeAt(counter++),56320==(64512&extra)?output.push(((1023&value)<<10)+(1023&extra)+65536):output.push(value,extra)):output.push(value);return output}function _validateArguments(elements,callback){var elementsValid=elements&&("[object NodeList]"===Object.prototype.toString.call(elements)&&elements.length||1===elements.nodeType),callbackValid=callback&&"function"==typeof callback;return"console"in window&&"warn"in console&&(elementsValid||console.warn("Countable: No valid elements were found"),callbackValid||console.warn('Countable: "'+callback+'" is not a valid callback function')),elementsValid&&callbackValid}function _extendDefaults(options){var defaults={hardReturns:!1,stripTags:!1};for(var prop in options)defaults.hasOwnProperty(prop)&&(defaults[prop]=options[prop]);return defaults}function _count(element,options){var trimmed,original="value"in element?element.value:element.innerText||element.textContent;return options.stripTags&&(original=original.replace(/<\/?[a-z][^>]*>/gi,"")),trimmed=original.trim(),{paragraphs:trimmed?(trimmed.match(options.hardReturns?/\n{2,}/g:/\n+/g)||[]).length+1:0,words:trimmed?(trimmed.replace(/['";:,.?\xbf\-!\xa1]+/g,"").match(/\S+/g)||[]).length:0,characters:trimmed?_decode(trimmed.replace(/\s/g,"")).length:0,all:_decode(original.replace(/[\n\r]/g,"")).length}}function _loop(which,callback){var len=which.length;if("undefined"!=typeof len)for(;len--;)callback(which[len]);else callback(which)}var _liveElements=[],_event="oninput"in document?"input":"keyup";String.prototype.trim||(String.prototype.trim=function(){return this.replace(/^\s+|\s+$/g,"")});var Countable={live:function(elements,callback,options){var ops=_extendDefaults(options),bind=function(element){var handler=function(){callback.call(element,_count(element,ops))};_liveElements.push({element:element,handler:handler}),handler(),element.addEventListener?element.addEventListener(_event,handler,!1):element.attachEvent&&element.attachEvent("on"+_event,handler)};if(_validateArguments(elements,callback))return elements.length?_loop(elements,bind):bind(elements),this},die:function(elements){return _validateArguments(elements,function(){})?(_loop(elements,function(element){var liveElement;_loop(_liveElements,function(live){live.element===element&&(liveElement=live)}),liveElement&&(element.removeEventListener?element.removeEventListener(_event,liveElement.handler,!1):element.detachEvent&&element.detachEvent("on"+_event,liveElement.handler),_liveElements.splice(_liveElements.indexOf(liveElement),1))}),this):void 0},once:function(elements,callback,options){return _validateArguments(elements,callback)?(_loop(elements,function(element){callback.call(element,_count(element,_extendDefaults(options)))}),this):void 0},enabled:function(element){var isEnabled=!1;return element&&1===element.nodeType&&_loop(_liveElements,function(live){live.element===element&&(isEnabled=!0)}),isEnabled}};"object"==typeof exports?module.exports=Countable:"function"==typeof define&&define.amd?define(function(){return Countable}):global.Countable=Countable}(this),/*!
 * numeral.js
 * version : 1.5.3
 * author : Adam Draper
 * license : MIT
 * http://adamwdraper.github.com/Numeral-js/
 */
function(){function Numeral(number){this._value=number}function toFixed(value,precision,roundingFunction,optionals){var optionalsRegExp,output,power=Math.pow(10,precision);return output=(roundingFunction(value*power)/power).toFixed(precision),optionals&&(optionalsRegExp=new RegExp("0{1,"+optionals+"}$"),output=output.replace(optionalsRegExp,"")),output}function formatNumeral(n,format,roundingFunction){var output;return output=format.indexOf("$")>-1?formatCurrency(n,format,roundingFunction):format.indexOf("%")>-1?formatPercentage(n,format,roundingFunction):format.indexOf(":")>-1?formatTime(n,format):formatNumber(n._value,format,roundingFunction)}function unformatNumeral(n,string){var thousandRegExp,millionRegExp,billionRegExp,trillionRegExp,power,stringOriginal=string,suffixes=["KB","MB","GB","TB","PB","EB","ZB","YB"],bytesMultiplier=!1;if(string.indexOf(":")>-1)n._value=unformatTime(string);else if(string===zeroFormat)n._value=0;else{for("."!==languages[currentLanguage].delimiters.decimal&&(string=string.replace(/\./g,"").replace(languages[currentLanguage].delimiters.decimal,".")),thousandRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.thousand+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$"),millionRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.million+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$"),billionRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.billion+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$"),trillionRegExp=new RegExp("[^a-zA-Z]"+languages[currentLanguage].abbreviations.trillion+"(?:\\)|(\\"+languages[currentLanguage].currency.symbol+")?(?:\\))?)?$"),power=0;power<=suffixes.length&&!(bytesMultiplier=string.indexOf(suffixes[power])>-1?Math.pow(1024,power+1):!1);power++);n._value=(bytesMultiplier?bytesMultiplier:1)*(stringOriginal.match(thousandRegExp)?Math.pow(10,3):1)*(stringOriginal.match(millionRegExp)?Math.pow(10,6):1)*(stringOriginal.match(billionRegExp)?Math.pow(10,9):1)*(stringOriginal.match(trillionRegExp)?Math.pow(10,12):1)*(string.indexOf("%")>-1?.01:1)*((string.split("-").length+Math.min(string.split("(").length-1,string.split(")").length-1))%2?1:-1)*Number(string.replace(/[^0-9\.]+/g,"")),n._value=bytesMultiplier?Math.ceil(n._value):n._value}return n._value}function formatCurrency(n,format,roundingFunction){var spliceIndex,output,symbolIndex=format.indexOf("$"),openParenIndex=format.indexOf("("),minusSignIndex=format.indexOf("-"),space="";return format.indexOf(" $")>-1?(space=" ",format=format.replace(" $","")):format.indexOf("$ ")>-1?(space=" ",format=format.replace("$ ","")):format=format.replace("$",""),output=formatNumber(n._value,format,roundingFunction),1>=symbolIndex?output.indexOf("(")>-1||output.indexOf("-")>-1?(output=output.split(""),spliceIndex=1,(openParenIndex>symbolIndex||minusSignIndex>symbolIndex)&&(spliceIndex=0),output.splice(spliceIndex,0,languages[currentLanguage].currency.symbol+space),output=output.join("")):output=languages[currentLanguage].currency.symbol+space+output:output.indexOf(")")>-1?(output=output.split(""),output.splice(-1,0,space+languages[currentLanguage].currency.symbol),output=output.join("")):output=output+space+languages[currentLanguage].currency.symbol,output}function formatPercentage(n,format,roundingFunction){var output,space="",value=100*n._value;return format.indexOf(" %")>-1?(space=" ",format=format.replace(" %","")):format=format.replace("%",""),output=formatNumber(value,format,roundingFunction),output.indexOf(")")>-1?(output=output.split(""),output.splice(-1,0,space+"%"),output=output.join("")):output=output+space+"%",output}function formatTime(n){var hours=Math.floor(n._value/60/60),minutes=Math.floor((n._value-60*hours*60)/60),seconds=Math.round(n._value-60*hours*60-60*minutes);return hours+":"+(10>minutes?"0"+minutes:minutes)+":"+(10>seconds?"0"+seconds:seconds)}function unformatTime(string){var timeArray=string.split(":"),seconds=0;return 3===timeArray.length?(seconds+=60*Number(timeArray[0])*60,seconds+=60*Number(timeArray[1]),seconds+=Number(timeArray[2])):2===timeArray.length&&(seconds+=60*Number(timeArray[0]),seconds+=Number(timeArray[1])),Number(seconds)}function formatNumber(value,format,roundingFunction){var min,max,power,w,precision,thousands,negP=!1,signed=!1,optDec=!1,abbr="",abbrK=!1,abbrM=!1,abbrB=!1,abbrT=!1,abbrForce=!1,bytes="",ord="",abs=Math.abs(value),suffixes=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],d="",neg=!1;if(0===value&&null!==zeroFormat)return zeroFormat;if(format.indexOf("(")>-1?(negP=!0,format=format.slice(1,-1)):format.indexOf("+")>-1&&(signed=!0,format=format.replace(/\+/g,"")),format.indexOf("a")>-1&&(abbrK=format.indexOf("aK")>=0,abbrM=format.indexOf("aM")>=0,abbrB=format.indexOf("aB")>=0,abbrT=format.indexOf("aT")>=0,abbrForce=abbrK||abbrM||abbrB||abbrT,format.indexOf(" a")>-1?(abbr=" ",format=format.replace(" a","")):format=format.replace("a",""),abs>=Math.pow(10,12)&&!abbrForce||abbrT?(abbr+=languages[currentLanguage].abbreviations.trillion,value/=Math.pow(10,12)):abs<Math.pow(10,12)&&abs>=Math.pow(10,9)&&!abbrForce||abbrB?(abbr+=languages[currentLanguage].abbreviations.billion,value/=Math.pow(10,9)):abs<Math.pow(10,9)&&abs>=Math.pow(10,6)&&!abbrForce||abbrM?(abbr+=languages[currentLanguage].abbreviations.million,value/=Math.pow(10,6)):(abs<Math.pow(10,6)&&abs>=Math.pow(10,3)&&!abbrForce||abbrK)&&(abbr+=languages[currentLanguage].abbreviations.thousand,value/=Math.pow(10,3))),format.indexOf("b")>-1)for(format.indexOf(" b")>-1?(bytes=" ",format=format.replace(" b","")):format=format.replace("b",""),power=0;power<=suffixes.length;power++)if(min=Math.pow(1024,power),max=Math.pow(1024,power+1),value>=min&&max>value){bytes+=suffixes[power],min>0&&(value/=min);break}return format.indexOf("o")>-1&&(format.indexOf(" o")>-1?(ord=" ",format=format.replace(" o","")):format=format.replace("o",""),ord+=languages[currentLanguage].ordinal(value)),format.indexOf("[.]")>-1&&(optDec=!0,format=format.replace("[.]",".")),w=value.toString().split(".")[0],precision=format.split(".")[1],thousands=format.indexOf(","),precision?(precision.indexOf("[")>-1?(precision=precision.replace("]",""),precision=precision.split("["),d=toFixed(value,precision[0].length+precision[1].length,roundingFunction,precision[1].length)):d=toFixed(value,precision.length,roundingFunction),w=d.split(".")[0],d=d.split(".")[1].length?languages[currentLanguage].delimiters.decimal+d.split(".")[1]:"",optDec&&0===Number(d.slice(1))&&(d="")):w=toFixed(value,null,roundingFunction),w.indexOf("-")>-1&&(w=w.slice(1),neg=!0),thousands>-1&&(w=w.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g,"$1"+languages[currentLanguage].delimiters.thousands)),0===format.indexOf(".")&&(w=""),(negP&&neg?"(":"")+(!negP&&neg?"-":"")+(!neg&&signed?"+":"")+w+d+(ord?ord:"")+(abbr?abbr:"")+(bytes?bytes:"")+(negP&&neg?")":"")}function loadLanguage(key,values){languages[key]=values}function multiplier(x){var parts=x.toString().split(".");return parts.length<2?1:Math.pow(10,parts[1].length)}function correctionFactor(){var args=Array.prototype.slice.call(arguments);return args.reduce(function(prev,next){var mp=multiplier(prev),mn=multiplier(next);return mp>mn?mp:mn},-(1/0))}var numeral,VERSION="1.5.3",languages={},currentLanguage="en",zeroFormat=null,defaultFormat="0,0",hasModule="undefined"!=typeof module&&module.exports;numeral=function(input){return numeral.isNumeral(input)?input=input.value():0===input||"undefined"==typeof input?input=0:Number(input)||(input=numeral.fn.unformat(input)),new Numeral(Number(input))},numeral.version=VERSION,numeral.isNumeral=function(obj){return obj instanceof Numeral},numeral.language=function(key,values){if(!key)return currentLanguage;if(key&&!values){if(!languages[key])throw new Error("Unknown language : "+key);currentLanguage=key}return(values||!languages[key])&&loadLanguage(key,values),numeral},numeral.languageData=function(key){if(!key)return languages[currentLanguage];if(!languages[key])throw new Error("Unknown language : "+key);return languages[key]},numeral.language("en",{delimiters:{thousands:",",decimal:"."},abbreviations:{thousand:"k",million:"m",billion:"b",trillion:"t"},ordinal:function(number){var b=number%10;return 1===~~(number%100/10)?"th":1===b?"st":2===b?"nd":3===b?"rd":"th"},currency:{symbol:"$"}}),numeral.zeroFormat=function(format){zeroFormat="string"==typeof format?format:null},numeral.defaultFormat=function(format){defaultFormat="string"==typeof format?format:"0.0"},"function"!=typeof Array.prototype.reduce&&(Array.prototype.reduce=function(callback,opt_initialValue){"use strict";if(null===this||"undefined"==typeof this)throw new TypeError("Array.prototype.reduce called on null or undefined");if("function"!=typeof callback)throw new TypeError(callback+" is not a function");var index,value,length=this.length>>>0,isValueSet=!1;for(1<arguments.length&&(value=opt_initialValue,isValueSet=!0),index=0;length>index;++index)this.hasOwnProperty(index)&&(isValueSet?value=callback(value,this[index],index,this):(value=this[index],isValueSet=!0));if(!isValueSet)throw new TypeError("Reduce of empty array with no initial value");return value}),numeral.fn=Numeral.prototype={clone:function(){return numeral(this)},format:function(inputString,roundingFunction){return formatNumeral(this,inputString?inputString:defaultFormat,void 0!==roundingFunction?roundingFunction:Math.round)},unformat:function(inputString){return"[object Number]"===Object.prototype.toString.call(inputString)?inputString:unformatNumeral(this,inputString?inputString:defaultFormat)},value:function(){return this._value},valueOf:function(){return this._value},set:function(value){return this._value=Number(value),this},add:function(value){function cback(accum,curr,currI,O){return accum+corrFactor*curr}var corrFactor=correctionFactor.call(null,this._value,value);return this._value=[this._value,value].reduce(cback,0)/corrFactor,this},subtract:function(value){function cback(accum,curr,currI,O){return accum-corrFactor*curr}var corrFactor=correctionFactor.call(null,this._value,value);return this._value=[value].reduce(cback,this._value*corrFactor)/corrFactor,this},multiply:function(value){function cback(accum,curr,currI,O){var corrFactor=correctionFactor(accum,curr);return accum*corrFactor*(curr*corrFactor)/(corrFactor*corrFactor)}return this._value=[this._value,value].reduce(cback,1),this},divide:function(value){function cback(accum,curr,currI,O){var corrFactor=correctionFactor(accum,curr);return accum*corrFactor/(curr*corrFactor)}return this._value=[this._value,value].reduce(cback),this},difference:function(value){return Math.abs(numeral(this._value).subtract(value).value())}},hasModule&&(module.exports=numeral),"undefined"==typeof ender&&(this.numeral=numeral),"function"==typeof define&&define.amd&&define([],function(){return numeral})}.call(this),/*! @source https://gist.github.com/1129031 */
function(DOMParser){"use strict";var DOMParser_proto=DOMParser.prototype,real_parseFromString=DOMParser_proto.parseFromString;try{if((new DOMParser).parseFromString("","text/html"))return}catch(ex){}DOMParser_proto.parseFromString=function(markup,type){if(/^\s*text\/html\s*(?:;|$)/i.test(type)){var doc=document.implementation.createHTMLDocument("");return markup.toLowerCase().indexOf("<!doctype")>-1?doc.documentElement.innerHTML=markup:doc.body.innerHTML=markup,doc}return real_parseFromString.apply(this,arguments)}}(DOMParser);var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var n,r,i,s,o,u,a,t="",f=0;for(e=Base64._utf8_encode(e);f<e.length;)n=e.charCodeAt(f++),r=e.charCodeAt(f++),i=e.charCodeAt(f++),s=n>>2,o=(3&n)<<4|r>>4,u=(15&r)<<2|i>>6,a=63&i,isNaN(r)?u=a=64:isNaN(i)&&(a=64),t=t+this._keyStr.charAt(s)+this._keyStr.charAt(o)+this._keyStr.charAt(u)+this._keyStr.charAt(a);return t},decode:function(e){var n,r,i,s,o,u,a,t="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<e.length;)s=this._keyStr.indexOf(e.charAt(f++)),o=this._keyStr.indexOf(e.charAt(f++)),u=this._keyStr.indexOf(e.charAt(f++)),a=this._keyStr.indexOf(e.charAt(f++)),n=s<<2|o>>4,r=(15&o)<<4|u>>2,i=(3&u)<<6|a,t+=String.fromCharCode(n),64!=u&&(t+=String.fromCharCode(r)),64!=a&&(t+=String.fromCharCode(i));return t=Base64._utf8_decode(t)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);128>r?t+=String.fromCharCode(r):r>127&&2048>r?(t+=String.fromCharCode(r>>6|192),t+=String.fromCharCode(63&r|128)):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t="",n=0,r=c1=c2=0;n<e.length;)r=e.charCodeAt(n),128>r?(t+=String.fromCharCode(r),n++):r>191&&224>r?(c2=e.charCodeAt(n+1),t+=String.fromCharCode((31&r)<<6|63&c2),n+=2):(c2=e.charCodeAt(n+1),c3=e.charCodeAt(n+2),t+=String.fromCharCode((15&r)<<12|(63&c2)<<6|63&c3),n+=3);return t}};!function(){function require(path,parent,orig){var resolved=require.resolve(path);if(null==resolved){orig=orig||path,parent=parent||"root";var err=new Error('Failed to require "'+orig+'" from "'+parent+'"');throw err.path=orig,err.parent=parent,err.require=!0,err}var module=require.modules[resolved];if(!module._resolving&&!module.exports){var mod={};mod.exports={},mod.client=mod.component=!0,module._resolving=!0,module.call(this,mod.exports,require.relative(resolved),mod),delete module._resolving,module.exports=mod.exports}return module.exports}require.modules={},require.aliases={},require.resolve=function(path){"/"===path.charAt(0)&&(path=path.slice(1));for(var paths=[path,path+".js",path+".json",path+"/index.js",path+"/index.json"],i=0;i<paths.length;i++){var path=paths[i];if(require.modules.hasOwnProperty(path))return path;if(require.aliases.hasOwnProperty(path))return require.aliases[path]}},require.normalize=function(curr,path){var segs=[];if("."!=path.charAt(0))return path;curr=curr.split("/"),path=path.split("/");for(var i=0;i<path.length;++i)".."==path[i]?curr.pop():"."!=path[i]&&""!=path[i]&&segs.push(path[i]);return curr.concat(segs).join("/")},require.register=function(path,definition){require.modules[path]=definition},require.alias=function(from,to){if(!require.modules.hasOwnProperty(from))throw new Error('Failed to alias "'+from+'", it does not exist');require.aliases[to]=from},require.relative=function(parent){function lastIndexOf(arr,obj){for(var i=arr.length;i--;)if(arr[i]===obj)return i;return-1}function localRequire(path){var resolved=localRequire.resolve(path);return require(resolved,parent,path)}var p=require.normalize(parent,"..");return localRequire.resolve=function(path){var c=path.charAt(0);if("/"==c)return path.slice(1);if("."==c)return require.normalize(p,path);var segs=parent.split("/"),i=lastIndexOf(segs,"deps")+1;return i||(i=0),path=segs.slice(0,i+1).join("/")+"/deps/"+path},localRequire.exists=function(path){return require.modules.hasOwnProperty(localRequire.resolve(path))},localRequire},require.register("component-classes/index.js",function(exports,require,module){function ClassList(el){if(!el)throw new Error("A DOM element reference is required");this.el=el,this.list=el.classList}var index=require("indexof"),re=/\s+/,toString=Object.prototype.toString;module.exports=function(el){return new ClassList(el)},ClassList.prototype.add=function(name){if(this.list)return this.list.add(name),this;var arr=this.array(),i=index(arr,name);return~i||arr.push(name),this.el.className=arr.join(" "),this},ClassList.prototype.remove=function(name){if("[object RegExp]"==toString.call(name))return this.removeMatching(name);if(this.list)return this.list.remove(name),this;var arr=this.array(),i=index(arr,name);return~i&&arr.splice(i,1),this.el.className=arr.join(" "),this},ClassList.prototype.removeMatching=function(re){for(var arr=this.array(),i=0;i<arr.length;i++)re.test(arr[i])&&this.remove(arr[i]);return this},ClassList.prototype.toggle=function(name,force){return this.list?("undefined"!=typeof force?force!==this.list.toggle(name,force)&&this.list.toggle(name):this.list.toggle(name),this):("undefined"!=typeof force?force?this.add(name):this.remove(name):this.has(name)?this.remove(name):this.add(name),this)},ClassList.prototype.array=function(){var str=this.el.className.replace(/^\s+|\s+$/g,""),arr=str.split(re);return""===arr[0]&&arr.shift(),arr},ClassList.prototype.has=ClassList.prototype.contains=function(name){return this.list?this.list.contains(name):!!~index(this.array(),name)}}),require.register("segmentio-extend/index.js",function(exports,require,module){module.exports=function(object){for(var source,args=Array.prototype.slice.call(arguments,1),i=0;source=args[i];i++)if(source)for(var property in source)object[property]=source[property];return object}}),require.register("component-indexof/index.js",function(exports,require,module){module.exports=function(arr,obj){if(arr.indexOf)return arr.indexOf(obj);for(var i=0;i<arr.length;++i)if(arr[i]===obj)return i;return-1}}),require.register("component-event/index.js",function(exports,require,module){var bind=window.addEventListener?"addEventListener":"attachEvent",unbind=window.removeEventListener?"removeEventListener":"detachEvent",prefix="addEventListener"!==bind?"on":"";exports.bind=function(el,type,fn,capture){return el[bind](prefix+type,fn,capture||!1),fn},exports.unbind=function(el,type,fn,capture){return el[unbind](prefix+type,fn,capture||!1),fn}}),require.register("timoxley-to-array/index.js",function(exports,require,module){function isArray(arr){return"[object Array]"===Object.prototype.toString.call(arr)}module.exports=function(collection){if("undefined"==typeof collection)return[];if(null===collection)return[null];if(collection===window)return[window];if("string"==typeof collection)return[collection];if(isArray(collection))return collection;if("number"!=typeof collection.length)return[collection];if("function"==typeof collection&&collection instanceof Function)return[collection];for(var arr=[],i=0;i<collection.length;i++)(Object.prototype.hasOwnProperty.call(collection,i)||i in collection)&&arr.push(collection[i]);return arr.length?arr:[]}}),require.register("javve-events/index.js",function(exports,require,module){var events=require("event"),toArray=require("to-array");exports.bind=function(el,type,fn,capture){el=toArray(el);for(var i=0;i<el.length;i++)events.bind(el[i],type,fn,capture)},exports.unbind=function(el,type,fn,capture){el=toArray(el);for(var i=0;i<el.length;i++)events.unbind(el[i],type,fn,capture)}}),require.register("javve-get-by-class/index.js",function(exports,require,module){module.exports=function(){return document.getElementsByClassName?function(container,className,single){return single?container.getElementsByClassName(className)[0]:container.getElementsByClassName(className)}:document.querySelector?function(container,className,single){return className="."+className,single?container.querySelector(className):container.querySelectorAll(className)}:function(container,className,single){var classElements=[],tag="*";null==container&&(container=document);for(var els=container.getElementsByTagName(tag),elsLen=els.length,pattern=new RegExp("(^|\\s)"+className+"(\\s|$)"),i=0,j=0;elsLen>i;i++)if(pattern.test(els[i].className)){if(single)return els[i];classElements[j]=els[i],j++}return classElements}}()}),require.register("javve-get-attribute/index.js",function(exports,require,module){module.exports=function(el,attr){var result=el.getAttribute&&el.getAttribute(attr)||null;if(!result)for(var attrs=el.attributes,length=attrs.length,i=0;length>i;i++)void 0!==attr[i]&&attr[i].nodeName===attr&&(result=attr[i].nodeValue);return result}}),require.register("javve-natural-sort/index.js",function(exports,require,module){module.exports=function(a,b,options){var oFxNcL,oFyNcL,re=/(^-?[0-9]+(\.?[0-9]*)[df]?e?[0-9]?$|^0x[0-9a-f]+$|[0-9]+)/gi,sre=/(^[ ]*|[ ]*$)/g,dre=/(^([\w ]+,?[\w ]+)?[\w ]+,?[\w ]+\d+:\d+(:\d+)?[\w ]?|^\d{1,4}[\/\-]\d{1,4}[\/\-]\d{1,4}|^\w+, \w+ \d+, \d{4})/,hre=/^0x[0-9a-f]+$/i,ore=/^0/,options=options||{},i=function(s){return options.insensitive&&(""+s).toLowerCase()||""+s},x=i(a).replace(sre,"")||"",y=i(b).replace(sre,"")||"",xN=x.replace(re,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),yN=y.replace(re,"\x00$1\x00").replace(/\0$/,"").replace(/^\0/,"").split("\x00"),xD=parseInt(x.match(hre))||1!=xN.length&&x.match(dre)&&Date.parse(x),yD=parseInt(y.match(hre))||xD&&y.match(dre)&&Date.parse(y)||null,mult=options.desc?-1:1;if(yD){if(yD>xD)return-1*mult;if(xD>yD)return 1*mult}for(var cLoc=0,numS=Math.max(xN.length,yN.length);numS>cLoc;cLoc++){if(oFxNcL=!(xN[cLoc]||"").match(ore)&&parseFloat(xN[cLoc])||xN[cLoc]||0,oFyNcL=!(yN[cLoc]||"").match(ore)&&parseFloat(yN[cLoc])||yN[cLoc]||0,isNaN(oFxNcL)!==isNaN(oFyNcL))return isNaN(oFxNcL)?1:-1;if(typeof oFxNcL!=typeof oFyNcL&&(oFxNcL+="",oFyNcL+=""),oFyNcL>oFxNcL)return-1*mult;if(oFxNcL>oFyNcL)return 1*mult}return 0}}),require.register("javve-to-string/index.js",function(exports,require,module){module.exports=function(s){return s=void 0===s?"":s,s=null===s?"":s,s=s.toString()}}),require.register("component-type/index.js",function(exports,require,module){var toString=Object.prototype.toString;module.exports=function(val){switch(toString.call(val)){case"[object Date]":return"date";case"[object RegExp]":return"regexp";case"[object Arguments]":return"arguments";case"[object Array]":return"array";case"[object Error]":return"error"}return null===val?"null":void 0===val?"undefined":val!==val?"nan":val&&1===val.nodeType?"element":typeof val.valueOf()}}),require.register("list.js/index.js",function(exports,require,module){!function(window,undefined){"use strict";var document=window.document,getByClass=require("get-by-class"),extend=require("extend"),indexOf=require("indexof"),List=function(id,options,values){var init,self=this,Item=require("./src/item")(self),addAsync=require("./src/add-async")(self),parse=require("./src/parse")(self);init={start:function(){self.listClass="list",self.searchClass="search",self.sortClass="sort",self.page=200,self.i=1,self.items=[],self.visibleItems=[],self.matchingItems=[],self.searched=!1,self.filtered=!1,self.handlers={updated:[]},self.plugins={},self.helpers={getByClass:getByClass,extend:extend,indexOf:indexOf},extend(self,options),self.listContainer="string"==typeof id?document.getElementById(id):id,self.listContainer&&(self.list=getByClass(self.listContainer,self.listClass,!0),self.templater=require("./src/templater")(self),self.search=require("./src/search")(self),self.filter=require("./src/filter")(self),self.sort=require("./src/sort")(self),this.items(),self.update(),this.plugins())},items:function(){parse(self.list),values!==undefined&&self.add(values)},plugins:function(){for(var i=0;i<self.plugins.length;i++){var plugin=self.plugins[i];self[plugin.name]=plugin,plugin.init(self)}}},this.add=function(values,callback){if(callback)return void addAsync(values,callback);var added=[],notCreate=!1;values[0]===undefined&&(values=[values]);for(var i=0,il=values.length;il>i;i++){var item=null;values[i]instanceof Item?(item=values[i],item.reload()):(notCreate=self.items.length>self.page?!0:!1,item=new Item(values[i],undefined,notCreate)),self.items.push(item),added.push(item)}return self.update(),added},this.show=function(i,page){return this.i=i,this.page=page,self.update(),self},this.remove=function(valueName,value,options){for(var found=0,i=0,il=self.items.length;il>i;i++)self.items[i].values()[valueName]==value&&(self.templater.remove(self.items[i],options),self.items.splice(i,1),il--,i--,found++);return self.update(),found},this.get=function(valueName,value){for(var matchedItems=[],i=0,il=self.items.length;il>i;i++){var item=self.items[i];item.values()[valueName]==value&&matchedItems.push(item)}return matchedItems},this.size=function(){return self.items.length},this.clear=function(){return self.templater.clear(),self.items=[],self},this.on=function(event,callback){return self.handlers[event].push(callback),self},this.off=function(event,callback){var e=self.handlers[event],index=indexOf(e,callback);return index>-1&&e.splice(index,1),self},this.trigger=function(event){for(var i=self.handlers[event].length;i--;)self.handlers[event][i](self);return self},this.reset={filter:function(){for(var is=self.items,il=is.length;il--;)is[il].filtered=!1;return self},search:function(){for(var is=self.items,il=is.length;il--;)is[il].found=!1;return self}},this.update=function(){var is=self.items,il=is.length;self.visibleItems=[],self.matchingItems=[],self.templater.clear();for(var i=0;il>i;i++)is[i].matching()&&self.matchingItems.length+1>=self.i&&self.visibleItems.length<self.page?(is[i].show(),self.visibleItems.push(is[i]),self.matchingItems.push(is[i])):is[i].matching()?(self.matchingItems.push(is[i]),is[i].hide()):is[i].hide();return self.trigger("updated"),self},init.start()};module.exports=List}(window)}),require.register("list.js/src/search.js",function(exports,require,module){var events=require("events"),getByClass=require("get-by-class"),toString=require("to-string");module.exports=function(list){var text,columns,searchString,customSearch,prepare={resetList:function(){list.i=1,list.templater.clear(),customSearch=void 0},setOptions:function(args){2==args.length&&args[1]instanceof Array?columns=args[1]:2==args.length&&"function"==typeof args[1]?customSearch=args[1]:3==args.length&&(columns=args[1],customSearch=args[2])},setColumns:function(){columns=void 0===columns?prepare.toArray(list.items[0].values()):columns},setSearchString:function(s){s=toString(s).toLowerCase(),s=s.replace(/[-[\]{}()*+?.,\\^$|#]/g,"\\$&"),searchString=s},toArray:function(values){var tmpColumn=[];for(var name in values)tmpColumn.push(name);return tmpColumn}},search={list:function(){for(var k=0,kl=list.items.length;kl>k;k++)search.item(list.items[k])},item:function(item){item.found=!1;for(var j=0,jl=columns.length;jl>j;j++)if(search.values(item.values(),columns[j]))return void(item.found=!0)},values:function(values,column){return values.hasOwnProperty(column)&&(text=toString(values[column]).toLowerCase(),""!==searchString&&text.search(searchString)>-1)?!0:!1},reset:function(){list.reset.search(),list.searched=!1}},searchMethod=function(str){return list.trigger("searchStart"),prepare.resetList(),prepare.setSearchString(str),prepare.setOptions(arguments),prepare.setColumns(),""===searchString?search.reset():(list.searched=!0,customSearch?customSearch(searchString,columns):search.list()),list.update(),list.trigger("searchComplete"),list.visibleItems};return list.handlers.searchStart=list.handlers.searchStart||[],list.handlers.searchComplete=list.handlers.searchComplete||[],events.bind(getByClass(list.listContainer,list.searchClass),"keyup",function(e){var target=e.target||e.srcElement,alreadyCleared=""===target.value&&!list.searched;alreadyCleared||searchMethod(target.value)}),events.bind(getByClass(list.listContainer,list.searchClass),"input",function(e){var target=e.target||e.srcElement;""===target.value&&searchMethod("")}),list.helpers.toString=toString,searchMethod}}),require.register("list.js/src/sort.js",function(exports,require,module){var naturalSort=require("natural-sort"),classes=require("classes"),events=require("events"),getByClass=require("get-by-class"),getAttribute=require("get-attribute");module.exports=function(list){list.sortFunction=list.sortFunction||function(itemA,itemB,options){return options.desc="desc"==options.order?!0:!1,naturalSort(itemA.values()[options.valueName],itemB.values()[options.valueName],options)};var buttons={els:void 0,clear:function(){for(var i=0,il=buttons.els.length;il>i;i++)classes(buttons.els[i]).remove("asc"),classes(buttons.els[i]).remove("desc")},getOrder:function(btn){var predefinedOrder=getAttribute(btn,"data-order");return"asc"==predefinedOrder||"desc"==predefinedOrder?predefinedOrder:classes(btn).has("desc")?"asc":classes(btn).has("asc")?"desc":"asc"},getInSensitive:function(btn,options){var insensitive=getAttribute(btn,"data-insensitive");"true"===insensitive?options.insensitive=!0:options.insensitive=!1},setOrder:function(options){for(var i=0,il=buttons.els.length;il>i;i++){var btn=buttons.els[i];if(getAttribute(btn,"data-sort")===options.valueName){var predefinedOrder=getAttribute(btn,"data-order");"asc"==predefinedOrder||"desc"==predefinedOrder?predefinedOrder==options.order&&classes(btn).add(options.order):classes(btn).add(options.order)}}}},sort=function(){list.trigger("sortStart"),options={};var target=arguments[0].currentTarget||arguments[0].srcElement||void 0;target?(options.valueName=getAttribute(target,"data-sort"),buttons.getInSensitive(target,options),options.order=buttons.getOrder(target)):(options=arguments[1]||options,options.valueName=arguments[0],options.order=options.order||"asc",options.insensitive="undefined"==typeof options.insensitive?!0:options.insensitive),buttons.clear(),buttons.setOrder(options),options.sortFunction=options.sortFunction||list.sortFunction,list.items.sort(function(a,b){return options.sortFunction(a,b,options)}),list.update(),list.trigger("sortComplete")};return list.handlers.sortStart=list.handlers.sortStart||[],list.handlers.sortComplete=list.handlers.sortComplete||[],buttons.els=getByClass(list.listContainer,list.sortClass),events.bind(buttons.els,"click",sort),list.on("searchStart",buttons.clear),list.on("filterStart",buttons.clear),list.helpers.classes=classes,list.helpers.naturalSort=naturalSort,list.helpers.events=events,list.helpers.getAttribute=getAttribute,sort}}),require.register("list.js/src/item.js",function(exports,require,module){module.exports=function(list){return function(initValues,element,notCreate){var item=this;this._values={},this.found=!1,this.filtered=!1;var init=function(initValues,element,notCreate){if(void 0===element)notCreate?item.values(initValues,notCreate):item.values(initValues);else{item.elm=element;var values=list.templater.get(item,initValues);item.values(values)}};this.values=function(newValues,notCreate){if(void 0===newValues)return item._values;for(var name in newValues)item._values[name]=newValues[name];notCreate!==!0&&list.templater.set(item,item.values())},this.show=function(){list.templater.show(item)},this.hide=function(){list.templater.hide(item)},this.matching=function(){return list.filtered&&list.searched&&item.found&&item.filtered||list.filtered&&!list.searched&&item.filtered||!list.filtered&&list.searched&&item.found||!list.filtered&&!list.searched},this.visible=function(){return item.elm.parentNode==list.list?!0:!1},init(initValues,element,notCreate)}}}),require.register("list.js/src/templater.js",function(exports,require,module){var getByClass=require("get-by-class"),Templater=function(list){function getItemSource(item){if(void 0===item){for(var nodes=list.list.childNodes,i=0,il=nodes.length;il>i;i++)if(void 0===nodes[i].data)return nodes[i];return null}if(-1!==item.indexOf("<")){var div=document.createElement("div");return div.innerHTML=item,div.firstChild}return document.getElementById(list.item)}var itemSource=getItemSource(list.item),templater=this;this.get=function(item,valueNames){templater.create(item);for(var values={},i=0,il=valueNames.length;il>i;i++){var elm=getByClass(item.elm,valueNames[i],!0);values[valueNames[i]]=elm?elm.innerHTML:""}return values},this.set=function(item,values){if(!templater.create(item))for(var v in values)if(values.hasOwnProperty(v)){var elm=getByClass(item.elm,v,!0);elm&&("IMG"===elm.tagName&&""!==values[v]?elm.src=values[v]:elm.innerHTML=values[v])}},this.create=function(item){if(void 0!==item.elm)return!1;var newItem=itemSource.cloneNode(!0);return newItem.removeAttribute("id"),item.elm=newItem,templater.set(item,item.values()),!0},this.remove=function(item){list.list.removeChild(item.elm)},this.show=function(item){templater.create(item),list.list.appendChild(item.elm)},this.hide=function(item){void 0!==item.elm&&item.elm.parentNode===list.list&&list.list.removeChild(item.elm)},this.clear=function(){if(list.list.hasChildNodes())for(;list.list.childNodes.length>=1;)list.list.removeChild(list.list.firstChild)}};module.exports=function(list){return new Templater(list)}}),require.register("list.js/src/filter.js",function(exports,require,module){module.exports=function(list){return list.handlers.filterStart=list.handlers.filterStart||[],list.handlers.filterComplete=list.handlers.filterComplete||[],function(filterFunction){if(list.trigger("filterStart"),list.i=1,list.reset.filter(),void 0===filterFunction)list.filtered=!1;else{list.filtered=!0;for(var is=list.items,i=0,il=is.length;il>i;i++){var item=is[i];filterFunction(item)?item.filtered=!0:item.filtered=!1}}return list.update(),list.trigger("filterComplete"),list.visibleItems}}}),require.register("list.js/src/add-async.js",function(exports,require,module){module.exports=function(list){return function(values,callback,items){var valuesToAdd=values.splice(0,100);items=items||[],items=items.concat(list.add(valuesToAdd)),values.length>0?setTimeout(function(){addAsync(values,callback,items)},10):(list.update(),callback(items))}}}),require.register("list.js/src/parse.js",function(exports,require,module){module.exports=function(list){var Item=require("./item")(list),getChildren=function(parent){for(var nodes=parent.childNodes,items=[],i=0,il=nodes.length;il>i;i++)void 0===nodes[i].data&&items.push(nodes[i]);return items},parse=function(itemElements,valueNames){for(var i=0,il=itemElements.length;il>i;i++)list.items.push(new Item(valueNames,itemElements[i]))},parseAsync=function(itemElements,valueNames){var itemsToIndex=itemElements.splice(0,100);parse(itemsToIndex,valueNames),itemElements.length>0?setTimeout(function(){init.items.indexAsync(itemElements,valueNames)},10):list.update()};return function(){var itemsToIndex=getChildren(list.list),valueNames=list.valueNames;list.indexAsync?parseAsync(itemsToIndex,valueNames):parse(itemsToIndex,valueNames)}}}),require.alias("component-classes/index.js","list.js/deps/classes/index.js"),require.alias("component-classes/index.js","classes/index.js"),require.alias("component-indexof/index.js","component-classes/deps/indexof/index.js"),require.alias("segmentio-extend/index.js","list.js/deps/extend/index.js"),require.alias("segmentio-extend/index.js","extend/index.js"),require.alias("component-indexof/index.js","list.js/deps/indexof/index.js"),require.alias("component-indexof/index.js","indexof/index.js"),require.alias("javve-events/index.js","list.js/deps/events/index.js"),require.alias("javve-events/index.js","events/index.js"),require.alias("component-event/index.js","javve-events/deps/event/index.js"),require.alias("timoxley-to-array/index.js","javve-events/deps/to-array/index.js"),require.alias("javve-get-by-class/index.js","list.js/deps/get-by-class/index.js"),require.alias("javve-get-by-class/index.js","get-by-class/index.js"),require.alias("javve-get-attribute/index.js","list.js/deps/get-attribute/index.js"),require.alias("javve-get-attribute/index.js","get-attribute/index.js"),require.alias("javve-natural-sort/index.js","list.js/deps/natural-sort/index.js"),require.alias("javve-natural-sort/index.js","natural-sort/index.js"),require.alias("javve-to-string/index.js","list.js/deps/to-string/index.js"),require.alias("javve-to-string/index.js","list.js/deps/to-string/index.js"),require.alias("javve-to-string/index.js","to-string/index.js"),require.alias("javve-to-string/index.js","javve-to-string/index.js"),require.alias("component-type/index.js","list.js/deps/type/index.js"),require.alias("component-type/index.js","type/index.js"),"object"==typeof exports?module.exports=require("list.js"):"function"==typeof define&&define.amd?define(function(){return require("list.js")}):this.List=require("list.js")}(),/**
 * Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(factory,root){"function"==typeof define&&define.amd?define(factory):"undefined"!=typeof module&&"object"==typeof exports?module.exports=factory():root.rangy=factory()}(function(){function isHostMethod(o,p){var t=typeof o[p];return t==FUNCTION||!(t!=OBJECT||!o[p])||"unknown"==t}function isHostObject(o,p){return!(typeof o[p]!=OBJECT||!o[p])}function isHostProperty(o,p){return typeof o[p]!=UNDEFINED}function createMultiplePropertyTest(testFunc){return function(o,props){for(var i=props.length;i--;)if(!testFunc(o,props[i]))return!1;return!0}}function isTextRange(range){return range&&areHostMethods(range,textRangeMethods)&&areHostProperties(range,textRangeProperties)}function getBody(doc){return isHostObject(doc,"body")?doc.body:doc.getElementsByTagName("body")[0]}function consoleLog(msg){typeof console!=UNDEFINED&&isHostMethod(console,"log")&&console.log(msg)}function alertOrLog(msg,shouldAlert){isBrowser&&shouldAlert?alert(msg):consoleLog(msg)}function fail(reason){api.initialized=!0,api.supported=!1,alertOrLog("Rangy is not supported in this environment. Reason: "+reason,api.config.alertOnFail)}function warn(msg){alertOrLog("Rangy warning: "+msg,api.config.alertOnWarn)}function getErrorDesc(ex){return ex.message||ex.description||String(ex)}function init(){if(isBrowser&&!api.initialized){var testRange,implementsDomRange=!1,implementsTextRange=!1;isHostMethod(document,"createRange")&&(testRange=document.createRange(),areHostMethods(testRange,domRangeMethods)&&areHostProperties(testRange,domRangeProperties)&&(implementsDomRange=!0));var body=getBody(document);if(!body||"body"!=body.nodeName.toLowerCase())return void fail("No body element found");if(body&&isHostMethod(body,"createTextRange")&&(testRange=body.createTextRange(),isTextRange(testRange)&&(implementsTextRange=!0)),!implementsDomRange&&!implementsTextRange)return void fail("Neither Range nor TextRange are available");api.initialized=!0,api.features={implementsDomRange:implementsDomRange,implementsTextRange:implementsTextRange};var module,errorMessage;for(var moduleName in modules)(module=modules[moduleName])instanceof Module&&module.init(module,api);for(var i=0,len=initListeners.length;len>i;++i)try{initListeners[i](api)}catch(ex){errorMessage="Rangy init listener threw an exception. Continuing. Detail: "+getErrorDesc(ex),consoleLog(errorMessage)}}}function deprecationNotice(deprecated,replacement,module){module&&(deprecated+=" in module "+module.name),api.warn("DEPRECATED: "+deprecated+" is deprecated. Please use "+replacement+" instead.")}function createAliasForDeprecatedMethod(owner,deprecated,replacement,module){owner[deprecated]=function(){return deprecationNotice(deprecated,replacement,module),owner[replacement].apply(owner,util.toArray(arguments))}}function shim(win){win=win||window,init();for(var i=0,len=shimListeners.length;len>i;++i)shimListeners[i](win)}function Module(name,dependencies,initializer){this.name=name,this.dependencies=dependencies,this.initialized=!1,this.supported=!1,this.initializer=initializer}function createModule(name,dependencies,initFunc){var newModule=new Module(name,dependencies,function(module){if(!module.initialized){module.initialized=!0;try{initFunc(api,module),module.supported=!0}catch(ex){var errorMessage="Module '"+name+"' failed to load: "+getErrorDesc(ex);consoleLog(errorMessage),ex.stack&&consoleLog(ex.stack)}}});return modules[name]=newModule,newModule}function RangePrototype(){}function SelectionPrototype(){}var OBJECT="object",FUNCTION="function",UNDEFINED="undefined",domRangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],domRangeMethods=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],textRangeProperties=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],textRangeMethods=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],areHostMethods=createMultiplePropertyTest(isHostMethod),areHostObjects=createMultiplePropertyTest(isHostObject),areHostProperties=createMultiplePropertyTest(isHostProperty),forEach=[].forEach?function(arr,func){arr.forEach(func)}:function(arr,func){for(var i=0,len=arr.length;len>i;++i)func(arr[i],i)},modules={},isBrowser=typeof window!=UNDEFINED&&typeof document!=UNDEFINED,util={isHostMethod:isHostMethod,isHostObject:isHostObject,isHostProperty:isHostProperty,areHostMethods:areHostMethods,areHostObjects:areHostObjects,areHostProperties:areHostProperties,isTextRange:isTextRange,getBody:getBody,forEach:forEach},api={version:"1.3.0",initialized:!1,isBrowser:isBrowser,supported:!0,util:util,features:{},modules:modules,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==UNDEFINED?!0:rangyAutoInitialize}};api.fail=fail,api.warn=warn;var extend;({}).hasOwnProperty?(util.extend=extend=function(obj,props,deep){var o,p;for(var i in props)props.hasOwnProperty(i)&&(o=obj[i],p=props[i],deep&&null!==o&&"object"==typeof o&&null!==p&&"object"==typeof p&&extend(o,p,!0),obj[i]=p);return props.hasOwnProperty("toString")&&(obj.toString=props.toString),obj},util.createOptions=function(optionsParam,defaults){var options={};return extend(options,defaults),optionsParam&&extend(options,optionsParam),options}):fail("hasOwnProperty not supported"),isBrowser||fail("Rangy can only run in a browser"),function(){var toArray;if(isBrowser){var el=document.createElement("div");el.appendChild(document.createElement("span"));var slice=[].slice;try{1==slice.call(el.childNodes,0)[0].nodeType&&(toArray=function(arrayLike){return slice.call(arrayLike,0)})}catch(e){}}toArray||(toArray=function(arrayLike){for(var arr=[],i=0,len=arrayLike.length;len>i;++i)arr[i]=arrayLike[i];return arr}),util.toArray=toArray}();var addListener;isBrowser&&(isHostMethod(document,"addEventListener")?addListener=function(obj,eventType,listener){obj.addEventListener(eventType,listener,!1)}:isHostMethod(document,"attachEvent")?addListener=function(obj,eventType,listener){obj.attachEvent("on"+eventType,listener)}:fail("Document does not have required addEventListener or attachEvent method"),util.addListener=addListener);var initListeners=[];util.deprecationNotice=deprecationNotice,util.createAliasForDeprecatedMethod=createAliasForDeprecatedMethod,api.init=init,api.addInitListener=function(listener){api.initialized?listener(api):initListeners.push(listener)};var shimListeners=[];api.addShimListener=function(listener){shimListeners.push(listener)},isBrowser&&(api.shim=api.createMissingNativeApi=shim,createAliasForDeprecatedMethod(api,"createMissingNativeApi","shim")),Module.prototype={init:function(){for(var requiredModule,moduleName,requiredModuleNames=this.dependencies||[],i=0,len=requiredModuleNames.length;len>i;++i){if(moduleName=requiredModuleNames[i],requiredModule=modules[moduleName],!(requiredModule&&requiredModule instanceof Module))throw new Error("required module '"+moduleName+"' not found");if(requiredModule.init(),!requiredModule.supported)throw new Error("required module '"+moduleName+"' not supported")}this.initializer(this)},fail:function(reason){throw this.initialized=!0,this.supported=!1,new Error(reason)},warn:function(msg){api.warn("Module "+this.name+": "+msg)},deprecationNotice:function(deprecated,replacement){api.warn("DEPRECATED: "+deprecated+" in module "+this.name+" is deprecated. Please use "+replacement+" instead")},createError:function(msg){return new Error("Error in Rangy "+this.name+" module: "+msg)}},api.createModule=function(name){var initFunc,dependencies;2==arguments.length?(initFunc=arguments[1],dependencies=[]):(initFunc=arguments[2],dependencies=arguments[1]);var module=createModule(name,dependencies,initFunc);api.initialized&&api.supported&&module.init()},api.createCoreModule=function(name,dependencies,initFunc){createModule(name,dependencies,initFunc)},api.RangePrototype=RangePrototype,api.rangePrototype=new RangePrototype,api.selectionPrototype=new SelectionPrototype,api.createCoreModule("DomUtil",[],function(api,module){function isHtmlNamespace(node){var ns;return typeof node.namespaceURI==UNDEF||null===(ns=node.namespaceURI)||"http://www.w3.org/1999/xhtml"==ns}function parentElement(node){var parent=node.parentNode;return 1==parent.nodeType?parent:null}function getNodeIndex(node){for(var i=0;node=node.previousSibling;)++i;return i}function getNodeLength(node){switch(node.nodeType){case 7:case 10:return 0;case 3:case 8:return node.length;default:return node.childNodes.length}}function getCommonAncestor(node1,node2){var n,ancestors=[];for(n=node1;n;n=n.parentNode)ancestors.push(n);for(n=node2;n;n=n.parentNode)if(arrayContains(ancestors,n))return n;return null}function isAncestorOf(ancestor,descendant,selfIsAncestor){for(var n=selfIsAncestor?descendant:descendant.parentNode;n;){if(n===ancestor)return!0;n=n.parentNode}return!1}function isOrIsAncestorOf(ancestor,descendant){return isAncestorOf(ancestor,descendant,!0)}function getClosestAncestorIn(node,ancestor,selfIsAncestor){for(var p,n=selfIsAncestor?node:node.parentNode;n;){if(p=n.parentNode,p===ancestor)return n;n=p}return null}function isCharacterDataNode(node){var t=node.nodeType;return 3==t||4==t||8==t}function isTextOrCommentNode(node){if(!node)return!1;var t=node.nodeType;return 3==t||8==t}function insertAfter(node,precedingNode){var nextNode=precedingNode.nextSibling,parent=precedingNode.parentNode;return nextNode?parent.insertBefore(node,nextNode):parent.appendChild(node),node}function splitDataNode(node,index,positionsToPreserve){var newNode=node.cloneNode(!1);if(newNode.deleteData(0,index),node.deleteData(index,node.length-index),insertAfter(newNode,node),positionsToPreserve)for(var position,i=0;position=positionsToPreserve[i++];)position.node==node&&position.offset>index?(position.node=newNode,position.offset-=index):position.node==node.parentNode&&position.offset>getNodeIndex(node)&&++position.offset;return newNode}function getDocument(node){if(9==node.nodeType)return node;if(typeof node.ownerDocument!=UNDEF)return node.ownerDocument;if(typeof node.document!=UNDEF)return node.document;if(node.parentNode)return getDocument(node.parentNode);throw module.createError("getDocument: no document found for node")}function getWindow(node){var doc=getDocument(node);if(typeof doc.defaultView!=UNDEF)return doc.defaultView;if(typeof doc.parentWindow!=UNDEF)return doc.parentWindow;throw module.createError("Cannot get a window object for node")}function getIframeDocument(iframeEl){if(typeof iframeEl.contentDocument!=UNDEF)return iframeEl.contentDocument;if(typeof iframeEl.contentWindow!=UNDEF)return iframeEl.contentWindow.document;throw module.createError("getIframeDocument: No Document object found for iframe element")}function getIframeWindow(iframeEl){if(typeof iframeEl.contentWindow!=UNDEF)return iframeEl.contentWindow;if(typeof iframeEl.contentDocument!=UNDEF)return iframeEl.contentDocument.defaultView;throw module.createError("getIframeWindow: No Window object found for iframe element")}function isWindow(obj){return obj&&util.isHostMethod(obj,"setTimeout")&&util.isHostObject(obj,"document")}function getContentDocument(obj,module,methodName){var doc;if(obj?util.isHostProperty(obj,"nodeType")?doc=1==obj.nodeType&&"iframe"==obj.tagName.toLowerCase()?getIframeDocument(obj):getDocument(obj):isWindow(obj)&&(doc=obj.document):doc=document,!doc)throw module.createError(methodName+"(): Parameter must be a Window object or DOM node");return doc}function getRootContainer(node){for(var parent;parent=node.parentNode;)node=parent;return node}function comparePoints(nodeA,offsetA,nodeB,offsetB){var nodeC,root,childA,childB,n;if(nodeA==nodeB)return offsetA===offsetB?0:offsetB>offsetA?-1:1;if(nodeC=getClosestAncestorIn(nodeB,nodeA,!0))return offsetA<=getNodeIndex(nodeC)?-1:1;if(nodeC=getClosestAncestorIn(nodeA,nodeB,!0))return getNodeIndex(nodeC)<offsetB?-1:1;if(root=getCommonAncestor(nodeA,nodeB),!root)throw new Error("comparePoints error: nodes have no common ancestor");if(childA=nodeA===root?root:getClosestAncestorIn(nodeA,root,!0),childB=nodeB===root?root:getClosestAncestorIn(nodeB,root,!0),childA===childB)throw module.createError("comparePoints got to case 4 and childA and childB are the same!");for(n=root.firstChild;n;){if(n===childA)return-1;if(n===childB)return 1;n=n.nextSibling}}function isBrokenNode(node){var n;try{return n=node.parentNode,!1}catch(e){return!0}}function inspectNode(node){if(!node)return"[No node]";if(crashyTextNodes&&isBrokenNode(node))return"[Broken node]";if(isCharacterDataNode(node))return'"'+node.data+'"';if(1==node.nodeType){var idAttr=node.id?' id="'+node.id+'"':"";return"<"+node.nodeName+idAttr+">[index:"+getNodeIndex(node)+",length:"+node.childNodes.length+"]["+(node.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return node.nodeName}function fragmentFromNodeChildren(node){for(var child,fragment=getDocument(node).createDocumentFragment();child=node.firstChild;)fragment.appendChild(child);return fragment}function createTestElement(doc,html,contentEditable){var body=getBody(doc),el=doc.createElement("div");el.contentEditable=""+!!contentEditable,html&&(el.innerHTML=html);var bodyFirstChild=body.firstChild;return bodyFirstChild?body.insertBefore(el,bodyFirstChild):body.appendChild(el),el}function removeNode(node){return node.parentNode.removeChild(node)}function NodeIterator(root){this.root=root,this._next=root}function createIterator(root){return new NodeIterator(root)}function DomPosition(node,offset){this.node=node,this.offset=offset}function DOMException(codeName){this.code=this[codeName],this.codeName=codeName,this.message="DOMException: "+this.codeName}var UNDEF="undefined",util=api.util,getBody=util.getBody;util.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||module.fail("document missing a Node creation method"),util.isHostMethod(document,"getElementsByTagName")||module.fail("document missing getElementsByTagName method");var el=document.createElement("div");util.areHostMethods(el,["insertBefore","appendChild","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"]))||module.fail("Incomplete Element implementation"),util.isHostProperty(el,"innerHTML")||module.fail("Element is missing innerHTML property");var textNode=document.createTextNode("test");util.areHostMethods(textNode,["splitText","deleteData","insertData","appendData","cloneNode"]||!util.areHostObjects(el,["previousSibling","nextSibling","childNodes","parentNode"])||!util.areHostProperties(textNode,["data"]))||module.fail("Incomplete Text Node implementation");var arrayContains=function(arr,val){for(var i=arr.length;i--;)if(arr[i]===val)return!0;return!1},crashyTextNodes=!1;!function(){var el=document.createElement("b");el.innerHTML="1";var textNode=el.firstChild;el.innerHTML="<br />",crashyTextNodes=isBrokenNode(textNode),api.features.crashyTextNodes=crashyTextNodes}();var getComputedStyleProperty;typeof window.getComputedStyle!=UNDEF?getComputedStyleProperty=function(el,propName){return getWindow(el).getComputedStyle(el,null)[propName]}:typeof document.documentElement.currentStyle!=UNDEF?getComputedStyleProperty=function(el,propName){return el.currentStyle?el.currentStyle[propName]:""}:module.fail("No means of obtaining computed style properties found"),NodeIterator.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var child,next,n=this._current=this._next;if(this._current)if(child=n.firstChild)this._next=child;else{for(next=null;n!==this.root&&!(next=n.nextSibling);)n=n.parentNode;this._next=next}return this._current},detach:function(){this._current=this._next=this.root=null}},DomPosition.prototype={equals:function(pos){return!!pos&&this.node===pos.node&&this.offset==pos.offset},inspect:function(){return"[DomPosition("+inspectNode(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},DOMException.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},DOMException.prototype.toString=function(){return this.message},api.dom={arrayContains:arrayContains,isHtmlNamespace:isHtmlNamespace,parentElement:parentElement,getNodeIndex:getNodeIndex,getNodeLength:getNodeLength,getCommonAncestor:getCommonAncestor,isAncestorOf:isAncestorOf,isOrIsAncestorOf:isOrIsAncestorOf,getClosestAncestorIn:getClosestAncestorIn,isCharacterDataNode:isCharacterDataNode,isTextOrCommentNode:isTextOrCommentNode,insertAfter:insertAfter,splitDataNode:splitDataNode,getDocument:getDocument,getWindow:getWindow,getIframeWindow:getIframeWindow,getIframeDocument:getIframeDocument,getBody:getBody,isWindow:isWindow,getContentDocument:getContentDocument,getRootContainer:getRootContainer,comparePoints:comparePoints,isBrokenNode:isBrokenNode,inspectNode:inspectNode,getComputedStyleProperty:getComputedStyleProperty,createTestElement:createTestElement,removeNode:removeNode,fragmentFromNodeChildren:fragmentFromNodeChildren,createIterator:createIterator,DomPosition:DomPosition},api.DOMException=DOMException}),api.createCoreModule("DomRange",["DomUtil"],function(api,module){function isNonTextPartiallySelected(node,range){return 3!=node.nodeType&&(isOrIsAncestorOf(node,range.startContainer)||isOrIsAncestorOf(node,range.endContainer))}function getRangeDocument(range){return range.document||getDocument(range.startContainer)}function getRangeRoot(range){return getRootContainer(range.startContainer)}function getBoundaryBeforeNode(node){return new DomPosition(node.parentNode,getNodeIndex(node))}function getBoundaryAfterNode(node){return new DomPosition(node.parentNode,getNodeIndex(node)+1)}function insertNodeAtPosition(node,n,o){var firstNodeInserted=11==node.nodeType?node.firstChild:node;return isCharacterDataNode(n)?o==n.length?dom.insertAfter(node,n):n.parentNode.insertBefore(node,0==o?n:splitDataNode(n,o)):o>=n.childNodes.length?n.appendChild(node):n.insertBefore(node,n.childNodes[o]),firstNodeInserted}function rangesIntersect(rangeA,rangeB,touchingIsIntersecting){if(assertRangeValid(rangeA),assertRangeValid(rangeB),getRangeDocument(rangeB)!=getRangeDocument(rangeA))throw new DOMException("WRONG_DOCUMENT_ERR");var startComparison=comparePoints(rangeA.startContainer,rangeA.startOffset,rangeB.endContainer,rangeB.endOffset),endComparison=comparePoints(rangeA.endContainer,rangeA.endOffset,rangeB.startContainer,rangeB.startOffset);return touchingIsIntersecting?0>=startComparison&&endComparison>=0:0>startComparison&&endComparison>0}function cloneSubtree(iterator){for(var partiallySelected,node,subIterator,frag=getRangeDocument(iterator.range).createDocumentFragment();node=iterator.next();){if(partiallySelected=iterator.isPartiallySelectedSubtree(),node=node.cloneNode(!partiallySelected),partiallySelected&&(subIterator=iterator.getSubtreeIterator(),node.appendChild(cloneSubtree(subIterator)),subIterator.detach()),10==node.nodeType)throw new DOMException("HIERARCHY_REQUEST_ERR");frag.appendChild(node)}return frag}function iterateSubtree(rangeIterator,func,iteratorState){var it,n;iteratorState=iteratorState||{stop:!1};for(var node,subRangeIterator;node=rangeIterator.next();)if(rangeIterator.isPartiallySelectedSubtree()){if(func(node)===!1)return void(iteratorState.stop=!0);if(subRangeIterator=rangeIterator.getSubtreeIterator(),iterateSubtree(subRangeIterator,func,iteratorState),subRangeIterator.detach(),iteratorState.stop)return}else for(it=dom.createIterator(node);n=it.next();)if(func(n)===!1)return void(iteratorState.stop=!0)}function deleteSubtree(iterator){for(var subIterator;iterator.next();)iterator.isPartiallySelectedSubtree()?(subIterator=iterator.getSubtreeIterator(),deleteSubtree(subIterator),subIterator.detach()):iterator.remove()}function extractSubtree(iterator){for(var node,subIterator,frag=getRangeDocument(iterator.range).createDocumentFragment();node=iterator.next();){if(iterator.isPartiallySelectedSubtree()?(node=node.cloneNode(!1),subIterator=iterator.getSubtreeIterator(),node.appendChild(extractSubtree(subIterator)),subIterator.detach()):iterator.remove(),10==node.nodeType)throw new DOMException("HIERARCHY_REQUEST_ERR");frag.appendChild(node)}return frag}function getNodesInRange(range,nodeTypes,filter){var regex,filterNodeTypes=!(!nodeTypes||!nodeTypes.length),filterExists=!!filter;filterNodeTypes&&(regex=new RegExp("^("+nodeTypes.join("|")+")$"));var nodes=[];return iterateSubtree(new RangeIterator(range,!1),function(node){if((!filterNodeTypes||regex.test(node.nodeType))&&(!filterExists||filter(node))){var sc=range.startContainer;if(node!=sc||!isCharacterDataNode(sc)||range.startOffset!=sc.length){var ec=range.endContainer;node==ec&&isCharacterDataNode(ec)&&0==range.endOffset||nodes.push(node)}}}),nodes}function inspect(range){var name="undefined"==typeof range.getName?"Range":range.getName();return"["+name+"("+dom.inspectNode(range.startContainer)+":"+range.startOffset+", "+dom.inspectNode(range.endContainer)+":"+range.endOffset+")]"}function RangeIterator(range,clonePartiallySelectedTextNodes){if(this.range=range,this.clonePartiallySelectedTextNodes=clonePartiallySelectedTextNodes,!range.collapsed){this.sc=range.startContainer,this.so=range.startOffset,this.ec=range.endContainer,this.eo=range.endOffset;var root=range.commonAncestorContainer;this.sc===this.ec&&isCharacterDataNode(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==root||isCharacterDataNode(this.sc)?getClosestAncestorIn(this.sc,root,!0):this.sc.childNodes[this.so],this._last=this.ec!==root||isCharacterDataNode(this.ec)?getClosestAncestorIn(this.ec,root,!0):this.ec.childNodes[this.eo-1])}}function createAncestorFinder(nodeTypes){return function(node,selfIsAncestor){for(var t,n=selfIsAncestor?node:node.parentNode;n;){if(t=n.nodeType,arrayContains(nodeTypes,t))return n;n=n.parentNode}return null}}function assertNoDocTypeNotationEntityAncestor(node,allowSelf){if(getDocTypeNotationEntityAncestor(node,allowSelf))throw new DOMException("INVALID_NODE_TYPE_ERR")}function assertValidNodeType(node,invalidTypes){if(!arrayContains(invalidTypes,node.nodeType))throw new DOMException("INVALID_NODE_TYPE_ERR")}function assertValidOffset(node,offset){if(0>offset||offset>(isCharacterDataNode(node)?node.length:node.childNodes.length))throw new DOMException("INDEX_SIZE_ERR")}function assertSameDocumentOrFragment(node1,node2){if(getDocumentOrFragmentContainer(node1,!0)!==getDocumentOrFragmentContainer(node2,!0))throw new DOMException("WRONG_DOCUMENT_ERR")}function assertNodeNotReadOnly(node){if(getReadonlyAncestor(node,!0))throw new DOMException("NO_MODIFICATION_ALLOWED_ERR")}function assertNode(node,codeName){if(!node)throw new DOMException(codeName)}function isValidOffset(node,offset){return offset<=(isCharacterDataNode(node)?node.length:node.childNodes.length)}function isRangeValid(range){return!!range.startContainer&&!!range.endContainer&&!(crashyTextNodes&&(dom.isBrokenNode(range.startContainer)||dom.isBrokenNode(range.endContainer)))&&getRootContainer(range.startContainer)==getRootContainer(range.endContainer)&&isValidOffset(range.startContainer,range.startOffset)&&isValidOffset(range.endContainer,range.endOffset)}function assertRangeValid(range){if(!isRangeValid(range))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+range.inspect()+")")}function splitRangeBoundaries(range,positionsToPreserve){assertRangeValid(range);var sc=range.startContainer,so=range.startOffset,ec=range.endContainer,eo=range.endOffset,startEndSame=sc===ec;isCharacterDataNode(ec)&&eo>0&&eo<ec.length&&splitDataNode(ec,eo,positionsToPreserve),isCharacterDataNode(sc)&&so>0&&so<sc.length&&(sc=splitDataNode(sc,so,positionsToPreserve),startEndSame?(eo-=so,ec=sc):ec==sc.parentNode&&eo>=getNodeIndex(sc)&&eo++,so=0),range.setStartAndEnd(sc,so,ec,eo)}function rangeToHtml(range){assertRangeValid(range);var container=range.commonAncestorContainer.parentNode.cloneNode(!1);return container.appendChild(range.cloneContents()),container.innerHTML}function copyComparisonConstantsToObject(obj){obj.START_TO_START=s2s,obj.START_TO_END=s2e,obj.END_TO_END=e2e,obj.END_TO_START=e2s,obj.NODE_BEFORE=n_b,obj.NODE_AFTER=n_a,obj.NODE_BEFORE_AND_AFTER=n_b_a,obj.NODE_INSIDE=n_i}function copyComparisonConstants(constructor){copyComparisonConstantsToObject(constructor),copyComparisonConstantsToObject(constructor.prototype)}function createRangeContentRemover(remover,boundaryUpdater){return function(){assertRangeValid(this);var node,boundary,sc=this.startContainer,so=this.startOffset,root=this.commonAncestorContainer,iterator=new RangeIterator(this,!0);sc!==root&&(node=getClosestAncestorIn(sc,root,!0),boundary=getBoundaryAfterNode(node),sc=boundary.node,so=boundary.offset),iterateSubtree(iterator,assertNodeNotReadOnly),iterator.reset();var returnValue=remover(iterator);return iterator.detach(),boundaryUpdater(this,sc,so,sc,so),returnValue}}function createPrototypeRange(constructor,boundaryUpdater){function createBeforeAfterNodeSetter(isBefore,isStart){return function(node){assertValidNodeType(node,beforeAfterNodeTypes),assertValidNodeType(getRootContainer(node),rootContainerNodeTypes);var boundary=(isBefore?getBoundaryBeforeNode:getBoundaryAfterNode)(node);(isStart?setRangeStart:setRangeEnd)(this,boundary.node,boundary.offset)}}function setRangeStart(range,node,offset){var ec=range.endContainer,eo=range.endOffset;(node!==range.startContainer||offset!==range.startOffset)&&((getRootContainer(node)!=getRootContainer(ec)||1==comparePoints(node,offset,ec,eo))&&(ec=node,eo=offset),boundaryUpdater(range,node,offset,ec,eo))}function setRangeEnd(range,node,offset){var sc=range.startContainer,so=range.startOffset;(node!==range.endContainer||offset!==range.endOffset)&&((getRootContainer(node)!=getRootContainer(sc)||-1==comparePoints(node,offset,sc,so))&&(sc=node,so=offset),boundaryUpdater(range,sc,so,node,offset))}var F=function(){};F.prototype=api.rangePrototype,constructor.prototype=new F,util.extend(constructor.prototype,{setStart:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,!0),assertValidOffset(node,offset),setRangeStart(this,node,offset)},setEnd:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,!0),assertValidOffset(node,offset),setRangeEnd(this,node,offset)},setStartAndEnd:function(){var args=arguments,sc=args[0],so=args[1],ec=sc,eo=so;switch(args.length){case 3:eo=args[2];break;case 4:ec=args[2],eo=args[3]}boundaryUpdater(this,sc,so,ec,eo)},setBoundary:function(node,offset,isStart){this["set"+(isStart?"Start":"End")](node,offset)},setStartBefore:createBeforeAfterNodeSetter(!0,!0),setStartAfter:createBeforeAfterNodeSetter(!1,!0),setEndBefore:createBeforeAfterNodeSetter(!0,!1),setEndAfter:createBeforeAfterNodeSetter(!1,!1),collapse:function(isStart){assertRangeValid(this),isStart?boundaryUpdater(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):boundaryUpdater(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(node){assertNoDocTypeNotationEntityAncestor(node,!0),boundaryUpdater(this,node,0,node,getNodeLength(node))},selectNode:function(node){assertNoDocTypeNotationEntityAncestor(node,!1),assertValidNodeType(node,beforeAfterNodeTypes);var start=getBoundaryBeforeNode(node),end=getBoundaryAfterNode(node);boundaryUpdater(this,start.node,start.offset,end.node,end.offset)},extractContents:createRangeContentRemover(extractSubtree,boundaryUpdater),deleteContents:createRangeContentRemover(deleteSubtree,boundaryUpdater),canSurroundContents:function(){assertRangeValid(this),assertNodeNotReadOnly(this.startContainer),assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,!0),boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);return iterator.detach(),!boundariesInvalid},splitBoundaries:function(){splitRangeBoundaries(this)},splitBoundariesPreservingPositions:function(positionsToPreserve){splitRangeBoundaries(this,positionsToPreserve)},normalizeBoundaries:function(){assertRangeValid(this);var sibling,sc=this.startContainer,so=this.startOffset,ec=this.endContainer,eo=this.endOffset,mergeForward=function(node){var sibling=node.nextSibling;sibling&&sibling.nodeType==node.nodeType&&(ec=node,eo=node.length,node.appendData(sibling.data),removeNode(sibling))},mergeBackward=function(node){var sibling=node.previousSibling;if(sibling&&sibling.nodeType==node.nodeType){sc=node;var nodeLength=node.length;if(so=sibling.length,node.insertData(0,sibling.data),removeNode(sibling),sc==ec)eo+=so,ec=sc;else if(ec==node.parentNode){var nodeIndex=getNodeIndex(node);eo==nodeIndex?(ec=node,eo=nodeLength):eo>nodeIndex&&eo--}}},normalizeStart=!0;if(isCharacterDataNode(ec))eo==ec.length?mergeForward(ec):0==eo&&(sibling=ec.previousSibling,sibling&&sibling.nodeType==ec.nodeType&&(eo=sibling.length,sc==ec&&(normalizeStart=!1),sibling.appendData(ec.data),removeNode(ec),ec=sibling));else{if(eo>0){var endNode=ec.childNodes[eo-1];endNode&&isCharacterDataNode(endNode)&&mergeForward(endNode)}normalizeStart=!this.collapsed}if(normalizeStart){if(isCharacterDataNode(sc))0==so?mergeBackward(sc):so==sc.length&&(sibling=sc.nextSibling,sibling&&sibling.nodeType==sc.nodeType&&(ec==sibling&&(ec=sc,eo+=sc.length),sc.appendData(sibling.data),removeNode(sibling)));else if(so<sc.childNodes.length){var startNode=sc.childNodes[so];startNode&&isCharacterDataNode(startNode)&&mergeBackward(startNode)}}else sc=ec,so=eo;boundaryUpdater(this,sc,so,ec,eo)},collapseToPoint:function(node,offset){assertNoDocTypeNotationEntityAncestor(node,!0),assertValidOffset(node,offset),this.setStartAndEnd(node,offset)}}),copyComparisonConstants(constructor)}function updateCollapsedAndCommonAncestor(range){range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset,range.commonAncestorContainer=range.collapsed?range.startContainer:dom.getCommonAncestor(range.startContainer,range.endContainer)}function updateBoundaries(range,startContainer,startOffset,endContainer,endOffset){range.startContainer=startContainer,range.startOffset=startOffset,range.endContainer=endContainer,range.endOffset=endOffset,range.document=dom.getDocument(startContainer),updateCollapsedAndCommonAncestor(range)}function Range(doc){this.startContainer=doc,this.startOffset=0,this.endContainer=doc,this.endOffset=0,this.document=doc,updateCollapsedAndCommonAncestor(this)}var dom=api.dom,util=api.util,DomPosition=dom.DomPosition,DOMException=api.DOMException,isCharacterDataNode=dom.isCharacterDataNode,getNodeIndex=dom.getNodeIndex,isOrIsAncestorOf=dom.isOrIsAncestorOf,getDocument=dom.getDocument,comparePoints=dom.comparePoints,splitDataNode=dom.splitDataNode,getClosestAncestorIn=dom.getClosestAncestorIn,getNodeLength=dom.getNodeLength,arrayContains=dom.arrayContains,getRootContainer=dom.getRootContainer,crashyTextNodes=api.features.crashyTextNodes,removeNode=dom.removeNode;RangeIterator.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var current=this._current=this._next;return current&&(this._next=current!==this._last?current.nextSibling:null,isCharacterDataNode(current)&&this.clonePartiallySelectedTextNodes&&(current===this.ec&&(current=current.cloneNode(!0)).deleteData(this.eo,current.length-this.eo),this._current===this.sc&&(current=current.cloneNode(!0)).deleteData(0,this.so))),current},remove:function(){var start,end,current=this._current;!isCharacterDataNode(current)||current!==this.sc&&current!==this.ec?current.parentNode&&removeNode(current):(start=current===this.sc?this.so:0,end=current===this.ec?this.eo:current.length,start!=end&&current.deleteData(start,end-start))},isPartiallySelectedSubtree:function(){var current=this._current;return isNonTextPartiallySelected(current,this.range)},getSubtreeIterator:function(){var subRange;if(this.isSingleCharacterDataNode)subRange=this.range.cloneRange(),subRange.collapse(!1);else{subRange=new Range(getRangeDocument(this.range));var current=this._current,startContainer=current,startOffset=0,endContainer=current,endOffset=getNodeLength(current);isOrIsAncestorOf(current,this.sc)&&(startContainer=this.sc,startOffset=this.so),
isOrIsAncestorOf(current,this.ec)&&(endContainer=this.ec,endOffset=this.eo),updateBoundaries(subRange,startContainer,startOffset,endContainer,endOffset)}return new RangeIterator(subRange,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var beforeAfterNodeTypes=[1,3,4,5,7,8,10],rootContainerNodeTypes=[2,9,11],readonlyNodeTypes=[5,6,10,12],insertableNodeTypes=[1,3,4,5,7,8,10,11],surroundNodeTypes=[1,3,4,5,7,8],getDocumentOrFragmentContainer=createAncestorFinder([9,11]),getReadonlyAncestor=createAncestorFinder(readonlyNodeTypes),getDocTypeNotationEntityAncestor=createAncestorFinder([6,10,12]),styleEl=document.createElement("style"),htmlParsingConforms=!1;try{styleEl.innerHTML="<b>x</b>",htmlParsingConforms=3==styleEl.firstChild.nodeType}catch(e){}api.features.htmlParsingConforms=htmlParsingConforms;var createContextualFragment=htmlParsingConforms?function(fragmentStr){var node=this.startContainer,doc=getDocument(node);if(!node)throw new DOMException("INVALID_STATE_ERR");var el=null;return 1==node.nodeType?el=node:isCharacterDataNode(node)&&(el=dom.parentElement(node)),el=null===el||"HTML"==el.nodeName&&dom.isHtmlNamespace(getDocument(el).documentElement)&&dom.isHtmlNamespace(el)?doc.createElement("body"):el.cloneNode(!1),el.innerHTML=fragmentStr,dom.fragmentFromNodeChildren(el)}:function(fragmentStr){var doc=getRangeDocument(this),el=doc.createElement("body");return el.innerHTML=fragmentStr,dom.fragmentFromNodeChildren(el)},rangeProperties=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],s2s=0,s2e=1,e2e=2,e2s=3,n_b=0,n_a=1,n_b_a=2,n_i=3;util.extend(api.rangePrototype,{compareBoundaryPoints:function(how,range){assertRangeValid(this),assertSameDocumentOrFragment(this.startContainer,range.startContainer);var nodeA,offsetA,nodeB,offsetB,prefixA=how==e2s||how==s2s?"start":"end",prefixB=how==s2e||how==s2s?"start":"end";return nodeA=this[prefixA+"Container"],offsetA=this[prefixA+"Offset"],nodeB=range[prefixB+"Container"],offsetB=range[prefixB+"Offset"],comparePoints(nodeA,offsetA,nodeB,offsetB)},insertNode:function(node){if(assertRangeValid(this),assertValidNodeType(node,insertableNodeTypes),assertNodeNotReadOnly(this.startContainer),isOrIsAncestorOf(node,this.startContainer))throw new DOMException("HIERARCHY_REQUEST_ERR");var firstNodeInserted=insertNodeAtPosition(node,this.startContainer,this.startOffset);this.setStartBefore(firstNodeInserted)},cloneContents:function(){assertRangeValid(this);var clone,frag;if(this.collapsed)return getRangeDocument(this).createDocumentFragment();if(this.startContainer===this.endContainer&&isCharacterDataNode(this.startContainer))return clone=this.startContainer.cloneNode(!0),clone.data=clone.data.slice(this.startOffset,this.endOffset),frag=getRangeDocument(this).createDocumentFragment(),frag.appendChild(clone),frag;var iterator=new RangeIterator(this,!0);return clone=cloneSubtree(iterator),iterator.detach(),clone},canSurroundContents:function(){assertRangeValid(this),assertNodeNotReadOnly(this.startContainer),assertNodeNotReadOnly(this.endContainer);var iterator=new RangeIterator(this,!0),boundariesInvalid=iterator._first&&isNonTextPartiallySelected(iterator._first,this)||iterator._last&&isNonTextPartiallySelected(iterator._last,this);return iterator.detach(),!boundariesInvalid},surroundContents:function(node){if(assertValidNodeType(node,surroundNodeTypes),!this.canSurroundContents())throw new DOMException("INVALID_STATE_ERR");var content=this.extractContents();if(node.hasChildNodes())for(;node.lastChild;)node.removeChild(node.lastChild);insertNodeAtPosition(node,this.startContainer,this.startOffset),node.appendChild(content),this.selectNode(node)},cloneRange:function(){assertRangeValid(this);for(var prop,range=new Range(getRangeDocument(this)),i=rangeProperties.length;i--;)prop=rangeProperties[i],range[prop]=this[prop];return range},toString:function(){assertRangeValid(this);var sc=this.startContainer;if(sc===this.endContainer&&isCharacterDataNode(sc))return 3==sc.nodeType||4==sc.nodeType?sc.data.slice(this.startOffset,this.endOffset):"";var textParts=[],iterator=new RangeIterator(this,!0);return iterateSubtree(iterator,function(node){(3==node.nodeType||4==node.nodeType)&&textParts.push(node.data)}),iterator.detach(),textParts.join("")},compareNode:function(node){assertRangeValid(this);var parent=node.parentNode,nodeIndex=getNodeIndex(node);if(!parent)throw new DOMException("NOT_FOUND_ERR");var startComparison=this.comparePoint(parent,nodeIndex),endComparison=this.comparePoint(parent,nodeIndex+1);return 0>startComparison?endComparison>0?n_b_a:n_b:endComparison>0?n_a:n_i},comparePoint:function(node,offset){return assertRangeValid(this),assertNode(node,"HIERARCHY_REQUEST_ERR"),assertSameDocumentOrFragment(node,this.startContainer),comparePoints(node,offset,this.startContainer,this.startOffset)<0?-1:comparePoints(node,offset,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:createContextualFragment,toHtml:function(){return rangeToHtml(this)},intersectsNode:function(node,touchingIsIntersecting){if(assertRangeValid(this),getRootContainer(node)!=getRangeRoot(this))return!1;var parent=node.parentNode,offset=getNodeIndex(node);if(!parent)return!0;var startComparison=comparePoints(parent,offset,this.endContainer,this.endOffset),endComparison=comparePoints(parent,offset+1,this.startContainer,this.startOffset);return touchingIsIntersecting?0>=startComparison&&endComparison>=0:0>startComparison&&endComparison>0},isPointInRange:function(node,offset){return assertRangeValid(this),assertNode(node,"HIERARCHY_REQUEST_ERR"),assertSameDocumentOrFragment(node,this.startContainer),comparePoints(node,offset,this.startContainer,this.startOffset)>=0&&comparePoints(node,offset,this.endContainer,this.endOffset)<=0},intersectsRange:function(range){return rangesIntersect(this,range,!1)},intersectsOrTouchesRange:function(range){return rangesIntersect(this,range,!0)},intersection:function(range){if(this.intersectsRange(range)){var startComparison=comparePoints(this.startContainer,this.startOffset,range.startContainer,range.startOffset),endComparison=comparePoints(this.endContainer,this.endOffset,range.endContainer,range.endOffset),intersectionRange=this.cloneRange();return-1==startComparison&&intersectionRange.setStart(range.startContainer,range.startOffset),1==endComparison&&intersectionRange.setEnd(range.endContainer,range.endOffset),intersectionRange}return null},union:function(range){if(this.intersectsOrTouchesRange(range)){var unionRange=this.cloneRange();return-1==comparePoints(range.startContainer,range.startOffset,this.startContainer,this.startOffset)&&unionRange.setStart(range.startContainer,range.startOffset),1==comparePoints(range.endContainer,range.endOffset,this.endContainer,this.endOffset)&&unionRange.setEnd(range.endContainer,range.endOffset),unionRange}throw new DOMException("Ranges do not intersect")},containsNode:function(node,allowPartial){return allowPartial?this.intersectsNode(node,!1):this.compareNode(node)==n_i},containsNodeContents:function(node){return this.comparePoint(node,0)>=0&&this.comparePoint(node,getNodeLength(node))<=0},containsRange:function(range){var intersection=this.intersection(range);return null!==intersection&&range.equals(intersection)},containsNodeText:function(node){var nodeRange=this.cloneRange();nodeRange.selectNode(node);var textNodes=nodeRange.getNodes([3]);if(textNodes.length>0){nodeRange.setStart(textNodes[0],0);var lastTextNode=textNodes.pop();return nodeRange.setEnd(lastTextNode,lastTextNode.length),this.containsRange(nodeRange)}return this.containsNodeContents(node)},getNodes:function(nodeTypes,filter){return assertRangeValid(this),getNodesInRange(this,nodeTypes,filter)},getDocument:function(){return getRangeDocument(this)},collapseBefore:function(node){this.setEndBefore(node),this.collapse(!1)},collapseAfter:function(node){this.setStartAfter(node),this.collapse(!0)},getBookmark:function(containerNode){var doc=getRangeDocument(this),preSelectionRange=api.createRange(doc);containerNode=containerNode||dom.getBody(doc),preSelectionRange.selectNodeContents(containerNode);var range=this.intersection(preSelectionRange),start=0,end=0;return range&&(preSelectionRange.setEnd(range.startContainer,range.startOffset),start=preSelectionRange.toString().length,end=start+range.toString().length),{start:start,end:end,containerNode:containerNode}},moveToBookmark:function(bookmark){var containerNode=bookmark.containerNode,charIndex=0;this.setStart(containerNode,0),this.collapse(!0);for(var node,nextCharIndex,i,childNodes,nodeStack=[containerNode],foundStart=!1,stop=!1;!stop&&(node=nodeStack.pop());)if(3==node.nodeType)nextCharIndex=charIndex+node.length,!foundStart&&bookmark.start>=charIndex&&bookmark.start<=nextCharIndex&&(this.setStart(node,bookmark.start-charIndex),foundStart=!0),foundStart&&bookmark.end>=charIndex&&bookmark.end<=nextCharIndex&&(this.setEnd(node,bookmark.end-charIndex),stop=!0),charIndex=nextCharIndex;else for(childNodes=node.childNodes,i=childNodes.length;i--;)nodeStack.push(childNodes[i])},getName:function(){return"DomRange"},equals:function(range){return Range.rangesEqual(this,range)},isValid:function(){return isRangeValid(this)},inspect:function(){return inspect(this)},detach:function(){}}),createPrototypeRange(Range,updateBoundaries),util.extend(Range,{rangeProperties:rangeProperties,RangeIterator:RangeIterator,copyComparisonConstants:copyComparisonConstants,createPrototypeRange:createPrototypeRange,inspect:inspect,toHtml:rangeToHtml,getRangeDocument:getRangeDocument,rangesEqual:function(r1,r2){return r1.startContainer===r2.startContainer&&r1.startOffset===r2.startOffset&&r1.endContainer===r2.endContainer&&r1.endOffset===r2.endOffset}}),api.DomRange=Range}),api.createCoreModule("WrappedRange",["DomRange"],function(api,module){var WrappedRange,WrappedTextRange,dom=api.dom,util=api.util,DomPosition=dom.DomPosition,DomRange=api.DomRange,getBody=dom.getBody,getContentDocument=dom.getContentDocument,isCharacterDataNode=dom.isCharacterDataNode;if(api.features.implementsDomRange&&!function(){function updateRangeProperties(range){for(var prop,i=rangeProperties.length;i--;)prop=rangeProperties[i],range[prop]=range.nativeRange[prop];range.collapsed=range.startContainer===range.endContainer&&range.startOffset===range.endOffset}function updateNativeRange(range,startContainer,startOffset,endContainer,endOffset){var startMoved=range.startContainer!==startContainer||range.startOffset!=startOffset,endMoved=range.endContainer!==endContainer||range.endOffset!=endOffset,nativeRangeDifferent=!range.equals(range.nativeRange);(startMoved||endMoved||nativeRangeDifferent)&&(range.setEnd(endContainer,endOffset),range.setStart(startContainer,startOffset))}var rangeProto,createBeforeAfterNodeSetter,rangeProperties=DomRange.rangeProperties;WrappedRange=function(range){if(!range)throw module.createError("WrappedRange: Range must be specified");this.nativeRange=range,updateRangeProperties(this)},DomRange.createPrototypeRange(WrappedRange,updateNativeRange),rangeProto=WrappedRange.prototype,rangeProto.selectNode=function(node){this.nativeRange.selectNode(node),updateRangeProperties(this)},rangeProto.cloneContents=function(){return this.nativeRange.cloneContents()},rangeProto.surroundContents=function(node){this.nativeRange.surroundContents(node),updateRangeProperties(this)},rangeProto.collapse=function(isStart){this.nativeRange.collapse(isStart),updateRangeProperties(this)},rangeProto.cloneRange=function(){return new WrappedRange(this.nativeRange.cloneRange())},rangeProto.refresh=function(){updateRangeProperties(this)},rangeProto.toString=function(){return this.nativeRange.toString()};var testTextNode=document.createTextNode("test");getBody(document).appendChild(testTextNode);var range=document.createRange();range.setStart(testTextNode,0),range.setEnd(testTextNode,0);try{range.setStart(testTextNode,1),rangeProto.setStart=function(node,offset){this.nativeRange.setStart(node,offset),updateRangeProperties(this)},rangeProto.setEnd=function(node,offset){this.nativeRange.setEnd(node,offset),updateRangeProperties(this)},createBeforeAfterNodeSetter=function(name){return function(node){this.nativeRange[name](node),updateRangeProperties(this)}}}catch(ex){rangeProto.setStart=function(node,offset){try{this.nativeRange.setStart(node,offset)}catch(ex){this.nativeRange.setEnd(node,offset),this.nativeRange.setStart(node,offset)}updateRangeProperties(this)},rangeProto.setEnd=function(node,offset){try{this.nativeRange.setEnd(node,offset)}catch(ex){this.nativeRange.setStart(node,offset),this.nativeRange.setEnd(node,offset)}updateRangeProperties(this)},createBeforeAfterNodeSetter=function(name,oppositeName){return function(node){try{this.nativeRange[name](node)}catch(ex){this.nativeRange[oppositeName](node),this.nativeRange[name](node)}updateRangeProperties(this)}}}rangeProto.setStartBefore=createBeforeAfterNodeSetter("setStartBefore","setEndBefore"),rangeProto.setStartAfter=createBeforeAfterNodeSetter("setStartAfter","setEndAfter"),rangeProto.setEndBefore=createBeforeAfterNodeSetter("setEndBefore","setStartBefore"),rangeProto.setEndAfter=createBeforeAfterNodeSetter("setEndAfter","setStartAfter"),rangeProto.selectNodeContents=function(node){this.setStartAndEnd(node,0,dom.getNodeLength(node))},range.selectNodeContents(testTextNode),range.setEnd(testTextNode,3);var range2=document.createRange();range2.selectNodeContents(testTextNode),range2.setEnd(testTextNode,4),range2.setStart(testTextNode,2),-1==range.compareBoundaryPoints(range.START_TO_END,range2)&&1==range.compareBoundaryPoints(range.END_TO_START,range2)?rangeProto.compareBoundaryPoints=function(type,range){return range=range.nativeRange||range,type==range.START_TO_END?type=range.END_TO_START:type==range.END_TO_START&&(type=range.START_TO_END),this.nativeRange.compareBoundaryPoints(type,range)}:rangeProto.compareBoundaryPoints=function(type,range){return this.nativeRange.compareBoundaryPoints(type,range.nativeRange||range)};var el=document.createElement("div");el.innerHTML="123";var textNode=el.firstChild,body=getBody(document);body.appendChild(el),range.setStart(textNode,1),range.setEnd(textNode,2),range.deleteContents(),"13"==textNode.data&&(rangeProto.deleteContents=function(){this.nativeRange.deleteContents(),updateRangeProperties(this)},rangeProto.extractContents=function(){var frag=this.nativeRange.extractContents();return updateRangeProperties(this),frag}),body.removeChild(el),body=null,util.isHostMethod(range,"createContextualFragment")&&(rangeProto.createContextualFragment=function(fragmentStr){return this.nativeRange.createContextualFragment(fragmentStr)}),getBody(document).removeChild(testTextNode),rangeProto.getName=function(){return"WrappedRange"},api.WrappedRange=WrappedRange,api.createNativeRange=function(doc){return doc=getContentDocument(doc,module,"createNativeRange"),doc.createRange()}}(),api.features.implementsTextRange){var getTextRangeContainerElement=function(textRange){var parentEl=textRange.parentElement(),range=textRange.duplicate();range.collapse(!0);var startEl=range.parentElement();range=textRange.duplicate(),range.collapse(!1);var endEl=range.parentElement(),startEndContainer=startEl==endEl?startEl:dom.getCommonAncestor(startEl,endEl);return startEndContainer==parentEl?startEndContainer:dom.getCommonAncestor(parentEl,startEndContainer)},textRangeIsCollapsed=function(textRange){return 0==textRange.compareEndPoints("StartToEnd",textRange)},getTextRangeBoundaryPosition=function(textRange,wholeRangeContainerElement,isStart,isCollapsed,startInfo){var workingRange=textRange.duplicate();workingRange.collapse(isStart);var containerElement=workingRange.parentElement();if(dom.isOrIsAncestorOf(wholeRangeContainerElement,containerElement)||(containerElement=wholeRangeContainerElement),!containerElement.canHaveHTML){var pos=new DomPosition(containerElement.parentNode,dom.getNodeIndex(containerElement));return{boundaryPosition:pos,nodeInfo:{nodeIndex:pos.offset,containerElement:pos.node}}}var workingNode=dom.getDocument(containerElement).createElement("span");workingNode.parentNode&&dom.removeNode(workingNode);for(var comparison,previousNode,nextNode,boundaryPosition,boundaryNode,workingComparisonType=isStart?"StartToStart":"StartToEnd",start=startInfo&&startInfo.containerElement==containerElement?startInfo.nodeIndex:0,childNodeCount=containerElement.childNodes.length,end=childNodeCount,nodeIndex=end;;){if(nodeIndex==childNodeCount?containerElement.appendChild(workingNode):containerElement.insertBefore(workingNode,containerElement.childNodes[nodeIndex]),workingRange.moveToElementText(workingNode),comparison=workingRange.compareEndPoints(workingComparisonType,textRange),0==comparison||start==end)break;if(-1==comparison){if(end==start+1)break;start=nodeIndex}else end=end==start+1?start:nodeIndex;nodeIndex=Math.floor((start+end)/2),containerElement.removeChild(workingNode)}if(boundaryNode=workingNode.nextSibling,-1==comparison&&boundaryNode&&isCharacterDataNode(boundaryNode)){workingRange.setEndPoint(isStart?"EndToStart":"EndToEnd",textRange);var offset;if(/[\r\n]/.test(boundaryNode.data)){var tempRange=workingRange.duplicate(),rangeLength=tempRange.text.replace(/\r\n/g,"\r").length;for(offset=tempRange.moveStart("character",rangeLength);-1==(comparison=tempRange.compareEndPoints("StartToEnd",tempRange));)offset++,tempRange.moveStart("character",1)}else offset=workingRange.text.length;boundaryPosition=new DomPosition(boundaryNode,offset)}else previousNode=(isCollapsed||!isStart)&&workingNode.previousSibling,nextNode=(isCollapsed||isStart)&&workingNode.nextSibling,boundaryPosition=nextNode&&isCharacterDataNode(nextNode)?new DomPosition(nextNode,0):previousNode&&isCharacterDataNode(previousNode)?new DomPosition(previousNode,previousNode.data.length):new DomPosition(containerElement,dom.getNodeIndex(workingNode));return dom.removeNode(workingNode),{boundaryPosition:boundaryPosition,nodeInfo:{nodeIndex:nodeIndex,containerElement:containerElement}}},createBoundaryTextRange=function(boundaryPosition,isStart){var boundaryNode,boundaryParent,workingNode,childNodes,boundaryOffset=boundaryPosition.offset,doc=dom.getDocument(boundaryPosition.node),workingRange=getBody(doc).createTextRange(),nodeIsDataNode=isCharacterDataNode(boundaryPosition.node);return nodeIsDataNode?(boundaryNode=boundaryPosition.node,boundaryParent=boundaryNode.parentNode):(childNodes=boundaryPosition.node.childNodes,boundaryNode=boundaryOffset<childNodes.length?childNodes[boundaryOffset]:null,boundaryParent=boundaryPosition.node),workingNode=doc.createElement("span"),workingNode.innerHTML="&#feff;",boundaryNode?boundaryParent.insertBefore(workingNode,boundaryNode):boundaryParent.appendChild(workingNode),workingRange.moveToElementText(workingNode),workingRange.collapse(!isStart),boundaryParent.removeChild(workingNode),nodeIsDataNode&&workingRange[isStart?"moveStart":"moveEnd"]("character",boundaryOffset),workingRange};WrappedTextRange=function(textRange){this.textRange=textRange,this.refresh()},WrappedTextRange.prototype=new DomRange(document),WrappedTextRange.prototype.refresh=function(){var start,end,startBoundary,rangeContainerElement=getTextRangeContainerElement(this.textRange);textRangeIsCollapsed(this.textRange)?end=start=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,!0,!0).boundaryPosition:(startBoundary=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,!0,!1),start=startBoundary.boundaryPosition,end=getTextRangeBoundaryPosition(this.textRange,rangeContainerElement,!1,!1,startBoundary.nodeInfo).boundaryPosition),this.setStart(start.node,start.offset),this.setEnd(end.node,end.offset)},WrappedTextRange.prototype.getName=function(){return"WrappedTextRange"},DomRange.copyComparisonConstants(WrappedTextRange);var rangeToTextRange=function(range){if(range.collapsed)return createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),!0);var startRange=createBoundaryTextRange(new DomPosition(range.startContainer,range.startOffset),!0),endRange=createBoundaryTextRange(new DomPosition(range.endContainer,range.endOffset),!1),textRange=getBody(DomRange.getRangeDocument(range)).createTextRange();return textRange.setEndPoint("StartToStart",startRange),textRange.setEndPoint("EndToEnd",endRange),textRange};if(WrappedTextRange.rangeToTextRange=rangeToTextRange,WrappedTextRange.prototype.toTextRange=function(){return rangeToTextRange(this)},api.WrappedTextRange=WrappedTextRange,!api.features.implementsDomRange||api.config.preferTextRange){var globalObj=function(f){return f("return this;")()}(Function);"undefined"==typeof globalObj.Range&&(globalObj.Range=WrappedTextRange),api.createNativeRange=function(doc){return doc=getContentDocument(doc,module,"createNativeRange"),getBody(doc).createTextRange()},api.WrappedRange=WrappedTextRange}}api.createRange=function(doc){return doc=getContentDocument(doc,module,"createRange"),new api.WrappedRange(api.createNativeRange(doc))},api.createRangyRange=function(doc){return doc=getContentDocument(doc,module,"createRangyRange"),new DomRange(doc)},util.createAliasForDeprecatedMethod(api,"createIframeRange","createRange"),util.createAliasForDeprecatedMethod(api,"createIframeRangyRange","createRangyRange"),api.addShimListener(function(win){var doc=win.document;"undefined"==typeof doc.createRange&&(doc.createRange=function(){return api.createRange(doc)}),doc=win=null})}),api.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(api,module){function isDirectionBackward(dir){return"string"==typeof dir?/^backward(s)?$/i.test(dir):!!dir}function getWindow(win,methodName){if(win){if(dom.isWindow(win))return win;if(win instanceof WrappedSelection)return win.win;var doc=dom.getContentDocument(win,module,methodName);return dom.getWindow(doc)}return window}function getWinSelection(winParam){return getWindow(winParam,"getWinSelection").getSelection()}function getDocSelection(winParam){return getWindow(winParam,"getDocSelection").document.selection}function winSelectionIsBackward(sel){var backward=!1;return sel.anchorNode&&(backward=1==dom.comparePoints(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset)),backward}function updateAnchorAndFocusFromRange(sel,range,backward){var anchorPrefix=backward?"end":"start",focusPrefix=backward?"start":"end";sel.anchorNode=range[anchorPrefix+"Container"],sel.anchorOffset=range[anchorPrefix+"Offset"],sel.focusNode=range[focusPrefix+"Container"],sel.focusOffset=range[focusPrefix+"Offset"]}function updateAnchorAndFocusFromNativeSelection(sel){var nativeSel=sel.nativeSelection;sel.anchorNode=nativeSel.anchorNode,sel.anchorOffset=nativeSel.anchorOffset,sel.focusNode=nativeSel.focusNode,sel.focusOffset=nativeSel.focusOffset}function updateEmptySelection(sel){sel.anchorNode=sel.focusNode=null,sel.anchorOffset=sel.focusOffset=0,sel.rangeCount=0,sel.isCollapsed=!0,sel._ranges.length=0}function getNativeRange(range){var nativeRange;return range instanceof DomRange?(nativeRange=api.createNativeRange(range.getDocument()),nativeRange.setEnd(range.endContainer,range.endOffset),nativeRange.setStart(range.startContainer,range.startOffset)):range instanceof WrappedRange?nativeRange=range.nativeRange:features.implementsDomRange&&range instanceof dom.getWindow(range.startContainer).Range&&(nativeRange=range),nativeRange}function rangeContainsSingleElement(rangeNodes){if(!rangeNodes.length||1!=rangeNodes[0].nodeType)return!1;for(var i=1,len=rangeNodes.length;len>i;++i)if(!dom.isAncestorOf(rangeNodes[0],rangeNodes[i]))return!1;return!0}function getSingleElementFromRange(range){var nodes=range.getNodes();if(!rangeContainsSingleElement(nodes))throw module.createError("getSingleElementFromRange: range "+range.inspect()+" did not consist of a single element");return nodes[0]}function isTextRange(range){return!!range&&"undefined"!=typeof range.text}function updateFromTextRange(sel,range){var wrappedRange=new WrappedRange(range);sel._ranges=[wrappedRange],updateAnchorAndFocusFromRange(sel,wrappedRange,!1),sel.rangeCount=1,sel.isCollapsed=wrappedRange.collapsed}function updateControlSelection(sel){if(sel._ranges.length=0,"None"==sel.docSelection.type)updateEmptySelection(sel);else{var controlRange=sel.docSelection.createRange();if(isTextRange(controlRange))updateFromTextRange(sel,controlRange);else{sel.rangeCount=controlRange.length;for(var range,doc=getDocument(controlRange.item(0)),i=0;i<sel.rangeCount;++i)range=api.createRange(doc),range.selectNode(controlRange.item(i)),sel._ranges.push(range);sel.isCollapsed=1==sel.rangeCount&&sel._ranges[0].collapsed,updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],!1)}}}function addRangeToControlSelection(sel,range){for(var controlRange=sel.docSelection.createRange(),rangeElement=getSingleElementFromRange(range),doc=getDocument(controlRange.item(0)),newControlRange=getBody(doc).createControlRange(),i=0,len=controlRange.length;len>i;++i)newControlRange.add(controlRange.item(i));try{newControlRange.add(rangeElement)}catch(ex){throw module.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}newControlRange.select(),updateControlSelection(sel)}function WrappedSelection(selection,docSelection,win){this.nativeSelection=selection,this.docSelection=docSelection,this._ranges=[],this.win=win,this.refresh()}function deleteProperties(sel){sel.win=sel.anchorNode=sel.focusNode=sel._ranges=null,sel.rangeCount=sel.anchorOffset=sel.focusOffset=0,sel.detached=!0}function actOnCachedSelection(win,action){for(var cached,sel,i=cachedRangySelections.length;i--;)if(cached=cachedRangySelections[i],sel=cached.selection,"deleteAll"==action)deleteProperties(sel);else if(cached.win==win)return"delete"==action?(cachedRangySelections.splice(i,1),!0):sel;return"deleteAll"==action&&(cachedRangySelections.length=0),null}function createControlSelection(sel,ranges){for(var el,doc=getDocument(ranges[0].startContainer),controlRange=getBody(doc).createControlRange(),i=0,len=ranges.length;len>i;++i){el=getSingleElementFromRange(ranges[i]);try{controlRange.add(el)}catch(ex){throw module.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}controlRange.select(),updateControlSelection(sel)}function assertNodeInSameDocument(sel,node){if(sel.win.document!=getDocument(node))throw new DOMException("WRONG_DOCUMENT_ERR")}function createStartOrEndSetter(isStart){return function(node,offset){var range;this.rangeCount?(range=this.getRangeAt(0),range["set"+(isStart?"Start":"End")](node,offset)):(range=api.createRange(this.win.document),range.setStartAndEnd(node,offset)),this.setSingleRange(range,this.isBackward())}}function inspect(sel){var rangeInspects=[],anchor=new DomPosition(sel.anchorNode,sel.anchorOffset),focus=new DomPosition(sel.focusNode,sel.focusOffset),name="function"==typeof sel.getName?sel.getName():"Selection";if("undefined"!=typeof sel.rangeCount)for(var i=0,len=sel.rangeCount;len>i;++i)rangeInspects[i]=DomRange.inspect(sel.getRangeAt(i));return"["+name+"(Ranges: "+rangeInspects.join(", ")+")(anchor: "+anchor.inspect()+", focus: "+focus.inspect()+"]"}api.config.checkSelectionRanges=!0;var getNativeSelection,selectionIsCollapsed,BOOLEAN="boolean",NUMBER="number",dom=api.dom,util=api.util,isHostMethod=util.isHostMethod,DomRange=api.DomRange,WrappedRange=api.WrappedRange,DOMException=api.DOMException,DomPosition=dom.DomPosition,features=api.features,CONTROL="Control",getDocument=dom.getDocument,getBody=dom.getBody,rangesEqual=DomRange.rangesEqual,implementsWinGetSelection=isHostMethod(window,"getSelection"),implementsDocSelection=util.isHostObject(document,"selection");features.implementsWinGetSelection=implementsWinGetSelection,features.implementsDocSelection=implementsDocSelection;var useDocumentSelection=implementsDocSelection&&(!implementsWinGetSelection||api.config.preferTextRange);if(useDocumentSelection)getNativeSelection=getDocSelection,api.isSelectionValid=function(winParam){var doc=getWindow(winParam,"isSelectionValid").document,nativeSel=doc.selection;return"None"!=nativeSel.type||getDocument(nativeSel.createRange().parentElement())==doc};else{if(!implementsWinGetSelection)return module.fail("Neither document.selection or window.getSelection() detected."),!1;getNativeSelection=getWinSelection,api.isSelectionValid=function(){return!0}}api.getNativeSelection=getNativeSelection;var testSelection=getNativeSelection();if(!testSelection)return module.fail("Native selection was null (possibly issue 138?)"),!1;var testRange=api.createNativeRange(document),body=getBody(document),selectionHasAnchorAndFocus=util.areHostProperties(testSelection,["anchorNode","focusNode","anchorOffset","focusOffset"]);features.selectionHasAnchorAndFocus=selectionHasAnchorAndFocus;var selectionHasExtend=isHostMethod(testSelection,"extend");features.selectionHasExtend=selectionHasExtend;var selectionHasRangeCount=typeof testSelection.rangeCount==NUMBER;features.selectionHasRangeCount=selectionHasRangeCount;var selectionSupportsMultipleRanges=!1,collapsedNonEditableSelectionsSupported=!0,addRangeBackwardToNative=selectionHasExtend?function(nativeSelection,range){var doc=DomRange.getRangeDocument(range),endRange=api.createRange(doc);endRange.collapseToPoint(range.endContainer,range.endOffset),nativeSelection.addRange(getNativeRange(endRange)),nativeSelection.extend(range.startContainer,range.startOffset)}:null;util.areHostMethods(testSelection,["addRange","getRangeAt","removeAllRanges"])&&typeof testSelection.rangeCount==NUMBER&&features.implementsDomRange&&!function(){var sel=window.getSelection();if(sel){for(var originalSelectionRangeCount=sel.rangeCount,selectionHasMultipleRanges=originalSelectionRangeCount>1,originalSelectionRanges=[],originalSelectionBackward=winSelectionIsBackward(sel),i=0;originalSelectionRangeCount>i;++i)originalSelectionRanges[i]=sel.getRangeAt(i);var testEl=dom.createTestElement(document,"",!1),textNode=testEl.appendChild(document.createTextNode("\xa0\xa0\xa0")),r1=document.createRange();if(r1.setStart(textNode,1),r1.collapse(!0),sel.removeAllRanges(),sel.addRange(r1),collapsedNonEditableSelectionsSupported=1==sel.rangeCount,sel.removeAllRanges(),!selectionHasMultipleRanges){var chromeMatch=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(chromeMatch&&parseInt(chromeMatch[1])>=36)selectionSupportsMultipleRanges=!1;else{var r2=r1.cloneRange();r1.setStart(textNode,0),r2.setEnd(textNode,3),r2.setStart(textNode,2),sel.addRange(r1),sel.addRange(r2),selectionSupportsMultipleRanges=2==sel.rangeCount}}for(dom.removeNode(testEl),sel.removeAllRanges(),i=0;originalSelectionRangeCount>i;++i)0==i&&originalSelectionBackward?addRangeBackwardToNative?addRangeBackwardToNative(sel,originalSelectionRanges[i]):(api.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),sel.addRange(originalSelectionRanges[i])):sel.addRange(originalSelectionRanges[i])}}(),features.selectionSupportsMultipleRanges=selectionSupportsMultipleRanges,features.collapsedNonEditableSelectionsSupported=collapsedNonEditableSelectionsSupported;var testControlRange,implementsControlRange=!1;body&&isHostMethod(body,"createControlRange")&&(testControlRange=body.createControlRange(),util.areHostProperties(testControlRange,["item","add"])&&(implementsControlRange=!0)),features.implementsControlRange=implementsControlRange,selectionIsCollapsed=selectionHasAnchorAndFocus?function(sel){return sel.anchorNode===sel.focusNode&&sel.anchorOffset===sel.focusOffset}:function(sel){return sel.rangeCount?sel.getRangeAt(sel.rangeCount-1).collapsed:!1};var getSelectionRangeAt;isHostMethod(testSelection,"getRangeAt")?getSelectionRangeAt=function(sel,index){try{return sel.getRangeAt(index)}catch(ex){return null}}:selectionHasAnchorAndFocus&&(getSelectionRangeAt=function(sel){var doc=getDocument(sel.anchorNode),range=api.createRange(doc);return range.setStartAndEnd(sel.anchorNode,sel.anchorOffset,sel.focusNode,sel.focusOffset),range.collapsed!==this.isCollapsed&&range.setStartAndEnd(sel.focusNode,sel.focusOffset,sel.anchorNode,sel.anchorOffset),range}),WrappedSelection.prototype=api.selectionPrototype;var cachedRangySelections=[],getSelection=function(win){if(win&&win instanceof WrappedSelection)return win.refresh(),win;win=getWindow(win,"getNativeSelection");var sel=actOnCachedSelection(win),nativeSel=getNativeSelection(win),docSel=implementsDocSelection?getDocSelection(win):null;return sel?(sel.nativeSelection=nativeSel,sel.docSelection=docSel,
sel.refresh()):(sel=new WrappedSelection(nativeSel,docSel,win),cachedRangySelections.push({win:win,selection:sel})),sel};api.getSelection=getSelection,util.createAliasForDeprecatedMethod(api,"getIframeSelection","getSelection");var selProto=WrappedSelection.prototype;if(!useDocumentSelection&&selectionHasAnchorAndFocus&&util.areHostMethods(testSelection,["removeAllRanges","addRange"])){selProto.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),updateEmptySelection(this)};var addRangeBackward=function(sel,range){addRangeBackwardToNative(sel.nativeSelection,range),sel.refresh()};selectionHasRangeCount?selProto.addRange=function(range,direction){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL)addRangeToControlSelection(this,range);else if(isDirectionBackward(direction)&&selectionHasExtend)addRangeBackward(this,range);else{var previousRangeCount;selectionSupportsMultipleRanges?previousRangeCount=this.rangeCount:(this.removeAllRanges(),previousRangeCount=0);var clonedNativeRange=getNativeRange(range).cloneRange();try{this.nativeSelection.addRange(clonedNativeRange)}catch(ex){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==previousRangeCount+1){if(api.config.checkSelectionRanges){var nativeRange=getSelectionRangeAt(this.nativeSelection,this.rangeCount-1);nativeRange&&!rangesEqual(nativeRange,range)&&(range=new WrappedRange(nativeRange))}this._ranges[this.rangeCount-1]=range,updateAnchorAndFocusFromRange(this,range,selectionIsBackward(this.nativeSelection)),this.isCollapsed=selectionIsCollapsed(this)}else this.refresh()}}:selProto.addRange=function(range,direction){isDirectionBackward(direction)&&selectionHasExtend?addRangeBackward(this,range):(this.nativeSelection.addRange(getNativeRange(range)),this.refresh())},selProto.setRanges=function(ranges){if(implementsControlRange&&implementsDocSelection&&ranges.length>1)createControlSelection(this,ranges);else{this.removeAllRanges();for(var i=0,len=ranges.length;len>i;++i)this.addRange(ranges[i])}}}else{if(!(isHostMethod(testSelection,"empty")&&isHostMethod(testRange,"select")&&implementsControlRange&&useDocumentSelection))return module.fail("No means of selecting a Range or TextRange was found"),!1;selProto.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var doc;if(this.anchorNode)doc=getDocument(this.anchorNode);else if(this.docSelection.type==CONTROL){var controlRange=this.docSelection.createRange();controlRange.length&&(doc=getDocument(controlRange.item(0)))}if(doc){var textRange=getBody(doc).createTextRange();textRange.select(),this.docSelection.empty()}}}catch(ex){}updateEmptySelection(this)},selProto.addRange=function(range){this.docSelection.type==CONTROL?addRangeToControlSelection(this,range):(api.WrappedTextRange.rangeToTextRange(range).select(),this._ranges[0]=range,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,updateAnchorAndFocusFromRange(this,range,!1))},selProto.setRanges=function(ranges){this.removeAllRanges();var rangeCount=ranges.length;rangeCount>1?createControlSelection(this,ranges):rangeCount&&this.addRange(ranges[0])}}selProto.getRangeAt=function(index){if(0>index||index>=this.rangeCount)throw new DOMException("INDEX_SIZE_ERR");return this._ranges[index].cloneRange()};var refreshSelection;if(useDocumentSelection)refreshSelection=function(sel){var range;api.isSelectionValid(sel.win)?range=sel.docSelection.createRange():(range=getBody(sel.win.document).createTextRange(),range.collapse(!0)),sel.docSelection.type==CONTROL?updateControlSelection(sel):isTextRange(range)?updateFromTextRange(sel,range):updateEmptySelection(sel)};else if(isHostMethod(testSelection,"getRangeAt")&&typeof testSelection.rangeCount==NUMBER)refreshSelection=function(sel){if(implementsControlRange&&implementsDocSelection&&sel.docSelection.type==CONTROL)updateControlSelection(sel);else if(sel._ranges.length=sel.rangeCount=sel.nativeSelection.rangeCount,sel.rangeCount){for(var i=0,len=sel.rangeCount;len>i;++i)sel._ranges[i]=new api.WrappedRange(sel.nativeSelection.getRangeAt(i));updateAnchorAndFocusFromRange(sel,sel._ranges[sel.rangeCount-1],selectionIsBackward(sel.nativeSelection)),sel.isCollapsed=selectionIsCollapsed(sel)}else updateEmptySelection(sel)};else{if(!selectionHasAnchorAndFocus||typeof testSelection.isCollapsed!=BOOLEAN||typeof testRange.collapsed!=BOOLEAN||!features.implementsDomRange)return module.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;refreshSelection=function(sel){var range,nativeSel=sel.nativeSelection;nativeSel.anchorNode?(range=getSelectionRangeAt(nativeSel,0),sel._ranges=[range],sel.rangeCount=1,updateAnchorAndFocusFromNativeSelection(sel),sel.isCollapsed=selectionIsCollapsed(sel)):updateEmptySelection(sel)}}selProto.refresh=function(checkForChanges){var oldRanges=checkForChanges?this._ranges.slice(0):null,oldAnchorNode=this.anchorNode,oldAnchorOffset=this.anchorOffset;if(refreshSelection(this),checkForChanges){var i=oldRanges.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=oldAnchorNode||this.anchorOffset!=oldAnchorOffset)return!0;for(;i--;)if(!rangesEqual(oldRanges[i],this._ranges[i]))return!0;return!1}};var removeRangeManually=function(sel,range){var ranges=sel.getAllRanges();sel.removeAllRanges();for(var i=0,len=ranges.length;len>i;++i)rangesEqual(range,ranges[i])||sel.addRange(ranges[i]);sel.rangeCount||updateEmptySelection(sel)};implementsControlRange&&implementsDocSelection?selProto.removeRange=function(range){if(this.docSelection.type==CONTROL){for(var el,controlRange=this.docSelection.createRange(),rangeElement=getSingleElementFromRange(range),doc=getDocument(controlRange.item(0)),newControlRange=getBody(doc).createControlRange(),removed=!1,i=0,len=controlRange.length;len>i;++i)el=controlRange.item(i),el!==rangeElement||removed?newControlRange.add(controlRange.item(i)):removed=!0;newControlRange.select(),updateControlSelection(this)}else removeRangeManually(this,range)}:selProto.removeRange=function(range){removeRangeManually(this,range)};var selectionIsBackward;!useDocumentSelection&&selectionHasAnchorAndFocus&&features.implementsDomRange?(selectionIsBackward=winSelectionIsBackward,selProto.isBackward=function(){return selectionIsBackward(this)}):selectionIsBackward=selProto.isBackward=function(){return!1},selProto.isBackwards=selProto.isBackward,selProto.toString=function(){for(var rangeTexts=[],i=0,len=this.rangeCount;len>i;++i)rangeTexts[i]=""+this._ranges[i];return rangeTexts.join("")},selProto.collapse=function(node,offset){assertNodeInSameDocument(this,node);var range=api.createRange(node);range.collapseToPoint(node,offset),this.setSingleRange(range),this.isCollapsed=!0},selProto.collapseToStart=function(){if(!this.rangeCount)throw new DOMException("INVALID_STATE_ERR");var range=this._ranges[0];this.collapse(range.startContainer,range.startOffset)},selProto.collapseToEnd=function(){if(!this.rangeCount)throw new DOMException("INVALID_STATE_ERR");var range=this._ranges[this.rangeCount-1];this.collapse(range.endContainer,range.endOffset)},selProto.selectAllChildren=function(node){assertNodeInSameDocument(this,node);var range=api.createRange(node);range.selectNodeContents(node),this.setSingleRange(range)},selProto.deleteFromDocument=function(){if(implementsControlRange&&implementsDocSelection&&this.docSelection.type==CONTROL){for(var element,controlRange=this.docSelection.createRange();controlRange.length;)element=controlRange.item(0),controlRange.remove(element),dom.removeNode(element);this.refresh()}else if(this.rangeCount){var ranges=this.getAllRanges();if(ranges.length){this.removeAllRanges();for(var i=0,len=ranges.length;len>i;++i)ranges[i].deleteContents();this.addRange(ranges[len-1])}}},selProto.eachRange=function(func,returnValue){for(var i=0,len=this._ranges.length;len>i;++i)if(func(this.getRangeAt(i)))return returnValue},selProto.getAllRanges=function(){var ranges=[];return this.eachRange(function(range){ranges.push(range)}),ranges},selProto.setSingleRange=function(range,direction){this.removeAllRanges(),this.addRange(range,direction)},selProto.callMethodOnEachRange=function(methodName,params){var results=[];return this.eachRange(function(range){results.push(range[methodName].apply(range,params||[]))}),results},selProto.setStart=createStartOrEndSetter(!0),selProto.setEnd=createStartOrEndSetter(!1),api.rangePrototype.select=function(direction){getSelection(this.getDocument()).setSingleRange(this,direction)},selProto.changeEachRange=function(func){var ranges=[],backward=this.isBackward();this.eachRange(function(range){func(range),ranges.push(range)}),this.removeAllRanges(),backward&&1==ranges.length?this.addRange(ranges[0],"backward"):this.setRanges(ranges)},selProto.containsNode=function(node,allowPartial){return this.eachRange(function(range){return range.containsNode(node,allowPartial)},!0)||!1},selProto.getBookmark=function(containerNode){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[containerNode])}},selProto.moveToBookmark=function(bookmark){for(var rangeBookmark,range,selRanges=[],i=0;rangeBookmark=bookmark.rangeBookmarks[i++];)range=api.createRange(this.win),range.moveToBookmark(rangeBookmark),selRanges.push(range);bookmark.backward?this.setSingleRange(selRanges[0],"backward"):this.setRanges(selRanges)},selProto.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},selProto.restoreRanges=function(selRanges){this.removeAllRanges();for(var range,i=0;range=selRanges.ranges[i];++i)this.addRange(range,selRanges.backward&&0==i)},selProto.toHtml=function(){var rangeHtmls=[];return this.eachRange(function(range){rangeHtmls.push(DomRange.toHtml(range))}),rangeHtmls.join("")},features.implementsTextRange&&(selProto.getNativeTextRange=function(){var sel;if(sel=this.docSelection){var range=sel.createRange();if(isTextRange(range))return range;throw module.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return api.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw module.createError("getNativeTextRange: selection contains no range")}),selProto.getName=function(){return"WrappedSelection"},selProto.inspect=function(){return inspect(this)},selProto.detach=function(){actOnCachedSelection(this.win,"delete"),deleteProperties(this)},WrappedSelection.detachAll=function(){actOnCachedSelection(null,"deleteAll")},WrappedSelection.inspect=inspect,WrappedSelection.isDirectionBackward=isDirectionBackward,api.Selection=WrappedSelection,api.selectionPrototype=selProto,api.addShimListener(function(win){"undefined"==typeof win.getSelection&&(win.getSelection=function(){return getSelection(win)}),win=null})});var docReady=!1,loadHandler=function(e){docReady||(docReady=!0,!api.initialized&&api.config.autoInitialize&&init())};return isBrowser&&("complete"==document.readyState?loadHandler():(isHostMethod(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",loadHandler,!1),addListener(window,"load",loadHandler))),api},this),/**
 * Class Applier module for Rangy.
 * Adds, removes and toggles classes on Ranges and Selections
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(factory,root){"function"==typeof define&&define.amd?define(["./rangy-core"],factory):"undefined"!=typeof module&&"object"==typeof exports?module.exports=factory(require("rangy")):factory(root.rangy)}(function(rangy){return rangy.createModule("ClassApplier",["WrappedSelection"],function(api,module){function each(obj,func){for(var i in obj)if(obj.hasOwnProperty(i)&&func(i,obj[i])===!1)return!1;return!0}function trim(str){return str.replace(/^\s\s*/,"").replace(/\s\s*$/,"")}function classNameContainsClass(fullClassName,className){return!!fullClassName&&new RegExp("(?:^|\\s)"+className+"(?:\\s|$)").test(fullClassName)}function hasClass(el,className){if("object"==typeof el.classList)return el.classList.contains(className);var classNameSupported="string"==typeof el.className,elClass=classNameSupported?el.className:el.getAttribute("class");return classNameContainsClass(elClass,className)}function addClass(el,className){if("object"==typeof el.classList)el.classList.add(className);else{var classNameSupported="string"==typeof el.className,elClass=classNameSupported?el.className:el.getAttribute("class");elClass?classNameContainsClass(elClass,className)||(elClass+=" "+className):elClass=className,classNameSupported?el.className=elClass:el.setAttribute("class",elClass)}}function getClass(el){var classNameSupported="string"==typeof el.className;return classNameSupported?el.className:el.getAttribute("class")}function sortClassName(className){return className&&className.split(/\s+/).sort().join(" ")}function getSortedClassName(el){return sortClassName(getClass(el))}function haveSameClasses(el1,el2){return getSortedClassName(el1)==getSortedClassName(el2)}function hasAllClasses(el,className){for(var classes=className.split(/\s+/),i=0,len=classes.length;len>i;++i)if(!hasClass(el,trim(classes[i])))return!1;return!0}function canTextBeStyled(textNode){var parent=textNode.parentNode;return parent&&1==parent.nodeType&&!/^(textarea|style|script|select|iframe)$/i.test(parent.nodeName)}function movePosition(position,oldParent,oldIndex,newParent,newIndex){var posNode=position.node,posOffset=position.offset,newNode=posNode,newOffset=posOffset;posNode==newParent&&posOffset>newIndex&&++newOffset,posNode!=oldParent||posOffset!=oldIndex&&posOffset!=oldIndex+1||(newNode=newParent,newOffset+=newIndex-oldIndex),posNode==oldParent&&posOffset>oldIndex+1&&--newOffset,position.node=newNode,position.offset=newOffset}function movePositionWhenRemovingNode(position,parentNode,index){position.node==parentNode&&position.offset>index&&--position.offset}function movePreservingPositions(node,newParent,newIndex,positionsToPreserve){-1==newIndex&&(newIndex=newParent.childNodes.length);var oldParent=node.parentNode,oldIndex=dom.getNodeIndex(node);forEach(positionsToPreserve,function(position){movePosition(position,oldParent,oldIndex,newParent,newIndex)}),newParent.childNodes.length==newIndex?newParent.appendChild(node):newParent.insertBefore(node,newParent.childNodes[newIndex])}function removePreservingPositions(node,positionsToPreserve){var oldParent=node.parentNode,oldIndex=dom.getNodeIndex(node);forEach(positionsToPreserve,function(position){movePositionWhenRemovingNode(position,oldParent,oldIndex)}),dom.removeNode(node)}function moveChildrenPreservingPositions(node,newParent,newIndex,removeNode,positionsToPreserve){for(var child,children=[];child=node.firstChild;)movePreservingPositions(child,newParent,newIndex++,positionsToPreserve),children.push(child);return removeNode&&removePreservingPositions(node,positionsToPreserve),children}function replaceWithOwnChildrenPreservingPositions(element,positionsToPreserve){return moveChildrenPreservingPositions(element,element.parentNode,dom.getNodeIndex(element),!0,positionsToPreserve)}function rangeSelectsAnyText(range,textNode){var textNodeRange=range.cloneRange();textNodeRange.selectNodeContents(textNode);var intersectionRange=textNodeRange.intersection(range),text=intersectionRange?intersectionRange.toString():"";return""!=text}function getEffectiveTextNodes(range){for(var node,nodes=range.getNodes([3]),start=0;(node=nodes[start])&&!rangeSelectsAnyText(range,node);)++start;for(var end=nodes.length-1;(node=nodes[end])&&!rangeSelectsAnyText(range,node);)--end;return nodes.slice(start,end+1)}function elementsHaveSameNonClassAttributes(el1,el2){if(el1.attributes.length!=el2.attributes.length)return!1;for(var attr1,attr2,name,i=0,len=el1.attributes.length;len>i;++i)if(attr1=el1.attributes[i],name=attr1.name,"class"!=name){if(attr2=el2.attributes.getNamedItem(name),null===attr1!=(null===attr2))return!1;if(attr1.specified!=attr2.specified)return!1;if(attr1.specified&&attr1.nodeValue!==attr2.nodeValue)return!1}return!0}function elementHasNonClassAttributes(el,exceptions){for(var attrName,i=0,len=el.attributes.length;len>i;++i)if(attrName=el.attributes[i].name,(!exceptions||!contains(exceptions,attrName))&&el.attributes[i].specified&&"class"!=attrName)return!0;return!1}function isEditingHost(node){var parent;return node&&1==node.nodeType&&((parent=node.parentNode)&&9==parent.nodeType&&"on"==parent.designMode||isEditableElement(node)&&!isEditableElement(node.parentNode))}function isEditable(node){return(isEditableElement(node)||1!=node.nodeType&&isEditableElement(node.parentNode))&&!isEditingHost(node)}function isNonInlineElement(node){return node&&1==node.nodeType&&!inlineDisplayRegex.test(getComputedStyleProperty(node,"display"))}function isUnrenderedWhiteSpaceNode(node){if(0==node.data.length)return!0;if(htmlNonWhiteSpaceRegex.test(node.data))return!1;var cssWhiteSpace=getComputedStyleProperty(node.parentNode,"whiteSpace");switch(cssWhiteSpace){case"pre":case"pre-wrap":case"-moz-pre-wrap":return!1;case"pre-line":if(/[\r\n]/.test(node.data))return!1}return isNonInlineElement(node.previousSibling)||isNonInlineElement(node.nextSibling)}function getRangeBoundaries(ranges){var i,range,positions=[];for(i=0;range=ranges[i++];)positions.push(new DomPosition(range.startContainer,range.startOffset),new DomPosition(range.endContainer,range.endOffset));return positions}function updateRangesFromBoundaries(ranges,positions){for(var range,start,end,i=0,len=ranges.length;len>i;++i)range=ranges[i],start=positions[2*i],end=positions[2*i+1],range.setStartAndEnd(start.node,start.offset,end.node,end.offset)}function isSplitPoint(node,offset){return dom.isCharacterDataNode(node)?0==offset?!!node.previousSibling:offset==node.length?!!node.nextSibling:!0:offset>0&&offset<node.childNodes.length}function splitNodeAt(node,descendantNode,descendantOffset,positionsToPreserve){var newNode,parentNode,splitAtStart=0==descendantOffset;if(dom.isAncestorOf(descendantNode,node))return node;if(dom.isCharacterDataNode(descendantNode)){var descendantIndex=dom.getNodeIndex(descendantNode);if(0==descendantOffset)descendantOffset=descendantIndex;else{if(descendantOffset!=descendantNode.length)throw module.createError("splitNodeAt() should not be called with offset in the middle of a data node ("+descendantOffset+" in "+descendantNode.data);descendantOffset=descendantIndex+1}descendantNode=descendantNode.parentNode}if(isSplitPoint(descendantNode,descendantOffset)){newNode=descendantNode.cloneNode(!1),parentNode=descendantNode.parentNode,newNode.id&&newNode.removeAttribute("id");for(var child,newChildIndex=0;child=descendantNode.childNodes[descendantOffset];)movePreservingPositions(child,newNode,newChildIndex++,positionsToPreserve);return movePreservingPositions(newNode,parentNode,dom.getNodeIndex(descendantNode)+1,positionsToPreserve),descendantNode==node?newNode:splitNodeAt(node,parentNode,dom.getNodeIndex(newNode),positionsToPreserve)}if(node!=descendantNode){newNode=descendantNode.parentNode;var newNodeIndex=dom.getNodeIndex(descendantNode);return splitAtStart||newNodeIndex++,splitNodeAt(node,newNode,newNodeIndex,positionsToPreserve)}return node}function areElementsMergeable(el1,el2){return el1.namespaceURI==el2.namespaceURI&&el1.tagName.toLowerCase()==el2.tagName.toLowerCase()&&haveSameClasses(el1,el2)&&elementsHaveSameNonClassAttributes(el1,el2)&&"inline"==getComputedStyleProperty(el1,"display")&&"inline"==getComputedStyleProperty(el2,"display")}function createAdjacentMergeableTextNodeGetter(forward){var siblingPropName=forward?"nextSibling":"previousSibling";return function(textNode,checkParentElement){var el=textNode.parentNode,adjacentNode=textNode[siblingPropName];if(adjacentNode){if(adjacentNode&&3==adjacentNode.nodeType)return adjacentNode}else if(checkParentElement&&(adjacentNode=el[siblingPropName],adjacentNode&&1==adjacentNode.nodeType&&areElementsMergeable(el,adjacentNode))){var adjacentNodeChild=adjacentNode[forward?"firstChild":"lastChild"];if(adjacentNodeChild&&3==adjacentNodeChild.nodeType)return adjacentNodeChild}return null}}function Merge(firstNode){this.isElementMerge=1==firstNode.nodeType,this.textNodes=[];var firstTextNode=this.isElementMerge?firstNode.lastChild:firstNode;firstTextNode&&(this.textNodes[0]=firstTextNode)}function ClassApplier(className,options,tagNames){var normalize,i,len,propName,applier=this;applier.cssClass=applier.className=className;var elementPropertiesFromOptions=null,elementAttributes={};if("object"==typeof options&&null!==options){for("undefined"!=typeof options.elementTagName&&(options.elementTagName=options.elementTagName.toLowerCase()),tagNames=options.tagNames,elementPropertiesFromOptions=options.elementProperties,elementAttributes=options.elementAttributes,i=0;propName=optionProperties[i++];)options.hasOwnProperty(propName)&&(applier[propName]=options[propName]);normalize=options.normalize}else normalize=options;applier.normalize="undefined"==typeof normalize?!0:normalize,applier.attrExceptions=[];var el=document.createElement(applier.elementTagName);applier.elementProperties=applier.copyPropertiesToElement(elementPropertiesFromOptions,el,!0),each(elementAttributes,function(attrName,attrValue){applier.attrExceptions.push(attrName),elementAttributes[attrName]=""+attrValue}),applier.elementAttributes=elementAttributes,applier.elementSortedClassName=applier.elementProperties.hasOwnProperty("className")?sortClassName(applier.elementProperties.className+" "+className):className,applier.applyToAnyTagName=!1;var type=typeof tagNames;if("string"==type)"*"==tagNames?applier.applyToAnyTagName=!0:applier.tagNames=trim(tagNames.toLowerCase()).split(/\s*,\s*/);else if("object"==type&&"number"==typeof tagNames.length)for(applier.tagNames=[],i=0,len=tagNames.length;len>i;++i)"*"==tagNames[i]?applier.applyToAnyTagName=!0:applier.tagNames.push(tagNames[i].toLowerCase());else applier.tagNames=[applier.elementTagName]}function createClassApplier(className,options,tagNames){return new ClassApplier(className,options,tagNames)}var dom=api.dom,DomPosition=dom.DomPosition,contains=dom.arrayContains,util=api.util,forEach=util.forEach,defaultTagName="span",createElementNSSupported=util.isHostMethod(document,"createElementNS"),removeClass=function(){function replacer(matched,whiteSpaceBefore,whiteSpaceAfter){return whiteSpaceBefore&&whiteSpaceAfter?" ":""}return function(el,className){if("object"==typeof el.classList)el.classList.remove(className);else{var classNameSupported="string"==typeof el.className,elClass=classNameSupported?el.className:el.getAttribute("class");elClass=elClass.replace(new RegExp("(^|\\s)"+className+"(\\s|$)"),replacer),classNameSupported?el.className=elClass:el.setAttribute("class",elClass)}}}(),getComputedStyleProperty=dom.getComputedStyleProperty,isEditableElement=function(){var testEl=document.createElement("div");return"boolean"==typeof testEl.isContentEditable?function(node){return node&&1==node.nodeType&&node.isContentEditable}:function(node){return node&&1==node.nodeType&&"false"!=node.contentEditable?"true"==node.contentEditable||isEditableElement(node.parentNode):!1}}(),inlineDisplayRegex=/^inline(-block|-table)?$/i,htmlNonWhiteSpaceRegex=/[^\r\n\t\f \u200B]/,getPreviousMergeableTextNode=createAdjacentMergeableTextNodeGetter(!1),getNextMergeableTextNode=createAdjacentMergeableTextNodeGetter(!0);Merge.prototype={doMerge:function(positionsToPreserve){var textNodes=this.textNodes,firstTextNode=textNodes[0];if(textNodes.length>1){var parent,firstTextNodeIndex=dom.getNodeIndex(firstTextNode),textParts=[],combinedTextLength=0;forEach(textNodes,function(textNode,i){parent=textNode.parentNode,i>0&&(parent.removeChild(textNode),parent.hasChildNodes()||dom.removeNode(parent),positionsToPreserve&&forEach(positionsToPreserve,function(position){position.node==textNode&&(position.node=firstTextNode,position.offset+=combinedTextLength),position.node==parent&&position.offset>firstTextNodeIndex&&(--position.offset,position.offset==firstTextNodeIndex+1&&i<len-1&&(position.node=firstTextNode,position.offset=combinedTextLength))})),textParts[i]=textNode.data,combinedTextLength+=textNode.data.length}),firstTextNode.data=textParts.join("")}return firstTextNode.data},getLength:function(){for(var i=this.textNodes.length,len=0;i--;)len+=this.textNodes[i].length;return len},toString:function(){var textParts=[];return forEach(this.textNodes,function(textNode,i){textParts[i]="'"+textNode.data+"'"}),"[Merge("+textParts.join(",")+")]"}};var optionProperties=["elementTagName","ignoreWhiteSpace","applyToEditableOnly","useExistingElements","removeEmptyElements","onElementCreate"],attrNamesForProperties={};ClassApplier.prototype={elementTagName:defaultTagName,elementProperties:{},elementAttributes:{},ignoreWhiteSpace:!0,applyToEditableOnly:!1,useExistingElements:!0,removeEmptyElements:!0,onElementCreate:null,copyPropertiesToElement:function(props,el,createCopy){var s,elStyle,elPropsStyle,propValue,elPropValue,attrName,elProps={};for(var p in props)if(props.hasOwnProperty(p))if(propValue=props[p],elPropValue=el[p],"className"==p)addClass(el,propValue),addClass(el,this.className),el[p]=sortClassName(el[p]),createCopy&&(elProps[p]=propValue);else if("style"==p){elStyle=elPropValue,createCopy&&(elProps[p]=elPropsStyle={});for(s in props[p])props[p].hasOwnProperty(s)&&(elStyle[s]=propValue[s],createCopy&&(elPropsStyle[s]=elStyle[s]));this.attrExceptions.push(p)}else el[p]=propValue,createCopy&&(elProps[p]=el[p],attrName=attrNamesForProperties.hasOwnProperty(p)?attrNamesForProperties[p]:p,this.attrExceptions.push(attrName));return createCopy?elProps:""},copyAttributesToElement:function(attrs,el){for(var attrName in attrs)attrs.hasOwnProperty(attrName)&&!/^class(?:Name)?$/i.test(attrName)&&el.setAttribute(attrName,attrs[attrName])},appliesToElement:function(el){return contains(this.tagNames,el.tagName.toLowerCase())},getEmptyElements:function(range){var applier=this;return range.getNodes([1],function(el){return applier.appliesToElement(el)&&!el.hasChildNodes()})},hasClass:function(node){return 1==node.nodeType&&(this.applyToAnyTagName||this.appliesToElement(node))&&hasClass(node,this.className)},getSelfOrAncestorWithClass:function(node){for(;node;){if(this.hasClass(node))return node;node=node.parentNode}return null},isModifiable:function(node){return!this.applyToEditableOnly||isEditable(node)},isIgnorableWhiteSpaceNode:function(node){return this.ignoreWhiteSpace&&node&&3==node.nodeType&&isUnrenderedWhiteSpaceNode(node)},postApply:function(textNodes,range,positionsToPreserve,isUndo){var currentMerge,precedingTextNode,firstNode=textNodes[0],lastNode=textNodes[textNodes.length-1],merges=[],rangeStartNode=firstNode,rangeEndNode=lastNode,rangeStartOffset=0,rangeEndOffset=lastNode.length;forEach(textNodes,function(textNode){precedingTextNode=getPreviousMergeableTextNode(textNode,!isUndo),precedingTextNode?(currentMerge||(currentMerge=new Merge(precedingTextNode),merges.push(currentMerge)),currentMerge.textNodes.push(textNode),textNode===firstNode&&(rangeStartNode=currentMerge.textNodes[0],rangeStartOffset=rangeStartNode.length),textNode===lastNode&&(rangeEndNode=currentMerge.textNodes[0],rangeEndOffset=currentMerge.getLength())):currentMerge=null});var nextTextNode=getNextMergeableTextNode(lastNode,!isUndo);if(nextTextNode&&(currentMerge||(currentMerge=new Merge(lastNode),merges.push(currentMerge)),currentMerge.textNodes.push(nextTextNode)),merges.length){for(i=0,len=merges.length;i<len;++i)merges[i].doMerge(positionsToPreserve);range.setStartAndEnd(rangeStartNode,rangeStartOffset,rangeEndNode,rangeEndOffset)}},createContainer:function(parentNode){var namespace,doc=dom.getDocument(parentNode),el=createElementNSSupported&&!dom.isHtmlNamespace(parentNode)&&(namespace=parentNode.namespaceURI)?doc.createElementNS(parentNode.namespaceURI,this.elementTagName):doc.createElement(this.elementTagName);return this.copyPropertiesToElement(this.elementProperties,el,!1),this.copyAttributesToElement(this.elementAttributes,el),addClass(el,this.className),this.onElementCreate&&this.onElementCreate(el,this),el},elementHasProperties:function(el,props){var applier=this;return each(props,function(p,propValue){if("className"==p)return hasAllClasses(el,propValue);if("object"==typeof propValue){if(!applier.elementHasProperties(el[p],propValue))return!1}else if(el[p]!==propValue)return!1})},elementHasAttributes:function(el,attrs){return each(attrs,function(name,value){return el.getAttribute(name)!==value?!1:void 0})},applyToTextNode:function(textNode,positionsToPreserve){if(canTextBeStyled(textNode)){var parent=textNode.parentNode;if(1==parent.childNodes.length&&this.useExistingElements&&this.appliesToElement(parent)&&this.elementHasProperties(parent,this.elementProperties)&&this.elementHasAttributes(parent,this.elementAttributes))addClass(parent,this.className);else{var textNodeParent=textNode.parentNode,el=this.createContainer(textNodeParent);textNodeParent.insertBefore(el,textNode),el.appendChild(textNode)}}},isRemovable:function(el){return el.tagName.toLowerCase()==this.elementTagName&&getSortedClassName(el)==this.elementSortedClassName&&this.elementHasProperties(el,this.elementProperties)&&!elementHasNonClassAttributes(el,this.attrExceptions)&&this.elementHasAttributes(el,this.elementAttributes)&&this.isModifiable(el)},isEmptyContainer:function(el){var childNodeCount=el.childNodes.length;return 1==el.nodeType&&this.isRemovable(el)&&(0==childNodeCount||1==childNodeCount&&this.isEmptyContainer(el.firstChild))},removeEmptyContainers:function(range){var applier=this,nodesToRemove=range.getNodes([1],function(el){return applier.isEmptyContainer(el)}),rangesToPreserve=[range],positionsToPreserve=getRangeBoundaries(rangesToPreserve);forEach(nodesToRemove,function(node){removePreservingPositions(node,positionsToPreserve)}),updateRangesFromBoundaries(rangesToPreserve,positionsToPreserve)},undoToTextNode:function(textNode,range,ancestorWithClass,positionsToPreserve){if(!range.containsNode(ancestorWithClass)){var ancestorRange=range.cloneRange();ancestorRange.selectNode(ancestorWithClass),ancestorRange.isPointInRange(range.endContainer,range.endOffset)&&(splitNodeAt(ancestorWithClass,range.endContainer,range.endOffset,positionsToPreserve),range.setEndAfter(ancestorWithClass)),ancestorRange.isPointInRange(range.startContainer,range.startOffset)&&(ancestorWithClass=splitNodeAt(ancestorWithClass,range.startContainer,range.startOffset,positionsToPreserve))}this.isRemovable(ancestorWithClass)?replaceWithOwnChildrenPreservingPositions(ancestorWithClass,positionsToPreserve):removeClass(ancestorWithClass,this.className)},splitAncestorWithClass:function(container,offset,positionsToPreserve){var ancestorWithClass=this.getSelfOrAncestorWithClass(container);ancestorWithClass&&splitNodeAt(ancestorWithClass,container,offset,positionsToPreserve)},undoToAncestor:function(ancestorWithClass,positionsToPreserve){this.isRemovable(ancestorWithClass)?replaceWithOwnChildrenPreservingPositions(ancestorWithClass,positionsToPreserve):removeClass(ancestorWithClass,this.className)},applyToRange:function(range,rangesToPreserve){var applier=this;rangesToPreserve=rangesToPreserve||[];var positionsToPreserve=getRangeBoundaries(rangesToPreserve||[]);range.splitBoundariesPreservingPositions(positionsToPreserve),applier.removeEmptyElements&&applier.removeEmptyContainers(range);var textNodes=getEffectiveTextNodes(range);if(textNodes.length){forEach(textNodes,function(textNode){applier.isIgnorableWhiteSpaceNode(textNode)||applier.getSelfOrAncestorWithClass(textNode)||!applier.isModifiable(textNode)||applier.applyToTextNode(textNode,positionsToPreserve)});var lastTextNode=textNodes[textNodes.length-1];range.setStartAndEnd(textNodes[0],0,lastTextNode,lastTextNode.length),applier.normalize&&applier.postApply(textNodes,range,positionsToPreserve,!1),updateRangesFromBoundaries(rangesToPreserve,positionsToPreserve)}var emptyElements=applier.getEmptyElements(range);forEach(emptyElements,function(el){addClass(el,applier.className)})},applyToRanges:function(ranges){for(var i=ranges.length;i--;)this.applyToRange(ranges[i],ranges);return ranges},applyToSelection:function(win){var sel=api.getSelection(win);sel.setRanges(this.applyToRanges(sel.getAllRanges()))},undoToRange:function(range,rangesToPreserve){var applier=this;rangesToPreserve=rangesToPreserve||[];var positionsToPreserve=getRangeBoundaries(rangesToPreserve);range.splitBoundariesPreservingPositions(positionsToPreserve),applier.removeEmptyElements&&applier.removeEmptyContainers(range,positionsToPreserve);var textNode,ancestorWithClass,textNodes=getEffectiveTextNodes(range),lastTextNode=textNodes[textNodes.length-1];if(textNodes.length){applier.splitAncestorWithClass(range.endContainer,range.endOffset,positionsToPreserve),applier.splitAncestorWithClass(range.startContainer,range.startOffset,positionsToPreserve);for(var i=0,len=textNodes.length;len>i;++i)textNode=textNodes[i],ancestorWithClass=applier.getSelfOrAncestorWithClass(textNode),ancestorWithClass&&applier.isModifiable(textNode)&&applier.undoToAncestor(ancestorWithClass,positionsToPreserve);range.setStartAndEnd(textNodes[0],0,lastTextNode,lastTextNode.length),applier.normalize&&applier.postApply(textNodes,range,positionsToPreserve,!0),updateRangesFromBoundaries(rangesToPreserve,positionsToPreserve)}var emptyElements=applier.getEmptyElements(range);forEach(emptyElements,function(el){removeClass(el,applier.className)})},undoToRanges:function(ranges){for(var i=ranges.length;i--;)this.undoToRange(ranges[i],ranges);return ranges},undoToSelection:function(win){var sel=api.getSelection(win),ranges=api.getSelection(win).getAllRanges();this.undoToRanges(ranges),sel.setRanges(ranges)},isAppliedToRange:function(range){if(range.collapsed||""==range.toString())return!!this.getSelfOrAncestorWithClass(range.commonAncestorContainer);var textNodes=range.getNodes([3]);if(textNodes.length)for(var textNode,i=0;textNode=textNodes[i++];)if(!this.isIgnorableWhiteSpaceNode(textNode)&&rangeSelectsAnyText(range,textNode)&&this.isModifiable(textNode)&&!this.getSelfOrAncestorWithClass(textNode))return!1;return!0},isAppliedToRanges:function(ranges){var i=ranges.length;if(0==i)return!1;for(;i--;)if(!this.isAppliedToRange(ranges[i]))return!1;return!0},isAppliedToSelection:function(win){var sel=api.getSelection(win);return this.isAppliedToRanges(sel.getAllRanges())},toggleRange:function(range){this.isAppliedToRange(range)?this.undoToRange(range):this.applyToRange(range)},toggleSelection:function(win){this.isAppliedToSelection(win)?this.undoToSelection(win):this.applyToSelection(win)},getElementsWithClassIntersectingRange:function(range){var elements=[],applier=this;return range.getNodes([3],function(textNode){var el=applier.getSelfOrAncestorWithClass(textNode);el&&!contains(elements,el)&&elements.push(el)}),elements},detach:function(){}},ClassApplier.util={hasClass:hasClass,addClass:addClass,removeClass:removeClass,getClass:getClass,hasSameClasses:haveSameClasses,hasAllClasses:hasAllClasses,replaceWithOwnChildren:replaceWithOwnChildrenPreservingPositions,elementsHaveSameNonClassAttributes:elementsHaveSameNonClassAttributes,elementHasNonClassAttributes:elementHasNonClassAttributes,splitNodeAt:splitNodeAt,isEditableElement:isEditableElement,isEditingHost:isEditingHost,isEditable:isEditable},api.CssClassApplier=api.ClassApplier=ClassApplier,api.createClassApplier=createClassApplier,util.createAliasForDeprecatedMethod(api,"createCssClassApplier","createClassApplier",module)}),rangy},this),/**
 * Highlighter module for Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core, ClassApplier and optionally TextRange modules.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(factory,root){"function"==typeof define&&define.amd?define(["./rangy-core"],factory):"undefined"!=typeof module&&"object"==typeof exports?module.exports=factory(require("rangy")):factory(root.rangy)}(function(rangy){return rangy.createModule("Highlighter",["ClassApplier"],function(api,module){function compareHighlights(h1,h2){return h1.characterRange.start-h2.characterRange.start}function getContainerElement(doc,id){return id?doc.getElementById(id):getBody(doc)}function HighlighterType(type,converterCreator){this.type=type,this.converterCreator=converterCreator}function registerHighlighterType(type,converterCreator){highlighterTypes[type]=new HighlighterType(type,converterCreator)}function getConverter(type){var highlighterType=highlighterTypes[type];if(highlighterType instanceof HighlighterType)return highlighterType.create();throw new Error("Highlighter type '"+type+"' is not valid")}function CharacterRange(start,end){this.start=start,this.end=end}function Highlight(doc,characterRange,classApplier,converter,id,containerElementId){id?(this.id=id,nextHighlightId=Math.max(nextHighlightId,id+1)):this.id=nextHighlightId++,this.characterRange=characterRange,this.doc=doc,this.classApplier=classApplier,this.converter=converter,this.containerElementId=containerElementId||null,this.applied=!1}function Highlighter(doc,type){type=type||"textContent",this.doc=doc||document,this.classAppliers={},this.highlights=[],this.converter=getConverter(type)}var dom=api.dom,contains=dom.arrayContains,getBody=dom.getBody,createOptions=api.util.createOptions,forEach=api.util.forEach,nextHighlightId=1,highlighterTypes={};HighlighterType.prototype.create=function(){var converter=this.converterCreator();return converter.type=this.type,converter},api.registerHighlighterType=registerHighlighterType,CharacterRange.prototype={intersects:function(charRange){return this.start<charRange.end&&this.end>charRange.start},isContiguousWith:function(charRange){return this.start==charRange.end||this.end==charRange.start},union:function(charRange){return new CharacterRange(Math.min(this.start,charRange.start),Math.max(this.end,charRange.end))},intersection:function(charRange){return new CharacterRange(Math.max(this.start,charRange.start),Math.min(this.end,charRange.end))},getComplements:function(charRange){var ranges=[];if(this.start>=charRange.start){if(this.end<=charRange.end)return[];ranges.push(new CharacterRange(charRange.end,this.end))}else ranges.push(new CharacterRange(this.start,Math.min(this.end,charRange.start))),this.end>charRange.end&&ranges.push(new CharacterRange(charRange.end,this.end));return ranges},toString:function(){return"[CharacterRange("+this.start+", "+this.end+")]"}},CharacterRange.fromCharacterRange=function(charRange){return new CharacterRange(charRange.start,charRange.end)};var textContentConverter={rangeToCharacterRange:function(range,containerNode){var bookmark=range.getBookmark(containerNode);return new CharacterRange(bookmark.start,bookmark.end)},characterRangeToRange:function(doc,characterRange,containerNode){var range=api.createRange(doc);return range.moveToBookmark({start:characterRange.start,end:characterRange.end,containerNode:containerNode}),range},serializeSelection:function(selection,containerNode){for(var ranges=selection.getAllRanges(),rangeCount=ranges.length,rangeInfos=[],backward=1==rangeCount&&selection.isBackward(),i=0,len=ranges.length;len>i;++i)rangeInfos[i]={characterRange:this.rangeToCharacterRange(ranges[i],containerNode),backward:backward};return rangeInfos},restoreSelection:function(selection,savedSelection,containerNode){selection.removeAllRanges();for(var range,rangeInfo,characterRange,doc=selection.win.document,i=0,len=savedSelection.length;len>i;++i)rangeInfo=savedSelection[i],characterRange=rangeInfo.characterRange,range=this.characterRangeToRange(doc,rangeInfo.characterRange,containerNode),selection.addRange(range,rangeInfo.backward)}};registerHighlighterType("textContent",function(){return textContentConverter}),registerHighlighterType("TextRange",function(){var converter;return function(){if(!converter){var textRangeModule=api.modules.TextRange;if(!textRangeModule)throw new Error("TextRange module is missing.");if(!textRangeModule.supported)throw new Error("TextRange module is present but not supported.");converter={rangeToCharacterRange:function(range,containerNode){return CharacterRange.fromCharacterRange(range.toCharacterRange(containerNode))},characterRangeToRange:function(doc,characterRange,containerNode){var range=api.createRange(doc);return range.selectCharacters(containerNode,characterRange.start,characterRange.end),range},serializeSelection:function(selection,containerNode){return selection.saveCharacterRanges(containerNode)},restoreSelection:function(selection,savedSelection,containerNode){selection.restoreCharacterRanges(containerNode,savedSelection)}}}return converter}}()),Highlight.prototype={getContainerElement:function(){return getContainerElement(this.doc,this.containerElementId)},getRange:function(){return this.converter.characterRangeToRange(this.doc,this.characterRange,this.getContainerElement())},fromRange:function(range){this.characterRange=this.converter.rangeToCharacterRange(range,this.getContainerElement())},getText:function(){return this.getRange().toString()},containsElement:function(el){return this.getRange().containsNodeContents(el.firstChild)},unapply:function(){this.classApplier.undoToRange(this.getRange()),this.applied=!1},apply:function(){this.classApplier.applyToRange(this.getRange()),this.applied=!0},getHighlightElements:function(){return this.classApplier.getElementsWithClassIntersectingRange(this.getRange())},toString:function(){return"[Highlight(ID: "+this.id+", class: "+this.classApplier.className+", character range: "+this.characterRange.start+" - "+this.characterRange.end+")]"}},Highlighter.prototype={addClassApplier:function(classApplier){this.classAppliers[classApplier.className]=classApplier},getHighlightForElement:function(el){for(var highlights=this.highlights,i=0,len=highlights.length;len>i;++i)if(highlights[i].containsElement(el))return highlights[i];return null},removeHighlights:function(highlights){for(var highlight,i=0,len=this.highlights.length;len>i;++i)highlight=this.highlights[i],contains(highlights,highlight)&&(highlight.unapply(),this.highlights.splice(i--,1))},removeAllHighlights:function(){this.removeHighlights(this.highlights)},getIntersectingHighlights:function(ranges){var intersectingHighlights=[],highlights=this.highlights;return forEach(ranges,function(range){forEach(highlights,function(highlight){range.intersectsRange(highlight.getRange())&&!contains(intersectingHighlights,highlight)&&intersectingHighlights.push(highlight)})}),intersectingHighlights},highlightCharacterRanges:function(className,charRanges,options){var i,len,j,highlights=this.highlights,converter=this.converter,doc=this.doc,highlightsToRemove=[],classApplier=className?this.classAppliers[className]:null;options=createOptions(options,{containerElementId:null,exclusive:!0});var containerElement,containerElementRange,containerElementCharRange,containerElementId=options.containerElementId,exclusive=options.exclusive;containerElementId&&(containerElement=this.doc.getElementById(containerElementId),containerElement&&(containerElementRange=api.createRange(this.doc),containerElementRange.selectNodeContents(containerElement),containerElementCharRange=new CharacterRange(0,containerElementRange.toString().length)));var charRange,highlightCharRange,removeHighlight,isSameClassApplier,highlightsToKeep,splitHighlight;for(i=0,len=charRanges.length;len>i;++i)if(charRange=charRanges[i],highlightsToKeep=[],containerElementCharRange&&(charRange=charRange.intersection(containerElementCharRange)),charRange.start!=charRange.end){for(j=0;j<highlights.length;++j)removeHighlight=!1,containerElementId==highlights[j].containerElementId&&(highlightCharRange=highlights[j].characterRange,isSameClassApplier=classApplier==highlights[j].classApplier,splitHighlight=!isSameClassApplier&&exclusive,(highlightCharRange.intersects(charRange)||highlightCharRange.isContiguousWith(charRange))&&(isSameClassApplier||splitHighlight)&&(splitHighlight&&forEach(highlightCharRange.getComplements(charRange),function(rangeToAdd){highlightsToKeep.push(new Highlight(doc,rangeToAdd,highlights[j].classApplier,converter,null,containerElementId))}),removeHighlight=!0,isSameClassApplier&&(charRange=highlightCharRange.union(charRange)))),removeHighlight?(highlightsToRemove.push(highlights[j]),highlights[j]=new Highlight(doc,highlightCharRange.union(charRange),classApplier,converter,null,containerElementId)):highlightsToKeep.push(highlights[j]);classApplier&&highlightsToKeep.push(new Highlight(doc,charRange,classApplier,converter,null,containerElementId)),this.highlights=highlights=highlightsToKeep}forEach(highlightsToRemove,function(highlightToRemove){highlightToRemove.unapply()});var newHighlights=[];return forEach(highlights,function(highlight){highlight.applied||(highlight.apply(),newHighlights.push(highlight))}),newHighlights},highlightRanges:function(className,ranges,options){var selCharRanges=[],converter=this.converter;options=createOptions(options,{containerElement:null,exclusive:!0});var containerElementRange,containerElement=options.containerElement,containerElementId=containerElement?containerElement.id:null;return containerElement&&(containerElementRange=api.createRange(containerElement),containerElementRange.selectNodeContents(containerElement)),forEach(ranges,function(range){var scopedRange=containerElement?containerElementRange.intersection(range):range;selCharRanges.push(converter.rangeToCharacterRange(scopedRange,containerElement||getBody(range.getDocument())))}),this.highlightCharacterRanges(className,selCharRanges,{containerElementId:containerElementId,exclusive:options.exclusive})},highlightSelection:function(className,options){var converter=this.converter,classApplier=className?this.classAppliers[className]:!1;options=createOptions(options,{containerElementId:null,selection:api.getSelection(this.doc),exclusive:!0});var containerElementId=options.containerElementId,exclusive=options.exclusive,selection=options.selection,doc=selection.win.document,containerElement=getContainerElement(doc,containerElementId);if(!classApplier&&className!==!1)throw new Error("No class applier found for class '"+className+"'");var serializedSelection=converter.serializeSelection(selection,containerElement),selCharRanges=[];forEach(serializedSelection,function(rangeInfo){selCharRanges.push(CharacterRange.fromCharacterRange(rangeInfo.characterRange))});var newHighlights=this.highlightCharacterRanges(className,selCharRanges,{containerElementId:containerElementId,exclusive:exclusive});return converter.restoreSelection(selection,serializedSelection,containerElement),newHighlights},unhighlightSelection:function(selection){selection=selection||api.getSelection(this.doc);var intersectingHighlights=this.getIntersectingHighlights(selection.getAllRanges());return this.removeHighlights(intersectingHighlights),selection.removeAllRanges(),intersectingHighlights},getHighlightsInSelection:function(selection){return selection=selection||api.getSelection(this.doc),this.getIntersectingHighlights(selection.getAllRanges())},selectionOverlapsHighlight:function(selection){return this.getHighlightsInSelection(selection).length>0},serialize:function(options){var serializedType,serializedHighlights,convertType,serializationConverter,highlighter=this,highlights=highlighter.highlights;return highlights.sort(compareHighlights),options=createOptions(options,{serializeHighlightText:!1,type:highlighter.converter.type}),serializedType=options.type,convertType=serializedType!=highlighter.converter.type,convertType&&(serializationConverter=getConverter(serializedType)),serializedHighlights=["type:"+serializedType],forEach(highlights,function(highlight){var containerElement,characterRange=highlight.characterRange;convertType&&(containerElement=highlight.getContainerElement(),characterRange=serializationConverter.rangeToCharacterRange(highlighter.converter.characterRangeToRange(highlighter.doc,characterRange,containerElement),containerElement));var parts=[characterRange.start,characterRange.end,highlight.id,highlight.classApplier.className,highlight.containerElementId];options.serializeHighlightText&&parts.push(highlight.getText()),serializedHighlights.push(parts.join("$"))}),serializedHighlights.join("|")},deserialize:function(serialized){var regexResult,serializationType,serializationConverter,serializedHighlights=serialized.split("|"),highlights=[],firstHighlight=serializedHighlights[0],convertType=!1;if(!firstHighlight||!(regexResult=/^type:(\w+)$/.exec(firstHighlight)))throw new Error("Serialized highlights are invalid.");serializationType=regexResult[1],serializationType!=this.converter.type&&(serializationConverter=getConverter(serializationType),convertType=!0),serializedHighlights.shift();for(var classApplier,highlight,characterRange,containerElementId,containerElement,parts,i=serializedHighlights.length;i-->0;){if(parts=serializedHighlights[i].split("$"),characterRange=new CharacterRange(+parts[0],+parts[1]),containerElementId=parts[4]||null,convertType&&(containerElement=getContainerElement(this.doc,containerElementId),characterRange=this.converter.rangeToCharacterRange(serializationConverter.characterRangeToRange(this.doc,characterRange,containerElement),containerElement)),classApplier=this.classAppliers[parts[3]],!classApplier)throw new Error("No class applier found for class '"+parts[3]+"'");highlight=new Highlight(this.doc,characterRange,classApplier,this.converter,parseInt(parts[2]),containerElementId),highlight.apply(),highlights.push(highlight)}this.highlights=highlights}},api.Highlighter=Highlighter,api.createHighlighter=function(doc,rangeCharacterOffsetConverterType){return new Highlighter(doc,rangeCharacterOffsetConverterType)}}),rangy},this),/**
 * Selection save and restore module for Rangy.
 * Saves and restores user selections using marker invisible elements in the DOM.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(factory,root){"function"==typeof define&&define.amd?define(["./rangy-core"],factory):"undefined"!=typeof module&&"object"==typeof exports?module.exports=factory(require("rangy")):factory(root.rangy)}(function(rangy){return rangy.createModule("SaveRestore",["WrappedRange"],function(api,module){function gEBI(id,doc){return(doc||document).getElementById(id)}function insertRangeBoundaryMarker(range,atStart){var markerEl,markerId="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),doc=dom.getDocument(range.startContainer),boundaryRange=range.cloneRange();return boundaryRange.collapse(atStart),markerEl=doc.createElement("span"),markerEl.id=markerId,markerEl.style.lineHeight="0",markerEl.style.display="none",markerEl.className="rangySelectionBoundary",markerEl.appendChild(doc.createTextNode(markerTextChar)),boundaryRange.insertNode(markerEl),markerEl}function setRangeBoundary(doc,range,markerId,atStart){var markerEl=gEBI(markerId,doc);markerEl?(range[atStart?"setStartBefore":"setEndBefore"](markerEl),removeNode(markerEl)):module.warn("Marker element has been removed. Cannot restore selection.")}function compareRanges(r1,r2){return r2.compareBoundaryPoints(r1.START_TO_START,r1)}function saveRange(range,direction){var startEl,endEl,doc=api.DomRange.getRangeDocument(range),text=range.toString(),backward=isDirectionBackward(direction);return range.collapsed?(endEl=insertRangeBoundaryMarker(range,!1),{document:doc,markerId:endEl.id,collapsed:!0}):(endEl=insertRangeBoundaryMarker(range,!1),startEl=insertRangeBoundaryMarker(range,!0),{document:doc,startMarkerId:startEl.id,endMarkerId:endEl.id,collapsed:!1,backward:backward,toString:function(){return"original text: '"+text+"', new text: '"+range.toString()+"'"}})}function restoreRange(rangeInfo,normalize){var doc=rangeInfo.document;"undefined"==typeof normalize&&(normalize=!0);var range=api.createRange(doc);if(rangeInfo.collapsed){var markerEl=gEBI(rangeInfo.markerId,doc);if(markerEl){markerEl.style.display="inline";var previousNode=markerEl.previousSibling;previousNode&&3==previousNode.nodeType?(removeNode(markerEl),range.collapseToPoint(previousNode,previousNode.length)):(range.collapseBefore(markerEl),removeNode(markerEl))}else module.warn("Marker element has been removed. Cannot restore selection.")}else setRangeBoundary(doc,range,rangeInfo.startMarkerId,!0),setRangeBoundary(doc,range,rangeInfo.endMarkerId,!1);return normalize&&range.normalizeBoundaries(),range}function saveRanges(ranges,direction){var range,doc,rangeInfos=[],backward=isDirectionBackward(direction);ranges=ranges.slice(0),ranges.sort(compareRanges);for(var i=0,len=ranges.length;len>i;++i)rangeInfos[i]=saveRange(ranges[i],backward);for(i=len-1;i>=0;--i)range=ranges[i],doc=api.DomRange.getRangeDocument(range),range.collapsed?range.collapseAfter(gEBI(rangeInfos[i].markerId,doc)):(range.setEndBefore(gEBI(rangeInfos[i].endMarkerId,doc)),range.setStartAfter(gEBI(rangeInfos[i].startMarkerId,doc)));return rangeInfos}function saveSelection(win){if(!api.isSelectionValid(win))return module.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var sel=api.getSelection(win),ranges=sel.getAllRanges(),backward=1==ranges.length&&sel.isBackward(),rangeInfos=saveRanges(ranges,backward);return backward?sel.setSingleRange(ranges[0],backward):sel.setRanges(ranges),{win:win,rangeInfos:rangeInfos,restored:!1}}function restoreRanges(rangeInfos){for(var ranges=[],rangeCount=rangeInfos.length,i=rangeCount-1;i>=0;i--)ranges[i]=restoreRange(rangeInfos[i],!0);return ranges}function restoreSelection(savedSelection,preserveDirection){if(!savedSelection.restored){var rangeInfos=savedSelection.rangeInfos,sel=api.getSelection(savedSelection.win),ranges=restoreRanges(rangeInfos),rangeCount=rangeInfos.length;1==rangeCount&&preserveDirection&&api.features.selectionHasExtend&&rangeInfos[0].backward?(sel.removeAllRanges(),sel.addRange(ranges[0],!0)):sel.setRanges(ranges),savedSelection.restored=!0}}function removeMarkerElement(doc,markerId){var markerEl=gEBI(markerId,doc);markerEl&&removeNode(markerEl)}function removeMarkers(savedSelection){for(var rangeInfo,rangeInfos=savedSelection.rangeInfos,i=0,len=rangeInfos.length;len>i;++i)rangeInfo=rangeInfos[i],rangeInfo.collapsed?removeMarkerElement(savedSelection.doc,rangeInfo.markerId):(removeMarkerElement(savedSelection.doc,rangeInfo.startMarkerId),removeMarkerElement(savedSelection.doc,rangeInfo.endMarkerId))}var dom=api.dom,removeNode=dom.removeNode,isDirectionBackward=api.Selection.isDirectionBackward,markerTextChar="\ufeff";api.util.extend(api,{saveRange:saveRange,restoreRange:restoreRange,saveRanges:saveRanges,restoreRanges:restoreRanges,saveSelection:saveSelection,restoreSelection:restoreSelection,removeMarkerElement:removeMarkerElement,removeMarkers:removeMarkers})}),rangy},this),/**
 * Serializer module for Rangy.
 * Serializes Ranges and Selections. An example use would be to store a user's selection on a particular page in a
 * cookie or local storage and restore it on the user's next visit to the same page.
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(factory,root){"function"==typeof define&&define.amd?define(["./rangy-core"],factory):"undefined"!=typeof module&&"object"==typeof exports?module.exports=factory(require("rangy")):factory(root.rangy)}(function(rangy){return rangy.createModule("Serializer",["WrappedSelection"],function(api,module){function escapeTextForHtml(str){return str.replace(/</g,"&lt;").replace(/>/g,"&gt;")}function nodeToInfoString(node,infoParts){infoParts=infoParts||[];var nodeType=node.nodeType,children=node.childNodes,childCount=children.length,nodeInfo=[nodeType,node.nodeName,childCount].join(":"),start="",end="";switch(nodeType){case 3:start=escapeTextForHtml(node.nodeValue);break;case 8:start="<!--"+escapeTextForHtml(node.nodeValue)+"-->";break;default:start="<"+nodeInfo+">",end="</>"}start&&infoParts.push(start);for(var i=0;childCount>i;++i)nodeToInfoString(children[i],infoParts);return end&&infoParts.push(end),infoParts}function getElementChecksum(el){var info=nodeToInfoString(el).join("");return crc32(info).toString(16)}function serializePosition(node,offset,rootNode){var pathParts=[],n=node;for(rootNode=rootNode||dom.getDocument(node).documentElement;n&&n!=rootNode;)pathParts.push(dom.getNodeIndex(n,!0)),n=n.parentNode;return pathParts.join("/")+":"+offset}function deserializePosition(serialized,rootNode,doc){rootNode||(rootNode=(doc||document).documentElement);for(var nodeIndex,parts=serialized.split(":"),node=rootNode,nodeIndices=parts[0]?parts[0].split("/"):[],i=nodeIndices.length;i--;){if(nodeIndex=parseInt(nodeIndices[i],10),!(nodeIndex<node.childNodes.length))throw module.createError("deserializePosition() failed: node "+dom.inspectNode(node)+" has no child with index "+nodeIndex+", "+i);node=node.childNodes[nodeIndex]}return new dom.DomPosition(node,parseInt(parts[1],10))}function serializeRange(range,omitChecksum,rootNode){if(rootNode=rootNode||api.DomRange.getRangeDocument(range).documentElement,!dom.isOrIsAncestorOf(rootNode,range.commonAncestorContainer))throw module.createError("serializeRange(): range "+range.inspect()+" is not wholly contained within specified root node "+dom.inspectNode(rootNode));var serialized=serializePosition(range.startContainer,range.startOffset,rootNode)+","+serializePosition(range.endContainer,range.endOffset,rootNode);return omitChecksum||(serialized+="{"+getElementChecksum(rootNode)+"}"),serialized}function deserializeRange(serialized,rootNode,doc){rootNode?doc=doc||dom.getDocument(rootNode):(doc=doc||document,rootNode=doc.documentElement);var result=deserializeRegex.exec(serialized),checksum=result[4];if(checksum){var rootNodeChecksum=getElementChecksum(rootNode);if(checksum!==rootNodeChecksum)throw module.createError("deserializeRange(): checksums of serialized range root node ("+checksum+") and target root node ("+rootNodeChecksum+") do not match")}var start=deserializePosition(result[1],rootNode,doc),end=deserializePosition(result[2],rootNode,doc),range=api.createRange(doc);return range.setStartAndEnd(start.node,start.offset,end.node,end.offset),range}function canDeserializeRange(serialized,rootNode,doc){rootNode||(rootNode=(doc||document).documentElement);var result=deserializeRegex.exec(serialized),checksum=result[3];return!checksum||checksum===getElementChecksum(rootNode)}function serializeSelection(selection,omitChecksum,rootNode){selection=api.getSelection(selection);for(var ranges=selection.getAllRanges(),serializedRanges=[],i=0,len=ranges.length;len>i;++i)serializedRanges[i]=serializeRange(ranges[i],omitChecksum,rootNode);return serializedRanges.join("|")}function deserializeSelection(serialized,rootNode,win){rootNode?win=win||dom.getWindow(rootNode):(win=win||window,rootNode=win.document.documentElement);for(var serializedRanges=serialized.split("|"),sel=api.getSelection(win),ranges=[],i=0,len=serializedRanges.length;len>i;++i)ranges[i]=deserializeRange(serializedRanges[i],rootNode,win.document);return sel.setRanges(ranges),sel}function canDeserializeSelection(serialized,rootNode,win){var doc;rootNode?doc=win?win.document:dom.getDocument(rootNode):(win=win||window,rootNode=win.document.documentElement);for(var serializedRanges=serialized.split("|"),i=0,len=serializedRanges.length;len>i;++i)if(!canDeserializeRange(serializedRanges[i],rootNode,doc))return!1;return!0}function getSerializedSelectionFromCookie(cookie){for(var nameVal,val,parts=cookie.split(/[;,]/),i=0,len=parts.length;len>i;++i)if(nameVal=parts[i].split("="),nameVal[0].replace(/^\s+/,"")==cookieName&&(val=nameVal[1]))return decodeURIComponent(val.replace(/\s+$/,""));return null}function restoreSelectionFromCookie(win){win=win||window;var serialized=getSerializedSelectionFromCookie(win.document.cookie);serialized&&deserializeSelection(serialized,win.doc)}function saveSelectionCookie(win,props){win=win||window,props="object"==typeof props?props:{};var expires=props.expires?";expires="+props.expires.toUTCString():"",path=props.path?";path="+props.path:"",domain=props.domain?";domain="+props.domain:"",secure=props.secure?";secure":"",serialized=serializeSelection(api.getSelection(win));win.document.cookie=encodeURIComponent(cookieName)+"="+encodeURIComponent(serialized)+expires+path+domain+secure}var UNDEF="undefined",util=api.util;(typeof encodeURIComponent==UNDEF||typeof decodeURIComponent==UNDEF)&&module.fail("encodeURIComponent and/or decodeURIComponent method is missing");var crc32=function(){function utf8encode(str){for(var c,utf8CharCodes=[],i=0,len=str.length;len>i;++i)c=str.charCodeAt(i),128>c?utf8CharCodes.push(c):2048>c?utf8CharCodes.push(c>>6|192,63&c|128):utf8CharCodes.push(c>>12|224,c>>6&63|128,63&c|128);return utf8CharCodes}function buildCRCTable(){for(var j,crc,table=[],i=0;256>i;++i){for(crc=i,j=8;j--;)1==(1&crc)?crc=crc>>>1^3988292384:crc>>>=1;table[i]=crc>>>0}return table}function getCrcTable(){return cachedCrcTable||(cachedCrcTable=buildCRCTable()),cachedCrcTable}var cachedCrcTable=null;return function(str){for(var y,utf8CharCodes=utf8encode(str),crc=-1,crcTable=getCrcTable(),i=0,len=utf8CharCodes.length;len>i;++i)y=255&(crc^utf8CharCodes[i]),crc=crc>>>8^crcTable[y];return(-1^crc)>>>0}}(),dom=api.dom,deserializeRegex=/^([^,]+),([^,\{]+)(\{([^}]+)\})?$/,cookieName="rangySerializedSelection";util.extend(api,{serializePosition:serializePosition,deserializePosition:deserializePosition,serializeRange:serializeRange,deserializeRange:deserializeRange,canDeserializeRange:canDeserializeRange,serializeSelection:serializeSelection,deserializeSelection:deserializeSelection,canDeserializeSelection:canDeserializeSelection,restoreSelectionFromCookie:restoreSelectionFromCookie,saveSelectionCookie:saveSelectionCookie,getElementChecksum:getElementChecksum,nodeToInfoString:nodeToInfoString}),util.crc32=crc32}),rangy},this),/**
 * Text range module for Rangy.
 * Text-based manipulation and searching of ranges and selections.
 *
 * Features
 *
 * - Ability to move range boundaries by character or word offsets
 * - Customizable word tokenizer
 * - Ignores text nodes inside <script> or <style> elements or those hidden by CSS display and visibility properties
 * - Range findText method to search for text or regex within the page or within a range. Flags for whole words and case
 *   sensitivity
 * - Selection and range save/restore as text offsets within a node
 * - Methods to return visible text within a range or selection
 * - innerText method for elements
 *
 * References
 *
 * https://www.w3.org/Bugs/Public/show_bug.cgi?id=13145
 * http://aryeh.name/spec/innertext/innertext.html
 * http://dvcs.w3.org/hg/editing/raw-file/tip/editing.html
 *
 * Part of Rangy, a cross-browser JavaScript range and selection library
 * https://github.com/timdown/rangy
 *
 * Depends on Rangy core.
 *
 * Copyright 2015, Tim Down
 * Licensed under the MIT license.
 * Version: 1.3.0
 * Build date: 10 May 2015
 */
function(factory,root){"function"==typeof define&&define.amd?define(["./rangy-core"],factory):"undefined"!=typeof module&&"object"==typeof exports?module.exports=factory(require("rangy")):factory(root.rangy)}(function(rangy){return rangy.createModule("TextRange",["WrappedSelection"],function(api,module){function defaultTokenizer(chars,wordOptions){function createTokenRange(start,end,isWord){tokenRanges.push({start:start,end:end,isWord:isWord})}for(var result,wordStart,wordEnd,word=chars.join(""),tokenRanges=[],lastWordEnd=0;result=wordOptions.wordRegex.exec(word);){if(wordStart=result.index,wordEnd=wordStart+result[0].length,wordStart>lastWordEnd&&createTokenRange(lastWordEnd,wordStart,!1),wordOptions.includeTrailingSpace)for(;nonLineBreakWhiteSpaceRegex.test(chars[wordEnd]);)++wordEnd;createTokenRange(wordStart,wordEnd,!0),lastWordEnd=wordEnd}return lastWordEnd<chars.length&&createTokenRange(lastWordEnd,chars.length,!1),tokenRanges}function convertCharRangeToToken(chars,tokenRange){for(var tokenChars=chars.slice(tokenRange.start,tokenRange.end),token={isWord:tokenRange.isWord,chars:tokenChars,toString:function(){return tokenChars.join("")}},i=0,len=tokenChars.length;len>i;++i)tokenChars[i].token=token;return token}function tokenize(chars,wordOptions,tokenizer){for(var tokenRange,tokenRanges=tokenizer(chars,wordOptions),tokens=[],i=0;tokenRange=tokenRanges[i++];)tokens.push(convertCharRangeToToken(chars,tokenRange));return tokens}function normalizeIgnoredCharacters(ignoredCharacters){var ignoredChars=ignoredCharacters||"",ignoredCharsArray="string"==typeof ignoredChars?ignoredChars.split(""):ignoredChars;return ignoredCharsArray.sort(function(char1,char2){return char1.charCodeAt(0)-char2.charCodeAt(0)}),ignoredCharsArray.join("").replace(/(.)\1+/g,"$1")}function createWordOptions(options){var lang,defaults;return options?(lang=options.language||defaultLanguage,defaults={},extend(defaults,defaultWordOptions[lang]||defaultWordOptions[defaultLanguage]),extend(defaults,options),defaults):defaultWordOptions[defaultLanguage]}function createNestedOptions(optionsParam,defaults){var options=createOptions(optionsParam,defaults);return defaults.hasOwnProperty("wordOptions")&&(options.wordOptions=createWordOptions(options.wordOptions)),defaults.hasOwnProperty("characterOptions")&&(options.characterOptions=createOptions(options.characterOptions,defaultCharacterOptions)),options}function getComputedDisplay(el,win){var display=getComputedStyleProperty(el,"display",win),tagName=el.tagName.toLowerCase();return"block"==display&&tableCssDisplayBlock&&defaultDisplayValueForTag.hasOwnProperty(tagName)?defaultDisplayValueForTag[tagName]:display}function isHidden(node){for(var ancestors=getAncestorsAndSelf(node),i=0,len=ancestors.length;len>i;++i)if(1==ancestors[i].nodeType&&"none"==getComputedDisplay(ancestors[i]))return!0;return!1}function isVisibilityHiddenTextNode(textNode){var el;return 3==textNode.nodeType&&(el=textNode.parentNode)&&"hidden"==getComputedStyleProperty(el,"visibility")}function isBlockNode(node){return node&&(1==node.nodeType&&!/^(inline(-block|-table)?|none)$/.test(getComputedDisplay(node))||9==node.nodeType||11==node.nodeType)}function containsPositions(node){return dom.isCharacterDataNode(node)||!/^(area|base|basefont|br|col|frame|hr|img|input|isindex|link|meta|param)$/i.test(node.nodeName)}function getAncestors(node){for(var ancestors=[];node.parentNode;)ancestors.unshift(node.parentNode),node=node.parentNode;return ancestors}function getAncestorsAndSelf(node){return getAncestors(node).concat([node])}function nextNodeDescendants(node){for(;node&&!node.nextSibling;)node=node.parentNode;return node?node.nextSibling:null}function nextNode(node,excludeChildren){return!excludeChildren&&node.hasChildNodes()?node.firstChild:nextNodeDescendants(node)}function previousNode(node){var previous=node.previousSibling;if(previous){for(node=previous;node.hasChildNodes();)node=node.lastChild;return node}var parent=node.parentNode;return parent&&1==parent.nodeType?parent:null}function isWhitespaceNode(node){if(!node||3!=node.nodeType)return!1;var text=node.data;if(""===text)return!0;var parent=node.parentNode;if(!parent||1!=parent.nodeType)return!1;var computedWhiteSpace=getComputedStyleProperty(node.parentNode,"whiteSpace");return/^[\t\n\r ]+$/.test(text)&&/^(normal|nowrap)$/.test(computedWhiteSpace)||/^[\t\r ]+$/.test(text)&&"pre-line"==computedWhiteSpace}function isCollapsedWhitespaceNode(node){if(""===node.data)return!0;if(!isWhitespaceNode(node))return!1;var ancestor=node.parentNode;return ancestor?isHidden(node)?!0:!1:!0}function isCollapsedNode(node){var type=node.nodeType;return 7==type||8==type||isHidden(node)||/^(script|style)$/i.test(node.nodeName)||isVisibilityHiddenTextNode(node)||isCollapsedWhitespaceNode(node)}function isIgnoredNode(node,win){var type=node.nodeType;return 7==type||8==type||1==type&&"none"==getComputedDisplay(node,win)}function Cache(){this.store={}}function createCachingGetter(methodName,func,objProperty){return function(args){var cache=this.cache;if(cache.hasOwnProperty(methodName))return cachedCount++,cache[methodName];uncachedCount++;var value=func.call(this,objProperty?this[objProperty]:this,args);return cache[methodName]=value,value}}function NodeWrapper(node,session){this.node=node,this.session=session,this.cache=new Cache,this.positions=new Cache}function Position(nodeWrapper,offset){this.offset=offset,this.nodeWrapper=nodeWrapper,this.node=nodeWrapper.node,this.session=nodeWrapper.session,this.cache=new Cache}function inspectPosition(){return"[Position("+dom.inspectNode(this.node)+":"+this.offset+")]"}function startSession(){return endSession(),currentSession=new Session}function getSession(){return currentSession||startSession()}function endSession(){currentSession&&currentSession.detach(),currentSession=null}function createCharacterIterator(startPos,backward,endPos,characterOptions){function next(){var charPos=null;return backward?(charPos=pos,finished||(pos=pos.previousVisible(),finished=!pos||endPos&&pos.equals(endPos))):finished||(charPos=pos=pos.nextVisible(),finished=!pos||endPos&&pos.equals(endPos)),finished&&(pos=null),charPos}endPos&&(backward?isCollapsedNode(endPos.node)&&(endPos=startPos.previousVisible()):isCollapsedNode(endPos.node)&&(endPos=endPos.nextVisible()));var previousTextPos,pos=startPos,finished=!1,returnPreviousTextPos=!1;return{next:function(){if(returnPreviousTextPos)return returnPreviousTextPos=!1,previousTextPos;for(var pos,character;pos=next();)if(character=pos.getCharacter(characterOptions))return previousTextPos=pos,pos;return null},rewind:function(){if(!previousTextPos)throw module.createError("createCharacterIterator: cannot rewind. Only one position can be rewound.");returnPreviousTextPos=!0},dispose:function(){startPos=endPos=null}}}function createTokenizedTextProvider(pos,characterOptions,wordOptions){function consumeWord(forward){for(var pos,textChar,newChars=[],it=forward?forwardIterator:backwardIterator,passedWordBoundary=!1,insideWord=!1;pos=it.next();){if(textChar=pos.character,allWhiteSpaceRegex.test(textChar))insideWord&&(insideWord=!1,passedWordBoundary=!0);else{if(passedWordBoundary){it.rewind();break}insideWord=!0}newChars.push(pos)}return newChars}var forwardIterator=createCharacterIterator(pos,!1,null,characterOptions),backwardIterator=createCharacterIterator(pos,!0,null,characterOptions),tokenizer=wordOptions.tokenizer,forwardChars=consumeWord(!0),backwardChars=consumeWord(!1).reverse(),tokens=tokenize(backwardChars.concat(forwardChars),wordOptions,tokenizer),forwardTokensBuffer=forwardChars.length?tokens.slice(arrayIndexOf(tokens,forwardChars[0].token)):[],backwardTokensBuffer=backwardChars.length?tokens.slice(0,arrayIndexOf(tokens,backwardChars.pop().token)+1):[];return{nextEndToken:function(){for(var lastToken,forwardChars;1==forwardTokensBuffer.length&&!(lastToken=forwardTokensBuffer[0]).isWord&&(forwardChars=consumeWord(!0)).length>0;)forwardTokensBuffer=tokenize(lastToken.chars.concat(forwardChars),wordOptions,tokenizer);return forwardTokensBuffer.shift()},previousStartToken:function(){for(var lastToken,backwardChars;1==backwardTokensBuffer.length&&!(lastToken=backwardTokensBuffer[0]).isWord&&(backwardChars=consumeWord(!1)).length>0;)backwardTokensBuffer=tokenize(backwardChars.reverse().concat(lastToken.chars),wordOptions,tokenizer);return backwardTokensBuffer.pop()},dispose:function(){forwardIterator.dispose(),backwardIterator.dispose(),forwardTokensBuffer=backwardTokensBuffer=null}}}function movePositionBy(pos,unit,count,characterOptions,wordOptions){var currentPos,charIterator,nextPos,token,unitsMoved=0,newPos=pos,absCount=Math.abs(count);if(0!==count){var backward=0>count;switch(unit){case CHARACTER:for(charIterator=createCharacterIterator(pos,backward,null,characterOptions);(currentPos=charIterator.next())&&absCount>unitsMoved;)++unitsMoved,newPos=currentPos;nextPos=currentPos,charIterator.dispose();break;case WORD:for(var tokenizedTextProvider=createTokenizedTextProvider(pos,characterOptions,wordOptions),next=backward?tokenizedTextProvider.previousStartToken:tokenizedTextProvider.nextEndToken;(token=next())&&absCount>unitsMoved;)token.isWord&&(++unitsMoved,newPos=backward?token.chars[0]:token.chars[token.chars.length-1]);break;default:throw new Error("movePositionBy: unit '"+unit+"' not implemented")}backward?(newPos=newPos.previousVisible(),unitsMoved=-unitsMoved):newPos&&newPos.isLeadingSpace&&!newPos.isTrailingSpace&&(unit==WORD&&(charIterator=createCharacterIterator(pos,!1,null,characterOptions),nextPos=charIterator.next(),charIterator.dispose()),nextPos&&(newPos=nextPos.previousVisible()))}return{position:newPos,unitsMoved:unitsMoved}}function createRangeCharacterIterator(session,range,characterOptions,backward){var rangeStart=session.getRangeBoundaryPosition(range,!0),rangeEnd=session.getRangeBoundaryPosition(range,!1),itStart=backward?rangeEnd:rangeStart,itEnd=backward?rangeStart:rangeEnd;return createCharacterIterator(itStart,!!backward,itEnd,characterOptions)}function getRangeCharacters(session,range,characterOptions){for(var pos,chars=[],it=createRangeCharacterIterator(session,range,characterOptions);pos=it.next();)chars.push(pos);return it.dispose(),chars}function isWholeWord(startPos,endPos,wordOptions){var range=api.createRange(startPos.node);return range.setStartAndEnd(startPos.node,startPos.offset,endPos.node,endPos.offset),!range.expand("word",{wordOptions:wordOptions})}function findTextFromPosition(initialPos,searchTerm,isRegex,searchScopeRange,findOptions){function handleMatch(startIndex,endIndex){var startPos=chars[startIndex].previousVisible(),endPos=chars[endIndex-1],valid=!findOptions.wholeWordsOnly||isWholeWord(startPos,endPos,findOptions.wordOptions);return{startPos:startPos,endPos:endPos,valid:valid}}for(var pos,currentChar,matchStartIndex,matchEndIndex,result,insideRegexMatch,backward=isDirectionBackward(findOptions.direction),it=createCharacterIterator(initialPos,backward,initialPos.session.getRangeBoundaryPosition(searchScopeRange,backward),findOptions.characterOptions),text="",chars=[],returnValue=null;pos=it.next();)if(currentChar=pos.character,isRegex||findOptions.caseSensitive||(currentChar=currentChar.toLowerCase()),backward?(chars.unshift(pos),text=currentChar+text):(chars.push(pos),text+=currentChar),isRegex){if(result=searchTerm.exec(text))if(matchStartIndex=result.index,matchEndIndex=matchStartIndex+result[0].length,insideRegexMatch){if(!backward&&matchEndIndex<text.length||backward&&matchStartIndex>0){returnValue=handleMatch(matchStartIndex,matchEndIndex);break}}else insideRegexMatch=!0}else if(-1!=(matchStartIndex=text.indexOf(searchTerm))){returnValue=handleMatch(matchStartIndex,matchStartIndex+searchTerm.length);break}return insideRegexMatch&&(returnValue=handleMatch(matchStartIndex,matchEndIndex)),it.dispose(),returnValue}function createEntryPointFunction(func){return function(){var sessionRunning=!!currentSession,session=getSession(),args=[session].concat(util.toArray(arguments)),returnValue=func.apply(this,args);return sessionRunning||endSession(),returnValue}}function createRangeBoundaryMover(isStart,collapse){return createEntryPointFunction(function(session,unit,count,moveOptions){typeof count==UNDEF&&(count=unit,unit=CHARACTER),moveOptions=createNestedOptions(moveOptions,defaultMoveOptions);var boundaryIsStart=isStart;collapse&&(boundaryIsStart=count>=0,this.collapse(!boundaryIsStart));var moveResult=movePositionBy(session.getRangeBoundaryPosition(this,boundaryIsStart),unit,count,moveOptions.characterOptions,moveOptions.wordOptions),newPos=moveResult.position;return this[boundaryIsStart?"setStart":"setEnd"](newPos.node,newPos.offset),moveResult.unitsMoved})}function createRangeTrimmer(isStart){return createEntryPointFunction(function(session,characterOptions){characterOptions=createOptions(characterOptions,defaultCharacterOptions);for(var pos,it=createRangeCharacterIterator(session,this,characterOptions,!isStart),trimCharCount=0;(pos=it.next())&&allWhiteSpaceRegex.test(pos.character);)++trimCharCount;it.dispose();var trimmed=trimCharCount>0;return trimmed&&this[isStart?"moveStart":"moveEnd"]("character",isStart?trimCharCount:-trimCharCount,{characterOptions:characterOptions}),trimmed})}function createSelectionTrimmer(methodName){return createEntryPointFunction(function(session,characterOptions){var trimmed=!1;return this.changeEachRange(function(range){trimmed=range[methodName](characterOptions)||trimmed}),trimmed})}var UNDEF="undefined",CHARACTER="character",WORD="word",dom=api.dom,util=api.util,extend=util.extend,createOptions=util.createOptions,getBody=dom.getBody,spacesRegex=/^[ \t\f\r\n]+$/,spacesMinusLineBreaksRegex=/^[ \t\f\r]+$/,allWhiteSpaceRegex=/^[\t-\r \u0085\u00A0\u1680\u180E\u2000-\u200B\u2028\u2029\u202F\u205F\u3000]+$/,nonLineBreakWhiteSpaceRegex=/^[\t \u00A0\u1680\u180E\u2000-\u200B\u202F\u205F\u3000]+$/,defaultLanguage="en",isDirectionBackward=api.Selection.isDirectionBackward,trailingSpaceInBlockCollapses=!1,trailingSpaceBeforeBrCollapses=!1,trailingSpaceBeforeBlockCollapses=!1,trailingSpaceBeforeLineBreakInPreLineCollapses=!0;!function(){var el=dom.createTestElement(document,"<p>1 </p><p></p>",!0),p=el.firstChild,sel=api.getSelection();sel.collapse(p.lastChild,2),sel.setStart(p.firstChild,0),trailingSpaceInBlockCollapses=1==(""+sel).length,el.innerHTML="1 <br />",sel.collapse(el,2),sel.setStart(el.firstChild,0),trailingSpaceBeforeBrCollapses=1==(""+sel).length,el.innerHTML="1 <p>1</p>",sel.collapse(el,2),sel.setStart(el.firstChild,0),trailingSpaceBeforeBlockCollapses=1==(""+sel).length,dom.removeNode(el),sel.removeAllRanges()}();var tableCssDisplayBlock,defaultCharacterOptions={includeBlockContentTrailingSpace:!0,includeSpaceBeforeBr:!0,includeSpaceBeforeBlock:!0,includePreLineTrailingSpace:!0,ignoreCharacters:""},defaultCaretCharacterOptions={includeBlockContentTrailingSpace:!trailingSpaceBeforeLineBreakInPreLineCollapses,includeSpaceBeforeBr:!trailingSpaceBeforeBrCollapses,includeSpaceBeforeBlock:!trailingSpaceBeforeBlockCollapses,includePreLineTrailingSpace:!0},defaultWordOptions={en:{wordRegex:/[a-z0-9]+('[a-z0-9]+)*/gi,includeTrailingSpace:!1,tokenizer:defaultTokenizer}},defaultFindOptions={caseSensitive:!1,withinRange:null,wholeWordsOnly:!1,wrap:!1,direction:"forward",wordOptions:null,characterOptions:null},defaultMoveOptions={wordOptions:null,characterOptions:null},defaultExpandOptions={wordOptions:null,characterOptions:null,trim:!1,trimStart:!0,trimEnd:!0},defaultWordIteratorOptions={wordOptions:null,characterOptions:null,direction:"forward"},getComputedStyleProperty=dom.getComputedStyleProperty;!function(){var table=document.createElement("table"),body=getBody(document);body.appendChild(table),tableCssDisplayBlock="block"==getComputedStyleProperty(table,"display"),body.removeChild(table)}();var defaultDisplayValueForTag={table:"table",caption:"table-caption",colgroup:"table-column-group",col:"table-column",thead:"table-header-group",tbody:"table-row-group",tfoot:"table-footer-group",tr:"table-row",td:"table-cell",th:"table-cell"};Cache.prototype={get:function(key){return this.store.hasOwnProperty(key)?this.store[key]:null},set:function(key,value){return this.store[key]=value}};var cachedCount=0,uncachedCount=0,nodeProto={getPosition:function(offset){var positions=this.positions;return positions.get(offset)||positions.set(offset,new Position(this,offset))},toString:function(){return"[NodeWrapper("+dom.inspectNode(this.node)+")]"}};NodeWrapper.prototype=nodeProto;var EMPTY="EMPTY",NON_SPACE="NON_SPACE",UNCOLLAPSIBLE_SPACE="UNCOLLAPSIBLE_SPACE",COLLAPSIBLE_SPACE="COLLAPSIBLE_SPACE",TRAILING_SPACE_BEFORE_BLOCK="TRAILING_SPACE_BEFORE_BLOCK",TRAILING_SPACE_IN_BLOCK="TRAILING_SPACE_IN_BLOCK",TRAILING_SPACE_BEFORE_BR="TRAILING_SPACE_BEFORE_BR",PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK="PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK",TRAILING_LINE_BREAK_AFTER_BR="TRAILING_LINE_BREAK_AFTER_BR",INCLUDED_TRAILING_LINE_BREAK_AFTER_BR="INCLUDED_TRAILING_LINE_BREAK_AFTER_BR";extend(nodeProto,{isCharacterDataNode:createCachingGetter("isCharacterDataNode",dom.isCharacterDataNode,"node"),getNodeIndex:createCachingGetter("nodeIndex",dom.getNodeIndex,"node"),getLength:createCachingGetter("nodeLength",dom.getNodeLength,"node"),containsPositions:createCachingGetter("containsPositions",containsPositions,"node"),isWhitespace:createCachingGetter("isWhitespace",isWhitespaceNode,"node"),isCollapsedWhitespace:createCachingGetter("isCollapsedWhitespace",isCollapsedWhitespaceNode,"node"),getComputedDisplay:createCachingGetter("computedDisplay",getComputedDisplay,"node"),isCollapsed:createCachingGetter("collapsed",isCollapsedNode,"node"),isIgnored:createCachingGetter("ignored",isIgnoredNode,"node"),next:createCachingGetter("nextPos",nextNode,"node"),previous:createCachingGetter("previous",previousNode,"node"),getTextNodeInfo:createCachingGetter("textNodeInfo",function(textNode){var spaceRegex=null,collapseSpaces=!1,cssWhitespace=getComputedStyleProperty(textNode.parentNode,"whiteSpace"),preLine="pre-line"==cssWhitespace;return preLine?(spaceRegex=spacesMinusLineBreaksRegex,collapseSpaces=!0):("normal"==cssWhitespace||"nowrap"==cssWhitespace)&&(spaceRegex=spacesRegex,collapseSpaces=!0),{node:textNode,text:textNode.data,spaceRegex:spaceRegex,collapseSpaces:collapseSpaces,preLine:preLine}},"node"),hasInnerText:createCachingGetter("hasInnerText",function(el,backward){for(var session=this.session,posAfterEl=session.getPosition(el.parentNode,this.getNodeIndex()+1),firstPosInEl=session.getPosition(el,0),pos=backward?posAfterEl:firstPosInEl,endPos=backward?firstPosInEl:posAfterEl;pos!==endPos;){if(pos.prepopulateChar(),pos.isDefinitelyNonEmpty())return!0;pos=backward?pos.previousVisible():pos.nextVisible()}return!1},"node"),isRenderedBlock:createCachingGetter("isRenderedBlock",function(el){for(var brs=el.getElementsByTagName("br"),i=0,len=brs.length;len>i;++i)if(!isCollapsedNode(brs[i]))return!0;return this.hasInnerText()},"node"),getTrailingSpace:createCachingGetter("trailingSpace",function(el){if("br"==el.tagName.toLowerCase())return"";switch(this.getComputedDisplay()){case"inline":for(var child=el.lastChild;child;){if(!isIgnoredNode(child))return 1==child.nodeType?this.session.getNodeWrapper(child).getTrailingSpace():"";child=child.previousSibling}break;case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":break;case"table-cell":return"	";default:return this.isRenderedBlock(!0)?"\n":""}return""},"node"),getLeadingSpace:createCachingGetter("leadingSpace",function(el){switch(this.getComputedDisplay()){case"inline":case"inline-block":case"inline-table":case"none":case"table-column":case"table-column-group":case"table-cell":break;default:return this.isRenderedBlock(!1)?"\n":""}return""},"node")});var positionProto={character:"",characterType:EMPTY,isBr:!1,prepopulateChar:function(){var pos=this;if(!pos.prepopulatedChar){var node=pos.node,offset=pos.offset,visibleChar="",charType=EMPTY,finalizedChar=!1;if(offset>0)if(3==node.nodeType){var text=node.data,textChar=text.charAt(offset-1),nodeInfo=pos.nodeWrapper.getTextNodeInfo(),spaceRegex=nodeInfo.spaceRegex;nodeInfo.collapseSpaces?spaceRegex.test(textChar)?offset>1&&spaceRegex.test(text.charAt(offset-2))||(nodeInfo.preLine&&"\n"===text.charAt(offset)?(visibleChar=" ",charType=PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK):(visibleChar=" ",charType=COLLAPSIBLE_SPACE)):(visibleChar=textChar,charType=NON_SPACE,finalizedChar=!0):(visibleChar=textChar,charType=UNCOLLAPSIBLE_SPACE,finalizedChar=!0)}else{var nodePassed=node.childNodes[offset-1];if(nodePassed&&1==nodePassed.nodeType&&!isCollapsedNode(nodePassed)&&("br"==nodePassed.tagName.toLowerCase()?(visibleChar="\n",pos.isBr=!0,charType=COLLAPSIBLE_SPACE,finalizedChar=!1):pos.checkForTrailingSpace=!0),!visibleChar){var nextNode=node.childNodes[offset];nextNode&&1==nextNode.nodeType&&!isCollapsedNode(nextNode)&&(pos.checkForLeadingSpace=!0)}}pos.prepopulatedChar=!0,pos.character=visibleChar,pos.characterType=charType,pos.isCharInvariant=finalizedChar}},isDefinitelyNonEmpty:function(){var charType=this.characterType;return charType==NON_SPACE||charType==UNCOLLAPSIBLE_SPACE},resolveLeadingAndTrailingSpaces:function(){if(this.prepopulatedChar||this.prepopulateChar(),this.checkForTrailingSpace){var trailingSpace=this.session.getNodeWrapper(this.node.childNodes[this.offset-1]).getTrailingSpace();trailingSpace&&(this.isTrailingSpace=!0,this.character=trailingSpace,this.characterType=COLLAPSIBLE_SPACE),this.checkForTrailingSpace=!1}if(this.checkForLeadingSpace){var leadingSpace=this.session.getNodeWrapper(this.node.childNodes[this.offset]).getLeadingSpace();leadingSpace&&(this.isLeadingSpace=!0,this.character=leadingSpace,this.characterType=COLLAPSIBLE_SPACE),this.checkForLeadingSpace=!1}},getPrecedingUncollapsedPosition:function(characterOptions){for(var character,pos=this;pos=pos.previousVisible();)if(character=pos.getCharacter(characterOptions),""!==character)return pos;return null},getCharacter:function(characterOptions){function getPreviousPos(){return gotPreviousPos||(previousPos=pos.getPrecedingUncollapsedPosition(characterOptions),gotPreviousPos=!0),previousPos}this.resolveLeadingAndTrailingSpaces();var returnChar,thisChar=this.character,ignoredChars=normalizeIgnoredCharacters(characterOptions.ignoreCharacters),isIgnoredCharacter=""!==thisChar&&ignoredChars.indexOf(thisChar)>-1;if(this.isCharInvariant)return returnChar=isIgnoredCharacter?"":thisChar;var cacheKey=["character",characterOptions.includeSpaceBeforeBr,characterOptions.includeBlockContentTrailingSpace,characterOptions.includePreLineTrailingSpace,ignoredChars].join("_"),cachedChar=this.cache.get(cacheKey);if(null!==cachedChar)return cachedChar;var nextPos,previousPos,character="",collapsible=this.characterType==COLLAPSIBLE_SPACE,gotPreviousPos=!1,pos=this;return collapsible&&(this.type==INCLUDED_TRAILING_LINE_BREAK_AFTER_BR?character="\n":" "==thisChar&&(!getPreviousPos()||previousPos.isTrailingSpace||"\n"==previousPos.character||" "==previousPos.character&&previousPos.characterType==COLLAPSIBLE_SPACE)||("\n"==thisChar&&this.isLeadingSpace?getPreviousPos()&&"\n"!=previousPos.character&&(character="\n"):(nextPos=this.nextUncollapsed(),nextPos&&(nextPos.isBr?this.type=TRAILING_SPACE_BEFORE_BR:nextPos.isTrailingSpace&&"\n"==nextPos.character?this.type=TRAILING_SPACE_IN_BLOCK:nextPos.isLeadingSpace&&"\n"==nextPos.character&&(this.type=TRAILING_SPACE_BEFORE_BLOCK),"\n"==nextPos.character?(this.type!=TRAILING_SPACE_BEFORE_BR||characterOptions.includeSpaceBeforeBr)&&(this.type!=TRAILING_SPACE_BEFORE_BLOCK||characterOptions.includeSpaceBeforeBlock)&&(this.type==TRAILING_SPACE_IN_BLOCK&&nextPos.isTrailingSpace&&!characterOptions.includeBlockContentTrailingSpace||(this.type!=PRE_LINE_TRAILING_SPACE_BEFORE_LINE_BREAK||nextPos.type!=NON_SPACE||characterOptions.includePreLineTrailingSpace)&&("\n"==thisChar?nextPos.isTrailingSpace?this.isTrailingSpace||this.isBr&&(nextPos.type=TRAILING_LINE_BREAK_AFTER_BR,getPreviousPos()&&previousPos.isLeadingSpace&&!previousPos.isTrailingSpace&&"\n"==previousPos.character?nextPos.character="":nextPos.type=INCLUDED_TRAILING_LINE_BREAK_AFTER_BR):character="\n":" "==thisChar&&(character=" "))):character=thisChar)))),ignoredChars.indexOf(character)>-1&&(character=""),this.cache.set(cacheKey,character),character},equals:function(pos){return!!pos&&this.node===pos.node&&this.offset===pos.offset},inspect:inspectPosition,toString:function(){return this.character}};Position.prototype=positionProto,extend(positionProto,{next:createCachingGetter("nextPos",function(pos){var nodeWrapper=pos.nodeWrapper,node=pos.node,offset=pos.offset,session=nodeWrapper.session;if(!node)return null;var nextNode,nextOffset,child;return offset==nodeWrapper.getLength()?(nextNode=node.parentNode,nextOffset=nextNode?nodeWrapper.getNodeIndex()+1:0):nodeWrapper.isCharacterDataNode()?(nextNode=node,nextOffset=offset+1):(child=node.childNodes[offset],session.getNodeWrapper(child).containsPositions()?(nextNode=child,nextOffset=0):(nextNode=node,nextOffset=offset+1)),nextNode?session.getPosition(nextNode,nextOffset):null}),previous:createCachingGetter("previous",function(pos){var previousNode,previousOffset,child,nodeWrapper=pos.nodeWrapper,node=pos.node,offset=pos.offset,session=nodeWrapper.session;return 0==offset?(previousNode=node.parentNode,previousOffset=previousNode?nodeWrapper.getNodeIndex():0):nodeWrapper.isCharacterDataNode()?(previousNode=node,previousOffset=offset-1):(child=node.childNodes[offset-1],session.getNodeWrapper(child).containsPositions()?(previousNode=child,previousOffset=dom.getNodeLength(child)):(previousNode=node,previousOffset=offset-1)),previousNode?session.getPosition(previousNode,previousOffset):null}),nextVisible:createCachingGetter("nextVisible",function(pos){var next=pos.next();if(!next)return null;var nodeWrapper=next.nodeWrapper,node=next.node,newPos=next;return nodeWrapper.isCollapsed()&&(newPos=nodeWrapper.session.getPosition(node.parentNode,nodeWrapper.getNodeIndex()+1)),newPos}),nextUncollapsed:createCachingGetter("nextUncollapsed",function(pos){for(var nextPos=pos;nextPos=nextPos.nextVisible();)if(nextPos.resolveLeadingAndTrailingSpaces(),""!==nextPos.character)return nextPos;return null}),previousVisible:createCachingGetter("previousVisible",function(pos){var previous=pos.previous();if(!previous)return null;var nodeWrapper=previous.nodeWrapper,node=previous.node,newPos=previous;return nodeWrapper.isCollapsed()&&(newPos=nodeWrapper.session.getPosition(node.parentNode,nodeWrapper.getNodeIndex())),newPos})});var currentSession=null,Session=function(){function createWrapperCache(nodeProperty){var cache=new Cache;return{get:function(node){var wrappersByProperty=cache.get(node[nodeProperty]);if(wrappersByProperty)for(var wrapper,i=0;wrapper=wrappersByProperty[i++];)if(wrapper.node===node)return wrapper;return null},set:function(nodeWrapper){var property=nodeWrapper.node[nodeProperty],wrappersByProperty=cache.get(property)||cache.set(property,[]);wrappersByProperty.push(nodeWrapper)}}}function Session(){this.initCaches()}var uniqueIDSupported=util.isHostProperty(document.documentElement,"uniqueID");return Session.prototype={initCaches:function(){this.elementCache=uniqueIDSupported?function(){var elementsCache=new Cache;return{get:function(el){return elementsCache.get(el.uniqueID)},set:function(elWrapper){elementsCache.set(elWrapper.node.uniqueID,elWrapper)}}}():createWrapperCache("tagName"),this.textNodeCache=createWrapperCache("data"),this.otherNodeCache=createWrapperCache("nodeName")},getNodeWrapper:function(node){var wrapperCache;switch(node.nodeType){case 1:wrapperCache=this.elementCache;break;case 3:wrapperCache=this.textNodeCache;break;default:wrapperCache=this.otherNodeCache}var wrapper=wrapperCache.get(node);return wrapper||(wrapper=new NodeWrapper(node,this),wrapperCache.set(wrapper)),wrapper},getPosition:function(node,offset){return this.getNodeWrapper(node).getPosition(offset)},getRangeBoundaryPosition:function(range,isStart){var prefix=isStart?"start":"end";return this.getPosition(range[prefix+"Container"],range[prefix+"Offset"])},detach:function(){this.elementCache=this.textNodeCache=this.otherNodeCache=null}},Session}();extend(dom,{nextNode:nextNode,previousNode:previousNode});var arrayIndexOf=Array.prototype.indexOf?function(arr,val){return arr.indexOf(val)}:function(arr,val){for(var i=0,len=arr.length;len>i;++i)if(arr[i]===val)return i;return-1};extend(api.rangePrototype,{moveStart:createRangeBoundaryMover(!0,!1),moveEnd:createRangeBoundaryMover(!1,!1),move:createRangeBoundaryMover(!0,!0),trimStart:createRangeTrimmer(!0),trimEnd:createRangeTrimmer(!1),trim:createEntryPointFunction(function(session,characterOptions){var startTrimmed=this.trimStart(characterOptions),endTrimmed=this.trimEnd(characterOptions);return startTrimmed||endTrimmed}),expand:createEntryPointFunction(function(session,unit,expandOptions){var moved=!1;expandOptions=createNestedOptions(expandOptions,defaultExpandOptions);var characterOptions=expandOptions.characterOptions;if(unit||(unit=CHARACTER),unit==WORD){var endToken,newEndPos,wordOptions=expandOptions.wordOptions,startPos=session.getRangeBoundaryPosition(this,!0),endPos=session.getRangeBoundaryPosition(this,!1),startTokenizedTextProvider=createTokenizedTextProvider(startPos,characterOptions,wordOptions),startToken=startTokenizedTextProvider.nextEndToken(),newStartPos=startToken.chars[0].previousVisible();if(this.collapsed)endToken=startToken;else{var endTokenizedTextProvider=createTokenizedTextProvider(endPos,characterOptions,wordOptions);endToken=endTokenizedTextProvider.previousStartToken()}return newEndPos=endToken.chars[endToken.chars.length-1],newStartPos.equals(startPos)||(this.setStart(newStartPos.node,newStartPos.offset),moved=!0),newEndPos&&!newEndPos.equals(endPos)&&(this.setEnd(newEndPos.node,newEndPos.offset),moved=!0),expandOptions.trim&&(expandOptions.trimStart&&(moved=this.trimStart(characterOptions)||moved),expandOptions.trimEnd&&(moved=this.trimEnd(characterOptions)||moved)),moved}return this.moveEnd(CHARACTER,1,expandOptions)}),text:createEntryPointFunction(function(session,characterOptions){return this.collapsed?"":getRangeCharacters(session,this,createOptions(characterOptions,defaultCharacterOptions)).join("")}),selectCharacters:createEntryPointFunction(function(session,containerNode,startIndex,endIndex,characterOptions){var moveOptions={characterOptions:characterOptions};containerNode||(containerNode=getBody(this.getDocument())),this.selectNodeContents(containerNode),this.collapse(!0),this.moveStart("character",startIndex,moveOptions),this.collapse(!0),this.moveEnd("character",endIndex-startIndex,moveOptions)}),toCharacterRange:createEntryPointFunction(function(session,containerNode,characterOptions){containerNode||(containerNode=getBody(this.getDocument()));var startIndex,endIndex,parent=containerNode.parentNode,nodeIndex=dom.getNodeIndex(containerNode),rangeStartsBeforeNode=-1==dom.comparePoints(this.startContainer,this.endContainer,parent,nodeIndex),rangeBetween=this.cloneRange();return rangeStartsBeforeNode?(rangeBetween.setStartAndEnd(this.startContainer,this.startOffset,parent,nodeIndex),startIndex=-rangeBetween.text(characterOptions).length):(rangeBetween.setStartAndEnd(parent,nodeIndex,this.startContainer,this.startOffset),startIndex=rangeBetween.text(characterOptions).length),endIndex=startIndex+this.text(characterOptions).length,{start:startIndex,end:endIndex}}),findText:createEntryPointFunction(function(session,searchTermParam,findOptions){findOptions=createNestedOptions(findOptions,defaultFindOptions),findOptions.wholeWordsOnly&&(findOptions.wordOptions.includeTrailingSpace=!1);var backward=isDirectionBackward(findOptions.direction),searchScopeRange=findOptions.withinRange;searchScopeRange||(searchScopeRange=api.createRange(),searchScopeRange.selectNodeContents(this.getDocument()));var searchTerm=searchTermParam,isRegex=!1;"string"==typeof searchTerm?findOptions.caseSensitive||(searchTerm=searchTerm.toLowerCase()):isRegex=!0;var initialPos=session.getRangeBoundaryPosition(this,!backward),comparison=searchScopeRange.comparePoint(initialPos.node,initialPos.offset);-1===comparison?initialPos=session.getRangeBoundaryPosition(searchScopeRange,!0):1===comparison&&(initialPos=session.getRangeBoundaryPosition(searchScopeRange,!1));for(var findResult,pos=initialPos,wrappedAround=!1;;)if(findResult=findTextFromPosition(pos,searchTerm,isRegex,searchScopeRange,findOptions)){if(findResult.valid)return this.setStartAndEnd(findResult.startPos.node,findResult.startPos.offset,findResult.endPos.node,findResult.endPos.offset),!0;pos=backward?findResult.startPos:findResult.endPos;
}else{if(!findOptions.wrap||wrappedAround)return!1;searchScopeRange=searchScopeRange.cloneRange(),pos=session.getRangeBoundaryPosition(searchScopeRange,!backward),searchScopeRange.setBoundary(initialPos.node,initialPos.offset,backward),wrappedAround=!0}}),pasteHtml:function(html){if(this.deleteContents(),html){var frag=this.createContextualFragment(html),lastChild=frag.lastChild;this.insertNode(frag),this.collapseAfter(lastChild)}}}),extend(api.selectionPrototype,{expand:createEntryPointFunction(function(session,unit,expandOptions){this.changeEachRange(function(range){range.expand(unit,expandOptions)})}),move:createEntryPointFunction(function(session,unit,count,options){var unitsMoved=0;if(this.focusNode){this.collapse(this.focusNode,this.focusOffset);var range=this.getRangeAt(0);options||(options={}),options.characterOptions=createOptions(options.characterOptions,defaultCaretCharacterOptions),unitsMoved=range.move(unit,count,options),this.setSingleRange(range)}return unitsMoved}),trimStart:createSelectionTrimmer("trimStart"),trimEnd:createSelectionTrimmer("trimEnd"),trim:createSelectionTrimmer("trim"),selectCharacters:createEntryPointFunction(function(session,containerNode,startIndex,endIndex,direction,characterOptions){var range=api.createRange(containerNode);range.selectCharacters(containerNode,startIndex,endIndex,characterOptions),this.setSingleRange(range,direction)}),saveCharacterRanges:createEntryPointFunction(function(session,containerNode,characterOptions){for(var ranges=this.getAllRanges(),rangeCount=ranges.length,rangeInfos=[],backward=1==rangeCount&&this.isBackward(),i=0,len=ranges.length;len>i;++i)rangeInfos[i]={characterRange:ranges[i].toCharacterRange(containerNode,characterOptions),backward:backward,characterOptions:characterOptions};return rangeInfos}),restoreCharacterRanges:createEntryPointFunction(function(session,containerNode,saved){this.removeAllRanges();for(var range,rangeInfo,characterRange,i=0,len=saved.length;len>i;++i)rangeInfo=saved[i],characterRange=rangeInfo.characterRange,range=api.createRange(containerNode),range.selectCharacters(containerNode,characterRange.start,characterRange.end,rangeInfo.characterOptions),this.addRange(range,rangeInfo.backward)}),text:createEntryPointFunction(function(session,characterOptions){for(var rangeTexts=[],i=0,len=this.rangeCount;len>i;++i)rangeTexts[i]=this.getRangeAt(i).text(characterOptions);return rangeTexts.join("")})}),api.innerText=function(el,characterOptions){var range=api.createRange(el);range.selectNodeContents(el);var text=range.text(characterOptions);return text},api.createWordIterator=function(startNode,startOffset,iteratorOptions){var session=getSession();iteratorOptions=createNestedOptions(iteratorOptions,defaultWordIteratorOptions);var startPos=session.getPosition(startNode,startOffset),tokenizedTextProvider=createTokenizedTextProvider(startPos,iteratorOptions.characterOptions,iteratorOptions.wordOptions),backward=isDirectionBackward(iteratorOptions.direction);return{next:function(){return backward?tokenizedTextProvider.previousStartToken():tokenizedTextProvider.nextEndToken()},dispose:function(){tokenizedTextProvider.dispose(),this.next=function(){}}}},api.noMutation=function(func){var session=getSession();func(session),endSession()},api.noMutation.createEntryPointFunction=createEntryPointFunction,api.textRange={isBlockNode:isBlockNode,isCollapsedWhitespaceNode:isCollapsedWhitespaceNode,createPosition:createEntryPointFunction(function(session,node,offset){return session.getPosition(node,offset)})}}),rangy},this),function(){function Tablesort(el,options){if(!el||"TABLE"!==el.tagName)throw new Error("Element must be a table");this.init(el,options||{})}var sortOptions=[],createEvent=function(name){var evt;return window.CustomEvent&&"function"==typeof window.CustomEvent?evt=new CustomEvent(name):(evt=document.createEvent("CustomEvent"),evt.initCustomEvent(name,!1,!1,void 0)),evt},getInnerText=function(el){return el.getAttribute("data-sort")||el.textContent||el.innerText||""},caseInsensitiveSort=function(a,b){return a=a.toLowerCase(),b=b.toLowerCase(),a===b?0:b>a?1:-1},stabilize=function(sort,antiStabilize){return function(a,b){var unstableResult=sort(a.td,b.td);return 0===unstableResult?antiStabilize?b.index-a.index:a.index-b.index:unstableResult}};Tablesort.extend=function(name,pattern,sort){if("function"!=typeof pattern||"function"!=typeof sort)throw new Error("Pattern and sort must be a function");sortOptions.push({name:name,pattern:pattern,sort:sort})},Tablesort.prototype={init:function(el,options){var firstRow,defaultSort,i,cell,that=this;if(that.table=el,that.thead=!1,that.options=options,el.rows&&el.rows.length>0&&(el.tHead&&el.tHead.rows.length>0?(firstRow=el.tHead.rows[el.tHead.rows.length-1],that.thead=!0):firstRow=el.rows[0]),firstRow){var onClick=function(){that.current&&that.current!==this&&(that.current.classList.remove("sort-up"),that.current.classList.remove("sort-down")),that.current=this,that.sortTable(this)};for(i=0;i<firstRow.cells.length;i++)cell=firstRow.cells[i],cell.classList.contains("no-sort")||(cell.classList.add("sort-header"),cell.tabindex=0,cell.addEventListener("click",onClick,!1),cell.classList.contains("sort-default")&&(defaultSort=cell));defaultSort&&(that.current=defaultSort,that.sortTable(defaultSort))}},sortTable:function(header,update){var that=this,column=header.cellIndex,sortFunction=caseInsensitiveSort,item="",items=[],i=that.thead?0:1,sortMethod=header.getAttribute("data-sort-method");if(that.table.dispatchEvent(createEvent("beforeSort")),!(that.table.rows.length<2)){if(!sortMethod){for(;items.length<3&&i<that.table.tBodies[0].rows.length;)item=getInnerText(that.table.tBodies[0].rows[i].cells[column]),item=item.trim(),item.length>0&&items.push(item),i++;if(!items)return}for(i=0;i<sortOptions.length;i++)if(item=sortOptions[i],sortMethod){if(item.name===sortMethod){sortFunction=item.sort;break}}else if(items.every(item.pattern)){sortFunction=item.sort;break}that.col=column;var j,sortDir,newRows=[],noSorts={},totalRows=0,noSortsSoFar=0;for(i=0;i<that.table.tBodies.length;i++)for(j=0;j<that.table.tBodies[i].rows.length;j++)item=that.table.tBodies[i].rows[j],item.classList.contains("no-sort")?noSorts[totalRows]=item:newRows.push({tr:item,td:getInnerText(item.cells[that.col]),index:totalRows}),totalRows++;for(update?sortDir=header.classList.contains("sort-up")?"sort-up":"sort-down":(sortDir=header.classList.contains("sort-up")?"sort-down":header.classList.contains("sort-down")?"sort-up":that.options.descending?"sort-up":"sort-down",header.classList.remove("sort-down"===sortDir?"sort-up":"sort-down"),header.classList.add(sortDir)),"sort-down"===sortDir?(newRows.sort(stabilize(sortFunction,!0)),newRows.reverse()):newRows.sort(stabilize(sortFunction,!1)),i=0;totalRows>i;i++)noSorts[i]?(item=noSorts[i],noSortsSoFar++):item=newRows[i-noSortsSoFar].tr,that.table.tBodies[0].appendChild(item);that.table.dispatchEvent(createEvent("afterSort"))}},refresh:function(){void 0!==this.current&&this.sortTable(this.current,!0)}},"undefined"!=typeof module&&module.exports?module.exports=Tablesort:window.Tablesort=Tablesort}();var selectionchange=function(undefined){function hasNativeSupport(doc){var osc=doc.onselectionchange;if(osc!==undefined)try{return doc.onselectionchange=0,null===doc.onselectionchange}catch(e){}finally{doc.onselectionchange=osc}return!1}function newWeakMap(){return"undefined"!=typeof WeakMap?new WeakMap:(console.error("selectionchange: WeakMap not supported"),null)}function getSelectionRange(doc){var s=doc.getSelection();return s.rangeCount?s.getRangeAt(0):null}function on(el,eventType,handler){el.addEventListener(eventType,handler,!0)}function off(el,eventType,handler){el.removeEventListener(eventType,handler,!0)}function onKeyDown(e){var code=e.keyCode;(65===code&&e[SELECT_ALL_MODIFIER]&&!e.shiftKey&&!e.altKey||40>=code&&code>=37&&e.shiftKey)&&setTimeout(dispatchIfChanged.bind(null,this),0)}function onMouseDown(e){0===e.button&&(on(this,"mousemove",onMouseMove),setTimeout(dispatchIfChanged.bind(null,this),0))}function onMouseMove(e){1&e.buttons?dispatchIfChanged(this):off(this,"mousemove",onMouseMove)}function onMouseUp(e){0===e.button?setTimeout(dispatchIfChanged.bind(null,this),0):off(this,"mousemove",onMouseMove)}function onFocus(){setTimeout(dispatchIfChanged.bind(null,this.document),0)}function dispatchIfChanged(doc){var rOld=ranges.get(doc),rNew=getSelectionRange(doc);sameRange(rNew,rOld)||(ranges.set(doc,rNew),setTimeout(doc.dispatchEvent.bind(doc,new Event("selectionchange")),0))}function sameRange(r1,r2){return r1===r2||r1&&r2&&RANGE_PROPS.every(function(prop){return r1[prop]===r2[prop]})}var ranges,SELECT_ALL_MODIFIER=/^Mac/.test(navigator.platform)?"metaKey":"ctrlKey",RANGE_PROPS=["startContainer","startOffset","endContainer","endOffset"];return{start:function(doc){var d=doc||document;(ranges||!hasNativeSupport(d)&&(ranges=newWeakMap()))&&(ranges.has(d)||(ranges.set(d,getSelectionRange(d)),on(d,"keydown",onKeyDown),on(d,"mousedown",onMouseDown),on(d,"mousemove",onMouseMove),on(d,"mouseup",onMouseUp),on(d.defaultView,"focus",onFocus)))},stop:function(doc){var d=doc||document;ranges&&ranges.has(d)&&(ranges["delete"](d),off(d,"keydown",onKeyDown),off(d,"mousedown",onMouseDown),off(d,"mousemove",onMouseMove),off(d,"mouseup",onMouseUp),off(d.defaultView,"focus",onFocus))}}}();!function(root,factory){"function"==typeof define&&define.amd?define([],function(){return root.RefME=factory()}):"object"==typeof exports?module.exports=factory():root.RefME=factory()}(this,function(){!function(window,document,location,setTimeout,decodeURIComponent,encodeURIComponent){function isHostMethod(object,property){var t=typeof object[property];return"function"==t||!("object"!=t||!object[property])||"unknown"==t}function isHostObject(object,property){return!("object"!=typeof object[property]||!object[property])}function isArray(o){return"[object Array]"===Object.prototype.toString.call(o)}function hasFlash(){var name="Shockwave Flash",mimeType="application/x-shockwave-flash";if(!undef(navigator.plugins)&&"object"==typeof navigator.plugins[name]){var description=navigator.plugins[name].description;description&&!undef(navigator.mimeTypes)&&navigator.mimeTypes[mimeType]&&navigator.mimeTypes[mimeType].enabledPlugin&&(flashVersion=description.match(/\d+/g))}if(!flashVersion){var flash;try{flash=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),flashVersion=Array.prototype.slice.call(flash.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1),flash=null}catch(notSupportedException){}}if(!flashVersion)return!1;var major=parseInt(flashVersion[0],10),minor=parseInt(flashVersion[1],10);return HAS_FLASH_THROTTLED_BUG=major>9&&minor>0,!0}function dom_onReady(){if(!domIsReady){domIsReady=!0;for(var i=0;i<domReadyQueue.length;i++)domReadyQueue[i]();domReadyQueue.length=0}}function whenReady(fn,scope){return domIsReady?void fn.call(scope):void domReadyQueue.push(function(){fn.call(scope)})}function getParentObject(){var obj=parent;if(""!==namespace)for(var i=0,ii=namespace.split(".");i<ii.length;i++)obj=obj[ii[i]];return obj.easyXDM}function noConflict(ns){return window.easyXDM=_easyXDM,namespace=ns,namespace&&(IFRAME_PREFIX="easyXDM_"+namespace.replace(".","_")+"_"),easyXDM}function getDomainName(url){return url.match(reURI)[3]}function getPort(url){return url.match(reURI)[4]||""}function getLocation(url){var m=url.toLowerCase().match(reURI),proto=m[2],domain=m[3],port=m[4]||"";return("http:"==proto&&":80"==port||"https:"==proto&&":443"==port)&&(port=""),proto+"//"+domain+port}function resolveUrl(url){if(url=url.replace(reDoubleSlash,"$1/"),!url.match(/^(http||https):\/\//)){var path="/"===url.substring(0,1)?"":location.pathname;"/"!==path.substring(path.length-1)&&(path=path.substring(0,path.lastIndexOf("/")+1)),url=location.protocol+"//"+location.host+path+url}for(;reParent.test(url);)url=url.replace(reParent,"");return url}function appendQueryParameters(url,parameters){var hash="",indexOf=url.indexOf("#");-1!==indexOf&&(hash=url.substring(indexOf),url=url.substring(0,indexOf));var q=[];for(var key in parameters)parameters.hasOwnProperty(key)&&q.push(key+"="+encodeURIComponent(parameters[key]));return url+(useHash?"#":-1==url.indexOf("?")?"?":"&")+q.join("&")+hash}function undef(v){return"undefined"==typeof v}function apply(destination,source,noOverwrite){var member;for(var prop in source)source.hasOwnProperty(prop)&&(prop in destination?(member=source[prop],"object"==typeof member?apply(destination[prop],member,noOverwrite):noOverwrite||(destination[prop]=source[prop])):destination[prop]=source[prop]);return destination}function testForNamePropertyBug(){var form=document.body.appendChild(document.createElement("form")),input=form.appendChild(document.createElement("input"));input.name=IFRAME_PREFIX+"TEST"+channelId,HAS_NAME_PROPERTY_BUG=input!==form.elements[input.name],document.body.removeChild(form)}function createFrame(config){undef(HAS_NAME_PROPERTY_BUG)&&testForNamePropertyBug();var frame;HAS_NAME_PROPERTY_BUG?frame=document.createElement('<iframe name="'+config.props.name+'"/>'):(frame=document.createElement("IFRAME"),frame.name=config.props.name),frame.id=frame.name=config.props.name,delete config.props.name,"string"==typeof config.container&&(config.container=document.getElementById(config.container)),config.container||(apply(frame.style,{position:"absolute",top:"-2000px",left:"0px"}),config.container=document.body);var src=config.props.src;if(config.props.src="javascript:false",apply(frame,config.props),frame.border=frame.frameBorder=0,frame.allowTransparency=!0,config.container.appendChild(frame),config.onLoad&&on(frame,"load",config.onLoad),config.usePost){var input,form=config.container.appendChild(document.createElement("form"));if(form.target=frame.name,form.action=src,form.method="POST","object"==typeof config.usePost)for(var i in config.usePost)config.usePost.hasOwnProperty(i)&&(HAS_NAME_PROPERTY_BUG?input=document.createElement('<input name="'+i+'"/>'):(input=document.createElement("INPUT"),input.name=i),input.value=config.usePost[i],form.appendChild(input));form.submit(),form.parentNode.removeChild(form)}else frame.src=src;return config.props.src=src,frame}function checkAcl(acl,domain){"string"==typeof acl&&(acl=[acl]);for(var re,i=acl.length;i--;)if(re=acl[i],re=new RegExp("^"==re.substr(0,1)?re:"^"+re.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"),re.test(domain))return!0;return!1}function prepareTransportStack(config){var stackEls,protocol=config.protocol;if(config.isHost=config.isHost||undef(query.xdm_p),useHash=config.hash||!1,config.props||(config.props={}),config.isHost)config.remote=resolveUrl(config.remote),config.channel=config.channel||"default"+channelId++,config.secret=Math.random().toString(16).substring(2),undef(protocol)&&(protocol=getLocation(location.href)==getLocation(config.remote)?"4":isHostMethod(window,"postMessage")||isHostMethod(document,"postMessage")?"1":config.swf&&isHostMethod(window,"ActiveXObject")&&hasFlash()?"6":"Gecko"===navigator.product&&"frameElement"in window&&-1==navigator.userAgent.indexOf("WebKit")?"5":config.remoteHelper?"2":"0");else if(config.channel=query.xdm_c.replace(/["'<>\\]/g,""),config.secret=query.xdm_s,config.remote=query.xdm_e.replace(/["'<>\\]/g,""),protocol=query.xdm_p,config.acl&&!checkAcl(config.acl,config.remote))throw new Error("Access denied for "+config.remote);switch(config.protocol=protocol,protocol){case"0":if(apply(config,{interval:100,delay:2e3,useResize:!0,useParent:!1,usePolling:!1},!0),config.isHost){if(!config.local){for(var image,domain=location.protocol+"//"+location.host,images=document.body.getElementsByTagName("img"),i=images.length;i--;)if(image=images[i],image.src.substring(0,domain.length)===domain){config.local=image.src;break}config.local||(config.local=window)}var parameters={xdm_c:config.channel,xdm_p:0};config.local===window?(config.usePolling=!0,config.useParent=!0,config.local=location.protocol+"//"+location.host+location.pathname+location.search,parameters.xdm_e=config.local,parameters.xdm_pa=1):parameters.xdm_e=resolveUrl(config.local),config.container&&(config.useResize=!1,parameters.xdm_po=1),config.remote=appendQueryParameters(config.remote,parameters)}else apply(config,{channel:query.xdm_c,remote:query.xdm_e,useParent:!undef(query.xdm_pa),usePolling:!undef(query.xdm_po),useResize:!config.useParent&&config.useResize});stackEls=[new easyXDM.stack.HashTransport(config),new easyXDM.stack.ReliableBehavior({}),new easyXDM.stack.QueueBehavior({encode:!0,maxLength:4e3-config.remote.length}),new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"1":stackEls=[new easyXDM.stack.PostMessageTransport(config)];break;case"2":config.remoteHelper=resolveUrl(config.remoteHelper),stackEls=[new easyXDM.stack.NameTransport(config),new easyXDM.stack.QueueBehavior,new easyXDM.stack.VerifyBehavior({initiate:config.isHost})];break;case"3":stackEls=[new easyXDM.stack.NixTransport(config)];break;case"4":stackEls=[new easyXDM.stack.SameOriginTransport(config)];break;case"5":stackEls=[new easyXDM.stack.FrameElementTransport(config)];break;case"6":flashVersion||hasFlash(),stackEls=[new easyXDM.stack.FlashTransport(config)]}return stackEls.push(new easyXDM.stack.QueueBehavior({lazy:config.lazy,remove:!0})),stackEls}function chainStack(stackElements){for(var stackEl,defaults={incoming:function(message,origin){this.up.incoming(message,origin)},outgoing:function(message,recipient){this.down.outgoing(message,recipient)},callback:function(success){this.up.callback(success)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}},i=0,len=stackElements.length;len>i;i++)stackEl=stackElements[i],apply(stackEl,defaults,!0),0!==i&&(stackEl.down=stackElements[i-1]),i!==len-1&&(stackEl.up=stackElements[i+1]);return stackEl}function removeFromStack(element){element.up.down=element.down,element.down.up=element.up,element.up=element.down=null}var HAS_NAME_PROPERTY_BUG,flashVersion,HAS_FLASH_THROTTLED_BUG,on,un,global=this,channelId=Math.floor(1e4*Math.random()),emptyFn=Function.prototype,reURI=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/,reParent=/[\-\w]+\/\.\.\//,reDoubleSlash=/([^:])\/\//g,namespace="",easyXDM={},_easyXDM=window.easyXDM,IFRAME_PREFIX="easyXDM_",useHash=!1;if(isHostMethod(window,"addEventListener"))on=function(target,type,listener){target.addEventListener(type,listener,!1)},un=function(target,type,listener){target.removeEventListener(type,listener,!1)};else{if(!isHostMethod(window,"attachEvent"))throw new Error("Browser not supported");on=function(object,sEvent,fpNotify){object.attachEvent("on"+sEvent,fpNotify)},un=function(object,sEvent,fpNotify){object.detachEvent("on"+sEvent,fpNotify)}}var readyState,domIsReady=!1,domReadyQueue=[];if("readyState"in document?(readyState=document.readyState,domIsReady="complete"==readyState||~navigator.userAgent.indexOf("AppleWebKit/")&&("loaded"==readyState||"interactive"==readyState)):domIsReady=!!document.body,!domIsReady){if(isHostMethod(window,"addEventListener"))on(document,"DOMContentLoaded",dom_onReady);else if(on(document,"readystatechange",function(){"complete"==document.readyState&&dom_onReady()}),document.documentElement.doScroll&&window===top){var doScrollCheck=function(){if(!domIsReady){try{document.documentElement.doScroll("left")}catch(e){return void setTimeout(doScrollCheck,1)}dom_onReady()}};doScrollCheck()}on(window,"load",dom_onReady)}var query=function(input){input=input.substring(1).split("&");for(var pair,data={},i=input.length;i--;)pair=input[i].split("="),data[pair[0]]=decodeURIComponent(pair[1]);return data}(/xdm_e=/.test(location.search)?location.search:location.hash),getJSON=function(){var cached={},obj={a:[1,2,3]},json='{"a":[1,2,3]}';return"undefined"!=typeof JSON&&"function"==typeof JSON.stringify&&JSON.stringify(obj).replace(/\s/g,"")===json?JSON:(Object.toJSON&&Object.toJSON(obj).replace(/\s/g,"")===json&&(cached.stringify=Object.toJSON),"function"==typeof String.prototype.evalJSON&&(obj=json.evalJSON(),obj.a&&3===obj.a.length&&3===obj.a[2]&&(cached.parse=function(str){return str.evalJSON()})),cached.stringify&&cached.parse?(getJSON=function(){return cached},cached):null)};apply(easyXDM,{version:"2.4.17.1",query:query,stack:{},apply:apply,getJSONObject:getJSON,whenReady:whenReady,noConflict:noConflict}),easyXDM.DomHelper={on:on,un:un,requiresJSON:function(path){isHostObject(window,"JSON")||document.write('<script type="text/javascript" src="'+path+'"></script>')}},function(){var _map={};easyXDM.Fn={set:function(name,fn){_map[name]=fn},get:function(name,del){var fn=_map[name];return del&&delete _map[name],fn}}}(),easyXDM.Socket=function(config){var stack=chainStack(prepareTransportStack(config).concat([{incoming:function(message,origin){config.onMessage(message,origin)},callback:function(success){config.onReady&&config.onReady(success)}}])),recipient=getLocation(config.remote);this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},this.postMessage=function(message){stack.outgoing(message,recipient)},stack.init()},easyXDM.Rpc=function(config,jsonRpcConfig){if(jsonRpcConfig.local)for(var method in jsonRpcConfig.local)if(jsonRpcConfig.local.hasOwnProperty(method)){var member=jsonRpcConfig.local[method];"function"==typeof member&&(jsonRpcConfig.local[method]={method:member})}var stack=chainStack(prepareTransportStack(config).concat([new easyXDM.stack.RpcBehavior(this,jsonRpcConfig),{callback:function(success){config.onReady&&config.onReady(success)}}]));this.origin=getLocation(config.remote),this.destroy=function(){stack.destroy()},stack.init()},easyXDM.stack.SameOriginTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send(message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:location.protocol+"//"+location.host+location.pathname,xdm_c:config.channel,xdm_p:4}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),easyXDM.Fn.set(config.channel,function(sendFn){return send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}})):(send=getParentObject().Fn.get(config.channel,!0)(function(msg){pub.up.incoming(msg,targetOrigin)}),setTimeout(function(){pub.up.callback(!0)},0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FlashTransport=function(config){function onMessage(message,origin){setTimeout(function(){pub.up.incoming(message,targetOrigin)},0)}function addSwf(domain){var url=config.swf+"?host="+config.isHost,id="easyXDM_swf_"+Math.floor(1e4*Math.random());easyXDM.Fn.set("flash_loaded"+domain.replace(/[\-.]/g,"_"),function(){easyXDM.stack.FlashTransport[domain].swf=swf=swfContainer.firstChild;for(var queue=easyXDM.stack.FlashTransport[domain].queue,i=0;i<queue.length;i++)queue[i]();queue.length=0}),config.swfContainer?swfContainer="string"==typeof config.swfContainer?document.getElementById(config.swfContainer):config.swfContainer:(swfContainer=document.createElement("div"),apply(swfContainer.style,HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0}),document.body.appendChild(swfContainer));var flashVars="callback=flash_loaded"+domain.replace(/[\-.]/g,"_")+"&proto="+global.location.protocol+"&domain="+getDomainName(global.location.href)+"&port="+getPort(global.location.href)+"&ns="+namespace;swfContainer.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+id+"' data='"+url+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+url+"'></param><param name='flashvars' value='"+flashVars+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+flashVars+"' allowScriptAccess='always' wmode='transparent' src='"+url+"' height='1' width='1'></embed></object>"}var pub,frame,targetOrigin,swf,swfContainer;return pub={outgoing:function(message,domain,fn){swf.postMessage(config.channel,message.toString()),fn&&fn()},destroy:function(){try{swf.destroyChannel(config.channel)}catch(e){}swf=null,frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=config.remote,easyXDM.Fn.set("flash_"+config.channel+"_init",function(){setTimeout(function(){pub.up.callback(!0)})}),easyXDM.Fn.set("flash_"+config.channel+"_onMessage",onMessage),config.swf=resolveUrl(config.swf);var swfdomain=getDomainName(config.swf),fn=function(){easyXDM.stack.FlashTransport[swfdomain].init=!0,swf=easyXDM.stack.FlashTransport[swfdomain].swf,swf.createChannel(config.channel,config.secret,getLocation(config.remote),config.isHost),config.isHost&&(HAS_FLASH_THROTTLED_BUG&&config.swfNoThrottle&&apply(config.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"}),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:6,xdm_s:config.secret}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config))};easyXDM.stack.FlashTransport[swfdomain]&&easyXDM.stack.FlashTransport[swfdomain].init?fn():easyXDM.stack.FlashTransport[swfdomain]?easyXDM.stack.FlashTransport[swfdomain].queue.push(fn):(easyXDM.stack.FlashTransport[swfdomain]={queue:[fn]},addSwf(swfdomain))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.PostMessageTransport=function(config){function _getOrigin(event){if(event.origin)return getLocation(event.origin);if(event.uri)return getLocation(event.uri);if(event.domain)return location.protocol+"//"+event.domain;throw"Unable to retrieve the origin of the event"}function _window_onMessage(event){var origin=_getOrigin(event);origin==targetOrigin&&event.data.substring(0,config.channel.length+1)==config.channel+" "&&pub.up.incoming(event.data.substring(config.channel.length+1),origin)}var pub,frame,callerWindow,targetOrigin;return pub={outgoing:function(message,domain,fn){callerWindow.postMessage(config.channel+" "+message,domain||targetOrigin),fn&&fn()},destroy:function(){un(window,"message",_window_onMessage),frame&&(callerWindow=null,frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){if(targetOrigin=getLocation(config.remote),config.isHost){var waitForReady=function(event){event.data==config.channel+"-ready"&&(callerWindow="postMessage"in frame.contentWindow?frame.contentWindow:frame.contentWindow.document,un(window,"message",waitForReady),on(window,"message",_window_onMessage),setTimeout(function(){pub.up.callback(!0)},0))};on(window,"message",waitForReady),apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:1}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config)}else on(window,"message",_window_onMessage),callerWindow="postMessage"in window.parent?window.parent:window.parent.document,callerWindow.postMessage(config.channel+"-ready",targetOrigin),setTimeout(function(){pub.up.callback(!0)},0)},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.FrameElementTransport=function(config){var pub,frame,send,targetOrigin;return pub={outgoing:function(message,domain,fn){send.call(this,message),fn&&fn()},destroy:function(){frame&&(frame.parentNode.removeChild(frame),frame=null)},onDOMReady:function(){targetOrigin=getLocation(config.remote),config.isHost?(apply(config.props,{src:appendQueryParameters(config.remote,{xdm_e:getLocation(location.href),xdm_c:config.channel,xdm_p:5}),name:IFRAME_PREFIX+config.channel+"_provider"}),frame=createFrame(config),frame.fn=function(sendFn){return delete frame.fn,send=sendFn,setTimeout(function(){pub.up.callback(!0)},0),function(msg){pub.up.incoming(msg,targetOrigin)}}):(document.referrer&&getLocation(document.referrer)!=query.xdm_e&&(window.top.location=query.xdm_e),send=window.frameElement.fn(function(msg){pub.up.incoming(msg,targetOrigin)}),pub.up.callback(!0))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.NameTransport=function(config){function _sendMessage(message){var url=config.remoteHelper+(isHost?"#_3":"#_2")+config.channel;callerWindow.contentWindow.sendMessage(message,url)}function _onReady(){isHost?2!==++readyCount&&isHost||pub.up.callback(!0):(_sendMessage("ready"),pub.up.callback(!0))}function _onMessage(message){pub.up.incoming(message,remoteOrigin)}function _onLoad(){callback&&setTimeout(function(){callback(!0)},0)}var pub,isHost,callerWindow,remoteWindow,readyCount,callback,remoteOrigin,remoteUrl;return pub={outgoing:function(message,domain,fn){callback=fn,_sendMessage(message)},destroy:function(){callerWindow.parentNode.removeChild(callerWindow),callerWindow=null,isHost&&(remoteWindow.parentNode.removeChild(remoteWindow),remoteWindow=null)},onDOMReady:function(){isHost=config.isHost,readyCount=0,remoteOrigin=getLocation(config.remote),config.local=resolveUrl(config.local),isHost?(easyXDM.Fn.set(config.channel,function(message){isHost&&"ready"===message&&(easyXDM.Fn.set(config.channel,_onMessage),_onReady())}),remoteUrl=appendQueryParameters(config.remote,{xdm_e:config.local,xdm_c:config.channel,xdm_p:2}),apply(config.props,{src:remoteUrl+"#"+config.channel,name:IFRAME_PREFIX+config.channel+"_provider"}),remoteWindow=createFrame(config)):(config.remoteHelper=config.remote,easyXDM.Fn.set(config.channel,_onMessage));var onLoad=function(){var w=callerWindow||this;un(w,"load",onLoad),easyXDM.Fn.set(config.channel+"_load",_onLoad),function test(){"function"==typeof w.contentWindow.sendMessage?_onReady():setTimeout(test,50)}()};callerWindow=createFrame({props:{src:config.local+"#_4"+config.channel},onLoad:onLoad})},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.HashTransport=function(config){function _sendMessage(message){if(_callerWindow){var url=config.remote+"#"+_msgNr++ +"_"+message;(isHost||!useParent?_callerWindow.contentWindow:_callerWindow).location=url}}function _handleHash(hash){_lastMsg=hash,pub.up.incoming(_lastMsg.substring(_lastMsg.indexOf("_")+1),_remoteOrigin)}function _pollHash(){if(_listenerWindow){var href=_listenerWindow.location.href,hash="",indexOf=href.indexOf("#");-1!=indexOf&&(hash=href.substring(indexOf)),hash&&hash!=_lastMsg&&_handleHash(hash)}}function _attachListeners(){_timer=setInterval(_pollHash,pollInterval)}var pub,isHost,_timer,pollInterval,_lastMsg,_msgNr,_listenerWindow,_callerWindow,useParent,_remoteOrigin;return pub={outgoing:function(message,domain){_sendMessage(message)},destroy:function(){window.clearInterval(_timer),!isHost&&useParent||_callerWindow.parentNode.removeChild(_callerWindow),_callerWindow=null},onDOMReady:function(){if(isHost=config.isHost,pollInterval=config.interval,_lastMsg="#"+config.channel,_msgNr=0,useParent=config.useParent,_remoteOrigin=getLocation(config.remote),isHost){if(apply(config.props,{src:config.remote,name:IFRAME_PREFIX+config.channel+"_provider"}),useParent)config.onLoad=function(){_listenerWindow=window,_attachListeners(),pub.up.callback(!0)};else{var tries=0,max=config.delay/50;!function getRef(){if(++tries>max)throw new Error("Unable to reference listenerwindow");try{_listenerWindow=_callerWindow.contentWindow.frames[IFRAME_PREFIX+config.channel+"_consumer"]}catch(ex){}_listenerWindow?(_attachListeners(),pub.up.callback(!0)):setTimeout(getRef,50)}()}_callerWindow=createFrame(config)}else _listenerWindow=window,_attachListeners(),useParent?(_callerWindow=parent,pub.up.callback(!0)):(apply(config,{props:{src:config.remote+"#"+config.channel+new Date,name:IFRAME_PREFIX+config.channel+"_consumer"},onLoad:function(){pub.up.callback(!0)}}),_callerWindow=createFrame(config))},init:function(){whenReady(pub.onDOMReady,pub)}}},easyXDM.stack.ReliableBehavior=function(config){var pub,callback,idOut=0,idIn=0,currentMessage="";return pub={incoming:function(message,origin){var indexOf=message.indexOf("_"),ack=message.substring(0,indexOf).split(",");message=message.substring(indexOf+1),ack[0]==idOut&&(currentMessage="",callback&&(callback(!0),callback=null)),message.length>0&&(pub.down.outgoing(ack[1]+","+idOut+"_"+currentMessage,origin),idIn!=ack[1]&&(idIn=ack[1],pub.up.incoming(message,origin)))},outgoing:function(message,origin,fn){currentMessage=message,callback=fn,pub.down.outgoing(idIn+","+ ++idOut+"_"+message,origin)}}},easyXDM.stack.QueueBehavior=function(config){function dispatch(){if(config.remove&&0===queue.length)return void removeFromStack(pub);if(!waiting&&0!==queue.length&&!destroying){waiting=!0;var message=queue.shift();pub.down.outgoing(message.data,message.origin,function(success){
waiting=!1,message.callback&&setTimeout(function(){message.callback(success)},0),dispatch()})}}var pub,destroying,queue=[],waiting=!0,incoming="",maxLength=0,lazy=!1,doFragment=!1;return pub={init:function(){undef(config)&&(config={}),config.maxLength&&(maxLength=config.maxLength,doFragment=!0),config.lazy?lazy=!0:pub.down.init()},callback:function(success){waiting=!1;var up=pub.up;dispatch(),up.callback(success)},incoming:function(message,origin){if(doFragment){var indexOf=message.indexOf("_"),seq=parseInt(message.substring(0,indexOf),10);incoming+=message.substring(indexOf+1),0===seq&&(config.encode&&(incoming=decodeURIComponent(incoming)),pub.up.incoming(incoming,origin),incoming="")}else pub.up.incoming(message,origin)},outgoing:function(message,origin,fn){config.encode&&(message=encodeURIComponent(message));var fragment,fragments=[];if(doFragment){for(;0!==message.length;)fragment=message.substring(0,maxLength),message=message.substring(fragment.length),fragments.push(fragment);for(;fragment=fragments.shift();)queue.push({data:fragments.length+"_"+fragment,origin:origin,callback:0===fragments.length?fn:null})}else queue.push({data:message,origin:origin,callback:fn});lazy?pub.down.init():dispatch()},destroy:function(){destroying=!0,pub.down.destroy()}}},easyXDM.stack.VerifyBehavior=function(config){function startVerification(){mySecret=Math.random().toString(16).substring(2),pub.down.outgoing(mySecret)}var pub,mySecret,theirSecret;return pub={incoming:function(message,origin){var indexOf=message.indexOf("_");-1===indexOf?message===mySecret?pub.up.callback(!0):theirSecret||(theirSecret=message,config.initiate||startVerification(),pub.down.outgoing(message)):message.substring(0,indexOf)===theirSecret&&pub.up.incoming(message.substring(indexOf+1),origin)},outgoing:function(message,origin,fn){pub.down.outgoing(mySecret+"_"+message,origin,fn)},callback:function(success){config.initiate&&startVerification()}}},easyXDM.stack.RpcBehavior=function(proxy,config){function _send(data){data.jsonrpc="2.0",pub.down.outgoing(serializer.stringify(data))}function _createMethod(definition,method){var slice=Array.prototype.slice;return function(){var callback,l=arguments.length,message={method:method};l>0&&"function"==typeof arguments[l-1]?(l>1&&"function"==typeof arguments[l-2]?(callback={success:arguments[l-2],error:arguments[l-1]},message.params=slice.call(arguments,0,l-2)):(callback={success:arguments[l-1]},message.params=slice.call(arguments,0,l-1)),_callbacks[""+ ++_callbackCounter]=callback,message.id=_callbackCounter):message.params=slice.call(arguments,0),definition.namedParams&&1===message.params.length&&(message.params=message.params[0]),_send(message)}}function _executeMethod(method,id,fn,params){if(!fn)return void(id&&_send({id:id,error:{code:-32601,message:"Procedure not found."}}));var success,error;id?(success=function(result){success=emptyFn,_send({id:id,result:result})},error=function(message,data){error=emptyFn;var msg={id:id,error:{code:-32099,message:message}};data&&(msg.error.data=data),_send(msg)}):success=error=emptyFn,isArray(params)||(params=[params]);try{var result=fn.method.apply(fn.scope,params.concat([success,error]));undef(result)||success(result)}catch(ex1){error(ex1.message)}}var pub,serializer=config.serializer||getJSON(),_callbackCounter=0,_callbacks={};return pub={incoming:function(message,origin){var data=serializer.parse(message);if(data.method)config.handle?config.handle(data,_send):_executeMethod(data.method,data.id,config.local[data.method],data.params);else{var callback=_callbacks[data.id];data.error?callback.error&&callback.error(data.error):callback.success&&callback.success(data.result),delete _callbacks[data.id]}},init:function(){if(config.remote)for(var method in config.remote)config.remote.hasOwnProperty(method)&&(proxy[method]=_createMethod(config.remote[method],method));pub.down.init()},destroy:function(){for(var method in config.remote)config.remote.hasOwnProperty(method)&&proxy.hasOwnProperty(method)&&delete proxy[method];pub.down.destroy()}}},global.easyXDM=easyXDM}(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);var RefME=(window.RefMEConfig=function(document,window){"use strict";var conf={NODE_ENV:"production",REFME_WEB_URL:"https://app.refme.com",REFME_WIDGET_URL:"https://widget.refme.com",REFME_WIDGET_APP_ID:"7d13e21224034c25225261650338605c17a2fa41a49491ddaa1796cdffd28600",NODE_URL:"https://refmenode-production.herokuapp.com",CSL_SERVICE_URL:"https://csl-service.refme.com",DATA_SERVICE_URL:"https://data-service.refme.com"};return"undefined"!=typeof angular&&angular.module("config",[]).constant("ENV",{name:conf.NODE_ENV,clientToken:"R3FM34P1",formatRefEndpoint:"https://api.refme.com/format-reference",nodeServer:conf.NODE_URL,REFME_WEB_URL:conf.REFME_WEB_URL,cslServiceEndpoint:conf.CSL_SERVICE_URL,dataServiceEndpoint:conf.DATA_SERVICE_URL,REFME_WIDGET_APP_ID:conf.REFME_WIDGET_APP_ID,REFME_WIDGET_URL:conf.REFME_WIDGET_URL}),conf}(document,window),window.RefME=function(document,window){"use strict";function createInvisibleSocket(onReady){return createASocket(document.body,onReady)}function sendMessage(action,options,s){if(s||(s=socket),!s)return void console.error("Cannot send message without socket");var msg={action:action,data:options.data,config:merge(CONFIG,options.config)};s.postMessage(JSON.stringify(msg))}function addButtonContent(elem){var img;elem&&(img="small"===elem.getAttribute("data-size")?RefMEConfig.REFME_WIDGET_URL+"/images/cite.png":RefMEConfig.REFME_WIDGET_URL+"/images/cite-large.png",elem.innerHTML=['<div class="js-refme-widget-container" ',' style="display: inline-block; position: relative;">','<a href="#" style="display: inline-block;">','<img src="'+img+'" style="border: none; vertical-align: middle;" />',"</a>","</div>"].join(""))}function loadXDMAndThen(cb){setTimeout(cb,0)}function merge(){var objs=[].slice.call(arguments),ret={};return objs.forEach(function(obj){var key,value;if(obj)for(key in obj)obj.propertyIsEnumerable(key)&&(value=obj[key],ret[key]=value)}),ret}function createASocket(container,onReady){if(!container)return null;container=container.querySelector(".js-refme-widget-container")||container;var style=iframePosition(container);style.background="#fff",style.display="none",style.position="absolute",style.height="1px",style.width="320px",style.zIndex="9999",style.border="1px solid #a7afb9",style.transform="translateZ(0)",style.webkitTransform="translateZ(0)",style.backfaceVisibility="hidden",style.webkitBackfaceVisibility="hidden";var ret=new easyXDM.Socket({remote:RefMEConfig.REFME_WEB_URL+"/widget/?base="+encodeURIComponent(RefMEConfig.REFME_WIDGET_URL),container:container,onMessage:function(message){if("close"===message)this.container.getElementsByTagName("iframe")[0].style.display="none",ret.postMessage("close");else{var data;try{if(data=JSON.parse(message),"setHeight"===data.action){var dim=data.dimensions?data.dimensions+"px":null;this.container.getElementsByTagName("iframe")[0].style.height=dim}else"listening"===data.action&&(ret.listening=!0,ret.container&&onReady())}catch(e){console.error("could not parse message: "+message)}}},onReady:function(){ret.container=this.container,ret.listening&&onReady()},props:{style:style}});return ret}function addEvent(elem,event,fn){function listenHandler(e){var ret=fn.apply(this,arguments);return ret===!1&&(e.stopPropagation(),e.preventDefault()),ret}function attachHandler(){var ret=fn.call(elem,window.event);return ret===!1&&(window.event.returnValue=!1,window.event.cancelBubble=!0),ret}elem&&(elem.addEventListener?elem.addEventListener(event,listenHandler,!1):elem.attachEvent("on"+event,attachHandler))}function iframePosition(container){var w=Math.max(document.documentElement.clientWidth,window.innerWidth||0),h=Math.max(document.documentElement.clientHeight,window.innerHeight||0),rect=container.getBoundingClientRect(),style={},spaceLeft=rect.left,spaceRight=w-rect.right,spaceAbove=rect.top,spaceBelow=h-rect.bottom;return spaceLeft>spaceRight?style.right="0":style.left="0",spaceBelow>spaceAbove?style.top="110%":style.bottom="110%",style}var RefME={},RefMEConfig=window.RefMEConfig,easyXDM=window.easyXDM;window.location.origin||(window.location.origin=window.location.protocol+"//"+window.location.hostname+(window.location.port?":"+window.location.port:""));var CONFIG={branded:!0,host:String(window.location.origin)},socket=null;return RefME.setDefaults=function(options){var key,value;if(options)for(key in options)options.propertyIsEnumerable(key)&&(value=options[key],CONFIG[key]=value)},RefME.createButton=function(options){function InitialiseOrOpen(){ret.socket?ret.socket.listening&&RefME.openWidget(options,ret.socket):(options.config&&ret.setConfig(options.config),options.data&&ret.setReferences(options.data),loadXDMAndThen(function(){ret.socket=createASocket(ret.elem,function(){syncIfReady(),RefME.openWidget(options,ret.socket)})}))}function syncIfReady(){ret.socket&&ret.socket.listening&&sendMessage("setState",{config:merge(CONFIG,conf),data:data},ret.socket)}options=options||{};var ret={},conf=merge(CONFIG,options.config),elem=options.element,data=[];if("string"==typeof elem&&(elem=document.querySelector(elem),!elem))throw new Error('RefME Widget: cannot find target element "'+options.element+'"');ret.elem=elem,ret.setReferences=function(references){data=references,syncIfReady()},ret.setConfig=function(config){conf=merge(CONFIG,config),syncIfReady()},conf.branded&&addButtonContent(ret.elem);var clickTarget=conf.branded?ret.elem.querySelector("a > img"):ret.elem;return addEvent(clickTarget,"click",function(e){e.preventDefault(),e.stopPropagation(),e.target===clickTarget&&InitialiseOrOpen()}),ret},RefME.openWidget=function(options,s){return s||(s=socket),s?(s.container.style.position="relative",s.container.getElementsByTagName("iframe")[0].style.display="block",void sendMessage("open",options,s)):console.error("Cannot access container - socket is null")},RefME.show=function(options){function onReady(){var conf=merge(CONFIG,options.config),msg={config:conf,data:options.data};RefME.openWidget(options,ret.socket),sendMessage("setState",msg,ret.socket)}options=options||{};var ret={},elem=options.element||document.body;return"string"==typeof elem&&(elem=document.querySelector(elem)),ret.elem=elem,ret.socket=createASocket(elem,onReady),ret},RefME.exportReferences=function(options,s){s||(s=socket),s?sendMessage("export",options,s):s=createInvisibleSocket(function(){sendMessage("export",options,s)})},RefME.autoLoad=function(){var element;element=document.getElementById("refme-auto-cite")||document.getElementById("refme-cite"),element&&this.createButton({element:element,data:{lookup:String(window.location)}})},addEvent(window,"load",function(){RefME.autoLoad()}),RefME}(document,window));return RefME}),!function(){var e=function(){var e={},t=function(t,r,n){for(var o=t.split("."),i=0;i<o.length-1;i++)n[o[i]]||(n[o[i]]={}),n=n[o[i]];"function"==typeof r?r.isClass?n[o[i]]=r:n[o[i]]=function(){return r.apply(e,arguments)}:n[o[i]]=r},r=function(r,n,o){t(r,n,e),o&&t(r,n,window.filepicker)},n=function(t,n,o){"function"==typeof t&&(o=n,n=t,t=""),t&&(t+=".");var i=n.call(e);for(var a in i)r(t+a,i[a],o)},o=function(t){t.apply(e,arguments)};return{extend:n,internal:o}}();if(window.filepicker)for(var t in e)window.filepicker[t]=e[t];else window.filepicker=e}(),filepicker.extend("comm",function(){var e=this,t="filepicker_comm_iframe",r="fpapi_comm_iframe",n=function(){if(void 0===window.frames[t]){a();var n;n=document.createElement("iframe"),n.id=n.name=t,n.src=e.urls.COMM,n.style.display="none",document.body.appendChild(n)}if(void 0===window.frames[r]){a();var o;o=document.createElement("iframe"),o.id=o.name=r,o.src=e.urls.API_COMM,o.style.display="none",document.body.appendChild(o)}},o=function(t){if(t.origin===e.urls.BASE||t.origin===e.urls.DIALOG_BASE){var r=e.json.parse(t.data);e.handlers.run(r)}},i=!1,a=function(){if(!i)if(i=!0,window.addEventListener)window.addEventListener("message",o,!1);else{if(!window.attachEvent)throw new e.FilepickerException("Unsupported browser");window.attachEvent("onmessage",o)}},s=function(){if(window.removeEventListener)window.removeEventListener("message",o,!1);else{if(!window.attachEvent)throw new e.FilepickerException("Unsupported browser");window.detachEvent("onmessage",o)}if(i){i=!1;for(var n=document.getElementsByName(t),a=0;a<n.length;a++)n[a].parentNode.removeChild(n[a]);try{delete window.frames[t]}catch(s){}for(var c=document.getElementsByName(r),l=0;l<c.length;l++)c[l].parentNode.removeChild(c[l]);try{delete window.frames[r]}catch(s){}}};return{openChannel:n,closeChannel:s}}),filepicker.extend("comm_fallback",function(){var e,t,r=this,n="filepicker_comm_iframe",o="host_comm_iframe",i="",a=200,s=function(){c()},c=function(){if(void 0===window.frames[o]){var e;e=document.createElement("iframe"),e.id=e.name=o,i=e.src=r.urls.constructHostCommFallback(),e.style.display="none";var t=function(){i=e.contentWindow.location.href,l()};e.attachEvent?e.attachEvent("onload",t):e.onload=t,document.body.appendChild(e)}},l=function(){if(void 0===window.frames[n]){var e;e=document.createElement("iframe"),e.id=e.name=n,e.src=r.urls.FP_COMM_FALLBACK+"?host_url="+encodeURIComponent(i),e.style.display="none",document.body.appendChild(e)}f()},u=!1,d="",p=function(){var e=window.frames[n];if(e){var t=e.frames[o];if(t){var i=t.location.hash;if(i&&"#"===i.charAt(0)&&(i=i.substr(1)),i!==d&&(d=i)){var a;try{a=r.json.parse(i)}catch(s){}a&&r.handlers.run(a)}}}},f=function(){u||(u=!0,e=window.setInterval(p,a))},m=function(){if(window.clearInterval(e),u){u=!1;for(var t=document.getElementsByName(n),r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r]);try{delete window.frames[n]}catch(i){}for(t=document.getElementsByName(o),r=0;r<t.length;r++)t[r].parentNode.removeChild(t[r]);try{delete window.frames[o]}catch(i){}}},h=!("postMessage"in window),g=function(){t=r.comm,r.comm={openChannel:s,closeChannel:m}};return h&&g(),{openChannel:s,closeChannel:m,isEnabled:h}}),filepicker.extend("cookies",function(){var e=this,t=function(t){var r=function(r){"ThirdPartyCookies"===r.type&&(e.cookies.THIRD_PARTY_COOKIES=!!r.payload,t&&"function"==typeof t&&t(!!r.payload))};return r},r=function(r){var n=t(r);e.handlers.attach("cookies",n),e.comm.openChannel()};return{checkThirdParty:r}}),filepicker.extend("handlers",function(){var e={},t=function(t,r){return e.hasOwnProperty(t)?e[t].push(r):e[t]=[r],r},r=function(t,r){var n=e[t];if(n)if(r){for(var o=0;o<n.length;o++)if(n[o]===r){n.splice(o,1);break}0===n.length&&delete e[t]}else delete e[t]},n=function(t){var r=t.id;if(e.hasOwnProperty(r)){for(var n=e[r],o=0;o<n.length;o++)n[o](t);return!0}return!1};return{attach:t,detach:r,run:n}}),filepicker.extend("exporter",function(){var e=this,t=function(t){var r=function(r,n,o){t[n]&&!e.util.isArray(t[n])?t[n]=[t[n]]:t[r]?t[n]=[t[r]]:o&&(t[n]=o)};if(t.mimetype&&t.extension)throw e.FilepickerException("Error: Cannot pass in both mimetype and extension parameters to the export function");if(r("service","services"),t.services)for(var n=0;n<t.services.length;n++){var o=(""+t.services[n]).replace(" ",""),i=e.services[o];t.services[n]=void 0===i?o:i}t.openTo&&(t.openTo=e.services[t.openTo]||t.openTo),e.util.setDefault(t,"container",e.browser.openInModal()?"modal":"window")},r=function(t,r){var n=function(n){if("filepickerUrl"===n.type){if(n.error)e.util.console.error(n.error),r(e.errors.FPError(132));else{var o={};o.url=n.payload.url,o.filename=n.payload.data.filename,o.mimetype=n.payload.data.type,o.size=n.payload.data.size,o.client=n.payload.data.client,o.isWriteable=!0,t(o)}e.modal.close()}};return n},n=function(o,i,a,s){t(i);var c={close:function(){e.modal.close()}};if(i.debug)return setTimeout(function(){a({id:1,url:"https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1",filename:"test.png",mimetype:"image/png",size:58979,client:"computer"})},1),c;if(void 0===e.cookies.THIRD_PARTY_COOKIES){var l=!1;return e.cookies.checkThirdParty(function(){l||(n(o,i,a,s),l=!0)}),c}var u=e.util.getId(),d=!1,p=function(e){d=!0,a(e)},f=function(e){d=!0,s(e)},m=function(){d||(d=!0,s(e.errors.FPError(131)))};return e.window.open(i.container,e.urls.constructExportUrl(o,i,u),m),e.handlers.attach(u,r(p,f)),c};return{createExporter:n}}),filepicker.extend("modal",function(){function e(){var e=document.getElementById(i);e&&(e.hidden=!0);var r=document.getElementById(a);r&&(r.hidden=!0),t()}function t(){var e=n();e&&(e.style.overflow=c)}function r(){var e=".fp__overlay {top: 0;right: 0;bottom: 0;left: 0;z-index: 1000;background: rgba(0, 0, 0, 0.8);}.fp__close {top: 104px; right: 108px; width: 35px; height: 35px; z-index: 20; cursor: pointer}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__close {top: 15px; right: 12px;}}.fp__close a {text-indent: -9999px; overflow: hidden; display: block; width: 100%; height: 100%; background: url(https://d1zyh3sbxittvg.cloudfront.net/close.png) 50% 50% no-repeat;}.fp__close a:hover {background-color: rgba(0,0,0, .02); opacity: .8;}@media screen and (max-width: 768px), screen and (max-height: 500px) {top: 14px; right: 14px;}.fp__copy {display: none;}.fp__container {-webkit-overflow-scrolling: touch; overflow: hidden; min-height: 300px; top: 100px;right: 100px;bottom: 100px;left: 100px;background: #eee; box-sizing:content-box; -webkit-box-sizing:content-box; -moz-box-sizing:content-box;}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__copy {bottom: 0; left: 0; right: 0; height: 20px; background: #333;}}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__copy a {margin-left: 5px;}}@media screen and (max-width: 768px), screen and (max-height: 500px) {.fp__container {top: 0;right: 0;bottom: 0;left: 0;}}.fp__overlay, .fp__close, .fp__copy, .fp__container {position: fixed;}",t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}function n(){try{return document.getElementsByTagName("html")[0]}catch(e){return null}}var o=this,i="filepicker_shade",a="filepicker_dialog_container",s=n();if(s)var c=s.style.overflow;var l=function(e,t){r();var i=u(t),a=d(),s=p(t),c=document.createElement("iframe");c.name=o.window.WINDOW_NAME,c.id=o.window.WINDOW_NAME,c.style.width="100%",c.style.height="100%",c.style.border="none",c.style.position="relative",c.setAttribute("border",0),c.setAttribute("frameborder",0),c.setAttribute("frameBorder",0),c.setAttribute("marginwidth",0),c.setAttribute("marginheight",0),c.src=e,a.appendChild(c),i.appendChild(s),i.appendChild(a),document.body.appendChild(i);var l=n();return l&&(l.style.overflow="hidden"),c},u=function(e){var t=document.createElement("div");return t.id=i,t.className="fp__overlay",t.onclick=f(e),t},d=function(){var e=document.createElement("div");return e.id=a,e.className="fp__container",e},p=function(e){var t=document.createElement("div");t.className="fp__close";var r=document.createElement("a");return r.appendChild(document.createTextNode("X")),t.appendChild(r),r.onclick=f(e),document.onkeydown=function(t){t=t||window.event,27===t.keyCode&&f(e)()},t},f=function(e,r){return r=!!r,function(){if(!o.uploading||r||window.confirm('You are currently uploading. If you choose "OK", the window will close and your upload will not finish. Do you want to stop uploading and close the window?')){o.uploading=!1,document.onkeydown=null,t();var n=document.getElementById(i);n&&document.body.removeChild(n);var s=document.getElementById(a);s&&document.body.removeChild(s);try{delete window.frames[o.window.WINDOW_NAME]}catch(c){}e&&e()}}},m=f(function(){});return{generate:l,close:m,hide:e}}),filepicker.extend("picker",function(){function e(e,r){if("filepickerProgress"===e.type)t.uploading=!0,r&&r(e.payload.data);else if("notUploading"===e.type)t.uploading=!1;else if("closeModal"===e.type)t.modal.close();else if("hideModal"===e.type)t.modal.hide();else if("filepickerUrl"===e.type)return!1;return!0}var t=this,r=function(e){var r=function(r,n,o){e[n]?t.util.isArray(e[n])||(e[n]=[e[n]]):e[r]?e[n]=[e[r]]:o&&(e[n]=o)};if(r("service","services"),r("mimetype","mimetypes"),r("extension","extensions"),e.services)for(var n=0;n<e.services.length;n++){var o=(""+e.services[n]).replace(" ","");void 0!==t.services[o]&&(o=t.services[o]),e.services[n]=o}if(e.mimetypes&&e.extensions)throw t.FilepickerException("Error: Cannot pass in both mimetype and extension parameters to the pick function");e.mimetypes||e.extensions||(e.mimetypes=["*/*"]),e.openTo&&(e.openTo=t.services[e.openTo]||e.openTo),t.util.setDefault(e,"container",t.browser.openInModal()?"modal":"window")},n=function(r,n,o){var i=function(i){if(!e(i,o)){if(t.uploading=!1,i.error)t.util.console.error(i.error),n(t.errors.FPError(102));else{var a=s(i.payload);r(a)}t.modal.close()}};return i},o=function(r,n,o){var i=function(i){e(i,o)||(t.uploading=!1,i.error?(t.util.console.error(i.error),n(t.errors.FPError(102))):(i.payload.data.url=i.payload.url,r(i.payload.data)),t.modal.close())};return i},i=function(e){e=e||function(){};var r=function(r){"uploading"===r.type&&(t.uploading=!!r.payload,e(t.uploading))};return r},a=function(e,t,r){e[r]&&(t[r]=e[r])},s=function(e){var t={},r=e.url;r&&r.url&&(r=r.url),t.url=r;var n=e.url.data||e.data;return t.filename=n.filename,t.mimetype=n.type,t.size=n.size,a(n,t,"id"),a(n,t,"key"),a(n,t,"container"),a(n,t,"path"),a(n,t,"client"),t.isWriteable=!0,t},c=function(r,n,o){var i=function(i){if(!e(i,o)){if(t.uploading=!1,i.error)t.util.console.error(i.error),n(t.errors.FPError(102));else{var a=[];t.util.isArray(i.payload)||(i.payload=[i.payload]);for(var c=0;c<i.payload.length;c++){var l=s(i.payload[c]);a.push(l)}r(a)}t.modal.close()}};return i},l=function(e,a,s,u,d,p,f){r(e);var m={close:function(){t.modal.close()}};if(e.debug){var h,g={id:1,url:"https://www.filepicker.io/api/file/-nBq2onTSemLBxlcBWn1",filename:"test.png",mimetype:"image/png",size:58979,client:"computer"};return h=u||e.storeLocation?[g,g,g]:g,setTimeout(function(){a(h)},1),m}if(void 0===t.cookies.THIRD_PARTY_COOKIES){var v=!1;return t.cookies.checkThirdParty(function(){v||(l(e,a,s,!!u,d,p),v=!0)}),m}var w,y,b=t.util.getId(),x=!1,E=function(t){"window"===e.container&&(window.onbeforeunload=null),x=!0,a(t)},A=function(e){x=!0,s(e)},F=function(){x||(x=!0,s(t.errors.FPError(101)))};f?(w=t.urls.constructConvertUrl(e,b),y=n(E,A,p)):u?(w=t.urls.constructPickUrl(e,b,!0),y=c(E,A,p)):d?(w=t.urls.constructPickFolderUrl(e,b),y=o(E,A,p)):(w=t.urls.constructPickUrl(e,b,!1),y=n(E,A,p)),t.window.open(e.container,w,F),t.handlers.attach(b,y);var k=b+"-upload";return t.handlers.attach(k,i(function(){t.handlers.detach(k)})),m};return{createPicker:l}}),filepicker.extend("window",function(){var e=this,t="filepicker_dialog",r="left=100,top=100,height=600,width=800,menubar=no,toolbar=no,location=no,personalbar=no,status=no,resizable=yes,scrollbars=yes,dependent=yes,dialog=yes",n=100,o=function(o,i,a){if(a=a||function(){},!o&&e.browser.openInModal()?o="modal":o||(o="window"),"window"===o){var s=t+e.util.getId();window.onbeforeunload=function(){return"Filepicker upload does not complete."};var c=window.open(i,s,r);c||(window.onbeforeunload=null,window.alert("Please disable your popup blocker to upload files."));var l=window.setInterval(function(){(!c||c.closed)&&(window.onbeforeunload=null,window.clearInterval(l),a())},n)}else if("modal"===o)e.modal.generate(i,a);else{var u=document.getElementById(o);if(!u)throw new e.FilepickerException('Container "'+o+'" not found. This should either be set to "window","modal", or the ID of an iframe that is currently in the document.');u.src=i}};return{open:o,WINDOW_NAME:t}}),filepicker.extend("conversions",function(){var e=this,t={align:"string",blurAmount:"number",crop:"string or array",crop_first:"boolean",compress:"boolean",exif:"string or boolean",filter:"string",fit:"string",format:"string",height:"number",policy:"string",quality:"number",page:"number",rotate:"string or number",secure:"boolean",sharpenAmount:"number",signature:"string",storeAccess:"string",storeContainer:"string",storeRegion:"string",storeLocation:"string",storePath:"string",text:"string",text_align:"string",text_color:"string",text_font:"string",text_padding:"number",text_size:"number",watermark:"string",watermark_position:"string",watermark_size:"number",width:"number"},r={w:"width",h:"height"},n=function(e){var n={};for(var o in e)n[r[o]||o]=e[o],"number"===t[r[o]||o]&&(n[r[o]||o]=Number(e[o]));return n},o=function(r){var n;for(var o in r){n=!1;for(var i in t)if(o===i&&(n=!0,-1===t[i].indexOf(e.util.typeOf(r[o]))))throw new e.FilepickerException("Conversion parameter "+o+" is not the right type: "+r[o]+". Should be a "+t[i]);if(!n)throw new e.FilepickerException("Conversion parameter "+o+" is not a valid parameter.")}},i=function(t,r,n,i,a){o(r),r.crop&&e.util.isArray(r.crop)&&(r.crop=r.crop.join(",")),e.ajax.post(t+"/convert",{data:r,json:!0,success:function(t){n(e.util.standardizeFPFile(t))},error:function(t,r,n){i("not_found"===t?new e.errors.FPError(141):"bad_params"===t?new e.errors.FPError(142):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(143))},progress:a})};return{convert:i,mapRestParams:n}}),filepicker.extend("errors",function(){var e=this,t=function(e){if(this===window)return new t(e);if(this.code=e,filepicker.debug){var r=filepicker.error_map[this.code];this.message=r.message,this.moreInfo=r.moreInfo,this.toString=function(){return"FPError "+this.code+": "+this.message+". For help, see "+this.moreInfo}}else this.toString=function(){return"FPError "+this.code+". Include filepicker_debug.js for more info"};return this};t.isClass=!0;var r=function(t){filepicker.debug&&e.util.console.error(t.toString())};return{FPError:t,handleError:r}},!0),filepicker.extend(function(){var e=this,t="2.4.5";e.API_VERSION="v2";var r=function(t){e.apikey=t},n=function(e){return this.text=e,this.toString=function(){return"FilepickerException: "+this.text},this};n.isClass=!0;var o=function(t,r,n,o){return e.util.checkApiKey(),"function"==typeof t&&(n=r,r=t,t={}),t=t||{},r=r||function(){},n=n||e.errors.handleError,e.picker.createPicker(t,r,n,!1,!1,o)},i=function(t,r,n,o){return e.util.checkApiKey(),"function"==typeof t&&(o=n,n=r,r=t,t={}),t=t||{},r=r||function(){},n=n||e.errors.handleError,e.picker.createPicker(t,r,n,!0,!1,o)},a=function(t,r,n,o,i){if(e.util.checkApiKey(),!t||!r||"function"==typeof t||"function"==typeof t)throw new e.FilepickerException("Not all required parameters given, missing picker or store options");o=o||e.errors.handleError;var a=!!t.multiple,s=t?e.util.clone(t):{};if(s.storeLocation=r.location||"S3",s.storePath=r.path,s.storeContainer=r.storeContainer||r.container,s.storeRegion=r.storeRegion,s.storeAccess=r.access||"private",a&&s.storePath&&"/"!==s.storePath.charAt(s.storePath.length-1))throw new e.FilepickerException(NaN);var c=n;return a||(c=function(e){n([e])}),e.picker.createPicker(s,c,o,a,!1,i)},s=function(t,r,n,o){return e.util.checkApiKey(),"function"==typeof t&&(n=r,r=t,t={}),t=t||{},r=r||function(){},n=n||e.errors.handleError,e.picker.createPicker(t,r,n,!1,!0,o)},c=function(t,r,n,o,i){if(e.util.checkApiKey(),!t)throw new e.FilepickerException("No input given - nothing to read!");if("function"==typeof r&&(i=o,o=n,n=r,r={}),r=r||{},n=n||function(){},o=o||e.errors.handleError,i=i||function(){},"string"==typeof t)e.util.isFPUrl(t)?e.files.readFromFPUrl(t,r,n,o,i):e.files.readFromUrl(t,r,n,o,i);else if(e.util.isFileInputElement(t))t.files?0===t.files.length?o(new e.errors.FPError(115)):e.files.readFromFile(t.files[0],r,n,o,i):l(t,r,n,o,i);else if(e.util.isFile(t))e.files.readFromFile(t,r,n,o,i);else{if(!t.url)throw new e.FilepickerException("Cannot read given input: "+t+". Not a url, file input, DOM File, or FPFile object.");e.files.readFromFPUrl(t.url,r,n,o,i)}},l=function(t,r,n,o,i){i(10),e.store(t,function(t){i(50),e.read(t,r,n,o,function(e){i(50+e/2)})},o)},u=function(t,r,n,o,i,a){if(e.util.checkApiKey(),!t)throw new e.FilepickerException("No fpfile given - nothing to write to!");if(void 0===r||null===r)throw new e.FilepickerException("No input given - nothing to write!");"function"==typeof n&&(a=i,i=o,o=n,n={}),n=n||{},o=o||function(){},i=i||e.errors.handleError,a=a||function(){};var s;if(e.util.isFPUrl(e.util.getFPUrl(t)))s=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to write to: "+t+". Not a filepicker url or FPFile object.");s=t.url}if(s=e.util.trimConvert(e.util.getFPUrl(s)),"string"==typeof r)e.files.writeDataToFPUrl(s,r,n,o,i,a);else if(e.util.isFileInputElement(r))r.files?0===r.files.length?i(new e.errors.FPError(115)):e.files.writeFileToFPUrl(s,r.files[0],n,o,i,a):e.files.writeFileInputToFPUrl(s,r,n,o,i,a);else if(e.util.isFile(r))e.files.writeFileToFPUrl(s,r,n,o,i,a);else{if(!r.url)throw new e.FilepickerException("Cannot read from given input: "+r+". Not a string, file input, DOM File, or FPFile object.");e.files.writeUrlToFPUrl(s,r.url,n,o,i,a)}},d=function(t,r,n,o,i,a){if(e.util.checkApiKey(),!t)throw new e.FilepickerException("No fpfile given - nothing to write to!");if(void 0===r||null===r)throw new e.FilepickerException("No input given - nothing to write!");"function"==typeof n&&(a=i,i=o,o=n,n={}),n=n||{},o=o||function(){},i=i||e.errors.handleError,a=a||function(){};var s;if(e.util.isFPUrl(e.util.getFPUrl(t)))s=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to write to: "+t+". Not a filepicker url or FPFile object.");s=t.url}s=e.util.getFPUrl(s),e.files.writeUrlToFPUrl(e.util.trimConvert(s),r,n,o,i,a)},p=function(t,r,n,o){e.util.checkApiKey(),"function"==typeof r&&(o=n,n=r,r={}),r=r?e.util.clone(r):{},n=n||function(){},o=o||e.errors.handleError;var i;if("string"==typeof t&&e.util.isUrl(t))i=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to export: "+t+". Not a valid url or FPFile object. You may want to use filepicker.store() to get an FPFile to export");i=t.url,r.mimetype||r.extension||(r.mimetype=t.mimetype),r.suggestedFilename||(r.suggestedFilename=t.filename)}return r.suggestedFilename&&(r.suggestedFilename=encodeURI(r.suggestedFilename)),e.exporter.createExporter(i,r,n,o)},f=function(t,r,n,o,i){var a;if(e.util.checkApiKey(),"function"==typeof r&&(o=n,n=r,r={}),r=r||{},n=n||function(){},o=o||e.errors.handleError,"string"==typeof t)a=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to convert: "+t+". Not a valid url or FPFile object or not filepicker url. You can convert only filepicker url images.");a=t.url,r.filename||(r.filename=t.filename)}return r.convertUrl=a,r.multiple=!1,r.services=["CONVERT","COMPUTER"],r.backgroundUpload=!0,r.hide=!1,e.picker.createPicker(r,n,o,!1,!1,i,!0)},m=function(t,r,n,o,i){if(e.util.checkApiKey(),"function"==typeof r&&(i=o,o=n,n=r,r={}),r=r?e.util.clone(r):{},n=n||function(){},o=o||e.errors.handleError,i=i||function(){},"string"==typeof t)e.files.storeData(t,r,n,o,i);else if(e.util.isFileInputElement(t))t.files?0===t.files.length?o(new e.errors.FPError(115)):e.files.storeFile(t.files[0],r,n,o,i):e.files.storeFileInput(t,r,n,o,i);else if(e.util.isFile(t))e.files.storeFile(t,r,n,o,i);else{if(!t.url)throw new e.FilepickerException("Cannot store given input: "+t+". Not a string, file input, DOM File, or FPFile object.");r.filename||(r.filename=t.filename),e.files.storeUrl(t.url,r,n,o,i)}},h=function(t,r,n,o,i){e.util.checkApiKey(),"function"==typeof r&&(i=o,o=n,n=r,r={}),r=r||{},n=n||function(){},o=o||e.errors.handleError,i=i||function(){},e.files.storeUrl(t,r,n,o,i)},g=function(t,r,n,o){e.util.checkApiKey(),"function"==typeof r&&(o=n,n=r,r={}),r=r||{},n=n||function(){},o=o||e.errors.handleError;var i;if(e.util.isFPUrl(e.util.getFPUrl(t)))i=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to get metadata for: "+t+". Not a filepicker url or FPFile object.");i=t.url}i=e.util.getFPUrl(i),e.files.stat(e.util.trimConvert(i),r,n,o)},v=function(t,r,n,o){e.util.checkApiKey(),"function"==typeof r&&(o=n,n=r,r={}),r=r||{},n=n||function(){},o=o||e.errors.handleError;var i;if(e.util.isFPUrl(e.util.getFPUrl(t)))i=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to remove: "+t+". Not a filepicker url or FPFile object.");i=t.url}i=e.util.getFPUrl(i),e.files.remove(e.util.trimConvert(i),r,n,o)},w=function(t,r,n,o,i,a){if(e.util.checkApiKey(),!t)throw new e.FilepickerException("No fpfile given - nothing to convert!");"function"==typeof n&&(a=i,i=o,o=n,n={});var s=r?e.util.clone(r):{};n=n||{},o=o||function(){},i=i||e.errors.handleError,a=a||function(){},n.location&&(s.storeLocation=n.location),n.path&&(s.storePath=n.path),
n.container&&(s.storeContainer=n.container),s.storeAccess=n.access||"private";var c;if(e.util.isFPUrl(e.util.getFPUrl(t)))c=t;else{if(!t.url)throw new e.FilepickerException("Invalid file to convert: "+t+". Not a filepicker url or FPFile object.");if(c=t.url,!e.mimetypes.matchesMimetype(t.mimetype,"image/*")&&!e.mimetypes.matchesMimetype(t.mimetype,"application/pdf"))return void i(new e.errors.FPError(142))}if(c=e.util.getFPUrl(c),c.indexOf("/convert")>-1){var l=e.util.parseUrl(c).params;l=e.conversions.mapRestParams(l),l.crop&&e.util.setDefault(l,"crop_first",!0);for(var u in l)e.util.setDefault(s,u,l[u])}e.conversions.convert(e.util.trimConvert(c),s,o,i,a)},y=function(t){return e.widgets.constructWidget(t)},b=function(t,r){return e.dragdrop.makeDropPane(t,r)},x=function(t){return e.responsiveImages.setResponsiveOptions(t)},E=function(){e.responsiveImages.update.apply(null,arguments)};return{setKey:r,setResponsiveOptions:x,pick:o,pickFolder:s,pickMultiple:i,pickAndStore:a,read:c,write:u,writeUrl:d,"export":p,exportFile:p,processImage:f,store:m,storeUrl:h,stat:g,metadata:g,remove:v,convert:w,constructWidget:y,makeDropPane:b,FilepickerException:n,responsive:E,version:t}},!0),filepicker.extend("mimetypes",function(){var e=this,t={".stl":"application/sla",".hbs":"text/html",".pdf":"application/pdf",".jpg":"image/jpeg",".jpeg":"image/jpeg",".jpe":"image/jpeg",".imp":"application/x-impressionist",".vob":"video/dvd"},r=["application/octet-stream","application/download","application/force-download","octet/stream","application/unknown","application/x-download","application/x-msdownload","application/x-secure-download"],n=function(e){if(e.type){var n=e.type;n=n.toLowerCase();for(var o=!1,i=0;i<r.length;i++)o=o||n===r[i];if(!o)return e.type}var a=e.name||e.fileName,s=a.match(/\.\w*$/);return s?t[s[0].toLowerCase()]||"":e.type?e.type:""},o=function(t,n){if(!t)return"*/*"===n;t=e.util.trim(t).toLowerCase(),n=e.util.trim(n).toLowerCase();for(var o=0;o<r.length;o++)if(t===r[o])return!0;var i=t.split("/"),a=n.split("/");return"*"===a[0]?!0:a[0]!==i[0]?!1:"*"===a[1]?!0:a[1]===i[1]};return{getMimetype:n,matchesMimetype:o}}),filepicker.extend("services",function(){return{COMPUTER:1,DROPBOX:2,FACEBOOK:3,GITHUB:4,GMAIL:5,IMAGE_SEARCH:6,URL:7,WEBCAM:8,GOOGLE_DRIVE:9,SEND_EMAIL:10,INSTAGRAM:11,FLICKR:12,VIDEO:13,EVERNOTE:14,PICASA:15,WEBDAV:16,FTP:17,ALFRESCO:18,BOX:19,SKYDRIVE:20,GDRIVE:21,CUSTOMSOURCE:22,CLOUDDRIVE:23,GENERIC:24,CONVERT:25,AUDIO:26}},!0),filepicker.extend("urls",function(){function e(e,n){return"?key="+o.apikey+"&id="+n+"&referrer="+window.location.hostname+"&iframe="+("window"!==e.container)+"&version="+o.API_VERSION+(e.services?"&s="+e.services.join(","):"")+(void 0!==e.container?"&container="+e.container:"modal")+(e.openTo?"&loc="+e.openTo:"")+"&language="+(e.language||o.browser.getLanguage())+(void 0!==e.mobile?"&mobile="+e.mobile:"")+(void 0!==e.backgroundUpload?"&bu="+e.backgroundUpload:"")+(e.cropRatio?"&cratio="+e.cropRatio:"")+(e.cropDim?"&cdim="+e.cropDim.join(","):"")+(e.cropMax?"&cmax="+e.cropMax.join(","):"")+(e.cropMin?"&cmin="+e.cropMin.join(","):"")+(void 0!==e.cropForce?"&cforce="+e.cropForce:"")+(void 0!==e.hide?"&hide="+e.hide:"")+(e.customCss?"&css="+encodeURIComponent(e.customCss):"")+(e.customText?"&text="+encodeURIComponent(e.customText):"")+(e.imageMin?"&imin="+e.imageMin.join(","):"")+(e.imageMax?"&imax="+e.imageMax.join(","):"")+(e.imageDim?"&idim="+e.imageDim.join(","):"")+(e.imageQuality?"&iq="+e.imageQuality:"")+(e.noFileReader?"&nfl="+e.noFileReader:"")+(o.util.isCanvasSupported()?"":"&canvas=false")+(e.redirectUrl?"&redirect_url="+e.redirectUrl:"")+(e.showClose&&"modal"!==e.container?"&showClose="+e.showClose:"")+t(e)+"&plugin="+r()}function t(e){return(e.signature?"&signature="+e.signature:"")+(e.policy?"&policy="+e.policy:"")}function r(){return filepicker.plugin||"js_lib"}function n(e){e=e||[];var t,r,n=[];for(t in e)for(r in p)e[t]===p[r]&&e.hasOwnProperty(t)&&n.push(e[t]);return n.length||n.push("crop"),"&co="+n.join(",")}var o=this,i="https://www.filepicker.io";window.filepicker.hostname&&(i=window.filepicker.hostname);var a=i.replace("www","dialog"),s=a+"/dialog/open/",c=a+"/dialog/save/",l=a+"/dialog/process/",u=a+"/dialog/folder/",d=i+"/api/store/",p=["crop","rotate","filter"],f=function(t,r,o){return s+e(t,r)+(o?"&multi="+!!o:"")+(void 0!==t.mimetypes?"&m="+t.mimetypes.join(","):"")+(void 0!==t.extensions?"&ext="+t.extensions.join(","):"")+(t.maxSize?"&maxSize="+t.maxSize:"")+(t.customSourceContainer?"&customSourceContainer="+t.customSourceContainer:"")+(t.customSourcePath?"&customSourcePath="+t.customSourcePath:"")+(t.maxFiles?"&maxFiles="+t.maxFiles:"")+(void 0!==t.folders?"&folders="+t.folders:"")+(t.storeLocation?"&storeLocation="+t.storeLocation:"")+(t.storePath?"&storePath="+t.storePath:"")+(t.storeContainer?"&storeContainer="+t.storeContainer:"")+(t.storeRegion?"&storeRegion="+t.storeRegion:"")+(t.storeAccess?"&storeAccess="+t.storeAccess:"")+(t.webcam&&t.webcam.webcamDim?"&wdim="+t.webcam.webcamDim.join(","):"")+(t.webcamDim?"&wdim="+t.webcamDim.join(","):"")+(t.webcam&&t.webcam.videoRes?"&videoRes="+t.webcam.videoRes:"")+(t.webcam&&t.webcam.videoLen?"&videoLen="+t.webcam.videoLen:"")+(t.webcam&&t.webcam.audioLen?"&audioLen="+t.webcam.audioLen:"")+n(t.conversions)},m=function(t,r){var o=t.convertUrl;return(o.indexOf("&")>=0||o.indexOf("?")>=0)&&(o=encodeURIComponent(o)),l+e(t,r)+"&curl="+o+n(t.conversions)},h=function(t,r){return u+e(t,r)},g=function(t,r,n){return(t.indexOf("&")>=0||t.indexOf("?")>=0)&&(t=encodeURIComponent(t)),c+e(r,n)+"&url="+t+(void 0!==r.mimetype?"&m="+r.mimetype:"")+(void 0!==r.extension?"&ext="+r.extension:"")+(r.suggestedFilename?"&defaultSaveasName="+r.suggestedFilename:"")},v=function(e){return d+e.location+"?key="+o.apikey+(e.base64decode?"&base64decode=true":"")+(e.mimetype?"&mimetype="+e.mimetype:"")+(e.filename?"&filename="+encodeURIComponent(e.filename):"")+(e.path?"&path="+e.path:"")+(e.container?"&container="+e.container:"")+(e.access?"&access="+e.access:"")+t(e)+"&plugin="+r()},w=function(e,n){return e+"?nonce=fp"+(n.base64decode?"&base64decode=true":"")+(n.mimetype?"&mimetype="+n.mimetype:"")+t(n)+"&plugin="+r()},y=function(){var e=o.util.parseUrl(window.location.href);return e.origin+"/404"};return{BASE:i,DIALOG_BASE:a,API_COMM:i+"/dialog/comm_iframe/",COMM:a+"/dialog/comm_iframe/",FP_COMM_FALLBACK:a+"/dialog/comm_hash_iframe/",STORE:d,PICK:s,EXPORT:c,constructPickUrl:f,constructConvertUrl:m,constructPickFolderUrl:h,constructExportUrl:g,constructWriteUrl:w,constructStoreUrl:v,constructHostCommFallback:y,getPlugin:r}}),filepicker.extend("ajax",function(){var e=this,t=function(e,t){t.method="GET",i(e,t)},r=function(t,r){r.method="POST",t+=(t.indexOf("?")>=0?"&":"?")+"_cacheBust="+e.util.getId(),i(t,r)},n=function(t,r){var o=[];for(var i in t){var a=t[i];r&&(i=r+". + key + ");var s;switch(e.util.typeOf(a)){case"object":s=n(a,i);break;case"array":for(var c={},l=0;l<a.length;l++)c[l]=a[l];s=n(c,i);break;default:s=i+"="+encodeURIComponent(a)}null!==a&&o.push(s)}return o.join("&")},o=function(){try{return new window.XMLHttpRequest}catch(e){try{return new window.ActiveXObject("Msxml2.XMLHTTP")}catch(e){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(e){return null}}}},i=function(t,r){t=t||"";var i=r.method?r.method.toUpperCase():"POST",s=r.success||function(){},c=r.error||function(){},l=void 0===r.async?!0:r.async,u=r.data||null,d=void 0===r.processData?!0:r.processData,p=r.headers||{},f=e.util.parseUrl(t),m=window.location.protocol+"//"+window.location.host,h=m!==f.origin,g=!1;t+=(t.indexOf("?")>=0?"&":"?")+"plugin="+e.urls.getPlugin(),u&&d&&(u=n(r.data));var v;if(r.xhr)v=r.xhr;else if(v=o(),!v)return r.error("Ajax not allowed"),v;if(h&&window.XDomainRequest&&!("withCredentials"in v))return new a(t,r);r.progress&&v.upload&&v.upload.addEventListener("progress",function(e){e.lengthComputable&&r.progress(Math.round(95*e.loaded/e.total))},!1);var w=function(){if(4==v.readyState&&!g)if(r.progress&&r.progress(100),v.status>=200&&v.status<300){var t=v.responseText;if(r.json)try{t=e.json.decode(t)}catch(n){return void y.call(v,"Invalid json: "+t)}s(t,v.status,v),g=!0}else y.call(v,v.responseText),g=!0};v.onreadystatechange=w;var y=function(e){return g?void 0:(r.progress&&r.progress(100),g=!0,400==this.status?void c("bad_params",this.status,this):403==this.status?void c("not_authorized",this.status,this):404==this.status?void c("not_found",this.status,this):h?4==this.readyState&&0===this.status?void c("CORS_not_allowed",this.status,this):void c("CORS_error",this.status,this):void c(e,this.status,this))};v.onerror=y,u&&"GET"==i&&(t+=(-1!==t.indexOf("?")?"&":"?")+u,u=null),v.open(i,t,l),r.json?v.setRequestHeader("Accept","application/json, text/javascript"):v.setRequestHeader("Accept","text/javascript, text/html, application/xml, text/xml, */*");var b=p["Content-Type"]||p["content-type"];if(u&&d&&("POST"==i||"PUT"==i)&&void 0===b&&v.setRequestHeader("Content-Type","application/x-www-form-urlencoded; charset=utf-8"),p)for(var x in p)v.setRequestHeader(x,p[x]);return v.send(u),v},a=function(t,r){if(!window.XDomainRequest)return null;var o=r.method?r.method.toUpperCase():"POST",i=r.success||function(){},a=r.error||function(){},s=r.data||{};if("http:"==window.location.protocol?t=t.replace("https:","http:"):"https:"==window.location.protocol&&(t=t.replace("http:","https:")),r.async)throw new e.FilepickerException("Asyncronous Cross-domain requests are not supported");"GET"!==o&&"POST"!==o&&(s._method=o,o="POST"),r.processData!==!1&&(s=s?n(s):null),s&&"GET"==o&&(t+=(t.indexOf("?")>=0?"&":"?")+s,s=null),t+=(t.indexOf("?")>=0?"&":"?")+"_xdr=true&_cacheBust="+e.util.getId();var c=new window.XDomainRequest;return c.onload=function(){var t=c.responseText;if(r.progress&&r.progress(100),r.json)try{t=e.json.decode(t)}catch(n){return void a("Invalid json: "+t,200,c)}i(t,200,c)},c.onerror=function(){r.progress&&r.progress(100),a(c.responseText||"CORS_error",this.status||500,this)},c.onprogress=function(){},c.ontimeout=function(){},c.timeout=3e4,c.open(o,t,!0),c.send(s),c};return{get:t,post:r,request:i}}),filepicker.extend("files",function(){var e=this,t=function(t,n,o,i,a){var s=void 0===n.base64encode;s&&(n.base64encode=!0),n.base64encode=n.base64encode!==!1;var c=function(t){s&&(t=e.base64.decode(t,!!n.asText)),o(t)};r.call(this,t,n,c,i,a)},r=function(t,r,n,o,i){r.cache!==!0&&(r._cacheBust=e.util.getId()),e.ajax.get(t,{data:r,headers:{"X-NO-STREAM":!0},success:n,error:function(t,r,n){o("CORS_not_allowed"===t?new e.errors.FPError(113):"CORS_error"===t?new e.errors.FPError(114):"not_found"===t?new e.errors.FPError(115):"bad_params"===t?new e.errors.FPError(400):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(118))},progress:i})},n=function(t,r,n,o,i){if(!(window.File&&window.FileReader&&window.FileList&&window.Blob))return i(10),void e.files.storeFile(t,{},function(t){i(50),e.files.readFromFPUrl(t.url,r,n,o,function(e){i(50+e/2)})},o,function(e){i(e/2)});var a=!!r.base64encode,s=!!r.asText,c=new FileReader;c.onprogress=function(e){e.lengthComputable&&i(Math.round(e.loaded/e.total*100))},c.onload=function(t){i(100),n(a?e.base64.encode(t.target.result,s):t.target.result)},c.onerror=function(t){switch(t.target.error.code){case t.target.error.NOT_FOUND_ERR:o(new e.errors.FPError(115));break;case t.target.error.NOT_READABLE_ERR:o(new e.errors.FPError(116));break;case t.target.error.ABORT_ERR:o(new e.errors.FPError(117));break;default:o(new e.errors.FPError(118))}},s||!c.readAsBinaryString?c.readAsText(t):c.readAsBinaryString(t)},o=function(t,r,n,o,i,a){var s=n.mimetype||"text/plain";e.ajax.post(e.urls.constructWriteUrl(t,n),{headers:{"Content-Type":s},data:r,processData:!1,json:!0,success:function(t){o(e.util.standardizeFPFile(t))},error:function(t,r,n){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},progress:a})},i=function(t,r,n,o,i,a){var s=function(t,r,n){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},c=function(t){o(e.util.standardizeFPFile(t))};u(r,e.urls.constructWriteUrl(t,n),c,s,a)},a=function(t,r,n,o,i,a){var s=function(t,r,n){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},c=function(t){o(e.util.standardizeFPFile(t))};n.mimetype=r.type,u(r,e.urls.constructWriteUrl(t,n),c,s,a)},s=function(t,r,n,o,i,a){e.ajax.post(e.urls.constructWriteUrl(t,n),{data:{url:r},json:!0,success:function(t){o(e.util.standardizeFPFile(t))},error:function(t,r,n){i("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},progress:a})},c=function(t,r,n,o,i){if(t.files)return void(0===t.files.length?o(new e.errors.FPError(115)):l(t.files[0],r,n,o,i));e.util.setDefault(r,"location","S3"),r.filename||(r.filename=t.value.replace("C:\\fakepath\\","")||t.name);var a=t.name;t.name="fileUpload",e.iframeAjax.post(e.urls.constructStoreUrl(r),{data:t,processData:!1,json:!0,success:function(r){t.name=a,n(e.util.standardizeFPFile(r))},error:function(t,r,n){o("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))}})},l=function(t,r,n,o,i){e.util.setDefault(r,"location","S3");var a=function(t,r,n){"not_found"===t?o(new e.errors.FPError(121)):"bad_params"===t?o(new e.errors.FPError(122)):"not_authorized"===t?o(new e.errors.FPError(403)):(e.util.console.error(t),o(new e.errors.FPError(123)))},s=function(t){n(e.util.standardizeFPFile(t))};r.filename||(r.filename=t.name||t.fileName),u(t,e.urls.constructStoreUrl(r),s,a,i)},u=function(t,r,n,o,i){t.files&&(t=t.files[0]);var a=!!window.FormData&&!!window.XMLHttpRequest;if(a){var s=new window.FormData;s.append("fileUpload",t),e.ajax.post(r,{json:!0,processData:!1,data:s,success:n,error:o,progress:i})}else e.iframeAjax.post(r,{data:t,json:!0,success:n,error:o})},d=function(t,r,n,o,i){e.util.setDefault(r,"location","S3"),e.util.setDefault(r,"mimetype","text/plain"),e.ajax.post(e.urls.constructStoreUrl(r),{headers:{"Content-Type":r.mimetype},data:t,processData:!1,json:!0,success:function(t){n(e.util.standardizeFPFile(t))},error:function(t,r,n){o("not_found"===t?new e.errors.FPError(121):"bad_params"===t?new e.errors.FPError(122):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(123))},progress:i})},p=function(t,r,n,o,i){e.util.setDefault(r,"location","S3"),e.ajax.post(e.urls.constructStoreUrl(r),{data:{url:e.util.getFPUrl(t)},json:!0,success:function(t){n(e.util.standardizeFPFile(t))},error:function(t,r,n){o("not_found"===t?new e.errors.FPError(151):"bad_params"===t?new e.errors.FPError(152):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(153))},progress:i})},f=function(t,r,n,o){var i=["uploaded","modified","created"];r.cache!==!0&&(r._cacheBust=e.util.getId()),e.ajax.get(t+"/metadata",{json:!0,data:r,success:function(e){for(var t=0;t<i.length;t++)e[i[t]]&&(e[i[t]]=new Date(e[i[t]]));n(e)},error:function(t,r,n){o("not_found"===t?new e.errors.FPError(161):"bad_params"===t?new e.errors.FPError(400):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(162))}})},m=function(t,r,n,o){r.key=e.apikey,e.ajax.post(t+"/remove",{data:r,success:function(e){n()},error:function(t,r,n){o("not_found"===t?new e.errors.FPError(171):"bad_params"===t?new e.errors.FPError(400):"not_authorized"===t?new e.errors.FPError(403):new e.errors.FPError(172))}})};return{readFromUrl:r,readFromFile:n,readFromFPUrl:t,writeDataToFPUrl:o,writeFileToFPUrl:a,writeFileInputToFPUrl:i,writeUrlToFPUrl:s,storeFileInput:c,storeFile:l,storeUrl:p,storeData:d,stat:f,remove:m}}),filepicker.extend("iframeAjax",function(){var e=this,t="ajax_iframe",r=[],n=!1,o=function(e,t){t.method="GET",s(e,t)},i=function(t,r){r.method="POST",t+=(t.indexOf("?")>=0?"&":"?")+"_cacheBust="+e.util.getId(),s(t,r)},a=function(){if(r.length>0){var e=r.shift();s(e.url,e.options)}},s=function(o,i){if(n)return void r.push({url:o,options:i});o+=(o.indexOf("?")>=0?"&":"?")+"plugin="+e.urls.getPlugin()+"&_cacheBust="+e.util.getId(),o+="&Content-Type=text%2Fhtml",e.comm.openChannel();var a;try{a=document.createElement('<iframe name="'+t+'">')}catch(s){a=document.createElement("iframe")}a.id=a.name=t,a.style.display="none";var u=function(){n=!1};a.attachEvent?(a.attachEvent("onload",u),a.attachEvent("onerror",u)):a.onerror=a.onload=u,a.id=t,a.name=t,a.style.display="none",a.onerror=a.onload=function(){n=!1},document.body.appendChild(a),e.handlers.attach("upload",c(i));var d=document.createElement("form");d.method=i.method||"GET",d.action=o,d.target=t;var p=i.data;(e.util.isFileInputElement(p)||e.util.isFile(p))&&(d.encoding=d.enctype="multipart/form-data"),document.body.appendChild(d);var f;if(e.util.isFile(p)){var m=l(p);if(!m)throw e.FilepickerException("Couldn't find corresponding file input.");p={fileUpload:m}}else e.util.isFileInputElement(p)?(f=p,p={},p.fileUpload=f):p&&e.util.isElement(p)&&"INPUT"===p.tagName?(f=p,p={},p[f.name]=f):i.processData!==!1&&(p={data:p});p.format="iframe";var h={};for(var g in p){var v=p[g];if(e.util.isElement(v)&&"INPUT"===v.tagName)h[g]={par:v.parentNode,sib:v.nextSibling,name:v.name,input:v,focused:v===document.activeElement},v.name=g,d.appendChild(v);else{var w=document.createElement("input");w.name=g,w.value=v,d.appendChild(w)}}n=!0,window.setTimeout(function(){d.submit();for(var e in h){var t=h[e];t.par.insertBefore(t.input,t.sib),t.input.name=t.name,t.focused&&t.input.focus()}d.parentNode.removeChild(d)},1)},c=function(t){var r=t.success||function(){},o=t.error||function(){},i=function(t){if("Upload"===t.type){n=!1;var i=t.payload;i.error?o(i.error):r(i),e.handlers.detach("upload"),a()}};return i},l=function(e){for(var t=document.getElementsByTagName("input"),r=0;r<t.length;r++){var n=t[0];if("file"===n.type&&n.files&&n.files.length)for(var o=0;o<n.files.length;o++)if(n.files[o]===e)return n}return null};return{get:o,post:i,request:s}}),filepicker.extend("base64",function(){var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",t=function(t,r){r=r||void 0===r;var o,i,a,s,c,l,u,d="",p=0;for(r&&(t=n(t));p<t.length;)o=t.charCodeAt(p),i=t.charCodeAt(p+1),a=t.charCodeAt(p+2),p+=3,s=o>>2,c=(3&o)<<4|i>>4,l=(15&i)<<2|a>>6,u=63&a,isNaN(i)?l=u=64:isNaN(a)&&(u=64),d=d+e.charAt(s)+e.charAt(c)+e.charAt(l)+e.charAt(u);return d},r=function(t,r){r=r||void 0===r;var n,i,a,s,c,l,u,d="",p=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");p<t.length;)s=e.indexOf(t.charAt(p)),c=e.indexOf(t.charAt(p+1)),l=e.indexOf(t.charAt(p+2)),u=e.indexOf(t.charAt(p+3)),p+=4,n=s<<2|c>>4,i=(15&c)<<4|l>>2,a=(3&l)<<6|u,d+=String.fromCharCode(n),64!=l&&(d+=String.fromCharCode(i)),64!=u&&(d+=String.fromCharCode(a));return r&&(d=o(d)),d},n=function(e){e=e.replace(/\r\n/g,"\n");for(var t="",r=0;r<e.length;r++){var n=e.charCodeAt(r);128>n?t+=String.fromCharCode(n):n>127&&2048>n?(t+=String.fromCharCode(n>>6|192),t+=String.fromCharCode(63&n|128)):(t+=String.fromCharCode(n>>12|224),t+=String.fromCharCode(n>>6&63|128),t+=String.fromCharCode(63&n|128))}return t},o=function(e){for(var t="",r=0,n=0,o=0;r<e.length;)n=e.charCodeAt(r),128>n?(t+=String.fromCharCode(n),r++):n>191&&224>n?(o=e.charCodeAt(r+1),t+=String.fromCharCode((31&n)<<6|63&o),r+=2):(o=e.charCodeAt(r+1),c3=e.charCodeAt(r+2),t+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&c3),r+=3);return t};return{encode:t,decode:r}},!0),filepicker.extend("browser",function(){var e=function(){return!!(navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/iPad/i))},t=function(){return!!navigator.userAgent.match(/Android/i)},r=function(){var e=window.navigator.userLanguage||window.navigator.language;return void 0===e&&(e="en"),e=e.replace("-","_").toLowerCase()};return{getLanguage:r,openInModal:function(){return!(e()||t())||!!window.navigator.standalone},isMobile:function(){return e()||t()}}}),filepicker.extend("conversionsUtil",function(){var e=this,t=e.urls.BASE.replace("www","process")+"/",r=function(e){if(!e)return{url:null,optionsDict:{}};e=e.replace(t,"");var r=e.substring(e.indexOf("/http")+1);e=e.replace("/"+r,"");var n=e.substring(0,e.indexOf("/"));e=e.replace(n+"/","");var o,i,a,s,c,l=e.split("/"),u={};for(s in l)if(o=l[s].split("="),o.length>1){u[o[0]]={},i=o[1].split(",");for(c in i)a=i[c].split(":"),a.length>1&&(u[o[0]][a[0]]=a[1])}else l[s]&&(u[l[s]]=null);return{url:r,apikey:n,optionsDict:u}},n=function(r,n,o){var i,a,s,c=t+o;n=n||{};for(i in n){c+="/"+i,s=e.util.objectKeys(n[i]||{}).length,s&&(c+="=");for(a in n[i])c+=a+":"+n[i][a],0!==--s&&(c+=",")}return c+="/"+r};return{CONVERSION_DOMAIN:t,parseUrl:r,buildUrl:n}}),filepicker.extend("json",function(){var fp=this,special={"\b":"\\b","	":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},escape=function(e){return special[e]||"\\u"+("0000"+e.charCodeAt(0).toString(16)).slice(-4)},validate=function(e){return e=e.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""),/^[\],:{}\s]*$/.test(e)},encode=function(e){if(window.JSON&&window.JSON.stringify)return window.JSON.stringify(e);e&&e.toJSON&&(e=e.toJSON());var t=[];switch(fp.util.typeOf(e)){case"string":return'"'+e.replace(/[\x00-\x1f\\"]/g,escape)+'"';case"array":for(var r=0;r<e.length;r++)t.push(encode(e[r]));return"["+t+"]";case"object":case"hash":var n,o;for(o in e)n=encode(e[o]),n&&t.push(encode(o)+":"+n),n=null;return"{"+t+"}";case"number":case"boolean":return""+e;case"null":return"null";default:return"null"}return null},decode=function(string,secure){if(!string||"string"!==fp.util.typeOf(string))return null;if(window.JSON&&window.JSON.parse)return window.JSON.parse(string);if(secure&&!validate(string))throw new Error("JSON could not decode the input; security is enabled and the value is not secure.");return eval("("+string+")")};return{validate:validate,encode:encode,stringify:encode,decode:decode,parse:decode}}),filepicker.extend("util",function(){var e=function(e){return e.replace(/^\s+|\s+$/g,"")},t=function(e){return e.replace(/\/convert\b.*/,"")},r=/^(http|https)\:.*\/\//i,n=function(e){return!!e.match(r)},o=function(e){e&&"/"!==e.charAt(0)||(e=window.location.protocol+"//"+window.location.host+e);var t=document.createElement("a");t.href=e;var r=-1===t.hostname.indexOf(":")?t.hostname:t.host,n={source:e,protocol:t.protocol.replace(":",""),host:r,port:t.port,query:t.search,params:function(){for(var e,r={},n=t.search.replace(/^\?/,"").split("&"),o=n.length,i=0;o>i;i++)n[i]&&(e=n[i].split("="),r[e[0]]=e[1]);return r}(),file:(t.pathname.match(/\/([^\/?#]+)$/i)||[void 0,""])[1],hash:t.hash.replace("#",""),path:t.pathname.replace(/^([^\/])/,"/$1"),relative:(t.href.match(/tps?:\/\/[^\/]+(.+)/)||[void 0,""])[1],segments:t.pathname.replace(/^\//,"").split("/")};return n.origin=n.protocol+"://"+n.host+(n.port?":"+n.port:""),n.rawUrl=(n.origin+n.path).replace("/convert",""),n},i=function(e,t){return-1!==e.indexOf(t,e.length-t.length)},a=function(e,t,r){return e+(e.indexOf("?")>=0?"&":"?")+t+"="+r};return{trim:e,trimConvert:t,parseUrl:o,isUrl:n,endsWith:i,appendQueryToUrl:a}}),filepicker.extend("util",function(){var e=this,t=function(e){return e&&"[object Array]"===Object.prototype.toString.call(e)},r=function(e){return e&&"[object File]"===Object.prototype.toString.call(e)},n=function(e){return"object"==typeof window.HTMLElement?e instanceof window.HTMLElement:e&&"object"==typeof e&&1===e.nodeType&&"string"==typeof e.nodeName},o=function(e){return n(e)&&"INPUT"===e.tagName&&"file"===e.type},i=function(e){return null===e?"null":t(e)?"array":r(e)?"file":typeof e},a=function(){var e=new Date;return e.getTime().toString()},s=function(e,t,r){void 0===e[t]&&(e[t]=r)},c=function(e){if(window.jQuery)window.jQuery(function(){e()});else{var t="load";if(window.addEventListener)window.addEventListener(t,e,!1);else if(window.attachEvent)window.attachEvent("on"+t,e);else if(window.onload){var r=window.onload;window.onload=function(){r(),e()}}else window.onload=e}},l=function(t){return"string"==typeof t&&t.match(e.urls.BASE+"/api/file/")},u=function(e){return"string"==typeof e&&e.match("/api/file/")},d=function(t){if("string"==typeof t){var r=t.match(/cdn.filestackcontent.[\S]*\/([\S]{20,})/);if(r&&r.length>1)return e.urls.BASE+"/api/file/"+r[1]}return t},p=function(e){return function(){if(window.console&&"function"==typeof window.console[e])try{window.console[e].apply(window.console,arguments)}catch(t){window.alert(Array.prototype.join.call(arguments,","))}}},f={};f.log=p("log"),f.error=p("error");var m=function(e){var t={};for(var r in e)t[r]=e[r];return t},h=function(e){var t={};return t.url=e.url,t.filename=e.filename||e.name,t.mimetype=e.mimetype||e.type,t.size=e.size,t.key=e.key||e.s3_key,t.isWriteable=!(!e.isWriteable&&!e.writeable),t},g=function(){try{var e=document.createElement("canvas");return!(!e.getContext||!e.getContext("2d"))}catch(t){return!1}},v=function(e,t){for(var r in e)e.hasOwnProperty(r)&&(t[r]=e[r]);return t},w=function(){if(!e.apikey)throw new e.FilepickerException("API Key not found")},y=function(e){return"function"!=typeof Object.keys?function(e){var t=[];for(var r in e)e.hasOwnProperty(r)&&t.push(r);return t}:Object.keys(e)};return{isArray:t,isFile:r,isElement:n,isFileInputElement:o,getId:a,setDefault:s,typeOf:i,addOnLoad:c,isFPUrl:l,getFPUrl:d,isFPUrlCdn:u,console:f,clone:m,standardizeFPFile:h,isCanvasSupported:g,extend:v,checkApiKey:w,objectKeys:y}}),filepicker.extend("windowUtils",function(){function e(){return document.documentElement.clientWidth||document.body&&document.body.clientWidth||1024}function t(){return document.documentElement.clientHeight||document.body&&document.body.clientHeight||768}return{getWidth:e,getHeight:t}}),filepicker.extend("dragdrop",function(){var e=this,t=function(){return(!!window.FileReader||navigator.userAgent.indexOf("Safari")>=0)&&"draggable"in document.createElement("span")},r=function(r,n){function o(t){var r=E(0,1),n=e.util.clone(t);n.name=n.filename,P([n])?r(t):e.files.remove(t.url,v,function(){},function(){})}function i(t){var n,o=t.length;if(P(t))for(d(t),r.setAttribute("disabled","disabled"),n=0;n<t.length;n++)e.store(t[n],v,E(n,o),A,F(n,o))}function a(t){var r=F(0,1);e.storeUrl(t,o,A,r)}function s(e){var t,r,n;if(e.dataTransfer.items)for(r=e.dataTransfer.items,n=0;n<r.length;n++)if(t=r[n]&&r[n].webkitGetAsEntry?r[n].webkitGetAsEntry():void 0,t&&t.isDirectory)return f("WrongType","Uploading a folder is not allowed"),!0;return!1}var c="No DOM element found to create drop pane";if(!r)throw new e.FilepickerException(c);if(r.jquery){if(0===r.length)throw new e.FilepickerException(c);r=r[0]}if(!t())return e.util.console.error("Your browser doesn't support drag-drop functionality"),!1;n=n||{};var l=n.dragEnter||function(){},u=n.dragLeave||function(){},d=n.onStart||function(){},p=n.onSuccess||function(){},f=n.onError||function(){},m=n.onProgress||function(){},h=n.mimetypes;h||(h=n.mimetype?[n.mimetype]:["*/*"]),"string"===e.util.typeOf(h)&&(h=h.split(","));var g=n.extensions;g||n.extension&&(g=[n.extension]),"string"===e.util.typeOf(g)&&(g=g.replace(/ /g,"").split(","));var v={location:n.location,path:n.path,container:n.container,access:n.access,policy:n.policy,signature:n.signature},w=function(){return r&&"disabled"!==(r.getAttribute("disabled")||"enabled")};r.addEventListener("dragenter",function(e){return w()&&l(),e.stopPropagation(),e.preventDefault(),!1},!1),r.addEventListener("dragleave",function(e){return w()&&u(),e.stopPropagation(),e.preventDefault(),!1},!1),r.addEventListener("dragover",function(e){return e.dataTransfer.dropEffect="copy",e.preventDefault(),!1},!1),r.addEventListener("drop",function(e){if(e.stopPropagation(),e.preventDefault(),!w())return!1;if(s(e))return!1;var t=e.dataTransfer.files,r=C(e.dataTransfer);return t.length?i(t):r?a(r):f("NoFilesFound","No files uploaded"),!1});var y=function(){r.setAttribute("disabled","enabled"),window.$&&window.$(r).prop("disabled",!1)},b={},x=[],E=function(e,t){return function(r){n.multiple?(x.push(r),x.length===t?(p(x),x=[],b={}):(b[e]=100,k(t))):p([r]),y()}},A=function(e){f("UploadError",e.toString()),y()},F=function(e,t){return function(r){b[e]=r,k(t)}},k=function(e){var t=0;for(var r in b)t+=b[r];var n=t/e;m(n)},P=function(t){if(t.length>0){if(t.length>1&&!n.multiple)return f("TooManyFiles","Only one file at a time"),!1;if(n.maxFiles>0&&t.length>n.maxFiles)return f("TooManyFiles","Only "+n.maxFiles+" files at a time"),!1;for(var r,o,i,a=0;a<t.length;a++){r=!1,o=t[a],i=o.name||o.fileName||"Unknown file";for(var s=0;s<h.length;s++){var c=e.mimetypes.getMimetype(o);r=r||e.mimetypes.matchesMimetype(c,h[s])}if(!r)return f("WrongType",i+" isn't the right type of file"),!1;if(g){for(r=!1,s=0;s<g.length;s++)r=r||e.util.endsWith(i,g[s]);if(!r)return f("WrongType",i+" isn't the right type of file"),!1}if(o.size&&n.maxSize&&o.size>n.maxSize)return f("WrongSize",i+" is too large ("+o.size+" Bytes)"),!1}return!0}return f("NoFilesFound","No files uploaded"),!1},C=function(t){var r,n;if(t&&"function"==typeof t.getData){r=t.getData("text");try{r=r||t.getData("text/html")}catch(o){e.util.console.error(o)}r&&!e.util.isUrl(r)&&(n=r.match(/<img.*?src="(.*?)"/i),r=n&&n.length>1?n[1]:null)}return r};return!0};return{enabled:t,makeDropPane:r}}),filepicker.extend("responsiveImages",function(){function e(){n(),w(k)}function t(){y(k)}function r(e){if(void 0!==e){if("IMG"!==e.nodeName)throw new A.FilepickerException("Passed object is not an image");h(e)}else n(!0)}function n(e){var t,r,n=document.querySelectorAll("img[data-fp-src]");for(r=0;r<n.length;r++)t=n[r],(o(t)||e===!0)&&h(t)}function o(e){var t=l(e),r=s(e)||b().onResize||"all";if(!t||"all"===r)return!0;if("none"===r)return!1;var n=m(t).width<i(e).width;return n&&"up"===r||!n&&"down"===r?!0:!1}function i(e){var t={};return null===e.parentNode?(t.width=A.windowUtils.getWidth(),t.height=A.windowUtils.getWidth(),t):e.alt&&!e.fpAltCheck?(e.parentNode.fpAltCheck=!0,i(e.parentNode)):(t.width=e.offsetWidth,t.height=e.offsetHeight,t.width?t:i(e.parentNode))}function a(e,t){var r=l(e)||u(e);r!==t&&(e.src=t,r&&(e.onerror=function(){e.src=r,e.onerror=null}))}function s(e){return e.getAttribute("data-fp-on-resize")}function c(e){return e.getAttribute("data-fp-pixel-round")}function l(e){return e.getAttribute("src")}function u(e){return e.getAttribute("data-fp-src")}function d(e){return e.getAttribute("data-fp-apikey")}function p(e){return e.getAttribute("data-fp-signature")}function f(e){return e.getAttribute("data-fp-policy")}function m(e){return A.conversionsUtil.parseUrl(e).optionsDict.resize||{}}function h(e){var t=u(e)||l(e),r=d(e)||A.apikey,n=b();A.apikey||(A.setKey(r),A.util.checkApiKey()),a(e,A.conversionsUtil.buildUrl(t,g(e,n),r))}function g(e,t){t=t||{};var r=i(e),n=c(e)||t.pixelRound||10,o={resize:{width:E(r.width,n)}},a=t.signature||p(e);return a&&(o.security={signature:a,policy:t.policy||f(e)}),o}function v(e,t){var r;return function(){var n=this,o=arguments,i=function(){r=null,e.apply(n,o)};clearTimeout(r),r=setTimeout(i,t)}}function w(e){window.addEventListener?window.addEventListener("resize",e,!1):window.attachEvent&&window.attachEvent("onresize",e)}function y(e){window.removeEventListener?window.removeEventListener("resize",e,!1):window.detachEvent&&window.detachEvent("onresize",e)}function b(){return A.responsiveOptions||{}}function x(e){if(e=e||{},"object"!=typeof e)throw new A.FilepickerException("Responsive options must be an object.");A.responsiveOptions=e}function E(e,t){var r=0===t?1:t;return Math.ceil(e/r)*r}var A=this,F=200,k=v(function(){n()},F);return{activate:e,deactivate:t,update:r,setResponsiveOptions:x,getResponsiveOptions:b,getElementDims:i,replaceSrc:a,getCurrentResizeParams:m,construct:h,constructParams:g,shouldConstruct:o,roundWithStep:E,addWindowResizeEvent:w,removeWindowResizeEvent:y}}),filepicker.extend("widgets",function(){function e(){try{var e='.fp__btn{-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;display:inline-block;height:34px;padding:4px 30px 5px 40px;position:relative;margin-bottom:0;vertical-align:middle;-ms-touch-action:manipulation;touch-action:manipulation;cursor:pointer;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none;font-family:"Open Sans", sans-serif;font-size:12px;font-weight:600;line-height:1.42857143;color:#fff;text-align:center;white-space:nowrap;background:#ef4925;background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABIAAAAVCAYAAABLy77vAAAABGdBTUEAALGPC/xhBQAAAJRJREFUOBHNUcEWgCAIy14fbl9egK5MRarHQS7ocANmOCgWh1gdNERig1CgwPlLxkZuE80ndHlU+4Lda1zz0m01dSKtcz0h7qpQb7WR+HyrqRPxahzwwMqqkEVs6qnv+86NQAbcJlK/X+vMeMe7XcBOYaRzcbItUR7/8QgcykmElQrQPErnmxNxl2yyiwcgEvQUocIJaE6yERwqXDIAAAAASUVORK5CYII=");background-repeat:no-repeat;background-position:15px 6px;border:1px solid transparent;border-radius:17px}.fp__btn:hover{background-color:#d64533}.fp__btn::after{position:absolute;content:"";top:15px;right:14px;width:7px;height:4px;background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAcAAAAICAYAAAA1BOUGAAAABGdBTUEAALGPC/xhBQAAAGlJREFUCB1j/P//vw4DA4MiEKOD+0xAkatA/AJNBsS/ysTIyPgfyDgHxO+hCkD0Oag4RAhoPDsQm4NoqCIGBiBnAhBjAxNAkkxAvBZNFsQHuQesmxPIOQZVAKI54UZDFYgABbcBsQhMAgDIVGYSqZsn6wAAAABJRU5ErkJggg==");}.fp__btn:hover::after{background-position:0 -4px;}.fp__btn:active,.fp__btn:focus{outline:none}@media only screen and (min--moz-device-pixel-ratio: 2), only screen and (-o-min-device-pixel-ratio: 2 / 1), only screen and (-webkit-min-device-pixel-ratio: 2), only screen and (min-device-pixel-ratio: 2){.fp__btn{background-image:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACQAAAAqCAYAAADbCvnoAAAABGdBTUEAALGPC/xhBQAAAQFJREFUWAntWEESwjAIbBwfHl+upNoRNjKUJhk5kIvZQGG7bHOwPGltgdYtEJedShKyJnLHhEILz1Zi9HCOzFI7FUqFLAWseDgPdfeQ9QZ4b1j53nstnEJJyBqx20NeT1gEMB5uZG6Fzn5lV5UMp1ASQhMjdnvoqjewsYbDjcytEH5lsxULp1AS0sx8nJfVnjganf3NkVlKhVPIfQ9Zb6jF0atK3mNriXwpicPHvIeyr3sTDA53VgpgH8BvMu1ZCCz7ew/7MPwlE4CQJPNnQj2ZX4SYlEPbVpsvKFZ5TOwhcRoUTQiwwhVjArPEqVvRhMCneMXzDk9lwYphIwrZZOihF32oehMAa1qSAAAAAElFTkSuQmCC");background-size:18px 21px}.fp__btn::after{background:url("data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAA4AAAAQCAYAAAAmlE46AAAABGdBTUEAALGPC/xhBQAAANpJREFUKBWVkU8KglAYxJ/u3HuBwmUX8BqepKN4ka4RguDOVYu2QVCrhIJ6/caekqLiGxi+PzPD58PAWrszxmygD84h7hpePFLy1mEQBJamgvcVYXkqZXTR0LwpJWw0z0Ba6bymDcrI4kkp4EvzCNoVztNKfVATwoOiyx/NDup1SVqPQVBbDDeK3txBb9JuHfhNW3HWjZhDX+SGRAgPHkl5f0+kieBxRVieaPD5LGJ4WghLiwehbkBI4HUirF3S+SYrhhQ2f2H16aR5vMSYwbdjNtYXZ0J7cc70BXnFMHIGznzEAAAAAElFTkSuQmCC");background-size:7px 8px;}}',t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");
r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}catch(n){}}var t=this,r=function(e,t,r,n){var o=n.getAttribute(r);o&&(t[e]=o)},n=function(e,t){var r;document.createEvent?(r=document.createEvent("Event"),r.initEvent("change",!0,!1),r.fpfile=t?t[0]:void 0,r.fpfiles=t,e.dispatchEvent(r)):document.createEventObject?(r=document.createEventObject("Event"),r.eventPhase=2,r.currentTarget=r.srcElement=r.target=e,r.fpfile=t?t[0]:void 0,r.fpfiles=t,e.fireEvent("onchange",r)):e.onchange&&e.onchange(t)},o=function(e,t){t[e]&&(t[e]=t[e].split(","))},i=function(e,t,n){for(var o in n)r(n[o],e,o,t)},a=function(e,n){n=n||"pick";var a={},s={"data-fp-container":"container","data-fp-mimetype":"mimetype","data-fp-extension":"extension","data-fp-openTo":"openTo","data-fp-debug":"debug","data-fp-signature":"signature","data-fp-policy":"policy","data-fp-language":"language","data-fp-background-upload":"backgroundUpload","data-fp-hide":"hide","data-fp-custom-css":"customCss","data-fp-crop-force":"cropForce","data-fp-crop-ratio":"cropRatio","data-fp-crop-dim":"cropDim","data-fp-crop-max":"cropMax","data-fp-crop-min":"cropMin","data-fp-show-close":"showClose","data-fp-conversions":"conversions","data-fp-custom-text":"customText","data-fp-custom-source-container":"customSourceContainer","data-fp-custom-source-path":"customSourcePath"},c={"data-fp-mimetypes":"mimetypes","data-fp-extensions":"extensions","data-fp-maxSize":"maxSize","data-fp-maxFiles":"maxFiles","data-fp-store-location":"storeLocation","data-fp-store-path":"storePath","data-fp-store-container":"storeContainer","data-fp-store-region":"storeRegion","data-fp-store-access":"storeAccess","data-fp-image-quality":"imageQuality","data-fp-image-dim":"imageDim","data-fp-image-max":"imageMax","data-fp-image-min":"imageMin"},l={"data-fp-video-recording-resolution":"videoRes","data-fp-webcam-dim":"webcamDim","data-fp-video-length":"videoLen","data-fp-audio-length":"audioLen"};i(a,e,s),"export"===n?r("suggestedFilename",a,"data-fp-suggestedFilename",e):"pick"===n&&(i(a,e,c),a.webcam={},i(a.webcam,e,l));var u=e.getAttribute("data-fp-services");if(u){u=u.split(",");for(var d=0;d<u.length;d++)u[d]=t.services[u[d].replace(" ","")]||u[d];a.services=u}var p=e.getAttribute("data-fp-service");p&&(a.service=t.services[p.replace(" ","")]||p);var f=["extensions","mimetypes","imageDim","imageMin","imageMax","cropDim","cropMax","cropMin","webcamDim","conversions"];for(var m in f)o(f[m],a);var h=e.getAttribute("data-fp-apikey");return h&&t.setKey(h),a.folders="true"===e.getAttribute("data-fp-folders"),a},s=function(e){return"true"===e.getAttribute("data-fp-multiple")},c=function(e){var r=document.createElement("button");r.setAttribute("type","button"),r.innerHTML=e.getAttribute("data-fp-button-text")||"Pick File",r.className=e.getAttribute("data-fp-button-class")||e.className||"fp__btn",e.style.display="none";var o=a(e);s(e)?r.onclick=function(){return r.blur(),t.pickMultiple(o,function(t){for(var r=[],o=0;o<t.length;o++)r.push(t[o].url);e.value=r.join(),n(e,t)}),!1}:r.onclick=function(){return r.blur(),t.pick(o,function(t){e.value=t.url,n(e,[t])}),!1},e.parentNode.insertBefore(r,e.nextSibling)},l=function(e){var r=e.getAttribute("data-fp-url");if(!r)return!0;var o=document.createElement("button");o.setAttribute("type","button"),o.innerHTML=e.getAttribute("data-fp-button-text")||"Convert File",o.className=e.getAttribute("data-fp-button-class")||e.className||"fp__btn",e.style.display="none";var i=a(e,"convert");o.onclick=function(){return o.blur(),t.processImage(r,i,function(t){e.value=t.url,n(e,[t])}),!1},e.parentNode.insertBefore(o,e.nextSibling)},u=function(e){var r=document.createElement("div");r.className=e.getAttribute("data-fp-class")||e.className,r.style.padding="1px",e.style.display="none",e.parentNode.insertBefore(r,e.nextSibling);var o=document.createElement("button");o.setAttribute("type","button"),o.innerHTML=e.getAttribute("data-fp-button-text")||"Pick File",o.className=e.getAttribute("data-fp-button-class")||"fp__btn",r.appendChild(o);var i=document.createElement("div");p(i),i.innerHTML=e.getAttribute("data-fp-drag-text")||"Or drop files here",i.className=e.getAttribute("data-fp-drag-class")||"",r.appendChild(i);var c=a(e),l=s(e);t.dragdrop.enabled()?f(i,l,c,e):i.innerHTML="&nbsp;",l?i.onclick=o.onclick=function(){return o.blur(),t.pickMultiple(c,function(t){for(var r=[],o=[],a=0;a<t.length;a++)r.push(t[a].url),o.push(t[a].filename);e.value=r.join(),d(e,i,o.join(", ")),n(e,t)}),!1}:i.onclick=o.onclick=function(){return o.blur(),t.pick(c,function(t){e.value=t.url,d(e,i,t.filename),n(e,[t])}),!1}},d=function(e,r,o){r.innerHTML=o,r.style.padding="2px 4px",r.style.cursor="default",r.style.width="";var i=document.createElement("span");i.innerHTML="X",i.style.borderRadius="8px",i.style.fontSize="14px",i.style.cssFloat="right",i.style.padding="0 3px",i.style.color="#600",i.style.cursor="pointer";var a=function(o){return o||(o=window.event),o.cancelBubble=!0,o.stopPropagation&&o.stopPropagation(),p(r),t.dragdrop.enabled?r.innerHTML=e.getAttribute("data-fp-drag-text")||"Or drop files here":r.innerHTML="&nbsp;",e.value="",n(e),!1};i.addEventListener?i.addEventListener("click",a,!1):i.attachEvent&&i.attachEvent("onclick",a),r.appendChild(i)},p=function(e){e.style.border="1px dashed #AAA",e.style.display="inline-block",e.style.margin="0 0 0 4px",e.style.borderRadius="3px",e.style.backgroundColor="#F3F3F3",e.style.color="#333",e.style.fontSize="14px",e.style.lineHeight="22px",e.style.padding="2px 4px",e.style.verticalAlign="middle",e.style.cursor="pointer",e.style.overflow="hidden"},f=function(e,r,o,i){var a,s=e.innerHTML;t.dragdrop.makeDropPane(e,{multiple:r,maxSize:o.maxSize,mimetypes:o.mimetypes,mimetype:o.mimetype,extensions:o.extensions,extension:o.extension,location:o.storeLocation,path:o.storePath,container:o.storeContainer,region:o.storeRegion,access:o.storeAccess,policy:o.policy,signature:o.signature,dragEnter:function(){e.innerHTML="Drop to upload",e.style.backgroundColor="#E0E0E0",e.style.border="1px solid #000"},dragLeave:function(){e.innerHTML=s,e.style.backgroundColor="#F3F3F3",e.style.border="1px dashed #AAA"},onError:function(t,r){"TooManyFiles"===t?e.innerHTML=r:"WrongType"===t?e.innerHTML=r:"NoFilesFound"===t?e.innerHTML=r:"UploadError"===t&&(e.innerHTML="Oops! Had trouble uploading.")},onStart:function(t){a=m(e)},onProgress:function(e){a&&(a.style.width=e+"%")},onSuccess:function(t){for(var r=[],o=[],a=0;a<t.length;a++)r.push(t[a].url),o.push(t[a].filename);i.value=r.join(),d(i,e,o.join(", ")),n(i,t)}})},m=function(e){var t=document.createElement("div"),r=e.offsetHeight-2;return t.style.height=r+"px",t.style.backgroundColor="#0E90D2",t.style.width="2%",t.style.borderRadius="3px",e.style.width=e.offsetWidth+"px",e.style.padding="0",e.style.border="1px solid #AAA",e.style.backgroundColor="#F3F3F3",e.style.boxShadow="inset 0 1px 2px rgba(0, 0, 0, 0.1)",e.innerHTML="",e.appendChild(t),t},h=function(e){e.onclick=function(){var r=e.getAttribute("data-fp-url");if(!r)return!0;var n=a(e,"export");return t.exportFile(r,n),!1}},g=function(){if(document.querySelectorAll){var t,r=document.querySelectorAll('input[type="filepicker"]');for(t=0;t<r.length;t++)c(r[t]);var n=document.querySelectorAll('input[type="filepicker-dragdrop"]');for(t=0;t<n.length;t++)u(n[t]);var o=document.querySelectorAll('input[type="filepicker-convert"]');for(t=0;t<o.length;t++)l(o[t]);var i=[],a=document.querySelectorAll("button[data-fp-url]");for(t=0;t<a.length;t++)i.push(a[t]);for(a=document.querySelectorAll("a[data-fp-url]"),t=0;t<a.length;t++)i.push(a[t]);for(a=document.querySelectorAll('input[type="button"][data-fp-url]'),t=0;t<a.length;t++)i.push(a[t]);for(t=0;t<i.length;t++)h(i[t]);var s=document.querySelectorAll('[type="filepicker-preview"][data-fp-url]');for(t=0;t<s.length;t++)w(s[t]);e()}},v=function(e){e.jquery&&(e=e[0]);var r=e.getAttribute("type");"filepicker"===r?c(e):"filepicker-dragdrop"===r?u(e):"filepicker-preview"===r?w(e):e.getAttribute("data-fp-src")?t.responsiveImages.construct(e):h(e)},w=function(e){var r=e.getAttribute("data-fp-url"),n=e.getAttribute("data-fp-custom-css");if(!r||!t.util.isFPUrl(r))return!0;r=r.replace("api/file/","api/preview/");var o=document.createElement("iframe");n&&(r=t.util.appendQueryToUrl(r,"css",n)),o.src=r,o.width="100%",o.height="100%",e.appendChild(o)};return{constructPickWidget:c,constructDragWidget:u,constructExportWidget:h,buildWidgets:g,constructWidget:v}}),function(){filepicker.internal(function(){var e=this;e.util.addOnLoad(e.cookies.checkThirdParty),e.util.addOnLoad(e.widgets.buildWidgets),e.util.addOnLoad(e.responsiveImages.activate)}),delete filepicker.internal,delete filepicker.extend;var e,t=filepicker._queue||[],r=t.length;if(r)for(var n=0;r>n;n++)e=t[n],filepicker[e[0]].apply(filepicker,e[1]);filepicker._queue&&delete filepicker._queue}(),/*!
 * clipboard.js v1.5.10
 * https://zenorocha.github.io/clipboard.js
 *
 * Licensed MIT  Zeno Rocha
 */
function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Clipboard=f()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var matches=require("matches-selector");module.exports=function(element,selector,checkYoSelf){for(var parent=checkYoSelf?element:element.parentNode;parent&&parent!==document;){if(matches(parent,selector))return parent;parent=parent.parentNode}}},{"matches-selector":5}],2:[function(require,module,exports){function delegate(element,selector,type,callback,useCapture){var listenerFn=listener.apply(this,arguments);return element.addEventListener(type,listenerFn,useCapture),{destroy:function(){element.removeEventListener(type,listenerFn,useCapture)}}}function listener(element,selector,type,callback){return function(e){e.delegateTarget=closest(e.target,selector,!0),e.delegateTarget&&callback.call(element,e)}}var closest=require("closest");module.exports=delegate},{closest:1}],3:[function(require,module,exports){exports.node=function(value){return void 0!==value&&value instanceof HTMLElement&&1===value.nodeType},exports.nodeList=function(value){var type=Object.prototype.toString.call(value);return void 0!==value&&("[object NodeList]"===type||"[object HTMLCollection]"===type)&&"length"in value&&(0===value.length||exports.node(value[0]))},exports.string=function(value){return"string"==typeof value||value instanceof String},exports.fn=function(value){var type=Object.prototype.toString.call(value);return"[object Function]"===type}},{}],4:[function(require,module,exports){function listen(target,type,callback){if(!target&&!type&&!callback)throw new Error("Missing required arguments");if(!is.string(type))throw new TypeError("Second argument must be a String");if(!is.fn(callback))throw new TypeError("Third argument must be a Function");if(is.node(target))return listenNode(target,type,callback);if(is.nodeList(target))return listenNodeList(target,type,callback);if(is.string(target))return listenSelector(target,type,callback);throw new TypeError("First argument must be a String, HTMLElement, HTMLCollection, or NodeList")}function listenNode(node,type,callback){return node.addEventListener(type,callback),{destroy:function(){node.removeEventListener(type,callback)}}}function listenNodeList(nodeList,type,callback){return Array.prototype.forEach.call(nodeList,function(node){node.addEventListener(type,callback)}),{destroy:function(){Array.prototype.forEach.call(nodeList,function(node){node.removeEventListener(type,callback)})}}}function listenSelector(selector,type,callback){return delegate(document.body,selector,type,callback)}var is=require("./is"),delegate=require("delegate");module.exports=listen},{"./is":3,delegate:2}],5:[function(require,module,exports){function match(el,selector){if(vendor)return vendor.call(el,selector);for(var nodes=el.parentNode.querySelectorAll(selector),i=0;i<nodes.length;++i)if(nodes[i]==el)return!0;return!1}var proto=Element.prototype,vendor=proto.matchesSelector||proto.webkitMatchesSelector||proto.mozMatchesSelector||proto.msMatchesSelector||proto.oMatchesSelector;module.exports=match},{}],6:[function(require,module,exports){function select(element){var selectedText;if("INPUT"===element.nodeName||"TEXTAREA"===element.nodeName)element.focus(),element.setSelectionRange(0,element.value.length),selectedText=element.value;else{element.hasAttribute("contenteditable")&&element.focus();var selection=window.getSelection(),range=document.createRange();range.selectNodeContents(element),selection.removeAllRanges(),selection.addRange(range),selectedText=selection.toString()}return selectedText}module.exports=select},{}],7:[function(require,module,exports){function E(){}E.prototype={on:function(name,callback,ctx){var e=this.e||(this.e={});return(e[name]||(e[name]=[])).push({fn:callback,ctx:ctx}),this},once:function(name,callback,ctx){function listener(){self.off(name,listener),callback.apply(ctx,arguments)}var self=this;return listener._=callback,this.on(name,listener,ctx)},emit:function(name){var data=[].slice.call(arguments,1),evtArr=((this.e||(this.e={}))[name]||[]).slice(),i=0,len=evtArr.length;for(i;len>i;i++)evtArr[i].fn.apply(evtArr[i].ctx,data);return this},off:function(name,callback){var e=this.e||(this.e={}),evts=e[name],liveEvents=[];if(evts&&callback)for(var i=0,len=evts.length;len>i;i++)evts[i].fn!==callback&&evts[i].fn._!==callback&&liveEvents.push(evts[i]);return liveEvents.length?e[name]=liveEvents:delete e[name],this}},module.exports=E},{}],8:[function(require,module,exports){!function(global,factory){if("function"==typeof define&&define.amd)define(["module","select"],factory);else if("undefined"!=typeof exports)factory(module,require("select"));else{var mod={exports:{}};factory(mod,global.select),global.clipboardAction=mod.exports}}(this,function(module,_select){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}var _select2=_interopRequireDefault(_select),_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(obj){return typeof obj}:function(obj){return obj&&"function"==typeof Symbol&&obj.constructor===Symbol?"symbol":typeof obj},_createClass=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),Object.defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),ClipboardAction=function(){function ClipboardAction(options){_classCallCheck(this,ClipboardAction),this.resolveOptions(options),this.initSelection()}return ClipboardAction.prototype.resolveOptions=function(){var options=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action=options.action,this.emitter=options.emitter,this.target=options.target,this.text=options.text,this.trigger=options.trigger,this.selectedText=""},ClipboardAction.prototype.initSelection=function(){this.text?this.selectFake():this.target&&this.selectTarget()},ClipboardAction.prototype.selectFake=function(){var _this=this,isRTL="rtl"==document.documentElement.getAttribute("dir");this.removeFake(),this.fakeHandler=document.body.addEventListener("click",function(){return _this.removeFake()}),this.fakeElem=document.createElement("textarea"),this.fakeElem.style.fontSize="12pt",this.fakeElem.style.border="0",this.fakeElem.style.padding="0",this.fakeElem.style.margin="0",this.fakeElem.style.position="fixed",this.fakeElem.style[isRTL?"right":"left"]="-9999px",this.fakeElem.style.top=(window.pageYOffset||document.documentElement.scrollTop)+"px",this.fakeElem.setAttribute("readonly",""),this.fakeElem.value=this.text,document.body.appendChild(this.fakeElem),this.selectedText=_select2["default"](this.fakeElem),this.copyText()},ClipboardAction.prototype.removeFake=function(){this.fakeHandler&&(document.body.removeEventListener("click"),this.fakeHandler=null),this.fakeElem&&(document.body.removeChild(this.fakeElem),this.fakeElem=null)},ClipboardAction.prototype.selectTarget=function(){this.selectedText=_select2["default"](this.target),this.copyText()},ClipboardAction.prototype.copyText=function(){var succeeded=void 0;try{succeeded=document.execCommand(this.action)}catch(err){succeeded=!1}this.handleResult(succeeded)},ClipboardAction.prototype.handleResult=function(succeeded){succeeded?this.emitter.emit("success",{action:this.action,text:this.selectedText,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)}):this.emitter.emit("error",{action:this.action,trigger:this.trigger,clearSelection:this.clearSelection.bind(this)})},ClipboardAction.prototype.clearSelection=function(){this.target&&this.target.blur(),window.getSelection().removeAllRanges()},ClipboardAction.prototype.destroy=function(){this.removeFake()},_createClass(ClipboardAction,[{key:"action",set:function(){var action=arguments.length<=0||void 0===arguments[0]?"copy":arguments[0];if(this._action=action,"copy"!==this._action&&"cut"!==this._action)throw new Error('Invalid "action" value, use either "copy" or "cut"')},get:function(){return this._action}},{key:"target",set:function(target){if(void 0!==target){if(!target||"object"!==("undefined"==typeof target?"undefined":_typeof(target))||1!==target.nodeType)throw new Error('Invalid "target" value, use a valid Element');if("copy"===this.action&&target.hasAttribute("disabled"))throw new Error('Invalid "target" attribute. Please use "readonly" instead of "disabled" attribute');if("cut"===this.action&&(target.hasAttribute("readonly")||target.hasAttribute("disabled")))throw new Error('Invalid "target" attribute. You can\'t cut text from elements with "readonly" or "disabled" attributes');this._target=target}},get:function(){return this._target}}]),ClipboardAction}();module.exports=ClipboardAction})},{select:6}],9:[function(require,module,exports){!function(global,factory){if("function"==typeof define&&define.amd)define(["module","./clipboard-action","tiny-emitter","good-listener"],factory);else if("undefined"!=typeof exports)factory(module,require("./clipboard-action"),require("tiny-emitter"),require("good-listener"));else{var mod={exports:{}};factory(mod,global.clipboardAction,global.tinyEmitter,global.goodListener),global.clipboard=mod.exports}}(this,function(module,_clipboardAction,_tinyEmitter,_goodListener){"use strict";function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{"default":obj}}function _classCallCheck(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(self,call){if(!self)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!call||"object"!=typeof call&&"function"!=typeof call?self:call}function _inherits(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=Object.create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(Object.setPrototypeOf?Object.setPrototypeOf(subClass,superClass):subClass.__proto__=superClass)}function getAttributeValue(suffix,element){var attribute="data-clipboard-"+suffix;if(element.hasAttribute(attribute))return element.getAttribute(attribute)}var _clipboardAction2=_interopRequireDefault(_clipboardAction),_tinyEmitter2=_interopRequireDefault(_tinyEmitter),_goodListener2=_interopRequireDefault(_goodListener),Clipboard=function(_Emitter){function Clipboard(trigger,options){_classCallCheck(this,Clipboard);var _this=_possibleConstructorReturn(this,_Emitter.call(this));return _this.resolveOptions(options),_this.listenClick(trigger),_this}return _inherits(Clipboard,_Emitter),Clipboard.prototype.resolveOptions=function(){var options=arguments.length<=0||void 0===arguments[0]?{}:arguments[0];this.action="function"==typeof options.action?options.action:this.defaultAction,this.target="function"==typeof options.target?options.target:this.defaultTarget,this.text="function"==typeof options.text?options.text:this.defaultText},Clipboard.prototype.listenClick=function(trigger){var _this2=this;this.listener=_goodListener2["default"](trigger,"click",function(e){return _this2.onClick(e)})},Clipboard.prototype.onClick=function(e){var trigger=e.delegateTarget||e.currentTarget;this.clipboardAction&&(this.clipboardAction=null),this.clipboardAction=new _clipboardAction2["default"]({action:this.action(trigger),target:this.target(trigger),text:this.text(trigger),trigger:trigger,emitter:this})},Clipboard.prototype.defaultAction=function(trigger){return getAttributeValue("action",trigger)},Clipboard.prototype.defaultTarget=function(trigger){var selector=getAttributeValue("target",trigger);return selector?document.querySelector(selector):void 0},Clipboard.prototype.defaultText=function(trigger){return getAttributeValue("text",trigger)},Clipboard.prototype.destroy=function(){this.listener.destroy(),this.clipboardAction&&(this.clipboardAction.destroy(),this.clipboardAction=null)},Clipboard}(_tinyEmitter2["default"]);module.exports=Clipboard})},{"./clipboard-action":8,"good-listener":4,"tiny-emitter":7}]},{},[9])(9)}),function(){String.prototype.capitalize=function(){return this.charAt(0).toUpperCase()+this.slice(1)},String.prototype.isCapitalized=function(){return/^[A-Z]/.test(this)},String.prototype.humanize=function(){return this.replace(/([A-Z])/," $1").replace(/\_/g," ").toLowerCase()},String.prototype.truncate=function(length){return this.length>length?this.substring(0,length)+"...":this.toString()},String.prototype.toOrdinal=function(){var n,s,v;return s=["th","st","nd","rd"],n=parseInt(this),v=n%100,this+("<sup>"+(s[(v-20)%10]||s[v]||s[0])+"</sup>")},String.prototype.hashCode=function(){var char,hash,i,j,ref;if(hash=0,0===this.length)return hash;for(i=j=0,ref=this.length-1;ref>=j;i=j+=1)char=this.charCodeAt(i),hash=(hash<<5)-hash+char,hash&=hash;return hash},String.prototype.paramFor=function(name){var regex,results;return name=name.replace(/[\[]/,"\\[").replace(/[\]]/,"\\]"),regex=new RegExp("[\\?&]"+name+"=([^&#]*)"),results=regex.exec(this),null===results?"":decodeURIComponent(results[1].replace(/\+/g," "))}}.call(this),function(){$.fn.spin=function(){return this.each(function(index,node){var $element,spinner_options;return $element=$(node),spinner_options={lines:15,length:10,width:2,radius:7,corners:1,rotate:0,color:$element.css("color"),speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"auto"},$element.outerHeight()<40&&$element.css({height:"40px"}),$element.html(""),new Spinner(spinner_options).spin(node)}),this}}.call(this),function(){$.fn.fields_for=function(scope){var array_match,base,fields,index,key,match,matcher,name1,name2,nested_array_matcher,nested_matcher,scopedFields,unwrappedFields;matcher=new RegExp("^"+scope+"\\[(.*)\\]$"),fields=_.select(this.serializeArray(),function(element){return matcher.test(element.name)}),this.find("[data-fieldname]").each(function(_this){return function(index,node){var name;return name=$(node).data("fieldname"),matcher.test(name)?fields.push({name:name,value:$(node).find(".active").data("value")||""}):void 0}}(this)),scopedFields={},_.each(fields,function(element){var match,typed_value;return match=matcher.exec(element.name),typed_value=element.value,"true"===element.value&&(typed_value=!0),"false"===element.value&&(typed_value=!1),scopedFields[match[1]]=typed_value}),nested_matcher=new RegExp("^([^\\[]*)\\[(.*)\\]$"),nested_array_matcher=new RegExp("^\\[([0-9]+)\\]\\[(.*)\\]$"),unwrappedFields={};for(key in scopedFields)nested_matcher.test(key)?(match=nested_matcher.exec(key),nested_array_matcher.test(match[2])?(array_match=nested_array_matcher.exec(match[2]),index=parseInt(array_match[1]),unwrappedFields[name1=match[1]]||(unwrappedFields[name1]=[]),(base=unwrappedFields[match[1]])[index]||(base[index]={}),unwrappedFields[match[1]][index][array_match[2]]=scopedFields[key]):(unwrappedFields[name2=match[1]]||(unwrappedFields[name2]={}),unwrappedFields[match[1]][match[2]]=scopedFields[key])):unwrappedFields[key]=scopedFields[key];return unwrappedFields},$.fn.disable_form=function(spin){return null==spin&&(spin=!0),this.find("input, select").attr("disabled","disabled"),this.find("input[type=submit], button").disable_button(spin),this},$.fn.enable_form=function(){return this.find("input, select").removeAttr("disabled"),this.find("input[type=submit], button").enable_button(),this},$.fn.disable_button=function(spin){return null==spin&&(spin=!0),this.filter("input[type=submit], button, .btn, a").each(function(index,node){var $button,spinner_options;return $button=$(node),$button.css({height:$button.outerHeight(),width:$button.outerWidth()}),$button.addClass("disabled").attr("disabled","disabled"),spin?(spinner_options={lines:15,length:5,width:2,radius:4,corners:1,rotate:0,color:$button.css("color"),speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"50%",left:"50%"},$button.html("").data("spinning",!0),new Spinner(spinner_options).spin(node)):void 0}),this},$.fn.enable_button=function(){return this.filter("input[type=submit], button, .btn").each(function(index,node){var $button;return $button=$(node),$button.data("spinning")?$(node).button("reset").data("spinning",!1):$button.removeClass("disbaled").removeAttr("disabled")}),this},$.fn.waiting_spinner=function(options){var spinner_options;return spinner_options=_.extend({lines:15,length:10,width:3,radius:10,corners:1,rotate:0,color:"#DDDDDD",speed:1,trail:60,shadow:!1,hwaccel:!1,className:"spinner",zIndex:2e9,top:"auto",left:"-10px"},options),new Spinner(spinner_options).spin(this.get(0)),this},$.page_post=function(url,fields){var element,encoded_token,key,mock_form,token,value;token=session.current_user.get("reader_authentication_token"),encoded_token=encodeURIComponent(token),mock_form=$("<form method='post' action='"+url+"?"+Boundless.auth_token_param+"="+encoded_token+"'>");for(key in fields)value=fields[key],element=$("<input name='"+key+"' type='hidden'>"),element.val(value),mock_form.append(element);return $("body").append(mock_form),mock_form.submit()}}.call(this),function(){$.fn.load_images=function(){return this.find("img.figure").each(function(i,img){return $(img).get(0).complete?($(img).adjust_image(),$(img).animate({opacity:1},150)):$(img).load(function(){return $(img).adjust_image(),$(img).animate({opacity:1},150)})})},$.fn.adjust_image=function(){var expected_width;if(this.attr("src").match(/\.gif/)){if(this.parent().width()>0)return this.attr("width",this.parent().width())}else switch(this.attr("data-img-adjust")){case"center":return expected_width=this.height()*(this.get(0).naturalWidth/this.get(0).naturalHeight),this.attr("src").indexOf("@2x")>-1?this.css({marginLeft:Math.floor((this.parent().width()-expected_width/2)/2)}):this.css({marginLeft:Math.floor((this.parent().width()-expected_width)/2)})}},$.fn.changeElementType=function(newType){var attrs;return attrs={},$.each(this[0].attributes,function(idx,attr){return attrs[attr.nodeName]=attr.nodeValue}),this.replaceWith(function(){return $("<"+newType+"/>",attrs).append($(this).contents())})}}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},slice=[].slice;!function($,window){var Sslect;return Sslect=function(){function Sslect(el,options){this.update_selected=bind(this.update_selected,this),this.toggle_select_list=bind(this.toggle_select_list,this),this.window_listener=bind(this.window_listener,this),this.list_item_listener=bind(this.list_item_listener,this),this.options=$.extend({},this.defaults,options),this.el=el,this.$el=$(el),this.render()}return Sslect.prototype.defaults={container_class:"sslect__container",list_item_class:"sslect__list-item",list_item_text_class:"sslect__list-item-text",select_list_class:"sslect__list",selected_item_list_class:"sslect__active-list",show_select_list_class:"selecting",selected_class:"selected"},Sslect.prototype.render=function(){var i,len,option,select_elem_options,sslect_list_item,sslect_list_item_text;for(this.sslect=this.new_el_with_class("div",this.options.container_class),this.sslect_active_list=this.new_el_with_class("ul",this.options.selected_item_list_class),this.sslect_list=this.new_el_with_class("ul",this.options.select_list_class),this.sslect.appendChild(this.sslect_active_list),this.sslect.appendChild(this.sslect_list),select_elem_options=this.select_menu_options_to_array(this.el.options),i=0,len=select_elem_options.length;len>i;i++)option=select_elem_options[i],sslect_list_item=this.new_el_with_class("li",this.options.list_item_class),sslect_list_item.setAttribute("data-value",option[1]),this.sslect_list.appendChild(sslect_list_item),sslect_list_item_text=this.new_el_with_class("span",this.options.list_item_text_class),sslect_list_item_text.innerText=option[0],sslect_list_item.appendChild(sslect_list_item_text),sslect_list_item.innerHTML=sslect_list_item.innerHTML+option[2],sslect_list_item.addEventListener("click",this.list_item_listener),option[3]&&this.update_selected(sslect_list_item);return this.sslect_active_list.addEventListener("click",this.toggle_select_list),this.el.parentNode.insertBefore(this.sslect,this.el),this.el.style.display="none"},Sslect.prototype.list_item_listener=function(event){return this.update_selected(event.target)},Sslect.prototype.window_listener=function(event){return event.stopPropagation(),event.toElement.classList.contains(this.options.list_item_class)?void 0:(this.sslect_active_list.click(),window.removeEventListener("click",this.window_listener))},Sslect.prototype.toggle_select_list=function(){return this.sslect.classList.toggle(this.options.show_select_list_class),this.sslect.classList.contains(this.options.show_select_list_class)?window.addEventListener("click",this.window_listener):void 0},Sslect.prototype.update_selected=function(to_elem){var query;return this.dataset&&(to_elem=this),query=this.sslect_list.querySelector(this.class_name_as_selector(this.options.selected_class)),query&&query.classList.remove(this.options.selected_class),to_elem.classList.add(this.options.selected_class),this.sslect_active_list.innerHTML="",this.sslect_active_list.appendChild(to_elem.cloneNode(!0)),this.el.value=to_elem.dataset.value,this.sslect_active_list.click()},Sslect.prototype.new_el_with_class=function(el_name,class_name){var new_el;return new_el=document.createElement(el_name),new_el.classList.add(class_name),new_el},Sslect.prototype.select_menu_options_to_array=function(options){var attrs,i,len,option,options_arr;for(options_arr=[],i=0,len=options.length;len>i;i++)option=options[i],attrs=[option.text,parseInt(option.value),option.dataset.html],option.selected&&attrs.push(option.selected),options_arr.push(attrs);return options_arr},Sslect.prototype.class_name_as_selector=function(class_name){return"."+class_name},Sslect}(),$.fn.extend({sslect:function(){var args,option;return option=arguments[0],args=2<=arguments.length?slice.call(arguments,1):[],this.each(function(){var $this,data;return $this=$(this),data=$this.data("sslect"),data||$this.data("sslect",data=new Sslect(this,option)),"string"==typeof option?data[option].apply(data,args):void 0})}})}(window.jQuery,window)}.call(this),function(){window.boundless_module=function(name){return window[name]=window[name]||{}},window.SelectText=function(element){var doc,range,selection,text;return doc=document,text=doc.getElementById(element),range=void 0,selection=void 0,doc.body.createTextRange?(range=document.body.createTextRange(),range.moveToElementText(text),range.select()):window.getSelection?(selection=window.getSelection(),range=document.createRange(),range.selectNodeContents(text),selection.removeAllRanges(),selection.addRange(range)):void 0}}.call(this),function(){boundless_module("ViewHelpers"),ViewHelpers.form_for=function(model,options,constructor){return"function"==typeof options&&(constructor=options,options={}),FormHelper.Builder.form_for(model,options,constructor)},ViewHelpers.fields_for=function(model,options,constructor){return"function"==typeof options&&(constructor=options,options={}),FormHelper.Builder.fields_for(model,options,constructor)},boundless_module("FormHelper"),FormHelper.Builder=function(){function Builder(){}return Builder.prototype.defaultInputs={string:"string",number:"number","boolean":"checkbox",object:"select",hidden:"hidden"},Builder.prototype.eventMap={string:"keyup",text:"keyup",select:"change",checkbox:"change",radio:"change"},Builder.form_for=function(model,options,constructor){var builder,form_class,form_id,form_layout,form_name;return builder=new this,builder.object=model,builder.object_chain=[model],form_id=options.id||builder.objectName()+"-form",form_class=options["class"]||builder.objectName()+"-form",form_name=options.name||form_id||builder.objectName()+"-form",form_layout=options.layout||"vertical","<form id='"+form_id+"' name='"+form_name+"' class='form-"+form_layout+" "+form_class+"' method='POST' novalidate>"+constructor(builder)+"</form>"},Builder.fields_for=function(model,options,constructor){var builder;return builder=new this,builder.object=model,builder.object_chain=[model],"<fieldset>"+constructor(builder)+"</fieldset>"},Builder.prototype.fields_for=function(model,options,constructor){var instantiated_model,nested_builder,output;return"function"==typeof options&&(constructor=options,options={}),nested_builder=new FormHelper.Builder,instantiated_model="string"==typeof model?this.object.get(model):model,null!=instantiated_model.models?(output=[],instantiated_model.each(function(_this){return function(inner_model,index){var hidden_field_constructor;return nested_builder.object=inner_model,nested_builder.object_chain=_this.object_chain.concat([model,index]),hidden_field_constructor=function(form_builder){return form_builder.input("id",{as:"hidden",value:inner_model.id||inner_model.cid})},output.push(hidden_field_constructor(nested_builder)),output.push(constructor(nested_builder))}}(this)),output.join("")):(nested_builder.object=instantiated_model,nested_builder.object_chain=this.object_chain.concat([nested_builder.object]),constructor(nested_builder))},Builder.prototype.actions=function(actions){return"<div class='form-actions'>"+actions()+"</div>"},Builder.prototype.action=function(type,options){var li_classes,li_id;return null==options&&(options={}),li_classes=[type+"-action"],options.wrapper_class&&li_classes.push(options.wrapper_class),li_id=options.wrapper_id?"id='"+options.wrapper_id+"'":"",this.actionFor(type,options)},Builder.prototype.actionFor=function(type,options){var action_classes,action_id,action_type,action_value;switch(action_type=options.as||"input",action_value=options.label||type.capitalize(),action_classes=[type+"-action"],options.action_class&&action_classes.push(options.action_class),"submit"===type&&action_classes.push("btn-primary"),action_id=options.id||this.objectName()+"-"+type+"-action",action_type){case"input":return"<input type='"+type+"' id='"+action_id+"' class='btn "+action_classes.join(" ")+"' value='"+action_value+"' />";case"button":return"<button type='"+type+"' id='"+action_id+"' class='btn "+action_classes.join(" ")+"'>"+action_value+"</button>"}},Builder.prototype.inputs=function(fields){return fields()},Builder.prototype.input=function(field,options){var div_classes,div_id,field_type,ref,ref1;return null==options&&(options={}),field_type=options.as||this.inputTypeFor(field),div_classes=[],_.include(["checkbox","radio"],field_type)||div_classes.push(field_type),div_classes.push(this.objectName()+"-"+field+"-wrapper"),div_classes.push("control-group"),options.wrapper_class&&div_classes.push(options.wrapper_class),(null!=(ref=this.object.errors)?ref.on(field):void 0)&&div_classes.push("error"),div_id=options.wrapper_id?"id='"+options.wrapper_id+"'":"",(null!=(ref1=this.object.errors)?ref1.on(field):void 0)&&boundless.require("boundless.shared").notifyScreenReaders(field+": "+this.object.errors.messageFor(field)),"<div "+div_id+" class='"+div_classes.join(" ")+"'>\n  "+this.labelFor(field,field_type,options)+"\n  <div class='controls "+(options.controls_class||"")+"'>\n    "+this.inputFor(field,field_type,options)+"\n    "+this.hintFor(options)+"\n  </div>\n  "+this.errorFor(field)+"\n</div>"},Builder.prototype.inputTypeFor=function(field){return/password/.test(field)?"password":this.defaultInputs[typeof this.object.get(field)]},Builder.prototype.inputFor=function(field,field_type,options){var ariaAttributes,ariaDescribedBy,ariaInvalid,ariaLabel,ariaRequired,autocomplete,disabled,error_el,i,input_classes,input_id,input_value,item,j,k,key,l,len,len1,len2,len3,len4,len5,len6,list,m,maxlength,n,o,pattern,placeholder,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,school_name_attr,school_name_id,select_options,toggle_buttons,value;switch(placeholder=options.placeholder?"placeholder='"+options.placeholder+"'":"",autocomplete=options.autocomplete?"autocomplete='"+options.autocomplete+"'":"",disabled=options.disabled?"disabled='disabled'":"",error_el=options.error_el?""+options.error_el:void 0,pattern=options.pattern?"pattern='"+options.pattern+"'":"",input_classes=[field_type],options.input_class&&input_classes.push(options.input_class),options.size&&input_classes.push("input-"+options.size),options.disabled&&input_classes.push("disabled"),input_id=options.input_id||this.objectName()+"-"+field+"-input",input_value=options.value||"",null!=this.object.get(field)&&(input_value=this.object.get(field)),options.liveValidate&&this.validate(input_id,field,field_type,error_el),ariaLabel=options.ariaLabel?"aria-label='"+options.ariaLabel+"'":"",ariaRequired=options.hasOwnProperty("ariaRequired")?"aria-required='"+options.ariaRequired+"'":"",ariaDescribedBy=this.errorFor(field)?"aria-describedby='"+this.errorId(field)+"'":"",ariaInvalid="aria-invalid='"+!!this.errorFor(field)+"'",ariaAttributes=" "+ariaLabel+" "+ariaRequired+" "+ariaInvalid+" "+ariaDescribedBy+" ",field_type){case"string":case"password":case"email":return"<input id='"+input_id+"' class='"+input_classes.join(" ")+"' type='"+("string"===field_type?"text":field_type)+"' "+ariaAttributes+" "+this.fieldNameAttribute(field)+" "+placeholder+" "+autocomplete+" "+disabled+" "+pattern+" value='"+input_value+"' "+this.fieldData(options.data)+"/>";case"text":return maxlength=null!=options.maxlength?"maxlength="+options.maxlength:"","<textarea id='"+input_id+"' class='"+input_classes.join(" ")+"' "+this.fieldNameAttribute(field)+" "+maxlength+" "+placeholder+" "+autocomplete+" "+disabled+" "+pattern+" "+this.fieldData(options.data)+">"+input_value+"</textarea>";case"select":if(parseInt(input_value)&&(input_value=parseInt(input_value)),select_options=[],options.placeholder&&select_options.push("<option value='' "+(input_value?void 0:'selected="selected"')+' disabled="disabled">'+options.placeholder+"</option>"),_.isObject(options.collection)&&!_.isArray(options.collection)){ref=options.collection;for(key in ref)value=ref[key],select_options.push("<option value='"+key+"' "+(input_value===key?'selected="selected"':"")+">"+value+"</option>")}else if(options.collection&&"Array"===TypeHelper.get_type(options.collection[0]))for(ref1=options.collection,i=0,len=ref1.length;len>i;i++)item=ref1[i],select_options.push("<option value='"+item[0]+"' "+(input_value===item[0]?'selected="selected"':"")+">"+item[1]+"</option>");else if(_.isArray(options.collection[0]))for(ref2=options.collection,j=0,len1=ref2.length;len1>j;j++)item=ref2[j],select_options.push("<option value='"+item[0]+"' "+(input_value===item[0]?'selected="selected"':"")+">"+item[1]+"</option>");else for(ref3=options.collection,k=0,len2=ref3.length;len2>k;k++)item=ref3[k],select_options.push("<option value='"+item+"' "+(input_value===item?'selected="selected"':"")+">"+item+"</option>");return"<select id='"+input_id+"' class='"+input_classes.join(" ")+"' "+this.fieldNameAttribute(field)+" "+disabled+" "+this.fieldData(options.data)+">\n  "+select_options.join("")+"\n</select>";case"multi-select":if(select_options=[],_.isObject(options.collection))for(key in options.collection)select_options.push("<option value='"+key+"' "+(input_value===key?'selected="selected"':"")+">"+options.collection[key]+"</option>");else for(ref4=options.collection,l=0,len3=ref4.length;len3>l;l++)item=ref4[l],select_options.push("<option value='"+item+"' "+(input_value===key?'selected="selected"':"")+">"+item+"</option>");return"<select id='"+input_id+"' class='"+input_classes.join(" ")+"' multiple "+this.fieldNameAttribute(field)+" "+this.fieldData(options.data)+">\n  "+select_options.join("")+"\n</select>";case"toggle":if(toggle_buttons=[],_.isObject(options.collection))for(key in options.collection)toggle_buttons.push("<a href='javascript: void(0);' data-value='"+key+"' id='"+input_id+"-"+key+"' class='btn "+input_classes.join(" ")+" "+(input_value===key?"active":"")+"'>"+options.collection[key]+"</a>");else for(ref5=options.collection,
m=0,len4=ref5.length;len4>m;m++)item=ref5[m],toggle_buttons.push("<a href='javascript: void(0);' data-value='"+item+"' id='"+input_id+"-"+key+"' class='btn "+input_classes.join(" ")+" "+(input_value===key?"active":"")+"'>"+item+"</a>");return"<div class='btn-group' data-toggle='buttons-radio' data-fieldname='"+this.fieldName(field)+"'>\n  "+toggle_buttons.join("")+"\n</div>";case"subjects":if(toggle_buttons=[],_.isObject(options.collection))for(key in options.collection)toggle_buttons.push("<div class='btn-subject-cont'><a href='javascript: void(0);' data-value='"+key+"' id='"+input_id+"-"+key+"' class='btn "+(input_value===key?"active":"")+" "+input_classes.join(" ")+"'>"+ViewHelpers.icon_html_for_subject(options.collection[key])+"</a><span class='subject-label'>"+options.collection[key]+"</span></div>");else for(ref6=options.collection,n=0,len5=ref6.length;len5>n;n++)item=ref6[n],toggle_buttons.push("<div class='btn-subject-cont'><a href='javascript: void(0);' data-value='"+item+"' id='"+input_id+"-"+key+"' class='btn "+(input_value===key?"active":"")+" "+input_classes.join(" ")+"'>"+ViewHelpers.icon_html_for_subject(item)+"'></i></a><span class='subject-label'>"+item+"</span></div>");return"<div class='btn-group subjects' data-toggle='buttons-radio' data-fieldname='"+this.fieldName(field)+"'>\n  "+toggle_buttons.join("")+"\n</div>";case"checkbox":return"false"===input_value&&(input_value=null),"<label class='checkbox'>\n  <input "+this.fieldNameAttribute(field)+" type='hidden' value='false' />\n  <input "+this.fieldNameAttribute(field)+" "+(input_value?'checked="checked"':"")+" type='checkbox' value='true' id='"+input_id+"' class='"+input_classes.join(" ")+"' />\n</label>";case"expiration":input_value={},select_options={};for(list in options.collection)if(input_value[list]=this.object.get(field+"-"+list)||"",select_options[list]=[],_.isObject(options.collection[list]))for(key in options.collection[list])select_options[list].push("<option value='"+key+"' "+(input_value[list]===key?'selected="selected"':"")+">"+options.collection[list][key]+"</option>");else for(ref7=options.collection[list],o=0,len6=ref7.length;len6>o;o++)item=ref7[o],select_options[list].push("<option value='"+item+"' "+(input_value[list]===key?'selected="selected"':"")+">"+item+"</option>");return"<select id='"+input_id+"-month' class='"+input_classes.join(" ")+"' "+this.fieldNameAttribute(field+"-month")+">\n  "+select_options.month.join("")+"\n</select>\n<select id='"+input_id+"-year' class='"+input_classes.join(" ")+"' "+this.fieldNameAttribute(field+"-year")+">\n  "+select_options.year.join("")+"\n</select>";case"school":return school_name_attr=this.fieldNameAttribute(field).replace("school_id","school_name"),school_name_id=input_id.replace("school_id","school_name"),options.data||(options.data={}),options.data["school-selector"]=input_id,"<input id='"+school_name_id+"' class='"+input_classes.join(" ")+"' "+ariaAttributes+" type='text' "+school_name_attr+" "+placeholder+" "+autocomplete+" "+disabled+" "+pattern+" value='"+(this.object.get("school_name")||"")+"' "+this.fieldData(options.data)+"/>\n<input id='"+input_id+"' class='"+input_classes.join(" ")+"' type='hidden' "+this.fieldNameAttribute(field)+" "+placeholder+" "+autocomplete+" value='"+input_value+"' "+this.fieldData(options.data)+"/>";case"hidden":return"<input id='"+input_id+"' class='"+input_classes.join(" ")+"' type='hidden' "+ariaAttributes+" "+this.fieldNameAttribute(field)+" "+placeholder+" "+autocomplete+" value='"+input_value+"' "+this.fieldData(options.data)+"/>";case"number":return"<input id='"+input_id+"' class='"+input_classes.join(" ")+"' type='number' "+this.fieldNameAttribute(field)+" "+autocomplete+" value='"+input_value+"' "+this.fieldData(options.data)+"/>";case"date":return options.data||(options.data={}),options.data["date-selector"]=options.date_format||"mm/dd/yyyy","<input id='"+input_id+"' class='"+input_classes.join(" ")+"' type='text' "+this.fieldNameAttribute(field)+" "+placeholder+" "+autocomplete+" "+disabled+" "+pattern+" value='"+input_value+"' "+this.fieldData(options.data)+"/>"}},Builder.prototype.labelFor=function(field,field_type,options){var input_id;return"hidden"===field_type||"boolean"==typeof options.label&&!options.label?"":(input_id=options.input_id||this.objectName()+"-"+field+"-input","<label class='control-label' for='"+input_id+"'>"+(options.label||field.capitalize())+"</label>")},Builder.prototype.hintFor=function(options){return options.hint?"<span class='help-block'><i class='icon-info-sign'></i>"+options.hint+"</span>":""},Builder.prototype.errorId=function(field){return"error_for_"+field},Builder.prototype.errorFor=function(field){var ref;return(null!=(ref=this.object.errors)?ref.on(field):void 0)?"<span id='"+this.errorId(field)+"' class='help-inline' role='alert'><i class='icon-exclamation-sign'></i>"+this.object.errors.messageFor(field)+"</span>":""},Builder.prototype.objectName=function(){var object_type;return object_type=TypeHelper.get_type(this.object).toLowerCase()},Builder.prototype.fieldNameAttribute=function(field){return"name='"+this.fieldName(field)+"'"},Builder.prototype.fieldName=function(field){var i,index,name,object_type,ref;for(name=field,index=i=ref=this.object_chain.length-1;0>=ref?0>=i:i>=0;index=0>=ref?++i:--i)"string"==typeof this.object_chain[index]?name=this.object_chain[index]+"["+name+"]":"number"==typeof this.object_chain[index]?name="["+this.object_chain[index]+"]["+name+"]":(object_type=TypeHelper.get_type(this.object_chain[index]).toLowerCase(),name=object_type+"["+name+"]");return name},Builder.prototype.fieldData=function(field_data){var data;return data="",_.each(field_data,function(value,key){return data+="data-"+key+"='"+value+"' "}),data},Builder.prototype.validate=function(input_id,field,field_type,error_el){var event;return event=this.eventMap[field_type]+".validator",$("#"+input_id).off(event).on(event,function(_this){return function(e){var $error_el,$input,$li,attrs,ref;return $input=$(e.target),attrs={},attrs[field]=$input.val(),_this.object.set(attrs,{silent:!0}),_this.object.validate(),$error_el=$(error_el)||$input.closest("li"),$li=$input.closest("li"),(null!=(ref=_this.object.errors)?ref.on(field):void 0)?(Boundless.Logger.log("has errors",_this.errorFor(field)),$li.removeClass("valid").addClass("error"),$li.find(".inline-errors").remove(),$error_el.append(_this.errorFor(field))):($li.find(".inline-errors").remove(),$li.removeClass("error").addClass("valid"))}}(this))},Builder}()}.call(this),function(){boundless_module("ViewHelpers"),ViewHelpers.url_for=function(object,text,options){switch(null==options&&(options={}),TypeHelper.get_type(object).toLowerCase()){case"string":return object;case"purchase":return"courses/"+app.current_user.get("purchases").purchase_permalink(object)+"/activity";case"chapter":return"courses/"+app.current_purchase_permalink()+"/"+object.number();case"section":return"courses/"+app.current_purchase_permalink()+"/"+object.chapter().number()+"/"+object.number();case"concept":return"courses/"+app.current_purchase_permalink()+"/"+object.chapter().number()+"/"+object.parent().number()+"/"+object.id;default:return object}},ViewHelpers.link_to=function(object,text,options){var href;return null==options&&(options={}),href=ViewHelpers.url_for(object,text,options),ViewHelpers.link_generator(href,text,options)},ViewHelpers.link_to_atom=function(chapter_number,id,text,options){var href;return null==options&&(options={}),href="courses/"+app.current_purchase_permalink()+"/chapters/"+chapter_number+"/"+id,ViewHelpers.link_generator(href,text,options)},ViewHelpers.link_to_chapter_number=function(chapter_number,text,options){return null==options&&(options={}),ViewHelpers.link_generator("courses/"+app.current_purchase_permalink()+"/"+chapter_number,text,options)},ViewHelpers.link_generator=function(href,text,options){var class_name,data,data_key,etc,etc_key,id_name,link_title,rendered_text;null==options&&(options={}),"function"==typeof text&&(text=text()),"function"==typeof options&&(rendered_text=options(),options=text,text=rendered_text),"object"==typeof text&&(options=text,text=href),class_name=options.link_class?"class='"+options.link_class+"' ":"",id_name=options.id?"id='"+options.id+"' ":"",link_title=options.title?"title='"+options.title+"' ":"",data=[],options.data||(options.data={}),options.data=_.extend(options.data,{ajax:!0});for(data_key in options.data)options.data[data_key]&&data.push("data-"+data_key+"="+options.data[data_key]);etc=[],options.etc||(options.etc={});for(etc_key in options.etc)options.etc[etc_key]?etc.push(etc_key+"="+options.etc[etc_key]):etc.push(""+etc_key);return"<a target='"+href+"' "+id_name+class_name+link_title+data.join(" ")+" "+etc.join(" ")+">"+text+"</a>"}}.call(this),function(){boundless_module("TypeHelper"),TypeHelper.get_type=function(object){var constructor_str,funcNameRegex,ref,results,typeName;return funcNameRegex=/function\s+([^\(]+)/,constructor_str=null!=object&&null!=(ref=object.constructor)?ref.toString():void 0,constructor_str&&(results=funcNameRegex.exec(constructor_str)),typeName=results&&results.length>1?results[1]:""}}.call(this),function(){boundless_module("FormHelper"),FormHelper.Autosuggest=function(){function Autosuggest(options){return null==options&&(options={}),"string"!=typeof options.inputSelector?void Boundless.Logger.error("Autosuggest: Please provide an input element to provide suggestions for ( e.g. {inputSelector: 'input'} )."):(this.currentVal="",this.selected=!1,this.settings=_.defaults(options,this.defaults),this.initData(),$(this.settings.inputSelector).live("keyup",function(_this){return function(event){return _this.selected&&(_this.trigger("unselected"),_this.selected=!1),_this.inputChange(event)}}(this)),$(this.settings.inputSelector).live("keydown",function(_this){return function(event){switch(event.which){case _this.keyCodes["return"]:case _this.keyCodes.up:case _this.keyCodes.down:return event.preventDefault(),!1;default:return!0}}}(this)),$(this.settings.inputSelector).live("blur",function(_this){return function(event){return _this.hideList()}}(this)),$(this.settings.inputSelector).live("focus",function(_this){return function(event){return _this.setupInput(event.target)}}(this)),$(this.settings.inputSelector).length&&this.setupInput($(this.settings.inputSelector)),void _.extend(this,Backbone.Events))}return Autosuggest.prototype.keyCodes={"return":13,tab:9,esc:27,up:38,down:40},Autosuggest.prototype.defaults={searchType:"remote",noResultsTemplate:!1,identifierField:"id",queryParam:"query",minChars:3,submitOnEnter:!1,maxSuggestions:10,replaceField:!0,autoSelectFirstResult:!0,maxHeight:null,queryConstraints:{},dataSourceCallback:null},Autosuggest.prototype.setupInput=function(element){if(this.input=$(element),this.setupList(),this.currentVal===this.input.val()){if(this.currentVal.length>=this.settings.minChars)return this.showList();if(null!=this.settings.exampleTemplate&&""===this.input.val())return this.list.html(this.settings.exampleTemplate()),this.showList()}},Autosuggest.prototype.initData=function(){return null!=this.settings.dataSource?this.loadData(this.settings.dataSource):this.data=[]},Autosuggest.prototype.loadData=function(dataSource){return _.isArray(dataSource)?(this.settings.searchType="local",this.data=dataSource):"local"===this.settings.searchType?$.get(dataSource,function(_this){return function(response){var base;return _this.data=response,"function"==typeof(base=_this.settings).dataSourceCallback?base.dataSourceCallback(200===response.statusCode):void 0}}(this),"json"):this.search_method||(this.search_method=dataSource)},Autosuggest.prototype.setConstraints=function(constraints,listVisible){return null==listVisible&&(listVisible=!0),this.settings.queryConstraints=constraints},Autosuggest.prototype.setupList=function(){return this.list?void 0:(this.list=$("<ul id='"+this.input.attr("id")+"-autocomplete-list' class='typeahead dropdown-menu'></ul>"),this.repositionList(),$("body").append(this.list.hide()))},Autosuggest.prototype.repositionList=function(){var inputPosition;return this.list&&(inputPosition=this.input.offset(),this.list.css({width:this.input.outerWidth(),top:inputPosition.top+this.input.outerHeight(),left:inputPosition.left-2,position:"absolute",zIndex:1e4}),null!=this.settings.maxHeight)?this.list.css({maxHeight:this.settings.maxHeight+"px",overflowY:"scroll"}):void 0},Autosuggest.prototype.inputChange=function(event){switch(event.which){case this.keyCodes["return"]:return this.selectedIndex>=0?(this.setSuggestion(),this.input.blur(),event.preventDefault()):this.settings.submitOnEnter&&""!==this.input.val()&&this.input.closest("form").submit(),this.latest_callback_timestamp=new Date;case this.keyCodes.esc:return this.clearSuggestions();case this.keyCodes.up:case this.keyCodes.down:return event.preventDefault(),this.moveHighlight(event.which),!1;default:return this.lastVal=this.currentVal,this.currentVal=this.input.val(),this.currentVal.length<this.settings.minChars?(this.lastVal=this.input.val(),null!=this.settings.exampleTemplate&&""===this.input.val()?(this.suggestions=[],this.list.html(this.settings.exampleTemplate())):this.clearSuggestions()):this.getSuggestions(function(_this){return function(){return _this.showSuggestions()}}(this))}},Autosuggest.prototype.hideList=function(){var ref;return null!=(ref=this.list)?ref.hide():void 0},Autosuggest.prototype.removeList=function(){var ref;return null!=(ref=this.list)&&ref.remove(),this.list=null},Autosuggest.prototype.showList=function(){return this.repositionList(),this.list.css({left:this.input.offset().left+2}),this.list.is(":visible")?void 0:this.list.fadeIn(150)},Autosuggest.prototype.clearSuggestions=function(){return this.suggestions=[],this.list.html(""),this.hideList()},Autosuggest.prototype.setSuggestion=function(){return this.selected=!0,this.trigger("selected",this.suggestions[this.selectedIndex],this.currentVal,this.search_id),$(":input:eq("+($(":input").index(this.input)+1)+")").focus()},Autosuggest.prototype.constrainedData=function(){return _.filter(this.data,function(_this){return function(element){return _.all(_.keys(_this.settings.queryConstraints),function(key){return element[key]===_this.settings.queryConstraints[key]})}}(this))},Autosuggest.prototype.getSuggestions=function(callback){var data,element,exactRegEx,exact_matches,field,fuzzyRegex,fuzzy_matches,general_matches,i,individual_regexes,j,k,len,len1,len2,num_matches,ref,ref1,searchRegEx,startRegEx,start_matches,timestamp;if("local"===this.settings.searchType){if(data=this.currentVal.length>this.lastVal&&this.currentVal.substr(0,this.lastVal.length)===this.lastVal?this.suggestions:this.constrainedData(),this.suggestions=[],null!=data){for(individual_regexes=_.map(this.currentVal.toLowerCase().split(" "),function(string){return new RegExp(string,"i")}),searchRegEx=new RegExp("("+this.currentVal.toLowerCase().split(" ").join("|")+")","i"),fuzzyRegex=new RegExp(this.currentVal.toLowerCase().replace(/\W/,"").split("").join("\\w*"),"i"),startRegEx=new RegExp("^("+this.currentVal.toLowerCase().split(" ").join("|")+")","i"),exactRegEx=new RegExp("^"+this.currentVal.toLowerCase()+"s?$","i"),exact_matches=[],start_matches=[],fuzzy_matches=[],general_matches=[],num_matches=0,i=0,len=data.length;len>i;i++)if(element=data[i],_.all(individual_regexes,function(_this){return function(regex){return _.any(_this.settings.searchFields,function(field){return regex.test(element[field])})}}(this))){for(ref=this.settings.searchFields,j=0,len1=ref.length;len1>j;j++)if(field=ref[j],null!=element[field]&&num_matches<this.settings.maxSuggestions){if(exactRegEx.test(element[field])){num_matches+=1,exact_matches.push(element);break}if(startRegEx.test(element[field])){num_matches+=1,start_matches.push(element);break}if(searchRegEx.test(element[field])){num_matches+=1,general_matches.push(element);break}}}else for(ref1=this.settings.searchFields,k=0,len2=ref1.length;len2>k;k++)if(field=ref1[k],null!=element[field]&&fuzzyRegex.test(element[field])){num_matches+=1,fuzzy_matches.push(element);break}this.suggestions_length=num_matches,this.suggestions=exact_matches.concat(start_matches,general_matches,fuzzy_matches),this.suggestions=_.sortBy(this.suggestions,function(suggestion){return suggestion.priority||1})}return callback()}return timestamp=Number(new Date),this.latest_callback_timestamp||(this.latest_callback_timestamp=timestamp),this.search_method(this.currentVal,function(_this){return function(data,query,search_id){return timestamp>=_this.latest_callback_timestamp?(_this.latest_callback_timestamp=timestamp,_this.suggestions_length=data.length,_this.search_id=search_id,_this.suggestions=data.slice(0,_this.settings.maxSuggestions-1),callback()):Boundless.Logger.debug("Not calling search callback for superceeded timestamp "+timestamp)}}(this))},Autosuggest.prototype.showSuggestions=function(){var $suggestion,$view_all_item,i,len,ref,suggestion;for(this.list.html(""),ref=this.suggestions,i=0,len=ref.length;len>i;i++)suggestion=ref[i],$suggestion=$(this.settings.resultTemplate(_.extend({result:suggestion,query:this.currentVal},ViewHelpers))),this.list.append($suggestion),this.add_click_events_for($suggestion);return this.settings.noResultsTemplate&&($view_all_item=$(this.settings.noResultsTemplate()),this.list.append($view_all_item),this.add_click_events_for($view_all_item)),this.settings.autoSelectFirstResult?(this.list.children(":first").addClass("active"),this.selectedIndex=0):this.selectedIndex=-1,this.suggestions.length>0||this.settings.noResultsTemplate?this.showList():this.hideList()},Autosuggest.prototype.add_click_events_for=function(list_item){return list_item.mousedown(function(_this){return function(e){return _this.selectedIndex=$(e.currentTarget).index(),_this.setSuggestion()}}(this)),list_item.mouseenter(function(_this){return function(e){return $(e.target).siblings().removeClass("hover"),$(e.target).addClass("hover")}}(this)),list_item.mouseleave(function(_this){return function(e){return $(e.target).removeClass("hover")}}(this)),list_item.click(function(_this){return function(e){return e.preventDefault()}}(this))},Autosuggest.prototype.moveHighlight=function(keycode){var $selected_child,el_bottom;if(this.selectedIndex||(this.selectedIndex=0),keycode===this.keyCodes.up){if((this.settings.autoSelectFirstResult&&!this.list.find("> *:first").is(".active")||!this.settings.autoSelectFirstResult&&this.selectedIndex>-1)&&(this.selectedIndex-=1,this.list.children().removeClass("active"),this.selectedIndex>-1&&($selected_child=this.list.children().eq(this.selectedIndex),$selected_child.addClass("active"),null!=this.settings.maxHeight&&$selected_child.offset().top<this.list.offset().top)))return this.list.scrollTop(this.list.scrollTop()-(this.list.offset().top-$selected_child.offset().top))}else if(!this.list.find("> *:last").is(".active")&&(this.selectedIndex+=1,$selected_child=this.list.children().removeClass("active").eq(this.selectedIndex),$selected_child.addClass("active"),null!=this.settings.maxHeight&&(el_bottom=$selected_child.offset().top+$selected_child.outerHeight(),el_bottom>this.list.offset().top+this.settings.maxHeight)))return this.list.scrollTop(this.list.scrollTop()+($selected_child.offset().top-(this.list.offset().top+this.settings.maxHeight))+$selected_child.outerHeight())},Autosuggest.prototype.destroy=function(){return $(this.settings.inputSelector).die("keyup"),$(this.settings.inputSelector).die("keydown"),$(this.settings.inputSelector).die("blur"),$(this.settings.inputSelector).die("focus")},Autosuggest}()}.call(this),function(){boundless_module("BackRails"),Function.prototype.bind&&"undefined"!=typeof console&&null!==console&&"object"==typeof console.log&&["log","info","warn","error","assert","debug","clear","profile","profileEnd"].forEach(function(method){return console[method]=this.bind(console[method],console)},Function.prototype.call),BackRails.Logger=function(){function Logger(){}return Logger.log=function(){var key,results;if("undefined"!=typeof console&&null!==console&&null!=console.log)if("object"==typeof arguments[0]&&1===arguments.length){if("object"==typeof console.dir){console.log("Object >"),results=[];for(key in arguments[0])results.push(console.log(" - "+key+": "+arguments[0][key]));return results}if(Boundless.DEBUG)return console.dir.apply(console,arguments)}else if(Boundless.DEBUG)return console.log.apply(console,arguments)},Logger.info=function(){return"undefined"!=typeof console&&null!==console&&null!=console.info&&Boundless.DEBUG?console.info.apply(console,arguments):void 0},Logger.debug=function(){return"undefined"!=typeof console&&null!==console&&null!=console.debug&&Boundless.DEBUG?console.debug.apply(console,arguments):void 0},Logger.warn=function(){return"undefined"!=typeof console&&null!==console&&null!=console.warn?console.warn.apply(console,arguments):void 0},Logger.error=function(){return"undefined"!=typeof console&&null!==console&&null!=console.error?console.error.apply(console,arguments):void 0},Logger}()}.call(this),function(){BackRails.Effect=function(){function Effect(params){$.extend(!0,this,params),this.vendor_prefix=this.detect_vendor_prefix(),this.transition_property=""===this.vendor_prefix?"transition":"-"+this.vendor_prefix+"-transition",this.transform_property=""===this.vendor_prefix?"transform":"-"+this.vendor_prefix+"-transform",this.transition_end_event="moz"===this.vendor_prefix||""===this.vendor_prefix?"transitionend":"ms"===this.vendor_prefix?"MSTransitionEnd":this.vendor_prefix.toLowerCase()+"TransitionEnd"}return Effect.prototype.detect_vendor_prefix=function(){var i,len,prop,ref,regex,some_script;if(regex=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,some_script=document.getElementsByTagName("script")[0],"WebkitOpacity"in some_script.style)return"Webkit";if("KhtmlOpacity"in some_script.style)return"Khtml";for(ref=some_script.style,i=0,len=ref.length;len>i;i++)if(prop=ref[i],regex.test(prop))return prop.match(regex)[0].toLowerCase();return""},Effect.prototype.to_transition_animation_settings=function(property){return property+" "+this.to_transition_properties.duration.toFixed(2)+"s "+this.to_transition_properties.easing+" "+this.to_transition_properties.delay.toFixed(2)+"s"},Effect.prototype.from_transition_animation_settings=function(property){return property+" "+this.from_transition_properties.duration.toFixed(2)+"s "+this.from_transition_properties.easing+" "+this.from_transition_properties.delay.toFixed(2)+"s"},Effect.prototype.transition_duration=function(){return Math.max(this.to_transition_properties.duration,this.from_transition_properties.duration)+Math.max(this.to_transition_properties.delay,this.from_transition_properties.delay)},Effect}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.FadeEffect=function(superClass){function FadeEffect(){return FadeEffect.__super__.constructor.apply(this,arguments)}return extend(FadeEffect,superClass),FadeEffect.prototype.to_transition_properties={duration:.25,easing:"linear",delay:0},FadeEffect.prototype.from_transition_properties={duration:.25,easing:"linear",delay:0},FadeEffect.prototype.play=function($from_view,$to_view,$parent_view,callback){var handle_transition_end,timeout;return this.active_transitions=0,handle_transition_end=function(_this){return function(event){return _this.active_transitions>=0&&(_this.active_transitions--,$(event.target).css(_this.transition_property,""),0===_this.active_transitions&&null!=callback)?("undefined"!=typeof timeout&&null!==timeout&&clearTimeout(timeout),"function"==typeof callback?callback():void 0):void 0}}(this),$from_view&&(this.active_transitions++,$from_view.one(this.transition_end_event,handle_transition_end),$from_view.css(this.transition_property,this.from_transition_animation_settings("opacity"))),$to_view&&(this.active_transitions++,$to_view.one(this.transition_end_event,handle_transition_end),$to_view.css("opacity",0),$to_view.css(this.transition_property,this.to_transition_animation_settings("opacity")),$to_view.css("visibility","visible")),$parent_view.css("width"),timeout=setTimeout(function(_this){return function(){return _this.active_transitions>0?(_this.active_transitions=-1,BackRails.Logger.warn(_this.transition_end_event+" didn't trigger in expected time!"),$to_view&&($to_view.off(_this.transition_end_event,handle_transition_end),$to_view.css(_this.transition_property,"")),$from_view&&($from_view.off(_this.transition_end_event,handle_transition_end),$from_view.css(_this.transition_property,"")),"function"==typeof callback?callback():void 0):void 0}}(this),1.5*this.transition_duration()*1e3),null!=$to_view&&$to_view.css("opacity",1),null!=$from_view?$from_view.css("opacity",0):void 0},FadeEffect}(BackRails.Effect)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.NoEffect=function(superClass){function NoEffect(){return NoEffect.__super__.constructor.apply(this,arguments)}return extend(NoEffect,superClass),NoEffect.prototype.play=function($from_view,$to_view,$parent_view,callback){return null!=$to_view&&$to_view.css("visibility","visible"),"function"==typeof callback?callback():void 0},NoEffect}(BackRails.Effect)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.SlideEffect=function(superClass){function SlideEffect(){return SlideEffect.__super__.constructor.apply(this,arguments)}return extend(SlideEffect,superClass),SlideEffect.prototype.direction="left",SlideEffect.prototype.to_transition_properties={duration:.35,easing:"ease-out",delay:0},SlideEffect.prototype.from_transition_properties={duration:.35,easing:"ease-out",delay:0},SlideEffect.prototype.play=function($from_view,$to_view,$parent_view,callback){var handle_transition_end,timeout,transform_value;return this.active_transitions=0,handle_transition_end=function(_this){return function(event){return _this.active_transitions>=0&&(_this.active_transitions--,0===_this.active_transitions&&null!=callback)?("undefined"!=typeof timeout&&null!==timeout&&clearTimeout(timeout),"function"==typeof callback?callback():void 0):void 0}}(this),$from_view&&(this.active_transitions++,$from_view.one(this.transition_end_event,handle_transition_end),transform_value="translate(0,0)",$from_view.css(this.transform_property,transform_value)),$to_view&&(this.active_transitions++,$to_view.one(this.transition_end_event,handle_transition_end),transform_value="translate("+("left"===this.direction?100:-100)+"%,0)",$to_view.css(this.transform_property,transform_value),$to_view.css("visibility","visible")),($from_view||$to_view)&&$parent_view.css("width"),$from_view&&(transform_value="translate("+("left"===this.direction?-100:100)+"%,0)",$from_view.css(this.transform_property,transform_value),$from_view.css(this.transition_property,this.from_transition_animation_settings(this.transform_property))),$to_view&&(transform_value="translate(0,0)",$to_view.css(this.transform_property,transform_value),$to_view.css(this.transition_property,this.to_transition_animation_settings(this.transform_property))),timeout=setTimeout(function(_this){return function(){return _this.active_transitions>0?(_this.active_transitions=-1,BackRails.Logger.warn(_this.transition_end_event+" didn't trigger in expected time!"),$to_view&&($to_view.off(_this.transition_end_event,handle_transition_end),$to_view.css(_this.transition_property,""),$to_view.css(_this.transform_property,"translate(0,0)")),$from_view&&($from_view.off(_this.transition_end_event,handle_transition_end),$from_view.css(_this.transition_property,""),$from_view.css(_this.transform_property,"")),"function"==typeof callback?callback():void 0):void 0}}(this),2500*this.transition_duration())},SlideEffect}(BackRails.Effect)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.VIEW_PATHS=["global/views"],BackRails.append_view_path=function(path){return BackRails.VIEW_PATHS.push(path)},BackRails.Controller=function(superClass){function Controller(){return this.delayed=bind(this.delayed,this),this.placeholder=bind(this.placeholder,this),this.partial=bind(this.partial,this),Controller.__super__.constructor.apply(this,arguments)}return extend(Controller,superClass),Controller.prototype.initialize=function(options){return null==options&&(options={}),Controller.__super__.initialize.apply(this,arguments),this.current_params={},this.delayed_render_regions=[],this.placeholders=[],this.subviews_initialized=[],this.rendered=!1,this.parent_controller=options.parent_controller||null,this.elements||(this.elements=this.constructor.elements),this.trigger||(this.triggers=this.constructor.triggers),this.register_triggers(),this.refresh_elements(),this.on("view:appended",function(_this){return function(){var ref;return null!=(ref=_this.parent_controller)?ref.trigger("view:appended"):void 0}}(this)),null!=this.scrollable&&this.on("sub_navigation:started",function(_this){return function(){return _this.set_scrollable_top()}}(this)),this},Controller.prototype.register_triggers=function(){return _.each(this.triggers,function(_this){return function(val,key){return _this.on(key,function(){return _this[val]()})}}(this))},Controller.prototype.refresh_elements=function(){var key,ref,results,value;ref=this.elements,results=[];for(key in ref)value=ref[key],results.push(this[value]=this.$(key));return results},Controller.prototype.delegateEvents=function(events){var eventName,eventSplitter,key,match,new_events,ref,selector,value;if(null!=this.events&&Modernizr.touch){new_events={},eventSplitter=/^(\S+)\s*(.*)$/,ref=this.events;for(key in ref)value=ref[key],match=key.match(eventSplitter),eventName=match[1],selector=match[2],selector&&"click"===eventName&&(new_events["touchstart "+selector]="_touchStart",new_events["touchend "+selector]=value),new_events[key]=value;this.events=new_events}return Controller.__super__.delegateEvents.apply(this,arguments)},Controller.prototype._touchStart=function(event){var target;return target=event.currentTarget,target.classList.add("touchactive"),this.touchStart_timeout=_.delay(function(){return target.classList.remove("touchactive")},350)},Controller.prototype.html=function(content){return this.$el.html(content),this.refresh_elements(),this.delegateEvents(),this},Controller.prototype.view=function(name,context){var template;if(null==context&&(context={}),template=this.template_function(name),null!=template)return template(this.view_context(context));throw"Could not find template: "+name},Controller.prototype.global_view_context=function(){var global_context,parent_controller;for(global_context={},"undefined"!=typeof session&&null!==session&&(global_context.current_user=session.current_user,global_context.current_session=session.current_session),parent_controller=this.parent_controller;null!=parent_controller;)global_context=parent_controller.add_helper_methods(global_context),parent_controller=parent_controller.parent_controller;return global_context},Controller.prototype.local_view_context=function(){var context;return context=this.add_helper_methods({}),context.partial=this.partial,context.delayed=this.delayed,context.placeholder=this.placeholder,context},Controller.prototype.add_helper_methods=function(context){var helper,i,len,ref;if(null!=this.helper_methods)for(ref=this.helper_methods,i=0,len=ref.length;len>i;i++)helper=ref[i],context[helper]=this[helper];return context},Controller.prototype.view_context=function(context){return null==context&&(context={}),_.extend({},this.global_view_context(),ViewHelpers,this.local_view_context(),context)},Controller.prototype.visible=function(){return null!=this.parent_controller?this.parent_controller.showing(this):!0},Controller.prototype.template_function=function(name){
var haml,i,len,path,ref;for(ref=BackRails.VIEW_PATHS,i=0,len=ref.length;len>i;i++)if(path=ref[i],haml=HAML[path+"/"+name],null!=haml)return haml},Controller.prototype.render_default=function(){return this.render()},Controller.prototype.render=function(template_name,context,callback){return null==template_name&&(template_name=this.template),null==context&&(context={}),BackRails.Logger.log("rendering "+this.constructor.name),this.html(this.view(template_name,context)),this.rendered=!0,this.trigger("render:preloaded"),null!=this.scrollable&&this.setup_scrollable(),this.delayed_render_regions.length?this.load_data(function(_this){return function(){return _this.render_delayed_regions(callback)}}(this)):this.render_delayed_regions(callback),this},Controller.prototype.post_render=function(callback){return null==callback&&(callback=null),this.$el.picturefill(),this.$el.load_images(),Modernizr.placeholder===!1&&this.$("input").placeholder(),this.delegateEvents(),this.refresh_elements(),this.trigger("render:complete"),BackRails.Logger.log("Render Complete for "+this.constructor.name),"undefined"!=typeof MathJax&&null!==MathJax&&MathJax.Hub.Queue(["Typeset",MathJax.Hub]),"function"==typeof callback?callback():void 0},Controller.prototype.once=function(event_name,callback,context){return null==context&&(context=null),this.on(event_name,function(_this){return function(){return _this.off(event_name),"function"==typeof callback?callback(arguments):void 0}}(this),context)},Controller.prototype.navigate=function(options){return null==options&&(options={}),this.can_skip_rendering(options)?(BackRails.Logger.log("render skipped for "+this.constructor.name),this.current_params=options,this.trigger("navigation:complete")):(this.current_params=options,this.render(),this.trigger("navigation:complete")),this},Controller.prototype.can_skip_rendering=function(options){return this.rendered&&(null!=this.subviews||_.isEqual(this.current_params,options))},Controller.prototype.remove=function(){return"function"==typeof this.undelegateEvents&&this.undelegateEvents(),this.trigger("removed"),Controller.__super__.remove.apply(this,arguments)},Controller.prototype.data_is_loaded=function(){return!0},Controller.prototype.load_data=function(callback){return null==callback&&(callback=null),"function"==typeof callback?callback():void 0},Controller.prototype.partial=function(template_name,context){return null==context&&(context={}),this.view(template_name,context)},Controller.prototype.placeholder=function(name,view_function){return this.placeholders[name]=view_function,""},Controller.prototype.delayed=function(){var data_loaded,dependencies,options,unique_identifier,view_function;return _.isFunction(arguments[0])?(options={},view_function=arguments[0]):(options=arguments[0],view_function=arguments[1]),unique_identifier=Math.random().toString(36),options.only?(dependencies=_.flatten([options.only]),data_loaded=_.every(dependencies,function(_this){return function(dependency){return dependency.data_loaded}}(this))):data_loaded=this.data_is_loaded(),data_loaded?(this.delayed_view=$("<div class='delayed-view on'>"+view_function.apply(this.view_context())+"</div>"),this.delayed_view.html()):(this.delayed_render_regions.push(function(_this){return function(){var $delayed_view,$placeholder;return $delayed_view=$("<div class='delayed-view on'>"+view_function.apply(_this.view_context())+"</div>"),$placeholder=_this.$el.find("div[data-placeholder-id='"+unique_identifier+"']").eq(0),$placeholder.replaceWith($delayed_view)}}(this)),this._delayed_render_markup(unique_identifier,this.placeholders[options.placeholder]))},Controller.prototype.render_delayed_regions=function(callback){var delayed_render;return null==callback&&(callback=null),(delayed_render=this.delayed_render_regions.pop())?(delayed_render(),this.render_delayed_regions()):this.is_on_dom()?this.post_render(callback):this.once("view:appended",function(_this){return function(){return _this.post_render(callback)}}(this))},Controller.prototype._delayed_render_markup=function(unique_identifier,placeholder_view){var placeholder_inner_content;return null==placeholder_view&&(placeholder_view=null),placeholder_inner_content=null!=placeholder_view?placeholder_view.apply(this.view_context()):"<div class='delayed-render-loader'> <div> <i class='icon-spinner icon-spin'></i> Loading\u2026 </div> </div>","<div class='delayed-render-placeholder' data-placeholder-id='"+unique_identifier+"'> "+placeholder_inner_content+" </div>"},Controller.prototype.content_for=function(selector,view_function){return this.$(selector).html($(""+view_function.apply())),null},Controller.prototype.isIE=function(){return/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())?!0:!1},Controller.prototype.get_browser_name=function(){var ua;return ua=navigator.userAgent.toLowerCase(),/(webkit)[ \/]([\w.]+)/.exec(ua)?"webkit":/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)?"opera":/(msie) ([\w.]+)/.exec(ua)?"msie":ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)?"mozilla":ua},Controller.prototype.get_browser_version=function(){var M,N,tem,ua;return N=navigator.appName,ua=navigator.userAgent,tem=void 0,M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),M&&null!=(tem=ua.match(/version\/([\.\d]+)/i))&&(M[2]=tem[1]),M=M?[M[1],M[2]]:[N,navigator.appVersion,"-?"],M[1]},Controller.prototype.setup_scrollable=function(){return null!=this.scrollable?this.scrollable.on("scroll",function(_this){return function(){return clearTimeout(_this.scrollable_timeout),_this.scrollable_timeout=setTimeout(function(){return _this.scroll_top=_this.scrollable.scrollTop()},150)}}(this)):void 0},Controller.prototype.set_scrollable_top=function(){return this.scrollable.scrollTop(this.scroll_top)},Controller.prototype.is_on_dom=function(){return $.contains(document.documentElement,this.el)},Controller.prototype.parent_stackpath=function(){return this.parent_controller?this.parent_controller.current_stack.join("/"):BackRails.Logger.error("No parent.")},Controller.prototype.notify_screen_readers=function(message){return boundless.require("boundless.shared").notifyScreenReaders(message)},Controller}(Backbone.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.ModalController=function(superClass){function ModalController(){return this.hide=bind(this.hide,this),ModalController.__super__.constructor.apply(this,arguments)}return extend(ModalController,superClass),ModalController.prototype.el="#modal-body",ModalController.prototype.initialize=function(options){return null==options&&(options={}),ModalController.__super__.initialize.apply(this,arguments),options.header_text&&(this.header_text=options.header_text),options.template?this.template=options.template:void 0},ModalController.prototype.render=function(callback){return this.header_text&&$("#modal_header_text").html(this.header_text),this.html(this.view(this.template)),"function"==typeof callback&&callback(),ModalController.__super__.render.apply(this,arguments)},ModalController.prototype.show=function(){return $("#modal").modal("show")},ModalController.prototype.hide=function(){return $("#modal").modal("hide")},ModalController}(BackRails.Controller)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.NavigationController=function(superClass){function NavigationController(){return NavigationController.__super__.constructor.apply(this,arguments)}return extend(NavigationController,superClass),NavigationController.prototype.sub_view_container_selector=null,NavigationController.prototype.sub_controllers={},NavigationController.prototype.default_push_transition_properties={},NavigationController.prototype.default_pop_transition_properties={},NavigationController.prototype.initialize=function(options){return null==options&&(options={}),this.current_stack=[],this.stack=[],this.action_queue=[],this.active_controller=null,this.parent_controller=null,this.default_pop_transition||(this.default_pop_transition=new BackRails.NoEffect(this.default_pop_transition_properties)),this.default_push_transition||(this.default_push_transition=new BackRails.NoEffect(this.default_push_transition_properties)),NavigationController.__super__.initialize.call(this,options)},NavigationController.prototype.render=function(){if(NavigationController.__super__.render.apply(this,arguments),this.sub_view_container_selector){if(this.$subview_el=this.$el.find(this.sub_view_container_selector).eq(0),null==this.$subview_el)throw"Sub view container not found"}else this.$subview_el=this.$el;return null==this.sub_view_container_scrollable&&this.$subview_el.css({overflow:"hidden"}),this},NavigationController.prototype.navigate=function(options){return null==options&&(options={}),this.can_skip_rendering(options)?(BackRails.Logger.log("render skipped for "+this.constructor.name),this.current_params=options,this.trigger("navigation:complete")):(this.current_params=options,this.pop_all({transition:!1,silent:!0}),this.data_is_loaded()?this.load_data(function(_this){return function(){return _this.render(),_this.trigger("navigation:complete")}}(this)):(this.render(),this.trigger("navigation:complete"))),this},NavigationController.prototype.can_skip_rendering=function(params){return this.rendered},NavigationController.prototype.update_stack=function(stack,options){var stack_name,sub_controller;return null==options&&(options={}),BackRails.Logger.log("Update Stack (Navigation) for "+this.constructor.name),this.rendered||this.navigate(options),this.current_stack=stack,stack_name=stack[0],sub_controller=this.controller_matches_stack_name(this.stack[0],stack_name)?this.stack[0]:this.sub_controller_from(stack_name),sub_controller?(BackRails.Logger.log("navigation:complete setup for "+sub_controller.constructor.name),sub_controller.once("navigation:complete",function(_this){return function(){var ref;return BackRails.Logger.log("navigation:complete logged for "+sub_controller.constructor.name),null!=(ref=_this.active_controller)&&ref.trigger("sub_navigation:complete"),sub_controller.visible()?_this.stack_noop():_this.change_to(sub_controller,{transition:_this.visible()})}}(this)),sub_controller.navigate(options)):BackRails.Logger.error("Could not find a sub_controller called: "+stack_name)},NavigationController.prototype.sub_controller_from=function(stack_name,params){var controller,controller_class;return null==params&&(params={}),(controller_class=this.controller_class_for_stack_name(stack_name))?(controller=new controller_class(params),controller.parent_controller=this,controller):!1},NavigationController.prototype.controller_class_for_stack_name=function(stack_name){var controller_class_name;return(controller_class_name=this.sub_controllers[stack_name])?eval(controller_class_name):void 0},NavigationController.prototype.controller_matches_stack_name=function(controller,stack_name){var controller_class;return(controller_class=this.controller_class_for_stack_name(stack_name))?controller instanceof controller_class:(BackRails.Logger.error("Could not find a sub_controller called: "+stack_name),!1)},NavigationController.prototype.change_to=function(sub_controller,options){return null==options&&(options={}),this.push_controller(sub_controller,options)},NavigationController.prototype.visible=function(){return null!=this.parent_controller?this.parent_controller.showing(this):!0},NavigationController.prototype.showing=function(controller){return this.active_controller===controller},NavigationController.prototype.check_action_queue=function(){var action,args;return this.action_queue.splice(0,1),this.action_queue.length>0?(action=this.action_queue[0],args=Array.prototype.slice.call(action.args),this[action.fn].apply(this,args)):void 0},NavigationController.prototype.remove=function(){return this.pop_all({transition:!1,silent:!0}),NavigationController.__super__.remove.apply(this,arguments)},NavigationController.prototype.push_controller=function(controller,options){return null==options&&(options={}),this.action_queue.push({fn:"_push_controller",args:arguments}),1===this.action_queue.length?this._push_controller(controller,options):void 0},NavigationController.prototype.pop_controller=function(options){return null==options&&(options={}),this.action_queue.push({fn:"_pop_controller",args:arguments}),1===this.action_queue.length?this._pop_controller(options):void 0},NavigationController.prototype.pop_all=function(options){return null==options&&(options={}),this.action_queue.push({fn:"_pop_all",args:arguments}),1===this.action_queue.length?this._pop_all(options):void 0},NavigationController.prototype.replace_controller=function(controller,options){return null==options&&(options={}),this.action_queue.push({fn:"_replace_controller",args:arguments}),1===this.action_queue.length?this._replace_controller(controller,options):void 0},NavigationController.prototype.replace_all=function(controller,options){return null==options&&(options={}),this.action_queue.push({fn:"_replace_all",args:arguments}),1===this.action_queue.length?this._replace_all(controller,options):void 0},NavigationController.prototype.pop_many=function(num_to_pop,options){return null==options&&(options={}),this.action_queue.push({fn:"_pop_many",args:arguments}),1===this.action_queue.length?this._pop_many(num_to_pop,options):void 0},NavigationController.prototype.stack_noop=function(){},NavigationController.prototype._push_controller=function(to_controller,options){var from_controller;return null==options&&(options={}),from_controller=_.last(this.stack),this.trigger("stack:changing",{action:"push",to_controller:to_controller,from_controller:from_controller}),this._push(from_controller,to_controller,0,options)},NavigationController.prototype._pop_controller=function(options){var from_controller,to_controller;return null==options&&(options={}),this.stack.length?(from_controller=_.last(this.stack),to_controller=this.stack.length>1?this.stack[this.stack.length-2]:null,this.trigger("stack:changing",{action:"pop",to_controller:to_controller,from_controller:from_controller}),this._pop(from_controller,to_controller,1,options)):this.check_action_queue()},NavigationController.prototype._pop_all=function(to_controller,options){var from_controller;return null==options&&(options={}),this.stack.length?(from_controller=_.last(this.stack),this.trigger("stack:changing",{action:"pop_all",to_controller:null,from_controller:from_controller}),this._pop(from_controller,null,this.stack.length,options)):this.check_action_queue()},NavigationController.prototype._replace_controller=function(to_controller,options){var from_controller;return null==options&&(options={}),this.stack.length?(from_controller=_.last(this.stack),this.trigger("stack:changing",{action:"replace",to_controller:to_controller,from_controller:from_controller}),this._push(from_controller,to_controller,1,options)):this.check_action_queue()},NavigationController.prototype._replace_all=function(to_controller,options){var from_controller;return null==options&&(options={}),this.stack.length?(from_controller=_.last(this.stack),this.trigger("stack:changing",{action:"replace_all",to_controller:to_controller,from_controller:from_controller}),this._push(from_controller,to_controller,this.stack.length,options)):this.check_action_queue()},NavigationController.prototype._pop_many=function(num_to_pop,options){var from_controller,to_controller;return null==options&&(options={}),this.stack.length?(num_to_pop>this.stack.length&&(num_to_pop=this.stack.length),to_controller=num_to_pop===this.stack.length?null:this.stack[this.stack.length-1-num_to_pop],from_controller=_.last(this.stack),this.trigger("stack:changing",{action:"pop_many",to_controller:to_controller,from_controller:from_controller}),this._pop(from_controller,to_controller,num_to_pop,options)):this.check_action_queue()},NavigationController.prototype._push=function(from_controller,to_controller,remove_count,options){var transition;return null==options&&(options={}),this._append_view(to_controller),options.silent||(options.silent=!1),options.transition=options.transition===!1?new BackRails.NoEffect:options.transition,options.transition=options.transition===!0?this.default_push_transition:options.transition,options.remove_from=options.remove_from===!1?!1:!0,transition=options.transition||this.default_push_transition,options.silent||this.trigger("stack:length_change",this.stack.length-remove_count+1),transition.play(null!=from_controller?from_controller.$el:void 0,to_controller.$el,this.$subview_el,function(_this){return function(){var remove;return remove=remove_count>0?_this.stack.splice(_this.stack.length-remove_count,remove_count).reverse():from_controller?[from_controller]:null,null!=remove&&_.each(remove,function(controller){return _this._push_remove_controller(controller,options)}),_this.stack.push(to_controller),_this.active_controller=to_controller,to_controller.trigger("stack:after_top"),_this.check_action_queue()}}(this))},NavigationController.prototype._push_remove_controller=function(controller,options){return controller.trigger("stack:before_remove"),"never"!==controller.destruction_policy&&options.remove_from?(controller.remove(),controller.trigger("stack:after_remove"),controller=null):controller.$el.detach()},NavigationController.prototype._pop=function(from_controller,to_controller,remove_count,options){var transition;return null==options&&(options={}),null!=to_controller&&this._append_view(to_controller),options.silent=!1,options.transition=options.transition===!1?new BackRails.NoEffect:options.transition,options.transition=options.transition===!0?this.default_pop_transition:options.transition,transition=options.transition||this.default_pop_transition,options.silent||this.trigger("stack:length_change",this.stack.length-remove_count),null!=to_controller&&to_controller.trigger("stack:pop:before_transition"),transition.play(from_controller.$el,null!=to_controller?to_controller.$el:void 0,this.$subview_el,function(_this){return function(){var remove;return remove=_this.stack.splice(_this.stack.length-remove_count,remove_count).reverse(),_.each(remove,function(controller){return _this._pop_remove_controller(controller,options)}),null!=to_controller?(_this.active_controller=to_controller,to_controller.trigger("stack:pop:after_transition")):_this.active_controller=null,_this.check_action_queue()}}(this))},NavigationController.prototype._pop_remove_controller=function(controller,options){return controller.trigger("stack:before_remove"),BackRails.Logger.log("Doing Before Remove POP"),"never"===controller.destruction_policy?controller.$el.detach():(BackRails.Logger.log("REMOVING",controller),controller.remove(),controller.trigger("stack:after_remove"),controller=null)},NavigationController.prototype._append_view=function(controller){return controller.__navigatorRendered__?controller.$el.css({visibility:"hidden"}):("undefined"==typeof controller.destruction_policy&&(controller.destruction_policy="auto"),controller.$el.addClass("bR--appended-view").delay(350).addClass("on")),this.$subview_el.append(controller.el),controller.is_on_dom()&&controller.trigger("view:appended"),controller.__navigatorRendered__?void 0:controller.__navigatorRendered__=!0},NavigationController}(BackRails.Controller)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.Router=function(superClass){function Router(){Router.__super__.constructor.apply(this,arguments),$.ajaxSetup({beforeSend:function(xhr,settings){return"html"!==settings.dataType?xhr.setRequestHeader("accept","application/json"):void 0},error:function(_this){return function(jqXHR,ajaxSettings,thrownError){return BackRails.Logger.error(thrownError)}}(this)})}return extend(Router,superClass),Router}(Backbone.Router)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.SheetController=function(superClass){function SheetController(options){var sheet_class;null==options&&(options={}),this.remove=bind(this.remove,this),this.hide=bind(this.hide,this),this.show=bind(this.show,this),this.render=bind(this.render,this),this.$body=$body||$("body"),this.$the_universe=$(".the-solar-system"),this.container=options.container?options.container:$body,sheet_class=["sheet-wrapper"],this.className&&sheet_class.push(this.className),this.close=$("<i class='icon-remove sheet-close trigger'></i>"),this.inner=$("<div class='sheet-inner' style='max-width: "+this.max_width+"'><div class='sheet-content' /></div>"),this.wrapper=$("<div class='"+sheet_class.join(" ")+"'></div>"),this.curtain=$("<div class='sheet-curtain scrollable'></div>"),this.curtain.click(function(_this){return function(e){return e.target===_this.curtain.get(0)?_this.hide_and_remove():void 0}}(this)),this.wrapper.click(function(_this){return function(e){return e.target===_this.wrapper.get(0)?_this.hide_and_remove():void 0}}(this)),this.close.click(function(_this){return function(e){return _this.hide_and_remove()}}(this)),this.container.append(this.curtain.append(this.wrapper.append(this.inner.append(this.close)))),this.el=".sheet-content",SheetController.__super__.constructor.apply(this,arguments)}return extend(SheetController,superClass),SheetController.prototype.curtain_transition_time=150,SheetController.prototype.container_transition_time=350,SheetController.prototype.max_width="800px",SheetController.prototype.render=function(callback){return this.html(this.view(this.template)),this.curtain.addClass("on"),events.on("sheet:hide_and_remove",function(_this){return function(){return _this.hide_and_remove()}}(this)),SheetController.__super__.render.apply(this,arguments),"function"==typeof callback&&callback(),this},SheetController.prototype.show=function(callback){return this.$body.addClass("showing-sheet"),setTimeout(function(_this){return function(){return _this.curtain.addClass("show"),setTimeout(function(){return _this.curtain.addClass("show-wrapper")},_this.curtain_transition_time)}}(this),10),"function"==typeof callback&&callback(),this},SheetController.prototype.hide=function(callback){return this.$body.removeClass("showing-sheet"),this.curtain.removeClass("show-wrapper"),setTimeout(function(_this){return function(){return _this.curtain.removeClass("show"),setTimeout(function(){return"function"==typeof callback?callback():void 0},_this.curtain_transition_time)}}(this),this.container_transition_time),this},SheetController.prototype.remove=function(callback){return events.off("sheet:hide_and_remove"),SheetController.__super__.remove.apply(this,arguments),"function"==typeof callback&&callback(),this.curtain.remove(),this},SheetController.prototype.hide_and_remove=function(e){return this.hide(this.remove)},SheetController}(BackRails.Controller)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.StackController=function(superClass){function StackController(){return StackController.__super__.constructor.apply(this,arguments)}return extend(StackController,superClass),StackController.prototype.className="stack-showing-root",StackController.prototype.default_push_transition_properties={direction:"left"},StackController.prototype.default_pop_transition_properties={direction:"right"},StackController.prototype.initialize=function(params){return this.current_params={},this.previous_stack=[],this.previous_params={},this.isIE()?(this.default_push_transition=new BackRails.NoEffect,this.default_pop_transition=new BackRails.NoEffect):(this.default_push_transition=new BackRails.SlideEffect(this.default_push_transition_properties),this.default_pop_transition=new BackRails.SlideEffect(this.default_pop_transition_properties)),this.on("stack:length_change",function(stack_finish_length){return this.previous_class=this.current_class||"",this.current_class=this.constructor.name+"__"+_.last(this.current_stack),2>stack_finish_length?this.$el.removeClass("stack-showing-depth "+this.previous_class).addClass("stack-showing-root "+this.current_class):this.$el.removeClass("stack-showing-root "+this.previous_class).addClass("stack-showing-depth "+this.current_class)}),StackController.__super__.initialize.apply(this,arguments)},StackController.prototype.update_stack=function(stack,options){var controller,first_load,i,index,is_last,len,ref,results,stack_name;for(null==options&&(options={}),BackRails.Logger.log("Update Stack (Stack) for "+this.constructor.name),this.rendered||this.navigate(options),first_load=0===this.current_stack.length,this.previous_stack=this.current_stack,this.previous_params=this.current_params,this.current_stack=stack,this.current_params=options,ref=this.current_stack,results=[],index=i=0,len=ref.length;len>i;index=++i)stack_name=ref[index],is_last=index===this.current_stack.length-1,this.controller_matches_stack_name(this.stack[index],stack_name)?(controller=this.stack[index],is_last&&controller.once("navigation:complete",function(_this){return function(){var num_to_pop;return _.last(_this.stack)!==controller?(num_to_pop=_this.stack.length-_.indexOf(_this.stack,controller)-1,BackRails.Logger.log("POPPING MANY"),_this.pop_many(num_to_pop,{transition:_this.visible()})):(BackRails.Logger.log(controller.constructor.name+" is on top, noop"),_this.stack_noop(),IosManager.is_ios_6()&&IosManager.is_ios_app()&&"undefined"!=typeof Pace&&null!==Pace?_this.interval_timer=setInterval(function(){return Pace.running?Pace.restart():clearInterval(_this.interval_timer)},2e3):void 0)}}(this))):(controller=this.sub_controller_from(stack_name),null!=this.stack[index]&&this.pop_many(this.stack.length-index,{silent:!0,transition:!1}),is_last?controller.once("navigation:complete",function(_this){return function(){return _this.push_controller(controller,{transition:_this.visible()&&!first_load&&0!==index,remove_from:!1}),setTimeout(function(){return _this.trigger("stack:fully_loaded")},450*_this.stack.length)}}(this)):this.push_controller(controller,{silent:!0,transition:!1,remove_from:!1})),controller.navigate(options),results.push(controller.trigger("sub_navigation:started"));return results},StackController.prototype.navigate_back=function(){return this.current_stack.length>1?this.update_stack(this.current_stack.slice(0,+(this.current_stack.length-2)+1||9e9),this.current_params):void 0},StackController.prototype.navigate_previous=function(){return this.previous_stack.length>0?this.update_stack(this.previous_stack,this.previous_params):void 0},StackController}(BackRails.NavigationController)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.TabController=function(superClass){function TabController(){return TabController.__super__.constructor.apply(this,arguments)}return extend(TabController,superClass),TabController.prototype.initialize=function(params){return this.default_push_transition=new BackRails.FadeEffect(this.default_push_transition_properties),this.default_pop_transition=new BackRails.FadeEffect(this.default_pop_transition_properties),TabController.__super__.initialize.apply(this,arguments)},TabController.prototype.change_to=function(sub_controller,options){return null==options&&(options={}),this.stack.length?this.replace_all(sub_controller,options):this.push_controller(sub_controller,options)},TabController}(BackRails.NavigationController)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.Model=function(superClass){function Model(){return Model.__super__.constructor.apply(this,arguments)}return extend(Model,superClass),Model.prototype.validation_defaults={allow_blank:!0,allow_null:!0},Model.prototype.initialize=function(attrs,options){return null==attrs&&(attrs={}),null==options&&(options={}),this.errors=new BackRails.ModelErrors,this.on_loaded_callbacks=[],this.data_loaded=!1,Model.__super__.initialize.apply(this,arguments),this.serialization_keys={},this.parse_relations=null!=options.parse_relations?options.parse_relations:!0,this.setup_relations(),this.on("sync",function(_this){return function(){return _this.setup_relations()}}(this)),this.on("loaded",function(_this){return function(){return _this.setup_relations(),_this.model_reset()}}(this)),this.register_members(),this},Model.prototype.register_members=function(){var endpoint,name,ref,results;if(this.members){if("Array"===TypeHelper.get_type(this.members))return this.members.forEach(function(_this){return function(endpoint){return _this[endpoint]=function(params){return Backbone.Model.prototype.fetch.call(this,_.extend({url:this.url()+"/"+endpoint},params))}}}(this));if("Object"===TypeHelper.get_type(this.members)){ref=this.members,results=[];for(name in ref)endpoint=ref[name],results.push(this[name]=function(params){return Backbone.Model.prototype.fetch.call(this,_.extend({url:this.url()+"/"+endpoint},params))});return results}}},Model.prototype.class_name=function(){return TypeHelper.get_type(this)},Model.prototype.is_a=function(type){var my_type;return my_type=this.class_name().toLowerCase(),my_type===type},Model.prototype.parse=function(response){var name,ref,relation_options;if(response=null!=(null!=response?response.data:void 0)?response.data:response,this.parse_relations){ref=this.relations;for(name in ref)relation_options=ref[name],response[name+"_attributes"]=response[name],delete response[name]}return response},Model.prototype.collection_index=function(){return null!=this.collection?this.collection.indexOf(this):"function"==typeof this.parent_collection?this.parent_collection().indexOf(this):void 0},Model.prototype.set=function(attrs,options){return null==options&&(options={}),"object"==typeof attrs&&_.each(attrs,function(_this){return function(val,key){return null!=_this.errors?_this.errors.remove(key):void 0}}(this)),Model.__super__.set.call(this,attrs,options)},Model.prototype.get_date=function(field,format){var date;return null==format&&(format=null),(date=moment(this.get(field))).isValid()?format?date.format(format):date:void 0},Model.prototype.fetch=function(options){var error_handler,success_handler;return null==options&&(options={}),success_handler=options.success,error_handler=options.error,options.success=function(_this){return function(){return _this.trigger("loaded"),_this.trigger("sync"),"function"==typeof success_handler?success_handler(_this,{}):void 0}}(this),options.error=function(_this){return function(obj,response,request_options){return"function"==typeof error_handler?error_handler(_this,response,request_options):void 0}}(this),Model.__super__.fetch.call(this,options)},Model.prototype.save=function(attrs,options){var error_handler,key,success_handler,value;if(null==attrs&&(attrs={}),null==options&&(options={}),this.set(attrs,{silent:!0}),error_handler=options.error,success_handler=options.success,this.isValid()){for(key in attrs)value=attrs[key],this.trigger("change:"+key,this,value);return this.trigger("change",this),Model.__super__.save.call(this,{},_.extend(options,{success:function(_this){return function(model,response,success_options){return _this.trigger("sync",_this,response,success_options),
"function"==typeof success_handler?success_handler(_this,response,success_options):void 0}}(this),error:function(_this){return function(model,response){var errors,field,json_response,messages;if(422===response.status){json_response=JSON.parse(response.responseText),errors=json_response.errors;for(field in errors)messages=errors[field],null!=field&&_this.errors.add(field,_.isArray(messages)?messages.join(", "):messages)}return"function"==typeof error_handler?error_handler(_this,json_response):void 0}}(this)}))}return this.trigger("invalid"),"function"==typeof error_handler?error_handler(this,{}):void 0},Model.prototype.destroy=function(options){var error_handler;return null==options&&(options={}),error_handler=options.error,options.error=function(_this){return function(obj,response,request_options){return"function"==typeof error_handler?error_handler(_this,response):void 0}}(this),Model.__super__.destroy.call(this,options)},Model.prototype.validate=function(attrs){return this.errors&&!this.errors.is_empty()?"Errors On Model":void 0},Model.prototype.validates_url=function(attrs,field,options){var regex;if(null==options&&(options={}),options=_.extend({},this.validation_defaults,options),options.message||(options.message="should be a valid url"),null!=this.errors){if(regex=/\b(https?|ftp|file):\/\/[\-A-Za-z0-9+&@#\/%?=~_|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_|\u200c\u200b]/,null!=attrs[field]&&""!==attrs[field])return regex.test(attrs[field])?this.errors.remove(field):this.errors.add(field,options.message);if(!options.allow_null&&null==attrs[field]||!options.allow_blank&&""===attrs[field])return this.errors.add(field,options.message)}},Model.prototype.validates_boolean=function(attrs,field,options){return null==options&&(options={}),options=_.extend({},this.validation_defaults,options),options.must_be||(options.must_be=!0),options.message||(options.message="must be true"),null!=this.errors?null!=attrs[field]&&attrs[field]===options.must_be?this.errors.remove(field):this.errors.add(field,options.message):void 0},Model.prototype.validates_email=function(attrs,field,options){var emailRegex;if(null==options&&(options={}),options=_.extend({},this.validation_defaults,options),options.message||(options.message="should be a valid email address"),null!=this.errors){if(emailRegex=/\S+\@\S+\.\S+/,null!=attrs[field]&&""!==attrs[field])return emailRegex.test(attrs[field])?this.errors.remove(field):this.errors.add(field,options.message);if(!options.allow_null&&null==attrs[field]||!options.allow_blank&&""===attrs[field])return this.errors.add(field,options.message)}},Model.prototype.validates_integer=function(attrs,field,options){var int_value,max_value,min_value;return null==options&&(options={}),options=_.extend({},this.validation_defaults,options),int_value=parseInt(attrs[field]),max_value=options.max||Number.MAX_VALUE,min_value=options.min||Number.MIN_VALUE,options.message||(options.message="must be a number"),null!=this.errors?isNaN(int_value)?this.errors.add(field,options.message):int_value>max_value?this.errors.add(field,"must be \u2264 "+max_value):min_value>int_value?this.errors.add(field,"must be \u2265 "+min_value):this.errors.remove(field):void 0},Model.prototype.validates_date_string=function(attrs,field,options){var d,date_format,dd,mm,ref,yyyy;if(null==options&&(options={}),options=_.extend({},this.validation_defaults,options),date_format=options.format||"MM/DD/YYYY",options.message||(options.message="should be formatted "+date_format),null!=this.errors){if(null!=attrs[field]&&""!==attrs[field])return ref=attrs[field].split("/"),mm=ref[0],dd=ref[1],yyyy=ref[2],d=moment([mm,dd,yyyy],date_format),d.isValid()?options.after&&d<moment(options.after,date_format)?this.errors.add(field,"should be after "+options.after):this.errors.remove(field):this.errors.add(field,options.message);if(!options.allow_null&&null==attrs[field]||!options.allow_blank&&""===attrs[field])return this.errors.add(field,options.message)}},Model.prototype.validates_presence_of=function(attrs,field,options){return null==options&&(options={}),options=_.extend({},this.validation_defaults,options),options.message||(options.message="can't be blank"),null!=this.errors?!options.allow_null&&null==attrs[field]||!options.allow_blank&&""===attrs[field]?this.errors.add(field,options.message):this.errors.remove(field):void 0},Model.prototype.validates_inclusion_of=function(attrs,field,options){if(null==options&&(options={}),options=_.extend({},this.validation_defaults,options),null==options["in"]&&raise("validate_inclusion_of requires option 'in' set to an array of valid values"),options.message||(options.message="is invalid"),null!=this.errors){if(null!=attrs[field]&&""!==attrs[field])return _.indexOf(options["in"],attrs[field])>-1?this.errors.remove(field):this.errors.add(field,options.message);if(!options.allow_null&&null==attrs[field]||!options.allow_blank&&""===attrs[field])return this.errors.add(field,options.message)}},Model.prototype.on_loaded=function(options,callback){return null==options&&(options={}),_.isFunction(options)&&(callback=options,options={}),this.on_loaded_callbacks.push(callback),this.data_loaded?this.fire_on_loaded_callbacks():this.fetch(options)},Model.prototype.model_reset=function(){return this.data_loaded||(this.data_loaded=!0),this.fire_on_loaded_callbacks()},Model.prototype.fire_on_loaded_callbacks=function(){var callback;return(callback=this.on_loaded_callbacks.pop())?(callback(this),this.fire_on_loaded_callbacks()):void 0},Model.prototype.setup_relations=function(){var ids_to_add,ids_to_remove,ids_to_update,klass,name,new_data_ids,old_data_ids,parsed_attrs,ref,relation_attributes,relation_options,results,reverse_relation,serialize_as;if(this.relations&&this.parse_relations){ref=this.relations,results=[];for(name in ref)relation_options=ref[name],"Object"===TypeHelper.get_type(relation_options)?(reverse_relation=relation_options.reverse_relation,serialize_as=relation_options.serialize_as,klass=eval(relation_options.klass)):"String"===TypeHelper.get_type(relation_options)?klass=eval(relation_options):Boundless.Logger.error("Invalid relations definition on "+this),relation_attributes=this.get(name+"_attributes")||this.get(name),this.get(name)instanceof klass?this.get(name)instanceof BackRails.Collection?relation_attributes instanceof BackRails.Collection?results.push(void 0):(new_data_ids=_.pluck(relation_attributes,"id"),old_data_ids=this.get(name).pluck("id"),ids_to_remove=_.difference(old_data_ids,new_data_ids),ids_to_add=_.difference(new_data_ids,old_data_ids),ids_to_update=_.intersection(old_data_ids,new_data_ids),_.each(ids_to_remove,function(_this){return function(id){return _this.get(name).remove(_this.get(name).get(id))}}(this)),results.push(_.each(relation_attributes,function(_this){return function(model_attrs){var model,parsed_attrs;if(_.contains(ids_to_update,model_attrs.id)){if(model=_this.get(name).get(model_attrs.id))return parsed_attrs=model.parse(model_attrs),model.set(parsed_attrs),model.setup_relations()}else if(_.contains(ids_to_add,model_attrs.id))return _this.get(name).add(model_attrs)}}(this)))):relation_attributes instanceof BackRails.Model?results.push(void 0):(parsed_attrs=this.get(name).parse(relation_attributes),this.get(name).set(parsed_attrs),results.push(this.get(name).setup_relations())):(this.set(name,new klass(relation_attributes)),null!=serialize_as&&(this.serialization_keys[name]=serialize_as),null!=reverse_relation?this.get(name)instanceof BackRails.Collection?(this.get(name).each(function(_this){return function(model){return model.set(reverse_relation,_this)}}(this)),results.push(this.get(name)[reverse_relation]=this)):results.push(this.get(name).set(reverse_relation,this)):results.push(void 0));return results}},Model.prototype.toJSON=function(){var name,ref,replacement,result;result=Model.__super__.toJSON.apply(this,arguments),ref=this.serialization_keys;for(name in ref)replacement=ref[name],result[replacement]=result[name],delete result[name];return result},Model.generate_guid=function(){var _p8;return _p8=function(s){var p;return p=(Math.random().toString(16)+"000000000").substr(2,8),s?"-"+p.substr(0,4)+"-"+p.substr(4,4):p},_p8()+_p8(!0)+_p8(!0)+_p8()},Model}(Backbone.Model)}.call(this),function(){BackRails.ModelErrors=function(){function ModelErrors(){this.errors={}}return ModelErrors.prototype.is_empty=function(){var x;for(x in this.errors)return!1;return!0},ModelErrors.prototype.on=function(field){return this.errors[field]},ModelErrors.prototype.messageFor=function(field){var message;return message=this.errors[field],message.isCapitalized()?message:field.humanize().capitalize()+" "+message},ModelErrors.prototype.add=function(field,error){return this.errors[field]=error},ModelErrors.prototype.reset=function(){return this.errors={}},ModelErrors.prototype.remove=function(field){return delete this.errors[field]},ModelErrors.prototype.each=function(callback){return _.each(this.errors,callback)},ModelErrors}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;BackRails.Collection=function(superClass){function Collection(){return Collection.__super__.constructor.apply(this,arguments)}return extend(Collection,superClass),Collection.prototype.parse=function(response){return _.isArray(response.results)?response.results:response},Collection.prototype.initialize=function(){return this.on_loaded_callbacks=[],this.data_loaded=!1,this.attributes={},this.on("reset",this.collection_synced,this),this.on("sync",this.collection_synced,this),Collection.__super__.initialize.apply(this,arguments),this.register_collection_endpoints(),this},Collection.prototype.register_collection_endpoints=function(){var endpoint,name,ref,results;if(this.collection_endpoints){if("Array"===TypeHelper.get_type(this.collection_endpoints))return this.collection_endpoints.forEach(function(_this){return function(endpoint){return _this[endpoint]=function(params){return Backbone.Collection.prototype.fetch.call(_.extend({url:this.url()+"/"+endpoint},params))}}}(this));if("Object"===TypeHelper.get_type(this.collection_endpoints)){ref=this.collection_endpoints,results=[];for(name in ref)endpoint=ref[name],results.push(this[name]=function(params){return Backbone.Collection.prototype.fetch.call(_.extend({url:this.url()+"/"+endpoint},params))});return results}}},Collection.prototype.on_loaded=function(options,callback){return null==options&&(options={}),_.isFunction(options)&&(callback=options,options={}),this.on_loaded_callbacks.push(callback),this.data_loaded?this.fire_on_loaded_callbacks():this.fetch(options)},Collection.prototype.collection_synced=function(){return this.data_loaded||(this.data_loaded=!0),this.fire_on_loaded_callbacks()},Collection.prototype.fire_on_loaded_callbacks=function(){var callback;return(callback=this.on_loaded_callbacks.pop())?(callback(this),this.fire_on_loaded_callbacks()):void 0},Collection.prototype.get_attribute=function(attribute){return this.attributes[attribute]},Collection.prototype.set_view=function(view){var my_proto;return my_proto=Object.getPrototypeOf(this),my_proto.view=view},Collection.prototype.set_from_form_values=function(form_array){var fields,i,len,results;for(results=[],i=0,len=form_array.length;len>i;i++)fields=form_array[i],results.push(this.get(fields.id).set(_.omit(fields,"id")));return results},Collection.prototype.set_attributes=function(attributes,attr_value){var key,results,value;switch(null==attributes&&(attributes={}),null==attr_value&&(attr_value=""),typeof attributes){case"object":results=[];for(key in attributes)value=attributes[key],results.push(this.attributes[key]=value);return results;case"string":return this.attributes[attributes]=attr_value;default:return BackRails.Logger.warn("Unable to set attributes on "+this+". Check your syntax.")}},Collection}(Backbone.Collection)}.call(this),function(){}.call(this),function(){window.KeyCode={BACKSPACE:8,TAB:9,ENTER:13,SHIFT:16,CTRL:17,ALT:18,PAUSE:19,CAPS_LOCK:20,ESCAPE:27,SPACE:32,PAGE_UP:33,PAGE_DOWN:34,END:35,HOME:36,LEFT:37,UP:38,RIGHT:39,DOWN:40,INSERT:45,DELETE:46,0:48,1:49,2:50,3:51,4:52,5:53,6:54,7:55,8:56,9:57,COLON:58,"@":64,A:65,B:66,C:67,D:68,E:69,F:70,G:71,H:72,I:73,J:74,K:75,L:76,M:77,N:78,O:79,P:80,Q:81,R:82,S:83,T:84,U:85,V:86,W:87,X:88,Y:89,Z:90,LEFT_WINDOW:91,RIGHT_WINDOW:92,SELECT:93,NUMPAD0:96,NUMPAD1:97,NUMPAD2:98,NUMPAD3:99,NUMPAD4:100,NUMPAD5:101,NUMPAD6:102,NUMPAD7:103,NUMPAD8:104,NUMPAD9:105,MULTIPLY:106,ADD:107,SUBTRACT:109,DECIMAL:110,DIVIDE:111,F1:112,F2:113,F3:114,F4:115,F5:116,F6:117,F7:118,F8:119,F9:120,F10:121,F11:122,F12:123,NUM_LOCK:144,SCROLL_LOCK:145,SEMI_COLON:186,EQUAL_SIGN:187,COMMA:188,DASH:189,PERIOD:190,FORWARD_SLASH:191,BACKTICK:192,OPEN_BRACKET:219,BACK_SLASH:220,CLOSE_BRAKET:221,SINGLE_QUOTE:222}}.call(this),function(){Boundless.LinkHelper||(Boundless.LinkHelper={}),Boundless.LinkHelper.handle_link=function(link,fallback_link){var error,error1,href;if(null==fallback_link&&(fallback_link=null),link.data("redirect-callback"))try{eval(link.data("redirect-callback"))}catch(error1){error=error1,Boundless.Logger.error("Error calling redirect callback. Error was:",error)}return link.data("redirect-destination")?window.location=link.data("redirect-destination"):link.data("redirect-reload")?window.location=window.location.href:(href=link.attr("href"))?window.location=href:fallback_link?window.location=fallback_link:void 0},$(function(){return $(document).on("click",".logged-in a[data-redirect-callback]",function(e){var $link;return e.preventDefault(),$link=$(e.currentTarget),Boundless.LinkHelper.handle_link($link)})})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;ko.HAMLTemplateEngine=function(superClass){function HAMLTemplateEngine(){return this.renderTemplateSource=bind(this.renderTemplateSource,this),HAMLTemplateEngine.__super__.constructor.apply(this,arguments)}return extend(HAMLTemplateEngine,superClass),HAMLTemplateEngine.prototype.allowTemplateRewriting=!1,HAMLTemplateEngine.prototype.renderTemplateSource=function(template_source,context,options){var rendered_haml;return null==options&&(options={}),rendered_haml=template_source.text()(context.$data),ko.utils.parseHtmlFragment(rendered_haml)},HAMLTemplateEngine.prototype.makeTemplateSource=function(template){return new ko.templateSources.hamlTemplate(template)},HAMLTemplateEngine}(ko.nativeTemplateEngine),ko.templateSources.hamlTemplate=function(){function hamlTemplate(template){this.template_name=template}return hamlTemplate.prototype.data=function(key,value){var base,name;return null==value&&(value=null),HAML._data||(HAML._data={}),(base=HAML._data)[name=this.template_name]||(base[name]={}),null!=value?HAML._data[this.template_name][key]=value:HAML._data[this.template_name][key]},hamlTemplate.prototype.text=function(value){return null==value&&(value=null),null!=value?HAML[this.template_name]=function(){return value}:HAML[this.template_name]},hamlTemplate}()}.call(this),function(){ko.bindingHandlers.htmlLazy={update:function(element,valueAccessor){var value;return value=ko.unwrap(valueAccessor()),element.isContentEditable?void 0:element.innerHTML=value}},ko.bindingHandlers.contentEditable={init:function(element,valueAccessor,allBindingsAccessor){var htmlLazy,value;return value=ko.unwrap(valueAccessor()),htmlLazy=allBindingsAccessor().htmlLazy,element.innerHTML=htmlLazy(),$(element).on("input",function(){return this.isContentEditable&&ko.isWriteableObservable(htmlLazy)?htmlLazy(this.innerHTML):void 0})},update:function(element,valueAccessor){var value;return value=ko.unwrap(valueAccessor()),element.contentEditable=value,element.isContentEditable?void 0:$(element).trigger("input")}},ko.bindingHandlers.fadeToggle={init:function(element,valueAccessor,allBindings){return"hidden"===allBindings.get("fadeDefault")?$(element).hide():void 0},update:function(element,valueAccessor,allBindings){var duration;return duration=allBindings.get("fadeDuration")||200,ko.unwrap(valueAccessor())&&!$(element).is(":visible")?$(element).fadeIn(duration):$(element).is(":visible")?$(element).fadeOut(duration):void 0}},ko.bindingHandlers.slideToggle={update:function(element,valueAccessor,allBindings){var duration;return duration=allBindings.get("slideDuration")||200,ko.unwrap(valueAccessor())&&!$(element).is(":visible")?$(element).velocity("slideDown",duration):$(element).is(":visible")?$(element).velocity("slideUp",duration):void 0}},ko.bindingHandlers.newQuestionAnimate={update:function(element,valueAccessor,allBindings){return ko.unwrap(valueAccessor())?($.scrollTo(element,400,{axis:"y",offset:-60}),$(element).hide(),$(element).velocity("slideDown",400)):void 0}}}.call(this),function(){boundless_module("Boundless"),Boundless.PageCallbacks=[],Boundless.APP_TYPE||(Boundless.APP_TYPE="reader"),Boundless.BROWSER_SUPPORTED=window.browser_supported,Boundless.HUMAN_INPUT_METHOD=Modernizr.touch?"tap":"click",Boundless.IS_EMBEDDED=!1,Boundless.REFERRALS_TOTAL=7,Boundless.RETINA=null!=window.devicePixelRatio&&window.devicePixelRatio>1?!0:!1,Modernizr.addTest("isIOS",function(){return/iPad|iPhone|iPod/g.test(navigator.userAgent)}),Modernizr.addTest("isMobile",function(){return RegExp(" Mobile").test(navigator.userAgent)}),Modernizr.addTest("isPhone",function(){return window.screen.width<=500}),Modernizr.addTest("iphone-classic",function(){return 480===window.screen.height}),Modernizr.addTest("iphone5",function(){return 568===window.screen.height}),Modernizr.addTest("isMqFixed",function(){return document.width>=750}),Modernizr.addTest("isWebkit",function(){return RegExp("WebKit").test(navigator.userAgent)}),Modernizr.addTest("editorSupported",function(){return!RegExp(" Mobile").test(navigator.userAgent)&&(RegExp("Safari").test(navigator.userAgent)||RegExp("Chrome").test(navigator.userAgent)||RegExp("Firefox").test(navigator.userAgent))}),Modernizr.addTest("isWindows",function(){return-1!==navigator.appVersion.indexOf("Win")}),Modernizr.addTest("in-iframe",function(){return self!==top}),ko.setTemplateEngine(new ko.HAMLTemplateEngine),window.parseBoolean=function(string){var bool;return"boolean"==typeof string?string:(bool=function(){switch(!1){case"true"!==string.toLowerCase():return!0;case"false"!==string.toLowerCase():return!1}}(),"boolean"==typeof bool?bool:void 0)},$.ajaxPrefilter("json script",function(_this){return function(options,originalOptions,jqXHR){var encoded_token,is_api_call,ref,ref1,token;return is_api_call=0===options.url.lastIndexOf(Boundless.API,0),token=null!=(ref=session.current_user)&&null!=(ref1=ref.attributes)?ref1.reader_authentication_token:void 0,options.xhrFields={withCredentials:!0},is_api_call&&null!=token&&(encoded_token=encodeURIComponent(token),-1===options.url.indexOf("?")?options.url=options.url+"?"+Boundless.auth_token_param+"="+encoded_token:options.url=options.url+"&"+Boundless.auth_token_param+"="+encoded_token),null}}(this)),Messenger.options={parentLocations:["body"],maxMessages:9,extraClasses:"messenger-fixed messenger-on-center messenger-on-top messenger-theme-future",instance:void 0,messageDefaults:{}},"undefined"!=typeof analytics&&null!==analytics&&analytics.ready(function(){return Boundless.Analytics.init()}),void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var funcNameRegex,results;return funcNameRegex=/function\s([^(]{1,})\(/,results=funcNameRegex.exec(this.toString()),results&&results.length>1?results[1].trim():""},set:function(value){return{}}}),$(function(){var _touchEnd,_touchStart,handle_target,handle_trigger;return $("html").addClass("jquery-loaded"),window.$body||(window.$body=$("body")),$(document).on("mousewheel DOMMouseScroll",".scroll-lock",function(e){var delta,direction;return delta=e.originalEvent.wheelDelta||-e.originalEvent.detail,direction=delta>0?"up":"down","up"===direction&&0===this.scrollTop||"down"===direction&&this.scrollTop>=this.scrollHeight-this.offsetHeight?e.preventDefault():void 0}),$body.picturefill(),"undefined"!=typeof Stripe&&null!==Stripe&&Stripe.setPublishableKey($('meta[name="stripe-key"]').attr("content")),Modernizr.touch&&$body.off("touchstart touchend","a").on("touchstart","a",function(_this){return function(e){return _this.startTouch=_.clone(e.originalEvent.touches[0]),_this.activeTarget=_this,_touchStart(e)}}(this)).on("touchend","a",function(_this){return function(e){var deltaX,deltaY,intent_value,touch;return touch=e.originalEvent.changedTouches[0],deltaX=touch.pageX-_this.startTouch.pageX,deltaY=touch.pageY-_this.startTouch.pageY,intent_value=deltaX*deltaX+deltaY*deltaY,100>=intent_value?(e.currentTarget.hasAttribute("target")&&handle_target(e),e.currentTarget.hasAttribute("trigger")&&handle_trigger(e),_touchEnd(e)):void 0}}(this)),$body.on("click","a[target]",function(_this){return function(e){return handle_target(e)}}(this)),$body.on("keypress","a[target]",function(_this){return function(e){var ref;return(ref=e.keyCode)===KeyCode.SPACE||ref===KeyCode.ENTER?handle_target(e):void 0}}(this)),$body.on("click","a[trigger]",function(_this){return function(e){return handle_trigger(e)}}(this)),$body.on("keypress","a[trigger]",function(_this){return function(e){var ref;return(ref=e.keyCode)===KeyCode.SPACE||ref===KeyCode.ENTER?handle_trigger(e):void 0}}(this)),$body.on("dblclick","a",function(_this){return function(e){return!1}}(this)),handle_target=function(e){var i,key,len,param,params,raw_params,raw_stack,ref,ref1,ref2,stack,stack_target,value;if("_blank"!==e.currentTarget.getAttribute("target")&&"blank"!==e.currentTarget.getAttribute("target")){if(e.preventDefault(),ref=e.currentTarget.getAttribute("target").split("?"),raw_stack=ref[0],raw_params=ref[1],ref1=raw_stack.split(":"),stack_target=ref1[0],raw_stack=ref1[1],params={},null!=raw_params)for(raw_params=raw_params.split("&"),i=0,len=raw_params.length;len>i;i++)param=raw_params[i],ref2=param.split("="),key=ref2[0],value=ref2[1],null!=value&&""!==value&&(params[key]=key.match(/_id$/)?parseInt(value):value);if(null!=raw_stack)return stack=raw_stack.split("/"),Boundless.Logger.log("TRIGGERED FOR:",stack_target,stack,params),events.trigger("update_stack:"+stack_target,stack,params)}},handle_trigger=function(e){var event,ref,target;return ref=e.currentTarget.getAttribute("trigger").split(":"),target=ref[0],event=ref[1],Boundless.Logger.log("==> Firing "+event+" on "+target+" <=="),window[target].trigger(event)},_touchStart=function(event){var target;return target=event.currentTarget,target.classList.add("touchactive"),this.touchStart_timeout=_.delay(function(){return target.classList.remove("touchactive")},350)},_touchEnd=function(event){return this.touchStart_timeout&&window.clearTimeout(this.touchStart_timeout),event.currentTarget.classList.remove("touchactive")}})}.call(this),function(){boundless_module("CookieMonster"),CookieMonster.DEFAULTS={domain:Boundless.COOKIE_DOMAIN,path:"/",expires:180},CookieMonster.get=function(key){var value;value=CookieMonster._get_value_from_root_cookie(key);try{return JSON.parse(value)}catch(error){return value}},CookieMonster.set=function(key,val,params){return null==params&&(params={}),null==val&&(val=null),null!=val&&"object"==typeof val&&(val=JSON.stringify(val)),params=_.extend({},CookieMonster.DEFAULTS,params),$.cookie(key,val,params)},CookieMonster["delete"]=function(key){return $.removeCookie(key)},CookieMonster._get_value_from_root_cookie=function(key){var new_val,old_val,value;return(old_val=$.cookie(key))?($.removeCookie(key,{path:window.location.pathname}),new_val=$.cookie(key),value=new_val||old_val,$.cookie(key,value,CookieMonster.DEFAULTS),value):old_val},CookieMonster.all=function(){var _,dict,key,ref;dict={},ref=$.cookie();for(key in ref)_=ref[key],dict[key]=CookieMonster.get(key);return dict},CookieMonster.has_user_type_cookie=function(){return CookieMonster.get("user_type_student")||CookieMonster.get("user_type_educator")||CookieMonster.get("user_type_expert")||CookieMonster.get("user_type_administrator")},CookieMonster.clean_up_old_cookies=function(){return CookieMonster["delete"]("ab_test_variant")},$.cookie.defaults=CookieMonster.DEFAULTS,CookieMonster.clean_up_old_cookies()}.call(this),function(){boundless_module("ViewHelpers"),ViewHelpers.icon_class_for_subject_tag=function(subject_tag_name){return subject_tag_name?"bicon-"+(subject_tag_name.toLowerCase().replace(/\.|\s/g,"-").replace(/-{2,}/g,"-")||"boundless"):"bicon-boundless"},ViewHelpers.icon_color_class_for_subject_tag=function(subject_tag_name){return subject_tag_name?"bicon-color-"+(subject_tag_name.toLowerCase().replace(" ","-")||"boundless"):"bicon-color-boundless"},ViewHelpers.icon_html_for_subject=function(subject_tag_name){return"<i class='"+ViewHelpers.icon_class_for_subject_tag(subject_tag_name)+"'></i>"},ViewHelpers.is_scrolled_into_view=function(elem){var el_bottom,el_top,view_bottom,view_top;return view_top=$(window).scrollTop(),view_bottom=view_top+$(window).height(),el_top=$(elem).offset().top,el_bottom=el_top+$(elem).height(),el_top>view_top&&view_bottom>el_bottom},ViewHelpers.humanize_date=function(date){return date=moment(date),date.year<moment().year?date.format("MMM D"):date.format("MMM D, YYYY")},ViewHelpers.typeset_equation=function(equation){return $(equation).wrapInner("<span class='process_math' data-length="+equation.outerHTML.length+">")},ViewHelpers.typeset_equations=function(element){var equation,i,len,ref;for(ref=$(element).find("equation"),i=0,len=ref.length;len>i;i++)equation=ref[i],ViewHelpers.typeset_equation(equation);return"undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub.Queue(["Typeset",MathJax.Hub]):void 0},ViewHelpers.getOrdinalSuffix=function(n){var s,v;return s=["th","st","nd","rd"],v=n%100,s[(v-20)%10]||s[v]||s[0]},ViewHelpers.getOrdinal=function(n){return n+ViewHelpers.getOrdinalSuffix(n)},ViewHelpers.discount_percent_off=function(discount_dollars,price_dollars){return null==discount_dollars&&(discount_dollars=0),null==price_dollars&&(price_dollars=1),Math.floor(discount_dollars/price_dollars*100)},ViewHelpers.readrate=function(words){return Math.round(words/225)||1},ViewHelpers.pluralize=function(singular,plural,quantity){return 1===quantity?singular:plural}}.call(this),function(){boundless_module("ThumbnailHelper"),ThumbnailHelper.best_for=function(url,size){return url=url.replace(Boundless.FIGURES_URL,Boundless.FIGURES_CDN),url.indexOf(".svg")>-1?url=url.replace(":size","raw"):(url=url.replace(":size",size),url.indexOf("@2x")>-1?Boundless.RETINA?void 0:url=url.replace(".@2x",""):url=url.replace(/\.([a-zA-Z0-9]+)$/,Boundless.RETINA?".@2x.$1":".$1"))}}.call(this),function(){boundless_module("URLHelpers"),URLHelpers.urlParam=function(name){var results;return results=new RegExp("[\\?&]"+name+"=([^&#]*)").exec(window.location.href),results?results[1]||null:null},URLHelpers.explode_params_to_object=function(){var cArr,cElem,cLen,cObj,cStr,cnt;if(window.location.search.length>0){for(cArr=window.location.search.split("?")[1].split("&"),cObj={},cLen=cArr.length,cnt=0;cLen--;)cStr=new String(cArr[cnt]).replace(/\+/g," "),cElem=cStr.split("="),cObj[cElem[0]]=cElem[1],cnt++;return cObj}}}.call(this),function(){var slice=[].slice;boundless_module("Boundless"),window._event_queue||(window._event_queue=[]),Boundless.Analytics=function(){function Analytics(){}var MP_EVENT_DELTA;return MP_EVENT_DELTA=100,Analytics.init=function(){return Boundless.Logger.log("Initializing Analytics Packages"),"undefined"!=typeof mixpanel&&null!==mixpanel&&mixpanel.set_config({cross_subdomain_cookie:!0,store_google:!0,test:!1}),session.logged_in()&&this.identify(session.current_user),null==$.cookie("initial_landing_page")&&$.cookie("initial_landing_page","other",{expires:1,domain:Boundless.COOKIE_DOMAIN,path:"/"}),this.process_event_queue(),null!=$.queryParam.track&&CookieMonster.set("track",$.queryParam.track),this.should_track()?void 0:(Boundless.Logger.warn("--------------------------- Segment.io TRACKING IS DISABLED"),$(".navbar__app-zone__icon").addClass("bicon-no-track"))},Analytics.should_track=function(){return CookieMonster.get("track")!==!1},Analytics.get_browser_name=function(){var ua;return ua=navigator.userAgent.toLowerCase(),/(webkit)[ \/]([\w.]+)/.exec(ua)?"webkit":/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(ua)?"opera":/(msie) ([\w.]+)/.exec(ua)?"msie":ua.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(ua)?"mozilla":ua},Analytics.get_browser_version=function(){var M,N,tem,ua;return N=navigator.appName,ua=navigator.userAgent,tem=void 0,M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),M&&null!=(tem=ua.match(/version\/([\.\d]+)/i))&&(M[2]=tem[1]),M=M?[M[1],M[2]]:[N,navigator.appVersion,"-?"],M[1]},Analytics.process_event_queue=function(){var event,i,len,results;for(results=[],i=0,len=_event_queue.length;len>i;i++)event=_event_queue[i],results.push(event());return results},Analytics.alias=function(id){return this.should_track()&&"undefined"!=typeof analytics&&null!==analytics?analytics.alias(id):void 0},Analytics.identify=function(user,callback){var traits;return null==callback&&(callback=null),this.should_track()?(callback=this.ensure_method_called(callback,3),Boundless.Logger.log("Identifying User to Analytics"),traits=_.extend({user_id:user.id,email:user.get("email"),created:new Date(user.get("created_at")),firstName:user.get("first_name"),lastName:user.get("last_name"),name:user.name(),authentication_token:user.get("reader_authentication_token"),channel:user.get("channel"),purchases:parseInt(user.purchase_count()),browser_type:this.get_browser_name(),browser_version:this.get_browser_version(),http_referrer:user.get("http_referrer"),anonymous:!1},user.get("analytics_data"),this.supplemental_data(user)),"undefined"!=typeof analytics&&null!==analytics?analytics.identify(user.get("analytics_distinct_id"),traits,{},function(_this){return function(){var alias,ref,ref1,replacement,traitAliases;if(traits.educator&&null!=window.mixpanel){traitAliases={created:"$created",email:"$email",firstName:"$first_name",lastName:"$last_name",lastSeen:"$last_seen",name:"$name",username:"$username",phone:"$phone"};for(alias in traitAliases)replacement=traitAliases[alias],null!=traits[alias]&&(traits[replacement]=traits[alias],delete traits[alias]);return null!=(ref=window.mixpanel)&&null!=(ref1=ref.people)?ref1.set(traits,function(){return"function"==typeof callback?callback():void 0}):void 0}return"function"==typeof callback?callback():void 0}}(this)):void 0):"function"==typeof callback?callback():void 0},Analytics.alias_and_identify_anonymous=function(callback){return this.already_identified()?"function"==typeof callback?callback():void 0:(this.alias($.cookie("_marketing_uuid")),this.identify_anonymous(callback))},Analytics.already_identified=function(){return null!=("undefined"!=typeof analytics&&null!==analytics&&"function"==typeof analytics.user?analytics.user().id():void 0)},Analytics.identify_anonymous=function(callback){var traits;return this.should_track()&&null==session.current_user?(callback=this.ensure_method_called(callback,3),Boundless.Logger.log("Identifying Visitor to Analytics"),traits=_.extend({name:"Anonymous",browser_type:this.get_browser_name(),browser_version:this.get_browser_version(),anonymous:!0,educator:CookieMonster.get("user_type_educator"),student:CookieMonster.get("user_type_student"),expert:CookieMonster.get("user_type_expert")},this.initial_values()),"undefined"!=typeof analytics&&null!==analytics?analytics.identify($.cookie("_marketing_uuid"),traits,{integrations:{"Customer.io":!1}},callback):void 0):"function"==typeof callback?callback():void 0},Analytics.track_pageview=function(page_name){return this.should_track()?(Boundless.Logger.log("Tracking Pageview: "+page_name),"undefined"!=typeof analytics&&null!==analytics?analytics.page(page_name):void 0):void 0},Analytics.track_event=function(event,callback){var providers,ref;return null==callback&&(callback=void 0),"length"in event.event_data&&Boundless.Logger.error("The attribute 'length' can't be passed to Analytics without breaking things. Use another name."),callback=this.ensure_method_called(callback),null!=event.event_name&&this.should_track()?(_.extend(event.event_data,{timestamp:(new Date).getTime()
}),providers=(null!=(ref=event.event_data)?ref.providers:void 0)||{All:!0},delete event.event_data.providers,Boundless.Logger.log("--------------------------- Segment.io event: "+event.event_name+" ("+JSON.stringify(event.event_data)+")"),"undefined"!=typeof analytics&&null!==analytics?analytics.track(event.event_name,event.event_data,{providers:providers},callback):"function"==typeof callback?callback():void 0):"function"==typeof callback?callback():void 0},Analytics.track_adroll_segment=function(segment){var err,error;if(null==segment&&(segment=null),"undefined"!=typeof __adroll&&null!==__adroll&&null!=segment&&"production"===Boundless.ENV)try{return __adroll.record_user({adroll_segments:segment}),Boundless.Logger.log("Tracked Adroll Segment: "+segment)}catch(error){err=error}},Analytics.utm_reference={utmcsr:"utm_source",utmccn:"utm_campaign",utmcmd:"utm_medium",utmctr:"utm_term",utmcct:"utm_content"},Analytics.utm_values=function(){var alternate,campaign_number,cookie,data,domain_hash,i,len,params,ref,ref1,session_number,time_stamp,utm_code;for(params={},ref=["utm_source","utm_campaign","utm_medium","utm_term","utm_content"],i=0,len=ref.length;len>i;i++)utm_code=ref[i],null!=URLHelpers.urlParam(utm_code)?params[utm_code]=unescape(URLHelpers.urlParam(utm_code)):(alternate=utm_code.replace("_","-"),null!=URLHelpers.urlParam(alternate)&&(params[utm_code]=unescape(URLHelpers.urlParam(alternate))));return(cookie=$.cookie("__utmz"))&&(ref1=cookie.split("."),domain_hash=ref1[0],time_stamp=ref1[1],session_number=ref1[2],campaign_number=ref1[3],data=ref1[4],_.each(data.split("|"),function(_this){return function(set){var key,ref2,utm_key,value;return ref2=set.split("="),key=ref2[0],value=ref2[1],utm_key=_this.utm_reference[key],null!=utm_key?params[utm_key]||(params[utm_key]=unescape(value)):"utmgclid"===key?(params.utm_source="google",params.utm_medium="cpc"):void 0}}(this))),params},Analytics.supplemental_data=function(user){var educator,expert,initial_data,key,originating_utm_data,ref,student,user_data,value;if(null==user&&(user=null),initial_data=Boundless.Analytics.initial_values(),null!=user){originating_utm_data=_.pick(user.get("analytics_data"),"utm_medium","utm_source","utm_campaign","utm_term","utm_content");for(key in originating_utm_data)value=originating_utm_data[key],null!=value&&(initial_data["originating_"+key]=value);user_data=_.pick(user.get("analytics_data"),"landing_page","cta_button"),_.extend(initial_data,user_data),educator=user.is_educator(),student=user.is_student(),expert=user.is_expert(),_.extend(initial_data,{educator:educator,student:student,expert:expert})}else educator=CookieMonster.get("user_type_educator"),student=CookieMonster.get("user_type_student"),expert=CookieMonster.get("user_type_expert"),_.extend(initial_data,{educator:educator,student:student,expert:expert});return initial_data.logged_in=session.logged_in(),initial_data.native_ios=IosManager.is_ios_app(),initial_data.school_id="undefined"!=typeof onboarding_data&&null!==onboarding_data&&null!=(ref=onboarding_data.school)?ref.id:void 0,null!=("undefined"!=typeof onboarding_data&&null!==onboarding_data?onboarding_data.book:void 0)&&_.extend(initial_data,onboarding_data.book.analytics_attributes()),initial_data},Analytics.initial_values=function(){var ref;return _.extend({},this.utm_values(),{analytics_distinct_id:$.cookie("_marketing_uuid"),http_referrer:$.cookie("referrer_cache"),landing_page:window.landing_page||"other",initial_landing_page:$.cookie("initial_landing_page")||"other",cta_button:("undefined"!=typeof onboarding_data&&null!==onboarding_data?onboarding_data.cta:void 0)||"other",ios_app_version:null!=IosManager.ios_app_version()?IosManager.ios_app_version():void 0,signup_book_id:"undefined"!=typeof onboarding_data&&null!==onboarding_data&&null!=(ref=onboarding_data.book)?ref.id:void 0})},Analytics.set_initial_values_cookie=function(){return CookieMonster.set("analytics_initial_values",_.extend(Boundless.Analytics.initial_values(),{educator:CookieMonster.get("user_type_educator"),student:CookieMonster.get("user_type_student"),expert:CookieMonster.get("user_type_expert")}))},Analytics.destroy_mixpanel_cookies=function(){var cookie,cookie_name,cookies,i,len,results;for(cookies=document.cookie.split(/;\s*/),results=[],i=0,len=cookies.length;len>i;i++)cookie=cookies[i],cookie.match(/^mp\_/)?(cookie_name=cookie.split("=")[0],results.push($.cookie(cookie_name,null,{domain:Boundless.COOKIE_DOMAIN,path:"/"}))):results.push(void 0);return results},Analytics.fire_conversion_tracking_if_needed=function(){var details;return null!=$.cookie("affiliate_conversion_values")?(details=$.cookie("affiliate_conversion_values").split("|"),Boundless.Logger.log("Sending conversion info to Impact Radius:",details),irEvent.setOrderId(details[0]),irEvent.addItem(details[1],details[2],details[3],details[4]),irEvent.fire(),$.cookie("affiliate_conversion_values",null,{domain:Boundless.COOKIE_DOMAIN,path:"/"})):void 0},Analytics.track_affiliate_lead=function(id){return irEvent.setOrderId(id),irEvent.fire()},Analytics.ensure_method_called=function(method,call_after){var called;return null==call_after&&(call_after=1),null!=method?(called=!1,setTimeout(function(_this){return function(){return called?void 0:(called=!0,method())}}(this),1e3*call_after),function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],called?void 0:(called=!0,method.apply(null,args))}}(this)):void 0},Analytics}(),"undefined"!=typeof analytics&&null!==analytics&&analytics.on("track",function(event,params,options){switch(event){case"RegFunnel: Selected Book":return Boundless.Analytics.track_adroll_segment("select_book");case"RegFunnel: Registered":return Boundless.Analytics.track_adroll_segment("sign_up");case"RegFunnel: Paid":return Boundless.Analytics.track_adroll_segment("paid")}})}.call(this),function(){boundless_module("Boundless"),Function.prototype.bind&&"undefined"!=typeof console&&null!==console&&"object"==typeof console.log&&["log","info","warn","error","assert","debug","clear","profile","profileEnd"].forEach(function(method){return console[method]=this.bind(console[method],console)},Function.prototype.call),Boundless.Logger=function(){function Logger(){}return Logger.log=function(){var key,results;if("undefined"!=typeof console&&null!==console&&null!=console.log)if("object"==typeof arguments[0]&&1===arguments.length){if("object"==typeof console.dir){console.log("Object >"),results=[];for(key in arguments[0])results.push(console.log(" - "+key+": "+arguments[0][key]));return results}if(Boundless.DEBUG)return console.dir.apply(console,arguments)}else if(Boundless.DEBUG)return console.log.apply(console,arguments)},Logger.info=function(){return"undefined"!=typeof console&&null!==console&&null!=console.info&&Boundless.DEBUG?console.info.apply(console,arguments):void 0},Logger.debug=function(){return"undefined"!=typeof console&&null!==console&&null!=console.debug&&Boundless.DEBUG?console.debug.apply(console,arguments):void 0},Logger.warn=function(){return"undefined"!=typeof console&&null!==console&&null!=console.warn?console.warn.apply(console,arguments):void 0},Logger.error=function(){return"undefined"!=typeof console&&null!==console&&null!=console.error?console.error.apply(console,arguments):void 0},Logger}()}.call(this),function(){var slice=[].slice;boundless_module("Boundless"),Boundless.Events={supplemental_data:function(){return Boundless.Analytics.supplemental_data(session.current_user)},track:function(event_scope,name,properties,callback){var _do_track,event,identify_anonymous,track_once;return null==properties&&(properties={}),null==callback&&(callback=void 0),"function"==typeof properties&&null==callback&&(callback=properties,properties={}),event=Boundless.Events[event_scope][name],track_once=properties.once||!1,delete properties.once,identify_anonymous=event.identify_anonymous||properties.identify_anonymous||!1,delete properties.identify_anonymous,event.event_data=_.extend({},Boundless.Events.supplemental_data(),_.omit(event,"event_name","event_data","identify_anonymous"),properties),_do_track=function(_this){return function(){return track_once?(_this.tracked_events||(_this.tracked_events={}),_this.tracked_events[event_scope+":"+name]?"function"==typeof callback?callback():void 0:(Boundless.Analytics.track_event(event,callback),_this.tracked_events[event_scope+":"+name]=!0)):Boundless.Analytics.track_event(event,callback)}}(this),identify_anonymous&&!session.current_user?Boundless.Analytics.alias_and_identify_anonymous(_do_track):_do_track()},General:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["General"].concat(slice.call(args)))},no_bounce:{event_name:"NoBounce",providers:{All:!1,"Google Analytics":!0}}},ECommerce:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["ECommerce"].concat(slice.call(args)))},viewed_promotion:{event_name:"Viewed Promotion"},clicked_promotion:{event_name:"Clicked Promotion"},viewed_product_category:{event_name:"Viewed Product Category",providers:{All:!1,"Google Analytics":!0}},viewed_product:{event_name:"Viewed Product",providers:{All:!1,"Google Analytics":!0}},added_product:{event_name:"Added Product",providers:{All:!1,"Google Analytics":!0}},remove_product:{event_name:"Added Product",providers:{All:!1,"Google Analytics":!0}},viewed_checkout_step:{event_name:"Viewed Checkout Step",providers:{All:!1,"Google Analytics":!0}},completed_checkout_step:{event_name:"Completed Checkout Step",providers:{All:!1,"Google Analytics":!0}},completed_order:{event_name:"Completed Order",providers:{All:!1,"Google Analytics":!0}}},RegistrationFunnel:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["RegistrationFunnel"].concat(slice.call(args)))},clicked_sign_up:{event_name:"Register: Clicked Sign Up"},clicked_sign_up_in_header:{event_name:"Register: Clicked sign up in header"},clicked_edit:{event_name:"Register: Edit Clicked"},clicked_customize_quiz:{event_name:"Register: Customize Quiz Clicked"},clicked_take_quiz:{event_name:"Register: Take Quiz Clicked"},clicked_download_powerpoint:{event_name:"Register: PowerPoint Download Clicked"},selected_user_type:{event_name:"Register: Selected User Type"},registered:{event_name:"Register: Created Account"},entered_additional_info:{event_name:"Register: Entered Additional Info"},added_free_book:{event_name:"Register: Added Free Book"},viewed_book_landing:{event_name:"RegFunnel: Viewed Books Landing"},clicked_assign_book:{event_name:"RegFunnel: Clicked Assign Book"},clicked_teaching_platform_get_started:{event_name:"Register: Clicked Teaching Platform Get Started"},clicked_oauth_register_button:{event_name:"Register: Clicked Oauth Register Button"},clicked_oauth_login_button:{event_name:"Register: Clicked Oauth Login Button"}},Purchasing:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Purchasing"].concat(slice.call(args)))},clicked:{event_name:"Purchasing: Clicked"},paid:{event_name:"Purchasing: Paid"},got_free_book:{event_name:"Purchasing: Got Free Book"},clicked_homepage_cta:{event_name:"Purchasing: Clicked Homepage CTA"},used_code:{event_name:"Purchasing: Used Code"}},Feature:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Feature"].concat(slice.call(args)))},clicked_save_resource:{event_name:"Save Resource: Clicked"},clicked_assign_resource:{event_name:"Assign: Clicked"},created_assignment:{event_name:"Assign: Created Assignment"},copied_course_link:{event_name:"Assign: Copied Class Link"},clicked_watch:{event_name:"Watch: Clicked"},clicked_instaedu:{event_name:"Clicked Tutor CTA"},completed_lesson:{event_name:"Server: Completed Assignment"}},Flags:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Flags"].concat(slice.call(args)))},flagged_content:{event_name:"Flags: Flagged Content"},clicked_feedback_type:{event_name:"Flags: Feedback Type Click"},submitted_feedback:{event_name:"Flags: Feedback Submit"}},Flashcards:{track:function(name,book,properties,callback){var event;return null==properties&&(properties={}),null==callback&&(callback=void 0),"function"==typeof properties&&null==callback&&(callback=properties,properties={}),event=Boundless.Events.Flashcards[name],event.event_data=_.extend({},_.omit(event,"event_name","event_data"),properties,book.event_properties(),Boundless.Events.supplemental_data()),Boundless.Analytics.track_event(event,callback)},clicked_begin:{event_name:"Flashcards: Clicked Begin"},clicked_flip:{event_name:"Flashcards: Clicked Flip"},clicked_response:{event_name:"Flashcards: Clicked Response"},click_skip:{event_name:"Flashcards: Skipped Card"},clicked_review_all:{event_name:"Flashcards: Clicked Review All"},clicked_review_due:{event_name:"Flashcards: Clicked Review Due"}},Quiz:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Quiz"].concat(slice.call(args)))},clicked_resume:{event_name:"Quiz: Clicked Resume"},clicked_retake:{event_name:"Quiz: Clicked Retake"},clicked_answer:{event_name:"Quiz: Clicked Answer"},clicked_next:{event_name:"Quiz: Clicked Next"},clicked_finish:{event_name:"Quiz: Clicked Finish"},clicked_begin:{event_name:"Quiz: Clicked Begin"},clicked_find_in_book:{event_name:"Quiz: Clicked Find The Answer In The Book"}},QuickQuiz:{track:function(name,book,properties,callback){var event;return null==book&&(book={}),null==properties&&(properties={}),null==callback&&(callback=void 0),"function"==typeof properties&&null==callback&&(callback=properties,properties={}),"function"==typeof book.event_properties&&_.extend(properties,book.event_properties()),event=Boundless.Events.QuickQuiz[name],event.event_data=_.extend({},_.omit(event,"event_name","event_data"),properties,Boundless.Events.supplemental_data()),Boundless.Analytics.track_event(event,callback)},on_review:{event_name:"QuickQuiz:Enter"},on_start:{event_name:"QuickQuiz:Begin"},on_quiz_skip:{event_name:"QuickQuiz:Skipped"},on_correct_answer_first:{event_name:"QuickQuiz: Answer Correct 1"},on_correct_answer_second:{event_name:"QuickQuiz: Answer Correct 2"},on_incorrect_answer_first:{event_name:"QuickQuiz: Answer Incorrect 1"},on_incorrect_answer_second:{event_name:"QuickQuiz: Answer Incorrect 2"},on_next:{event_name:"QuickQuiz: Next Question"},on_find_in_book:{event_name:"QuickQuiz: Find In Book"},on_finish:{event_name:"QuickQuiz: Finish"},on_continue_after_finish:{event_name:"QuickQuiz: Continues After Finish"}},Community:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Community"].concat(slice.call(args)))},clicked_tab:{event_name:"Community: Clicked tab"},clicked_issue_link:{event_name:"Community: Clicked issue link"},applied_filter:{event_name:"Community: Applied filter"},clicked_propose_an_edit:{event_name:"Community: Clicked propose an edit"},clicked_view_your_edits:{event_name:"Community: Clicked view your edits"}},Header:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Header"].concat(slice.call(args)))},clicked_contribute:{event_name:"Header: Clicked contribute"},clicked_contribute_dropdown_item:{event_name:"Header: Clicked contribute dropdown item"}},Sisyphus:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Sisyphus"].concat(slice.call(args)))},clicked_text_selection_edit:{event_name:"Sis: Clicked text selection edit"},typed_in_editor:{event_name:"Sis: Typed in editor"},clicked_propose_change:{event_name:"Sis: Clicked propose change"},clicked_submit_propose_change:{event_name:"Sis: Clicked submit propose change"},proposed_change_submitted:{event_name:"Sis: Proposed change submitted"},clicked_feedback_tab:{event_name:"Sis: Clicked feedback tab"},clicked_submit_feedback:{event_name:"Sis: Clicked submit feedback"},clicked_leave_feedback:{event_name:"Sis: Leave Feedback Clicked"},clicked_reg_to_hide_ads:{event_name:"Sis: Clicked reg to hide ads"},clicked_edit_tab:{event_name:"Sis: Clicked edit tab"},clicked_inline_edit:{event_name:"Sis: Clicked inline edit link"},clicked_sign_up_on_new_feedback:{event_name:"Sis: Clicked sign up on new feedback"},created_an_issue:{event_name:"Sis: Created an issue"},created_a_proposed_change:{event_name:"Sis: Created a proposed change"},clicked_flag_up:{event_name:"Sis: Clicked flag up"},clicked_flag_down:{event_name:"Sis: Clicked flag down"},clicked_feedback_orientation_continue:{event_name:"Sis: Clicked continue on feedback orientation"}},Editor:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Editor"].concat(slice.call(args)))},clicked_update_proposal:{event_name:"Editor: Clicked update proposal"},clicked_submit_updated_proposed_change:{event_name:"Editor: Clicked submit updated proposed change"},updated_proposed_change:{event_name:"Editor: Updated proposed change"}},Issue:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Issue"].concat(slice.call(args)))},clicked_propose_an_edit:{event_name:"Issue: Clicked propose an edit",once:!0},clicked_view_proposed_edit:{event_name:"Issue: Clicked view proposed edit"}},Gnome:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Gnome"].concat(slice.call(args)))},answered_quiz_question:{event_name:"Gnome: Answered quiz question",providers:{All:!1,"Google Analytics":!0}},completed_quiz:{event_name:"Gnome: Finished quiz",providers:{All:!1,"Google Analytics":!0}},question_email_submitted:{event_name:"Gnome: Questions Email Submitted"},prompter_registered:{event_name:"Gnome: Register"},prompter_premium_clicked:{event_name:"Gnome: Premium Click"},lesson_page_customize_clicked:{event_name:"Lesson Page: Customize Request"},viewed_gnome_tutor_quiz:{event_name:"Viewed Gnome Tutor Quiz",providers:{All:!1,Mixpanel:!0}},answered_gnome_tutor_quiz:{event_name:"Answered Gnome Tutor Quiz"},answered_gnome_hw_quiz:{event_name:"Answered Gnome Homework Quiz"},answered_gnome_survey:{event_name:"Gnome: Answered Gnome Survey"},answered_teaching_resource_survey:{event_name:"Gnome: Answered Teaching Resource Survey"},clicked_book_discount_survey:{event_name:"Gnome: Clicked Book Discount Survey"},clicked_teaching_resources_inline_ad:{event_name:"Teaching Resources: Clicked Inline Ad"},clicked_breadcrumb:{event_name:"Gnome: Clicked Content Breadcrumb"}},Educators:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["Educators"].concat(slice.call(args)))},clicked_add_book:{event_name:"BTP: Add Book Click"},clicked_customize:{event_name:"BTP: Customize Click"},clicked_add_class:{event_name:"BTP: Add Class Click"},clicked_create_class:{event_name:"BTP: Created Class"},clicked_share_class:{event_name:"BTP: Share Click"},clicked_email_this_link:{event_name:"BTP: Share Email Click"},student_clicked_join_class:{event_name:"BTP: Student Join Class Click"},clicked_request_bulk_order:{event_name:"BTP: Clicked Bulk Order"},clicked_create_assignment:{event_name:"BTP: Create Assignment Click"},created_assignment:{event_name:"BTP: Created Assignment"},clicked_assign_course_page:{event_name:"BTP: Clicked Assign on Course Page"},clicked_assign_modal_cta:{event_name:"BTP: Clicked Assign Modal CTA"},requested_ppt:{event_name:"BTP: Requested PPT"},downloaded_ppt:{event_name:"BTP: Downloaded PPT"},clicked_teach_material_cta:{event_name:"BTP: Clicked Teach Material CTA"},requested_chapter_ppt:{event_name:"BTP: Requested Chapter PPT"},submitted_email_chapter_ppt:{event_name:"BTP: Submitted Email for Chapter PPT"},requested_section_ppt:{event_name:"BTP: Requested Section PPT"},submitted_email_section_ppt:{event_name:"BTP: Submitted Email for Section PPT"},requested_concept_ppt:{event_name:"BTP: Requested Concept PPT"},submitted_email_concept_ppt:{event_name:"BTP: Submitted Email for Concept PPT"},submitted_email_community_beta:{event_name:"Community: Joined Community Beta"},clicked_teach_tab:{event_name:"Teach Tab: Clicked Teach Tab"},clicked_customize_assignment:{event_name:"Assignment Page: Clicked Customize CTA"},clicked_save_assignment:{event_name:"Assignment Page: Clicked Save Resource CTA"},viewed_class_name:{event_name:"Create a Class: Viewed Class Name"},clicked_teach_resource_cta:{event_name:"Teaching Resources: Clicked Teaching CTA"},viewed_quizzes_page:{event_name:"Quizzes: Viewed Quizzes Page"},clicked_quizzes_page_cta:{event_name:"Quizzes: Clicked Quizzes Page CTA"}},AssignFunnel:{track:function(){var args,ref;return args=1<=arguments.length?slice.call(arguments,0):[],(ref=Boundless.Events).track.apply(ref,["AssignFunnel"].concat(slice.call(args)))},created_assignment:{event_name:"Assign Funnel: Created Assignment"},created_course:{event_name:"Assign Funnel: Created Course"}},Sneak:{track:function(name,properties,callback){var event,track_once;return null==properties&&(properties={}),null==callback&&(callback=void 0),"function"==typeof properties&&null==callback&&(callback=properties,properties={}),track_once=properties.once||!1,delete properties.once,event=Boundless.Events.Sneak[name],event.event_data=_.extend({},_.omit(event,"event_name","event_data"),properties,Boundless.Events.supplemental_data()),track_once?(this.tracked_events||(this.tracked_events={}),this.tracked_events[name]?void 0:(Boundless.Analytics.track_event(event,callback),this.tracked_events[name]=!0)):Boundless.Analytics.track_event(event,callback)},viewed_registration_dialog:{event_name:"Sneak: Viewed Registration Dialog"},viewed_confirm_concept_assignment_dialog:{event_name:"Sneak: Viewed Confirm Concept Assignment Dialog"},clicked_confirm_concept:{event_name:"Sneak: Clicked Confirm Concept"},clicked_confirm_section:{event_name:"Sneak: Clicked Confirm Section"},clicked_sidebar_item:{event_name:"Sneak: Register: Clicked Sidebar Item"},clicked_section_concepts:{event_name:"Sneak: Clicked Section Concepts"},clicked_go_to_class:{event_name:"Sneak: Assign: Clicked Go To Class"},saw_content_popup:{event_name:"Sneak: Saw content pop-up",providers:{All:!1,Mixpanel:!0}},minimized_popup:{event_name:"Sneak: Minimized pop-up"},answered_sneak_teaching_survey:{event_name:"Sneak: Answered Teaching Survey"},saw_powerpoint_modal:{event_name:"Sneak: Saw Powerpoint Modal",providers:{All:!1,Mixpanel:!0}},clicked_powerpoint_read_resource:{event_name:"Sneak: Clicked Powerpoint Read Resource"},clicked_powerpoint_assign_resource:{event_name:"Sneak: Clicked Powerpoint Assign Resource"},clicked_powerpoint_explore_resource:{event_name:"Sneak: Clicked Powerpoint Explore Resource"},clicked_create_assignment:{event_name:"Sneak: Clicked Create Assignment"},saw_syllabus_survey:{event_name:"Sneak: Saw Syllabus Survey",providers:{All:!1,Mixpanel:!0}},answered_syllabus_survey:{event_name:"Sneak: Answered Syllabus Survey"},viewed_assign_popover:{event_name:"Sneak: Viewed Assign Popover"},closed_welcome_banner:{event_name:"Sneak: Closed Welcome Banner"},clicked_book_details:{event_name:"Sneak: Clicked Book Details"},clicked_breadcrumb:{event_name:"Sneak: Clicked Breadcrumb"},clicked_class_create_assignment:{event_name:"Clicked Class Create Assignment"},clicked_nav_header:{event_name:"Clicked Nav Header"},clicked_nav_footer:{event_name:"Clicked Nav Footer"},clicked_mentioned_key_term:{event_name:"Clicked Mentioned Key Term"},clicked_quiz_edit_tab:{event_name:"Clicked Quiz Edit Tab"},clicked_quiz_history_tab:{event_name:"Clicked Quiz History Tab"},clicked_quiz_usage_tab:{event_name:"Clicked Quiz Usage Tab"},clicked_quiz_settings_tab:{event_name:"Clicked Quiz Settings Tab"},clicked_quiz_content_action:{event_name:"Clicked Quiz Content Action"},clicked_textbook_adopt_book_for_class:{event_name:"Clicked Textbook Adopt Book for Class"},clicked_textbook_more_options:{event_name:"Clicked Textbook More Options"},clicked_textbook_customize_book:{event_name:"Clicked Textbook Customize Book"},clicked_pricing_preview_button:{event_name:"Clicked Pricing Preview Button"},clicked_view_table_of_contents:{event_name:"Clicked View Table of Contents"},clicked_view_quiz_overview:{event_name:"Clicked View Quiz Overview"}}}}.call(this),function(){window.Boundless.HighlightProcessor=new(Boundless.HighlightProcessor=function(){function HighlightProcessor(){}var convertXPathHighlightToHighlightData,findElement,findFirstHighlightableChild,findHighlightableElementsBetweenHighlightableElements,findHighlightableParent,findLastHighlightableChild,findXPathOffset,getHighlight,getXPathHighlights,get_browser_version,hasClass,isHighlightable,isIE,parseXPath;return isIE=function(){return/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())?!0:!1},get_browser_version=function(){var M,N,tem,ua;return N=navigator.appName,ua=navigator.userAgent,tem=void 0,M=ua.match(/(opera|chrome|safari|firefox|msie)\/?\s*(\.?\d+(\.\d+)*)/i),M&&null!=(tem=ua.match(/version\/([\.\d]+)/i))&&(M[2]=tem[1]),M=M?[M[1],M[2]]:[N,navigator.appVersion,"-?"],M[1]},HighlightProcessor.prototype.tidy=function(htmldata){var d;return d=document.createElement("div"),d.innerHTML=htmldata,d.innerHTML},HighlightProcessor.prototype.get_highlight_data=function(element,atomContent){var endContainer,endOffset,ends_with_equation,equation,equation_contents,i,j,k,l,len,len1,len2,mathjax_delimiters,range,ref,ref1,ref2,selection,selectionContainer,startContainer,startOffset,starts_with_equation,xPathHighlight,xPathHighlights;for(equation_contents=[],ref=element.find("equation"),j=0,len=ref.length;len>j;j++)equation=ref[j],equation_contents.push(equation.innerHTML),"undefined"!=typeof MathJax&&null!==MathJax&&(mathjax_delimiters=MathJax.Hub.config.tex2jax.inlineMath[0],equation.innerHTML=mathjax_delimiters[0]+$(equation).find("script[type='math/tex']").html()+mathjax_delimiters[1]);for(selection=window.getSelection(),selection.selectAllChildren(element.get(0)),range=selection.getRangeAt(0),selectionContainer=range.commonAncestorContainer,startContainer=range.startContainer,startOffset=range.startOffset,endContainer=range.endContainer,endOffset=range.endOffset;null!=startContainer.firstChild;)startContainer=startContainer.firstChild,startOffset=0;for(;null!=endContainer.lastChild;)endOffset=endContainer.lastChild.length,endContainer=endContainer.lastChild;if(starts_with_equation="equation"===startContainer.parentNode.localName,starts_with_equation&&(startContainer=startContainer.parentNode,startOffset=0),ends_with_equation="equation"===endContainer.parentNode.localName,ends_with_equation&&(endContainer=endContainer.parentNode,endOffset=endContainer.outerHTML.length),startContainer===endContainer&&startOffset===endOffset){for(selection.removeAllRanges(),ref1=element.find("equation"),i=k=0,len1=ref1.length;len1>k;i=++k)equation=ref1[i],equation.innerHTML=equation_contents[i];return null}for(xPathHighlights=getXPathHighlights(selectionContainer,startContainer,startOffset,endContainer,endOffset),selection.removeAllRanges(),ref2=element.find("equation"),i=l=0,len2=ref2.length;len2>l;i=++l)equation=ref2[i],equation.innerHTML=equation_contents[i];return null==xPathHighlights||xPathHighlights.length<=0?null:(xPathHighlight=xPathHighlights[0],convertXPathHighlightToHighlightData(xPathHighlight,atomContent))},convertXPathHighlightToHighlightData=function(xPathHighlight,contentBody){var endOffsetResult,highlightData,startOffsetResult;return startOffsetResult=findXPathOffset(xPathHighlight.startXPath,contentBody,xPathHighlight.startOffset,xPathHighlight.startHadANeoTagJoin),endOffsetResult={offset:contentBody.length},(xPathHighlight.endXPath||xPathHighlight.endOffset)&&(endOffsetResult=findXPathOffset(xPathHighlight.endXPath,contentBody,xPathHighlight.endOffset,xPathHighlight.endHadANeoTagJoin)),endOffsetResult.offset<startOffsetResult.offset&&(endOffsetResult.offset=startOffsetResult.endOfElement),highlightData={start_offset:startOffsetResult.offset,end_offset:endOffsetResult.offset}},getHighlight=function(feature,startElement,startOffset,endElement,endOffset){var endLocation,result,startLocation;return startLocation=findElement("",feature,startElement),endLocation=findElement("",feature,endElement),result={startXPath:startLocation.xPath,startOffset:startOffset+startLocation.offset,startHadANeoTagJoin:startLocation.hadANeoTagJoin,endXPath:endLocation.xPath,endOffset:endOffset+endLocation.offset,endHadANeoTagJoin:endLocation.hadANeoTagJoin}},hasClass=function(element,searchClass){var classString,lowerCaseSearchClass;return classString=element.className,null==classString?!1:(lowerCaseSearchClass=searchClass.toLowerCase(),_.any(classString.split(" "),function(c){return c.toLowerCase()===lowerCaseSearchClass}))},isHighlightable=function(element){return hasClass(element,"highlightable")},findHighlightableParent=function(element){return null==element?null:isHighlightable(element)?element:findHighlightableParent(element.parentNode)},findFirstHighlightableChild=function(element){var child,j,len,ref,result;if(isHighlightable(element))return element;if(null==element.children)return null;for(ref=element.children,j=0,len=ref.length;len>j;j++)if(child=ref[j],result=findFirstHighlightableChild(child))return result;return null},findLastHighlightableChild=function(element){var children,i,j,numChildren,ref,result;if(isHighlightable(element))return element;for(children=element.children,numChildren=children.length,i=j=ref=children.length-1;j>=0;i=j+=-1)if(result=findLastHighlightableChild(children[i]),null!=result)return result;return null},findHighlightableElementsBetweenHighlightableElements=function(element,startElement,endElement){var helper;return helper=function(_this){return function(element,startElement,endElement,startAlreadyFound){var child,elements,foundElements,foundEnd,foundStart,helperResult,j,len,ref,result;if(element===startElement)return result={elements:[],foundStart:!0,foundEnd:element===endElement};if(element===endElement)return result={elements:[],foundStart:startAlreadyFound,foundEnd:!0};if(isHighlightable(element))return elements=[],startAlreadyFound&&(elements=[element]),result={elements:elements,foundStart:startAlreadyFound,foundEnd:!1};for(foundElements=[],foundStart=startAlreadyFound,foundEnd=!1,ref=element.children,j=0,len=ref.length;len>j&&(child=ref[j],helperResult=helper(child,startElement,endElement,foundStart),foundStart|=helperResult.foundStart,foundEnd=helperResult.foundEnd,foundElements=foundElements.concat(helperResult.elements),!helperResult.foundEnd);j++);return result={elements:foundElements,foundStart:foundStart,foundEnd:foundEnd}}}(this),helper(element,startElement,endElement,!1).elements},findElement=function(parentXPath,containerElement,searchForElement){var cleanedContainer,domCleaner,result,xPathBuilder;return domCleaner=function(parentElement){var child,children,excludeLen,firstChild,includedChildren,isTextElement,j,joinedTags,lastChild,lastRealChild,len,previousSiblingWasTextInANeoTag,ref,result,type;for(children=[],lastRealChild=null,previousSiblingWasTextInANeoTag=!1,joinedTags=!1,ref=parentElement.childNodes,j=0,len=ref.length;len>j;j++)child=ref[j],isTextElement=3===child.nodeType,hasClass(child,"neo_tag_exclude")?(excludeLen=$(child).attr("data-length"),null!=excludeLen&&children.push({type:"length",length:excludeLen})):hasClass(child,"neo_tag_include")?(includedChildren=domCleaner(child).children,includedChildren.length>0&&(firstChild=includedChildren[0],lastChild=includedChildren[includedChildren.length-1],"text"===firstChild.type&&null!=lastRealChild&&"text"===lastRealChild.type&&(joinedTags=!0,children.push({type:"join_tags"})),children=children.concat(includedChildren),previousSiblingWasTextInANeoTag="text"===lastChild.type?!0:!1,lastRealChild=lastChild)):(lastRealChild=domCleaner(child),previousSiblingWasTextInANeoTag&&"text"===lastRealChild.type&&(joinedTags=!0,children.push({type:"join_tags"}),previousSiblingWasTextInANeoTag=!1),children.push(lastRealChild));return type="element",3===parentElement.nodeType&&(type="text"),result={type:type,children:children,element:parentElement}},xPathBuilder=function(parentXPath,cleanedContainer,searchForElement){var child,j,joinWithPreviousElement,len,offset,ref,ref1,ref2,result,xPathChildCounter;
if(null===cleanedContainer)return result={xPath:null,hadANeoTagJoin:!1,offset:0};if(cleanedContainer.element===searchForElement)return result={xPath:parentXPath,hadANeoTagJoin:!1,offset:0};for(offset=0,joinWithPreviousElement=!1,xPathChildCounter=0,ref=cleanedContainer.children,j=0,len=ref.length;len>j;j++){switch(child=ref[j],child.type){case"join_tags":xPathChildCounter--,joinWithPreviousElement=!0;continue;case"element":joinWithPreviousElement=!1,offset=0;break;case"length":offset+=child.length;continue}if(result=xPathBuilder(parentXPath+"/*["+xPathChildCounter+"]",child,searchForElement),result.xPath)return joinWithPreviousElement&&(result.offset+=offset,offset=result.offset,result.hadANeoTagJoin=!0),result;xPathChildCounter++,joinWithPreviousElement?offset+=null!=(ref1=child.element.length)?ref1:0:offset=null!=(ref2=child.element.length)?ref2:0}return result={xPath:null,offset:0}},cleanedContainer=domCleaner(containerElement),result=xPathBuilder(parentXPath,cleanedContainer,searchForElement)},getXPathHighlights=function(selectionContainer,startContainer,startOffset,endContainer,endOffset){var contentEndXPath,contentStartXPath,firstHighlight,firstHighlightableFeature,highlights,lastHighlight,lastHighlightableFeature;return highlights=[],firstHighlightableFeature=findHighlightableParent(startContainer),contentStartXPath=contentEndXPath=null,firstHighlightableFeature||(firstHighlightableFeature=findFirstHighlightableChild(selectionContainer)),firstHighlightableFeature?(lastHighlightableFeature=findHighlightableParent(endContainer),lastHighlightableFeature||(lastHighlightableFeature=findLastHighlightableChild(selectionContainer)),firstHighlightableFeature===lastHighlightableFeature?[getHighlight(firstHighlightableFeature,startContainer,startOffset,endContainer,endOffset)]:(firstHighlight=getHighlight(firstHighlightableFeature,startContainer,startOffset,null,null),lastHighlight=getHighlight(lastHighlightableFeature,null,null,endContainer,endOffset),highlights=[firstHighlight],_.each(findHighlightableElementsBetweenHighlightableElements(selectionContainer,firstHighlightableFeature,lastHighlightableFeature),function(_this){return function(highlightElement){return highlights.push(getHighlight(highlightElement,null,null))}}(this)),highlights.push(lastHighlight),highlights)):void 0},findXPathOffset=function(xpath,content,offset,elementHadANeoTagJoin){var charIndex,childCounter,closeTagAfterCheck,currentBlock,currentPath,getNextBlock,getOffsetAdjustmentDueToBrowserQuirks,getTagType,levelCounter,offsetAdjustment,result,targetPath,whitespaceOffset,withoutInitialWhitespace;if(offset||(offset=0),!xpath||""===xpath||"/"===xpath)return result={offset:offset,endOfElement:offset};for(targetPath=parseXPath(xpath),currentPath=[],childCounter=[],getTagType=function(tag){var strippedTag;if(strippedTag=tag.substring(1,tag.length-1).replace(/^\s+|\s+$/g,"").toLowerCase(),"/"===strippedTag.charAt(0))return"CLOSE_TAG";if("/"===strippedTag.charAt(strippedTag.length-1))return"OPEN_CLOSE_TAG";switch(strippedTag){case"br":return"OPEN_CLOSE_TAG"}return"OPEN_TAG"},getNextBlock=function(text,charIndex){var endIndex,tagContents;if(charIndex>=text.length)return null;switch(text.charAt(charIndex)){case"<":return endIndex=content.indexOf(">",charIndex)+1,0===endIndex&&(endIndex=text.length),tagContents=text.substring(charIndex,endIndex),result={blockType:getTagType(tagContents),blockContents:tagContents,endIndex:endIndex};default:return endIndex=content.indexOf("<",charIndex),-1===endIndex&&(endIndex=text.length),result={blockType:"TEXT",blockContents:text.substring(charIndex,endIndex),endIndex:endIndex}}},getOffsetAdjustmentDueToBrowserQuirks=function(text,initialOffset,elementHadANeoTagJoin){var browserVersion,character,checkIndex,deltaOffset,endAmpIndex,escapedCharLen,modifiedOffset,previousCharWasWhitespace,trimmedLength,trimmedText,whitespaceRegexp;for(modifiedOffset=initialOffset,checkIndex=0,whitespaceRegexp=/\s/m,previousCharWasWhitespace=!1,browserVersion=parseFloat(get_browser_version()),isIE=function(){return/(msie) ([\w.]+)/.exec(navigator.userAgent.toLowerCase())?!0:!1},isIE()&&(trimmedText=text.replace(/^\s+/,""),trimmedLength=text.length-trimmedText.length,browserVersion>=9&&!elementHadANeoTagJoin?(checkIndex=trimmedLength,modifiedOffset-=trimmedLength):checkIndex=trimmedLength);modifiedOffset>checkIndex;){switch(character=text.charAt(checkIndex)){case"&":endAmpIndex=text.indexOf(";",checkIndex),-1===endAmpIndex?checkIndex=modifiedOffset:(escapedCharLen=endAmpIndex-checkIndex,modifiedOffset+=escapedCharLen,checkIndex=endAmpIndex);break;default:isIE()&&9>browserVersion&&(character.match(whitespaceRegexp)?(previousCharWasWhitespace&&modifiedOffset++,previousCharWasWhitespace=!0):previousCharWasWhitespace=!1)}checkIndex++}return deltaOffset=modifiedOffset-initialOffset},levelCounter=0,charIndex=0,currentBlock=getNextBlock(content,charIndex);null!==currentBlock;){switch(closeTagAfterCheck=!1,currentBlock.blockType){case"OPEN_TAG":currentPath.push(levelCounter),levelCounter=0;break;case"CLOSE_TAG":levelCounter=currentPath.pop()+1;break;default:currentPath.push(levelCounter),closeTagAfterCheck=!0}if(_.isEqual(targetPath,currentPath))return offsetAdjustment=0,"TEXT"===currentBlock.blockType&&(whitespaceOffset=0,isIE()&&(withoutInitialWhitespace=currentBlock.blockContents.replace(/^\s+/,""),whitespaceOffset=currentBlock.blockContents.length-withoutInitialWhitespace.length),offsetAdjustment=whitespaceOffset+getOffsetAdjustmentDueToBrowserQuirks(currentBlock.blockContents,offset,elementHadANeoTagJoin)),result={offset:charIndex+offset+offsetAdjustment,endOfElement:currentBlock.endIndex};closeTagAfterCheck&&(levelCounter=currentPath.pop()+1),charIndex=currentBlock.endIndex,currentBlock=getNextBlock(content,charIndex)}return Boundless.Logger.error("warning: xpath not found (end)"),result={offset:content.length,endOfElement:content.length}},parseXPath=function(xpath){var intStrings;return intStrings=xpath.substring(3,xpath.length-1).split("]/*["),_.map(intStrings,function(valString){return parseInt(valString)})},HighlightProcessor}())}.call(this),function(){String.prototype.to_snake=function(){return this.replace(/[A-Z]/g,function(match,pos){return(pos>0?"_":"")+match.toLowerCase()})}}.call(this),function(){/iPad|iPhone|iPod/g.test(navigator.userAgent)&&!function($){return $.fn.focus=function(){return arguments[0]}}(jQuery)}.call(this),function(){var LegacyButton;LegacyButton=function(){function LegacyButton(element,options){this.$element=$(element),this.options=$.extend({},$.fn.button.defaults,options)}return LegacyButton.prototype.setState=function(state){var $el,d,data,val;return d="disabled",$el=this.$element,data=$el.data(),val=$el.is("input")?"val":"html",state+="Text",data.resetText||$el.data("resetText",$el[val]()),setTimeout(function(){return"loadingText"===state?$el.addClass(d).attr(d,d):$el.removeClass(d).removeAttr(d)},0)},LegacyButton.prototype.toggle=function(){var $parent;return $parent=this.$element.closest('[data-toggle="buttons-radio"]'),$parent&&$parent.find(".active").removeClass("active"),this.$element.toggleClass("active")},LegacyButton}(),$.fn.legacyButton=function(option){return this.each(function(){var data,options;return this.$el=$(this),data=this.$el.data("button"),options="object"==typeof option&&option,data||this.$el.data("button",data=new LegacyButton(this,options)),"toggle"===option?data.toggle():option?data.setState(option):void 0})},$(document).on("click.button.data-api","[data-toggle^=button]",function(e){var $btn;return $btn=$(e.target),$btn.hasClass("btn")||($btn=$btn.closest(".btn")),$btn.legacyButton("toggle")})}.call(this),function(){var slice=[].slice;boundless_module("Boundless"),window.Boundless.AsyncQueue=Boundless.AsyncQueue=function(){function AsyncQueue(options){null==options&&(options={}),this.timeout=options.timeout||5e3,this.timeout_callback=options.timeout_callback||function(_this){return function(){return"undefined"!=typeof console&&null!==console?console.error("Function didn't return in time..."):void 0}}(this),this.queue=[]}return AsyncQueue.prototype.enqueue=function(func){return this.queue.push(func),this._ensure_processing_queue()},AsyncQueue.prototype._ensure_processing_queue=function(){return this.running_queue||0===this.queue.length?void 0:(this.running_queue=!0,setTimeout(function(_this){return function(){var after_complete_callback,next_func,next_func_callback,timeout_func;return next_func=_this.queue.shift(),timeout_func=function(){return _this.running_queue=!1,setTimeout(function(){return _this.timeout_callback()},0),_this._ensure_processing_queue()},after_complete_callback=function(){return _this.running_queue=!1,_this._ensure_processing_queue()},next_func_callback=_this._timeout_if_not_called(after_complete_callback,timeout_func,_this.timeout),next_func(next_func_callback)}}(this),0))},AsyncQueue.prototype._timeout_if_not_called=function(func,timeout_callback,timeout){var func_started;return func_started=!1,setTimeout(function(_this){return function(){return func_started?void 0:timeout_callback()}}(this),timeout),function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],func_started=!0,func.apply(null,args)}}(this)},AsyncQueue}()}.call(this),function(){boundless_module("Boundless"),Boundless.Learnosity=function(){function Learnosity(){}return Learnosity.addErrorHandler=function(options,api_name,context){return options=_.clone(options||{}),options.errorListener||(options.errorListener=function(_this){return function(error){return Honeybadger.notify(error,{message:error.detail,name:api_name+": "+error.msg+" ("+error.code+")",context:{learnosity_context:context}})}}(this)),options},Learnosity.init_app=function(init_options,event_options){var context,updated_event_options;return context=init_options,updated_event_options=this.addErrorHandler(event_options,"LearnosityApp",context),LearnosityApp.init(init_options,updated_event_options)},Learnosity.init_assess=function(init_options,id,event_options){var context,updated_event_options;return context=init_options,updated_event_options=this.addErrorHandler(event_options,"LearnosityAssess",context),"function"==typeof LearnosityAssess.reset&&LearnosityAssess.reset(),LearnosityAssess.init(init_options,id,updated_event_options)},Learnosity.init_question_editor=function(init_options){var context,updated_init_options;return context=init_options,updated_init_options=this.addErrorHandler(init_options,"LearnosityQuestionEditor",context),updated_init_options.assetRequest=this.asset_request,"function"==typeof LearnosityQuestionEditor.reset&&LearnosityQuestionEditor.reset(),LearnosityQuestionEditor.init(updated_init_options)},Learnosity.asset_request=function(media_requested,return_type,callback,attributes){return Boundless.Filepicker.pick_and_store(function(blobs){var blob,i,j,len,len1,results,results1;switch(return_type){case"URL":case"UrlHeightWidth":for(results=[],i=0,len=blobs.length;len>i;i++)blob=blobs[i],results.push(callback(blob.url));return results;case"HTML":for(results1=[],j=0,len1=blobs.length;len1>j;j++)blob=blobs[j],results1.push(callback(Boundless.Filepicker.img(blob)));return results1}})},Learnosity}()}.call(this),function(){boundless_module("Boundless"),Boundless.Filepicker=function(){function Filepicker(){}return Filepicker.authenticate=function(){return filepicker.setKey(window.Boundless.FILESTACK_KEY)},Filepicker.picker_options={multiple:!1,container:"modal",services:["COMPUTER","URL","FLICKR","AUDIO","CONVERT"]},Filepicker.store_options={path:"questions/",location:"s3",storeContainer:"boundless-ugc",access:"public"},Filepicker.pick_and_store=function(success,error,progress){return this.authenticate(),filepicker.pickAndStore(this.picker_options,this.store_options,success,error,progress)},Filepicker.img=function(blob){var handle,parser;return parser=document.createElement("a"),parser.href=blob.url,handle=parser.pathname.split("/")[3],('<img src="'+blob.url+'"              data-filestack-handle="'+handle+'"   data-size="'+blob.size+'"            data-s3-bucket="'+blob.container+'"  data-s3-object="'+blob.key+'">').replace(/\s+/gm," ")},Filepicker}()}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Base||(Boundless.Base={}),Boundless.VIEW_PATHS||(Boundless.VIEW_PATHS=[]),Boundless.append_view_path=function(path){return Boundless.VIEW_PATHS.push(path)},Boundless.Base.View=function(superClass){function View(){return this.partial=bind(this.partial,this),View.__super__.constructor.apply(this,arguments)}return extend(View,superClass),View.prototype.render=function(template_name,context){return null==template_name&&(template_name=this.template),null==context&&(context={}),this.$el.html(this.view(template_name,context)),null!=this.attributes&&("Function"===TypeHelper.get_type(this.attributes)?this.$el.attr(this.attributes()):this.$el.attr(this.attributes)),this.delegateEvents(),this.setup_autoselects(),this.setup_dates(),Modernizr.placeholder===!1&&this.$("input").placeholder(),this},View.prototype.view=function(name,context){var template;if(null==context&&(context={}),template=this.template_function(name),null!=template)return template(this.view_context(context));throw"Could not find template: "+name},View.prototype.template_function=function(name){var haml,i,len,path,ref;for(ref=Boundless.VIEW_PATHS,i=0,len=ref.length;len>i;i++)if(path=ref[i],haml=HAML[path+"/"+name],null!=haml)return haml},View.prototype.view_context=function(context){var binding,binding_name,helper,i,len,ref,ref1;if(null==context&&(context={}),null!=this.helper_methods)for(ref=this.helper_methods,i=0,len=ref.length;len>i;i++)helper=ref[i],context[helper]=this[helper];null!=this.model&&(context.model=this.model),null!=this.collection&&(context.collection=this.collection),ref1=_.clone(_.result(this,"bindingSources"));for(binding_name in ref1)binding=ref1[binding_name],context[binding_name]=binding;return context=_.extend({},ViewHelpers,context),context.partial=this.partial,context},View.prototype.partial=function(template_name,context){return null==context&&(context={}),this.view(template_name,context)},View.prototype.handleKeypressTrigger=function(keyCode,handler){return(keyCode===KeyCode.ENTER||keyCode===KeyCode.SPACE)&&"function"==typeof handler?handler():void 0},View.prototype.setup_dates=function(){return this.$("[data-date-selector]").each(function(_this){return function(index,node){var input;return input=$(node),input.pickadate({format:input.data("date-selector")}),input.pickadate("picker").on("open",function(){var picker_bottom,window_bottom;return picker_bottom=$(".picker__frame").offset().top+$(".picker__frame").outerHeight(),window_bottom=$(window).scrollTop()+$(window).height(),picker_bottom>window_bottom?$(".picker--opened").css("margin-top",-1*(picker_bottom-window_bottom+25)+"px"):void 0}),input.pickadate("picker").on("set",function(context){var date_set;return date_set=null!=_this.className?_this.className+"--date-set":"date-set",_this.$el.addClass(date_set),_this.trigger("date:set",context)}),Modernizr.ismobile?input.pickadate("picker").on("open",function(){return $(".sheet-curtain").scrollTo(".picker__input--active")}):void 0}}(this))},View.prototype.setup_autoselects=function(){return this.$("[data-school-selector]").not('[type="hidden"]').each(function(_this){return function(index,node){var $results_div,id_input,input,offsets,ref,show_selection;return input=$(node),input.parent().css({position:"relative"}),id_input=input.siblings("#"+input.data("school-selector")),show_selection=function(model){var $rendered_template,clearInput,markup,offsets,selected_template;return markup="<div class='school-autocomplete-selected-element "+(input.hasClass("disabled")?"disabled":"")+"' "+(input.attr("disabled")?"disabled=disabled":"")+" >",input.attr("disabled")||input.hasClass("disabled")||(markup+='<a class="school-autoselect-clear" role="button" tabindex=0 aria-label="Clear"><i class="icon-pencil"></i></a>'),markup+="<%= name %></div>",selected_template=_.template(markup),$rendered_template=$(selected_template(model.attributes)),offsets=input.position(),input.attr("aria-activedescendant",""),input.parent().find(".school-autocomplete-selected-element").remove(),input.parent().append($rendered_template),$rendered_template.css({position:"absolute",top:0,left:0,bottom:0,right:0,overflow:"hidden","text-overflow":"ellipsis","white-space":"nowrap",lineHeight:input.outerHeight()+"px"}),clearInput=function(){return id_input.val(null),input.val(null),$rendered_template.remove(),input.focus()},$rendered_template.find(".school-autoselect-clear").keypress(function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?clearInput():void 0}),$rendered_template.find(".school-autoselect-clear").click(clearInput)},offsets=input.position(),$results_div=$("<div class='school-autocomplete-results'></div>"),$results_div.css({position:"absolute",top:offsets.top+input.outerHeight()+5,left:offsets.left,width:input.outerWidth(),display:"none"}),input.offsetParent().append($results_div),new Backbone.AutocompleteList({url:function(){return Boundless.API+"/schools?contains="+input.val()},filter:null,results:$results_div,el:input,template:_.template("<div><%= name %></div>"),minLength:3,value:function(model){return id_input.val(model.get("id")),show_selection(model),model.get("name")}}),(null!=(ref=id_input.val())?ref.length:void 0)?show_selection({attributes:{name:input.val()}}):void 0}}(this))},View}(Backbone.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Atom=function(superClass){function Atom(){return Atom.__super__.constructor.apply(this,arguments)}return extend(Atom,superClass),Atom.prototype.urlRoot=function(){return Boundless.API+"/atoms"},Atom.prototype.relations={highlights:"Boundless.HighlightCollection",key_terms:"Boundless.AtomKeyTermCollection",atom_key_terms:"Boundless.AtomKeyTermCollection",media:{klass:"Boundless.MediaCollection",reverse_relation:"atom"},attributions:"Boundless.AttributionCollection",learning_objectives:"Boundless.LearningObjectiveCollection"},Atom.prototype.save_attributes=function(){var attrs;return attrs=_.pick(this.attributes,"brief_mido","text_mido"),this.supports_feature("key_points")&&(attrs.key_points_mido=this.get("key_points_mido")),this.supports_feature("examples")&&(attrs.examples_mido=this.get("examples_mido")),this.supports_feature("atom_key_terms")&&(attrs.atom_key_terms_attributes=this.get("atom_key_terms").map(function(atom_key_term){return atom_key_term.save_attributes()})),this.supports_feature("learning_objectives")&&(attrs.learning_objectives_attributes=this.get("learning_objectives").filter(function(learning_objective){var block,ref,ref1;return block=learning_objective.get("text_mido")[0],block&&((null!=(ref=block.text)?ref.length:void 0)>0||(null!=(ref1=block.customTags)?ref1.length:void 0)>0)}).map(function(learning_objective){return learning_objective.save_attributes()})),attrs.attributions_attributes=this.get("attributions").map(function(attribution){return attribution.save_attributes()}),attrs.media_attributes=this.get("media").map(function(media){return media.atom_save_json()}),attrs.brief_mido=_.filter(attrs.brief_mido,function(block){var ref,ref1;return(null!=(ref=block.text)?ref.length:void 0)>0||(null!=(ref1=block.customTags)?ref1.length:void 0)>0}),attrs.text_mido=_.filter(attrs.text_mido,function(block){var ref,ref1;return(null!=(ref=block.text)?ref.length:void 0)>0||(null!=(ref1=block.customTags)?ref1.length:void 0)>0||null!=block.attributes&&null!=block.attributes.mediaId}),attrs.key_points_mido=_.filter(attrs.key_points_mido,function(block){var ref,ref1;return(null!=(ref=block.text)?ref.length:void 0)>0||(null!=(ref1=block.customTags)?ref1.length:void 0)>0}),attrs.examples_mido=_.filter(attrs.examples_mido,function(block){var ref,ref1;return(null!=(ref=block.text)?ref.length:void 0)>0||(null!=(ref1=block.customTags)?ref1.length:void 0)>0}),attrs},Atom.prototype.attachHighlights=function(){return this.get("highlights").forEach(function(_this){return function(highlight){return _this.attachHighlight(highlight)}}(this))},Atom.prototype.attachHighlight=function(highlight){var block,highlightable,i,j,k,l,len,len1,len2,len3,ref,ref1,ref2,ref3,results,results1,results2,results3;switch(highlight.get("type")){case"OneLinerHighlight":for(ref=this.get("brief_mido"),results=[],i=0,len=ref.length;len>i;i++)block=ref[i],block.id===highlight.get("mido_block_id")?(highlightable=_.filter(block.textTags,{tagType:"highlightable"})[0],results.push(highlightable.attributes.highlight=highlight)):results.push(void 0);return results;case"KeyPointHighlight":for(ref1=this.get("key_points_mido"),results1=[],j=0,len1=ref1.length;len1>j;j++)block=ref1[j],block.id===highlight.get("mido_block_id")?(highlightable=_.filter(block.textTags,{tagType:"highlightable"})[0],results1.push(highlightable.attributes.highlight=highlight)):results1.push(void 0);return results1;case"KeyTermHighlight":return this.get("atom_key_terms").get(highlight.get("atom_key_term_id")).set("highlight",highlight);case"ExampleHighlight":for(ref2=this.get("examples_mido"),results2=[],k=0,len2=ref2.length;len2>k;k++)block=ref2[k],block.id===highlight.get("mido_block_id")?(highlightable=_.filter(block.textTags,{tagType:"highlightable"})[0],results2.push(highlightable.attributes.highlight=highlight)):results2.push(void 0);return results2;case"FullTextHighlight":for(ref3=this.get("text_mido"),results3=[],l=0,len3=ref3.length;len3>l;l++)block=ref3[l],block.id===highlight.get("mido_block_id")?(highlightable=_.filter(block.textTags,{tagType:"highlightable"})[highlight.get("highlightable_index")],results3.push(highlightable.attributes.highlight=highlight)):results3.push(void 0);return results3;default:throw"Unrecognized highlight type: "+highlight.get("type")}},Atom.prototype.supports_feature=function(feature){return _.contains(this.get("template_features_array"),feature)},Atom.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"title",{allow_blank:!1,allow_null:!1,message:"Title can't be blank."}),Atom.__super__.validate.call(this,attrs)},Atom}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AtomCommit=function(superClass){function AtomCommit(){return AtomCommit.__super__.constructor.apply(this,arguments)}return extend(AtomCommit,superClass),AtomCommit}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AtomKeyTerm=function(superClass){function AtomKeyTerm(){return AtomKeyTerm.__super__.constructor.apply(this,arguments)}return extend(AtomKeyTerm,superClass),AtomKeyTerm.prototype.urlRoot=function(){return Boundless.API+"/atom_key_terms"},AtomKeyTerm.prototype.defaults={part_of_speech:"noun"},AtomKeyTerm.prototype.paramRoot="atom_key_term",AtomKeyTerm.parts_of_speech=function(){return["noun","pronoun","adjective","verb","adverb","preposition","conjunction","interjection","proper noun"]},AtomKeyTerm.prototype.save_attributes=function(){return _.pick(this.attributes,"id","key_term_id","part_of_speech","definition_mido")},AtomKeyTerm}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Attribution=function(superClass){function Attribution(){return Attribution.__super__.constructor.apply(this,arguments)}return extend(Attribution,superClass),Attribution.prototype.urlRoot=function(){return Boundless.API+"/attributions"},Attribution.prototype.paramRoot="attribution",Attribution.prototype.require_origin=!1,Attribution.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.get("user_created")===!0?(this.validates_boolean(attrs,"user_created_agreement",{allow_null:!1,must_be:!0,message:"You must agree to the licensing terms."}),this.errors.is_empty()&&this.set({license_id:10,url:null,name:""+session.current_user.name(),title:"Original figure by "+session.current_user.name()+". Licensed CC BY-SA 4.0"})):this.get("user_created")!==!1&&this.require_origin?this.errors.add("user_created","Please specify the origin."):this.validate_user_discovered(attrs),Attribution.__super__.validate.call(this,attrs)},Attribution.prototype.validate_user_discovered=function(attrs){return this.validates_presence_of(attrs,"name",{allow_blank:!1,allow_null:!1,message:"You must provide a name for this attribution."}),this.validates_url(attrs,"url",{allow_blank:!1,allow_null:!1,message:"You must provide a valid url."}),this.validates_presence_of(attrs,"title",{allow_blank:!1,allow_null:!1,message:"You must title the attribution."}),this.validates_presence_of(attrs,"license_id",{allow_blank:!1,allow_null:!1,message:"Please select an applicable license."})},Attribution.prototype.save_attributes=function(){return _.pick(this.attributes,"id","title","name","url","license_id","user_created","user_created_agreement")},Attribution}(BackRails.Model),Boundless.FigureAttribution=function(superClass){function FigureAttribution(){return FigureAttribution.__super__.constructor.apply(this,arguments)}return extend(FigureAttribution,superClass),FigureAttribution.prototype.require_origin=!0,FigureAttribution}(Boundless.Attribution)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Boundless.Book=function(superClass){function Book(){return Book.__super__.constructor.apply(this,arguments)}return extend(Book,superClass),Book.prototype.urlRoot=function(){return Boundless.API+"/books"},Book.prototype.paramRoot="book",Book.prototype.members={fetch_highlights_by_chapter:"highlights_by_chapter"},Book.prototype.relations={subject_tag:"Boundless.SubjectTag",creator:"Boundless.User"},Book.prototype.event_properties=function(){var props;return props={student:session.current_user.get("student"),educator:session.current_user.get("educator"),expert:session.current_user.get("expert"),subject_tag:this.get("subject_tag").get("name"),subject_tag_id:this.get("subject_tag").id,id:this.get("id"),title:this.get("title"),author:this.get("author"),admin:session.current_user.get("admin")}},Book.prototype.find_chapter_by_number_or_param=function(number,param){return null!=number?this.find_chapter_by_number(number):this.find_chapter(param)},Book.prototype.find_chapter_by_number=function(number){var chapter;return(chapter=_.find(this.get("chapters"),function(_this){return function(ch){return ch.number===number}}(this)))?this.find_or_create_chapter(chapter):null},Book.prototype.find_chapter=function(id_or_slug){var chapter,index;return chapter=_.find(this.get("chapters"),function(_this){return function(ch){return ch.id===id_or_slug||ch.slug===id_or_slug}}(this)),index=_.indexOf(this.get("chapters"),chapter),index>=0?this.find_or_create_chapter(_.extend({number:index+1},chapter)):null},Book.prototype.find_or_create_chapter=function(chapter_attributes){var chapter;return chapter=reader.book.chapter_cache.get(chapter_attributes.id),null!=chapter?chapter:(reader.book.chapter_cache.add(_.extend({book_id:this.id},chapter_attributes)),reader.book.chapter_cache.get(chapter_attributes.id))},Book.prototype.first_concept=function(){return new Boundless.Concept(this.get("chapters")[0].sections[0].concepts[0])},Book.prototype.basic_data_for_atom_id=function(atom_id){var chapter,chapter_index,concept,concept_index,data,j,k,l,len,len1,len2,ref,ref1,ref2,section,section_index;for(data={},ref=this.get("chapters"),chapter_index=j=0,len=ref.length;len>j;chapter_index=++j){for(chapter=ref[chapter_index],ref1=chapter.sections,section_index=k=0,len1=ref1.length;len1>k;section_index=++k){for(section=ref1[section_index],ref2=section.concepts,concept_index=l=0,len2=ref2.length;len2>l;concept_index=++l)if(concept=ref2[concept_index],concept.atom_id===atom_id){data.chapter_id=chapter.id,data.section_id=section.id,data.concept_id=concept.id;break}if(null!=data.chapter_id)break}if(null!=data.chapter_id)break}return data},Book.prototype.data_for_atom_id=function(atom_id){var chapter,chapter_index,concept,concept_index,data,j,k,l,len,len1,len2,ref,ref1,ref2,section,section_index;for(data={},ref=this.get("chapters"),chapter_index=j=0,len=ref.length;len>j;chapter_index=++j){for(chapter=ref[chapter_index],ref1=chapter.sections,section_index=k=0,len1=ref1.length;len1>k;section_index=++k){for(section=ref1[section_index],ref2=section.concepts,concept_index=l=0,len2=ref2.length;len2>l;concept_index=++l)if(concept=ref2[concept_index],concept.atom_id===atom_id){data.chapter=chapter,data.chapter_number=chapter_index+1,data.section=new Boundless.Section(_.extend({book_id:this.id,chapter_id:chapter.id},section)),data.section_number=section_index+1,data.concept=data.section.get("concepts").at(concept_index);break}if(null!=data.chapter)break}if(null!=data.chapter)break}return data},Book.prototype.search_titles=function(query){var chapter,chapter_index,chapter_path,chapter_short_path,con_index,concept,concept_path,concept_short_path,filtered_titles,j,k,l,len,len1,len2,query_split,ref,ref1,ref2,scored_titles,sec_index,section,section_path,section_short_path,t;if(null==this.titles)for(this.titles=[],ref=this.get("chapters"),chapter_index=j=0,len=ref.length;len>j;chapter_index=++j)for(chapter=ref[chapter_index],chapter_path="Chapter "+(chapter_index+1),chapter_short_path="<strong>"+(chapter_index+1)+"</strong>",this.titles.push({title:chapter.title,type:"chapter",path:chapter_path,short_path:chapter_short_path,chapter_number:chapter_index+1,chapter_index:chapter_index,id:chapter.id}),ref1=chapter.sections,sec_index=k=0,len1=ref1.length;len1>k;sec_index=++k)for(section=ref1[sec_index],section_path=chapter_path+" > Section "+(sec_index+1),section_short_path=chapter_short_path+"."+(sec_index+1),this.titles.push({title:section.title,type:"section",path:section_path,short_path:section_short_path,section_number:sec_index+1,chapter_number:chapter_index+1,id:section.id,chapter_index:chapter_index,section_index:sec_index}),ref2=section.concepts,con_index=l=0,len2=ref2.length;len2>l;con_index=++l)concept=ref2[con_index],concept_path=section_path+" > Concept "+(con_index+1),concept_short_path=section_short_path+"."+(con_index+1),this.titles.push({title:concept.title,type:"concept",path:concept_path,short_path:concept_short_path,chapter_number:chapter_index+1,chapter_id:chapter.id,section_number:sec_index+1,concept_number:con_index+1,id:concept.id,chapter_index:chapter_index,section_index:sec_index,concept_index:con_index});return query_split=query.trim().toLowerCase().split(/\s+/),scored_titles=this.titles.map(function(title_obj){var i,len3,len4,m,matched_title_terms,n,query_term,query_term_escaped,score,term_regex,term_score,title_split,title_term,valid;for(title_split=title_obj.title.trim().split(/\s+/),score=0,valid=!0,matched_title_terms=[],m=0,len3=query_split.length;len3>m;m++){for(query_term=query_split[m],term_score=-1,i=n=0,len4=title_split.length;len4>n;i=++n)if(title_term=title_split[i],!(indexOf.call(matched_title_terms,i)>=0)&&(term_score=title_term.toLowerCase().indexOf(query_term),-1!==term_score)){matched_title_terms.push(i),query_term_escaped=query_term.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&"),
term_regex=new RegExp("("+query_term_escaped+")","i"),title_split[i]=title_split[i].replace(term_regex,"<em>$1</em>"),term_score+=i/10;break}score+=term_score,-1===term_score&&(valid=!1)}return valid?(title_obj.display_title=title_split.join(" "),title_obj.score=score+(1-1/(title_split.length+1))/100):title_obj.score=-1,title_obj}),filtered_titles=function(){var len3,m,results;for(results=[],m=0,len3=scored_titles.length;len3>m;m++)t=scored_titles[m],t.score>=0&&results.push(t);return results}(),filtered_titles.sort(function(a,b){return a.score-b.score}),filtered_titles},Book.prototype.search_for_atoms=function(atom_objs){var atom_obj,chapter,chapter_path,chapter_short_path,concept,concept_objs,j,k,l,len,len1,len2,len3,m,ref,ref1,ref2,section,section_path,section_short_path;for(concept_objs=atom_objs,ref=this.get("chapters"),j=0,len=ref.length;len>j;j++)for(chapter=ref[j],chapter_path="Chapter "+chapter.number,chapter_short_path=""+chapter.number,ref1=chapter.sections,k=0,len1=ref1.length;len1>k;k++)for(section=ref1[k],section_path=chapter_path+" > Section "+section.number,section_short_path=chapter_short_path+"."+section.number,ref2=section.concepts,l=0,len2=ref2.length;len2>l;l++)for(concept=ref2[l],m=0,len3=concept_objs.length;len3>m;m++)atom_obj=concept_objs[m],concept.atom_id===atom_obj.atom_id&&(atom_obj.chapter_number=chapter.number,atom_obj.chapter_id=chapter.id,atom_obj.section_number=section.number,atom_obj.concept_id=concept.id,atom_obj.path=section_path+" > "+concept.title,atom_obj.short_path=section_short_path+"."+concept.number);return concept_objs},Book.prototype.parse=function(response){return null==response&&(response={}),this.chapter_cache=new Boundless.ChapterCollection,this.section_cache=new Boundless.SectionCollection,this.concept_cache=new Boundless.ConceptCollection,this.read_atom_ids=response.read_atom_ids||[],response.last_read_concept&&this.set("last_read_concept",new Boundless.Concept(response.last_read_concept)),this.quick_quiz_ids=response.quick_quizzes_completed||[],this.highlights_by_chapter=response.highlights_by_chapter||[],this.last_chapter_highlighted=response.last_chapter_highlighted||null,_.omit(response,["read_atom_ids","last_read_concept","quick_quiz_ids"])},Book.prototype.was_created_by_current_user=function(){return null!=this.get("creator_id")&&this.get("creator_id")===session.current_user.id},Book.prototype.is_boundless=function(){return"boundless"===this.get("book_type")},Book.prototype.is_alignment=function(){return"alignment"===this.get("book_type")},Book.prototype.is_community=function(){return"community"===this.get("book_type")},Book.prototype.is_custom=function(){return"custom"===this.get("book_type")},Book.prototype.display_title=function(){return this.is_alignment()?this.get("subject_tag").get("name"):this.get("title")},Book.prototype.attribution_lines=function(short){var lines;return null==short&&(short=!0),lines=[],this.is_alignment()?lines.push(this.get("title")+" "+this.get("attribution")):lines.push(this.get("header_attribution")),lines},Book.prototype.analytics_attributes=function(){return{desired_book_type:this.get("book_type"),desired_book_lines:this.attribution_lines(),desired_book_title:this.get("title"),desired_book_id:this.id,desired_book_permalink:this.get("friendly_id"),desired_book_subject_permalink:this.get("subject_tag").get("permalink"),desired_book_subject_name:this.get("subject_tag").get("name")}},Book.prototype.ecommerce_data=function(){return{id:this.id,sku:this.get("product_isbn_13"),name:this.get("title"),price:this.get("base_price"),category:this.get("subject_tag").get("name"),brand:"Boundless"}},Book}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookSearch=function(superClass){function BookSearch(){return BookSearch.__super__.constructor.apply(this,arguments)}return extend(BookSearch,superClass),BookSearch.prototype.paramRoot="search",BookSearch.prototype.urlRoot=function(){return Boundless.API+"/searches"},BookSearch}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BrightspaceModule=function(superClass){function BrightspaceModule(){return BrightspaceModule.__super__.constructor.apply(this,arguments)}return extend(BrightspaceModule,superClass),BrightspaceModule.prototype.urlRoot=function(){return Boundless.API+"/brightspace/courses/"+this.get("course").get("external_tool_id")+"/modules"},BrightspaceModule}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ChangeNote=function(superClass){function ChangeNote(){return ChangeNote.__super__.constructor.apply(this,arguments)}return extend(ChangeNote,superClass),ChangeNote.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"text",{allow_blank:!1,allow_null:!1,message:"Please provide a note about your changes."}),ChangeNote.__super__.validate.call(this,attrs)},ChangeNote}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Chapter=function(superClass){function Chapter(){return Chapter.__super__.constructor.apply(this,arguments)}return extend(Chapter,superClass),Chapter.prototype.paramRoot="chapter",Chapter.prototype.urlRoot=function(){return Boundless.API+"/books/"+this.get("book_id")+"/chapters"},Chapter.prototype.members=["pptx"],Chapter.prototype.display_name="Chapter",Chapter.prototype.relations={sections:{klass:"Boundless.SectionCollection",reverse_relation:"chapter"},questions:{klass:"Boundless.QuestionCollection",reverse_relation:"chapter"},flashcards:{klass:"Boundless.FlashcardCollection",reverse_relation:"chapter"},lesson_sessions:{klass:"Boundless.LessonSessionCollection",reverse_relation:"chapter"},read_events:{klass:"Boundless.ReadEventCollection"}},Chapter.prototype.index=function(){return parseInt(this.get("index"))},Chapter.prototype.number=function(){return this.collection.indexOf(this)+1},Chapter.prototype.find_concept=function(id_or_slug){var concept,i,len,ref,section;if(concept=null,"Number"===TypeHelper.get_type(id_or_slug)&&(concept=reader.book.concept_cache.get(id_or_slug)),null===concept)for(ref=this.get("sections").models,i=0,len=ref.length;len>i&&(section=ref[i],concept=section.find_concept(id_or_slug),null==concept);i++);return concept},Chapter.prototype.next=function(){return reader.book.find_chapter_by_number(this.get("number")+1)},Chapter.prototype.prev=function(){return reader.book.find_chapter_by_number(this.get("number")-1)},Chapter.prototype.friendly_pptx_filename=function(){return("Chapter "+this.number()+" - "+this.get("title")+".pptx").replace(/[^a-zA-Z0-9 \.\-_]/g,"")},Chapter}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Code=function(superClass){function Code(){return Code.__super__.constructor.apply(this,arguments)}return extend(Code,superClass),Code}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Comment=function(superClass){function Comment(){return Comment.__super__.constructor.apply(this,arguments)}return extend(Comment,superClass),Comment.prototype.urlRoot=function(){return Boundless.API+"/comments"},Comment}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Concept=function(superClass){function Concept(){return Concept.__super__.constructor.apply(this,arguments)}return extend(Concept,superClass),Concept.prototype.paramRoot="concept",Concept.prototype.relations={atom:"Boundless.Atom"},Concept.prototype.initialize=function(){return Concept.__super__.initialize.apply(this,arguments),"undefined"!=typeof reader&&null!==reader&&reader.book.concept_cache.add(this),this},Concept.prototype.urlRoot=function(){return this.get("book_id")?Boundless.API+"/books/"+this.get("book_id")+"/concepts":Boundless.API+"/books/"+reader.book.id+"/concepts"},Concept.prototype.display_name="Concept",Concept.prototype.parent=function(){return this.section()},Concept.prototype.parent_collection=function(){return this.parent().get("concepts")},Concept.prototype.index=function(){return _.indexOf(this.parent_collection().pluck("id"),this.id)},Concept.prototype.number=function(){return this.index()+1},Concept.prototype.section=function(){var section;return null!=this.get("section")?this.get("section"):(section=this.chapter().get("sections").get(this.get("section_id")),this.set("section",section),section)},Concept.prototype.chapter=function(){return reader.book.find_chapter(this.get("chapter_id"))},Concept.prototype.thumbnail_url=function(size){var thumbnail_url_structure;return(thumbnail_url_structure=this.get("thumbnail_url_structure"))?ThumbnailHelper.best_for(thumbnail_url_structure,size,Boundless.RETINA):null},Concept.prototype.prev=function(){return this.has_prev_in_collection()?this.parent_collection().models[this.index()-1]:!1},Concept.prototype.next=function(){return this.has_next_in_collection()?this.parent_collection().models[this.index()+1]:this.parent().has_next_in_collection()?this.parent().next().get("concepts").first():!1},Concept.prototype.has_prev_in_collection=function(){return 0!==this.index()},Concept.prototype.has_next_in_collection=function(){return this.index()!==this.parent_collection().length-1},Concept}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ContactRequest=function(superClass){function ContactRequest(){return ContactRequest.__super__.constructor.apply(this,arguments)}return extend(ContactRequest,superClass),ContactRequest.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_email(attrs,"email",{allow_blank:!1,allow_null:!1,message:"Please enter a valid email address."}),this.validates_presence_of(attrs,"school_name",{allow_blank:!1,allow_null:!1,message:"Please enter your school name."}),this.validates_presence_of(attrs,"number_of_students",{allow_blank:!1,allow_null:!1,message:"Please enter the approximate number of students you intend to buy for."}),ContactRequest.__super__.validate.call(this,attrs)},ContactRequest}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Coupon=function(superClass){function Coupon(){return Coupon.__super__.constructor.apply(this,arguments)}return extend(Coupon,superClass),Coupon.prototype.url=function(){return Boundless.API+"/coupons/"+this.get("code")},Coupon}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;Boundless.Course=function(superClass){function Course(){return Course.__super__.constructor.apply(this,arguments)}return extend(Course,superClass),Course.prototype.paramRoot="course",Course.prototype.relations={book:"Boundless.Book",students:"Boundless.UserCollection"},Course.prototype.initialize=function(){return Course.__super__.initialize.apply(this,arguments),this.on("invalid",this.setup_relations,this),this},Course.prototype.urlRoot=function(){return Boundless.API+"/courses/"},Course.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),(null==attrs.school_id||""===attrs.school_id||0===attrs.school_id.length)&&null!=attrs.school_name&&attrs.school_name.length>0?this.validates_presence_of(attrs,"school_name",{allow_blank:!1,allow_null:!1,message:"School needs a name."}):this.validates_presence_of(attrs,"school_id",{allow_blank:!1,allow_null:!1,message:"School not found."}),this.validates_presence_of(attrs,"name",{allow_blank:!1,allow_null:!1}),Course.__super__.validate.call(this,attrs)},Course.prototype.schedule=function(short_days){var blocks,day_delim,days,daytime_delim,i,len,mt,period,ref,results,time,time_delim,wkday;for(null==short_days&&(short_days=!0),blocks={},day_delim=short_days?"":", ",time_delim=short_days?"-":" - ",daytime_delim=short_days?" ":": ",ref=this.get("meeting_times").ordered(),i=0,len=ref.length;len>i;i++)mt=ref[i],period=""+mt.get("start_time")+time_delim+mt.get("end_time"),wkday=mt.weekday(short_days&&"short"),blocks[period]?blocks[period]=""+blocks[period]+day_delim+wkday:blocks[period]=wkday;results=[];for(time in blocks)days=blocks[time],results.push(""+days+daytime_delim+time);return results},Course.prototype.schedule_string=function(){return this.schedule().join(", ")},Course.prototype.archive=function(options){return null==options&&(options={}),$.post(this.url()+"/archive",{},function(_this){return function(){return"function"==typeof options.success?options.success():void 0}}(this)).error(function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this.render()}}(this))},Course.prototype.current_user_can_edit=function(){return!this.get("archived")&&this.get("creator_id")===session.current_user.id},Course.prototype.is_lms=function(){return this.get("lms_provider")&&"boundless"!==this.get("lms_provider")},Course.prototype.lms_icon_name=function(){switch(this.get("lms_provider")){case"canvas":return"canvas";case"Blackboard Learn":return"blackboard";case"desire2learn":return"brightspace"}},Course.prototype.lms_name=function(){if(this.get("show_lms_tool_consumer_host"))return this.friendly_lms_host();switch(this.get("lms_provider")){case"canvas":return"Canvas";case"Blackboard Learn":return"Blackboard";case"desire2learn":return"Brightspace";case"Moodle":return"Moodle"}},Course.prototype.friendly_lms_host=function(){var url;return url=document.createElement("a"),url.href=this.get("lms_tool_consumer_host"),url.hostname},Course}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Credit=function(superClass){function Credit(){return Credit.__super__.constructor.apply(this,arguments)}return extend(Credit,superClass),Credit.prototype.urlRoot=function(){return session.current_user.url()+"/credits"},Credit}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreditCard=function(superClass){function CreditCard(){return CreditCard.__super__.constructor.apply(this,arguments)}return extend(CreditCard,superClass),CreditCard.prototype.validate=function(attrs){var card_type,expiration_data;return null==attrs&&(attrs=this.attributes),card_type=$.payment.cardType(attrs.card_number),$.payment.validateCardNumber(attrs.card_number)?this.errors.remove("card_number"):this.errors.add("card_number","Card number is invalid"),$.payment.validateCardCVC(attrs.card_cvc,card_type)?this.errors.remove("card_cvc"):this.errors.add("card_cvc","Card CVC is invalid"),expiration_data=$.payment.cardExpiryVal(attrs.card_exp),$.payment.validateCardExpiry(expiration_data.month,expiration_data.year)?this.errors.remove("card_exp"):this.errors.add("card_exp","Card expiration date is invalid"),this.validates_presence_of(attrs,"name_on_card",{allow_blank:!1,allow_null:!1}),CreditCard.__super__.validate.call(this,attrs)},CreditCard.prototype.exp_month=function(){return $.payment.cardExpiryVal(this.get("card_exp")).month},CreditCard.prototype.exp_year=function(){return $.payment.cardExpiryVal(this.get("card_exp")).year},CreditCard.prototype.stripe_object=function(){return{number:this.get("card_number"),cvc:this.get("card_cvc"),exp_month:this.exp_month(),exp_year:this.exp_year()}},CreditCard}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CustomerFeedback=function(superClass){function CustomerFeedback(){return CustomerFeedback.__super__.constructor.apply(this,arguments)}return extend(CustomerFeedback,superClass),CustomerFeedback.prototype.paramRoot="customer_feedback",CustomerFeedback.prototype.urlRoot=function(){return Boundless.API+"/customer_feedback"},CustomerFeedback.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_email(attrs,"email",{allow_blank:!1,allow_null:!1,message:"Please enter a valid email address."}),this.validates_presence_of(attrs,"subject",{allow_blank:!1,allow_null:!1,message:"This field can't be blank."}),this.validates_presence_of(attrs,"message_body",{allow_blank:!1,allow_null:!1,message:"This field can't be blank."}),CustomerFeedback.__super__.validate.call(this,attrs)},CustomerFeedback}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Degree=function(superClass){function Degree(){return Degree.__super__.constructor.apply(this,arguments)}return extend(Degree,superClass),Degree.prototype.paramRoot="degree",Degree.prototype.urlRoot=function(){return session.current_user.url()+"/degrees"},Degree.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"school_name",{allow_blank:!1,allow_null:!1,message:"School can't be blank"}),this.validates_presence_of(attrs,"degree",{allow_blank:!1,allow_null:!1}),this.validates_presence_of(attrs,"concentration",{allow_blank:!1,allow_null:!1}),Degree.__super__.validate.call(this,attrs)},Degree}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Embed=function(superClass){function Embed(){return Embed.__super__.constructor.apply(this,arguments)}return extend(Embed,superClass),Embed.prototype.paramRoot="media",Embed.prototype.urlRoot=function(){return Boundless.API+"/media/embed"},Embed.prototype.atom_save_attributes=["id","document_mido","video_stop","video_start"],Embed.prototype.initialize=function(){return null==this.attributes.type&&this.set("type","Embed"),Embed.__super__.initialize.apply(this,arguments)},Embed.prototype.atom_save_json=function(){return _.pick(this.toJSON(),this.atom_save_attributes)},Embed.prototype.is_youtube=function(){var ref;return"youtube"===(null!=(ref=this.get("provider"))?ref.toLowerCase():void 0)},Embed.prototype.youtube_id=function(){return $.url(this.get("source_url")).param("v")},Embed.prototype.safe_embed_url=function(){return Boundless.APP_URL+"/embed/media/"+this.get("id")+"/"},Embed.prototype.embed_url=function(){var params;return params={v:this.youtube_id(),version:3,autoplay:0,modestBranding:1,rel:0,showinfo:0,enablejsapi:1,theme:"light",color:"desaturated"},this.has("video_start")&&(params.start=this.get("video_start")),this.has("video_stop")&&(params.end=this.get("video_stop")),"//www.youtube.com/embed/"+this.youtube_id()+"?"+jQuery.param(params)},Embed.prototype.reload_metadata=function(callback){return $.getJSON("https://gdata.youtube.com/feeds/api/videos/"+this.youtube_id()+"?v=2&alt=json",function(_this){return function(json){var duration;return duration=parseInt(json.entry.media$group.yt$duration.seconds),_this.set({duration:duration}),"function"==typeof callback?callback():void 0}}(this))},Embed.seconds_to_youtube_time_string=function(seconds){return seconds||(seconds=0),Math.floor(seconds/60)+"m"+Math.floor(seconds%60)+"s"},Embed.youtube_time_string_to_seconds=function(string){var parts;return parts=string.split(/m|s/),60*Number(parts[0])+Number(parts[1])},Embed.prototype.has_start_and_end_times=function(){return this.get("video_end")},Embed}(BackRails.Model)}.call(this),function(){}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Favorite=function(superClass){function Favorite(){return Favorite.__super__.constructor.apply(this,arguments)}return extend(Favorite,superClass),Favorite.prototype.paramRoot="favorite",Favorite.prototype.urlRoot=function(){return Boundless.API+"/favorites"},Favorite}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Flag=function(superClass){function Flag(){return Flag.__super__.constructor.apply(this,arguments)}return extend(Flag,superClass),Flag.prototype.paramRoot="flag",Flag.VALID_FEEDBACK_TYPES={"spelling-grammar":"Spelling or grammar mistakes","concept-not-explained-clearly":"Concept not explained clearly","needs-different-information":"Material should be added or deleted","somethings-busted":"Something on this page is not working",other:"Other"},Flag.FEEDBACK_PROMPT_FOR_TYPE={"spelling-grammar":"Please tell us where the mistake is and how to fix it.","concept-not-explained-clearly":"Please tell us what is confusing and how to improve it.","needs-different-information":"Please tell us what material you would add or what material is inaccurate or irrelevant.","somethings-busted":"Please tell us what went wrong and which device/browser you are using.",other:"Please be as specific as possible so we can resolve your feedback.","too-easy":"What makes this question too easy?","too-hard":"What makes this question too hard?","doesnt-match-question":"Please feel free to add more information."},Flag.VALID_QUESTION_FEEDBACK_TYPES={"too-easy":"Too easy","too-hard":"Too hard","doesnt-match-question":"Answer choices don't match the question","somethings-busted":"Something on this page is not working",other:"Other"},Flag.prototype.urlRoot=function(){return Boundless.API+"/flags"},Flag}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Flashcard=function(superClass){function Flashcard(){return Flashcard.__super__.constructor.apply(this,arguments)}return extend(Flashcard,superClass),Flashcard.prototype.concept_path=function(){var data;return data=reader.book.data_for_atom_id(this.get("atom_id")),"book_stack:toc/chapter/concept?chapter_id="+data.chapter.id+"&concept_id="+data.concept.id},Flashcard.prototype.definition_without_term=function(){var re;return re=new RegExp(this.get("term"),"gi"),this.get("definition").replace(re,"________")},Flashcard}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.FlashcardResponse=function(superClass){function FlashcardResponse(){return FlashcardResponse.__super__.constructor.apply(this,arguments)}return extend(FlashcardResponse,superClass),FlashcardResponse.prototype.urlRoot=function(){return Boundless.API+"/books/"+reader.book.id+"/flashcard_responses"},FlashcardResponse}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Graph=function(superClass){function Graph(){return Graph.__super__.constructor.apply(this,arguments)}return extend(Graph,superClass),Graph.prototype.relations={projections:{klass:"Boundless.ProjectionCollection",reverse_relation:"media"}},Graph.prototype.atom_save_attributes=["id","document_mido","attribution_attributes","graph_state"],Graph.prototype.paramRoot="graph",Graph.prototype.urlRoot=function(){return Boundless.API+"/graphs"},Graph.prototype.initialize=function(){return null==this.attributes.type&&this.set("type","Graph"),Graph.__super__.initialize.apply(this,arguments)},Graph.prototype.atom_save_json=function(){return _.pick(this.toJSON(),this.atom_save_attributes)},Graph.prototype.url_for=function(size){var projection;return projection=this.get("projections").find(function(projection){return projection.get("retina")===Boundless.RETINA&&projection.get("size")===size}),null!=projection?projection.image_url():"https://pbs.twimg.com/profile_images/378800000406479116/2d573bdce0ef68c7336007aaa88202f5.png"},Graph.prototype.reference=function(){return _.find(this.get("atom").get("media_refs"),function(_this){return function(media_ref){return media_ref.media_id===_this.id}}(this))},Graph}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Highlight=function(superClass){function Highlight(){return Highlight.__super__.constructor.apply(this,arguments)}return extend(Highlight,superClass),Highlight.prototype.paramRoot="highlight",Highlight.prototype.urlRoot=function(){if(null!=this.get("book_id"))return Boundless.API+"/books/"+this.get("book_id")+"/highlights";if("undefined"!=typeof reader&&null!==reader)return Boundless.API+"/books/"+reader.book.id+"/highlights";if(null!=("undefined"!=typeof lesson&&null!==lesson?lesson.lesson_provider:void 0))return Boundless.API+"/books/"+lesson.lesson_provider.get("book_id")+"/highlights";throw"Error getting book_id for highlight"},Highlight.prototype.initialize=function(){return this.set_objects(),this.on("change",function(_this){return function(){return _this.set_objects()}}(this)),Highlight.__super__.initialize.apply(this,arguments)},Highlight.prototype.set_objects=function(){return this.created_at=moment(this.get("created_at")).fromNow()},Highlight.prototype.has_note=function(){return!_.isEmpty(this.get("note"))},Highlight.prototype.note_text=function(){return this.get("note")},Highlight.prototype.highlighted_text=function(){return this.get("text")},Highlight.prototype.highlight_type=function(){return this.get("type")},Highlight.prototype.highlight_object_id=function(){switch(this.get("type")){case"KeyTermHighlight":return this.get("key_term_id")}},Highlight}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Image=function(superClass){function Image(){return Image.__super__.constructor.apply(this,arguments)}return extend(Image,superClass),Image.prototype.paramRoot="image",Image.prototype.urlRoot=function(){return Boundless.API+"/images"},Image.prototype.relations={projections:{klass:"Boundless.ProjectionCollection",reverse_relation:"media"},attribution:{klass:"Boundless.FigureAttribution",serialize_as:"attribution_attributes"}},Image.prototype.atom_save_attributes=["id","document_mido","attribution_attributes","text_equivalent"],Image.prototype.initialize=function(){return null==this.attributes.type&&this.set("type","Image"),Image.__super__.initialize.apply(this,arguments)},Image.prototype.atom_save_json=function(){return _.pick(this.toJSON(),this.atom_save_attributes)},Image.prototype.url_for=function(size){var projection;return projection=this.get("projections").find(function(projection){return projection.get("retina")===Boundless.RETINA&&projection.get("size")===size||"raw"===projection.get("size")&&"image/svg+xml"===projection.get("content_type")}),null!=projection?projection.image_url():"https://placehold.it/640x480&text=Missing%20Image"},Image.prototype.extension=function(){return Boundless.RETINA?"@2x"+this.get("scaled_extension"):this.get("scaled_extension")},Image.prototype.aspect_ratio=function(){var raw_projection;return(raw_projection=this.raw_projection())?raw_projection.get("width")/raw_projection.get("height"):null!=this.get("width")?this.get("width")/this.get("height"):1},Image.prototype.raw_projection=function(){return this.get("projections").find(function(projection){return"raw"===projection.get("size")})},Image.prototype.width_for=function(height){return height*this.aspect_ratio()},Image.prototype.height_for=function(width){return width/this.aspect_ratio()},Image.prototype.left_margin_for=function(width,height){return(width-this.width_for(height))/2},Image.prototype.full_width=function(){var raw_projection;return(raw_projection=this.raw_projection())?Math.min(raw_projection.get("width"),800):Math.min(this.get("width"),800)},Image.prototype.full_height=function(){return this.full_width()/this.aspect_ratio()},Image.prototype.reference=function(){return _.find(this.get("atom").get("media_refs"),function(_this){return function(media_ref){return media_ref.media_id===_this.id}}(this))},Image.prototype.image_preview=function(){return this.get("projections").isEmpty()?this.get("image_url"):this.url_for("large")},Image.prototype.validate=function(){return this.get("attribution").validate()},Image}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Issue=function(superClass){
function Issue(){return Issue.__super__.constructor.apply(this,arguments)}return extend(Issue,superClass),Issue.prototype.urlRoot=function(){return Boundless.API+"/issues"},Issue.prototype.paramRoot="issue",Issue.prototype.relations={comments:{klass:"Boundless.CommentCollection",reverse_relation:"issue"},proposed_changes:{klass:"Boundless.ProposedChangeCollection",reverse_relation:"issue"}},Issue.VALID_ISSUE_TYPES={"spelling/grammar":"Fix a spelling/grammar problem",clarity:"Improve clarity",information:"Change information",media:"Improve or add media (image, video, graph, equation)",discussion:"Discuss this concept",attribution:"Improve citations/attributions",creation_request:"Propose a new concept",other:"Other"},Issue.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"issue_type",{allow_blank:!1,allow_null:!1,message:"Please select what type of feedback you would like to leave."}),this.validates_presence_of(attrs,"title",{allow_blank:!1,allow_null:!1,message:"Issue description can't be blank."}),Issue.__super__.validate.call(this,attrs)},Issue}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.KeyTerm=function(superClass){function KeyTerm(){return KeyTerm.__super__.constructor.apply(this,arguments)}return extend(KeyTerm,superClass),KeyTerm.prototype.urlRoot=function(){return Boundless.API+"/key_terms"},KeyTerm.prototype.paramRoot="key_term",KeyTerm.sources=function(){return[["",""],["wiktionary","Wiktionary"],["wikipedia","Wikipedia"],["boundless","Boundless (internal)"]]},KeyTerm.parts_of_speech=function(){return["noun","proper-noun","verb","adjective","adverb","pronoun","interjection","preposition","conjunction","contraction"]},KeyTerm}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Lead=function(superClass){function Lead(){return Lead.__super__.constructor.apply(this,arguments)}return extend(Lead,superClass),Lead.prototype.urlRoot=function(){return Boundless.API+"/leads"},Lead}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LearningObjective=function(superClass){function LearningObjective(){return LearningObjective.__super__.constructor.apply(this,arguments)}return extend(LearningObjective,superClass),LearningObjective.prototype.urlRoot=function(){return Boundless.API+"/learning_objectives"},LearningObjective.prototype.paramRoot="learning_objective",LearningObjective.prototype.save_attributes=function(){return{id:this.id,text_mido:this.get("text_mido")}},LearningObjective}(BackRails.Model)}.call(this),function(){Boundless.LearnosityQuestion=function(){function LearnosityQuestion(){}return LearnosityQuestion.questionTypes={association:"Match List",audio:"Audio",chemistry:"Chemistry Formula",chemistryessay:"Chemistry Essay",choicematrix:"Choice Matrix",classification:"Classification",clozeassociation:"Cloze Association",clozedropdown:"Cloze Dropdown",clozeformula:"Cloze Formula",clozeinlinetext:"Cloze Inline Text",clozetext:"Cloze Text",custom:"Custom",formulaV2:"Math Formula",formulaessay:"Formula Essay",graphplotting:"Graph Plotting",highlight:"Image Highlight",hotspot:"Hotspot",imageclozeassociation:"Image Association",imageclozechemistry:"Cloze Image Chemistry",imageclozedropdown:"Image Dropdown",imageclozeformula:"Image Cloze Math Formula",imageclozetext:"Add Text to Image",imageupload:"Image Upload",longtext:"Long Text (Essay)",mcq:"Multiple Choice",numberline:"Number Line Association",numberlineplot:"Number Line Plot",orderlist:"Order List",plaintext:"Plain Text (Essay)",rating:"Rating",shorttext:"Short Text",simplechart:"Simple Chart",simpleshading:"Simple Shading",sortlist:"Sort List",tokenhighlight:"Token Highlight"},LearnosityQuestion.getHumanizedType=function(questionType){var kind;return(kind=this.questionTypes[questionType])?kind+" Question":questionType},LearnosityQuestion}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Lesson=function(superClass){function Lesson(){return Lesson.__super__.constructor.apply(this,arguments)}return extend(Lesson,superClass),Lesson.prototype.paramRoot="lesson",Lesson.prototype.urlRoot=function(){return Boundless.API+"/lessons"},Lesson}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LessonAssignment=function(superClass){function LessonAssignment(){return LessonAssignment.__super__.constructor.apply(this,arguments)}return extend(LessonAssignment,superClass),LessonAssignment.prototype.paramRoot="lesson_assignment",LessonAssignment.prototype.relations={course:"Boundless.Course",lesson_sessions:{klass:"Boundless.LessonSessionCollection",reverse_relation:"lesson_assignment"}},LessonAssignment.prototype.urlRoot=function(){return Boundless.API+"/courses/"+this.course_id()+"/lesson_assignments"},LessonAssignment.prototype.validate=function(attrs,options){return null==attrs&&(attrs=this.attributes),null==options&&(options={}),this.validates_presence_of(attrs,"due_date",{allow_blank:!1,allow_null:!1}),options.ignore_course_id||this.validates_presence_of(attrs,"course_id",{allow_blank:!1,allow_null:!1,message:"Please select or create a course for this assignment"}),LessonAssignment.__super__.validate.call(this,attrs)},LessonAssignment.prototype.course_id=function(){return this.get("course_id")||this.get("course").get("id")},LessonAssignment.prototype.lms_course=function(){return this.get("lms_course")},LessonAssignment.prototype.past_due=function(){return this.lms_course()?!1:moment(this.get("due_date")).endOf("day")<moment()},LessonAssignment.prototype.humanized_due_date=function(){var due_date;return due_date=moment(this.get("due_date")),due_date.year<moment().year?due_date.format("MMM D"):due_date.format("MMM D, YYYY")},LessonAssignment}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LessonProvider=function(superClass){function LessonProvider(){return LessonProvider.__super__.constructor.apply(this,arguments)}return extend(LessonProvider,superClass),LessonProvider.prototype.paramRoot="lesson_provider",LessonProvider.prototype.relations={questions:"Boundless.QuestionCollection",atom_commits:"Boundless.AtomCommitCollection"},LessonProvider.prototype.is_reading=function(){return"reading"===this.get("activity")},LessonProvider.prototype.is_quiz=function(){return"quiz"===this.get("activity")},LessonProvider}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,slice=[].slice;Boundless.LessonSession=function(superClass){function LessonSession(){return LessonSession.__super__.constructor.apply(this,arguments)}return extend(LessonSession,superClass),LessonSession.prototype.paramRoot="lesson_session",LessonSession.prototype.urlRoot=function(){return Boundless.API+"/lesson_sessions"},LessonSession.prototype.relations={lesson_provider:"Boundless.LessonProvider",lesson_assignment:"Boundless.LessonAssignment",responses:{klass:"Boundless.QuestionResponseCollection",reverse_relation:"lesson_session"}},LessonSession.prototype.content=function(){var chapter,section,section_id;return"undefined"!=typeof reader&&null!==reader?(chapter=reader.book.find_chapter(this.get("lesson_provider").get("chapter_id")),section_id=this.get("lesson_provider").get("section_id"),isNaN(section_id)||(section=chapter.get("sections").get(section_id)),section||chapter):void 0},LessonSession.prototype.is_reading=function(){return this.get("lesson_provider").is_reading()},LessonSession.prototype.is_quiz=function(){return this.get("lesson_provider").is_quiz()},LessonSession.prototype.progress=function(){return this.get("progress"),this.is_quiz()?this.quiz_progress():this.is_reading()?this.reading_progress():Boundless.Logger.error("Unsupported lesson_session type.")},LessonSession.prototype.is_in_progress=function(){var ref;return 0<(ref=this.progress())&&100>ref},LessonSession.prototype.is_submitted=function(){return this.get("submitted")},LessonSession.prototype.is_started=function(){return this.progress()>0},LessonSession.prototype.is_retrying_scoring=function(){return this.get("submitted_and_not_scored")},LessonSession.prototype.current_atom_id=function(){return this.get("last_read_atom_id")||this.get("lesson_provider").get("atom_commits").at(0).id},LessonSession.prototype.current_question_index=function(){return this.get("scored_question_responses_count")},LessonSession.prototype.questions_count=function(){return this.get("lesson_provider").get("questions_count")},LessonSession.prototype.quiz_score=function(){return this.is_retrying_scoring()?"?":this.get("grade")},LessonSession.prototype.quiz_progress=function(){return this.get("progress")},LessonSession.prototype.reading_progress=function(){return this.get("progress")},LessonSession.prototype.response_count=function(){return this.get("learnosity_question_response_count")},LessonSession.prototype.for_credit=function(){return this.get("for_credit")},LessonSession.prototype.update_counts=function(outcome){var ref,total_right,total_seen;return total_seen=(this.get("scored_question_responses_count")||0)+1,total_right=(this.get("correct_question_responses_count")||0)+("right"===outcome?1:0),this.set({scored_question_responses_count:total_seen,correct_question_responses_count:total_right}),null!=(ref=this.content())&&ref.set({quiz_total_seen:total_seen,quiz_total_correct:total_right}),this.get("submitted")||total_seen!==this.questions_count()?void 0:this.fetch({success:function(_this){return function(){return _this.get("submitted")?Boundless.Events.Feature.track("completed_lesson",{course_id:_this.get("course_id")}):void 0}}(this)})},LessonSession.prototype.submit=function(callbacks){return $.post(this.urlRoot()+"/"+this.id+"/submissions",{},function(_this){return function(model,resp){return _this.set(model),null!=callbacks&&"function"==typeof callbacks.success?callbacks.success(model,resp):void 0}}(this)).error(function(_this){return function(){var args;return args=1<=arguments.length?slice.call(arguments,0):[],_this.set({submitted_and_not_scored:!0}),null!=callbacks&&"function"==typeof callbacks.error?callbacks.error.apply(callbacks,args):void 0}}(this))},LessonSession}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Link=function(superClass){function Link(){return Link.__super__.constructor.apply(this,arguments)}return extend(Link,superClass),Link.prototype.paramRoot="media",Link.prototype.urlRoot=function(){return Boundless.API+"/media/embed"},Link.prototype.atom_save_attributes=["id","document_mido","link"],Link.prototype.initialize=function(){return null==this.attributes.type&&this.set("type","Link"),Link.__super__.initialize.apply(this,arguments)},Link.prototype.atom_save_json=function(){return _.pick(this.toJSON(),this.atom_save_attributes)},Link}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.MeetingTime=function(superClass){function MeetingTime(){return MeetingTime.__super__.constructor.apply(this,arguments)}return extend(MeetingTime,superClass),MeetingTime.WEEKDAYS=["monday","tuesday","wednesday","thursday","friday","saturday","sunday"],MeetingTime.prototype.short_day_map={sunday:"Su",monday:"M",tuesday:"Tu",wednesday:"W",thursday:"Th",friday:"F",saturday:"Sa"},MeetingTime.prototype.weekday=function(len){return null==len&&(len=null),"short"===len?this.short_day_map[this.get("weekday")]:"Number"===TypeHelper.get_type(len)?this.get("weekday").capitalize().slice(0,len):this.get("weekday").capitalize()},MeetingTime}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Note=function(superClass){function Note(){return Note.__super__.constructor.apply(this,arguments)}return extend(Note,superClass),Note.prototype.urlRoot=function(){return this.get("highlight").url()+"/notes"},Note.prototype.initialize=function(){return this.set_objects(),this.on("change",function(_this){return function(){return _this.set_objects()}}(this)),Note.__super__.initialize.apply(this,arguments)},Note.prototype.set_objects=function(){return this.created_at=moment(this.get("created")).fromNow()},Note}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Notification=function(superClass){function Notification(){return Notification.__super__.constructor.apply(this,arguments)}return extend(Notification,superClass),Notification.prototype.urlRoot=function(){return Boundless.API+"/notifications"},Notification.prototype.icon_class=function(){switch(this.get("event")){case"published":return"icon-book";case"closed":return"icon-archive";case"comment":return"icon-comment";default:return""}},Notification}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.NotificationSubscription=function(superClass){function NotificationSubscription(){return NotificationSubscription.__super__.constructor.apply(this,arguments)}return extend(NotificationSubscription,superClass),NotificationSubscription.prototype.paramRoot="notification_subscription",NotificationSubscription.prototype.urlRoot=function(){return session.current_user.url()+"/notification_subscriptions"},NotificationSubscription}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.PasswordReset=function(superClass){function PasswordReset(){return PasswordReset.__super__.constructor.apply(this,arguments)}return extend(PasswordReset,superClass),PasswordReset.prototype.paramRoot="password_reset",PasswordReset.prototype.urlRoot=function(){return Boundless.API+"/password_resets"},PasswordReset.prototype.idAttribute="code",PasswordReset.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),PasswordReset.__super__.validate.call(this,attrs)},PasswordReset.prototype.should_report_error=function(error_data){var error,error1,ref,response,response_text,status_code;if(status_code=error_data.properties.status_code,(404===status_code||422===status_code)&&(response_text=error_data.properties.response_text,null!=response_text))try{return response=JSON.parse(response_text),!(null!=(null!=(ref=response.errors)?ref.email:void 0))}catch(error1){return error=error1,!0}return!0},PasswordReset}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Projection=function(superClass){function Projection(){return Projection.__super__.constructor.apply(this,arguments)}return extend(Projection,superClass),Projection.prototype.image_url=function(){return Boundless.FIGURES_CDN+"/"+this.get("media").id+"/"+this.get("size")+"/"+this.get("filename")},Projection}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ProposedChange=function(superClass){function ProposedChange(){return ProposedChange.__super__.constructor.apply(this,arguments)}return extend(ProposedChange,superClass),ProposedChange.prototype.urlRoot=function(){return Boundless.API+"/issues/"+this.get("issue_id")+"/proposed_changes/"},ProposedChange}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Purchase=function(superClass){function Purchase(){return Purchase.__super__.constructor.apply(this,arguments)}return extend(Purchase,superClass),Purchase.prototype.paramRoot="purchase",Purchase.prototype.urlRoot=function(){return session.current_user.url()+"/purchases"},Purchase.prototype.relations={subject_tag:"Boundless.SubjectTag",book:"Boundless.Book"},Purchase.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"purchasable_id",{allow_blank:!1,allow_null:!1}),this.validates_presence_of(attrs,"purchasable_type",{allow_blank:!1,allow_null:!1}),Purchase.__super__.validate.call(this,attrs)},Purchase.prototype.event_properties=function(){var props;return props={student:session.current_user.get("student"),educator:session.current_user.get("educator"),expert:session.current_user.get("expert"),school_name:session.current_user.get("school").get("name"),school_id:this.get("school_id"),subject_tag:this.get("subject_tag_name"),course_name:this.get("course_name"),purchasable_id:this.get("purchasable_id"),purchasable_type:this.get("purchasable_type"),book_title:this.get("book_title"),book_author:this.get("book_author"),book_edition:this.get("book_edition"),admin:session.current_user.get("admin")}},Purchase.prototype.is_boundless=function(){return this.get("book").is_boundless()},Purchase.prototype.should_report_error=function(error_data){var error,error1,ref,response,response_text;if(422===error_data.properties.status_code&&(response_text=error_data.properties.response_text,null!=response_text))try{return response=JSON.parse(response_text),!(null!=(null!=(ref=response.errors)?ref.course_id:void 0))}catch(error1){return error=error1,!0}return!0},Purchase.prototype.has_customized_book=function(){return this.get("book").was_created_by_current_user()},Purchase.prototype.subject_tag=function(){return this.get("book").get("subject_tag")},Purchase.prototype.revenue=function(){return this.get("final_price")/100},Purchase.prototype.ecommerce_data=function(book,code){var price;return price=this.get("final_price")/100,{orderId:this.id,total:price,revenue:price,shipping:0,tax:0,discount:book.get("base_price")-price,coupon:code,currency:"USD",products:[_.extend({quantity:1},book.ecommerce_data())]}},Purchase}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Question=function(superClass){function Question(){return Question.__super__.constructor.apply(this,arguments)}return extend(Question,superClass),Question.prototype.urlRoot=function(){return Boundless.API+"/questions"},Question.prototype.paramRoot="question",Question.createEmptyMCQ=function(){return new this({learnosity_edit_json:{configuration:{consumer_key:Boundless.LEARNOSITY_KEY},ui:{change_button:!1,source_button:!1},rich_text_editor:{type:"wysihtml"},assetRequest:Boundless.Learnosity.asset_request,widget_json:{type:"mcq",options:[{label:"[Choice A]",value:"0"},{label:"[Choice B]",value:"1"},{label:"[Choice C]",value:"2"},{label:"[Choice D]",value:"3"}]}}})},Question.prototype.concept_path=function(){var data;return data=reader.book.data_for_atom_id(this.get("atom_id")),"book_stack:toc/chapter/concept?chapter_id="+data.chapter.id+"&concept_id="+data.concept.id},Question.prototype.creator_avatar_url=function(size){return 22>=size?this.get("creator_avatar_url_small"):40>=size?this.get("creator_avatar_url_medium"):this.get("creator_avatar_url_large")},Question.prototype.creator_avatar_tag=function(size){return null==size&&(size=46),"<img src='"+this.creator_avatar_url(size)+"' width='"+size+"' height='"+size+"'></img>"},Question.prototype.clone=function(){var clone;return clone=new Boundless.Question(_.omit(this.attributes,"id")),clone.set("cloned_from_id",this.id),clone},Question.prototype.post_clone=function(options){var success_handler;return success_handler=options.success,options.success=function(_this){return function(model,resp,errors){return"function"==typeof success_handler?success_handler(model,resp,errors):void 0}}(this),Backbone.sync("create",this,_.extend({url:this.url()+"/clone"},options))},Question.prototype.revert=function(options){var success_handler;return success_handler=options.success,options.success=function(_this){return function(model,resp,errors){return _this.set(model),"function"==typeof success_handler?success_handler(_this,resp,errors):void 0}}(this),Backbone.sync("create",this,_.extend({url:this.url()+"/revert"},options))},Question.prototype.publish=function(options){var success_handler;return success_handler=options.success,options.success=function(_this){return function(model,resp,errors){return _this.set(model),"function"==typeof success_handler?success_handler(_this,resp,errors):void 0}}(this),Backbone.sync("create",this,_.extend({url:this.url()+"/publish"},options))},Question}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuestionResponse=function(superClass){function QuestionResponse(){return QuestionResponse.__super__.constructor.apply(this,arguments)}return extend(QuestionResponse,superClass),QuestionResponse.prototype.urlRoot=function(){return Boundless.API+"/lesson_sessions/"+this.get("lesson_session_id")+"/question_responses"},QuestionResponse}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuizSession=function(superClass){function QuizSession(){return QuizSession.__super__.constructor.apply(this,arguments)}return extend(QuizSession,superClass),QuizSession.prototype.paramRoot="quiz_session",QuizSession.prototype.relations={responses:{klass:"Boundless.QuestionResponseCollection",reverse_relation:"quiz_session"}},QuizSession.prototype.urlRoot=function(){return Boundless.API+"/quiz_sessions"},QuizSession.prototype.score=function(){return this.get("responses").length?0===this.get("responses").length?0:Math.round(this.get("responses").right().length/this.get("responses").length*100):0===this.total_responses()?0:Math.round(this.get("correct_responses")/this.total_responses()*100)},QuizSession.prototype.total_responses=function(){return this.get("correct_responses")+this.get("incorrect_responses")},QuizSession.prototype.is_started=function(){return this.total_responses()>0},QuizSession.prototype.is_complete=function(){return this.total_responses()===this.get("question_count")},QuizSession.prototype.is_incomplete=function(){return this.total_responses()<this.get("question_count")},QuizSession.prototype.is_in_progress=function(){return this.is_started()&&this.is_incomplete()},QuizSession}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ReadEvent=function(superClass){function ReadEvent(){return ReadEvent.__super__.constructor.apply(this,arguments)}return extend(ReadEvent,superClass),ReadEvent.prototype.paramRoot="read_event",ReadEvent.prototype.urlRoot=function(){return Boundless.API+"/read_events"},ReadEvent.prototype.read_event_validate=function(attrs){switch(this.get("type")){case"ReadEvent":if(null==this.get("atom_id")||null==this.get("seconds_spent")||""===this.get("atom_id"))return!1;break;default:return!1}return!0},ReadEvent}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.School=function(superClass){function School(){return School.__super__.constructor.apply(this,arguments)}return extend(School,superClass),School.prototype.paramRoot="school",School.prototype.urlRoot=function(){return Boundless.API+"/schools"},School.prototype.relations={courses:"Boundless.CourseCollection"},School.prototype.initialize=function(){var school_id;return School.__super__.initialize.apply(this,arguments),(school_id=this.get("school_id"))&&this.set({id:school_id},{silent:!0}),this},School.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"name",{allow_blank:!1,message:"Please enter your school"}),School.__super__.validate.call(this,attrs)},School}(BackRails.Model)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Section=function(superClass){function Section(){return this.find_concept=bind(this.find_concept,this),Section.__super__.constructor.apply(this,arguments)}return extend(Section,superClass),Section.prototype.paramRoot="section",Section.prototype.urlRoot=function(){return Boundless.API+"/books/"+this.get("book_id")+"/chapters/"+this.get("chapter_id")+"/sections"},Section.prototype.display_name="Section",Section.prototype.relations={concepts:{klass:"Boundless.ConceptCollection",reverse_relation:"section"},questions:{klass:"Boundless.QuestionCollection",reverse_relation:"section"},flashcards:{klass:"Boundless.FlashcardCollection",reverse_relation:"section"},lesson_sessions:{klass:"Boundless.LessonSessionCollection",reverse_relation:"section"}},Section.prototype.initialize=function(){return Section.__super__.initialize.apply(this,arguments),"undefined"!=typeof reader&&null!==reader&&reader.book.section_cache.add(this),this},Section.prototype.parent_collection=function(){return this.get("chapter").get("sections")},Section.prototype.chapter=function(){return this.get("chapter")},Section.prototype.find_concept=function(id_or_slug){return this.get("concepts").find(function(_this){return function(concept){return concept.id===id_or_slug||concept.get("slug")===id_or_slug}}(this))},Section.prototype.index=function(){return _.indexOf(this.parent_collection().pluck("id"),this.id)},Section.prototype.thumbnail_url=function(size){var concept;return(concept=this.get("concepts").find(function(_this){return function(concept){return null!=concept.get("thumbnail_url")}}(this)))?concept.thumbnail_url(size):null},Section.prototype.key_terms=function(){return _.uniq(_.flatten(_.map(this.get("atoms").models,function(atom){return atom.get("key_terms")})))},Section.prototype.next=function(){var ref;return this.parent_collection().find_section_by_number(this.get("number")+1)||(null!=(ref=this.get("chapter").next())?ref.get("sections").first():void 0)},Section.prototype.prev=function(){var ref;return this.get("number")>1?this.parent_collection().find_section_by_number(this.get("number")-1):null!=(ref=this.get("chapter").prev())?ref.get("sections").last():void 0},Section.prototype.has_prev_in_collection=function(){return 0===this.index()?!1:!0},Section.prototype.has_next_in_collection=function(){return this.index()===this.parent_collection().length-1?!1:!0},Section.prototype.read_concepts=function(){return null!=reader.book.read_atom_ids?_.intersection(this.get("concepts").pluck("atom_id"),reader.book.read_atom_ids):(BackRails.Logger.warn("Unable to calculate read concepts. reader.book.read_atom_ids not populated."),[])},Section.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),this.validates_presence_of(attrs,"title",{allow_blank:!1,allow_null:!1,message:"Title can't be blank."}),Section.__super__.validate.call(this,attrs)},Section}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ShortLink=function(superClass){function ShortLink(){return ShortLink.__super__.constructor.apply(this,arguments)}return extend(ShortLink,superClass),ShortLink.prototype.paramRoot="short_links",ShortLink.prototype.urlRoot=Boundless.API+"/short_links",ShortLink}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.SubjectTag=function(superClass){function SubjectTag(){return SubjectTag.__super__.constructor.apply(this,arguments)}return extend(SubjectTag,superClass),SubjectTag.prototype.paramRoot="subject_tag",SubjectTag.prototype.urlRoot=function(){return Boundless.API+"/subject_tags"},SubjectTag.prototype.relations={books:"Boundless.BookCollection"},SubjectTag}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);
return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Table=function(superClass){function Table(){return Table.__super__.constructor.apply(this,arguments)}return extend(Table,superClass),Table.prototype.initialize=function(){return null==this.attributes.type&&this.set("type","Table"),Table.__super__.initialize.apply(this,arguments)},Table}(BackRails.Model)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Boundless.User=function(superClass){function User(){return this._calculate_purchase_price=bind(this._calculate_purchase_price,this),this.book_purchase_price=bind(this.book_purchase_price,this),this.available_courses=bind(this.available_courses,this),User.__super__.constructor.apply(this,arguments)}return extend(User,superClass),User.prototype.paramRoot="user",User.prototype.urlRoot=function(){return Boundless.API+"/users"},User.prototype.relations={school:"Boundless.School",credits:"Boundless.CreditCollection",notifications:"Boundless.NotificationCollection",purchases:"Boundless.PurchaseCollection",courses:"Boundless.CourseCollection",created_courses:"Boundless.CourseCollection",notification_subscriptions:"Boundless.NotificationSubscriptionCollection",degrees:{klass:"Boundless.DegreeCollection",serialize_as:"degrees_attributes"}},User.prototype.parse=function(response){return null!=(null!=response?response.user:void 0)?_.extend(response.user,{reader_authentication_token:response.reader_authentication_token,authentication_token:response.reader_authentication_token}):response},User.prototype.validate=function(attrs){return null==attrs&&(attrs=this.attributes),attrs.facebook||attrs.email_only?attrs.email_only&&this.validates_email(attrs,"email",{allow_blank:!1,allow_null:!1}):(this.validates_email(attrs,"email",{allow_blank:!1,allow_null:!1}),this.validates_presence_of(attrs,"password",{allow_blank:!1,allow_null:!0}),attrs.lti_instructor&&""===attrs.school_name&&this.validates_presence_of(attrs,"school_id",{allow_blank:!1,allow_null:!1})),User.__super__.validate.call(this,attrs)},User.prototype.is_student=function(){return!!this.get("student")},User.prototype.is_educator=function(){return!!this.get("educator")},User.prototype.is_expert=function(){return!!this.get("expert")},User.prototype.is_super_edcurator=function(){return!!this.get("super_edcurator")},User.prototype.is_admin=function(){return!!this.get("admin")},User.prototype.no_referral_coupon=function(){return!0},User.prototype.name=function(){return null!=this.get("first_name")&&""!==this.get("first_name")?this.get("first_name")+" "+this.get("last_name"):this.get("email")},User.prototype.avatar_url=function(size){return 22>=size?this.get("avatar_url_small"):40>=size?this.get("avatar_url_medium"):this.get("avatar_url_large")},User.prototype.avatar_tag=function(size){return null==size&&(size=46),"<img src='"+this.avatar_url(size)+"' width='"+size+"' height='"+size+"' alt='"+this.name()+"'></img>"},User.prototype.dont_track=function(){return this.get("email")&&this.get("email").match(/boundless(learning)?\.com/)},User.prototype.get_setting=function(setting_path){var i,len,ref,setting,token;for(setting=this.get("settings"),ref=setting_path.split("/"),i=0,len=ref.length;len>i;i++)if(token=ref[i],setting=setting[token],null==setting)return null;return setting},User.prototype.get_or_set_setting=function(setting_path,value){return value=this.get_setting(setting_path),null==value&&(value=this.set_setting(setting_path,value)),value},User.prototype.set_setting=function(setting_path,value,save_model,callback){var i,index,len,setting,token,tokens;for(null==save_model&&(save_model=!0),null==callback&&(callback=null),tokens=setting_path.split("/"),setting=this.get("settings"),index=i=0,len=tokens.length;len>i;index=++i)token=tokens[index],index===tokens.length-1?null!=setting[token]&&"Object"===TypeHelper.get_type(setting[token])?Boundless.Logger.error("Tried to set '"+setting_path+"' on user settings but '"+token+"' is an existing setting path."):setting[token]=value:(setting[token]||(setting[token]={}),setting=setting[token],"Object"!==TypeHelper.get_type(setting)&&Boundless.Logger.error("Tried to set user setting '"+setting_path+"' on user settings but '"+token+"' is an existing setting name."));return save_model&&this.save({},{success:function(){return"function"==typeof callback?callback():void 0}}),value},User.prototype.should_report_error=function(error_data){return 422===error_data.properties.status_code?!1:!0},User.prototype.available_courses=function(){var enrolled_course_ids;return enrolled_course_ids=this.get("enrollments").pluck("course_id"),this.get("school").get("courses").filter(function(_this){return function(course){return!_.contains(enrolled_course_ids,course.id)}}(this))},User.prototype.is_enrolled_in=function(course){var ref;return course?(ref=course.id,indexOf.call(this.get("courses").pluck("id"),ref)>=0):!1},User.prototype.friends_needed=function(){var social_endpoints;return social_endpoints=4,Boundless.REFERRALS_TOTAL-social_endpoints-this.get("referred_users").length},User.prototype.purchase_count=function(){return this.get("purchases").length},User.prototype.has_ever_paid=function(){return _.reduce(this.get("purchases").models,function(n,m){return m.get("purchased")||n},!1)},User.prototype.books=function(){return this.get("purchases").map(function(purchase){return purchase.get("book")})},User.prototype.find_book=function(book_id){return _.find(this.books(),function(_this){return function(book){return book.id===book_id}}(this))},User.prototype.owns_current_book=function(){return this.find_book(reader.book.id)?!0:!1},User.prototype.last_sign_in_at=function(format){var date;return null==format&&(format=null),date=moment(this.get("last_sign_in_at")),format?date.format(format):date},User.prototype.book_purchase_price=function(){return this.get("credits").data_loaded?this._calculate_purchase_price():this.get("credits").fetch({success:function(_this){return function(user_credits){return _this._calculate_purchase_price(user_credits)}}(this)})},User.prototype.can_assign=function(){return this.get("educator")||this.get("expert")},User.prototype._calculate_purchase_price=function(user_credits){var available_credit,coupon_discount,initial_price;return initial_price=Boundless.BOOK_PRICE,coupon_discount=null!=("undefined"!=typeof onboarding_data&&null!==onboarding_data?onboarding_data.coupon:void 0)?initial_price-onboarding_data.coupon.get("price"):0,available_credit=null!=user_credits?user_credits.available_credit()/100:0,initial_price-coupon_discount-available_credit},User.prototype.pusher_channel_auth_endpoint=function(){return Boundless.API+"/pusher/auth?"+Boundless.auth_token_param+"="+this.get("authentication_token")},User.prototype.hasPurchasedItem=function(item){return this["hasPurchased"+item.class_name()].call(this,item)},User.prototype.hasPurchasedCourse=function(course){return!!this.get("purchases").get_by_purchasable(course.id,"Course")},User.prototype.hasPurchasedBook=function(book){return!!this.get("purchases").get_by_book_id(book.id)},User.prototype.createPurchase=function(purchaseParams,options){return null==options&&(options={}),null==options.wait&&(options.wait=!0),this.get("purchases").create(purchaseParams,options)},User}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.UserBookFlashcardStatistics=function(superClass){function UserBookFlashcardStatistics(){return UserBookFlashcardStatistics.__super__.constructor.apply(this,arguments)}return extend(UserBookFlashcardStatistics,superClass),UserBookFlashcardStatistics.prototype.url=function(){return Boundless.API+"/books/"+reader.book.id+"/flashcard_statistics"},UserBookFlashcardStatistics}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.UserSession=function(superClass){function UserSession(){return UserSession.__super__.constructor.apply(this,arguments)}return extend(UserSession,superClass),UserSession.prototype.urlRoot=function(){return Boundless.API+"/usersessions"},UserSession.prototype.defaults=function(){var ref;return{id:null!=(ref=session.current_user)?ref.id:void 0,user:session.current_user}},UserSession.prototype.relations={user:"Boundless.User"},UserSession}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.WiktionaryResult=function(superClass){function WiktionaryResult(){return WiktionaryResult.__super__.constructor.apply(this,arguments)}return extend(WiktionaryResult,superClass),WiktionaryResult.prototype.urlRoot=function(){return Boundless.CONTENT_API+"/edcurator/key_terms_wiki/"+this.term},WiktionaryResult.prototype.initialize=function(term){return this.term=term,WiktionaryResult.__super__.initialize.apply(this,arguments)},WiktionaryResult}(BackRails.Model)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AtomCollection=function(superClass){function AtomCollection(){return AtomCollection.__super__.constructor.apply(this,arguments)}return extend(AtomCollection,superClass),AtomCollection.prototype.model=Boundless.Atom,AtomCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AtomCommitCollection=function(superClass){function AtomCommitCollection(){return AtomCommitCollection.__super__.constructor.apply(this,arguments)}return extend(AtomCommitCollection,superClass),AtomCommitCollection.prototype.model=Boundless.AtomCommit,AtomCommitCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AtomKeyTermCollection=function(superClass){function AtomKeyTermCollection(){return AtomKeyTermCollection.__super__.constructor.apply(this,arguments)}return extend(AtomKeyTermCollection,superClass),AtomKeyTermCollection.prototype.model=Boundless.AtomKeyTerm,AtomKeyTermCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AttributionCollection=function(superClass){function AttributionCollection(){return AttributionCollection.__super__.constructor.apply(this,arguments)}return extend(AttributionCollection,superClass),AttributionCollection.prototype.model=Boundless.Attribution,AttributionCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookCollection=function(superClass){function BookCollection(){return BookCollection.__super__.constructor.apply(this,arguments)}return extend(BookCollection,superClass),BookCollection.prototype.model=Boundless.Book,BookCollection.prototype.url=function(){return Boundless.API+"/books/boundless"},BookCollection.prototype.find_book_by_subject_tag_id=function(subject_tag_id){return this.find(function(book){return book.get("subject_tag").id===subject_tag_id})},BookCollection.prototype.find_book_by_subject_tag_permalink=function(subject_tag_permalink){return this.find(function(book){return book.get("subject_tag").get("permalink")===subject_tag_permalink})},BookCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BrightspaceModuleCollection=function(superClass){function BrightspaceModuleCollection(){return BrightspaceModuleCollection.__super__.constructor.apply(this,arguments)}return extend(BrightspaceModuleCollection,superClass),BrightspaceModuleCollection.prototype.model=Boundless.BrightspaceModule,BrightspaceModuleCollection.prototype.url=function(){return Boundless.API+"/brightspace/courses/"+this.course.get("external_tool_id")+"/modules"},BrightspaceModuleCollection.prototype.initialize=function(models,options){return null==models&&(models=[]),null==options&&(options={}),this.course=options.course,BrightspaceModuleCollection.__super__.initialize.apply(this,arguments)},BrightspaceModuleCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ChapterCollection=function(superClass){function ChapterCollection(){return ChapterCollection.__super__.constructor.apply(this,arguments)}return extend(ChapterCollection,superClass),ChapterCollection.prototype.url=function(){return Boundless.API+"/books/"+this.book.id+"/chapters"},ChapterCollection.prototype.model=Boundless.Chapter,ChapterCollection.prototype.initialize=function(models,options){return null==models&&(models=[]),null==options&&(options={}),this.book=options.book,ChapterCollection.__super__.initialize.apply(this,arguments)},ChapterCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CommentCollection=function(superClass){function CommentCollection(){return CommentCollection.__super__.constructor.apply(this,arguments)}return extend(CommentCollection,superClass),CommentCollection.prototype.model=Boundless.Comment,CommentCollection.prototype.url=function(){return Boundless.API+"/issues/"+this.issue.id+"/comments"},CommentCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ConceptCollection=function(superClass){function ConceptCollection(){return ConceptCollection.__super__.constructor.apply(this,arguments)}return extend(ConceptCollection,superClass),ConceptCollection.prototype.model=Boundless.Concept,ConceptCollection.prototype.ids_array=function(){return this.pluck("id")},ConceptCollection.prototype.next_after=function(concept_id){var ids_array;return ids_array=this.ids_array(),this.get(concept_id)?ids_array.length>1?this.last().id===concept_id?this.get(concept_id):this.get(ids_array[ids_array.indexOf(concept_id)+1]):this.get(concept_id):BackRails.Logger.error("The concept doesn't exist in this collection.")},ConceptCollection.prototype.is_all_read=function(){var read_concepts;return read_concepts=[],this.each(function(concept){return reader.book.read_atom_ids.indexOf(concept.get("atom_id"))>-1?read_concepts.push(concept.id):void 0}),this.length===read_concepts.length?!0:!1},ConceptCollection.prototype.thumbnail_url=function(size){return null==size&&(size="square"),this.url=null,this.models.every(function(_this){return function(concept){return _this.url=concept.thumbnail_url(size),null===_this.url}}(this)),this.url},ConceptCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CourseCollection=function(superClass){function CourseCollection(){return CourseCollection.__super__.constructor.apply(this,arguments)}return extend(CourseCollection,superClass),CourseCollection.prototype.model=Boundless.Course,CourseCollection.prototype.url=function(){return null!=this.school?this.school.url()+"/courses":Boundless.API+"/courses"},CourseCollection.prototype.all_by_subject_tag=function(subject_tag){return this.filter(function(course){return course.get("name")===subject_tag})},CourseCollection.prototype.find_by_subject_tag=function(subject_tag,index){return null==index&&(index=0),this.all_by_subject_tag(subject_tag)[index]},CourseCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreditCollection=function(superClass){function CreditCollection(){return CreditCollection.__super__.constructor.apply(this,arguments)}return extend(CreditCollection,superClass),CreditCollection.prototype.model=Boundless.Credit,CreditCollection.prototype.url=function(){return session.current_user.url()+"/credits"},CreditCollection.prototype.available_credit=function(){return this.pluck("total_remaining").length?this.pluck("total_remaining").reduce(function(a,b){return a+b}):0},CreditCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.DegreeCollection=function(superClass){function DegreeCollection(){return DegreeCollection.__super__.constructor.apply(this,arguments)}return extend(DegreeCollection,superClass),DegreeCollection.prototype.model=Boundless.Degree,DegreeCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.FlashcardCollection=function(superClass){function FlashcardCollection(){return FlashcardCollection.__super__.constructor.apply(this,arguments)}return extend(FlashcardCollection,superClass),FlashcardCollection.prototype.model=Boundless.Flashcard,FlashcardCollection.prototype.url=function(){var chapter_id,ref,ref1;return chapter_id=(null!=(ref=this.chapter)?ref.id:void 0)||this.section.get("chapter").id,Boundless.FlashcardCollection.generate_url(reader.book.id,chapter_id,null!=(ref1=this.section)?ref1.id:void 0)},FlashcardCollection.prototype.shuffle=function(){var results;return this.list_order=_.shuffle(function(){results=[];for(var j=0,ref=this.length-1;ref>=0?ref>=j:j>=ref;ref>=0?j++:j--)results.push(j);return results}.apply(this))},FlashcardCollection.prototype.shuffled_at=function(i){return this.at(this.list_order[i])},FlashcardCollection.generate_url=function(book_id,chapter_id,section_id){return book_id||(book_id=reader.book.id),section_id?Boundless.API+"/books/"+book_id+"/chapters/"+chapter_id+"/sections/"+section_id+"/flashcards":Boundless.API+"/books/"+book_id+"/chapters/"+chapter_id+"/flashcards"},FlashcardCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.HighlightCollection=function(superClass){function HighlightCollection(){return HighlightCollection.__super__.constructor.apply(this,arguments)}return extend(HighlightCollection,superClass),HighlightCollection.prototype.model=Boundless.Highlight,HighlightCollection.prototype.url=function(){return Boundless.API+"/books/"+reader.book.id+"/highlights"},HighlightCollection.prototype.update_notebook_counts_on_change=function(){return null!=("undefined"!=typeof reader&&null!==reader?reader.book:void 0)?(this.off("add remove"),this.on("add remove",function(_this){return function(){return reader.book.fetch_highlights_by_chapter({success:function(){return Boundless.Logger.log("Notebook updated.")}})}}(this))):void 0},HighlightCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.KeyTermCollection=function(superClass){function KeyTermCollection(){return KeyTermCollection.__super__.constructor.apply(this,arguments)}return extend(KeyTermCollection,superClass),KeyTermCollection.prototype.model=Boundless.KeyTerm,KeyTermCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LearningAssignmentCollection=function(superClass){function LearningAssignmentCollection(){return LearningAssignmentCollection.__super__.constructor.apply(this,arguments)}return extend(LearningAssignmentCollection,superClass),LearningAssignmentCollection.prototype.model=Boundless.LearningAssignment,LearningAssignmentCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LearningObjectiveCollection=function(superClass){function LearningObjectiveCollection(){return LearningObjectiveCollection.__super__.constructor.apply(this,arguments)}return extend(LearningObjectiveCollection,superClass),LearningObjectiveCollection.prototype.model=Boundless.LearningObjective,LearningObjectiveCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LessonAssignmentCollection=function(superClass){function LessonAssignmentCollection(){return LessonAssignmentCollection.__super__.constructor.apply(this,arguments)}return extend(LessonAssignmentCollection,superClass),LessonAssignmentCollection.prototype.model=Boundless.LessonAssignment,LessonAssignmentCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LessonSessionCollection=function(superClass){function LessonSessionCollection(){return LessonSessionCollection.__super__.constructor.apply(this,arguments)}return extend(LessonSessionCollection,superClass),LessonSessionCollection.prototype.model=Boundless.LessonSession,LessonSessionCollection.prototype.url=function(){return this.lesson_assignment?this.lesson_assignment.url()+"/lesson_sessions":this.section?Boundless.API+"/books/"+reader.book.id+"/chapters/"+this.section.get("chapter").id+"/sections/"+this.section.id+"/lesson_sessions":Boundless.API+"/books/"+reader.book.id+"/chapters/"+this.chapter.id+"/lesson_sessions"},LessonSessionCollection.prototype.comparator=function(m,n){return moment(m.get("updated_at")).isBefore(moment(n.get("updated_at")))},LessonSessionCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.MediaCollection=function(superClass){function MediaCollection(){return MediaCollection.__super__.constructor.apply(this,arguments)}return extend(MediaCollection,superClass),MediaCollection.prototype.model=function(attrs,options){switch(attrs.figure_type||(attrs.figure_type="Image"),attrs.figure_type){case"Embed":return new Boundless.Embed(attrs,options);case"Link":return new Boundless.Link(attrs,options);case"Graph":return new Boundless.Graph(attrs,options);case"Image":return new Boundless.Image(attrs,options)}},MediaCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.NotificationCollection=function(superClass){function NotificationCollection(){return NotificationCollection.__super__.constructor.apply(this,arguments)}return extend(NotificationCollection,superClass),NotificationCollection.prototype.model=Boundless.Notification,NotificationCollection.prototype.paramRoot="notification",NotificationCollection.prototype.url=function(){return Boundless.API+"/notifications"},NotificationCollection.prototype.collection_endpoints={fetch_unseen:"unseen"},NotificationCollection.prototype.unseen=function(){return this.where({seen:!1})},NotificationCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.NotificationSubscriptionCollection=function(superClass){function NotificationSubscriptionCollection(){return NotificationSubscriptionCollection.__super__.constructor.apply(this,arguments)}return extend(NotificationSubscriptionCollection,superClass),NotificationSubscriptionCollection.prototype.model=Boundless.NotificationSubscription,NotificationSubscriptionCollection.prototype.url=function(){return session.current_user.url()+"/notification_subscriptions"},NotificationSubscriptionCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ProjectionCollection=function(superClass){function ProjectionCollection(){return ProjectionCollection.__super__.constructor.apply(this,arguments)}return extend(ProjectionCollection,superClass),ProjectionCollection.prototype.model=Boundless.Projection,ProjectionCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ProposedChangeCollection=function(superClass){function ProposedChangeCollection(){return ProposedChangeCollection.__super__.constructor.apply(this,arguments)}return extend(ProposedChangeCollection,superClass),ProposedChangeCollection.prototype.model=Boundless.ProposedChange,ProposedChangeCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.PurchaseCollection=function(superClass){function PurchaseCollection(){return PurchaseCollection.__super__.constructor.apply(this,arguments)}return extend(PurchaseCollection,superClass),PurchaseCollection.prototype.model=Boundless.Purchase,PurchaseCollection.prototype.initialize=function(){return this.on("add",this.poll_for_publish_complete),PurchaseCollection.__super__.initialize.apply(this,arguments)},PurchaseCollection.prototype.get_by_book_id=function(book_id){return this.find(function(purchase){return book_id===purchase.get("book").id})},PurchaseCollection.prototype.book_purchases=function(){return this.filter(function(purchase){return"Book"===purchase.get("purchasable_type")})},PurchaseCollection.prototype.course_purchases=function(){return this.filter(function(purchase){return"Course"===purchase.get("purchasable_type")})},PurchaseCollection.prototype.get_by_purchasable=function(purchasable_id,purchasable_type){return this.find(function(purchase){return purchase.get("purchasable_id")===purchasable_id&&purchase.get("purchasable_type")===purchasable_type})},PurchaseCollection.prototype.all_by_subject_tag=function(subject_tag_name){return this.filter(function(purchase){return this.subject_tag.get("permalink")===subject_tag_name.toLowerCase()})},PurchaseCollection.prototype.find_by_subject_tag=function(subject_tag_name,index){return null==index&&(index=0),this.all_by_subject_tag(subject_tag_name)[index]},PurchaseCollection.prototype.index_of_purchase=function(purchase){return this.all_by_subject_tag(purchase.subject_tag().get("permalink")).indexOf(purchase)},PurchaseCollection.prototype.purchase_permalink=function(purchase){var index;return index=this.index_of_purchase(purchase),index>0?purchase.subject_tag().get("permalink")+"-"+index:purchase.subject_tag().get("permalink")},PurchaseCollection.prototype.poll_for_publish_complete=function(){return this.each(function(_this){return function(purchase){var book;return book=purchase.get("book"),book&&book.get("publishing")?book.poll_for_publish_complete():void 0}}(this))},PurchaseCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuestionCollection=function(superClass){function QuestionCollection(){
return QuestionCollection.__super__.constructor.apply(this,arguments)}return extend(QuestionCollection,superClass),QuestionCollection.prototype.model=Boundless.Question,QuestionCollection.prototype.url=function(){return this.section?Boundless.API+"/books/"+reader.book.id+"/chapters/"+this.section.get("chapter").id+"/sections/"+this.section.id+"/questions":Boundless.API+"/books/"+reader.book.id+"/chapters/"+this.chapter.id+"/questions"},QuestionCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuestionResponseCollection=function(superClass){function QuestionResponseCollection(){return QuestionResponseCollection.__super__.constructor.apply(this,arguments)}return extend(QuestionResponseCollection,superClass),QuestionResponseCollection.prototype.url=function(){return this.lesson_session.url()+"/question_responses"},QuestionResponseCollection.prototype.model=Boundless.QuestionResponse,QuestionResponseCollection.prototype.right=function(){return this.filter(function(response){return"right"===response.get("outcome")})},QuestionResponseCollection.prototype.wrong=function(){return this.filter(function(response){return"wrong"===response.get("outcome")})},QuestionResponseCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ReadEventCollection=function(superClass){function ReadEventCollection(){return ReadEventCollection.__super__.constructor.apply(this,arguments)}return extend(ReadEventCollection,superClass),ReadEventCollection.prototype.model=Boundless.ReadEvent,ReadEventCollection.prototype.paramRoot="read_event",ReadEventCollection.prototype.url=function(){return Boundless.API+"/books/"+reader.book.id+"/chapters/"+this.chapter.id+"/read_events"},ReadEventCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.RecentLessonCollection=function(superClass){function RecentLessonCollection(){return RecentLessonCollection.__super__.constructor.apply(this,arguments)}return extend(RecentLessonCollection,superClass),RecentLessonCollection.prototype.model=Boundless.LessonSession,RecentLessonCollection.prototype.url=function(){return reader.book.url()+"/lesson_sessions/recent"},RecentLessonCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.SchoolCollection=function(superClass){function SchoolCollection(){return SchoolCollection.__super__.constructor.apply(this,arguments)}return extend(SchoolCollection,superClass),SchoolCollection.prototype.model=Boundless.School,SchoolCollection.prototype.url=function(){return Boundless.API+"/schools"},SchoolCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.SectionCollection=function(superClass){function SectionCollection(){return SectionCollection.__super__.constructor.apply(this,arguments)}return extend(SectionCollection,superClass),SectionCollection.prototype.model=Boundless.Section,SectionCollection.prototype.find_section_by_number=function(number){return this.find(function(_this){return function(section){return section.get("number")===number}}(this))},SectionCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.SubjectTagCollection=function(superClass){function SubjectTagCollection(){return SubjectTagCollection.__super__.constructor.apply(this,arguments)}return extend(SubjectTagCollection,superClass),SubjectTagCollection.prototype.model=Boundless.SubjectTag,SubjectTagCollection.prototype.url=function(){return Boundless.API+"/subject_tags"},SubjectTagCollection}(BackRails.Collection)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.UserCollection=function(superClass){function UserCollection(){return UserCollection.__super__.constructor.apply(this,arguments)}return extend(UserCollection,superClass),UserCollection.prototype.model=Boundless.User,UserCollection}(BackRails.Collection)}.call(this),function(){Boundless.EventManager=function(){function EventManager(){}return EventManager}(),_.extend(Boundless.EventManager.prototype,Backbone.Events),window.events=new Boundless.EventManager}.call(this),function(){Boundless.IosManager=function(){function IosManager(){}return IosManager.prototype.is_ios_app=function(){return/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i.test(navigator.userAgent)||"true"===$.cookie("emulate_ios_app")},IosManager.prototype.ios_app_version=function(){return this.is_ios_app()&&null!=$.cookie("boundless_app_version")?$.cookie("boundless_app_version"):void 0},IosManager.prototype.is_ios_6=function(){return/CPU OS 6/.test(window.navigator.userAgent)},IosManager.prototype.ios_app_version_gte=function(target_version_string){return this.compare_ios_version(target_version_string)>=0},IosManager.prototype.ios_app_version_lt=function(target_version_string){return this.compare_ios_version(target_version_string)<0},IosManager.prototype.purchased_book_ids=function(){var ids,ref,ref1,ref2;return ids=null!=(ref=window.session)&&null!=(ref1=ref.current_user)&&null!=(ref2=ref1.get("purchases"))?ref2.map(function(_this){return function(p){return p.get("book_id")}}(this)):void 0,null!=ids?JSON.stringify(ids):""},IosManager.prototype.invoke_in_ios=function(method,params,success_js_callback,error_js_callback){var iframe,ios_call,join_op;return null==params&&(params={}),null==success_js_callback&&(success_js_callback=null),null==error_js_callback&&(error_js_callback=null),iframe=document.createElement("IFRAME"),ios_call=method,window.params=params,_.keys(params).length>0&&(ios_call+="?"+this.serialize_params(params)),null!=success_js_callback&&(success_js_callback=encodeURIComponent(success_js_callback),join_op=ios_call.indexOf("?")>=0?"&":"?",ios_call+=join_op+"success_js_callback="+success_js_callback),null!=error_js_callback&&(error_js_callback=encodeURIComponent(error_js_callback),join_op=ios_call.indexOf("?")>=0?"&":"?",ios_call+=join_op+"error_js_callback="+error_js_callback),"test"===Boundless.ENV&&$("#ios_test_cont").text(ios_call),iframe.setAttribute("src","js-call:"+ios_call),document.documentElement.appendChild(iframe),iframe.parentNode.removeChild(iframe),iframe=null},IosManager.prototype.compare_ios_version=function(target_version_string){return this.is_ios_app()&&this.compare_versions(this.ios_app_version_array(),this.parse_version_string(target_version_string))},IosManager.prototype.compare_versions=function(a_version_array,b_version_array){var a_greater,b_greater;if(null==a_version_array||null==b_version_array||a_version_array.length!==b_version_array.length)throw"Unable to compare versions: "+a_version_array+" <=> "+b_version_array;return a_greater=!1,b_greater=!1,_.each(a_version_array,function(_this){return function(a,index){var b;if(b=b_version_array[index],!a_greater&&!b_greater){if(a>b)return a_greater=!0;if(b>a)return b_greater=!0}}}(this)),a_greater?1:b_greater?-1:0},IosManager.prototype.ios_app_version_array=function(){return this.parse_version_string(this.ios_app_version())},IosManager.prototype.parse_version_string=function(version_string){var matcher;return version_string&&(matcher=version_string.match(/^([0-9]+)\.([0-9]+)\.([0-9]+)/))?matcher.slice(1,4).map(function(_this){return function(v){return parseInt(v)}}(this)):null},IosManager.prototype.serialize_params=function(params){var strings;return strings=[],_.each(_.pairs(params),function(pair){var key,value;return key=pair[0],value=pair[1],strings.push(encodeURIComponent(key)+"="+encodeURIComponent(value))}),strings.join("&")},IosManager}(),_.extend(Boundless.IosManager.prototype,Backbone.Events),window.IosManager=new Boundless.IosManager}.call(this),function(){Boundless.SEOContentManager=function(){function SEOContentManager(){}return SEOContentManager.prototype._get_selection_text=function(){var e;return e="",window.getSelection?e=window.getSelection().toString():document.selection&&"Control"!==document.selection.type&&(e=document.selection.createRange().text),e},SEOContentManager.prototype.bind_copy_and_cut=function(){return $(document.body).bind("copy cut",function(_this){return function(event){var content,content_clean,ref;return content=_this._get_selection_text(),content_clean=content.substring(0,499).replace(/\\(n|r\\n|r)/gm,"\\n "),$("#copyReplace").html(content.substr(0,149)+(null!=(ref=content.length>150)?ref:{"&hellip;":""})),$("#myModal").modal(),Boundless.Events.General.track("no_bounce")}}(this))},SEOContentManager}()}.call(this),function(){Boundless.SessionManager=function(){function SessionManager(){this.current_user=null,this.withData("user",this.set_current_user.bind(this))}return SessionManager.prototype.set_current_user=function(user){return user instanceof Boundless.User||(user=new Boundless.User(user)),this.current_user=user,Honeybadger.setContext({user_id:this.current_user.id,email:this.current_user.get("email")})},SessionManager.prototype.logged_in=function(){return null!=this.current_user},SessionManager.prototype.logout=function(callback){var user_session;return null==callback&&(callback=this.after_logout),Boundless.Analytics.destroy_mixpanel_cookies(),Honeybadger.setContext({user_id:null,email:null}),this.logged_in()?(user_session=new Boundless.UserSession,user_session.destroy({success:function(_this){return function(){return callback()}}(this)})):callback()},SessionManager.prototype.after_logout=function(){return window.location=window.location.protocol+"//"+window.location.host},SessionManager.prototype.getData=function(name){return"undefined"!=typeof PageData&&null!==PageData?PageData[name]:void 0},SessionManager.prototype.withData=function(name,callback){var data;return data=this.getData(name),null!=data&&callback(data),data},SessionManager}(),_.extend(Boundless.SessionManager.prototype,Backbone.Events),window.session=new Boundless.SessionManager}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CopyButtonController=function(superClass){function CopyButtonController(){return CopyButtonController.__super__.constructor.apply(this,arguments)}return extend(CopyButtonController,superClass),CopyButtonController.prototype.template="copy_button",CopyButtonController.prototype.events={"click .copy-button":"copy_button_clicked"},CopyButtonController.prototype.helper_methods=["copy_button_class","clipboard_text"],CopyButtonController.prototype.initialize=function(options){return null==options&&(options={}),this.copy_button_class=null!=options.copy_button_class?options.copy_button_class:"",options.clipboard_text?(this.clipboard_text=options.clipboard_text,this.render()):(Boundless.Logger.error("You must supply some text to copy to the clipboard"),!1)},CopyButtonController.prototype.render=function(){return CopyButtonController.__super__.render.apply(this,arguments),this.copy_button=this.$(".copy-button"),this.clip=new Clipboard(".copy-button"),this.clip.on("error",function(_this){return function(e){var text;return text=e.trigger.dataset.clipboardText,window.prompt("Copy to clipboard: \u2318+C, Enter",text)}}(this)),this.clip.on("success",function(_this){return function(e){return _this.link_button_clicked(),e.clearSelection()}}(this)),this},CopyButtonController.prototype.copy_button_clicked=function(){return this.copy_button.attr("disabled","disabled"),this.copy_button.html("Copied!")},CopyButtonController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.GlobalModalController=function(superClass){function GlobalModalController(){return this.object_offset=bind(this.object_offset,this),GlobalModalController.__super__.constructor.apply(this,arguments)}return extend(GlobalModalController,superClass),GlobalModalController.prototype.curtain_transition_time=150,GlobalModalController.prototype.show_callback=null,GlobalModalController.prototype.hide_callback=null,GlobalModalController.prototype.className="modal__curtain scrollable",GlobalModalController.prototype.template="modal",GlobalModalController.prototype.events={"click .js__modal__close":"close_clicked","keypress .js__modal__close":"handle_keypress_on_close","click .modal__wrapper":"curtain_clicked","keydown .modal__inner":"handle_keydown",click:"curtain_clicked"},GlobalModalController.prototype.initialize=function(options){return null==options&&(options={}),this.$body=window.$body||$("body"),this.position=null!=options.position?options.position:!1,GlobalModalController.__super__.initialize.apply(this,arguments),this.render(),this.modal_inner=this.$(".modal__inner"),this.position?this.modal_inner.css({width:options.width+"px"}):this.modal_inner.css({"max-width":options.width+"px"}),this.modal_inner.prepend(options.contents),this.position&&this.setup_positioning(),this.on("modal:show",function(_this){return function(callback){return null==callback&&(callback=_this.show_callback),_this.show(callback)}}(this)),this.on("modal:hide",function(_this){return function(callback){return null==callback&&(callback=_this.hide_callback),_this.hide(callback,!0)}}(this)),this},GlobalModalController.prototype.setup_positioning=function(){return this.$el[0].className="modal__popover",this.modal_inner.css({position:"absolute"}),"object"==typeof this.position?(this.object_offset(),$(window).on("resize.popover",function(_this){return function(){var resizeTimer;return clearTimeout(resizeTimer),resizeTimer=setTimeout(_this.object_offset,100)}}(this))):"array"==typeof this.position?this.adjust_positioning(this.position[0],this.position[1]):void 0},GlobalModalController.prototype.object_offset=function(){var offset;return offset=this.position.offset(),this.adjust_positioning(offset.left,offset.top+this.position.outerHeight())},GlobalModalController.prototype.adjust_positioning=function(left,top){return this.modal_inner.css({left:left+"px",top:top+"px"})},GlobalModalController.prototype.render=function(){return GlobalModalController.__super__.render.apply(this,arguments),this.$body.append(this.$el),this},GlobalModalController.prototype.handle_keydown=function(e){var first,last,tabbables;if(e.keyCode===KeyCode.TAB){if(tabbables=this.$(":tabbable"),first=tabbables.filter(":first"),last=tabbables.filter(":last"),e.target===last[0]&&!e.shiftKey)return first.focus(1),!1;if(e.target===first[0]&&e.shiftKey)return last.focus(1),!1}else if(e.keyCode===KeyCode.ESCAPE)return this.trigger("modal:hide")},GlobalModalController.prototype.close_clicked=function(e){return this.trigger("modal:hide")},GlobalModalController.prototype.handle_keypress_on_close=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.trigger("modal:hide"):void 0},GlobalModalController.prototype.curtain_clicked=function(e){return e.target===e.currentTarget?this.hide(null,!0):void 0},GlobalModalController.prototype.show=function(callback){return null==callback&&(callback=this.show_callback),this.focused_element_before_shown=document.activeElement,this.position||this.$body.addClass("modal__showing"),setTimeout(function(_this){return function(){return _this.$el.addClass("modal__show modal__on"),setTimeout(function(){return _this.$el.addClass("modal__show-wrapper"),_this.trigger("modal:shown"),_this.$(":tabbable").first().focus(),"function"==typeof callback?callback():void 0},_this.curtain_transition_time)}}(this),10),"function"==typeof callback&&callback(),this},GlobalModalController.prototype.hide=function(callback,remove){return null==callback&&(callback=this.hide_callback),null==remove&&(remove=!1),this.position?$(document).off("click.popover"):this.$body.removeClass("modal__showing"),this.$el.removeClass("modal__show-wrapper"),setTimeout(function(_this){return function(){return _this.$el.removeClass("modal__show"),setTimeout(function(){return _this.$el.removeClass("modal__on"),_this.trigger("modal:hidden"),"function"==typeof callback&&callback(),remove&&_this.remove(),_this.focused_element_before_shown?$(_this.focused_element_before_shown).focus():void 0},_this.curtain_transition_time)}}(this),50),this},GlobalModalController.prototype.remove=function(){return GlobalModalController.__super__.remove.apply(this,arguments),$(window).off("resize.popover"),$(document).off("click.popover"),this.off("modal:show"),this.off("modal:hide")},GlobalModalController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["global/views/copy_button"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<button class='"+["btn","copy-button",""+$e($c(this.copy_button_class))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-clipboard-text='"+$e($c(this.clipboard_text))+"'>\n  <span>Copy</span>\n</button>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["global/views/modal"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__wrapper'>\n  <div class='clearfix modal__inner'>\n    <div class='js__modal__close modal__close' tabindex='"+$e($c(0))+"' role='button' aria-label='Close Dialog'>\n      <i class='icon-remove'></i>\n      <span class='modal__close-text'>Close</span>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("global/views"),Boundless.Modal=function(){function Modal(el,width,options){null==options&&(options={}),this.controller=new Boundless.GlobalModalController({contents:el,width:width,position:options.position})}return Modal.prototype.on_hide=function(callback){return this.controller.hide_callback=callback},Modal.prototype.on_show=function(callback){return this.controller.show_callback=callback},Modal.prototype.hide=function(){return 0!==$(".modal__show").length?this.controller.trigger("modal:hide"):void 0},Modal.prototype.show=function(){return this.controller.trigger("modal:show")},Modal}(),$("#main").off("click","a[modal=true]"),$("#main").on("click","a[modal=true]",function(e){var $el,modal,modal_content,width;return e.preventDefault(),$el=$(e.currentTarget),modal_content=$el.siblings(".modal-content-holder").html(),width=$el.attr("data-modal-width")||500,modal_content?(modal=new Boundless.Modal(modal_content,width),modal.show()):void 0})}.call(this),function(){Boundless.LearningRoutes={learning_course_url:function(course_id){return Boundless.LEARNING_APP_URL+"/courses/"+course_id+"/"},teaching_course_url:function(course_id){return Boundless.LEARNING_APP_URL+"/teaching/courses/"+course_id+"/"},teaching_lesson_assignments_url:function(course_id){return Boundless.LEARNING_APP_URL+"/teaching/courses/"+course_id+"/assignments/"},teaching_lesson_assignment_url:function(course_id,lesson_assignment_id){return Boundless.LEARNING_APP_URL+"/teaching/courses/"+course_id+"/assignments/"+lesson_assignment_id+"/"},teaching_students_url:function(course_id){return Boundless.LEARNING_APP_URL+"/teaching/courses/"+course_id+"/students/"},teaching_student_url:function(course_id,student_id){return Boundless.LEARNING_APP_URL+"/teaching/courses/"+course_id+"/students/"+student_id+"/"}}}.call(this),function(){document.addEventListener("keydown",function(e){return e.keyCode===KeyCode.TAB?$("body").addClass("show-focus-outlines"):void 0}),document.addEventListener("click",function(e){return $("body").removeClass("show-focus-outlines")})}.call(this),function(){Boundless.append_view_path("login/views"),Boundless.Login||(Boundless.Login={}),Boundless.Login.App=function(){function App(el,modal){var login_options;null==modal&&(modal=!1),login_options={el:el,template:modal?"modal_login":"login"},this.login_controller=new Boundless.Login.LoginController(login_options),this.login_controller.on("login:session_created",function(_this){return function(){return"function"==typeof _this.complete_callback&&_this.complete_callback(),_this.login_controller.redirect_path?window.location=_this.login_controller.redirect_path:void 0}}(this)),this.login_controller.on("login:forgot",function(_this){return function(){var forgot_options;return forgot_options={el:el,template:modal?"modal_forgot":"forgot"},_this.forgot_controller=new Boundless.Login.ForgotController(forgot_options)}}(this))}return App.prototype.on_complete=function(callback){return this.complete_callback=callback},App}(),$(function(){return $("body").off("click","a[data-popup=login]",function(e){}),$("body").on("click","a[data-popup=login]",function(e){var $login_reg_cont,link,popup,redirect_path;return e.preventDefault(),link=$(e.currentTarget),$login_reg_cont=$("<div id='login_reg__cont'></div>"),popup=new Boundless.Modal($login_reg_cont,450),this.login_app=new Boundless.Login.App($login_reg_cont,!0),this.login_app.login_controller.popup=popup,(redirect_path=$(link).data("redirect-destination"))?this.login_app.login_controller.redirect_path=redirect_path:$(link).data("redirect-reload")?this.login_app.login_controller.redirect_path=window.location.href:this.login_app.login_controller.redirect_path=window.location.protocol+"//"+window.location.host+"/home-redirect/",popup.show()})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Login.ForgotController=function(superClass){function ForgotController(){return ForgotController.__super__.constructor.apply(this,arguments)}return extend(ForgotController,superClass),ForgotController.prototype.template="forgot",ForgotController.prototype.events={"submit #passwordreset-form":"submitted_forgot_form"},ForgotController.prototype.helper_methods=["password_reset"],ForgotController.prototype.initialize=function(params){return null==params&&(params={}),ForgotController.__super__.initialize.apply(this,arguments),this.template=params.template||"forgot",this.render(),this},ForgotController.prototype.render=function(template_name,context){return null==template_name&&(template_name=this.template),null==context&&(context={}),this.password_reset||(this.password_reset=new Boundless.PasswordReset),ForgotController.__super__.render.apply(this,arguments),this.$(".login__success").hide(),this.$(":tabbable").first().focus(),this.$(".login__error").hide(),this},ForgotController.prototype.submitted_forgot_form=function(e){var $form,password_reset_fields;return e.preventDefault(),$form=this.$("#passwordreset-form"),password_reset_fields=$form.fields_for("passwordreset"),$form.disable_form(),this.password_reset.save(password_reset_fields,{success:function(_this){return function(model){return _this.$(".login__success").show(),_this.$("h3").hide(),$form.hide()}}(this),error:function(_this){return function(model,response){return _this.render(),_this.$(".login__error").show()}}(this)}),!1},ForgotController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Login.LoginController=function(superClass){function LoginController(){return LoginController.__super__.constructor.apply(this,arguments)}return extend(LoginController,superClass),LoginController.prototype.template="login",LoginController.prototype.events={"submit #login-form":"submitted_login_form","click #facebook_btn":"clicked_facebook_login","click #google_btn":"clicked_google_login","click .login__forgot-link":"clicked_forgot","keypress .login__forgot-link":"handle_keypress_forgot"},LoginController.prototype.helper_methods=["user_session","errors","hide_oauth_providers"],LoginController.prototype.initialize=function(params){return null==params&&(params={}),LoginController.__super__.initialize.apply(this,arguments),this.template=params.template||"login",this.hide_oauth_providers=params.hide_oauth_providers||!1,this.link_to_lti_post=params.link_to_lti_post,this.render(),this},LoginController.prototype.render=function(template_name,context){return null==template_name&&(template_name=this.template),null==context&&(context={}),this.user_session||(this.user_session=new Boundless.UserSession),LoginController.__super__.render.apply(this,arguments),this.reset_form(),setTimeout(function(_this){return function(){return _this.$(".email_input").focus()}}(this),500),this},LoginController.prototype.reset_form=function(){return this.$(".password_input").val("")},LoginController.prototype.submitted_login_form=function(e){var $form,session_fields;return e.preventDefault(),$form=this.$("#login-form"),session_fields=$form.fields_for("usersession"),$form.disable_form(),this.user_session.save(session_fields,{success:function(_this){return function(user_session,response){return _this.finish_login(user_session)}}(this),error:function(_this){return function(user_session,response){return _this.render()}}(this)}),!1},LoginController.prototype.clicked_facebook_login=function(e){return this.clicked_oauth_login(e,"facebook")},LoginController.prototype.clicked_google_login=function(e){return this.clicked_oauth_login(e,"google")},LoginController.prototype.clicked_oauth_login=function(e,provider){return e.preventDefault(),Boundless.Oauth.authenticate(provider,{allow_create_user:!1,success:function(_this){return function(user){return _this.finish_oauth_login(user)}}(this),error:function(_this){return function(errors){return _this.errors=errors,_this.render()}}(this)}),Boundless.Events.RegistrationFunnel.track("clicked_oauth_login_button",{provider:provider}),!1},LoginController.prototype.finish_oauth_login=function(user){var user_session;return user_session=new Boundless.UserSession({user:user,id:user.get("reader_authentication_token"),reader_authentication_token:user.get("reader_authentication_token")}),this.finish_login(user_session)},LoginController.prototype.finish_login=function(user_session){var callback,lti_post_id,url,user_id;return callback=function(_this){return function(){return user_session.set({id:""}),session.set_current_user(user_session.get("user")),_this.trigger("login:session_created",user_session)}}(this),this.link_to_lti_post?(url=this.link_to_lti_post.url,user_id=user_session.get("user").id,lti_post_id=this.link_to_lti_post.lti_post_id,this.link_user_to_lti(url,user_id,lti_post_id,callback)):callback()},LoginController.prototype.link_user_to_lti=function(url,user_id,lti_post_id,callback){return $.ajax({url:url.replace(":user_id",user_id),type:"POST",data:{lti_post_id:lti_post_id}}).done(callback).fail(function(resp){return Boundless.Logger.error("Linking LTI account failed",resp)})},LoginController.prototype.clicked_forgot=function(e){return e.preventDefault(),this.trigger("login:forgot")},LoginController.prototype.handle_keypress_forgot=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.trigger("login:forgot"):void 0},LoginController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["login/views/forgot"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='login__cont'>\n  <h3>Enter your email address to reset your password</h3>\n  <p class='login__error' role='alert'>Unknown email address. Please verify you've entered your email address correctly.</p>\n  <p class='login__success' role='alert'>Success. We've just sent you an email with a link to reset your password.</p>"),$o.push("  "+$c(this.form_for(this.password_reset,function(form){var $o1;return $o1=[],$o1.push("  "+$c(form.input("email",{input_class:"email_input",label:!1,as:"string",liveValidate:!1,placeholder:"Email",size:"xlarge",wrapper_class:"full_field"}))),$o1.push("  "+$c(form.action("submit",{label:"Submit",as:"button",action_class:"btn-large btn-upcase"}))),$o1.join("\n")}))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["login/views/login"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='login__cont'>"),this.hide_oauth_providers||($o.push("  <div class='login__option'>\n    <button class='btn btn-block btn-facebook btn-large btn-upcase' id='facebook_btn' rel='facebook_user_session_form'>\n      <i class='icon-facebook'></i>\n      Login Using Facebook\n    </button>"),null!=this.errors&&null!=this.errors.facebook_error&&$o.push("    <p class='centered login__error' role='alert'>"+$c(this.errors.facebook_error)+"</p>"),$o.push("  </div>\n  <div class='login__option'>\n    <button class='btn btn-block btn-google btn-large btn-upcase' id='google_btn' rel='google_user_session_form'>\n      <i class='icon-google-plus'></i>\n      Login Using Google\n    </button>"),null!=this.errors&&null!=this.errors.google_error&&$o.push("    <p class='centered login__error' role='alert'>"+$c(this.errors.google_error)+"</p>"),$o.push("  </div>")),$o.push("  <div class='login__option'>\n    <h3>Login With Your Email</h3>"),$o.push("    "+$c(this.form_for(this.user_session,{id:"login-form"},function(form){var $o1;return $o1=[],$o1.push("    "+$c(form.input("email",{input_class:"email_input",label:!1,as:"email",liveValidate:!1,placeholder:"Email",ariaLabel:"Email"}))),$o1.push("    "+$c(form.input("password",{input_class:"password_input",label:!1,as:"password",liveValidate:!1,placeholder:"Password",ariaLabel:"Password"}))),$o1.push("    "+$c(form.action("submit",{label:"<i class='icon-signin'></i> Login",as:"button",action_class:"btn-large btn-block btn-upcase"}))),$o1.push("    <a class='login__forgot-link' tabindex='"+$e($c(0))+"' role='link'>Forgot your password?</a>"),$o1.join("\n")}))),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){
null==window.HAML&&(window.HAML={}),window.HAML["login/views/modal_forgot"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__inner-header'>\n  <h2>Forgot your password?</h2>\n</div>\n<div class='modal__inner-body'>"),$o.push("  "+$c(this.partial("forgot",this))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["login/views/modal_login"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__inner-header'>\n  <h2>Login</h2>\n</div>\n<div class='modal__inner-body'>"),$o.push("  "+$c(this.partial("login",this))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){}.call(this),function(){var performRedirect,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Boundless.append_view_path("register/views"),null==Boundless.Register&&(Boundless.Register={}),Boundless.Register.startRegistration=function(arg){var conversionEvent,eventName,eventNamespace,linkHandler,props,readerFrame,ref,skipAdditionalInfo,skipRoleSelector,startEvent,startEventPropertiesJson,trackEvent,trackEventData,userRole,wizzard,wizzardSidebar;return conversionEvent=arg.conversionEvent,linkHandler=arg.linkHandler,readerFrame=arg.readerFrame,skipAdditionalInfo=arg.skipAdditionalInfo,skipRoleSelector=arg.skipRoleSelector,startEvent=arg.startEvent,startEventPropertiesJson=arg.startEventPropertiesJson,trackEvent=arg.trackEvent,trackEventData=arg.trackEventData,userRole=arg.userRole,wizzardSidebar=arg.wizzardSidebar,this.register_controller=new Boundless.Register.RegisterController({conversion_event:conversionEvent,skip_additional_info:skipAdditionalInfo,skip_role_selector:skipRoleSelector,user_role:userRole}),wizzard=new Boundless.WizzardController({sidebar_template:wizzardSidebar,step_els:[this.register_controller.$el]}),this.register_controller.on("register:complete",function(){return performRedirect({readerFrame:readerFrame,linkHandler:linkHandler,wizzard:wizzard})}),Boundless.Events.RegistrationFunnel.track("clicked_sign_up",{from_page:PageData.concept_data?"concept":document.title}),(eventName=startEvent)&&(props=startEventPropertiesJson||{},indexOf.call(eventName,":")>=0?(ref=eventName.split(":"),eventNamespace=ref[0],eventName=ref[1],Boundless.Events[eventNamespace].track(eventName,props)):Boundless.Events.RegistrationFunnel.track(eventName)),wizzard.render()},performRedirect=function(arg){var linkHandler,readerFrame,wizzard;return readerFrame=arg.readerFrame,linkHandler=arg.linkHandler,wizzard=arg.wizzard,null!=wizzard&&wizzard.hide(),readerFrame?void 0:"function"==typeof linkHandler?linkHandler():void 0},$(function(){return $(document).on("click",".not-logged-in a[data-popup=register]",function(e){var $link,options;return e.preventDefault(),$link=$(e.currentTarget),options=$link.data(),options.linkHandler=function(){return Boundless.LinkHelper.handle_link($link,window.location.protocol+"//"+window.location.host+"/home-redirect/")},Boundless.Register.startRegistration(options)})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Register.AdditionalInformationController=function(superClass){function AdditionalInformationController(){return AdditionalInformationController.__super__.constructor.apply(this,arguments)}return extend(AdditionalInformationController,superClass),AdditionalInformationController.prototype.template="additional_information",AdditionalInformationController.prototype.events={"click .register__subject":"toggle_subject","keypress .register__subject":"on_toggle_subject_keypress","click .register__skip-button":"skip_clicked","keypress .register__skip-button":"on_skip_keypress","submit #additional-info-form":"additional_info_submitted"},AdditionalInformationController.prototype.helper_methods=["user","force_additional_info"],AdditionalInformationController.prototype.initialize=function(params){return null==params&&(params={}),AdditionalInformationController.__super__.initialize.apply(this,arguments),this.user=params.user,this.force_additional_info=params.force_additional_info||!1,this},AdditionalInformationController.prototype.render=function(){var school_input;return AdditionalInformationController.__super__.render.apply(this,arguments),school_input=this.$("#user-school_name-input"),school_input?school_input.focus():this.$(":tabbable").first().focus(),this},AdditionalInformationController.prototype.on_toggle_subject_keypress=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.toggle_subject(e):void 0},AdditionalInformationController.prototype.toggle_subject=function(e){var is_checked;return is_checked="true"===this.$(e.currentTarget).attr("aria-checked"),this.$(e.currentTarget).attr("aria-checked",""+!is_checked)},AdditionalInformationController.prototype.additional_info_submitted=function(e){var $form,user_fields;return e.preventDefault(),$form=this.$("#additional-info-form"),user_fields=$form.fields_for("user"),$form.disable_form(),user_fields.interested_subject_tag_ids=_.map(this.$(".register__subject[aria-checked=true]"),function(item){return $(item).data("id")}),this.user.save(user_fields,{success:function(_this){return function(model){return Boundless.Events.RegistrationFunnel.track("entered_additional_info",{skipped:"false"},function(){return _this.trigger("register:additional_info_done",_this.user)})}}(this),error:function(_this){return function(){return _this.render()}}(this)}),!1},AdditionalInformationController.prototype.on_skip_keypress=function(){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.skip_clicked():void 0},AdditionalInformationController.prototype.skip_clicked=function(){return Boundless.Events.RegistrationFunnel.track("entered_additional_info",{skipped:"true"},function(_this){return function(){return _this.trigger("register:additional_info_done",_this.user)}}(this))},AdditionalInformationController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Register.EmailAndPasswordController=function(superClass){function EmailAndPasswordController(){return EmailAndPasswordController.__super__.constructor.apply(this,arguments)}return extend(EmailAndPasswordController,superClass),EmailAndPasswordController.prototype.template="email_and_password",EmailAndPasswordController.prototype.events={"submit #register-form":"register_submitted","click .register__login-button":"show_login","keypress .register__login-button":"handle_keypress_on_login","click #google_btn":"clicked_google_register"},EmailAndPasswordController.prototype.helper_methods=["user","hide_oauth_providers","force_additional_info","errors"],EmailAndPasswordController.prototype.initialize=function(params){return null==params&&(params={}),EmailAndPasswordController.__super__.initialize.apply(this,arguments),this.user=params.user,this.hide_oauth_providers=params.hide_oauth_providers||!1,this.force_additional_info=params.force_additional_info||!1,this},EmailAndPasswordController.prototype.set_starting_cursor=function(){return this.$("#user-first_name-input").focus()},EmailAndPasswordController.prototype.register_submitted=function(e){var $form,user_fields;return e.preventDefault(),$form=this.$("#register-form"),user_fields=$form.fields_for("user"),$form.disable_form(),_.extend(user_fields,Boundless.Analytics.initial_values()),this.user.save(user_fields,{success:function(_this){return function(model){return _this.handle_login()}}(this),error:function(_this){return function(){return _this.render()}}(this)}),!1},EmailAndPasswordController.prototype.clicked_google_register=function(e){return this.clicked_oauth_register(e,"google")},EmailAndPasswordController.prototype.clicked_oauth_register=function(e,provider){return e.preventDefault(),Boundless.Oauth.authenticate(provider,{user:this.user,success:function(_this){return function(user){return _this.user=user,_this.handle_login()}}(this),error:function(_this){return function(errors){return _this.errors=errors,_this.render()}}(this)}),Boundless.Events.RegistrationFunnel.track("clicked_oauth_register_button",{provider:provider}),!1},EmailAndPasswordController.prototype.handle_login=function(){var user_session;return delete this.user.attributes.password,user_session=new Boundless.UserSession({user:this.user,id:this.user.get("reader_authentication_token"),reader_authentication_token:this.user.get("reader_authentication_token")}),session.set_current_user(user_session.get("user").set("purchases",new Boundless.PurchaseCollection)),Boundless.Analytics.alias(session.current_user.get("analytics_distinct_id")),Boundless.Analytics.identify(session.current_user,function(_this){return function(){return"undefined"!=typeof _tfa&&null!==_tfa&&_tfa.push({notify:"action",name:"registered"}),_this.conversion_event?Boundless.Events.RegistrationFunnel.track(_this.conversion_event,{},function(){return _this.finish_registration()}):_this.finish_registration()}}(this))},EmailAndPasswordController.prototype.finish_registration=function(){return Boundless.Events.RegistrationFunnel.track("registered",{source:"standalone"},function(_this){return function(){return _this.trigger("register:user_created",_this.user)}}(this))},EmailAndPasswordController.prototype.show_login=function(){return events.trigger("register:show_login")},EmailAndPasswordController.prototype.handle_keypress_on_login=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.show_login():void 0},EmailAndPasswordController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Register.RegisterController=function(superClass){function RegisterController(){return RegisterController.__super__.constructor.apply(this,arguments)}return extend(RegisterController,superClass),RegisterController.prototype.template="register_layout",RegisterController.prototype.id="register__wrapper",RegisterController.prototype.events={"click .register__register-button a":"back_to_register","keypress .register__register-button a":"handle_keypress_on_register"},RegisterController.prototype.helper_methods=["user","skip_role_selector","skip_additional_info","step_count","hide_oauth_providers","force_additional_info"],RegisterController.prototype.initialize=function(params){var ref;return null==params&&(params={}),RegisterController.__super__.initialize.apply(this,arguments),this.user=new Boundless.User(params.user_params||{}),this.conversion_event=params.conversion_event,this.hide_oauth_providers=params.hide_oauth_providers||!1,this.force_additional_info=this.user.get("lti_instructor")||!1,this.skip_additional_info=params.skip_additional_info||!1,this.link_to_lti_post=params.link_to_lti_post,null!=params.user_role&&this.user.set(params.user_role,!0),this.force_additional_info?(this.skip_additional_info=!1,this.skip_role_selector=!0,this.step_count=2):(null!=params.user_role||null!=params.skip_role_selector)&&(this.skip_role_selector=!0),this.step_count||(this.step_count=function(){switch(!1){case!(this.skip_role_selector&&this.skip_additional_info):return 1;case!(this.skip_role_selector||this.skip_additional_info):return 2;default:return 3}}.call(this)),this.render(),events.on("register:show_login",function(_this){return function(){return _this.go_to("login")}}(this)),(null!=(ref=this.user)?ref.id:void 0)&&this.force_additional_info?this.go_to("additional-info"):this.skip_role_selector?this.go_to("email-password"):this.go_to("user-types"),Boundless.Events.Sneak.track("viewed_registration_dialog",{variant:params.variant}),this},RegisterController.prototype.handle_keypress_on_register=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.back_to_register():void 0},RegisterController.prototype.back_to_register=function(){return this.go_to("register")},RegisterController.prototype.finish=function(){return this.conversion_event?Boundless.Events.RegistrationFunnel.track(this.conversion_event,function(_this){return function(){return _this.trigger("register:complete",_this.user),events.trigger("register:complete",_this.user)}}(this)):(this.trigger("register:complete",this.user),events.trigger("register:complete",this.user))},RegisterController.prototype.go_to=function(step){var login_height,register_height;switch(step){case"login":return this.login_controller=new Boundless.Login.LoginController({el:this.$(".register__login"),hide_oauth_providers:this.hide_oauth_providers,link_to_lti_post:this.link_to_lti_post}),this.login_controller.on("login:session_created",function(_this){return function(){return _this.trigger("register:complete",session.current_user)}}(this)),this.login_controller.on("login:forgot",function(_this){return function(){return _this.forgot_controller=new Boundless.Login.ForgotController({el:_this.$(".register__login")})}}(this)),login_height=this.$(".register__login-cont").outerHeight(),register_height=this.$(".register__register-steps-cont").outerHeight(),this.$(".register__steps-cont").css({height:register_height}),this.$(".register__login-cont").show(),this.$(".register__steps-cont").animate({height:login_height},500),this.$(".register__register-steps-cont").css({marginTop:-1*register_height}),this.$(".steps__indicator-cont").addClass("register__showing-login"),setTimeout(function(_this){return function(){return _this.$(".register__steps-cont").css({height:"auto"}),_this.$(".register__register-steps-cont").hide()}}(this),510);case"register":return login_height=this.$(".register__login-cont").outerHeight(),register_height=this.$(".register__register-steps-cont").outerHeight(),this.$(".register__register-steps-cont").show(),this.$(".register__steps-cont").css({height:login_height}),this.$(".register__steps-cont").animate({height:register_height},500),this.$(".register__register-steps-cont").css({marginTop:0}),this.$(".steps__indicator-cont").removeClass("register__showing-login"),setTimeout(function(_this){return function(){return _this.$(".register__login-cont").hide(),_this.$(".register__steps-cont").css({height:"auto"})}}(this),510);case"user-types":return this.user_role_controller=new Boundless.Register.UserTypeController({user:this.user,el:this.$(".register__step__user-type")}),this.user_role_controller.render(),this.set_step(0),this.user_role_controller.on("register:types_selected",function(_this){return function(user){return _this.user=user,_this.go_to("email-password")}}(this));case"email-password":return this.email_password_controller=new Boundless.Register.EmailAndPasswordController({user:this.user,el:this.$(".register__step__email-password"),hide_oauth_providers:this.hide_oauth_providers,force_additional_info:this.force_additional_info}),this.email_password_controller.render(),this.skip_role_selector?this.set_step(1):this.set_step(2),this.email_password_controller.on("register:user_created",function(_this){return function(user){return _this.user=user,_this.skip_additional_info?_this.finish():_this.go_to("additional-info")}}(this)),setTimeout(function(_this){return function(){return"test"!==Boundless.ENV?_this.email_password_controller.set_starting_cursor():void 0}}(this),510);case"additional-info":return this.additional_information_controller=new Boundless.Register.AdditionalInformationController({user:this.user,force_additional_info:this.force_additional_info,el:this.$(".register__step__additional-info")}),this.additional_information_controller.render(),this.skip_role_selector?this.set_step(2):this.set_step(3),this.additional_information_controller.on("register:additional_info_done",function(_this){return function(user){return _this.user=user,_this.finish()}}(this))}},RegisterController.prototype.set_step=function(step_num){return this.$(".register__cont").attr("data-current-step",step_num),$(".steps__step").each(function(i,step){var is_current_step;return is_current_step=step_num===i,is_current_step?$(step).find("[tabindex=-1]").attr("tabindex",0):$(step).find(":tabbable").attr({tabindex:-1})})},RegisterController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Register.UserTypeController=function(superClass){function UserTypeController(){return UserTypeController.__super__.constructor.apply(this,arguments)}return extend(UserTypeController,superClass),UserTypeController.prototype.template="user_type",UserTypeController.prototype.events={"click #submit-types":"types_submitted","click .register__user-type":"toggle_type","keypress .register__user-type":"on_checkbox_keypress","click .register__login-button":"show_login","keypress .register__login-button":"on_login_keypress"},UserTypeController.prototype.helper_methods=["user"],UserTypeController.prototype.initialize=function(params){return null==params&&(params={}),UserTypeController.__super__.initialize.apply(this,arguments),this.user=params.user,this},UserTypeController.prototype.render=function(){return UserTypeController.__super__.render.apply(this,arguments),this.$el.focus(),this.$(".register__user-type[aria-checked=true]").length||this.$("#submit-types").attr("disabled","disabled").text("Select an option above"),this},UserTypeController.prototype.on_checkbox_keypress=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.toggle_type(e):void 0},UserTypeController.prototype.toggle_type=function(e){var is_checked;return is_checked="true"===this.$(e.currentTarget).attr("aria-checked"),this.$(e.currentTarget).attr("aria-checked",""+!is_checked),this.$(".register__user-type[aria-checked=true]").length?this.$("#submit-types").removeAttr("disabled").text("Sign Up"):this.$("#submit-types").attr("disabled","disabled").text("Select an option above")},UserTypeController.prototype.types_submitted=function(e){var user_types;return e.preventDefault(),user_types={student:!1,educator:!1,expert:!1},this.user.set(user_types,{silent:!0}),this.$(".register__user-type[aria-checked=true]").each(function(_this){return function(index,node){var type;return type=$(node).data("user-type"),user_types[type]=!0,_this.user.set(type,!0)}}(this)),Boundless.Events.RegistrationFunnel.track("selected_user_type",user_types,function(_this){return function(){return _this.trigger("register:types_selected",_this.user)}}(this))},UserTypeController.prototype.on_login_keypress=function(e){return this.handleKeypressTrigger(e.keyCode,this.show_login)},UserTypeController.prototype.show_login=function(){return events.trigger("register:show_login")},UserTypeController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["register/views/additional_information"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='register__step__additional-info-cont' tabindex='"+$e($c(0))+"'>"),$o.push("  "+$c(this.form_for(this.user,{id:"additional-info-form"},function(_this){return function(form){var $o1,i,index,len,ref,subject;if($o1=[],(_this.user.get("student")||_this.user.get("educator")||_this.force_additional_info)&&($o1.push("  <h3 class='register__label'>"),$o1.push("    "+$c(_this.user.get("student")&&!_this.user.get("canvas_instructor")?"Where do you go to school?":"Where do you teach?")),$o1.push("  </h3>"),$o1.push("  "+$c(form.input("school_id",{input_class:"input-large",label:!1,as:"school",liveValidate:!1,placeholder:"College or University Name",ariaLabel:"College or University Name"}))),_this.user.get("expert")&&$o1.push("  <hr class='register__hr'>")),_this.user.get("expert")){for($o1.push("  <h3 class='register__label'>\n    What subject expertise do you have?\n    <span class='register__help-text'>(select all that apply)</span>\n  </h3>\n  <div class='register__subject-selector'>"),ref=PageData.subjects,index=i=0,len=ref.length;len>i;index=++i)subject=ref[index],$o1.push("    <div class='register__subject' data-id='"+$e($c(subject.id))+"' tabindex='"+$e($c(0))+"' role='checkbox' aria-checked='false' data-user-type='subject'>"),$o1.push("      "+$c(subject.name)),$o1.push("    </div>");$o1.push("  </div>")}return $o1.push("  "+$c(form.action("submit",{as:"button",action_class:"register__submit additional-info__submit btn btn-large btn-block btn-green",label:"Get started"}))),$o1.join("\n")}}(this)))),$o.push("  <a class='register__skip-button' style='display: none;' role='button' tabindex='"+$e($c(0))+"'>\n    Skip this and get started\n    <i class='icon-chevron-right'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["register/views/email_and_password"]=function(context){return function(){var $c,$e,$o,error,key,ref;if($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='register__step__email-password-cont'>"),!this.hide_oauth_providers){if($o.push("  <button class='btn btn-block btn-google btn-large btn-upcase' id='google_btn' rel='facebook_user_session_form'>\n    <i class='icon-google-plus'></i>\n    Sign up with Google\n  </button>"),this.errors){ref=this.errors;for(key in ref)error=ref[key],$o.push("  <p class='oauth_login_error register__error'>"+$c(error)+"</p>")}$o.push("  <hr class='register__hr--with-or'>\n  <div class='register__orr'>or</div>")}return $o.push("  <h3 class='register__label'>Sign up with email</h3>"),$o.push("  "+$c(this.form_for(this.user,{id:"register-form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("  "+$c(form.input("first_name",{input_class:"input-large",label:!1,as:"string",liveValidate:!1,placeholder:"First name",ariaLabel:"First name"}))),$o1.push("  "+$c(form.input("last_name",{input_class:"input-large",label:!1,as:"string",liveValidate:!1,placeholder:"Last name",ariaLabel:"Last name"}))),$o1.push("  "+$c(form.input("email",{input_class:"email input-large",label:!1,as:"email",liveValidate:!1,placeholder:"Your Email",ariaLabel:"Your email",ariaRequired:!0}))),$o1.push("  "+$c(form.input("password",{input_class:"password input-large",label:!1,as:"password",liveValidate:!1,placeholder:"Create a password",ariaLabel:"Create a password",ariaRequired:!0}))),$o1.push("  "+$c(form.action("submit",{as:"button",action_class:"btn btn-large btn-block btn-primary btn-upcase",label:"Sign up"}))),$o1.push("  <div class='register__help-block'>\n    By signing up, you agree to our\n    <a href='/terms'>terms of service</a>\n    and\n    <a href='/privacy'>privacy policy.</a>\n  </div>"),$o1.join("\n")}}(this)))),$o.push("  <a class='register__login-button' tabindex='"+$e($c(0))+"' role='link'>Already have an account?</a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["register/views/register_layout"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='register__cont steps__cont' data-step-count='"+$e($c(this.step_count))+"' data-current-step='"+$e($c(this.current_step))+"'>\n  <div class='steps__indicator-cont'>\n    <div class='register__register-steps-indicator-cont'>\n      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>"),this.skip_role_selector&&this.skip_additional_info?$o.push("          Register"):$o.push("          Step 1"),$o.push("        </div>\n      </div>"),this.skip_role_selector&&this.skip_additional_info||$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Step 2</div>\n      </div>"),this.skip_role_selector||this.skip_additional_info||$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Step 3</div>\n      </div>"),$o.push("    </div>\n    <div class='register__login-indicator-cont'>\n      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Login</div>\n      </div>\n    </div>\n  </div>\n  <div class='register__steps-cont'>\n    <div class='register__register-steps-cont steps__inner-cont'>"),this.skip_role_selector||$o.push("      <div class='register__step__user-type steps__step'></div>"),$o.push("      <div class='register__step__email-password steps__step'></div>"),this.skip_additional_info||$o.push("      <div class='register__step__additional-info steps__step'></div>"),$o.push("    </div>\n    <div class='register__login-cont'>\n      <div class='register__login'></div>\n      <hr class='register__hr'>\n      <div class='register__register-button'>\n        I don't have an account\n        <a tabindex='"+$e($c(0))+"' role='link'>Register</a>\n      </div>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["register/views/user_type"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='register__step__user-type-cont' tabindex='"+$e($c(0))+"'>\n  <h3 class='register__label'>\n    How would you describe yourself?\n    <span class='register__help-text'>(select all that apply)</span>\n  </h3>\n  <div class='clearfix register__user-types'>\n    <div class='register__user-type register__user-type-student' aria-checked='"+$e($c(this.user.is_student().toString()))+"' data-user-type='student' tabindex='"+$e($c(0))+"' role='checkbox' aria-label='I am a student'>\n      <i class='boundless-icon-user'></i>\n      <h3>Student</h3>\n      <div class='register-user-type-line'></div>\n      <p>I'm in school and want to save money, get better grades, and learn faster.</p>\n      <div class='register__user-type__check-box-cont'>\n        <div class='register__user-type__check-box'></div>\n      </div>\n    </div>\n    <div class='register__user-type register__user-type-educator' aria-checked='"+$e($c(this.user.is_educator().toString()))+"' data-user-type='educator' tabindex='"+$e($c(0))+"' role='checkbox' aria-label='I am an educator'>\n      <i class='boundless-icon-user'></i>\n      <h3>Educator</h3>\n      <div class='register-user-type-line'></div>\n      <p>I'm teaching a course and want to prep more efficiently and teach more effectively.</p>\n      <div class='register__user-type__check-box-cont'>\n        <div class='register__user-type__check-box'></div>\n      </div>\n    </div>\n    <div class='register__user-type register__user-type-expert' aria-checked='"+$e($c(this.user.is_expert().toString()))+"' data-user-type='expert' tabindex='"+$e($c(0))+"' role='checkbox' aria-label='I am an expert'>\n      <i class='icon-pencil'></i>\n      <h3>Expert</h3>\n      <div class='register-user-type-line'></div>\n      <p>I\u2019m a subject expert and want to contribute to content used by millions.</p>\n      <div class='register__user-type__check-box-cont'>\n        <div class='register__user-type__check-box'></div>\n      </div>\n    </div>\n  </div>\n  <button class='btn btn-block btn-green btn-large' id='submit-types' tabindex='"+$e($c(0))+"' role='button'>\n    Sign up\n  </button>\n  <hr class='register__hr'>\n  <a class='register__login-button' tabindex='"+$e($c(0))+"' role='link'>Already have an account?</a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){}.call(this),function(){Boundless.append_view_path("checkout/views"),Boundless.Checkout||(Boundless.Checkout={}),$(function(){return $(document).on("click",".onboarding__link",function(evt){var book,code,coupon,wizzard_options;return evt.preventDefault(),Boundless.Events.Purchasing.track("clicked",{registered:null!=session.current_user}),book=new Boundless.Book(PageData.book),PageData.code&&(code=new Boundless.Code(PageData.code)),PageData.coupon&&(coupon=new Boundless.Coupon(PageData.coupon)),Boundless.Events.ECommerce.track("added_product",_.extend({quantity:1},book.ecommerce_data())),wizzard_options={starting_without_session:null==session.current_user},window.checkout_steps=new Boundless.Checkout.CheckoutStepsController({book:book,code:code,coupon:coupon}),wizzard_options.sidebar_provider=checkout_steps.summary_view,session.logged_in()?(Boundless.Events.ECommerce.track("viewed_checkout_step",{step:2}),checkout_steps.startup()):(window.register_controller=new Boundless.Register.RegisterController({user_role:"student",skip_role_selector:!0,conversion_event:!1}),Boundless.Events.ECommerce.track("viewed_checkout_step",{step:1}),register_controller.on("register:complete",function(user){return checkout_steps.startup(),checkout_steps.checkout_controller.set_user(user),checkout_steps.checkout_controller.render(),Boundless.Events.ECommerce.track("completed_checkout_step",{step:1},function(){return window.wizzard.goto_step(2),Boundless.Events.ECommerce.track("viewed_checkout_step",{step:2})})})),null!=session.current_user?wizzard_options.step_els=[checkout_steps.$el]:wizzard_options.step_els=[register_controller.$el,checkout_steps.$el],window.wizzard=new Boundless.WizzardController(wizzard_options),window.wizzard.render(),events.on("checkout:purchase_complete",function(params){return Boundless.Events.ECommerce.track("completed_checkout_step",{step:2}),code||(code=params.code),Boundless.Events.ECommerce.track("completed_order",params.purchase.ecommerce_data(book,code),function(){return window.location=Boundless.LEARNING_APP_URL})})})})}.call(this),function(){boundless.define("boundless.checkout.components.CodeForm",["React"],function(React){var findDOMNode;return findDOMNode=React.findDOMNode,React.createClass({displayName:"CodeForm",render:function(){return React.createElement("div",{className:"code-form checkout-app__payment"},React.createElement("div",{className:"checkout-app__form-inputs"},React.createElement("form",{onSubmit:this.handleSubmit},React.createElement("div",{className:"control-group"},React.createElement("label",{className:"control-label",htmlFor:"code"},"Enter your access code below"),React.createElement("div",{className:"controls"},React.createElement("input",{ref:"code",className:"string input-large",id:"code",type:"text",placeholder:"Access code"}))),React.createElement("button",{type:"submit",className:"btn btn-primary btn-large btn-block btn-upcase"},"Get Your Book"))),React.createElement("div",{className:"checkout-app__alt-payment"},React.createElement("a",{onClick:this.handleCancel,onKeyPress:this.handleKeypress,tabIndex:"0",role:"link"},"Pay with card instead")))},handleCancel:function(event){return event.preventDefault(),this.props.handleCancel()},handleSubmit:function(event){var code;return event.preventDefault(),code=findDOMNode(this.refs.code).value,this.props.handleSubmit(code)},handleKeypress:function(event){var ref;return(ref=event.charCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.handleCancel(event):void 0}})})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);
return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Checkout.CheckoutController=function(superClass){function CheckoutController(){return this.stripe_response_handler=bind(this.stripe_response_handler,this),CheckoutController.__super__.constructor.apply(this,arguments)}return extend(CheckoutController,superClass),CheckoutController.prototype.template="checkout",CheckoutController.prototype.events={"submit #payment-form":"attempt_payment","click .checkout-app__stored-card-change-link":"clicked_change_card","keypress .checkout-app__stored-card-change-link":"keypress_change_card","click .checkout-app__stored-card-use-link":"clicked_use_stored_card","keypress .checkout-app__stored-card-use-link":"keypress_use_stored_card","click .checkout-app__get-book-for-free":"attempt_free_purchase","click .checkout-app__access-code-link":"renderCodeForm","keypress .checkout-app__access-code-link":"keypressRenderCodeForm"},CheckoutController.prototype.helper_methods=["actual_price","available_credit","base_price","book","coupon_discount","course","credit_card","display_title","has_stored_card","is_upsell","isDiscounted","item_for_sale","item_already_purchased","modal_subtitle","modal_title","purchase","use_stored_card","user"],CheckoutController.prototype.initialize=function(params){var ref,ref1,ref2;return null==params&&(params={}),CheckoutController.__super__.initialize.apply(this,arguments),this.purchase_params=_.extend(params.purchase_params||{},Boundless.Analytics.initial_values()),this.template=params.template||"checkout",this.modal_title=params.modal_title||"Payment",this.modal_subtitle=params.modal_subtitle||null,this.user=params.user||session.current_user,this.credit_card=new Boundless.CreditCard,this.user_credits=null!=(ref=this.user)?ref.get("credits"):void 0,this.book=params.book,this.display_title=this.book.is_boundless()?"Boundless "+this.book.get("title"):"Boundless Alternative to "+this.book.get("title"),this.course=params.course,this.coupon=params.coupon,this.code=params.code,this.is_upsell=params.is_upsell||!1,this.purchase=this.course||this.book,(null!=(ref1=this.course)?ref1.id:void 0)?(this.purchase_params.purchasable_id=this.course.id,this.purchase_params.purchasable_type="Course",this.purchase_params.school_id=this.course.get("school_id"),this.base_price=Boundless.COURSE_PRICE):(this.purchase_params.purchasable_id=this.book.id,this.purchase_params.purchasable_type="Book",this.purchase_params.subject_tag_id=this.book.get("subject_tag").id,this.base_price=Boundless.BOOK_PRICE),this.available_credit=((null!=(ref2=this.user_credits)?ref2.available_credit():void 0)||0)/100,this.calculate_actual_price(),this.use_stored_card=this.has_stored_card(),this.isFree()&&(this.template="free_checkout"),this.render(),this},CheckoutController.prototype.calculate_actual_price=function(){return this.coupon_discount=null!=this.coupon&&this.coupon.get("price")<this.base_price?this.base_price-this.coupon.get("price"):0,this.actual_price=Math.max(this.base_price-this.coupon_discount-this.available_credit,0)},CheckoutController.prototype.isFree=function(){var ref,ref1;return 0===(null!=(ref=this.coupon)?ref.get("price"):void 0)||0===this.actual_price||(null!=(ref1=this.course)?ref1.get("is_paid_for"):void 0)&&!this.course.get("mock_payment")},CheckoutController.prototype.isDiscounted=function(){return this.actual_price<this.base_price},CheckoutController.prototype.set_user=function(user){var ref,ref1;return this.user=user,this.user_credits=null!=(ref=this.user)?ref.get("credits"):void 0,this.available_credit=((null!=(ref1=this.user_credits)?ref1.available_credit():void 0)||0)/100},CheckoutController.prototype.render=function(){return CheckoutController.__super__.render.apply(this,arguments),this.intervalTimer=setInterval(function(_this){return function(){return _this.$("#creditcard-card_number-input").length?(_this.$("input#creditcard-card_number-input").payment("formatCardNumber"),_this.$("input#creditcard-card_cvc-input").payment("formatCardCVC"),_this.$("input#creditcard-card_exp-input").payment("formatCardExpiry"),clearInterval(_this.intervalTimer)):void 0}}(this),100),this},CheckoutController.prototype.attempt_payment=function(e){return e.preventDefault(),this.credit_card.set(this.$("#payment-form").fields_for("creditcard"),{silent:!0}),this.$("#payment-form").disable_form(),null==this.course&&null==this.book||!this.item_already_purchased()?!this.use_stored_card&&this.credit_card.isValid()?(Stripe.createToken(this.credit_card.stripe_object(),this.stripe_response_handler),this.toggle_processing()):this.use_stored_card&&null!=this.user.get("credit_card_type")&&null!=this.user.get("credit_card_last_four")?(Boundless.Logger.log("attempting stripe payment with stored card"),this.create_purchase()):this.render():(this.render(),this.$(".checkout-app__payment-errors").show().text("You already purchased this book.")),!1},CheckoutController.prototype.item_for_sale=function(){var ref;return null!=(ref=this.purchase)?ref.get("for_sale"):void 0},CheckoutController.prototype.stripe_response_handler=function(status,response){return Boundless.Logger.log("stripe response handler",status,response),response.error?(this.render(),this.$(".checkout-app__payment-errors").show().text(response.error.message)):(this.$(".checkout-app__payment-errors").hide().text(""),Boundless.Logger.log("processing stripe request for token",response.id),this.purchase_params=_.extend(this.purchase_params,{stripe_token:response.id}),this.create_purchase())},CheckoutController.prototype.create_purchase=function(callback){return null==callback&&(callback=null),this.purchase_params.use_stored_card=this.use_stored_card,this.purchase_params.card_last_four=this.user.get("credit_card_last_four"),this.user.createPurchase(this.purchase_params,{success:function(_this){return function(purchase){return Boundless.Events.Purchasing.track("paid",{},function(){return events.trigger("checkout:purchase_complete",{purchase_method:"Stripe",purchase:purchase})})}}(this),error:function(_this){return function(model){return _this.render(),_this.$(".checkout-app__payment-errors").show().text(model.errors.on("purchase"))}}(this)})},CheckoutController.prototype.keypress_change_card=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.clicked_change_card():void 0},CheckoutController.prototype.clicked_change_card=function(){return this.use_stored_card=!1,this.render()},CheckoutController.prototype.keypress_use_stored_card=function(e){var ref;return(ref=e.keyCode)===KeyCode.ENTER||ref===KeyCode.SPACE?this.clicked_use_stored_card():void 0},CheckoutController.prototype.clicked_use_stored_card=function(){return this.use_stored_card=!0,this.render()},CheckoutController.prototype.toggle_processing=function(){return this.$(".checkout-app__processing").toggleClass("processing")},CheckoutController.prototype.has_stored_card=function(){var ref,ref1;return null!=(null!=(ref=this.user)?ref.get("credit_card_type"):void 0)&&null!=(null!=(ref1=this.user)?ref1.get("credit_card_last_four"):void 0)},CheckoutController.prototype.item_already_purchased=function(){var ref;return null!=(ref=this.user)?ref.hasPurchasedItem(this.course||this.book):void 0},CheckoutController.prototype.summary_view=function(template){return null==template&&(template="checkout_summary"),this.partial(template,this)},CheckoutController.prototype.alertCouponError=function(){return $.globalMessenger().post({message:"There was a problem applying this coupon. Please contact us at support@boundless.com",type:"error"})},CheckoutController.prototype.attempt_free_purchase=function(evt){return $(".checkout-app__get-book-for-free").addClass("disabled"),null==this.user||this.item_already_purchased()?this.render():this.user.createPurchase(this.purchase_params,{success:function(purchase){return Boundless.Events.Purchasing.track("got_free_book"),events.trigger("checkout:purchase_complete",{purchase:purchase})},error:this.alertCouponError})},CheckoutController.prototype.checkoutWithCoupon=function(){return this.calculate_actual_price(),null!=this.user&&this.isFree()?this.user.createPurchase(_.merge(this.purchase_params,{coupon_id:this.coupon.id,code:this.code}),{success:function(_this){return function(purchase){return Boundless.Events.Purchasing.track("used_code"),events.trigger("checkout:purchase_complete",{purchase:purchase,code:_this.code})}}(this),error:this.alertCouponError}):(events.trigger("wizzard:update_sidebar",this.summary_view()),this.render())},CheckoutController.prototype.applyCouponCode=function(code){return this.code=code,this.coupon=new Boundless.Coupon({code:code}),this.coupon.fetch({success:this.checkoutWithCoupon.bind(this),error:this.alertCouponError})},CheckoutController.prototype.keypressRenderCodeForm=function(e){return this.handleKeypressTrigger(e.keyCode,function(_this){return function(){return _this.renderCodeForm(e)}}(this))},CheckoutController.prototype.renderCodeForm=function(evt){return evt.preventDefault(),boundless.require(["React","boundless.checkout.components.CodeForm"],function(_this){return function(React,CodeForm){var props;return props={handleCancel:_this.render.bind(_this),handleSubmit:_this.applyCouponCode.bind(_this)},React.render(React.createElement(CodeForm,props),_this.el)}}(this))},CheckoutController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Checkout.CheckoutStepsController=function(superClass){function CheckoutStepsController(){return this.summary_view=bind(this.summary_view,this),CheckoutStepsController.__super__.constructor.apply(this,arguments)}return extend(CheckoutStepsController,superClass),CheckoutStepsController.prototype.template="checkout_layout",CheckoutStepsController.prototype.id="checkout__wrapper",CheckoutStepsController.prototype.initialize=function(params){return null==params&&(params={}),CheckoutStepsController.__super__.initialize.apply(this,arguments),this.checkout_options=params,this.startup(),this},CheckoutStepsController.prototype.startup=function(){return this.render(),this.go_to("checkout")},CheckoutStepsController.prototype.go_to=function(step){switch(step){case"checkout":return this.checkout_controller=new Boundless.Checkout.CheckoutController(_.extend({},this.checkout_options,{el:this.$(".checkout__step-one")})),this.checkout_controller.on("close",function(_this){return function(){return _this.trigger("close")}}(this))}},CheckoutStepsController.prototype.summary_view=function(template){return this.checkout_controller.summary_view(template)},CheckoutStepsController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["checkout/views/book_summary"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='checkout-summary__title-summary'>\n  <div class='"+["checkout-summary__product-image",""+$e($c(this.book.get("subject_tag").get("permalink")))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>\n  <div class='checkout-summary__product-description'>\n    <div class='checkout-summary__product-title'>\n      Assigned book:<br>"+this.book.get("title")+"\n    </div>\n    <div class='checkout-summary__title-authors'>"),this.book.is_alignment()?$o.push("      by "+this.book.get("alignment_authors")):$o.push("      "+this.book.get("attribution")),$o.push("    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["checkout/views/checkout"]=function(context){return function(){var $c,$e,$o,ref;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='checkout-app'>"),session.logged_in()?this.item_for_sale()?this.item_already_purchased()?($o.push("  <div class='checkout-app__error'>\n    <i class='icon-exclamation-sign'></i>"),this.course&&this.user.is_enrolled_in(this.course)?$o.push("    You're already in this class."):$o.push("    You've already purchased this book."),$o.push("  </div>"),this.course?$o.push("  <a class='btn btn-block btn-large btn-primary js__continue-to-course' href='"+$e($c(Boundless.LearningRoutes.learning_course_url(this.course.id)))+"'>\n    Continue to your class assignments\n  </a>"):$o.push("  <a class='btn btn-block btn-large btn-primary js__continue-to-course' href='"+$e($c(Boundless.APP_URL))+"/purchases'>\n    View your purchases\n  </a>")):($o.push("  <div class='"+["checkout-app__payment",""+$e($c(this.use_stored_card?"checkout-app__use-stored-card":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),this.has_stored_card()&&$o.push("    <div class='checkout-app__stored-card clearfix'>\n      <div class='checkout-app__stored-card-header'>Use the card on file</div>\n      <div class='checkout-app__stored-card-info'>\n        <i class='bicon-"+this.user.get("credit_card_type").replace(" ","-").toLowerCase()+"'></i>\n        ending in "+this.user.get("credit_card_last_four")+"\n      </div>\n      <a class='checkout-app__stored-card-change-link' tabindex='"+$e($c(0))+"'>Change card info</a>\n      <a class='checkout-app__stored-card-use-link' tabindex='"+$e($c(0))+"'>Use this card</a>\n    </div>"),$o.push("    "+$c(this.form_for(this.credit_card,{id:"payment-form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("    <div class='checkout-app__form-inputs'>"),$o1.push("      "+$c(form.input("card_number",{input_class:"input-large",as:"string",placeholder:"\u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022 \u2022\u2022\u2022\u2022",label:"Card number:",pattern:"[0-9]*",ariaLabel:"card number",liveValidate:!1}))),Modernizr.ismobile?($o1.push("      "+$c(form.input("card_exp",{input_class:"input-large",as:"string",placeholder:"MM / YY",label:"Expires:",pattern:"[0-9]*",ariaLabel:"card expiration date",liveValidate:!1}))),$o1.push("      "+$c(form.input("card_cvc",{input_class:"card_cvc input-large",as:"string",placeholder:"CVC",label:"Card code:",pattern:"[0-9]*",ariaLabel:"card code cvc",liveValidate:!1}))),$o1.push("      "+$c(form.input("name_on_card",{input_class:"input-large",as:"string",label:"Name on card:",ariaLabel:"name on card",liveValidate:!1})))):($o1.push("      "+$c(form.input("card_exp",{input_class:"input-large",as:"string",placeholder:"MM / YY",label:"Expires:",pattern:"[0-9]*",ariaLabel:"card expiration date",liveValidate:!1}))),$o1.push("      "+$c(form.input("name_on_card",{input_class:"input-large",as:"string",label:"Name on card:",pattern:"[0-9]*",ariaLabel:"name on card",liveValidate:!1}))),$o1.push("      "+$c(form.input("card_cvc",{input_class:"card_cvc input-large",as:"string",placeholder:"CVC",label:"Card code:",ariaLabel:"card code cvc",liveValidate:!1})))),$o1.push("    </div>\n    <div class='checkout-app__payment-errors'></div>"),$o1.push("    "+$c(form.action("submit",{as:"button",action_class:"btn btn-large btn-block btn-upcase submit pay-button checkout__pay-button",label:"Pay & Get Your Book Now"}))),$o1.join("\n")}}(this)))),$o.push("    <div class='checkout-app__alt-payment'>"),(null!=(ref=this.course)?ref.get("mock_payment"):void 0)?$o.push("      <a class='btn btn-small checkout-app__get-book-for-free'>Complete Demo Payment</a>"):this.isDiscounted()?$o.push("      <div class='coupon'>Coupon applied. You're saving $"+this.coupon_discount+".</div>"):$o.push("      <a class='checkout-app__access-code-link' role='link' tabindex='"+$e($c(0))+"'>Have an access code?</a>"),$o.push("    </div>\n    <div class='checkout-app__processing'>\n      <i class='icon-spin icon-spinner'></i>\n      <strong>Processing your payment\u2026</strong>\n      <p>This may take a moment.</p>\n    </div>\n  </div>\n  <div class='checkout-app__security-info'>\n    <i class='icon-lock'></i>\n    <span class='ssl-yay'>\n      <strong>Secure Checkout</strong>\n      \u2014 SSL 256-bit encryption\n    </span>\n  </div>")):$o.push("  <div class='checkout-app__error'>\n    <i class='icon-exclamation-sign'></i>\n    Your professor archived this course and it cannot be purchased. Contact your professor for more details.\n  </div>"):$o.push("  <div class='checkout-app__error'>\n    <i class='icon-exclamation-sign'></i>\n    You need to be logged in to purchase a book.\n  </div>"),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["checkout/views/checkout_layout"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='checkout__cont steps__cont' data-step-count='"+$e($c(1))+"' data-current-step='"+$e($c(1))+"'>\n  <div class='steps__indicator-cont'>\n    <div class='checkout__steps-indicator-cont'>\n      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Checkout</div>\n      </div>\n    </div>\n  </div>\n  <div class='steps__inner-cont'>\n    <div class='checkout__step-one steps__step'></div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["checkout/views/checkout_summary"]=function(context){return function(){var $c,$o,ref;return $c=window.HAML.cleanValue,$o=[],$o.push(""+$c(this.partial("book_summary",this))),this.course&&this.course.is_lms()&&$o.push("<hr>\n<ul class='list-icons'>\n  <li>\n    <i class='icon-ok'></i>\n    Access now on "+this.course.lms_name()+"\n  </li>\n  <li>\n    <i class='icon-ok'></i>\n    Yours forever on Boundless.com (even after your "+this.course.lms_name()+" class ends)\n  </li>\n  <li>\n    <i class='icon-ok'></i>\n    30 day money-back guarantee\n  </li>\n</ul>"),(this.coupon_discount||this.available_credit)&&($o.push("<hr>\n<div class='checkout-summary__discounts'>\n  <div class='checkout-summary__base-price'>\n    <span>Subtotal</span>\n    <span class='pull-right'>$"+this.base_price.toFixed(2)+"</span>\n  </div>"),this.coupon_discount&&$o.push("  <div class='checkout-summary__coupon-discount'>\n    <span>Coupon applied</span>\n    <span class='checkout-summary__coupon-value'>- $"+this.coupon_discount.toFixed(2)+"</span>\n  </div>"),this.available_credit&&$o.push("  <div class='checkout-summary__user-credits'>\n    <span>Credit</span>\n    <span class='checkout-summary__credit-value'>- $"+this.available_credit.toFixed(2)+"</span>\n  </div>"),$o.push("</div>")),$o.push("<div class='checkout-summary__total'>\n  <strong>Total:</strong>\n  <strong class='pull-right'>$"+this.actual_price.toFixed(2)+"</strong>\n</div>"),(null!=(ref=this.course)?ref.is_lms():void 0)||$o.push("<div class='checkout-summary__guarantee'>\n  <div class='checkout-summary__guarantee-text'>30 day money-back guarantee</div>\n  <div class='checkout-summary__purchase-explanation'>One time fee, no extra charges or subscriptions. The book is yours as long as you need it!</div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["checkout/views/free_checkout"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='checkout-app'>\n  <div class='center checkout-app__free'>"),this.item_already_purchased()?($o.push("    <div class='checkout-app__error'>\n      <i class='icon-exclamation-sign'></i>"),this.user.is_enrolled_in(this.course)?$o.push("      You're already in this class."):$o.push("      You've already purchased this book."),$o.push("    </div>")):$o.push("    <p>Nothing like going Boundless for free. Click the button below to get started.</p>\n    <hr>\n    <a class='btn btn-block btn-green btn-large checkout-app__get-book-for-free'>\n      Let's go!\n      <i class='icon-double-angle-right'></i>\n    </a>"),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["checkout/views/modal_checkout"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__inner-header'>\n  <h2>"+$c(this.modal_title)+"</h2>"),this.modal_subtitle&&$o.push("  <h3>"+$c(this.modal_subtitle)+"</h3>"),$o.push("</div>\n<div class='modal__inner-body'>"),$o.push("  "+$c(this.partial("checkout",this))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){}.call(this),function(){Boundless.append_view_path("coupon/views"),$(function(){var coupon;return null!=("undefined"!=typeof PageData&&null!==PageData?PageData.coupon:void 0)?(coupon=(new Boundless.CouponController).render(),$("#header").append(coupon.el)):void 0})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CouponController=function(superClass){function CouponController(){return CouponController.__super__.constructor.apply(this,arguments)}return extend(CouponController,superClass),CouponController.prototype.template="coupon",CouponController.prototype.id="coupon",CouponController.prototype.events={"click .coupon__dismiss":"remove"},CouponController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["coupon/views/coupon"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='coupon-body'>\n  <i class='coupon__dismiss icon-remove'></i>\n  <a class='coupon-inner' href='/textbooks' data-push='true'>\n    <div class='coupon__applied'>Coupon applied:</div>\n    <div class='coupon__find-your-textbook'>\n      Find your textbook for\n      <span class='coupon__price'>$"+PageData.coupon.price.toFixed(2)+"</span>\n    </div>\n  </a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Editor||(Boundless.Editor={}),Boundless.Editor.NewEquationController=function(superClass){function NewEquationController(){return NewEquationController.__super__.constructor.apply(this,arguments)}return extend(NewEquationController,superClass),NewEquationController.prototype.template="equations/new",NewEquationController.prototype.className="figure on",NewEquationController.prototype.events={"click .edit-atom-asset__fauxverlay":"remove","submit form":"submit_form"},NewEquationController.prototype.attributes={contenteditable:!1},NewEquationController.prototype.initialize=function(options){return events.trigger("editor:prevent_saving"),this.options=options||{},events.trigger("editor:disable_keyboard_intercept"),this.render()},NewEquationController.prototype.render=function(){return NewEquationController.__super__.render.apply(this,arguments),this.options.reference_node.parentNode.insertBefore(this.el,this.options.reference_node)},NewEquationController.prototype.submit_form=function(e){var eq,eqn_id,p;return e.preventDefault(),p=document.createElement("p"),eq=document.createElement("equation"),eq.setAttribute("contenteditable","false"),eq.innerText="$"+this.$(".edit-atom-asset__form-input").val()+"$",p.appendChild(eq),eqn_id=editor.utils.new_short_id(),this.el.parentNode.replaceChild(p,this.el),$(eq).wrapInner("<span id='"+eqn_id+"' class='neo_tag_exclude equation_inner_wrapper' data-length="+eq.outerHTML.length+">"),MathJax.Hub.Queue(editor.settings.helper_methods.mathjax_prerender,["Typeset",MathJax.Hub,eqn_id],editor.settings.helper_methods.mathjax_postrender),events.trigger("editor:enable_keyboard_intercept"),events.trigger("editor:prevent_saving",!1)},NewEquationController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.append_view_path("editor/views"),Boundless.Editor||(Boundless.Editor={}),Boundless.Editor.App=function(superClass){function App(opts){this.in_editors=bind(this.in_editors,this),this.set_selection=bind(this.set_selection,this),this.get_cursor_position=bind(this.get_cursor_position,this),this.check_text_highlighting=bind(this.check_text_highlighting,this),this.check_current_element=bind(this.check_current_element,this),this.bind_el_events=bind(this.bind_el_events,this),this.d=document,window.$window||(window.$window=$(window)),this.settings={content:null,media:null,debug:!0,element:null,modifier:"auto",auto_focus:!1,mode:"full",max_length:-1,modifiers:{66:"bold",73:"italicize",86:"paste"},tags:{paragraph:"p",figure:"figure",figref:"figref",equation:"equation",outer_level:["blockquote","h2","h3","ul","ol","li","figure","iframe"],inner_level:["i","sup","sub"]},css_classes:{editor:"editor",paste_hook:"editor-paste-hook"},helper_methods:{mathjax_prerender:function(_this){return function(){return _this.settings.spanwatch=!1}}(this),mathjax_postrender:function(_this){return function(){return _this.settings.spanwatch=!0}}(this)},spanwatch:!1},this.cache={enabled:!1,cmd:!1,focused_element:null},this.utils=new Boundless.Editor.HTMLUtils(this.settings),this.utils.deep_extend(this.settings,opts),this.bind_document_events(),this.cache.enabled=!0,null!=(null!=opts?opts.save_manager:void 0)&&(this.save_manager=new Boundless.AtomSaveManager(_.extend(opts.save_manager,{utils:this.utils}))),this.dom_parser=new DOMParser}return extend(App,superClass),App.prototype.initialize=function(element,mode){return this.settings.element=this.el=element,this.$el=this.settings.$el=$(this.el),this.settings.mode=mode,this.settings.element_classList=this.settings.element.classList,this.settings.element.contentEditable=!0,this.settings.element.classList.add(this.settings.css_classes.editor),this.settings.element.classList.add(this.settings.css_classes.editor+"-"+this.settings.mode),this.hi_manager=new Boundless.Editor.HumanInputManager(this.settings,this.utils),this.text_formatter=new Boundless.Editor.TextFormatter({settings:this.settings,utils:this.utils}),this.embed_tool=new Boundless.Editor.EmbedTool(this.settings,this.utils),this.utils.clean_html(),this.utils.preserve_element_focus(),this.bind_el_events(),this.init_app_events(),setTimeout(function(_this){return function(){return _this.hi_manager.update_position()}}(this),100)},App.prototype.bind_document_events=function(){return _.each(this.d.querySelectorAll("[editable=true]"),function(_this){return function(editor){return editor.onmouseup=function(e){return _this.check_text_highlighting(e)},editor.onmousedown=function(e){return _this.check_current_element(e)}}}(this))},App.prototype.unbind_document_events=function(){return _.each(this.d.querySelectorAll("[editable=true]"),function(_this){return function(editor){return editor.onmouseup=null,editor.onmousedown=null}}(this))},App.prototype.bind_el_events=function(){var on_editor_click,on_editor_focus,on_editor_keyup,on_editor_new_dom_node;return on_editor_keyup=function(_this){return function(e){return events.trigger("editor:changed",e),_this.check_text_highlighting(),_this.set_selection(),setTimeout(function(){return events.trigger("editor:save_selection")},100)}}(this),this.$el.off("editor:keyup",on_editor_keyup).on("editor:keyup",on_editor_keyup),on_editor_click=function(_this){return function(e){return _this.set_selection(),_this.hi_manager.update_position(e)}}(this),this.$el.off("click",on_editor_click).on("click",on_editor_click),on_editor_focus=function(_this){return function(e){return setTimeout(function(){return _this.set_selection()},100)}}(this),this.$el.off("focus",on_editor_focus).on("focus",on_editor_focus),on_editor_new_dom_node=function(_this){return function(e){var $target,helper,p,ref;return _this.settings.spanwatch&&("SPAN"!==e.target.tagName&&"FONT"!==e.target.tagName||""!==e.target.className||(helper=$("<b>helper</b>"),$target=$(e.target),$target.before(helper),helper.after($target.contents()),helper.remove(),$target.remove())),(null!=(ref=e.target.parentNode)?ref.hasAttribute("DIV"===e.target.tagName&&""===e.target.className):void 0)?(p=_this.utils.change_tag(e.target,"p",!0),p.innerHTML="<br>",p.classList.add("focused"),window.getSelection().modify("move","backward","character")):void 0}}(this),this.$el.off("DOMNodeInserted",on_editor_new_dom_node).on("DOMNodeInserted",on_editor_new_dom_node)},App.prototype.init_app_events=function(){var cleanup_before_save,on_disable_keyboard_intercept,on_disable_spanwatch,on_enable_keyboard_intercept,on_enable_spanwatch,on_selection_restore,on_selection_save;return on_disable_keyboard_intercept=function(_this){return function(){return _this.keyboard_intercept_disabled=!0}}(this),events.off("editor:disable_keyboard_intercept",on_disable_keyboard_intercept).on("editor:disable_keyboard_intercept",on_disable_keyboard_intercept),on_enable_keyboard_intercept=function(_this){return function(){return _this.keyboard_intercept_disabled=!1}}(this),events.off("editor:enable_keyboard_intercept",on_enable_keyboard_intercept).on("editor:enable_keyboard_intercept",on_enable_keyboard_intercept),on_disable_spanwatch=function(_this){return function(){return _this.settings.spanwatch=!1}}(this),events.off("editor:disable_spanwatch",on_disable_spanwatch).on("editor:disable_spanwatch",on_disable_spanwatch),on_enable_spanwatch=function(_this){return function(){return _this.settings.spanwatch=!0}}(this),events.off("editor:enable_spanwatch",on_enable_spanwatch).on("editor:enable_spanwatch",on_enable_spanwatch),on_selection_save=function(_this){return function(){return _this.rangy_selection&&rangy.removeMarkers(_this.rangy_selection),_this.rangy_selection=rangy.saveSelection()}}(this),events.off("editor:save_selection",on_selection_save).on("editor:save_selection",on_selection_save),on_selection_restore=function(_this){return function(){return _this.rangy_selection&&rangy.restoreSelection(_this.rangy_selection),_this.rangy_selection?rangy.removeMarkers(_this.rangy_selection):void 0}}(this),events.off("editor:restore_selection",on_selection_restore).on("editor:restore_selection",on_selection_restore),cleanup_before_save=function(_this){return function(){return $(".rangySelectionBoundary").remove()}}(this),events.off("editor:saving",cleanup_before_save).on("editor:saving",cleanup_before_save)},App.prototype.setdown=function(){var ref,ref1,ref2;return this.text_formatter&&events.trigger("editor:selection_collapsed"),null!=(ref=this.text_formatter)&&ref.remove(),null!=(ref1=this.hi_manager)&&ref1.unbind_element_events(),null!=(ref2=this.embed_tool)&&ref2.remove(),this.settings.element&&(this.settings.element.classList.remove(this.settings.css_classes.editor),this.settings.element.classList.remove(this.settings.css_classes.editor+"-"+this.settings.mode),this.settings.element.contentEditable=!0,this.settings.element=null,this.settings.$el=null),this.cache.enabled=!1},App.prototype.toggle_editing=function(){return this.cache.enabled?this.setdown():this.initialize(this.settings)},App.prototype.disable=function(){return this.unbind_document_events(),this.setdown()},App.prototype.check_current_element=function(e){var element;if(e&&(element=this.utils.get_first_parent_with_attr(e.target,"editable"),!this.in_editors(e.target))){
if(!element)return this.setdown();if(element!==this.settings.element)return this.settings.element&&this.setdown(),this.initialize(element,element.getAttribute("editor-mode"))}},App.prototype.check_text_highlighting=function(e){var current_node_list,selection;if(this.settings.element){if(selection=window.getSelection(),selection.isCollapsed===!0)return this.text_formatter.on_selection_blur();if(selection.isCollapsed===!1)return current_node_list=this.utils.find_nodes(selection.focusNode),this.text_formatter.open_and_update_options(current_node_list,e)}},App.prototype.get_cursor_position=function(){var coords,last_child,range,selection,temp_coord_holder;return temp_coord_holder=$('<span class="coord_holder"></span>'),selection=rangy.getSelection(),last_child=$(selection.anchorNode.parentElement).children().last(),"BR"===last_child.prop("tagName")&&last_child.replaceWith("&nbsp;"),selection.expand("character"),range=selection.getRangeAt(0),range.canSurroundContents()?(range.surroundContents(temp_coord_holder[0]),coords=temp_coord_holder.offset(),range.pasteHtml(temp_coord_holder.text()),selection.collapseToStart()):(Boundless.Logger.log("Warn: Cannot get cursor position via range.surroundContents()."),selection.collapseToStart(),range.insertNode(temp_coord_holder[0]),coords=temp_coord_holder.offset(),temp_coord_holder.remove()),selection.anchorNode.parentElement.normalize(),coords},App.prototype.set_selection=function(){var ref;return window.getSelection().rangeCount>0?this.selection=null!=(ref=window.getSelection())?ref.getRangeAt(0):void 0:void 0},App.prototype.in_editors=function(el){var ref;return null!=(ref=this.text_formatter)?ref.el.contains(el):void 0},App}(Backbone.View),Boundless.Editor.setup_container=function(){var $chin,$container,check_resize;return Modernizr.editorsupported?($container=$(".content-editor-container"),$chin=$(".content-edit__chin"),$container.css("padding-bottom",$chin.outerHeight()),$chin.outerWidth($container.innerWidth()),$(window).resize(function(){return $chin.outerWidth($container.innerWidth())}),this.last_height=null,check_resize=function(_this){return function(){var h;return h=$container.height(),h!==_this.last_height?(_this.last_height=h,$.waypoints("refresh"),$chin.parent().hide().show(0)):void 0}}(this),setInterval(check_resize,1e3),$container.waypoint(function(direction){return $chin.toggleClass("relaxing","down"===direction)},{offset:"bottom-in-view"}),$.scrollTo(".content-editor-container",250,{offset:-50})):void 0},Boundless.Editor.enable_edits=function(){return $(".bcp-content").hasClass("equations-rendered")?void 0:($(".bcp-content").addClass("equations-rendered"),Boundless.Editor.EquationUtils.typeset_eqns(document,function(){return $(".submitr__editor-curtain").hide(),$(".submitr__editor-curtain__header").html(""),$(".submitr__editor-curtain__body").html("")}))},Boundless.Editor.refresh_container=function(){var $chin,$container;return $container=$(".content-editor-container"),$chin=$(".content-edit__chin"),$container.css("padding-bottom",$chin.outerHeight()),$chin.outerWidth($container.innerWidth()),$.waypoints("refresh"),$chin.parent().hide().show(0)},Boundless.Editor.render_unsupported_modal=function(){var contents,momo;return contents=$('<div class="editor-modal-unsupported"><p><strong>We\'re terribly sorry but your browser is unsupported at this time.</strong></p><p>Try it out on your desktop in <a href="https://www.google.com/intl/en/chrome/browser/">Google Chrome</a>.</p><a href="#" class="btn btn-primary btn-block">:( Okay\u2026</a></div>'),momo=new Boundless.Modal(contents,600),momo.controller.$(".btn").click(function(event){return event.preventDefault(),momo.hide()}),momo.on_hide(function(){return"undefined"!=typeof window.history?window.history.back():window.location=window.location.href.replace("/edit/","/")}),momo.show()}}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Boundless.Editor.KeyboardHandler=function(){function KeyboardHandler(settings,utils){this.intercept_enter_keydown=bind(this.intercept_enter_keydown,this),this.command_italicize=bind(this.command_italicize,this),this.command_bold=bind(this.command_bold,this),this.intercept_up=bind(this.intercept_up,this),this.intercept_down=bind(this.intercept_down,this),this.settings=settings,this.utils=utils,this.cached_cmd=!1,this.cached_shift=!1}return KeyboardHandler.prototype.is_command=function(e,fnTrue,fnFalse){return"ctrl"===this.settings.modifier&&e.ctrlKey||"cmd"===this.settings.modifier&&e.metaKey||"auto"===this.settings.modifier&&(e.ctrlKey||e.metaKey)?fnTrue.call():fnFalse.call()},KeyboardHandler.prototype.is_shift=function(e,fnTrue,fnFalse){return e.shiftKey?fnTrue.call():fnFalse.call()},KeyboardHandler.prototype.is_modifier=function(e,fn){var cmd,w;return w=e.which,cmd=this.settings.modifiers[w],cmd?fn.call(null,cmd):void 0},KeyboardHandler.prototype.is_not_special=function(e){var ref,special;return special={16:"shift",17:"ctrl",18:"alt",91:"cmd",8:"delete"},this.cached_cmd,ref=e.which,!(indexOf.call(special,ref)>=0)},KeyboardHandler.prototype.intercept_down=function(e,callback){var len;return null==callback&&(callback=null),this.is_command(e,function(_this){return function(){return _this.cached_cmd=!0}}(this),function(_this){return function(){return _this.cached_cmd=!1}}(this)),this.is_shift(e,function(_this){return function(){return _this.cached_shift=!0}}(this),function(_this){return function(){return _this.cached_shift=!1}}(this)),this.is_modifier(e,function(_this){return function(cmd){if("paste"!==cmd&&_this.cached_cmd){if("title"===_this.settings.mode||"paragraph"===_this.settings.mode)return;return _this["command_"+cmd].call(null,e)}}}(this)),-1!==this.settings.max_length&&(len=this.html_text().length,len>=this.settings.max_length&&this.is_not_special(e))?e.preventDefault():(13===e.which&&this.intercept_enter_keydown(e),27===e.which&&events.trigger("editor:selection_collapsed"),8===e.which&&(this.protect_equations(),$(".bcp__quiz").length||this.intercept_backspace_keydown(e)),this.settings.$el.trigger("editor:keydown",e),"function"==typeof callback?callback():void 0)},KeyboardHandler.prototype.intercept_up=function(e,callback){var focused_el;return null==callback&&(callback=null),this.is_command(e,function(_this){return function(){return _this.cached_cmd=!1}}(this),function(_this){return function(){return _this.cached_cmd=!0}}(this)),this.utils.clean_html(),this.utils.preserve_element_focus(),"list"===this.settings.mode&&(this.list_handler(e),8===e.which&&(focused_el=window.getSelection().getRangeAt(0).startContainer)),8===e.which&&this.restore_equations(),this.settings.$el.trigger("editor:keyup",e),"function"==typeof callback?callback():void 0},KeyboardHandler.prototype.command_bold=function(e){return e.preventDefault(),document.execCommand("bold",!1)},KeyboardHandler.prototype.command_italicize=function(e){return e.preventDefault(),document.execCommand("italic",!1)},KeyboardHandler.prototype.intercept_enter_keydown=function(e){var node;return"title"===this.settings.mode||"paragraph"===this.settings.mode?e.preventDefault():"list"===this.settings.mode?(node=window.getSelection().getRangeAt(0).startContainer,"#text"===node.nodeName&&(node=node.parentNode),!0):void 0},KeyboardHandler.prototype.protect_equations=function(){var editable,i,len1,ref,results;for(this.cloned_equations_array={},ref=this.settings.element.querySelectorAll("equation"),results=[],i=0,len1=ref.length;len1>i;i++)editable=ref[i],results.push(this.cloned_equations_array[editable.querySelector("script").id]=editable.cloneNode(!0));return results},KeyboardHandler.prototype.restore_equations=function(){var editable,i,len1,ref,results;for(ref=this.settings.element.querySelectorAll("equation"),results=[],i=0,len1=ref.length;len1>i;i++)editable=ref[i],results.push(editable.parentNode.replaceChild(this.cloned_equations_array[editable.querySelector("script").id],editable));return results},KeyboardHandler.prototype.intercept_backspace_keydown=function(e){var init_range_node,initial_range,new_range,new_range_node,original_selection,selection;return selection=original_selection=window.getSelection(),initial_range=selection.getRangeAt(0),selection.modify("extend","backward","character"),new_range=selection.getRangeAt(0),selection=original_selection,init_range_node="#text"===initial_range.startContainer.nodeName?initial_range.startContainer.parentNode:initial_range.startContainer,new_range_node="#text"===new_range.startContainer.nodeName?new_range.startContainer.parentNode:new_range.startContainer,Boundless.Logger.log("Backspaced from "+init_range_node.className+" into "+new_range_node.className),""===new_range_node.innerText.trim()&&1===new_range_node.parentNode.children.length&&e.originalEvent.preventDefault(),""!==init_range_node.textContent.trim()&&init_range_node.textContent.trim()===selection.toString().trim()&&1!==init_range_node.parentNode.children.length?init_range_node.remove():void 0},KeyboardHandler.prototype.list_handler=function(e){return null===editor.selection.startContainer.parentNode.dataset.id?events.trigger("editor:prevent_saving"):void 0},KeyboardHandler}()}.call(this),function(){Boundless.Editor.MouseHandler=function(){function MouseHandler(settings,utils){this.settings=settings,this.utils=utils}return MouseHandler.prototype.equation_click=function(e){return events.trigger("editor:disable_spanwatch"),e.currentTarget.classList.add("equation-with-focus"),new Boundless.Editor.EditEquation({src:e.currentTarget.querySelector("script").innerText,equation_id:e.currentTarget.children[0].id})},MouseHandler}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AtomSaveManager=function(superClass){function AtomSaveManager(){return AtomSaveManager.__super__.constructor.apply(this,arguments)}return extend(AtomSaveManager,superClass),AtomSaveManager.prototype.initialize=function(options){return this.document=$(document),this.save_endpoint=options.save_endpoint,this.template_features=options.template_features,options.utils&&(this.utils=options.utils),this.validate(PageData.validations),PageData.proposed_change&&(this.proposed_change=new Boundless.ProposedChange(PageData.proposed_change)),this.save_timeout=!1,this.prevent_saving=!1,events.on("editor:prevent_saving",function(_this){return function(state){return null==state&&(state=!0),Boundless.Logger.log("Prevent saving is "+state),_this.prevent_saving=state,events.trigger("editor:changed")}}(this)),session.current_user&&events.on("editor:changed",function(_this){return function(){return _this.prevent_saving?void 0:(_this.save_timeout&&clearTimeout(_this.save_timeout),_this.save_timeout=setTimeout(function(){return _this.save()},5e3))}}(this)),AtomSaveManager.__super__.initialize.apply(this,arguments)},AtomSaveManager.prototype.get_json=function(){var json;return json={atom:{media_attributes:this.get_media_attributes(document.querySelectorAll("figure[data-id]"))}},_.contains(this.template_features,"brief")&&(json.atom.brief=this.get_title(document.querySelector(".bcp-concept--brief"))),_.contains(this.template_features,"key_points")&&(json.atom.key_points=this.get_list_items(document.querySelectorAll(".bcp-concept--key-points-list li"))),_.contains(this.template_features,"learning_objectives")&&(json.atom.learning_objectives_attributes=this.get_learning_objectives(document.querySelectorAll(".bcp-concept--learning-objectives-list li"))),_.contains(this.template_features,"atom_key_terms")&&(json.atom.atom_key_terms_attributes=this.get_key_terms(document.querySelectorAll(".bcp-concept--key-terms-list li"))),_.contains(this.template_features,"examples")&&(json.atom.examples=this.get_list_items(document.querySelectorAll(".bcp-concept--examples-list li"))),_.contains(this.template_features,"text")&&(json.atom.text=this.get_text(document.querySelector(".bcp-concept--fulltext"))),_.contains(this.template_features,"attributions")&&(json.atom.attributions_attributes=this.get_attributions(document.querySelectorAll(".bcp-concept--atom-attribution"))),json},AtomSaveManager.prototype.save=function(options){return this.prevent_saving?void 0:(events.trigger("editor:saving"),$.ajax({url:this.save_endpoint,type:"PUT",dataType:"json",contentType:"application/json",data:JSON.stringify(this.get_json())}).done(function(_this){return function(data){return _this.validate(data),events.trigger("editor:saved"),null!=options&&"function"==typeof options.success?options.success(data):void 0}}(this)).fail(function(_this){return function(data){return null!=options&&"function"==typeof options.error&&options.error(),events.trigger("editor:save_error")}}(this)))},AtomSaveManager.prototype.mappings={element_validation_classes:{atom_key_terms_elements:".bcp-concept--key-terms-list li",key_points_elements:".bcp-concept--key-points-list li",examples_elements:".bcp-concept--examples-list li",attributions_elements:".bcp-concept--atom-attributions-list li",media_elements:"figure[data-id]"},validation_classes:{atom_key_terms:".bcp-concept--key-terms",key_points:".bcp-concept--key-points",examples:".bcp-concept--examples",text:".bcp-concept--fulltext-container",brief:".bcp-concept--brief-container",attributions:".bcp-concept--atom-attributions"}},AtomSaveManager.prototype.handle_validations=function(validations,type){var el,i,id,j,key,len,ref,ref1,ref2,ref3,results,selector;ref=this.mappings.element_validation_classes;for(key in ref)for(selector=ref[key],ref1=document.querySelectorAll(selector),i=j=0,len=ref1.length;len>j;i=++j)el=ref1[i],id=el.dataset.id||""+i,null!=(null!=(ref2=validations[key])?ref2[id]:void 0)?(el.classList.add("validation--"+type,"validation--inline"),el.dataset[type]=validations[key][id].join(". ")):(el.classList.remove("validation--"+type),delete el.dataset[type]);ref3=this.mappings.validation_classes,results=[];for(key in ref3)selector=ref3[key],(el=document.querySelector(selector))?null!=validations[key]?(el.classList.add("validation--"+type,"validation--block"),results.push(el.dataset[type]=validations[key].join(". "))):(el.classList.remove("validation--"+type),results.push(delete el.dataset[type])):results.push(void 0);return results},AtomSaveManager.prototype.validate=function(validations){return this.handle_validations(validations.warnings,"warning"),this.handle_validations(validations.errors,"error")},AtomSaveManager.prototype.get_text=function(fulltext){var a,br,classy_thing,em,equation,figref,figure,i,j,k,l,len,len1,len2,len3,len4,len5,len6,len7,len8,m,n,newquation,o,p,parsed_doc,parser,q,r,ref,ref1,ref2,ref3,ref4,ref5,ref6,ref7,ref8,s,span,styley_thing,text;for(parser=new DOMParser,parsed_doc=parser.parseFromString(fulltext.innerHTML.replace(/\n/g," "),"text/html"),this.utils.clean_html(parsed_doc.body.children),text="",ref=parsed_doc.body.querySelectorAll("figure"),j=0,len=ref.length;len>j;j++)figure=ref[j],null!=figure.dataset.id?(figref=document.createElement("figref"),figref.id=figure.dataset.id,figure.parentNode.replaceChild(figref,figure)):figure.parentNode.removeChild(figure);for(ref1=parsed_doc.body.querySelectorAll("equation"),k=0,len1=ref1.length;len1>k;k++)equation=ref1[k],equation.parentNode.querySelector("script")&&(newquation=document.createElement("equation"),newquation.setAttribute("contenteditable","false"),newquation.innerText="$"+equation.parentNode.querySelector("script").innerText+"$",equation.parentNode.replaceChild(newquation,equation));for(ref2=parsed_doc.body.querySelectorAll("i"),l=0,len2=ref2.length;len2>l;l++)i=ref2[l],em=document.createElement("em"),em.innerText=i.innerText,i.parentNode.replaceChild(em,i);for(ref3=parsed_doc.body.querySelectorAll("a"),m=0,len3=ref3.length;len3>m;m++)a=ref3[m],span=document.createElement("span"),span.innerText=a.innerText,a.parentNode.replaceChild(span,a);for(ref4=parsed_doc.body.querySelectorAll("[class]"),n=0,len4=ref4.length;len4>n;n++)classy_thing=ref4[n],classy_thing.removeAttribute("class");for(ref5=parsed_doc.body.querySelectorAll("[style]"),o=0,len5=ref5.length;len5>o;o++)styley_thing=ref5[o],styley_thing.removeAttribute("style");for(ref6=parsed_doc.body.querySelectorAll("br"),q=0,len6=ref6.length;len6>q;q++)br=ref6[q],br.parentNode.removeChild(br);for(ref7=parsed_doc.body.querySelectorAll("span"),r=0,len7=ref7.length;len7>r;r++)span=ref7[r],span.parentNode.insertBefore(document.createTextNode(span.innerText),span),span.parentNode.removeChild(span);for(ref8=parsed_doc.body.querySelectorAll("p"),s=0,len8=ref8.length;len8>s;s++)p=ref8[s],0===p.innerHTML.length&&p.parentNode.removeChild(p);return parsed_doc.body.innerHTML},AtomSaveManager.prototype.get_title=function(title_el){return this._parse_el_for_inline_text(title_el).replace(/(\r\n|\n|\r)/gm," ").replace(/\s{2,}/g," ")},AtomSaveManager.prototype.get_list_items=function(list_items){return this.list_items_array=[],_.each(list_items,function(_this){return function(li){return li.innerText.length>1?_this.list_items_array.push(_this._parse_el_for_inline_text(li)):void 0}}(this)),this.list_items_array},AtomSaveManager.prototype.get_media_attributes=function(figures){return _.map(figures,function(_this){return function(el){return ko.dataFor(el).model().atom_save_json()}}(this))},AtomSaveManager.prototype.get_key_terms=function(key_terms){return this.key_terms_array=[],_.each(key_terms,function(_this){return function(key_term){var data,key_term_object;return data=key_term.dataset,null!=data.id?(key_term_object={id:data.id,key_term_id:data.keyTermId,part_of_speech:data.partOfSpeech,definition:_this._parse_el_for_inline_text(key_term.querySelector(".definition"))},_this.key_terms_array.push(key_term_object)):void 0}}(this)),this.key_terms_array},AtomSaveManager.prototype.get_learning_objectives=function(learning_objectives){return this.learning_objectives_array=[],_.each(learning_objectives,function(_this){return function(lo){var data,lo_object;return data=lo.dataset,lo_object={text:lo.innerHTML.trim()},null!=data.id&&(lo_object.id=data.id),_this.learning_objectives_array.push(lo_object)}}(this)),this.learning_objectives_array},AtomSaveManager.prototype.get_attributions=function(attributions){return this.attributions_array=[],_.each(attributions,function(_this){return function(attribution){var attribution_object,data;return data=attribution.dataset,attribution_object={id:data.id,name:attribution.querySelector(".bcp-atom-attribution__name").innerText.trim(),title:attribution.querySelector(".bcp-atom-attribution__title").innerText.trim(),url:attribution.querySelector(".bcp-atom-attribution__url a").innerText.trim(),license_id:attribution.querySelector(".bcp-atom-attribution__license").dataset.id},_this.attributions_array.push(attribution_object)}}(this)),this.attributions_array},AtomSaveManager.prototype._parse_el_for_inline_text=function(el){var text;return text="",el.childNodes.length>1?_.each(el.childNodes,function(_this){return function(node,index){return text+="EQUATION"===node.nodeName&&node.querySelector("script")?' <equation contenteditable="false">$'+node.querySelector("script").innerText+"$</equation> ":"I"===node.nodeName?"<em>"+node.innerHTML+"</em>":3===node.nodeType?node.nodeValue.replace("<","&lt;"):node.outerHTML.trim()}}(this)):text=el.innerHTML.trim(),text},AtomSaveManager}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ChangeNoteManager=function(superClass){function ChangeNoteManager(){return ChangeNoteManager.__super__.constructor.apply(this,arguments)}return extend(ChangeNoteManager,superClass),ChangeNoteManager.prototype.template="change_note",ChangeNoteManager.prototype.events={"submit form":"form_submitted"},ChangeNoteManager.prototype.helper_methods=["change_note","submit_text"],ChangeNoteManager.prototype.initialize=function(params){return null==params&&(params={}),this.submit_text=params.submit_text,this.change_note=new Boundless.ChangeNote,this.render()},ChangeNoteManager.prototype.form_submitted=function(e){var $form,attrs;return e.preventDefault(),$form=this.$("#change-note-form"),attrs=$form.fields_for("changenote"),$form.disable_form(),this.change_note.set(attrs,{silent:!0}),this.change_note.isValid()?this.trigger("change_note:complete",this.change_note.get("text")):this.render(),!1},ChangeNoteManager}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Boundless.Editor.HumanInputManager=function(){function HumanInputManager(settings,utils){this.cursor_at_new_paragraph=bind(this.cursor_at_new_paragraph,this),this.update_position=bind(this.update_position,this),this.on_clicked_editor_ui=bind(this.on_clicked_editor_ui,this),this.on_clicked_p=bind(this.on_clicked_p,this),this.on_clicked_equation=bind(this.on_clicked_equation,this),this.on_keyup=bind(this.on_keyup,this),this.on_keydown=bind(this.on_keydown,this),this.settings=settings,this.utils=utils,this.keyboard_handler=new Boundless.Editor.KeyboardHandler(this.settings,this.utils),this.mouse_handler=new Boundless.Editor.MouseHandler(this.settings,this.utils),this.settings.element.onpaste=function(_this){return function(e){var html,pasted_doc,text;return(html=e.clipboardData.getData("text/html"))&&(e.preventDefault(),html=e.clipboardData.getData("text/html"),pasted_doc=editor.dom_parser.parseFromString(html,"text/html"),_this.utils.clean_html(pasted_doc.body.children),text=e.clipboardData.getData("text/plain"),pasted_doc.body.innerHTML.length&&(text=pasted_doc.body.innerHTML.replace(/\n/g,"")),document.execCommand("insertHTML",!1,text)),!0}}(this),this.bind_element_events(),events.off("editor:block-level").on("editor:block-level",function(_this){return function(){return window.getSelection().getRangeAt(0,0).startContainer.classList.add("focused")}}(this)),events.off("editor:inline-level").on("editor:inline-level",function(_this){return function(){var ref;return null!=(ref=document.querySelector(".focused"))?ref.classList.remove("focused"):void 0}}(this))}return HumanInputManager.prototype.bind_element_events=function(){return this.settings.$el.on("keydown",this.on_keydown),this.settings.$el.on("keyup",this.on_keyup),this.settings.$el.on("mouseup",this.check_for_selection),this.settings.$el.on("click","equation",this.on_clicked_equation),this.settings.$el.on("click","p",this.on_clicked_p),this.settings.$el.on("click",".editor-ui",this.on_clicked_editor_ui)},HumanInputManager.prototype.unbind_element_events=function(){return this.settings.$el?(this.settings.$el.off("keydown",this.on_keydown),this.settings.$el.off("keyup",this.on_keyup),this.settings.$el.off("mouseup",this.check_for_selection),this.settings.$el.off("click","equation",this.on_clicked_equation),this.settings.$el.off("click","p",this.on_clicked_p),this.settings.$el.off("click",".editor-ui",this.on_clicked_editor_ui)):void 0},HumanInputManager.prototype.on_keydown=function(e){return editor.keyboard_intercept_disabled?void 0:(editor.typing_tracked||(editor.typing_tracked=!0,Boundless.Events.Sisyphus.track("typed_in_editor",{once:!0})),this.keyboard_handler.intercept_down(e))},HumanInputManager.prototype.on_keyup=function(e){return editor.keyboard_intercept_disabled?void 0:(this.keyboard_handler.intercept_up(e,this.update_position),this.check_for_selection())},HumanInputManager.prototype.on_clicked_equation=function(e){return this.mouse_handler.equation_click(e)},HumanInputManager.prototype.on_clicked_p=function(e){var ref;return events.trigger("editor:enable_spanwatch"),"FORM"!==(null!=(ref=window.getSelection())?ref.getRangeAt(0,0).startContainer.nodeName:void 0)?this.update_position(e):void 0},HumanInputManager.prototype.on_clicked_editor_ui=function(e){return this.clear_selection()},HumanInputManager.prototype.update_position=function(e){var align_to_distant_parent,align_to_sel_parent,alignment_parent,alignment_parents,cursor_position,embed_tool_coords,embed_tool_left,embed_tool_offset,i,len,selection,selection_parent;if(null==e&&(e={}),selection=rangy.getSelection(),0!==selection.rangeCount&&selection.focusNode&&(selection_parent=$(selection.focusNode.parentElement),selection.isCollapsed&&"false"!==$(selection_parent).attr("contenteditable")&&0===$('[contenteditable="false"]').has(selection_parent).length&&("true"===$(selection_parent).attr("contenteditable")||0!==$('[contenteditable="true"]').has(selection_parent).length))){for(Boundless.Logger.log("updating embed tool position"),alignment_parents=[{sel:".bcp-quiz-question",offset:{left:2,top:-4,scale:.8}},{sel:".content-editor-container",offset:{left:6,top:-6,scale:1}}],i=0,len=alignment_parents.length;len>i;i++){if(alignment_parent=alignment_parents[i],embed_tool_offset=alignment_parent.offset,align_to_sel_parent=$(selection_parent).filter(alignment_parent.sel)[0]){embed_tool_left=$(selection_parent).offset().left;break}if(align_to_distant_parent=$(alignment_parent.sel).has(selection_parent)[0]){embed_tool_left=$(align_to_distant_parent).offset().left;break}}return cursor_position=editor.get_cursor_position(),cursor_position&&embed_tool_left?(embed_tool_coords={left:embed_tool_left+embed_tool_offset.left,top:cursor_position.top+embed_tool_offset.top},events.trigger("embed_tool:translate",embed_tool_coords,embed_tool_offset.scale)):Boundless.Logger.log("Warn: Cannot determine cursor position, and/or alignment parent for embed tool.")}},HumanInputManager.prototype.cursor_at_new_paragraph=function(){return""===window.getSelection().baseNode.textContent&&"P"===window.getSelection().baseNode.nodeName},HumanInputManager.prototype.clear_selection=function(){if(window.getSelection){if(window.getSelection().empty)return window.getSelection().empty();if(window.getSelection().removeAllRanges)return window.getSelection().removeAllRanges()}else if(document.selection)return document.selection.empty()},HumanInputManager.prototype.check_for_selection=function(){return setTimeout(function(_this){return function(){var sel;return sel=window.getSelection(),sel.rangeCount&&sel.getRangeAt(0).collapsed?events.trigger("editor:selection_collapsed"):void 0}}(this),100)},HumanInputManager}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Editor.EmbedTool=function(superClass){function EmbedTool(){return EmbedTool.__super__.constructor.apply(this,arguments)}return extend(EmbedTool,superClass),EmbedTool.prototype.className="embed-tool",EmbedTool.prototype.template="embed_tool",EmbedTool.prototype.events={"click .embed-tool__fauxverlay":"fauxverlay_triggered","click .embed-tool__equation-btn":"equation_btn_triggered","click .embed-tool__inline-equation":"inline_equation_btn_triggered"},EmbedTool.prototype.initialize=function(){return events.off("embed_tool:translate").on("embed_tool:translate",function(_this){return function(coords,scale){var selection;return Boundless.Logger.log("Translating embed tool"),selection=rangy.getSelection(),"mq-textarea"===selection.getRangeAt(0,0).startContainer.className?_this.hide():(_this.reference_node=selection.getRangeAt(0,0).commonAncestorContainer,_this.translate(coords.left,coords.top,scale),editor.hi_manager.cursor_at_new_paragraph()?(_this.el.classList.add("block-level"),events.trigger("editor:block-level")):(_this.el.classList.remove("block-level"),events.trigger("editor:inline-level")))}}(this)),events.off("embed_tool:hide").on("embed_tool:hide",function(_this){return function(){return _this.hide()}}(this)),this.render()},EmbedTool.prototype.hide=function(){return this.translate_offscreen(),this.el.classList.remove("block-level")},EmbedTool.prototype.render=function(){return document.querySelector("#wiselinks-container").appendChild(this.el),EmbedTool.__super__.render.apply(this,arguments),this.tools=this.el.querySelector(".embed-tool__tools"),this},EmbedTool.prototype.fauxverlay_triggered=function(){return this.el.classList.remove("tools-on")},EmbedTool.prototype.equation_btn_triggered=function(){return new Boundless.Editor.NewEquationController({reference_node:this.reference_node}),this.hide()},EmbedTool.prototype.inline_equation_btn_triggered=function(){var eq,eqn_id,span,span2;return events.trigger("editor:prevent_saving"),eq=document.createElement("equation"),span=document.createElement("span"),span.className="editor-ui",span.innerText=" ",eq.setAttribute("contenteditable","false"),eqn_id=editor.utils.new_short_id(),span2=span.cloneNode(),span2.innerText=".",span2.style.color="white",span2.classList.add("delete-me"),window.editor.selection.insertNode(span2),window.editor.selection.insertNode(span),window.editor.selection.insertNode(eq),$(eq).wrapInner("<span id='"+eqn_id+"' class='neo_tag_exclude equation_inner_wrapper'>"),new Boundless.Editor.EditEquation({src:"",equation_id:eq.children[0].id}),events.trigger("editor:enable_keyboard_intercept")},EmbedTool.prototype.translate=function(x,y,scale){var transform;return null==x&&(x=0),null==y&&(y=0),null==scale&&(scale=1),transform="translate("+parseInt(x)+"px,"+parseInt(y)+"px) scale("+scale+","+scale+")",this.tools.style.webkitTransform=transform,this.tools.style.mozTransform=transform,this.tools.style.msTransform=transform,this.tools.style.transform=transform,this.el.classList.add("on")},EmbedTool.prototype.translate_offscreen=function(){return this.translate(-9999,-9999,1),this.el.classList.remove("tools-on"),this.el.classList.remove("on")},EmbedTool}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Editor.EditEquation=function(superClass){function EditEquation(){return EditEquation.__super__.constructor.apply(this,arguments)}return extend(EditEquation,superClass),EditEquation.prototype.template="equations/edit",EditEquation.prototype.events={"submit form":"submit_form"},EditEquation.prototype.initialize=function(options){return this.src=options.src,this.equation_id=options.equation_id,this.modal=new Boundless.GlobalModalController({contents:this.el,width:600}),this.modal.show(),this.render()},EditEquation.prototype.render=function(){return this.modal.el.querySelector(".modal__inner").appendChild(this.el),EditEquation.__super__.render.apply(this,arguments),this.$input=this.$(".edit-atom-asset__form-input"),this.src&&this.$input.val(this.src),events.trigger("embed_tool:hide")},EditEquation.prototype.submit_form=function(e){var new_eq;return e.preventDefault(),this.equation_el=document.getElementById(this.equation_id),null!=this.equation_el.querySelector("script")?(new_eq=this.$input.val(),this.equation_el.querySelector("script").innerText=new_eq,MathJax.Hub.Queue(editor.settings.helper_methods.mathjax_prerender,["Text",MathJax.Hub.getAllJax(this.equation_id)[0],new_eq],editor.settings.helper_methods.mathjax_postrender)):(this.equation_el.innerText="$"+this.$input.val()+"$",MathJax.Hub.Queue(editor.settings.helper_methods.mathjax_prerender,["Typeset",MathJax.Hub,this.equation_id],editor.settings.helper_methods.mathjax_postrender)),this.modal.hide(),setTimeout(function(_this){return function(){return _this.remove()}}(this),1e3),events.trigger("editor:changed"),events.trigger("editor:new_equation",this.equation_el),events.trigger("editor:prevent_saving",!1),events.trigger("editor:restore_selection"),window.getSelection().modify("move","forward","character"),editor.$el.on("keydown",function(event){return $(".delete-me").remove(),$(this).off(event)})},EditEquation}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;
Boundless.Editor.TextFormatter=function(superClass){function TextFormatter(){return this.update_options_position=bind(this.update_options_position,this),this.open_and_update_options=bind(this.open_and_update_options,this),this.on_ol_click=bind(this.on_ol_click,this),this.on_ul_click=bind(this.on_ul_click,this),this.on_h3_click=bind(this.on_h3_click,this),this.on_h2_click=bind(this.on_h2_click,this),this.on_blockquote_click=bind(this.on_blockquote_click,this),TextFormatter.__super__.constructor.apply(this,arguments)}return extend(TextFormatter,superClass),TextFormatter.prototype.className="text-options",TextFormatter.prototype.events={"click .text-options__toggle":"toggle_additional_tools"},TextFormatter.prototype.initialize=function(options){return this.settings=options.settings,this.utils=options.utils,this.render(),events.on("text_formatter:opening",function(_this){return function(){return events.trigger("embed_tool:hide")}}(this)),events.on("text_formatter:hide",function(_this){return function(){return _this.on_selection_blur()}}(this)),events.on("editor:selection_collapsed",function(_this){return function(){return _this.on_selection_blur()}}(this))},TextFormatter.prototype.render=function(){return _.each(this.settings.element_classList,function(_this){return function(class_name){return _this.el.classList.add(class_name+"__from-editor")}}(this)),this.$el.html(editor.utils.render_view("text_formatter")),document.querySelector("#wiselinks-container").appendChild(this.el),this.el_inner=document.querySelector(".text-options__inner"),this.create_event_bindings(),this},TextFormatter.prototype.create_event_bindings=function(){return this.edit_buttons=[],_.each(this.settings.tags.inner_level.concat(this.settings.tags.outer_level),function(_this){return function(tag){var button;switch(tag){case"li":case"figure":case"iframe":return!0;default:return button=_this.el.querySelector(".tag-"+tag),button.onclick=function(e){return _this["on_"+tag+"_click"](e),events.trigger("editor:changed",e),e.currentTarget.classList.toggle("active")},_this.edit_buttons.push(button)}}}(this))},TextFormatter.prototype.toggle_additional_tools=function(e){return this.el.classList.remove("active"),setTimeout(function(_this){return function(){return _this.el.classList.add("show-additional-tools"),_this.update_options_position(),_this.el.classList.add("active")}}(this),150)},TextFormatter.prototype.on_i_click=function(){return document.execCommand("italic",!1,null)},TextFormatter.prototype.on_sup_click=function(){return document.execCommand("superscript",!1,null)},TextFormatter.prototype.on_sub_click=function(){return document.execCommand("subscript",!1,null)},TextFormatter.prototype.on_blockquote_click=function(){var node_names;return node_names=this.utils.find_nodes(window.getSelection().focusNode),this.utils.has_node(node_names,"BLOCKQUOTE")?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,"blockquote")},TextFormatter.prototype.on_h2_click=function(){var node_names;return node_names=this.utils.find_nodes(window.getSelection().focusNode),$(".tag-h3").removeClass("active"),this.utils.has_node(node_names,"LI")?!1:this.utils.has_node(node_names,"H2")?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,"h2")},TextFormatter.prototype.on_h3_click=function(){var node_names;return node_names=this.utils.find_nodes(window.getSelection().focusNode),$(".tag-h2").removeClass("active"),this.utils.has_node(node_names,"LI")?!1:this.utils.has_node(node_names,"H3")?(document.execCommand("formatBlock",!1,"p"),document.execCommand("outdent")):document.execCommand("formatBlock",!1,"h3")},TextFormatter.prototype.on_ul_click=function(){var node_names,sel;return node_names=this.utils.find_nodes(window.getSelection().focusNode),this.utils.has_node(node_names,"UL")?(sel=this.utils.save_selection(),document.execCommand("insertunorderedlist",!1),this.utils.fix_br_tags(),this.utils.restore_selection(sel)):document.execCommand("insertunorderedlist",!1)},TextFormatter.prototype.on_ol_click=function(){var node_names,sel;return node_names=this.utils.find_nodes(window.getSelection().focusNode),this.utils.has_node(node_names,"OL")?(sel=this.utils.save_selection(),document.execCommand("insertorderedlist",!1),this.utils.fix_br_tags(),this.utils.restore_selection(sel)):document.execCommand("insertorderedlist",!1)},TextFormatter.prototype.open_and_update_options=function(current_node_list,e){var button,i,len,ref,results,tag,tags;for(null==e&&(e=null),events.trigger("text_formatter:opening"),this.translate(-9999,-9999),this.el.classList.add("active"),this.update_edit_options_states(current_node_list),this.update_options_position(),this.el_inner.classList.remove("full","paragraph","list","no-headers"),this.el_inner.classList.add(this.settings.mode),current_node_list.LI&&this.el_inner.classList.add("no-headers"),tags=this.settings.tags.inner_level.concat(this.settings.tags.outer_level),ref=this.edit_buttons,results=[],i=0,len=ref.length;len>i;i++)button=ref[i],results.push(function(){var j,len1,results1;for(results1=[],j=0,len1=tags.length;len1>j;j++)tag=tags[j],button.classList.contains("tag-"+tag)?this.utils.has_node(current_node_list,tag.toUpperCase())?results1.push(button.classList.add("active")):button.classList.contains("active")?results1.push(button.classList.remove("active")):results1.push(void 0):results1.push(void 0);return results1}.call(this));return results},TextFormatter.prototype.update_options_position=function(){var boundary,left,range,selection,selection_width,top;return selection=window.getSelection(),range=selection.getRangeAt(0),boundary=range.getBoundingClientRect(),selection_width=boundary.right-boundary.left,left=Math.floor(boundary.left+(selection_width-this.el_inner.offsetWidth)/2),top=Math.floor(boundary.top+window.scrollY-5),this.translate(left,top)},TextFormatter.prototype.update_edit_options_states=function(node_list){var tags;return tags=this.settings.tags.inner_level.concat(this.settings.tags.outer_level),"title"===editor.settings.mode||node_list.LI?this.el.classList.add("minimally-formatted-node","show-additional-tools"):void 0},TextFormatter.prototype.on_selection_blur=function(){return this.translate(-9999,-9999),this.el.classList.remove("active","show-additional-tools","minimally-formatted-node")},TextFormatter.prototype.translate=function(x,y,z){var transform;return null==x&&(x=0),null==y&&(y=0),null==z&&(z=0),transform="translate3d("+x+"px,"+y+"px,"+z+"px)",this.el.style.webkitTransform=transform,this.el.style.mozTransform=transform,this.el.style.msTransform=transform,this.el.style.transform=transform},TextFormatter.prototype.remove=function(){return events.off("text_formatter:opening"),events.off("text_formatter:hide"),events.off("editor:selection_collapsed"),TextFormatter.__super__.remove.apply(this,arguments)},TextFormatter}(Boundless.Base.View)}.call(this),function(){Boundless.Editor.EquationUtils=function(){function EquationUtils(){}return EquationUtils.typeset_single_eqn=function(equation){var equation_id;return"EQUATION"===equation.nodeName&&($(equation).children("span").length>0?equation_id=$(equation).children("span")[0].attr("id"):(equation_id="equation_"+window.equation_number,window.equation_number++),EquationUtils.typeset(equation,equation_id)),equation_id},EquationUtils.typeset_eqns=function(element,callback){var equation,i,len,ref;if(null==callback&&(callback=null),window.equation_number||(window.equation_number=0),"undefined"!=typeof MathJax&&null!==MathJax){for(ref=$(element).find("equation:not(.atom__components__customTag)"),i=0,len=ref.length;len>i;i++)equation=ref[i],EquationUtils.typeset(equation,"equation_"+window.equation_number),window.equation_number++;return"function"==typeof callback?callback():void 0}},EquationUtils.get_eqn_contents=function(eqn_el){var contents,wrapper;return $(eqn_el).children("span").length>0?(wrapper=$(eqn_el).children("span"),contents=wrapper.children("script").length>0?wrapper.children("script").html():wrapper.html()):contents=eqn_el.innerHTML,contents.replace(/\$/g,"")},EquationUtils.typeset=function(eqn,eqn_id){var inner,new_contents,new_equation;return new_equation=document.createElement("equation"),new_contents="$"+this.get_eqn_contents(eqn)+"$",new_equation.innerHTML=new_contents,new_equation.setAttribute("contenteditable","false"),eqn.parentNode.replaceChild(new_equation,eqn),inner=$(new_equation).wrapInner("<span id='"+eqn_id+"' class='neo_tag_exclude equation_inner_wrapper' data-length="+new_equation.outerHTML.length+">"),"undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub.Queue(["Typeset",MathJax.Hub,eqn_id]):void 0},EquationUtils}()}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Boundless.Editor.HTMLUtils=function(){function HTMLUtils(settings){this.clean_html=bind(this.clean_html,this),this.fix_br_tags=bind(this.fix_br_tags,this),this.settings=settings,this.focused_element=null}return HTMLUtils.prototype.preserve_element_focus=function(){var anchor_node,child,children,cur,diff,element_index,i,index,len;if(anchor_node=window.getSelection?window.getSelection().anchorNode:document.activeElement){for(cur=anchor_node.parentNode,children=this.settings.element.children,diff=cur!==this.focused_element,element_index=0,cur===this.settings.element&&(cur=anchor_node),index=i=0,len=children.length;len>i;index=++i)if(child=children[index],cur===child){element_index=index;break}if(diff)return this.focused_element=cur}},HTMLUtils.prototype.deep_extend=function(destination,source){var property;for(property in source)source[property]&&source[property].constructor&&source[property].constructor===Object?(destination[property]=destination[property]||{},this.deep_extend(destination[property],source[property])):destination[property]=source[property];return destination},HTMLUtils.prototype.set_cursor=function(pos,el){var last_child,length,range,selection,the_length,to_modify;return document.createRange?(range=document.createRange(),selection=window.getSelection(),last_child=this.settings.element.lastChild,length=this.html_text(last_child).length-1,to_modify=el?el:last_child,the_length="undefined"!=typeof pos?pos:length,range.setStart(to_modify,the_length),range.collapse(!0),selection.removeAllRanges(),selection.addRange(range)):(range=document.body.createTextRange(),range.moveToElementText(el),range.collapse(!1),range.select())},HTMLUtils.prototype.get_first_parent_of_name=function(element,name){for(var found_element;element.parentNode;)element.nodeName===name&&(found_element=element),element=element.parentNode;return found_element},HTMLUtils.prototype.get_first_parent_with_attr=function(element,attr,val){var found_element;for(null==val&&(val="true");element.parentNode;)element.getAttribute(attr)===val&&(found_element=element),element=element.parentNode;return found_element},HTMLUtils.prototype.has_node=function(node_list,name){return!!node_list[name]},HTMLUtils.prototype.find_nodes=function(element){var node_names;for(node_names={};element.parentNode;)node_names[element.nodeName]=!0,element=element.parentNode;return node_names},HTMLUtils.prototype.get_elements_by_class_name=function(classname,el){var a,element,els,i,len,re;for(el=el?el:document.body,a=[],re=new RegExp("(^| )"+classname+"( |$)"),els=el.getElementsByTagName("*"),i=0,len=els.length;len>i;i++)element=els[i],re.test(element.className)&&a.push(element);return a},HTMLUtils.prototype.html_text=function(node,val){return node=node,val&&(node.textContent&&"undefined"!=typeof node.textContent?node.textContent=val:node.innerText=val),(node.textContent||node.innerText).trim()},HTMLUtils.prototype.change_tag=function(old_node,newTag,return_new_node){var new_node,next_node,node;for(null==return_new_node&&(return_new_node=!1),new_node=document.createElement(newTag),node=old_node.firstChild;node;)next_node=node.nextSibling,new_node.appendChild(node),node=next_node;return old_node.parentNode.insertBefore(new_node,old_node),old_node.parentNode.removeChild(old_node),return_new_node?new_node:void 0},HTMLUtils.prototype.next_node=function(node){if(node.hasChildNodes())return node.firstChild;for(;node&&!node.nextSibling;)node=node.parentNode;return node?node.nextSibling:null},HTMLUtils.prototype.get_selected_nodes=function(){var end_node,node,range,range_nodes,sel;if(window.getSelection&&(sel=window.getSelection(),!sel.isCollapsed)){if(range=sel.getRangeAt(0),node=range.startContainer,end_node=range.endContainer,node===end_node)return node;for(range_nodes=[];node&&node!==end_node;)range_nodes.push(node),node=node.nextSibling;return range_nodes.push(end_node),range_nodes}return[]},HTMLUtils.prototype.delete_node=function(el){return null!=el.parentNode?el.parentNode.removeChild(el):void 0},HTMLUtils.prototype.save_selection=function(){var sel;if(sel=window.getSelection()){if(sel.rangeCount>0)return sel.getRangeAt(0)}else if(d.selection&&d.selection.createRange)return d.selection.createRange()},HTMLUtils.prototype.restore_selection=function(range){var sel;if(range){if(sel=window.getSelection())return sel.removeAllRanges(),sel.addRange(range);if(d.selection&&range.select)return range.select()}},HTMLUtils.prototype.fix_br_tags=function(){var enclosing_paragraph,i,j,last_node,len,len1,new_paragraph_nodes,node,p,ref,selected_nodes;for(selected_nodes=this.get_selected_nodes(),enclosing_paragraph=selected_nodes[0].parentNode,new_paragraph_nodes=[],i=0,len=selected_nodes.length;len>i;i++){if(node=selected_nodes[i],Boundless.Logger.log(new_paragraph_nodes),"BR"===node.nodeName)this.delete_node(node);else if(new_paragraph_nodes.push(node),"BR"===node.nextSibling.nodeName){for(p=document.createElement("p"),j=0,len1=new_paragraph_nodes.length;len1>j;j++)node=new_paragraph_nodes[j],p.appendChild(node);$(enclosing_paragraph).after(p),new_paragraph_nodes=[]}last_node=node}return this.delete_node(enclosing_paragraph),last_node&&"BR"===(null!=(ref=this.next_node(last_node))?ref.nodeName:void 0)?this.next_node(last_node).remove():void 0},HTMLUtils.prototype.clean_html=function(children){var att,atts_to_remove,child,i,j,k,last,len,len1,len2,node,node_name,only,ref,should_delete;for(null==children&&(children=this.settings.element.children),atts_to_remove=["style","class"],only=this.settings.tags.outer_level.concat([this.settings.tags.paragraph,this.settings.tags.figure,this.settings.tags.equation]),ref=_.compact(children),i=0,len=ref.length;len>i;i++){for(child=ref[i],node_name=child.nodeName,should_delete=!0,this.settings.tags.inner_level.indexOf(child.nodeName.toLowerCase())&&(should_delete=!1),j=0,len1=atts_to_remove.length;len1>j;j++)att=atts_to_remove[j],child.hasAttribute(att)&&child.removeAttribute(att);for(k=0,len2=only.length;len2>k;k++)node=only[k],node===node_name.toLowerCase()&&(should_delete=!1);if(should_delete)switch(node_name.toLowerCase()){case"div":this.change_tag(child,this.settings.tags.paragraph);break;default:this.delete_node(child)}}return last=_.last(children),null!=last&&"P"===last.nodeName&&1===last.children.length&&"BR"===last.children[0].nodeName?last.children[0].remove():void 0},HTMLUtils.prototype.render_view=function(view_name,context){return null==context&&(context={}),HAML["editor/views/"+view_name](context)},HTMLUtils.prototype.new_short_id=function(){return _.uniqueId("pepe_")},HTMLUtils.prototype.is_url=function(string){return/\b(https?|ftp|file):\/\/[\-A-Za-z0-9+&@#\/%?=~_|!:,.;]*[\-A-Za-z0-9+&@#\/%=~_|\u200c\u200b]/.test(string)},HTMLUtils.prototype.generate_unique_id=function(){var _p8;return _p8=function(s){var p;return p=(Math.random().toString(16)+"000000000").substr(2,8),s?"-"+p.substr(0,4)+"-"+p.substr(4,4):p},_p8()+_p8(!0)+_p8(!0)+_p8()},HTMLUtils}()}.call(this),function(){Boundless.Licenses=function(){function Licenses(){}return Licenses.fetch=function(callback){var ajax_get;return this.pending?void events.once("licenses:fetched",function(_this){return function(){return callback(_this.list)}}(this)):this.list?void callback(this.list):(this.pending=!0,ajax_get=$.get(Boundless.API+"/licenses"),ajax_get.done(function(_this){return function(response){var filtered_results;return filtered_results=_.map(response.data.results,function(license){return[license.id,license.name]}),_this.license_list_fetched(filtered_results,callback)}}(this)),ajax_get.fail(function(_this){return function(){return Boundless.Logger.error("Ajax failure: fetch_license_list"),_this.license_list_fetched([],callback)}}(this)))},Licenses.license_list_fetched=function(list,callback){return this.list=list,callback(this.list),events.trigger("licenses:fetched"),this.pending=!1},Licenses}()}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["editor/views/change_note"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__inner-header'>\n  <h2>Describe your changes</h2>\n</div>\n<div class='modal__inner-body'>"),$o.push("  "+$c(this.form_for(this.change_note,{id:"change-note-form"},function(form){var $o1;return $o1=[],$o1.push("  "+$c(form.input("text",{label:!1,as:"text",placeholder:"Please type a quick note outlining what you changed..."}))),$o1.push("  "+$c(form.action("submit",{label:this.submit_text,as:"button",action_class:"btn-large btn-block"}))),$o1.join("\n")}))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.EditableElBinder=function(superClass){function EditableElBinder(){return EditableElBinder.__super__.constructor.apply(this,arguments)}return extend(EditableElBinder,superClass),EditableElBinder.prototype.model=null,EditableElBinder.prototype.el=null,EditableElBinder.prototype.attributes={sync_attr:null,sync_attr_index:null},EditableElBinder.prototype.events={keyup:"update_model",new_equation:"update_model"},EditableElBinder.prototype.initialize=function(){return $(this.el).addClass("edit-enabled"),this.model.view=this,events.on("editor:changed",function(_this){return function(e){return _this.update_model(e)}}(this))},EditableElBinder.prototype.update_model=function(e){return e.keyCode===KeyCode.TAB?void this.cursor_to_end():(this.model.pending_save=!0,_.isUndefined(this.attributes.sync_attr_index)?this.model.set(this.attributes.sync_attr,this.get_save_value()):(this.model.get(this.attributes.sync_attr)[this.attributes.sync_attr_index]=this.get_save_value(),this.model.trigger(this.model_event()+" "+this.model_event(this.attributes.sync_attr_index),this.model,this.get_save_value())))},EditableElBinder.prototype.model_event=function(event_modifier){var event;return event="change:"+this.attributes.sync_attr,_.isUndefined(event_modifier)||(event=event+":"+event_modifier),event},EditableElBinder.prototype.get_save_value=function(){return this.clear_whitespace(this.get_el_html())},EditableElBinder.prototype.clear_whitespace=function(text){return text=text.replace(/&nbsp;/g," "),text=text.replace(/[\s\n\r]+/g," "),$.trim(text),text},EditableElBinder.prototype.get_el_html=function(){var temp_clone;return"true"===$(this.el).attr("editable_light")?$(this.el).text():(temp_clone=$(this.el).clone(),$("equation",temp_clone).each(function(_this){return function(index,el){var equation_text;return equation_text=$("script",el).html(),$(el).html("$"+equation_text+"$")}}(this)),$(temp_clone).html())},EditableElBinder.prototype.cursor_to_end=function(){var range,sel,textRange;return this.el.focus(),"undefined"!=typeof window.getSelection&&"undefined"!=typeof document.createRange?(range=document.createRange(),range.selectNodeContents(this.el),range.collapse(!1),sel=window.getSelection(),sel.removeAllRanges(),sel.addRange(range)):"undefined"!=typeof document.body.createTextRange?(textRange=document.body.createTextRange(),textRange.moveToElementText(this.el),textRange.collapse(!1),textRange.select()):void 0},EditableElBinder}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["editor/views/embed_tool"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='embed-tool__fauxverlay'></div>\n<div class='embed-tool__tools'>\n  <div class='embed-tool__inline-equation'>\n    <span class='editor-icon-editor-add-inline-equation'></span>\n  </div>\n  <div class='embed-tool__buttons'>\n    <span>\n      <button class='embed-tool__btn embed-tool__image-btn'>\n        <span class='editor-icon-editor-add-image'></span>\n      </button>\n      <span class='embed-tool__btn-text embed-tool__image-btn-text inline-tool-tip inline-tool-tip__left-arrow'>Add Image</span>\n    </span>\n    <span>\n      <button class='embed-tool__btn embed-tool__graph-btn'>\n        <span class='boundless-icon-graph'></span>\n      </button>\n      <span class='embed-tool__btn-text embed-tool__graph-btn-text inline-tool-tip inline-tool-tip__left-arrow'>Add Graph</span>\n    </span>\n    <span>\n      <button class='embed-tool__btn embed-tool__equation-btn'>\n        <span class='editor-icon-editor-add-equation'></span>\n      </button>\n      <span class='embed-tool__btn-text embed-tool__equation-btn-text inline-tool-tip inline-tool-tip__left-arrow'>Add Equation</span>\n    </span>\n    <span>\n      <button class='embed-tool__btn embed-tool__embed-btn'>\n        <span class='boundless-icon-embed-1'></span>\n      </button>\n      <span class='embed-tool__btn-text embed-tool__embed-btn-text inline-tool-tip inline-tool-tip__left-arrow'>Embed anything</span>\n    </span>\n    <span>\n      <button class='embed-tool__btn embed-tool__embed-link-btn'>\n        <div class='editor-icon-add-link'>\n          <i class='icon-link'></i>\n        </div>\n      </button>\n      <span class='embed-tool__btn-text embed-tool__embed-link-btn-text inline-tool-tip inline-tool-tip__left-arrow'>Add a link</span>\n    </span>\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["editor/views/equations/edit"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='edit-atom-asset__create'>\n  <form id='edit-atom-asset__equation-form'>\n    <label class='edit-atom-asset__text equation'>Enter your equation (LaTeX formatting)</label>\n    <textarea class='edit-atom-asset__form-input edit-equation__input' name='edit-equation__input'></textarea>\n    <button class='btn btn-primary' type='submit'>Submit</button>\n  </form>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["editor/views/equations/new"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='edit-atom-asset__fauxverlay'></div>\n<div class='edit-atom-asset__create'>\n  <form id='edit-atom-asset__equation-form'>\n    <label class='edit-atom-asset__text equation'>Enter your equation (LaTeX formatting)</label>\n    <textarea class='edit-atom-asset__form-input edit-equation__input' name='edit-equation__input'></textarea>\n    <button class='btn btn-primary' type='submit'>Submit</button>\n  </form>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["editor/views/text_formatter"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='full text-options__inner'>\n  <span class='outer-tag-options'>\n    <button class='tag-h2 text-options__btn'>\n      <div class='editor-icon-h1'></div>\n    </button>\n    <button class='tag-h3 text-options__btn'>\n      <div class='editor-icon-h2'></div>\n    </button>\n    <button class='tag-ul text-options__btn'>\n      <div class='editor-icon-ul'></div>\n    </button>\n    <button class='tag-ol text-options__btn'>\n      <div class='editor-icon-ol'></div>\n    </button>\n    <button class='tag-blockquote text-options__btn'>\n      <div class='editor-icon-quote'></div>\n    </button>\n  </span>\n  <span class='inner-tag-options'>\n    <button class='tag-i text-options__btn'>\n      <div class='editor-icon-italic'></div>\n    </button>\n    <button class='tag-sup text-options__btn'>\n      <div class='editor-icon-super'></div>\n    </button>\n    <button class='tag-sub text-options__btn'>\n      <div class='editor-icon-sub'></div>\n    </button>\n    <span class='text-options__inner-spacer'></span>\n  </span>\n  <button class='text-options__btn text-options__toggle'>\n    more\u2026\n  </button>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){}.call(this),function(){Boundless.append_view_path("question_search/views"),Boundless.QuestionSearch||(Boundless.QuestionSearch={}),Boundless.QuestionSearch.App=function(){function App(opts){var defaults;defaults={el:null,modal:null,on_ready:function(_this){return function(controller){}}(this)},this.options=$.extend(defaults,opts),this.controller=new Boundless.QuestionSearch.Controller(this.options),this.options.modal.show(),this.options.on_ready(this.controller)}return App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuestionSearch.Controller=function(superClass){function Controller(){return Controller.__super__.constructor.apply(this,arguments)}return extend(Controller,superClass),Controller.prototype.helper_methods=["question_html","search_term","search_results","selected_question_id","get_subject_tag_name"],Controller.prototype.template="default",Controller.prototype.events={"click .question-search__result":"show_question","keypress .question-search__result":"handle_question_keypress","click .question-search__back":"show_search_results","click .question-search--show-question__select-cta":"question_selected","click .question-search__create":"opt_for_new_question","keyup .question-search .bcp-hub__search-input":"update_search_results","focus .question-search .bcp-hub__search-input":"move_search_cursor","click .question-search .bcp-hub__search-btn":"update_search_results"},Controller.prototype.initialize=function(opts1){return this.opts=opts1,Controller.__super__.initialize.apply(this,arguments),this.el=this.opts.el,this.lesson=this.opts.lesson,this.show_search_results()},Controller.prototype.search_term="",Controller.prototype.show_search_results=function(){return this.template="show_search_results",this.render(),$(".question-search .bcp-hub__search-input").focus()},Controller.prototype.update_timeout=null,Controller.prototype.update_search_results=function(e){return e.preventDefault(),this.update_timeout&&clearTimeout(this.update_timeout),this.update_timeout=setTimeout(function(_this){return function(){var search_request;return _this.show_spinner(),_this.search_term=$(".question-search .bcp-hub__search-input").val(),_this.excluded_ids=_this.lesson.get("question_ids").join(","),search_request=$.ajax({url:Boundless.API+"/questions/search?q="+_this.search_term+"&exclude_ids="+_this.excluded_ids}),search_request.done(function(data,status){return _this.search_results=data,_this.render(),$(".question-search .bcp-hub__search-input").focus(),$(".question-search__result").each(function(index,el){return MathJax.Hub.Queue(["Typeset",MathJax.Hub,el])})}),search_request.fail(function(jqXHR,status){return Boundless.Logger.log("Question search failure: ",status)})}}(this),400)},Controller.prototype.selected_question=null,Controller.prototype.show_question=function(e){return this.selected_result=JSON.parse($(e.currentTarget).attr("question_json")),new Boundless.Question({id:this.selected_result.id}).fetch({data:{include_question_show_json:!0,include_question_edit_json:!0},success:function(_this){return function(model,response){return _this.selected_question=model,_this.populate_question_html(),_this.template="show_question",_this.render(),Boundless.Learnosity.init_app(_this.selected_question.get("learnosity_show_json"))}}(this),error:function(_this){return function(){return $.globalMessenger().post({message:"test",type:"error",showCloseButton:!0})}}(this)})},Controller.prototype.handle_question_keypress=function(e){var ref;return 13===(ref=e.keyCode)||32===ref?this.show_question(e):void 0},Controller.prototype.show_spinner=function(e){var opts;return opts={color:"#999",radius:6,length:4,width:2,lines:11,left:"20px",top:"38px",position:"absolute"},this.spinner=new Spinner(opts).spin($(".question-search__spinner")[0])},Controller.prototype.populate_question_html=function(){return this.question_html="<div class='question-wrapper'>\n  <div class='learnosity-response question-"+this.selected_result.id+"'></div>\n</div>"},Controller.prototype.question_selected=function(e){return this.opts.modal.controller.on("modal:hidden",function(_this){return function(){return _this.trigger("question_selected",_this.selected_question,_this.question_html)}}(this)),this.opts.modal.hide()},Controller.prototype.opt_for_new_question=function(e){return this.opts.modal.hide(),this.trigger("create_blank_question")},Controller.prototype.move_search_cursor=function(e){return e.currentTarget.setSelectionRange(this.search_term.length,this.search_term.length)},Controller.prototype.get_subject_tag_name=function(subject_tag_id){var ref;return null!=(ref=_.find(PageData.subjects,function(s){return s.id===subject_tag_id}))?ref.name:void 0},Controller}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["question_search/views/show_question"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='question-search question-search--show-question'>\n  <div class='question-search__back'>\n    <i class='boundless-icon-arrow-thick'></i>\n  </div>\n  <div class='question-search__header'>\n    <div class='question-search__header__text'>\n      Preview Question\n    </div>\n  </div>\n  <div class='bcp-quiz-question'>"),$o.push("    "+$c(this.question_html)),$o.push("  </div>\n  <div class='question-search--show-question__select-cta__wrap'>\n    <a class='btn btn-green question-search--show-question__select-cta'>\n      Use this question\n    </a>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["question_search/views/show_search_results"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='question-search'>\n  <div class='question-search__back'>\n    <i class='boundless-icon-arrow-thick'></i>\n  </div>\n  <div class='question-search__spinner'></div>\n  <div class='question-search__header'>\n    <form class='bcp-hub__search clearfix' action='test'>\n      <input class='bcp-hub__search-input' type='text' placeholder='Search Boundless content for questions' name='q' value='"+$e($c(this.search_term))+"'>\n      <button class='bcp-hub__search-btn btn btn-green' type='submit'>\n        <span class='text-label'>Search</span>\n      </button>\n      <i class='bcp-hub__search__icon icon-search'></i>\n    </form>\n  </div>\n  <div class='"+["question-search__results",""+$e($c(this.search_results&&""!==this.search_term?void 0:"question-search__results-initial"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n    <div class='question-search__results__header'>\n      Related Questions\n    </div>"),$(this.search_results).each(function(_this){return function(index,result){return $o.push("    <div class='question-search__result' question_id='"+$e($c(result.id))+"' question_json='"+$e($c(JSON.stringify(result)))+"' tabindex='"+$e($c(0))+"' role='link'>\n      <div class='question-search__result__question-prompt'>"),$o.push("        "+$c(result.stimulus)),$o.push("      </div>\n      <div class='question-search__result__question-meta'>\n        <span class='question-type'>"+$c(Boundless.LearnosityQuestion.getHumanizedType(result.type))+"</span>"),
result.subject_tag_id&&$o.push("        <span>in</span>\n        <span class='subject-name'>"+$c(_this.get_subject_tag_name(result.subject_tag_id))+"</span>"),$o.push("      </div>\n      <div class='question-search__result__cta'>\n        <i class='icon-angle-right'></i>\n      </div>\n    </div>"),""}}(this)),this.search_results&&0===this.search_results.length&&($o.push("    <div class='question-search__no-results'>"),$o.push("      "+$c('"'+this.search_term+"\" did not match any existing questions. Try again, or <a class='question-search__create'>create your own.</a>")),$o.push("    </div>")),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){BackRails.append_view_path("flagger/views"),BackRails.append_view_path("reader/views"),Boundless.Flagger||(Boundless.Flagger={}),Boundless.Flagger.App=function(){function App(){this.flaggerSmartNotes=new Boundless.FlaggerController({el:$(".flagger__flag-container.smartnotes"),flaggable_type:"SmartNotes",flag_headline:"Give us feedback on this content:"}),this.flaggerFulltext=new Boundless.FlaggerController({el:$(".flagger__flag-container.fulltext"),flaggable_type:"Fulltext",flag_headline:"Give us feedback on this content:"}),events.on("flagger:done_flagging",function(){var wizzard;return session.current_user?void 0:(this.register_controller=new Boundless.Register.RegisterController({skip_role_selector:!1,conversion_event:!1}),this.register_controller.on("register:complete",function(_this){return function(){return wizzard.hide()}}(this)),wizzard=new Boundless.WizzardController({sidebar_template:"flag_content",step_els:[this.register_controller.$el]}),wizzard.render())})}return App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateIssueFollowUpController=function(superClass){function CreateIssueFollowUpController(){return CreateIssueFollowUpController.__super__.constructor.apply(this,arguments)}return extend(CreateIssueFollowUpController,superClass),CreateIssueFollowUpController.prototype.template="create_issue_follow_up",CreateIssueFollowUpController.prototype.className="create-issue__follow-up",CreateIssueFollowUpController.prototype.helper_methods=["issue"],CreateIssueFollowUpController.prototype.elements={"#create_issue_form":"form","#issue-title-input":"title_input"},CreateIssueFollowUpController.prototype.events={"click .create-issue__follow-up__issue-type-btn":"on_clicked_issue_type","submit #create_issue_form":"submit_feedback","blur #create-issue__feedback-input":"on_defocus_feedback"},CreateIssueFollowUpController.prototype.initialize=function(params){return this.issue=new Boundless.Issue({content_object_type:"Atom",content_object_id:params.atom_id||PageData.concept_data.atom_id,issue_type:"",title:""}),CreateIssueFollowUpController.__super__.initialize.apply(this,arguments),this.$el.removeClass("submitted"),this.render(this.template,{},this.show),this},CreateIssueFollowUpController.prototype.on_clicked_issue_type=function(evt){var $target;return $target=$(evt.currentTarget),$target.addClass("active"),this.$el.off("click .create-issue__follow-up__issue-type-btn"),this.issue.set({issue_type:$target.data("value")}),this.show_additional_feedback_for_element($target)},CreateIssueFollowUpController.prototype.show_additional_feedback_for_element=function($elem){return $elem.siblings(".create-issue__follow-up__issue-type-btn").addClass("hide"),this.$(".create-issue__follow-up__additional-feedback").removeClass("hide")},CreateIssueFollowUpController.prototype.selected_issue_type_el=function(){return this.$("[data-value='"+this.issue.get("issue_type")+"']")},CreateIssueFollowUpController.prototype.submit_feedback=function(e){return e.preventDefault(),this.issue.set("title",$(".create-issue__follow-up__title-input").val()),this.issue.save({},{success:function(_this){return function(){return _this.show_thanks_and_hide()}}(this),error:function(_this){return function(){return _this.submission_error()}}(this)})},CreateIssueFollowUpController.prototype.submission_error=function(){return this.render(),this.selected_issue_type_el().siblings(".create-issue__follow-up__issue-type-btn").addClass("hide")},CreateIssueFollowUpController.prototype.show_thanks_and_hide=function(){var ref;return this.$el.addClass("submitted"),null!=(ref=this.form[0])?ref.reset():void 0},CreateIssueFollowUpController}(BackRails.SheetController)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.FlagFollowUpController=function(superClass){function FlagFollowUpController(){return FlagFollowUpController.__super__.constructor.apply(this,arguments)}return extend(FlagFollowUpController,superClass),FlagFollowUpController.prototype.template="flag_follow_up",FlagFollowUpController.prototype.className="flag-follow-up",FlagFollowUpController.prototype.elements={"#flag_form":"form","#flag-feedback-input":"feedback_text"},FlagFollowUpController.prototype.events={"click .flag-follow-up__flag-type-btn":"on_clicked_flag_type","submit #flag_form":"submit_feedback","focus #flag-feedback-input":"unset_feedback_placholder_text","blur #flag-feedback-input":"on_defocus_feedback"},FlagFollowUpController.prototype.helper_methods=["flag"],FlagFollowUpController.prototype.initialize=function(options){return FlagFollowUpController.__super__.initialize.apply(this,arguments),this.flag=options.flag,this.render(this.template,{},this.show),this.$el.removeClass("submitted")},FlagFollowUpController.prototype.on_clicked_flag_type=function(evt){var $target;return $target=$(evt.currentTarget),$target.addClass("active"),this.$el.off("click .flag-follow-up__flag-type-btn"),this.flag.get("touched")?(this.flag.set({feedback_type:$target.data("value")}),Boundless.Events.Flags.track("clicked_feedback_type",this.flag.attributes),this.flag.save({},{success:function(_this){return function(){return _this.show_additional_feedback_for_element($target)}}(this)})):void 0},FlagFollowUpController.prototype.show_additional_feedback_for_element=function($elem){return this.set_feedback_placholder_text($elem),$elem.siblings(".flag-follow-up__flag-type-btn").addClass("hide"),this.$(".flag-follow-up__additional-feedback").removeClass("hide")},FlagFollowUpController.prototype.unset_feedback_placholder_text=function(){return this.feedback_text.attr("placeholder","")},FlagFollowUpController.prototype.set_feedback_placholder_text=function($elem){return this.feedback_text.attr("placeholder",Boundless.Flag.FEEDBACK_PROMPT_FOR_TYPE[$elem.data("value")])},FlagFollowUpController.prototype.on_defocus_feedback=function(evt){return this.set_feedback_placholder_text(this.$(".flag-follow-up__flag-type-btn:not(.hide)"))},FlagFollowUpController.prototype._hide_additional_feedback=function(){return this.$(".flag-follow-up__flag-type-btn").removeClass("hide"),this.$(".flag-follow-up__additional-feedback").addClass("hide")},FlagFollowUpController.prototype.submit_feedback=function(e){return e.preventDefault(),this.flag.get("touched")?this.feedback_text.val()?(this.flag.set({feedback:this.feedback_text.val()}),Boundless.Events.Flags.track("submitted_feedback",this.flag.attributes),this.flag.save({},{success:function(_this){return function(){return _this.show_thanks_and_hide()}}(this)})):this.show_thanks_and_hide():void 0},FlagFollowUpController.prototype.show_thanks_and_hide=function(){var ref;return this.$el.addClass("submitted"),null!=(ref=this.form[0])&&ref.reset(),setTimeout(function(_this){return function(){return events.trigger("flagger:done_flagging"),_this.hide_and_remove()}}(this),1e3)},FlagFollowUpController}(BackRails.SheetController)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.FlaggerController=function(superClass){function FlaggerController(){return FlaggerController.__super__.constructor.apply(this,arguments)}return extend(FlaggerController,superClass),FlaggerController.prototype.template="flagger_flag",FlaggerController.prototype.events={"click .js__flag-response":"on_flagged"},FlaggerController.prototype.helper_methods=["flag","flag_headline"],FlaggerController.prototype.initialize=function(options){return FlaggerController.__super__.initialize.apply(this,arguments),this.flag_headline=options.flag_headline||"Give us feedback:",this.flaggable_type=options.flaggable_type||"Fulltext",this.render()},FlaggerController.prototype.on_flagged=function(e){var $target,flag_type;return"function"==typeof e.preventDefault&&e.preventDefault(),$target=$(e.currentTarget),$target.attr("disabled")?void 0:(flag_type=$target.data("value"),this.create_flag(flag_type),$target.addClass("selected"),Boundless.Events.Flags.track("flagged_content",this.flag.attributes),this.$el.find(".flag-response").attr("disabled",!0),this.flag.save({},{success:function(_this){return function(){return"needs-improvement"===flag_type?session.current_user?(_this.show_create_issue_follow_up(),_this.$el.find(".flag-response").attr("disabled",!1)):_this.show_follow_up():events.trigger("flagger:done_flagging")}}(this)}))},FlaggerController.prototype.create_flag=function(flag_type){return"Media"===this.flaggable_type?this.flag=new Boundless.Flag({atom_id:null,book_id:null,chapter_id:null,chapter_title:null,section_id:null,section_title:null,subject_tag:null,seo_page:!0,touched:!0,flaggable_type:this.flaggable_type,flag_type:flag_type,question_id:null,media_id:window.media_id},{silent:!0}):this.flag=new Boundless.Flag({atom_id:PageData.concept_data.atom_id,book_id:PageData.concept_data.book_id,chapter_id:PageData.concept_data.chapter_id,chapter_title:PageData.concept_data.chapter_title,section_id:PageData.concept_data.section_id,section_title:PageData.concept_data.section_title,subject_tag:PageData.concept_data.subject_tag,seo_page:!0,touched:!0,flaggable_type:this.flaggable_type,flag_type:flag_type,question_id:null,media_id:null},{silent:!0})},FlaggerController.prototype.show_follow_up=function(){var header_text;return header_text=function(){switch(this.flaggable_type){case"SmartNotes":return"What's wrong with these SmartNotes?";case"Media":return"What's wrong with this image?";default:return"What's wrong with this content?"}}.call(this),this.follow_up_modal=new Boundless.FlagFollowUpController({parent_controller:this,header_text:header_text,flag:this.flag}),this},FlaggerController.prototype.show_create_issue_follow_up=function(){return this.follow_up_modal=new Boundless.CreateIssueFollowUpController({atom_id:this.flag.get("atom_id")})},FlaggerController}(BackRails.Controller)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["flagger/views/create_issue_follow_up"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-issue__follow-up__container'>\n  <div class='create-issue__follow-up__header'>\n    <div class='create-issue__follow-up__header-text'>Help improve this content</div>\n  </div>\n  <div class='create-issue__follow-up-thanks'>\n    <h1 class='create-issue__follow-up-thanks--headline'>Thank you!</h1>\n    <p>Your feedback helps us make better content for you and your peers.</p>\n  </div>"),$o.push("  "+$c(this.form_for(this.issue,{id:"create_issue_form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("  "+$c(form.input("issue_type",{label:!1,as:"toggle",collection:Boundless.Issue.VALID_ISSUE_TYPES,input_class:"create-issue__follow-up__issue-type-btn",value:_this.issue.get("issue_type")}))),$o1.push("  <div class='"+["create-issue__follow-up__additional-feedback","clearfix",""+$e($c(_this.issue.get("issue_type")?void 0:"hide"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),$o1.push("    "+$c(form.input("title",{label:!1,as:"text",placeholder:"How should we improve this concept?",input_class:"create-issue__follow-up__title-input"}))),$o1.push("    "+$c(form.action("submit",{label:"Leave feedback",as:"button",action_class:"pull-right"}))),$o1.push("  </div>"),$o1.join("\n")}}(this)))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["flagger/views/flag_follow_up"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='flag-follow-up__container'>\n  <div class='flag-follow-up__header'>\n    <div class='flag-follow-up__header-text'>What's wrong with this content?</div>\n  </div>"),$o.push("  "+$c(this.form_for(this.flag,{id:"flag_form"},function(_this){return function(form){var $o1;return $o1=[],"Question"===_this.flag.get("flaggable_type")?$o1.push("  "+$c(form.input("improvement_options",{label:!1,as:"toggle",collection:Boundless.Flag.VALID_QUESTION_FEEDBACK_TYPES,input_class:"flag-follow-up__flag-type-btn"}))):$o1.push("  "+$c(form.input("improvement_options",{label:!1,as:"toggle",collection:Boundless.Flag.VALID_FEEDBACK_TYPES,input_class:"flag-follow-up__flag-type-btn"}))),$o1.push("  <div class='clearfix flag-follow-up__additional-feedback hide'>"),$o1.push("    "+$c(form.input("feedback",{label:!1,as:"text",placeholder:"Please tell us where we made a mistake"}))),$o1.push("    "+$c(form.action("submit",{label:"Leave feedback",as:"button",action_class:"pull-right"}))),$o1.push("  </div>"),$o1.join("\n")}}(this)))),$o.push("  <div class='flag-follow-up-thanks'>\n    <h1 class='flag-follow-up-thanks--headline'>Thank you!</h1>\n    <p>Your feedback helps us make better content for you and your peers.</p>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["flagger/views/flagger_flag"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='flag'>\n  <span class='flag-headline'>"+$c(this.flag_headline)+"</span>\n  <span class='nowrap'>\n    <a class='flag-response flag-response-v_up js__flag-response' data-value='good'>\n      <i class='boundless-icon-arrow-up'></i>\n    </a>\n    <!-- %a.flag-response.js__flag-response.flag-response-v_down{data: {value: 'needs-improvement'}} -->\n    <!--   %i.boundless-icon-arrow-down -->\n    <a class='flag-response flag-response-v_down' href='"+$e($c(location.origin))+$e($c(location.pathname))+"issues/new' rel='nofollow' data-track='Sisyphus:clicked_flag_down'>\n      <i class='boundless-icon-arrow-down'></i>\n    </a>\n  </span>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("create_assignment/views"),Boundless.CreateAssignment||(Boundless.CreateAssignment={}),$(function(){return $(document).on("click","a[data-popup=assign_lesson]",function(e){var $this,options,opts,position,properties,resource_type,wizzard_options;return e.preventDefault(),$this=$(e.currentTarget),$this.addClass("disabled"),(opts=$this.attr("data-json"))?(opts=JSON.parse(opts),opts.json_concept_reading_lesson=$this.data("jsonConceptReadingLesson"),opts.json_section_reading_lesson=$this.data("jsonSectionReadingLesson"),resource_type=function(){return $this.data("resource-type")||"quiz"},position=function(){return $this.data("position")||"unknown"},properties=$this.data("assign-lesson-track-properties-json")||{},_.defaults(properties,{registered:null!=session.current_user,first_time:null!=session.current_user&&!session.current_user.get_setting("created_assignment"),resource_type:resource_type(),text:$this.text().trim(),position:position()}),Boundless.Events.Feature.track("clicked_assign_resource",properties),wizzard_options={starting_without_session:null==session.current_user},null!=session.current_user?session.current_user.can_assign()?wizzard_options.sidebar_template=session.current_user.get_setting("created_assignment")?!1:"assign_"+(opts.activity||"quiz"):wizzard_options.sidebar_template=!1:(wizzard_options.sidebar_template="assign_"+(opts.activity||"quiz"),options={user_role:"educator",skip_role_selector:!1,conversion_event:!1},$this.data("popup")&&(options.trigger=$this.data("popup")),options.json_concept_reading_lesson=$this.data("jsonConceptReadingLesson"),options.json_section_reading_lesson=$this.data("jsonSectionReadingLesson"),this.register_controller=new Boundless.Register.RegisterController(options),this.register_controller.on("register:complete",function(_this){return function(){return _this.assignment_controller.startup(),wizzard.goto_step(2)}}(this))),this.assignment_controller=new Boundless.CreateAssignment.CreateAssignmentStepController(opts),this.assignment_controller.on("close",function(_this){return function(){return wizzard.hide()}}(this)),null!=session.current_user?wizzard_options.step_els=[this.assignment_controller.$el]:wizzard_options.step_els=[this.register_controller.$el,this.assignment_controller.$el],window.wizzard=new Boundless.WizzardController(wizzard_options),wizzard.on("hidden",function(_this){return function(){return $this.removeClass("disabled")}}(this)),window.wizzard.render()):void 0})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.ConfirmAssignmentController=function(superClass){function ConfirmAssignmentController(){return ConfirmAssignmentController.__super__.constructor.apply(this,arguments)}return extend(ConfirmAssignmentController,superClass),ConfirmAssignmentController.prototype.template="confirm_concept_assignment",ConfirmAssignmentController.prototype.events={"click .confirm_concept_assignment__action-btn":"confirmed_concept","click .section_assignment__action-btn":"confirmed_section"},ConfirmAssignmentController.prototype.helper_methods=["section_path"],ConfirmAssignmentController.prototype.initialize=function(opts){return this.section_path=opts.section_path,this.render()},ConfirmAssignmentController.prototype.confirmed_concept=function(e){return e.preventDefault(),Boundless.Events.Sneak.track("clicked_confirm_concept"),this.trigger("confirmed_concept")},ConfirmAssignmentController.prototype.confirmed_section=function(e){return e.preventDefault(),Boundless.Events.Sneak.track("clicked_confirm_section"),this.trigger("confirmed_section")},ConfirmAssignmentController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.CreateAssignmentController=function(superClass){function CreateAssignmentController(){return this.create_assignment=bind(this.create_assignment,this),CreateAssignmentController.__super__.constructor.apply(this,arguments)}return extend(CreateAssignmentController,superClass),CreateAssignmentController.prototype.template="create_assignment",CreateAssignmentController.prototype.events={"click .add-new-course":"on_click_new_course","click .course-dropdown-link":"on_course_selected","click .module-dropdown-link":"on_module_selected","submit #lessonassignment-form":"create_assignment"},CreateAssignmentController.prototype.helper_methods=["lesson_assignment","lesson_title","lesson_type","course","courses","brightspace_module","brightspace_modules","first_render"],CreateAssignmentController.prototype.initialize=function(options){return this.options=options,CreateAssignmentController.__super__.initialize.apply(this,arguments),this.lesson_fields={lesson_id:this.options.lesson_id,book_id:this.options.book_id,chapter_id:this.options.chapter_id,section_id:this.options.section_id,concept_id:this.options.concept_id,activity:this.options.activity||"quiz"},this.lesson_title=this.options.lesson_title,this.lesson_type=this.options.activity||"quiz",this.reading_type=null,"reading"===this.lesson_type&&(this.reading_type="chapter",this.options.section_id&&(this.reading_type="section"),this.options.concept_id&&(this.reading_type="concept")),this.courses=session.current_user.get("created_courses"),this.brightspace_modules=[],this.brightspace_module=null,this.create_new_course(),this.lesson_assignment=new Boundless.LessonAssignment({teacher_id:session.current_user.id}),this.courses.on_loaded({url:this.courses.url()+"/assignable"},function(_this){return function(){return _this.first_render=!0,_this.render(),_this.first_render=!1}}(this)),this},CreateAssignmentController.prototype.create_new_course=function(){var ref,ref1,u;return u=session.current_user,this.course=new Boundless.Course({subject_tag_id:this.options.subject_tag_id,school_id:(null!=(ref=u.get("school"))?ref.id:void 0)||u.get("school_id"),school_name:(null!=(ref1=u.get("school"))?ref1.get("name"):void 0)||u.get("school_name")})},CreateAssignmentController.prototype.on_course_selected=function(e){var $target,index,lms_id;return $target=$(e.currentTarget),index=$target.attr("data-index"),this.course=this.courses.at(index),(lms_id=$target.attr("data-external-tool-id"))?(this.course.set({subject_tag_id:this.options.subject_tag_id}),"desire2learn"===this.course.get("lms_provider")?(this.brightspace_modules=new Boundless.BrightspaceModuleCollection([],{course:this.course}),this.brightspace_modules.fetch({data:{host:this.course.get("lms_tool_consumer_host")},success:function(_this){return function(){return _this.render()}}(this)})):this.render()):this.render()},CreateAssignmentController.prototype.on_module_selected=function(evt){var $target,module_id;return $target=$(evt.currentTarget),(module_id=$target.attr("data-id"))?this.brightspace_module=this.brightspace_modules.get(parseInt(module_id)):this.brightspace_module=new Boundless.BrightspaceModule({id:"new",title:"New Module (Boundless)"}),this.render()},CreateAssignmentController.prototype.on_click_new_course=function(e){return this.create_new_course(),this.render()},CreateAssignmentController.prototype.create_assignment=function(e){var $form;return e.preventDefault(),$form=this.$("#lessonassignment-form"),this.lesson_assignment.set(_.extend($form.fields_for("lessonassignment"),{lesson_provider_attributes:this.lesson_fields})),this.course.set($form.fields_for("course")),$form.disable_form(),this.course.id?this.save_lesson_assignment():(this.course.isValid(),this.lesson_assignment.isValid({ignore_course_id:!0})&&this.course.isValid()?this.course.save({},{success:function(_this){return function(model,resp){return session.current_user.get("created_courses").add(_this.course),_this.trigger("educator:class_created",model),_this.save_lesson_assignment()}}(this),error:function(_this){return function(){return _this.render()}}(this)}):this.render()),!1},CreateAssignmentController.prototype.save_lesson_assignment=function(){return this.lesson_assignment.save({course_id:this.course.id},{success:function(_this){return function(model,resp){var opts;return _this.$(".book_assignment_errors").hide().text(""),opts={},"reading"===_this.lesson_type&&opts.reading_type===_this.reading_type,Boundless.Events.Feature.track("created_assignment",opts),_this.trigger("educator:assignment_created",_this.lesson_assignment)}}(this),error:function(_this){return function(model,response){return _this.render(),_this.$(".book_assignment_errors").show().text(response.errors.base.join(", ")),_this.lesson_assignment.errors.reset()}}(this)})},CreateAssignmentController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.CreateAssignmentStepController=function(superClass){function CreateAssignmentStepController(){return this.step_count=bind(this.step_count,this),CreateAssignmentStepController.__super__.constructor.apply(this,arguments)}return extend(CreateAssignmentStepController,superClass),CreateAssignmentStepController.prototype.template="create_assignment_layout",CreateAssignmentStepController.prototype.id="create-assignment__wrapper",CreateAssignmentStepController.prototype.helper_methods=["user","step_count"],CreateAssignmentStepController.prototype.initialize=function(params){return null==params&&(params={}),CreateAssignmentStepController.__super__.initialize.apply(this,arguments),this.params=params,this.lesson_options=params,this.class_is_new=!1,this.startup(),this},CreateAssignmentStepController.prototype.startup=function(){var assignable_courses,course_params,ref;return this.user=session.current_user,this.render(),(null!=(ref=this.user)?ref.can_assign():void 0)?(assignable_courses=session.current_user.get("created_courses"),course_params={url:assignable_courses.url()+"/assignable",error:function(_this){return function(collection,response,options){return _this.go_to("error-concept-assignment")}}(this)},assignable_courses.on_loaded(course_params,function(_this){return function(){return null!=_this.lesson_options.concept_id?_this.go_to("confirm-concept-assignment"):_this.go_to("create-assignment")}}(this))):null!=this.user?this.go_to("student-redirect"):void 0},CreateAssignmentStepController.prototype.step_count=function(){var ref;return(null!=(ref=this.user)?ref.can_assign():void 0)?null!=this.lesson_options.concept_id?3:2:null!=this.user?1:void 0},CreateAssignmentStepController.prototype.go_to=function(step){var controller,el;switch(step){case"student-redirect":return controller=new Boundless.CreateAssignment.StudentRedirectController(_.extend({},this.lesson_options,{el:this.$(".create-assignment__step-one")})),controller.on("close",function(_this){return function(){return _this.trigger("close")}}(this));case"error-concept-assignment":return controller=new Boundless.CreateAssignment.ErrorAssignmentController({el:this.$(".create-assignment__step-one")});case"confirm-concept-assignment":return Boundless.Events.Sneak.track("viewed_confirm_concept_assignment_dialog",{calling_controller:"CreateAssignmentStepController"}),controller=new Boundless.CreateAssignment.ConfirmAssignmentController(_.extend({},this.lesson_options,{el:this.$(".create-assignment__step-one")})),controller.on("confirmed_concept",function(_this){return function(){return _this.lesson_options=_this.params.json_concept_reading_lesson,_this.go_to("create-assignment")}}(this)),controller.on("confirmed_section",function(_this){return function(){return _this.lesson_options=_this.params.json_section_reading_lesson,_this.go_to("create-assignment")}}(this));case"create-assignment":if(el=2===this.step_count()?".create-assignment__step-one":".create-assignment__step-two",controller=new Boundless.CreateAssignment.CreateAssignmentController(_.extend({},this.lesson_options,{el:this.$(el)})),controller.on("educator:class_created",function(_this){return function(course){return _this.class_is_new=!0}}(this)),controller.on("educator:assignment_created",function(_this){return function(lesson_assignment){var course_id;return _this.lesson_assignment=lesson_assignment,course_id=lesson_assignment.get("course_id"),_this.user.get("created_courses").get(course_id).is_lms()?_this.go_to("lms-assignment-created"):_this.go_to("share-assignment")}}(this)),3===this.step_count())return this.$(".create-assignment__cont").attr("data-current-step",2);break;case"share-assignment":return controller=new Boundless.CreateAssignment.ShareAssignmentController({el:2===this.step_count()?this.$(".create-assignment__step-two"):this.$(".create-assignment__step-three"),lesson_assignment:this.lesson_assignment,class_is_new:this.class_is_new,lesson_type:this.lesson_options.activity||"quiz",lesson_title:this.lesson_options.lesson_title}),this.$(".create-assignment__cont").attr("data-current-step",this.step_count()),controller.on("close",function(_this){return function(){return _this.trigger("close")}}(this));case"lms-assignment-created":return controller=new Boundless.CreateAssignment.LmsAssignmentConfirmationController({el:2===this.step_count()?this.$(".create-assignment__step-two"):this.$(".create-assignment__step-three"),lms_name:this.user.get("created_courses").get(this.lesson_assignment.get("course_id")).lms_name()}),this.$(".create-assignment__cont").attr("data-current-step",this.step_count()),controller.on("close",function(_this){return function(){return _this.trigger("close")}}(this))}},CreateAssignmentStepController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.ErrorAssignmentController=function(superClass){function ErrorAssignmentController(){return ErrorAssignmentController.__super__.constructor.apply(this,arguments)}return extend(ErrorAssignmentController,superClass),ErrorAssignmentController.prototype.template="error_concept_assignment",ErrorAssignmentController.prototype.initialize=function(opts){return this.render()},ErrorAssignmentController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.LmsAssignmentConfirmationController=function(superClass){function LmsAssignmentConfirmationController(){return LmsAssignmentConfirmationController.__super__.constructor.apply(this,arguments)}return extend(LmsAssignmentConfirmationController,superClass),LmsAssignmentConfirmationController.prototype.helper_methods=["lms_name"],LmsAssignmentConfirmationController.prototype.template="lms_assignment_confirmation",LmsAssignmentConfirmationController.prototype.events={"click .js__ok":"clicked_ok"},LmsAssignmentConfirmationController.prototype.initialize=function(params){return this.lms_name=params.lms_name,this.render()},LmsAssignmentConfirmationController.prototype.clicked_ok=function(){return this.trigger("close")},LmsAssignmentConfirmationController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.ShareAssignmentController=function(superClass){function ShareAssignmentController(){return ShareAssignmentController.__super__.constructor.apply(this,arguments)}return extend(ShareAssignmentController,superClass),ShareAssignmentController.prototype.template="share_assignment",ShareAssignmentController.prototype.events={"click .create-assignment__dismiss-button":"dismiss_clicked","click .test__go-to-class-button":"go_to_class_clicked"},ShareAssignmentController.prototype.helper_methods=["course","lesson_assignment","lesson_type","lesson_title","due_date"],ShareAssignmentController.prototype.initialize=function(options){return ShareAssignmentController.__super__.initialize.apply(this,arguments),
this.lesson_assignment=options.lesson_assignment,this.due_date=moment(this.lesson_assignment.get("due_date")),this.lesson_type=options.lesson_type,this.lesson_title=options.lesson_title,this.class_is_new=options.class_is_new,this.class_is_new||(this.template="assignment_created"),this.course=session.current_user.get("created_courses").get(this.lesson_assignment.get("course_id")),this.render(),this.link_button=this.$(".create-assignment__share-copy-link"),this.clip=new Clipboard(".create-assignment__share-copy-link"),this.clip.on("error",function(_this){return function(e){var text;return text=e.trigger.dataset.clipboardText,window.prompt("Copy to clipboard: \u2318+C, Enter",text)}}(this)),this.clip.on("success",function(_this){return function(e){return _this.link_button_clicked(),e.clearSelection()}}(this)),this},ShareAssignmentController.prototype.dismiss_clicked=function(e){return e.preventDefault(),this.trigger("close")},ShareAssignmentController.prototype.link_button_clicked=function(){return this.link_button.attr("disabled","disabled"),this.link_button.html("Copied!"),Boundless.Events.Feature.track("copied_course_link")},ShareAssignmentController.prototype.go_to_class_clicked=function(){return Boundless.Events.Sneak.track("clicked_go_to_class")},ShareAssignmentController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAssignment.StudentRedirectController=function(superClass){function StudentRedirectController(){return StudentRedirectController.__super__.constructor.apply(this,arguments)}return extend(StudentRedirectController,superClass),StudentRedirectController.prototype.template="student_redirect",StudentRedirectController.prototype.events={"click .create-assignment__close-button":"close_clicked"},StudentRedirectController.prototype.helper_methods=["lesson_id","lesson_type"],StudentRedirectController.prototype.initialize=function(options){return StudentRedirectController.__super__.initialize.apply(this,arguments),this.lesson_id=options.lesson_id,this.lesson_type=options.lesson_type,this.render(),this},StudentRedirectController.prototype.close_clicked=function(e){return this.trigger("close")},StudentRedirectController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/assignment_created"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-assignment__share-wrapper wizzard__nested-form-cont'>\n  <div class='bcp-lesson-assignment__notification-sent'>\n    <i class='boundless-icon-bell'></i>\n    <p>Students in <em>"+this.course.get("name")+"</em> will now see this assignment in their accounts.</p>\n  </div>\n  <div class='bcp-lesson-assignment__cont'>\n    <div class='create-assignment__assignment-tile'>\n      <div class='due-date'>\n        <div class='due'>Due</div>\n        <div class='day'>"+$c(this.due_date.format("DD"))+"</div>\n        <div class='month'>"+$c(this.due_date.format("MMMM"))+"</div>\n      </div>\n      <div class='lesson-type'>First "+this.lesson_type+" assignment</div>\n      <div class='lesson-name'>"+$c(this.lesson_title)+"</div>\n      <div class='due-date--basic'>\n        <span class='due'>Due</span>\n        <span class='month'>"+$c(this.due_date.format("MMMM"))+"</span>\n        <span class='day'>"+$c(this.due_date.format("DD"))+"</span>\n      </div>\n    </div>\n    <a class='btn btn-block btn-large test__go-to-class-button' href='"+$e($c(Boundless.LearningRoutes.teaching_course_url(this.lesson_assignment.get("course_id"))))+"'>\n      Go to your class page\n      <i class='icon-angle-right'></i>\n    </a>\n  </div>\n</div>\n<a class='close-and-continue-browsing create-assignment__dismiss-button'>\n  <i class='icon-remove'></i>\n  Close and continue browsing resources\n</a>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/confirm_concept_assignment"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='confirm_concept_assignment'>\n  <div class='confirm_concept_assignment__header'>\n    This concept reading is part of a larger section of readings:\n  </div>\n  <div class='confirm_concept_assignment__list-header'>"),$o.push("    "+$c("Section "+(PageData.concept_data.section_index+1)+": "+PageData.concept_data.section_title)),$o.push("  </div>\n  <ul class='confirm_concept_assignment__sections-list'>"),_.each(PageData.concept_data.section_concepts,function(_this){return function(c){return $o.push("    <li class='"+["confirm_concept_assignment__sections-list-item",""+$e($c(c.atom_id===PageData.concept_data.atom_id?"active":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"+$c(c.concept_title)+"</li>"),""}}(this)),$o.push("  </ul>\n  <a class='btn btn-block btn-green btn-large confirm_concept_assignment__action-btn confirm_concept_assignment__btn'>\n    <i class='icon-calendar-empty'></i>\n    Assign just this reading\n  </a>\n  <div class='confirm_concept_assignment__or'>\n    <span>\n      or\n    </span>\n  </div>\n  <a class='btn btn-block confirm_concept_assignment__btn section_assignment__action-btn'>\n    <i class='icon-calendar-empty'></i>\n    Assign entire section\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/create_assignment"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push(""+$c(this.form_for(this.lesson_assignment,function(_this){return function(form){var $o1,brightspace_module,i,len,ref,ref1,ref2;if($o1=[],$o1.push("<div class='bcp-lesson-assignment__cont'>\n  <div class='bcp-lesson-assignment__header'>\n    <div class='lesson-type'>"+_this.lesson_type.capitalize()+" assignment</div>\n    <div class='lesson-title'>"+$c(_this.lesson_title)+"</div>\n  </div>\n  <div class='bcp-form bcp-lesson-assignment__form'>"),_this.courses.length&&($o1.push("    <div class='bcp-lesson-assignment__course-selector btn-group'>\n      <a class='bcp-lesson-assignment__course-selector__button btn dropdown-toggle' data-toggle='dropdown'>\n        <span class='lms_book_assigner__course-selector__name'>"+$c(_this.course.get("name")||"Which class is this assignment for?")+"</span>"),_this.course.is_lms()&&($o1.push("        <label class='dropdown-link__lms-label'>\n          <i class='boundless-icon-"+_this.course.lms_icon_name()+"'></i>"),$o1.push("          "+$c(_this.course.lms_name())),$o1.push("        </label>")),$o1.push("        <i class='icon-caret-down'></i>\n      </a>\n      <ul class='bcp-lesson-assignment__course-list dropdown dropdown-menu'>"),_this.courses.each(function(course,index){return $o1.push("        <li>\n          <a class='course-dropdown-link' data-id='"+$e($c(course.id))+"' data-index='"+$e($c(index))+"' data-external-tool-id='"+$e($c(course.get("external_tool_id")))+"' data-remote-user-id='"+$e($c(course.get("remote_user_id")))+"'>\n            <span class='lms_book_assigner__course-selector__name'>"+$c(course.get("name"))+"</span>"),course.is_lms()&&($o1.push("            <label class='dropdown-link__lms-label'>\n              <i class='boundless-icon-"+course.lms_icon_name()+"'></i>"),$o1.push("              "+$c(course.lms_name())),$o1.push("            </label>")),$o1.push("          </a>\n        </li>"),""}),$o1.push("        <li>\n          <a class='add-new-course bcp-lesson-assignment__add-class__link'>\n            <i class='icon-plus'></i>\n            New Class\n          </a>\n        </li>\n      </ul>\n    </div>"),"desire2learn"===(null!=(ref=_this.course)?ref.get("lms_provider"):void 0))){for($o1.push("    <label>Which content module would you like to place this assignment in?</label>\n    <div class='btn-group lms_book_assigner__course-selector'>\n      <a class='btn dropdown-toggle lms_book_assigner__course-selector__button' data-toggle='dropdown'>"),$o1.push("        "+$c((null!=(ref1=_this.brightspace_module)?ref1.get("title"):void 0)||"Select a module...")),$o1.push("        <i class='icon-caret-down'></i>\n      </a>\n      <ul class='dropdown dropdown-menu lms_book_assigner__course-list'>"),ref2=_this.brightspace_modules.models,i=0,len=ref2.length;len>i;i++)brightspace_module=ref2[i],$o1.push("        <li>\n          <a class='dropdown-link module-dropdown-link' data-id='"+$e($c(brightspace_module.id))+"'>"),$o1.push("            "+$c(brightspace_module.get("title"))),$o1.push("          </a>\n        </li>");$o1.push("        <li>\n          <a class='dropdown-link module-dropdown-link'>\n            New Module (Boundless)\n          </a>\n        </li>\n      </ul>\n    </div>")}return $o1.push("    "+$c(form.input("course_id",{as:"hidden",value:_this.course.id,liveValidate:!1}))),$o1.push("    "+$c(form.input("remote_user_id",{as:"hidden",value:_this.course.get("remote-user-id"),liveValidate:!1}))),_this.brightspace_module&&$o1.push("    "+$c(form.input("brightspace_module_id",{as:"hidden",value:_this.brightspace_module.id,liveValidate:!1}))),$o1.push("    "+$c(form.errorFor("course_id"))),_this.first_render&&0!==_this.courses.length||_this.course.id||($o1.push("    <div class='bcp-lesson-assignment__add-class__form'>\n      <h3 class='bcp-lesson-assignment__add-class__form-title'>"),_this.course.is_lms()?$o1.push("        Class Information"):$o1.push("        New Class Information"),$o1.push("      </h3>"),$o1.push("      "+$c(_this.fields_for(_this.course,function(course_fields){var $o2;return $o2=[],$o2.push("      "+$c(course_fields.input("subject_tag_id",{as:"select",label:"Subject area",collection:_.map(PageData.subjects,function(subj){return[subj.id,subj.name]})}))),$o2.push("      "+$c(course_fields.input("school_id",{input_class:"course_school_input",label:!1,as:"school",liveValidate:!1,placeholder:"College or University Name",disabled:_this.course.is_lms()}))),$o2.push("      "+$c(course_fields.input("name",{input_class:"course_name_input",as:"string",label:!1,liveValidate:!1,placeholder:"Class name (e.g. Bio 101)",disabled:_this.course.is_lms()}))),$o2.join("\n")}))),$o1.push("    </div>")),$o1.push("    "+$c(form.input("due_date",{label:"When is the assignment due?",input_class:"bcp-assignment__due-date",as:"date",liveValidate:!1,placeholder:"MM/DD/YYYY",date_format:"mm/dd/yyyy"}))),$o1.push("  </div>\n</div>\n<div class='book_assignment_errors modal__error'></div>"),$o1.push(""+$c(form.action("submit",{as:"button",action_class:"btn btn-large btn-block btn-green",label:"Assign"}))),$o1.join("\n")}}(this)))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/create_assignment_layout"]=function(context){return function(){var $c,$e,$o,ref,ref1;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-assignment__cont steps__cont' data-step-count='"+$e($c(this.step_count()))+"' data-current-step='"+$e($c(1))+"'>\n  <div class='steps__indicator-cont'>\n    <div class='create-assignment__steps-indicator-cont'>"),(null!=(ref=this.user)?ref.can_assign():void 0)?($o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Step 1</div>\n      </div>\n      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Step 2</div>\n      </div>"),3===this.step_count()&&$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Step 3</div>\n      </div>")):$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Assign</div>\n      </div>"),$o.push("    </div>\n  </div>\n  <div class='steps__inner-cont'>\n    <div class='create-assignment__step-one steps__step'></div>"),(null!=(ref1=this.user)?ref1.can_assign():void 0)&&(2===this.step_count()?$o.push("    <div class='create-assignment__step-two steps__step'></div>"):$o.push("    <div class='create-assignment__step-two steps__step'></div>\n    <div class='create-assignment__step-three steps__step'></div>")),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/error_concept_assignment"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='confirm_concept_assignment'>\n  <div class='confirm_concept_assignment__header' role='alert'>\n    <h2>\n      There was an error getting your courses\n    </h2>\n    <p>\n      Please retry or contact\n      <a href='mailto:support@boundless.com'>support@boundless.com</a>\n    </p>\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/lms_assignment_confirmation"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='canvas__lesson-assigned center'>\n  <i class='boundless-icon-checkmark'></i>\n  <p>This assignment has been added to your class on "+this.lms_name+". Your students will now be able to see it in their assignments list.</p>\n  <a class='btn btn-block btn-green btn-large js__ok'>Okay, thanks</a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/share_assignment"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-assignment__share-wrapper wizzard__nested-form-cont'>\n  <div class='bcp-lesson-assignment__cont'>\n    <h3 class='test__class-created'>Your class <em>"+this.course.get("name")+"</em> has been created!</h3>\n    <p>Share the link below with your students so they can sign up and start their first assignment.</p>\n    <div class='clearfix'>\n      <input class='create-assignment__share-link-input' type='text' value='"+$e($c(Boundless.HOST_DOMAIN))+"/"+$e($c(this.course.get("code")))+"'>\n      <a class='btn btn-block btn-green btn-large create-assignment__share-copy-link' data-clipboard-text='"+$e($c(Boundless.HOST_DOMAIN))+"/"+$e($c(this.course.get("code")))+"'>Copy</a>\n    </div>\n    <div class='bcp-lesson-assignment__cont-bottom'>\n      <div class='create-assignment__assignment-tile'>\n        <div class='due-date'>\n          <div class='due'>Due</div>\n          <div class='day'>"+$c(this.due_date.format("DD"))+"</div>\n          <div class='month'>"+$c(this.due_date.format("MMMM"))+"</div>\n        </div>\n        <div class='lesson-type'>"+this.lesson_type.capitalize()+" assignment</div>\n        <div class='lesson-name'>"+$c(this.lesson_title)+"</div>\n        <div class='due-date--basic'>\n          <span class='due'>Due</span>\n          <span class='month'>"+$c(this.due_date.format("MMMM"))+"</span>\n          <span class='day'>"+$c(this.due_date.format("DD"))+"</span>\n        </div>\n      </div>\n    </div>\n  </div>\n  <a class='btn btn-block btn-large test__go-to-class-button' href='"+$e($c(Boundless.LearningRoutes.teaching_course_url(this.lesson_assignment.get("course_id"))))+"'>\n    Go to your new class page\n    <i class='icon-angle-right'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_assignment/views/student_redirect"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-assignment__student-redirect-cont'>\n  <p>\n    Oops! It looks like you're a student. Students shouldn't really\n    <strong>assign</strong>"),$o.push("    "+$c("quiz"===this.lesson_type?"quizzes; ":"readings; ")),$o.push("    however, they can\n    <strong>"+$c("quiz"===this.lesson_type?"take":"read")+"</strong>\n    them."),"quiz"===this.lesson_type?$o.push("    Test your knowledge and try taking the quiz!"):$o.push("    Read and learn by opening the reading in the Boundless reader!"),$o.push("  </p>\n  <a class='btn btn-block btn-large btn-primary create-assignment__learn-button' href='/reader/lessons/"+$e($c(this.lesson_id))+"' data-reader-frame='true'>"),"quiz"===this.lesson_type?$o.push("    Take the quiz"):$o.push("    Read now"),$o.push("  </a>\n  <a class='create-assignment__close-button'>\n    Close\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("create_atom/views"),Boundless.CreateAtom||(Boundless.CreateAtom={}),Boundless.CreateAtom.App=function(){function App(opts){null==opts&&(opts={}),this.controller=new Boundless.CreateAtom.Controller(opts),this.controller.on("atom_created",function(_this){return function(atom){return"function"==typeof _this.on_complete?_this.on_complete(atom):void 0}}(this))}return App}(),Boundless.CreateAtom.trigger=function(opts){var $wrapper,app,popup;return null==opts&&(opts={}),$wrapper=$("<div id='create-atom-modal'></div>"),popup=new Boundless.Modal($wrapper,500),popup.on_hide(function(_this){return function(){var app;return app=null}}(this)),app=new Boundless.CreateAtom.App({el:$wrapper}),app.on_complete=function(_this){return function(atom){return"function"==typeof opts.on_complete&&opts.on_complete(atom),popup.hide()}}(this),popup.show()}}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateAtom.Controller=function(superClass){function Controller(){return Controller.__super__.constructor.apply(this,arguments)}return extend(Controller,superClass),Controller.prototype.template="create_atom",Controller.prototype.events={"click .js__create-new-atom":"clicked_create_new_atom"},Controller.prototype.helper_methods=["atom","active_subject_id","atom_templates"],Controller.prototype.initialize=function(opts){return Controller.__super__.initialize.apply(this,arguments),this.active_subject_id=window.editor.book.get("subject_tag_id"),this.atom_templates=window.editor.atom_templates,this.atom=new Boundless.Atom({subject_tag_id:this.active_subject_id}),this.render(),this},Controller.prototype.clicked_create_new_atom=function(evt){var $form,fields;return evt.preventDefault(),$form=this.$("#atom-form"),fields=$form.fields_for("atom"),this.atom.save(fields,{success:function(_this){return function(model,response){return _this.trigger("atom_created",model)}}(this),error:function(_this){return function(model,response){return _this.render()}}(this)})},Controller}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_atom/views/create_atom"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__inner-header'>\n  Create Atom\n</div>\n<div class='modal__inner-body'>"),$o.push("  "+$c(this.form_for(this.atom,{"class":"bcp-form"},function(_this){return function(f){var $o1;return $o1=[],$o1.push("  "+$c(f.input("title",{label:"Enter a atom title",input_class:"atom_title_input",as:"string",liveValidate:!0,placeholder:"Enter an Atom title",allow_blank:!1}))),$o1.push("  "+$c(f.input("subject_tag_id",{as:"select",label:"Subject area",collection:_.map(PageData.subjects,function(subj){return[subj.id,subj.name]}),value:""+(_this.active_subject_id||(_this.active_subject_id=null))}))),$o1.push("  "+$c(f.input("access",{as:"toggle",label:"Make this concept",collection:{"public":"public","private":"private"},value:"public",input_class:"check-toggle"}))),$o1.push("  "+$c(f.input("template",{as:"toggle",label:"Template Type",collection:_this.atom_templates,value:Object.keys(_this.atom_templates)[0],input_class:"check-toggle"}))),$o1.push("  "+$c(f.action("submit",{as:"button",action_class:"btn js__create-new-atom btn-small btn-block btn-green",label:"Create Atom"}))),$o1.join("\n")}}(this)))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("create_book_assignment/views"),Boundless.CreateBookAssignment||(Boundless.CreateBookAssignment={}),Boundless.CreateBookAssignment.App=function(){function App(el,options){null!=session.current_user&&(this.assignment_controller=new Boundless.CreateBookAssignmentController(_.extend(options,{el:el}))),this.assignment_controller.on("educator:assignment_created",function(_this){return function(){return"function"==typeof _this.on_complete?_this.on_complete():void 0}}(this))}return App}(),Boundless.CreateBookAssignment.bind_elements=function(){return $("a[data-popup=assign_lesson_from_book]").click(function(evt){var opts;return evt.preventDefault(),(opts=$(evt.currentTarget).attr("data-json"))?(opts=JSON.parse(opts),Boundless.CreateBookAssignment.trigger(opts)):void 0})},Boundless.CreateBookAssignment.trigger=function(opts){var $wrapper,app,popup;return $wrapper=$("<div id='create-assignment-from-book-wrapper'></div>"),popup=new Boundless.Modal($wrapper,500),popup.on_hide(function(_this){return function(){var app;return app=null}}(this)),app=new Boundless.CreateBookAssignment.App($wrapper,opts),app.on_complete=function(_this){return function(){return opts.on_complete&&opts.on_complete(),popup.hide()}}(this),popup.show()}}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CreateBookAssignmentController=function(superClass){function CreateBookAssignmentController(){return CreateBookAssignmentController.__super__.constructor.apply(this,arguments)}return extend(CreateBookAssignmentController,superClass),CreateBookAssignmentController.prototype.template="create_book_assignment",CreateBookAssignmentController.prototype.events={"click .js__submit-assignment-form":"on_submit"},CreateBookAssignmentController.prototype.helper_methods=["lesson_assignment","assignment_types","chapters","brightspace_modules"],CreateBookAssignmentController.prototype.assignment_types={reading:"Reading",quiz:"Quiz"},CreateBookAssignmentController.prototype.initialize=function(options){var assignable_courses;return CreateBookAssignmentController.__super__.initialize.apply(this,arguments),assignable_courses=session.current_user.get("created_courses"),assignable_courses.on_loaded({url:assignable_courses.url()+"/assignable"},function(_this){return function(){return _this.course=assignable_courses.get(options.course_id),_this.startup(options)}}(this)),this},CreateBookAssignmentController.prototype.startup=function(options){var brightspace_modules,ch,i,index,len,ref;for(this.brightspace_modules=[],("Brightspace"===this.course.lms_name()||"desire2learn"===this.course.get("lms_provider"))&&(brightspace_modules=new Boundless.BrightspaceModuleCollection([],{course:this.course}),brightspace_modules.fetch({data:{host:this.course.get("lms_tool_consumer_host")},success:function(_this){return function(){return brightspace_modules.each(function(model){return _this.brightspace_modules.push([model.id,model.get("title")])}),_this.brightspace_modules.push(["new","New Module (Boundless)"]),_this.render()}}(this)})),this.chapters=[],ref=options.chapters,index=i=0,len=ref.length;len>i;index=++i)ch=ref[index],this.chapters.push([ch.unique_id,"Chapter "+(index+1)+" - "+ch.title]);return this.lesson_assignment=new Boundless.LessonAssignment({teacher_id:session.current_user.id,course_id:options.course_id,book_id:options.book_id}),_.isUndefined(options.auto_redirect)?this.auto_redirect=!0:this.auto_redirect=options.auto_redirect,this.render()},CreateBookAssignmentController.prototype.render=function(){var $dates;return CreateBookAssignmentController.__super__.render.apply(this,arguments),$dates=this.$(".bcp-assignment__due-date").pickadate({format:"mm/dd/yyyy",formatSubmit:"mm/dd/yyyy"}),Modernizr.ismobile&&$dates.pickadate("picker").on("open",function(){return $(".sheet-curtain").scrollTo(".picker__input--active")}),this},CreateBookAssignmentController.prototype.on_submit=function(e){var $form,fields,lesson_provider_attributes;return null!=e&&e.preventDefault(),$form=this.$("#lessonassignment-form"),fields=$form.fields_for("lessonassignment"),this.$("#lessonassignment-form").disable_form(),lesson_provider_attributes=_.pick(fields,"chapter_id","activity","book_id"),this.lesson_assignment.set({chapter_id:null,activity:null,book_id:null,due_date:fields.due_date,brightspace_module_id:fields.brightspace_module_id,lesson_provider_attributes:lesson_provider_attributes}),this.lesson_assignment.errors.reset(),this.lesson_assignment.save({},{success:function(_this){return function(model,response){return _this.$(".book_assignment_errors").hide().text(""),Boundless.Events.AssignFunnel.track("created_assignment"),_this.trigger("educator:assignment_created"),_this.auto_redirect?window.location=Boundless.LearningRoutes.teaching_lesson_assignment_url(model.get("course_id"),model.id):void 0}}(this),error:function(_this){return function(model,response){return _this.lesson_assignment.set(lesson_provider_attributes),_this.render(),_this.$(".book_assignment_errors").show().text(response.error)}}(this)})},CreateBookAssignmentController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["create_book_assignment/views/create_book_assignment"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='modal__inner-header'>\n  <h2>Create an Assignment</h2>\n</div>\n<div class='modal__inner-body'>"),$o.push("  "+$c(this.form_for(this.lesson_assignment,{"class":"bcp-form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("  <div style='margin-bottom: 1em;'>"),$o1.push("    "+$c(form.input("due_date",{label:"When is the assignment due?",input_class:"bcp-assignment__due-date",as:"string",liveValidate:"false",placeholder:"MM/DD/YYYY"}))),$o1.push("  </div>"),$o1.push("  "+$c(form.input("chapter_id",{input_class:"assignment_title_input",label:"Chapter",as:"select",liveValidate:!1,placeholder:"Select a chapter to assign",collection:_this.chapters}))),$o1.push("  "+$c(form.input("activity",{input_class:"assignment_type_input",label:"Type",as:"select",liveValidate:!1,placeholder:"",collection:_this.assignment_types}))),_this.brightspace_modules.length&&$o1.push("  "+$c(form.input("brightspace_module_id",{input_class:"assignment_module_input",label:"Content Module",as:"select",liveValidate:!1,placeholder:"Select a content module for this assignment",collection:_this.brightspace_modules}))),$o1.push("  "+$c(form.input("book_id",{as:"hidden"}))),$o1.join("\n")}}(this)))),$o.push("  <div class='book_assignment_errors modal__error'></div>\n  <a class='btn btn-block btn-green btn-large js__submit-assignment-form'>Create Assignment</a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("course_editor/views"),Boundless.append_view_path("reader/views"),Boundless.CourseEditor||(Boundless.CourseEditor={}),Boundless.CourseEditor.App=function(){function App(options){var assignable_courses;null==options&&(options={}),window.course_editor=this,this.course=null,options.course_id?(assignable_courses=session.current_user.get("created_courses"),assignable_courses.on_loaded({url:assignable_courses.url()+"/assignable"},function(_this){return function(){return _this.course=assignable_courses.get(options.course_id),_this.render_wizard(options)}}(this))):this.render_wizard(options)}return App.prototype.render_wizard=function(options){var wizzard_options;return this.course&&this.course.current_user_can_edit()?this.steps_controller=new Boundless.CourseEditor.CourseEditorStepsController({course_id:this.course.id}):this.steps_controller=new Boundless.CourseEditor.CourseEditorStepsController(options),wizzard_options={starting_without_session:null==session.current_user,sidebar_provider:this.steps_controller.summary_view,max_width:615},session.logged_in()?wizzard_options.step_els=[this.steps_controller.$el]:(this.register_success=!1,window.register_controller=new Boundless.Register.RegisterController({user_role:"educator",skip_role_selector:!0,conversion_event:!1}),wizzard_options.step_els=[window.register_controller.$el,this.steps_controller.$el],window.register_controller.on("register:complete",function(_this){return function(user){return _this.register_success=!0,window.course_editor.steps_controller.render(),window.wizzard.goto_step(2)}}(this))),window.wizzard=new Boundless.WizzardController(wizzard_options),window.wizzard.render()},App.prototype.on_complete=function(callback){return this.complete_callback=callback},App.prototype.on_complete_edit=function(callback){return this.complete_edit_callback=callback},App}(),$(function(){return window.$body||(window.$body=$("body")),$body.off("click","a[data-popup=course_editor]").on("click","a[data-popup=course_editor]",function(e){var options;return e.preventDefault(),options=$(e.currentTarget).attr("data-json"),options=options?JSON.parse(options):{},this.course_editor_app=new Boundless.CourseEditor.App(options),Boundless.Events.Educators.track("clicked_add_class")})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CourseEditor.AddBookController=function(superClass){function AddBookController(){return AddBookController.__super__.constructor.apply(this,arguments)}return extend(AddBookController,superClass),AddBookController.prototype.template="course_editor_add_book",AddBookController.prototype.events={"click .course-editor__add-book-assign-btn":"assign_purchased_title","click .course-editor__add-other-book-btn":"add_other_book","click .course-editor__create-class-without-book":"create_class_no_book"},AddBookController.prototype.initialize=function(){return AddBookController.__super__.initialize.apply(this,arguments),this.render()},AddBookController.prototype.assign_purchased_title=function(e){return e.preventDefault(),Boundless.Events.Educators.track("clicked_add_book",{create_course_add_book_cta:"assign_book"}),events.trigger("course_editor:create_course",$(e.currentTarget).data().json)},AddBookController.prototype.add_other_book=function(e){return e.preventDefault(),Boundless.Events.Educators.track("clicked_add_book",{create_course_add_book_cta:"new_book"}),window.location.href=window.location.origin+"/subjects"},AddBookController.prototype.create_class_no_book=function(e){return Boundless.Events.Educators.track("clicked_add_book",{create_course_add_book_cta:"no_book"}),events.trigger("course_editor:create_course")},AddBookController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);
return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CourseEditor.AddStudentsController=function(superClass){function AddStudentsController(){return AddStudentsController.__super__.constructor.apply(this,arguments)}return extend(AddStudentsController,superClass),AddStudentsController.prototype.template="course_editor_add_students",AddStudentsController.prototype.events={"click .add-students-link__button":"link_button_clicked"},AddStudentsController.prototype.helper_methods=["course"],AddStudentsController.prototype.initialize=function(options){return null==options&&(options={}),this.course=null!=options.course_id?session.current_user.get("created_courses").get(options.course_id):null,Boundless.Events.Educators.track("clicked_create_class"),this.render()},AddStudentsController.prototype.render=function(){return AddStudentsController.__super__.render.apply(this,arguments),this.link_button=this.$(".add-students-link__button"),this.clip=new Clipboard(".add-students-link__button"),this.clip.on("error",function(_this){return function(e){var text;return text=e.trigger.dataset.clipboardText,window.prompt("Copy to clipboard: \u2318+C, Enter",text)}}(this)),this.clip.on("success",function(_this){return function(e){return _this.link_button_clicked(),e.clearSelection()}}(this)),this},AddStudentsController.prototype.link_button_clicked=function(){return this.link_button.attr("disabled","disabled"),this.link_button.html("Copied!"),Boundless.Events.Feature.track("copied_course_link")},AddStudentsController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CourseEditor.ClassNameController=function(superClass){function ClassNameController(){return ClassNameController.__super__.constructor.apply(this,arguments)}return extend(ClassNameController,superClass),ClassNameController.prototype.template="course_editor_class_name",ClassNameController.prototype.events={"submit #course-form":"on_submit_course_form","click .archive-course-btn":"on_click_archive_course"},ClassNameController.prototype.helper_methods=["course","editing_course","active_subject_id"],ClassNameController.prototype.initialize=function(options){return null==options&&(options={}),ClassNameController.__super__.initialize.apply(this,arguments),this.book_id=options.book_id?options.book_id:null,this.editing_course=options.course_id?options.course_id:null,this.active_subject_id=null!=options.active_subject_id?options.active_subject_id:null,this.course=this.editing_course?session.current_user.get("created_courses").get(options.course_id):new Boundless.Course({book_id:this.book_id}),Boundless.Events.Educators.track("viewed_class_name"),setTimeout(function(_this){return function(){return _this.render()}}(this),10)},ClassNameController.prototype.set_course_attributes=function(){return this.course.set(this.$("#course-form").fields_for("course")),this.course.set("school_name",this.$(".course_school_input").val())},ClassNameController.prototype.on_submit_course_form=function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this.set_course_attributes(),$("#course-form").disable_form(),this.course.errors.reset(),this.course.save({},{success:function(_this){return function(model,response){return _this.course_save_success()}}(this),error:function(_this){return function(model,response){return $("#course-form").enable_form(),_this.render()}}(this)})},ClassNameController.prototype.course_save_success=function(){return session.current_user.get("created_courses").add(this.course),events.trigger("course_editor:created_course",this.course),wiselinks.reload()},ClassNameController.prototype.on_click_archive_course=function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this.course.archive({success:function(_this){return function(){return _this.trigger("educator:course_edited"),"undefined"!=typeof wiselinks&&null!==wiselinks?wiselinks.reload():window.location=window.location.href,events.trigger("course_editor:hide")}}(this),error:function(_this){return function(){return _this.render()}}(this)})},ClassNameController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CourseEditorController=function(superClass){function CourseEditorController(){return CourseEditorController.__super__.constructor.apply(this,arguments)}return extend(CourseEditorController,superClass),CourseEditorController.prototype.template="course_editor_form",CourseEditorController.prototype.events={"submit #course-form":"on_submit_course_form","click .archive-course-btn":"on_click_archive_course"},CourseEditorController.prototype.helper_methods=["course","editing_course"],CourseEditorController.prototype.initialize=function(options){return CourseEditorController.__super__.initialize.apply(this,arguments),this.editing_course=null!=options.course_id,this.course=session.current_user.get("created_courses").get(options.course_id)||new Boundless.Course,this.render(),this},CourseEditorController.prototype.on_submit_course_form=function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this.course.set(this.$("#course-form").fields_for("course")),this.course.set("school_name",this.$(".course_school_input").val()),$("#course-form").disable_form(),this.course.errors.reset(),this.course.save({},{success:function(_this){return function(model,response){return _this.editing_course||session.current_user.get("created_courses").add(_this.course),_this.editing_course?_this.trigger("educator:course_edited"):_this.trigger("educator:course_created"),"undefined"!=typeof wiselinks&&null!==wiselinks?wiselinks.reload():window.location=window.location.href}}(this),error:function(_this){return function(model,response){return $("#course-form").enable_form(),_this.render()}}(this)})},CourseEditorController.prototype.on_click_archive_course=function(e){return"function"==typeof e.preventDefault&&e.preventDefault(),this.course.archive({success:function(_this){return function(){return _this.trigger("educator:course_edited"),"undefined"!=typeof wiselinks&&null!==wiselinks?wiselinks.reload():window.location=window.location.href}}(this),error:function(_this){return function(){return _this.render()}}(this)})},CourseEditorController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.CourseEditor.CourseEditorStepsController=function(superClass){function CourseEditorStepsController(){return this.summary_view=bind(this.summary_view,this),CourseEditorStepsController.__super__.constructor.apply(this,arguments)}return extend(CourseEditorStepsController,superClass),CourseEditorStepsController.prototype.template="course_editor_layout",CourseEditorStepsController.prototype.id="course_editor__container",CourseEditorStepsController.prototype.helper_methods=["step_count","course_id"],CourseEditorStepsController.prototype.initialize=function(options){return null==options&&(options={}),CourseEditorStepsController.__super__.initialize.apply(this,arguments),this.course_id=null!=options.course_id?options.course_id:null,this.book_id=null!=options.book_id?options.book_id:null,this.active_subject_id=null!=options.active_subject_id?options.active_subject_id:null,this.course_id||this.book_id?this.step_count=2:this.step_count=3,this.render(),events.on("course_editor:create_course",function(_this){return function(options){return null==options&&(options={}),_this.go_to("class_name",options)}}(this)),events.on("course_editor:created_course",function(_this){return function(course){return null==course&&(course={}),_this.course=course,session.current_user.get("created_courses").add(_this.course),_this.go_to("add_students",{course_id:_this.course.id})}}(this)),this},CourseEditorStepsController.prototype.render=function(){return CourseEditorStepsController.__super__.render.apply(this,arguments),this.steps_container=this.$(".steps__cont.create-course__container"),this.course_id?this.go_to("class_name",{course_id:this.course_id}):this.book_id?this.go_to("class_name",{book_id:this.book_id,active_subject_id:this.active_subject_id}):this.go_to("add_book"),this},CourseEditorStepsController.prototype.go_to=function(step,options){switch(null==options&&(options={}),options=_.extend(options,{el:this.$(".create-course__steps-cont")}),step){case"add_book":return this.add_book_controller=new Boundless.CourseEditor.AddBookController(options),this.steps_container.attr("data-current-step",1);case"class_name":return this.class_name_controller=new Boundless.CourseEditor.ClassNameController(options),step=step=2===this.step_count?1:2,this.steps_container.attr("data-current-step",step);case"add_students":return this.add_students_controller=new Boundless.CourseEditor.AddStudentsController(options),step=step=2===this.step_count?2:3,this.steps_container.attr("data-current-step",step)}},CourseEditorStepsController.prototype.summary_view=function(){return this.course_id?void 0:this.partial("course_editor_summary",this)},CourseEditorStepsController.prototype.remove=function(){return events.off("course_editor::assign_title"),this},CourseEditorStepsController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["course_editor/views/course_editor_add_book"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<h3 class='course-editor__heading course-editor__heading__add-book'>Assign a book to your class</h3>"),session.current_user.get("purchases").length?($o.push("<div class='course-editor__add-book'>\n  <h4 class='course-editor__add-book-header'>Select from books saved in your resources</h4>\n  <div class='course-editor__add-book-content'>\n    <div class='course-editor__add-book-purchases-list'>"),session.current_user.get("purchases").each(function(_this){return function(purchase){var json;return $o.push("      <div class='course-editor__add-book-purchase-list-item'>"),$o.push("        "+$c(_this.partial("global/book_cover_details",_.extend({book:purchase.get("book"),variant:!0,class_prefix:"course-editor__add-book__"})))),json='{"book_id": '+purchase.get("book").id+"}",$o.push("        <a class='btn btn-green course-editor__add-book-assign-btn' data-json='"+$e($c(json))+"'>\n          Assign\n        </a>\n      </div>"),""}}(this)),$o.push("    </div>\n  </div>\n</div>\n<a class='btn btn-block btn-green course-editor__add-other-book-btn'>Browse other books to assign</a>")):$o.push("<div class='course-editor__add-book course-editor__add-book-empty'>\n  <div class='course-editor__add-book-empty-header'>Textbooks in 21 subjects</div>\n  <a class='btn btn-block btn-green course-editor__add-other-book-btn course-editor__add-other-book-btn-empty'>Browse books to assign</a>\n</div>"),$o.push("<a class='course-editor__create-class-without-book'>\n  <span>Create a class without assigning a book</span>\n  <i class='icon-caret-right'></i>\n</a>\n<div class='course-editor__create-class-without-book-disclaimer'>\n  (You will not be able to assign one later for this class)\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["course_editor/views/course_editor_add_students"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<h3 class='course-editor__heading course-editor__heading__add-students'>Your class is all set!</h3>\n<div class='add-students-course__container course-editor__add-book'>\n  <div class='add-students-course__name'>"+$c(this.course.get("name"))+"</div>\n  <div class='add-students-course__school_name'>"+$c(this.course.get("school_name"))+"</div>"),this.course.get("book").id&&($o.push("  <div class='add-students-course__title-container'>\n    <div class='add-students-course__title-heading'>Assigned Textbook</div>"),$o.push("    "+$c(this.partial("global/book_cover_details",_.extend({book:this.course.get("book"),variant:!0,class_prefix:"course-editor__add-book__"})))),$o.push("  </div>")),$o.push("</div>\n<div class='add-students-link__conatiner'>\n  <div class='add-students-link__description'>Share this link with your students to invite them to your class:</div>\n  <input class='add-students-link__course-link' value='"+$e($c(Boundless.HOST_DOMAIN))+"/"+$e($c(this.course.get("code")))+"'>\n  <button class='add-students-link__button btn btn-green' data-clipboard-text='"+$e($c(Boundless.HOST_DOMAIN))+"/"+$e($c(this.course.get("code")))+"'>\n    <i class='icon-link'></i>\n    <span>Copy</span>\n  </button>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["course_editor/views/course_editor_class_name"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push(""+$c(this.partial("course_editor_form",this))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["course_editor/views/course_editor_form"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='bcp-create-class--simple'>\n  <div class='modal__inner-header'>\n    <h2>Class Settings</h2>\n  </div>\n  <div class='modal__inner-body'>"),$o.push("    "+$c(this.form_for(this.course,{"class":"bcp-form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("    "+$c(form.input("subject_tag_id",{as:"select",label:"Subject area",collection:_.map(PageData.subjects,function(subj){return[subj.id,subj.name]}),value:""+(_this.active_subject_id||(_this.active_subject_id=null))}))),$o1.push("    "+$c(form.input("school_name",{input_class:"course_school_input",label:"School",as:"school",liveValidate:!1,autocomplete:"off"}))),$o1.push("    "+$c(form.input("name",{input_class:"course_name_input",label:"Class name",as:"string",liveValidate:!1,placeholder:"e.g., Biology 101 - Introduction to Biology"}))),$o1.push("    "+$c(form.input("book_id",{input_class:"course_title_id",label:!1,as:"hidden",liveValidate:!1,autocomplete:"off"}))),_this.course.id?$o1.push("    "+$c(form.action("submit",{label:"Save changes",as:"button",action_class:"btn btn-caps btn-green btn-block create-course-button"}))):$o1.push("    "+$c(form.action("submit",{label:"Next",as:"button",action_class:"btn btn-caps btn-blue btn-block create-course-button"}))),$o1.join("\n")}}(this)))),this.editing_course&&$o.push("    <div class='course-settings__archive-course'>\n      <div class='course-settings__archive-course-text'>\n        Archive this class\n      </div>\n      <p class='modal__explanatory-text'>Archiving will remove this course from your class list. Your students will still be able to access their past assignments and readings but you will not be able to create new assignments or interact with them via Boundless.</p>\n      <a class='archive-course-btn btn btn-block btn-caps btn-red-orange'>\n        <i class='icon-archive'></i>\n        Archive class\n      </a>\n    </div>"),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["course_editor/views/course_editor_layout"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-course__container steps__cont' data-step-count='"+$e($c(this.step_count))+"' data-current-step='"+$e($c(1))+"'>"),this.course_id||($o.push("  <div class='steps__indicator-cont'>\n    <div class='create-course__create-course-steps-indicator-cont'>"),3===this.step_count&&$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Add Book</div>\n      </div>"),$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Class Name</div>\n      </div>"),3===this.step_count?$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Add Students</div>\n      </div>"):$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>Class Link</div>\n      </div>"),$o.push("    </div>\n  </div>")),$o.push("  <div class='create-course__steps-cont'></div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["course_editor/views/course_editor_summary"]=function(context){return function(){var $o;return $o=[],$o.push("<h2>Create a Class and Assign Your Book</h2>\n<div class='course-editor-summary'>\n  <div class='course-editor-summary__bullet-point'>\n    <span class='boundless-icon-checkmark_negative'></span>\n    Free for educators to assign\n  </div>\n  <div class='course-editor-summary__bullet-point'>\n    <span class='boundless-icon-checkmark_negative'></span>\n    Only $29.99 for students\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/global/blank"]=function(context){return function(){var $o;return $o=[],$o.join("\n")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/global/book_cover_details"]=function(context){return function(){var $c,$e,$o,i,len,line,ref;for($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],this.variant||(this.variant=!1),this.class_prefix||(this.class_prefix="purchased-title__"),$o.push("<div class='"+this.class_prefix+"book-title-container "+this.book.get("subject_tag").get("permalink")+"'>\n  <div class='"+this.class_prefix+"book-title "+this.book.get("subject_tag").get("permalink")+"'>\n    <i class='"+this.class_prefix+"subject-icon "+this.icon_color_class_for_subject_tag(this.book.get("subject_tag").get("permalink"))+"'></i>"),this.variant||$o.push("    "+$c(this.book.display_title())),$o.push("    <i class='"+["bicon-large",$e($c(this.class_prefix))+"subject-icon "+$e($c(this.icon_color_class_for_subject_tag(this.book.get("subject_tag").get("permalink"))))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></i>\n  </div>"),this.variant&&$o.push("  <div class='"+this.class_prefix+"book-title-variant'>"+$c(this.book.display_title())+"</div>"),$o.push("  <div class='"+this.class_prefix+"metadata'>"),ref=this.book.attribution_lines(),i=0,len=ref.length;len>i;i++)line=ref[i],$o.push("    <span>"+$c(line)+"</span>");return $o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/global/flag_form"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='flag'>\n  <span class='flag-headline'>"+$c(this.flag_headline)+"</span>\n  <a class='flag-response flag-response-v_up' data-value='good'>\n    <i class='icon-thumbs-up'></i>\n  </a>\n  <a class='flag-response flag-response-v_down' data-value='needs-improvement'>\n    <i class='icon-thumbs-down'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/lesson/duration"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<i class='boundless-icon-clock'></i>\n<span class='lesson-duration'>"+$c(this.lesson_provider.get("duration"))+"</span>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/lesson/layout"]=function(context){return function(){var $c,$e,$o,ref,ref1,ref2,wrapper_class;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],wrapper_class=(null!=(ref=this.lesson_assignment)?ref.get("course").is_lms():void 0)||!inIframe()?"hide-reader-header":"show-reader-header",$o.push("<div class='"+["lesson_wrapper",""+$e($c(wrapper_class))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='lesson_wrapper'>\n  <div class='inner'>\n    <div class='fill_area scrollable' id='lesson_content_container'>"),this.lesson_provider.is_reading()&&$o.push("      <header class='reading__header'>\n        <div class='clearfix lesson-wrapper__header-cont'>\n          <div class='reading__header__meta'>\n            <div class='lesson-wrapper__header-count'>"+$c(this.lesson_provider.get("atom_commits").length+" Concepts")+"</div>\n            <div class='lesson-wrapper__header-duration'>"+$c(this.partial("lesson/duration"))+"</div>\n          </div>\n          <div class='lesson__meta-icon'>\n            <i class='boundless-icon-reading'></i>\n          </div>\n          <h1 class='lesson-wrapper__header-text'>"+$c("Reading: "+this.lesson_provider.get("name"))+"</h1>\n        </div>\n      </header>"),$o.push("      <div id='lesson_inner_container'>"),this.lesson_provider.is_quiz()&&$o.push("        <header>"+$c("")+"</header>\n        <div class='quiz__wrapper'></div>"),$o.push("      </div>\n    </div>\n    <div class='overlaid-buttons'>"),IosManager.is_ios_app()?$o.push("      <a class='overlaid-buttons__button overlaid-buttons__home-button overlaid-buttons__home-button-v_book' href='/mobile/home'>\n        <i class='bicon-home overlaid-buttons__button-icon'></i>\n        <span class='btn-text'>Home</span>\n      </a>"):(null!=(ref1=this.lesson_assignment)&&null!=(ref2=ref1.get("course"))?ref2.is_lms():void 0)||$o.push("      <div class='overlaid-buttons__button reader-frame__close-btn'>\n        <i class='boundless-icon-x overlaid-buttons__button-icon'></i>\n        <span class='btn-text'>Close</span>\n        <span class='btn-text btn-text--light'>(your progress will be saved)</span>\n      </div>"),$o.push("    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/lesson/lesson_summary"]=function(context){return function(){var $c,$e,$o,i,j,len,ref,ref1,sesh;if($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='center lesson-summary__overview'>"),null!=this.assignment_status_text()&&$o.push("  <h2 class='"+["lesson-summary__status",""+$e($c(this.grade_submitted()||(null!=(ref=this.get_graded_lesson_session())?ref.is_retrying_scoring():void 0)?"emphasized":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' tabindex='"+$e($c(1))+"'>\n    <div class='lesson-summary__status-text'>"+$c(this.assignment_status_text())+"</div>\n  </h2>"),$o.push("  <div class='lesson-summary__summary-panel'>\n    <div>"),this.just_finished?$o.push("      <div class='lesson-summary__score-submission-grade--large'>\n        <div class='score'>score</div>\n        <div class='grade'>"+this.session_grade()+"%</div>\n      </div>"):this.lesson_session.is_reading()?$o.push("      <i class='boundless-icon-reading lesson-summary__icon'></i>"):$o.push("      <i class='boundless-icon-quiz lesson-summary__icon'></i>"),$o.push("    </div>\n    <div>\n      <div class='lesson-summary__meta'>"),$o.push("        "+$c(this.assignment_meta())),$o.push("      </div>\n    </div>\n    <div>\n      <h1 class='lesson-summary__title'>"+$c(this.lesson_provider.get("name"))+"</h1>\n    </div>"),this.lesson_session.is_reading()&&($o.push("    <div class='lesson-summary__reading-summary'>\n      <h2 class='lesson-summary__reading-summary__title'>\n        Concepts Covered:\n      </h2>\n      <ul class='lesson-summary__reading-summary__items'>"),this.atom_commits.forEach(function(_this){return function(atom_commit,index){return $o.push("        <li class='"+["lesson-summary__reading-summary__item",""+$e($c(atom_commit.id===_this.lesson_session.get("last_read_atom_id")?"current":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n          <i class='"+$e($c(_this.bullet_class_for_atom(atom_commit)))+"'></i>\n          <span>"+$c(atom_commit.get("title"))+"</span>"),atom_commit.id===_this.lesson_session.get("last_read_atom_id")&&$o.push("          <span class='left-off-here'>(you left off here)</span>"),$o.push("        </li>"),""}}(this)),$o.push("      </ul>\n    </div>")),$o.push("    <div class='lesson-summary__summary-panel__actions'>"),this.action_message()&&($o.push("      <div class='lesson-summary__actions__message'>"),$o.push("        "+$c(this.action_message())),$o.push("      </div>")),$o.push("      <div class='lesson-summary__action'>\n        <button class='"+["btn","btn-block","btn-caps","btn-large","lesson-summary__start-assignment__js",""+$e($c(this.grade_submitted()?void 0:"btn-primary"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' tabindex='"+$e($c(0))+"'>"),$o.push("          "+$c(this.cta())),$o.push("        </button>\n      </div>\n    </div>\n  </div>"),this.lesson_assignment&&this.lesson_session.is_reading()&&this.grade_submitted())$o.push("  <div class='lesson-summary__score-panel'>\n    <div class='clearfix lesson-summary__score'>\n      <div class='lesson-summary__score-date'>"),$o.push("        "+$c(this.assignment_submission_date())),$o.push("      </div>\n      <div class='lesson-summary__score-message'>\n        Your instructor was notified that you read:\n      </div>\n      <div class='lesson-summary__score-submission-grade'>\n        <span>"+this.assignment_grade()+"%</span>\n      </div>\n    </div>\n  </div>");else if(this.previous_scores().length){for($o.push("  <div class='lesson-summary__score-panel'>\n    <div class='lesson-summary__score-header'>\n      Previous scores\n    </div>\n    <ul>"),ref1=this.previous_scores(),i=j=0,len=ref1.length;len>j;i=++j)sesh=ref1[i],this.lesson_assignment&&sesh.for_credit?($o.push("      <li class='clearfix lesson-summary__score'>\n        <div class='lesson-summary__score-date'>"),$o.push("          "+$c(sesh.date)),$o.push("        </div>\n        <div class='lesson-summary__score-message'>\n          * Score submitted to your instructor:\n        </div>\n        <div class='lesson-summary__score-submission-grade'>\n          <span>"+$c(sesh.score)+"</span>\n        </div>\n      </li>")):$o.push("      <li class='clearfix lesson-summary__score'>\n        <div class='lesson-summary__score-date'>"+$c(sesh.date)+"</div>\n        <div class='lesson-summary__score-grade'>"+$c(sesh.score)+"</div>\n      </li>");$o.push("    </ul>\n  </div>")}return $o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};null==window.HAML&&(window.HAML={}),window.HAML["reader/views/lesson/reading/atom"]=function(context){return function(){var $c,$e,$o,current_index;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='concepts-progress-bar' tabindex='1' aria-label=\"You've read "+$e($c(this.read_atom_ids().length))+" of "+$e($c(this.atom_commits().length))+' concepts in this assignment">'),current_index=this.atom_commits().map(function(_this){return function(ac){return ac.id}}(this)).indexOf(this.atom.id),this.atom_commits().each(function(_this){return function(atom,index){var item_class,ref;return ref=atom.id,indexOf.call(_this.read_atom_ids(),ref)>=0&&(item_class="read"),_this.atom.id===atom.id&&(item_class+=" current_concept"),$o.push("  <span class='"+["concepts-progress-bar-item",""+$e($c(item_class))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='concepts-progress-bar-item__"+atom.id+"' style='width: "+$e($c(100/_this.atom_commits().length))+"%'></span>"),""}}(this)),$o.push("</div>\n<div class='book-content__concept-nav'>"),$o.push("  "+$c(this.delayed(function(){var $o1,next_atom;return $o1=[],current_index=this.atom_commits().map(function(_this){return function(ac){return ac.id}}(this)).indexOf(this.atom.id),current_index>0&&$o1.push("  <a class='book-content__concept-nav-target-v_prev' target='reading_stack:concept?atom_id="+$e($c(this.atom_commits().at(current_index-1).id))+"&scroll_top=0' tabindex='"+$e($c(0))+"' role='link' aria-label='Previous Concept'>\n    <i class='icon-chevron-left'></i>\n    <span>Previous</span>\n  </a>"),(next_atom=this.atom_commits().at(current_index+1))?$o1.push("  <a class='book-content__concept-nav-target-v_next' target='reading_stack:concept?atom_id="+$e($c(next_atom.id))+"&scroll_top=0' tabindex='"+$e($c(0))+"' role='link' aria-label='Next Concept'>\n    <span>Next Concept</span>\n    <i class='icon-chevron-right'></i>\n  </a>"):$o1.push("  <a class='book-content__concept-nav-target-v_next js__reading-lesson__nav--target-v_finish' tabindex='"+$e($c(0))+"' role='link' aria-label='Finish Reading'>\n    <span>Finish</span>\n    <i class='icon-chevron-right'></i>\n  </a>"),$o1.join("\n")}))),$o.push("</div>\n<article class='book-content book-content__concept scrollable'>"),$o.push("  "+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("  <div class='book-content-inner'>\n    <div class='book-content-head'>\n      <div class='book-content-head__title'>\n        <h1 class='book-content__concept-title' tabindex='0'>"+$c(this.atom.get("title"))+"</h1>\n      </div>\n    </div>\n    <div id='fusible-concept-container'></div>\n    <div id='refme-placeholder'></div>\n  </div>"),$o1.join("\n")}))),$o.push("</article>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/lesson/reading/layout"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='lesson-reading__wrapper'></div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/attribution"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],"Object"===this.attribution.constructor.name&&(this.attribution=new Boundless.Attribution(this.attribution)),this.attribution.get("title")?$o.push(""+$c('"'+this.attribution.get("title")+'"')):$o.push(""+$c(this.attribution.get("name")+" - ")),$o.push("<a href='"+$e($c(this.attribution.get("url")))+"' target='_blank'>"+$c(this.attribution.get("url"))+"</a>"),this.attribution.get("title")&&this.attribution.get("name")&&$o.push(""+$c(this.attribution.get("name")+" - ")),this.attribution.get("license")&&this.attribution.get("license").url&&this.attribution.get("license").name?$o.push("<a href='"+$e($c(this.attribution.get("license").url))+"' target='_blank'>"+$c(this.attribution.get("license").name)+"</a>"):this.attribution.get("license")&&this.attribution.get("license").name&&$o.push(""+$c(this.attribution.get("license").name)),
$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/chapter"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<header class='book-content-header'>\n  <div class='content-wrapper__header-text'></div>\n</header>\n<article class='book-content book-content-chapter-index scrollable'>\n  <div class='book-content__inner'>\n    <div class='book-content-head'>\n      <div class='book-content-head__title'>\n        <h1 class='book-content-headline'>"+$c(this.chapter.get("title"))+"</h1>\n      </div>\n      <div class='book-content-head__buttons'>\n        \x91<a class='book-content-head__button flashcards' tabindex='"+$e($c(-1))+"' target='tools_stack:deck?chapter_id="+$e($c(this.chapter.id))+"' trigger='reader:book_out'>\x92\n        <div class='flashcards icon'></div>\n        <div class='book-content-head__button-label'>Flashcards</div>\n        \x91</a>\x92\n        \x91<a class='book-content-head__button quizzes' tabindex='"+$e($c(-1))+"' target='tools_stack:quiz?chapter_id="+$e($c(this.chapter.id))+"' trigger='reader:book_out'>\x92\n        <div class='icon quizzes'></div>\n        <div class='book-content-head__button-label'>Quiz</div>\n        \x91</a>\x92\n        \x91<a class='"+["book-content-head__button","highlights",""+$e($c(this.has_highlights?void 0:"disabled"))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' tabindex='"+$e($c(-1))+"' target='book_stack:toc/notebook?chapter_id="+$e($c(this.chapter.id))+"'>\x92\n        <div class='highlights icon'></div>\n        <div class='book-content-head__button-label'>Highlights</div>\n        \x91</a>\x92\n      </div>\n    </div>\n    <div class='book-content__sections'>\n      <ul class='book-content__sections-list'>"),this.chapter.get("sections").each(function(_this){return function(section){var concepts,first_concept,last_read_concept_id,next_concept,read_concepts,section_read;return concepts=section.get("concepts"),concepts.size()&&(read_concepts=section.read_concepts(),section_read=read_concepts.indexOf(concepts.last().get("atom_id"))>-1?!0:!1,$o.push("        <li class='"+["book-content__sections-list-item",""+$e($c(section_read?"completed":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-number='"+$e($c(section.get("number")))+"'>"),first_concept=concepts.first(),concepts.is_all_read?next_concept=first_concept:(last_read_concept_id=null,concepts.each(function(concept){return concept.id&&read_concepts.indexOf(concept.id)>-1&&(last_read_concept_id=concept.id),""}),next_concept=last_read_concept_id&&_.contains(read_concepts,first_concept.id)?concepts.next_after(last_read_concept_id):first_concept),$o.push("          <a class='book-content__section-list-item-target' target='book_stack:toc/chapter/concept?concept_id="+$e($c(next_concept.id))+"&chapter_id="+$e($c(_this.chapter.id))+"' tabindex='"+$e($c(0))+"' role='link' aria-label=\"Section "+$e($c(section.get("number")))+": "+$e($c(section.get("title")))+". You've read "+$e($c(section.read_concepts().length))+" of "+$e($c(concepts.size()))+" concepts in this section\">\n            <div class='book-content__section-image' style='background-image: url("+$e($c(concepts.thumbnail_url("square")))+")'></div>\n            <div class='book-content__section-number'>\n              <span class='text'>"+$c("Section ")+"</span>\n              <span class='number'>"+$c(""+section.get("number"))+"</span>\n            </div>"),$o.push("            "+$c(_this.partial("reader/book/concepts_progress_bar",{tabindex:"-1",concepts:concepts,read_concepts:section.read_concepts()}))),$o.push("            <h2 class='book-content__section-title'>"+$c(section.get("title"))+"</h2>\n            <ul class='book-content__concepts-list'>"),concepts.each(function(concept){return $o.push("              <li class='book-content__concepts-list-item'>\n                <span class='read_indicator'>"+$c(read_concepts.indexOf(concept.id)>-1?"<i class='icon-ok'></i>":"<i class='icon-circle-blank'></i>")+"</span>\n                <span class='title'>"+$c(concept.get("title"))+"</span>\n              </li>"),""}),$o.push("            </ul>\n          </a>\n        </li>")),""}}(this)),$o.push("      </ul>\n    </div>\n  </div>\n</article>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/concept"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<header class='book-content-header'>"),$o.push("  "+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("  <div class='content-wrapper__header-text'>"),$o1.push("    "+$c("Section "+this.concept.section().get("number"))),$o1.push("  </div>"),$o1.push("  "+$c(this.partial("reader/book/concepts_progress_bar",{tabindex:"0",concepts:this.concept.parent_collection(),read_concepts:this.concept.section().read_concepts(),current_concept_id:this.concept.id}))),$o1.join("\n")}))),$o.push("</header>\n<div class='book-content__concept-nav'>"),$o.push("  "+$c(this.delayed(function(){var $o1;return $o1=[],this.hide_links||(this.concept.has_prev_in_collection()&&$o1.push("  <a class='book-content__concept-nav-target-v_prev' target='book_stack:toc/chapter/concept?chapter_id="+$e($c(this.chapter.id))+"&concept_id="+$e($c(this.concept.prev().id))+"&scroll_top=0' tabindex='"+$e($c(0))+"' role='link' aria-label='Previous Concept'>\n    <i class='icon-chevron-left'></i>\n    <span>Previous</span>\n  </a>"),this.concept.has_next_in_collection()?$o1.push("  <a class='book-content__concept-nav-target-v_next' target='book_stack:toc/chapter/concept?chapter_id="+$e($c(this.chapter.id))+"&concept_id="+$e($c(this.concept.next().id))+"&scroll_top=0' tabindex='"+$e($c(0))+"' role='link' aria-label='Next Concept'>\n    <span>Next Concept</span>\n    <i class='icon-chevron-right'></i>\n  </a>"):$o1.push("  <a class='book-content__concept-nav-target-v_next' target='tools_stack:quick_quiz?chapter_id="+$e($c(this.chapter.id))+"&section_id="+$e($c(this.concept.get("section").id))+"&next_concept_id="+$e($c(this.concept.next().id))+"&scroll_top=0' trigger='reader:book_out' tabindex='"+$e($c(0))+"' role='link' aria-label='Go to section review'>\n    <span>Review</span>\n    <i class='icon-chevron-right'></i>\n  </a>")),$o1.join("\n")}))),$o.push("</div>\n<article class='book-content book-content__concept scrollable'>"),$o.push("  "+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("  <div class='book-content-inner'>\n    <div class='book-content-head'>\n      <div class='book-content-head__title'>\n        <h1 class='book-content__concept-title' tabindex='"+$e($c(0))+"'>"+$c(this.concept.get("title"))+"</h1>\n      </div>\n    </div>\n    <div id='fusible-concept-container'></div>\n    <div id='refme-placeholder'></div>\n  </div>"),$o1.join("\n")}))),$o.push("</article>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/concepts_progress_bar"]=function(context){return function(){var $c,$e,$o,ref,section;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],section=null!=(ref=this.concepts.first())?ref.section():void 0,$o.push("<div class='concepts-progress-bar' tabindex='"+$e($c(this.tabindex))+"' aria-label=\"You've read "+$e($c(this.read_concepts.length))+" of "+$e($c(this.concepts.length))+" concepts in section "+$e($c(null!=section?section.get("number"):void 0))+": "+$e($c(null!=section?section.get("title"):void 0))+'">'),this.concepts.each(function(_this){return function(concept){var item_class;return _this.read_concepts.indexOf(concept.get("atom_id"))>-1&&(item_class="read"),null!=_this.current_concept_id&&_this.current_concept_id===concept.id&&(item_class+=" current_concept"),$o.push("  <span class='"+["concepts-progress-bar-item",""+$e($c(item_class))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' id='concepts-progress-bar-item__"+concept.id+"' style='width: "+$e($c(100/_this.concepts.models.length))+"%'></span>"),""}}(this)),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/contents_search"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<a class='overlaid-buttons__button overlaid-buttons__search-button' tabindex='-1' aria-hidden='true'>\n  <i class='bicon-search book-search__icon overlaid-buttons__button-icon'></i>\n  <span class='btn-text'>"+$c("Search Book")+"</span>\n</a>\n<form class='book-search__form'>\n  <div class='book-search__control-group'>\n    <label for='book-search' style='display: none;'>"+$c("Search "+reader.book.get("title"))+"</label>\n    <input class='book-search__search-input input-xlarge' id='book-search' type='search' placeholder='Search "+$e($c(reader.book.get("title")))+"' value='"+$e($c(null!=this.search_query?""+this.search_query:void 0))+"'>\n    <a class='book-search__btn-dismiss'>\n      <i class='icon-remove'></i>\n    </a>\n    <i class='bicon-search book-search__icon__search-active'></i>\n  </div>\n</form>\n<div class='book-search__results-wrapper scrollable unsearched'>\n  <div class='book-search__results menu' id='book-search-results'></div>\n  <div class='book-search__results--empty'>\n    <span class='book-search__results--empty-text'>No Results</span>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/edit_book"]=function(context){return function(){var $c,$e,$o,title;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],title=this.purchase.get("title"),$o.push("<div class='edit-book__container'>"),this.prompted&&$o.push("  <h2 class='edit-book__title'>You just got "+title.get("title")+" by "+title.get("authors")+"</h2>"),$o.push("  <div class='"+["edit-book__title-data",""+$e($c(title.get("subject_tag").get("permalink")))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),$o.push("    "+$c(this.partial("global/book_cover_details",_.extend({title:title,class_prefix:"edit-book__"})))),$o.push("  </div>"),this.prompted&&$o.push("  <div class='edit-book__explanation'>Help us give you the best experience possible by entering the names of your class and school.</div>"),$o.push("  "+$c(this.form_for(this.purchase,{"class":"edit-book__form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("  "+$c(form.input("course_name",{label:"Add the name of your class",input_class:"edit-book__form-input",as:"string",liveValidate:!1,placeholder:"Enter class"}))),$o1.push("  "+$c(form.input("school_name",{label:"Add your school",input_class:"edit-book__form-input",as:"string",liveValidate:!1,placeholder:"Enter school",autocomplete:"off"}))),$o1.push("  <div class='school-autocomplete-results'></div>"),$o1.join("\n")}}(this)))),$o.push("  <div class='edit-book__form-actions'>\n    <div class='edit-book__form-action-cancel trigger'>Cancel</div>\n    <div class='edit-book__form-action-save trigger'>\n      <i class='icon-check-sign'></i>\n      <span>Save</span>\n      <span class='mq__no-phone'>Changes</span>\n    </div>\n  </div>\n  <div class='edit-book__archive-container'>\n    <span class='edit-book__archive-trigger trigger'>\n      <i class='bicon-archive'></i>\n      <span class='text'>Archive <span class=\"mq__no-phone\">this book</span></span>\n    </span>\n    <span class='edit-book__archive-description'>(You can undo this <span class=\"mq__no-phone\">action</span> later at the bottom<span class=\"mq__no-phone\"> of the library</span>)</span>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/layout"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='fill_area' id='book_content_container'></div>"),$o.push(""+$c(this.partial("reader/book/nav_buttons"))),$o.push("<div class='book-search__container'></div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/nav_buttons"]=function(context){return function(){var $c,$e,$o,ref;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='overlaid-buttons'>\n  <a class='overlaid-buttons__back-button overlaid-buttons__back-button-v_book overlaid-buttons__button' tabindex='"+$e($c(0))+"' aria-label='Go back'>\n    <i class='icon-back overlaid-buttons__button-icon'></i>\n    <span class='btn-text overlaid-buttons__back-button-text' data-btn-text='Back'>Back</span>\n  </a>\n  <a class='overlaid-buttons__button overlaid-buttons__close-button overlaid-buttons__close-button-v_book' tabindex='"+$e($c(0))+"' trigger='reader:book_half_out' aria-label='Close the book panel'>\n    <i class='icon-remove overlaid-buttons__button-icon'></i>\n    <span class='btn-text'>Close</span>\n  </a>"),(null!=(ref=this.course)?ref.is_lms():void 0)||$o.push("  <div class='overlaid-buttons__button reader-frame__close-btn'>\n    <i class='icon-remove overlaid-buttons__button-icon'></i>\n    <span class='btn-text'>Close Book</span>\n  </div>"),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/notebook/chapter"]=function(context){return function(){var $o;return $o=[],$o.join("\n")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/notebook/highlight"]=function(context){return function(){var $c,$e,$o,target_path;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],target_path="book_stack:toc/notebook/concept?chapter_id="+this.highlight.get("chapter_id")+"&concept_id="+this.highlight.get("concept_id")+"&hide_links=true",$o.push("<li class='notebook__highlight' data-highlight-id='"+$e($c(this.highlight.id))+"'>\n  <a target='"+$e($c(target_path))+"'>"),"KeyTermHighlight"===this.highlight.get("type")?($o.push("    <div class='notebook__highlight__key-term-text'>"),$o.push("      "+$c(this.highlight.get("key_term"))),$o.push("    </div>\n    <div class='notebook__highlight-text'>"),$o.push("      "+$c(React.renderToStaticMarkup(React.createElement(Fusible.DocumentContainer,{model:this.highlight.get("text_mido"),config:Boundless.Fusible.textConfig("show")})))),$o.push("    </div>")):($o.push("    <div class='notebook__highlight-text'>"),$o.push("      "+$c(React.renderToStaticMarkup(React.createElement(Fusible.DocumentContainer,{model:this.highlight.get("text_mido"),config:Boundless.Fusible.textConfig("show")})))),$o.push("    </div>")),null!=this.highlight.get("note")&&this.highlight.get("note").length&&$o.push("    <p class='note notebook__highlight-text'>"+$c(this.highlight.get("note"))+"</p>"),$o.push("  </a>\n</li>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/notebook/index"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='notebook__chapter-list-container scrollable'>\n  <ul class='notebook__chapter-list'>"),_.each(reader.book.get("highlights_by_chapter"),function(_this){return function(chapter_highlights){return $o.push("    <li class='notebook__chapter-list-item' data-chapter-id='"+$e($c(chapter_highlights.chapter_id))+"' data-chapter-position='"+$e($c(chapter_highlights.chapter_position))+"'>\n      <span class='chapter-label'>"+$c("Chapter "+chapter_highlights.chapter_position)+"</span>\n      <span class='chapter-highlight-count'>"+$c("("+chapter_highlights.highlight_count+")")+"</span>\n    </li>"),""}}(this)),$o.push("  </ul>\n</div>\n<div class='notebook__chapter-highlights-container scrollable'>\n  <ul class='notebook__chapter-highlights-list'></ul>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/notebook/intro"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='notebook__intro-container'>\n  <p class='notebook__intro-text'>You haven't made any highlights or notes yet.</p>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/notebook/layout"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='notebook__container'>\n  <header>\n    <div class='content-wrapper__header-text'>\n      Highlights & Notes\n    </div>\n  </header>\n  <article class='notebook__content-container scrollable'></article>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/quick_quiz"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<header>\n  <div class='content-wrapper__header-text'>"),$o.push("    "+$c("Review Section "+this.section.get("number"))),$o.push("  </div>\n</header>"),$o.push(""+$c(this.delayed(function(_this){return function(){var $o1;return $o1=[],$o1.push("<article class='scrollable'>\n  <div class='quick-quiz__container quiz__wrapper'>"),$o1.push("    "+$c(_this.partial("reader/book/quick_quiz_intro"))),$o1.push("  </div>\n</article>"),$o1.join("\n")}}(this)))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/quick_quiz_intro"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='quick_quiz__intro__cont'>\n  <div class='quick-quiz__intro'>\n    <h1 class='quick-quiz__title'>\n      <em>Section "+this.section.get("number")+"</em>\n      <strong>Quick Review</strong>\n    </h1>\n    <div class='quick-quiz__content'>"),this.section.get("question_count")>0?($o.push("      <div class='quick-quiz__content-group well'>\n        <h2 class='quick-quiz__content-headline'>You now understand:</h2>\n        <ul class='quick-quiz__concept-list'>"),this.concepts.each(function(_this){return function(concept){return $o.push("          <li class='quick-quiz__concept-list-item' data-atom-id='"+$e($c(concept.get("atom_id")))+"'>\n            <span class='quick-quiz__concept-list--icon'>\n              <icon class='icon-ok'></icon>\n              <icon class='icon-remove'></icon>\n            </span>\n            <span class='quick-quiz__concept-list--text'>"+concept.get("title")+"</span>\n          </li>"),""}}(this)),$o.push("        </ul>"),this.lesson_session.isNew()||$o.push("        <div class='quick-quiz__countdown'>\n          <strong class='quick-quiz__countdown-text'>Your score:</strong>\n          <span class='quick-quiz__countdown-value' id='quick-quiz__countdown-value'></span>\n        </div>"),$o.push("      </div>\n      <div class='quick-quiz__content-group quick-quiz__cta'>\n        <a class='btn btn-block btn-caps btn-large btn-success quick-quiz__start-review-btn' tabindex='"+$e($c(0))+"'>"),$o.push("          "+$c(this.lesson_session.isNew()?"See how much you learned":"Try again")),$o.push("        </a>\n      </div>")):$o.push("      <div class='quick-quiz__content-group well'>\n        <h2 class='quick-quiz__content-headline'>There are no quiz questions to review for this section.</h2>\n      </div>"),$o.push("    </div>\n  </div>\n  <div class='book-content__concept-nav-wrapper'>\n    <a class='btn btn-block btn-caps btn-large btn-primary skip-quick-quiz-btn' tabindex='"+$e($c(0))+"'>\n      <span>Continue reading</span>\n      <span class='mq__no-phone'>the next section</span>\n    </a>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/search/search_results"]=function(context){return function(){var $c,$e,$o,chapter,concept,i,j,k,len,len1,len2,ref,ref1,ref2,ref3,ref4,ref5,res;if($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<ul class='process_math search-results'>"),(null!=(ref=this.search_titles_results)?ref.chapters.length:void 0)>0)for($o.push("  <li class='subheader'>Chapter Results:</li>"),ref1=this.search_titles_results.chapters,i=0,len=ref1.length;len>i;i++)chapter=ref1[i],$o.push("  <li>\n    <a target='book_stack:toc/chapter?chapter_id="+$e($c(chapter.id))+"' data-result-type='chapter' data-id='"+$e($c(reader.book.find_chapter_by_number(chapter.chapter_number).id))+"' trigger='book_contents_search:search_loses_focus'>\n      <div class='chapter_number'>"+$c(chapter.short_path)+"</div>\n      <div class='title'>"+$c(chapter.display_title)+"</div>\n    </a>\n  </li>");if((null!=(ref2=this.search_titles_results)?ref2.concepts.length:void 0)>0)for($o.push("  <li class='subheader'>Concept Results:</li>"),ref3=this.search_titles_results.concepts,j=0,len1=ref3.length;len1>j;j++)concept=ref3[j],$o.push("  <li>\n    <a target='book_stack:toc/chapter/concept?concept_id="+$e($c(concept.id))+"&chapter_id="+$e($c(concept.chapter_id))+"' data-result-type='concept' data-id='"+$e($c(concept.id))+"' trigger='book_contents_search:search_loses_focus'>\n      <div class='title'>"+$c(concept.display_title)+"</div>\n      <div class='short_path'>"+$c(concept.short_path)+"</div>\n    </a>\n  </li>");if((null!=(ref4=this.search_text_results)?ref4.length:void 0)>0)for($o.push("  <li class='subheader'>Text Results:</li>"),ref5=this.search_text_results,k=0,len2=ref5.length;len2>k;k++)res=ref5[k],$o.push("  <li class='text-result'>\n    <a target='book_stack:toc/chapter/concept?concept_id="+$e($c(res.concept_id))+"&chapter_id="+$e($c(res.chapter_id))+"' data-result-type='text' data-id='"+$e($c(res.concept_id))+"' trigger='book_contents_search:search_loses_focus'>\n      <div class='highlight-text'>"+$c(res.excerpt_text)+"</div>\n      <div class='short_path'>"+$c(res.short_path)+"</div>\n    </a>\n  </li>");return $o.push("</ul>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/search/search_results_empty"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='book-search__results--empty book-search__results--empty-v_no-results'>\n  <h3 class='book-search__results--empty-headline'>Sorry</h3>\n  <span class='book-search__results--empty-text'>No search results. Try another search term.</span>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/book/toc"]=function(context){return function(){var $c,$e,$o,i,len,line,ref,short;for($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<header class='book-content-header'></header>\n<article class='book-content book-toc__container scrollable'>\n  <div class='book-content__inner'>\n    <div class='"+["book-content-head","book-toc",""+$e($c(reader.book.get("subject_tag").get("permalink")))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n      <div class='book-content-head__switch'></div>\n      <div class='book-content-head__title'>\n        <h1 class='book-content-headline'>"+$c(reader.book.display_title())+"</h1>\n        <div class='"+["book-content-head__subject-icon",$e($c(this.icon_color_class_for_subject_tag(reader.book.get("subject_tag").get("permalink"))))+" bicon-large"].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>\n        <div class='book-content-head__byline'>"),ref=reader.book.attribution_lines(short=!1),i=0,len=ref.length;len>i;i++)line=ref[i],$o.push("          <span>"+$c(line)+"</span>");return $o.push("        </div>\n      </div>\n      <div class='book-content-head__buttons'>\n        \x91<a class='book-content-head__button flashcards' tabindex='"+$e($c(-1))+"' target='tools_stack:flashcards' trigger='reader:book_out'>\x92\n        <div class='flashcards icon'></div>\n        <div class='book-content-head__button-label'>Flashcards</div>\n        \x91</a>\x92\n        \x91<a class='book-content-head__button quizzes' tabindex='"+$e($c(-1))+"' target='tools_stack:quizzes' trigger='reader:book_out'>\x92\n        <div class='icon quizzes'></div>\n        <div class='book-content-head__button-label'>Quizzes</div>\n        \x91</a>\x92\n        \x91<a class='book-content-head__button highlights' tabindex='"+$e($c(-1))+"' target='book_stack:toc/notebook'>\x92\n        <div class='highlights icon'></div>\n        <div class='book-content-head__button-label'>\n        <span class='mq__fixed'>Notes &</span>\n        Highlights\n        </div>\n        \x91</a>\x92\n        <span class='last_read_concept_testing'>\n          <a class='book book-content-head__button read' tabindex='"+$e($c(-1))+"' data-bind='attr: {target: continue_reading_target}'>\n            <img class='book-content-head__button-image' data-bind='visible: continue_reading_thumbnail, attr: {src: continue_reading_thumbnail}' alt='Thumbnail'>\n            <div class='book icon' data-bind='visible: !continue_reading_thumbnail()'></div>\n            <div class='book-content-head__button-label' data-bind=\"text: continue_or_start() + ' reading from Chapter ' + chapter_number()\">\n              <i class='icon-spinner icon-spin'></i> Loading last read concept\u2026\n            </div>\n            <div class='book-content-head__button-sub-label' data-bind='text: chapter_title'></div>\n          </a>\n        </span>\n      </div>\n    </div>\n    <div class='book-toc__chapters'>\n      <h2 class='book-toc__chapters-title'>Table of Contents</h2>"),$o.push("      "+$c(this.delayed(function(){var $o1,chapter,index,j,len1,ref1;for($o1=[],$o1.push("      <ul class='book-content__list'>"),ref1=reader.book.get("chapters"),index=j=0,len1=ref1.length;len1>j;index=++j)chapter=ref1[index],$o1.push("        <li class='book-content__list-item'>\n          <a class='book-content__list-item-target' target='book_stack:toc/chapter?chapter_id="+$e($c(chapter.id))+"' tabindex='0' aria-label='Chapter "+$e($c(index+1))+": "+$e($c(chapter.title))+"' data-set-chapter='"+$e($c(chapter.id))+"'>\n            <span class='book-content__list-item-target-text'><span class=\"number\">"+(index+1)+'</span> <span class="title">'+chapter.title+"</span></span>\n          </a>\n        </li>");return $o1.push("      </ul>"),$o1.join("\n")}))),$o.push("    </div>\n  </div>\n</article>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"").replace(/[\s\n]*\u0091/gm,"").replace(/\u0092[\s\n]*/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/layout"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='content_wrapper' id='content_wrapper'>\n  <div class='inner'></div>\n</div>\n<div class='tools_wrapper' id='tools_wrapper'>\n  <div class='inner'></div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/assessment_link"]=function(context){return function(){var $o;return $o=[],$o.push("<a data-bind='attr: {target: url, class: wrapper_classes}'>\n  <span class='assessments-list-item-target-text' data-bind='text: title'></span>\n  <span data-bind='text: score_text, attr: {class: classes}, visible: enabled'></span>\n</a>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/flashcards/card"]=function(context){return function(){var $o;return $o=[],$o.push("Card!"),$o.join("\n")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/flashcards/chapter_index"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push(""+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("<header>\n  <div class='content-wrapper__header-text'>\n    Ch. "+this.chapter.get("number")+" &ndash; Flashcards\n  </div>\n</header>\n<article class='scrollable'>\n  <div class='assessments-index'>\n    <ul class='assessments-list'>\n      <li class='assessments-list-item-v_title'>\n        Chapter "+this.chapter.get("number")+" Flashcards\n      </li>\n      <li class='assessments-list-item assessments-list-item-v_chapter' data-bind=\"template: { name: 'reader/views/reader/tools/assessment_link', data: chapter}\"></li>\n      <li class='assessments-list-item-v_title'>\n        Section Flashcards\n      </li>\n      <li class='assessments-list-item-v_section' data-bind=\"template: { name: 'reader/views/reader/tools/assessment_link', foreach: sections}\"></li>\n    </ul>\n  </div>\n</article>"),$o1.join("\n")}))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/flashcards/deck"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push(""+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("<header>\n  <div class='content-wrapper__header-text'>"),null!=this.section?$o1.push("    Chapter "+this.chapter.get("number")+"."+this.section.get("number")+" Flashcards"):$o1.push("    Chapter "+this.chapter.get("number")+" Flashcards"),$o1.push("  </div>\n</header>\n<article class='scrollable'>\n  <div class='flashcard-deck'>"),$o1.push("    "+$c(this.flashcard_view)),$o1.push("  </div>\n</article>"),$o1.join("\n")}))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/flashcards/flashcards"]=function(context){return function(){var $c,$e,$o,correct,deck_total,percent;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],deck_total=this.total_flashcard_count,correct=this.finished_flashcard_count,percent=correct/deck_total*100,this.show_progress_bar?$o.push("<div class='flashcard-deck__progress-container'>\n  <div class='flashcard-deck__progress-container-deck-position'>"+$c(correct+"/"+deck_total)+"</div>\n  <div class='flashcard-deck__progress-container-progress progress progress-success'>\n    <div class='bar flashcard-deck__progress-container-progress-bar' style='width:"+$e($c(percent))+"%'></div>\n  </div>\n</div>"):$o.push("<div class='flashcard-deck__cards-remaining-container'>\n  <div class='flashcard-deck__cards-remaining-label'>Cards left to study:</div>\n  <div class='flashcard-deck__cards-remaining-ticker'>\n    <div class='flashcard-deck__cards-remaining'>"+(deck_total-correct)+"</div>\n  </div>\n</div>"),
null!=this.flashcard||null!=this.term?($o.push("<div class='"+["flashcard-deck__card-container",""+$e($c(null==this.definition?"no-flip":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='flashcard-deck__card'>\n    <div class='card_term'>\n      <div class='card-outer'>\n        <div class='"+["card-inner",""+$e($c(this.in_orientation()&&2===this.orientation_step?"complete_orientation":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"),this.in_orientation()?$o.push("          "+$c(this.orientation_messages[this.orientation_step])):$o.push("          "+$c(this.definition)),$o.push("        </div>\n      </div>\n    </div>\n    <div class='card_definition'>\n      <div class='card-outer'>\n        <div class='card-inner'>"),this.in_orientation()?$o.push("          <div class='definition'>"+$c(this.orientation_messages[this.orientation_step+1])+"</div>"):$o.push("          <div class='term'>"+$c(this.term)+"</div>\n          <div class='definition'>"+$c(this.definition)+"</div>"),$o.push("        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class='"+["flashcard-deck__card-prompt-container",""+$e($c(this.show_definition?"show_definition":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='flashcard-deck__card-response-prompt'>\n    <span class='flashcard-deck__card-response-prompt-text'>\n      How difficult was this to remember?\n    </span>\n  </div>\n  <div class='"+["flashcard-deck__nav",""+$e($c(null==this.definition?"no-flip":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n    <button class='btn disabled flashcard-deck-card--difficulty-btn flashcard-deck__card-hard-btn'>\n      <!-- %i.icon-ok -->\n      <span class='flashcard-deck__card-hard-target-text'>Hard</span>\n    </button>\n    <button class='btn disabled flashcard-deck-card--difficulty-btn flashcard-deck__card-medium-btn'>\n      <!-- %i.icon-ok -->\n      <span class='flashcard-deck__card-medium-target-text'>Medium</span>\n    </button>\n    <button class='btn disabled flashcard-deck-card--difficulty-btn flashcard-deck__card-easy-btn'>\n      <!-- %i.icon-ok -->\n      <span class='flashcard-deck__card-easy-target-text'>Easy</span>\n    </button>\n  </div>\n</div>\n<div class='assessment-meta__container'>\n  <div class='assessment-meta__actions clearfix'>\n    <a class='assessment-meta__action view-in-book' target='"+$e($c(this.concept_path))+"' trigger='reader:book_half_in'>\n      <span class='assessment-meta__action-text'>View In The Book</span>\n    </a>\n    <a class='assessment-meta__action skip-card'>"),$o.push("      "+$c("Skip This Card")),$o.push("    </a>\n  </div>\n</div>\n<div class='assessment-meta__actions clearfix flashcard-deck-style'>"),this.is_review_all()||$o.push("  <a class='assessment-meta__action review_all'>\n    <span class='assessment-meta__action-text'>Review all cards</span>\n  </a>"),this.is_review_due()||$o.push("  <a class='assessment-meta__action review_due'>\n    <span class='assessment-meta__action-text'>Review due cards</span>\n  </a>"),null!=this.source_link&&$o.push("  <div class='assessment-meta__action sources'>\n    Source:\n    <a href='"+$e($c(this.source_link))+"' target='_blank' title='"+$e($c(this.source_link))+"'>\n      "+this.source+"\n    </a>\n  </div>"),$o.push("</div>")):$o.push("<div class='"+["flashcard-deck__card-container",""+$e($c(null==this.definition?"no-flip":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>\n  <div class='flashcard-deck__card'>\n    <div class='card_note no-flip'>\n      <div class='card-outer'>\n        <div class='card-inner'>\n          <p>Congratulations. You've finished this deck!</p>\n          <p>Next time you visit this deck, you'll find the flashcards in a new order. If you'd like to review now, you can do so below.</p>\n        </div>\n      </div>\n    </div>\n  </div>\n</div>\n<div class='assessment-meta__actions clearfix flashcard-deck-style'>\n  <a class='assessment-meta__action btn review_all'>\n    <span class='assessment-meta__action-text'>Review all cards</span>\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/flashcards/index"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<header>\n  <div class='content-wrapper__header-text'>"),$o.push("    "+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("    Flashcards"),$o1.join("\n")}))),$o.push("  </div>\n</header>\n<article class='scrollable'>\n  <div class='assessments-index'>"),$o.push("    "+$c(this.delayed(function(){var $o1,chapter,chapter_due,chapter_new,chapter_statistics,due,i,index,j,len,len1,ref,ref1,total_due;if($o1=[],$o1.push("    <ul class='assessments-list'>"),total_due=_.foldl(this.book_flashcard_statistics.get("chapters"),function(c_count,c){var chapter_due_count;return chapter_due_count=_.foldl(c.sections,function(s_count,s){return s_count+s.due_count},0),c_count+chapter_due_count},0),total_due>0)for($o1.push("      <li class='assessments-list-item-v_title'>\n        Recent\n      </li>"),ref=this.book_flashcard_statistics.get("chapters"),index=i=0,len=ref.length;len>i;index=++i)chapter_statistics=ref[index],chapter=reader.book.find_chapter(chapter_statistics.chapter_id),chapter_due=_.foldl(chapter_statistics.sections,function(s_count,s){return s_count+s.due_count},0),chapter_due>0&&(chapter_new=_.foldl(chapter_statistics.sections,function(s_count,s){return s_count+s.new_count},0),$o1.push("      <li class='assessments-list-item'>"),chapter_new>0&&($o1.push("        <a class='assessments-list-item-target' target='tools_stack:flashcards/flashcards/chapter_flashcards?chapter_id="+$e($c(chapter.id))+"'>\n          <span class='assessments-list-item-target-text'>\n            Ch. "+chapter.get("number")+" - "+chapter.get("title")+"\n          </span>\n          <div class='assessments-list-item--stats'>"),due=chapter_due+chapter_new,$o1.push("            <div class='"+["due",""+$e($c(due>0?"nonzero":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'>"+$c(due)+"</div>\n          </div>\n        </a>")),$o1.push("      </li>"));for($o1.push("      <li class='assessments-list-item-v_title'>\n        By Chapter\n      </li>"),ref1=reader.book.get("chapters"),j=0,len1=ref1.length;len1>j;j++)chapter=ref1[j],$o1.push("      <li class='assessments-list-item'>"),chapter.flashcard_count>0?$o1.push("        <a class='assessments-list-item-target' target='tools_stack:flashcards/chapter_flashcards?chapter_id="+$e($c(chapter.id))+"'>\n          <span class='assessments-list-item-target-text'>Ch. "+chapter.number+" &ndash; "+chapter.title+"</span>\n        </a>"):$o1.push("        <a class='assessments-list-item-target assessments-list-item-unavailable'>\n          <span class='assessments-list-item-target-text'>Ch. "+chapter.number+" &ndash; "+chapter.title+"</span>\n        </a>"),$o1.push("      </li>");return $o1.push("    </ul>"),$o1.join("\n")}))),$o.push("  </div>\n</article>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/flashcards/layout"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='fill_area' id='flashcards_content_container'></div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/layout"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='fill_area' id='tools_container'></div>"),$o.push(""+$c(this.partial("reader/tools/nav_buttons"))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/nav_buttons"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='overlaid-buttons'>\n  <a class='overlaid-buttons__back-button overlaid-buttons__back-button-v_tools overlaid-buttons__button' tabindex='"+$e($c(0))+"' role='button' aria-label='Go back'>\n    <i class='icon-back overlaid-buttons__button-icon'></i>\n    <span class='btn-text'>Back</span>\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/quizzes/chapter_index"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push(""+$c(this.delayed(function(){var $o1;return $o1=[],$o1.push("<header>\n  <div class='content-wrapper__header-text'>\n    Ch. "+this.chapter.get("number")+" &ndash; Quiz\n  </div>\n</header>\n<article class='scrollable'>\n  <div class='assessments-index'>\n    <ul class='assessments-list'>\n      <li class='assessments-list-item-v_title'>\n        Chapter "+this.chapter.get("number")+" Quiz\n      </li>\n      <li class='assessments-list-item assessments-list-item-v_chapter' data-bind=\"template: { name: 'reader/views/reader/tools/assessment_link', data: chapter}\"></li>\n      <li class='assessments-list-item-v_title'>\n        Section Quizzes\n      </li>\n      <li class='assessments-list-item-v_section' data-bind=\"template: { name: 'reader/views/reader/tools/assessment_link', foreach: sections}\"></li>\n    </ul>\n  </div>\n</article>"),$o1.join("\n")}))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/quizzes/index"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<header>\n  <div class='content-wrapper__header-text'>\n    Quizzes\n  </div>\n</header>\n<article class='scrollable'>\n  <div class='assessments-index'>"),$o.push("    "+$c(this.delayed(function(){var $o1,chapter,i,j,len,len1,lesson,ref,ref1,section,section_id;if($o1=[],$o1.push("    <ul class='assessments-list'>"),this.recent_lessons.length)for($o1.push("      <li class='assessments-list-item-v_title'>\n        Recent\n      </li>"),ref=this.recent_lessons.models,i=0,len=ref.length;len>i;i++)lesson=ref[i],$o1.push("      <li class='assessments-list-item'>"),chapter=reader.book.find_chapter(lesson.get("lesson_provider").get("chapter_id")),(section_id=lesson.get("lesson_provider").get("section_id"))?(section=chapter.get("sections").get(section_id),$o1.push("        <a class='assessments-list-item-target' target='tools_stack:quizzes/chapter_quizzes/quiz?chapter_id="+$e($c(chapter.id))+"&section_id="+$e($c(section.id))+"'>\n          <span class='assessments-list-item-target-text'>\n            Ch. "+chapter.get("number")+"."+section.get("number")+" "+section.get("title")+"\n          </span>\n          <div class='assessments-list-item--stats'>\n            <span class=\"correct\">"+lesson.quiz_score()+"%</span>\n          </div>\n        </a>")):$o1.push("        <a class='assessments-list-item-target' target='tools_stack:quizzes/chapter_quizzes/quiz?chapter_id="+$e($c(chapter.id))+"'>\n          <span class='assessments-list-item-target-text'>\n            Ch. "+chapter.get("number")+" - "+chapter.get("title")+"\n          </span>\n          <div class='assessments-list-item--stats'>\n            <span class=\"correct\">"+lesson.quiz_score()+"%</span>\n          </div>\n        </a>"),$o1.push("      </li>");for($o1.push("      <li class='assessments-list-item-v_title'>\n        By Chapter\n      </li>"),ref1=reader.book.get("chapters"),j=0,len1=ref1.length;len1>j;j++)chapter=ref1[j],$o1.push("      <li class='assessments-list-item'>"),chapter.question_count>0?$o1.push("        <a class='assessments-list-item-target' target='tools_stack:quizzes/chapter_quizzes?chapter_id="+$e($c(chapter.id))+"'>\n          <span class='assessments-list-item-target-text'>Ch. "+chapter.number+" &ndash; "+chapter.title+"</span>\n        </a>"):$o1.push("        <a class='assessments-list-item-target assessments-list-item-unavailable'>\n          <span class='assessments-list-item-target-text'>Ch. "+chapter.number+" &ndash; "+chapter.title+"</span>\n        </a>"),$o1.push("      </li>");return $o1.push("    </ul>"),$o1.join("\n")}))),$o.push("  </div>\n</article>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/quizzes/layout"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='fill_area' id='quizzes_content_container'></div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["reader/views/reader/tools/quizzes/quiz"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<header>\n  <h1 class='content-wrapper__header-text'>"),null!=this.section?$o.push("    Chapter "+this.chapter.get("number")+"."+this.section.get("number")+" Quiz"):$o.push("    Chapter "+this.chapter.get("number")+" Quiz"),$o.push("  </h1>\n</header>"),$o.push(""+$c(this.delayed(function(_this){return function(){var $o1;return $o1=[],$o1.push("<article class='scrollable'>\n  <div class='assessment-placeholder quiz__wrapper'></div>\n</article>"),$o1.join("\n")}}(this)))),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("lms_book_assigner/views"),Boundless.LmsBookAssigner||(Boundless.LmsBookAssigner={}),$(function(){return $(document).on("click","a[data-popup=assign_book_to_lms_course]",function(e){var opts;return e.preventDefault(),(opts=$(e.currentTarget).attr("data-json"))?(opts=JSON.parse(opts),null==session.current_user?void Boundless.Logger.error("No user."):(this.step_controller=new Boundless.LmsBookAssigner.StepController(opts),this.step_controller.on("close",function(_this){return function(){return wizzard.hide()}}(this)),window.wizzard=new Boundless.WizzardController({step_els:[this.step_controller.$el],sidebar_template:"assign_book_to_lms_course"}),window.wizzard.render())):void 0})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.WizzardController=function(superClass){function WizzardController(){return WizzardController.__super__.constructor.apply(this,arguments)}return extend(WizzardController,superClass),WizzardController.prototype.template="wizzard_layout",WizzardController.prototype.helper_methods=["sidebar_contents","step_els"],WizzardController.prototype.initialize=function(params){return null==params&&(params={}),WizzardController.__super__.initialize.apply(this,arguments),this.modal=null!=params.modal?params.modal:!0,this.position=null!=params.position?params.position:!1,(this.sidebar_provider=params.sidebar_provider)?this.sidebar_contents=this.sidebar_provider():params.sidebar_template&&(this.sidebar_contents=this.partial("sidebars/"+params.sidebar_template,this)),this.starting_without_session=params.starting_without_session,this.sidebar_contents||params.max_width?(this.template="sidebar_layout",this.width=null!=params.max_width?params.max_width:830):params.max_width?this.width=params.max_width:this.width=530,this.step_els=params.step_els,events.on("wizzard:update_sidebar",function(_this){return function(html_content){return _this.render_sidebar_contents(html_content)}}(this)),this},WizzardController.prototype.render_sidebar_contents=function(html_content){return this.$(".wizzard__sidebar").html(html_content)},WizzardController.prototype.render_sidebar=function(template){return this.$(".wizzard__sidebar").html(this.sidebar_provider(template))},WizzardController.prototype.render=function(){var i,index,len,options,ref,step_el;for(WizzardController.__super__.render.apply(this,arguments),ref=this.step_els,index=i=0,len=ref.length;len>i;index=++i)step_el=ref[index],this.$(".wizzard__inner-cont > .steps__step").eq(index).html("").append(step_el);return this.modal&&(options={},this.position&&(options.position=this.position),this.popup=new Boundless.Modal(this.$el,this.width,options),this.popup.show(),this.popup.on_hide(function(_this){return function(){return _this.hide()}}(this))),this},WizzardController.prototype.hide=function(){return this.popup.hide(),this.starting_without_session&&null!=session.current_user?window.location_reloading?void 0:(window.location_reloading=!0,window.location=window.location.href):this.trigger("hidden")},WizzardController.prototype.goto_step=function(step_index){return this.$(".wizzard__cont").attr("data-current-step",step_index)},WizzardController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.WizzardStepController=function(superClass){function WizzardStepController(){return WizzardStepController.__super__.constructor.apply(this,arguments)}return extend(WizzardStepController,superClass),WizzardStepController.prototype.template="step_layout",WizzardStepController.prototype.helper_methods=["step_names","current_step"],WizzardStepController.prototype.initialize=function(){return WizzardStepController.__super__.initialize.apply(this,arguments),this.current_step=0,this.step_names=[],this},WizzardStepController.prototype.next_step=function(){return this.current_step+=1,this.current_step<=this.step_names.length?(this.go_to(this.step_names[this.current_step-1]),this.$(".steps__cont").attr("data-current-step",this.current_step),this.$(".steps__step").each(function(_this){return function(i,step){var ariaHidden;return ariaHidden=_this.current_step!==i+1,$(step).attr({"aria-hidden":ariaHidden})}}(this))):this.finish()},WizzardStepController.prototype.go_to=function(){return raise("go_to method must be implemented")},WizzardStepController.prototype.finish=function(){return raise("Finish method must be implemented")},WizzardStepController.prototype.rename_step=function(step_index,name){return this.step_names[step_index]=name,this.$(".steps__indicator__text").eq(step_index).text(name)},WizzardStepController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LmsBookAssigner.SelectLmsCourseController=function(superClass){function SelectLmsCourseController(){return SelectLmsCourseController.__super__.constructor.apply(this,arguments)}return extend(SelectLmsCourseController,superClass),SelectLmsCourseController.prototype.template="select_lms_course",SelectLmsCourseController.prototype.events={"click .js__assign-book":"clicked_assign","click .js__ok":"clicked_ok","click .js__create-new-course":"clicked_create_new_course","click .course-dropdown-link":"clicked_course"},SelectLmsCourseController.prototype.helper_methods=["courses","course","active_subject_id","book_id"],SelectLmsCourseController.prototype.initialize=function(params){var assignable_courses;return null==params&&(params={}),SelectLmsCourseController.__super__.initialize.apply(this,arguments),this.active_subject_id=params.active_subject_id,this.book_id=params.book_id,this.brightspace_modules=[],this.brightspace_module=null,assignable_courses=session.current_user.get("created_courses"),assignable_courses.on_loaded({url:assignable_courses.url()+"/assignable"},function(_this){return function(){var ref;return _this.courses=assignable_courses.filter(function(course){return course.is_lms()&&!course.get("book_id")}),_this.course=null!=(ref=_this.courses)?ref[0]:void 0,_this.render()}}(this)),this},SelectLmsCourseController.prototype.clicked_course=function(evt){var $target,lms_id;return $target=$(evt.currentTarget),lms_id=$target.attr("data-external-tool-id"),this.course=_.find(this.courses,function(course){return course.get("external_tool_id")===lms_id}),this.course.set({subject_tag_id:this.active_subject_id}),this.render()},SelectLmsCourseController.prototype.clicked_assign=function(evt){return evt.preventDefault(),this.course?this.course.save({book_id:this.book_id},{success:function(_this){return function(){return _this.render("book_added")}}(this),error:function(){return alert("There was an error saving this book to your class.")}}):void 0},SelectLmsCourseController.prototype.clicked_ok=function(){return this.trigger("close")},SelectLmsCourseController.prototype.clicked_create_new_course=function(){return this.trigger("close")},SelectLmsCourseController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.LmsBookAssigner.StepController=function(superClass){function StepController(){return StepController.__super__.constructor.apply(this,arguments)}return extend(StepController,superClass),StepController.prototype.initialize=function(params){return null==params&&(params={}),StepController.__super__.initialize.apply(this,arguments),this.options=params,this.step_names=["assign"],this.render(),this.next_step(),this},StepController.prototype.go_to=function(step){switch(step){case"assign":return this.controller=new Boundless.LmsBookAssigner.SelectLmsCourseController(_.extend(this.options,{el:this.$(".steps__step-1")})),this.controller.on("close",function(_this){return function(){return _this.finish()}}(this))}},StepController.prototype.finish=function(){return this.trigger("close")},StepController}(Boundless.WizzardStepController)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["lms_book_assigner/views/book_added"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='center lms__book-assigned modal__inner-body'>\n  <i class='boundless-icon-checkmark'></i>\n  <p>This book has been added to your class in your LMS. Your students will now be able to access it from the course navigation.</p>\n  <a class='btn btn-block btn-green btn-large js__ok'>Okay, thanks</a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["lms_book_assigner/views/select_lms_course"]=function(context){return function(){var $c,$e,$o,course,i,len,ref;if($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='bcp-form lms_book_assigner modal__inner-body'>"),this.courses.length){for($o.push("  <label>Which class would you like to use this book for?</label>\n  <div class='btn-group lms_book_assigner__course-selector'>\n    <a class='btn dropdown-toggle lms_book_assigner__course-selector__button' data-toggle='dropdown'>\n      <span class='lms_book_assigner__course-selector__name'>"+$c(this.course.get("name"))+"</span>"),this.course.is_lms()&&($o.push("      <label class='dropdown-link__lms-label'>\n        <i class='boundless-icon-"+this.course.lms_icon_name()+"'></i>"),$o.push("        "+$c(this.course.lms_name())),$o.push("      </label>")),$o.push("      <i class='icon-caret-down'></i>\n    </a>\n    <ul class='dropdown dropdown-menu lms_book_assigner__course-list'>"),ref=this.courses,i=0,len=ref.length;len>i;i++)course=ref[i],$o.push("      <li>\n        <a class='course-dropdown-link dropdown-link' data-id='"+$e($c(course.id))+"' data-external-tool-id='"+$e($c(course.get("external_tool_id")))+"'>\n          <span class='lms_book_assigner__course-selector__name'>"+$c(course.get("name"))+"</span>"),course.is_lms()&&($o.push("          <label class='dropdown-link__lms-label'>\n            <i class='boundless-icon-"+course.lms_icon_name()+"'></i>"),$o.push("            "+$c(course.lms_name())),$o.push("          </label>")),$o.push("        </a>\n      </li>");$o.push("    </ul>\n  </div>\n  <a class='btn btn-block btn-caps btn-green js__assign-book'>Assign</a>\n  <hr>\n  <div class='orr'>or</div>")}return $o.push("  <a class='btn btn-block btn-caps js__create-new-course' data-popup='course_editor' data-json='{\"book_id\": "+this.book_id+', "active_subject_id": '+this.active_subject_id+"}'>Create a new course</a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("assigner/views"),Boundless.AssignerApp=function(){function AssignerApp(el,params){null==params&&(params={}),this.assigner_controller=new Boundless.AssignerController(_.extend({},params,{el:el}))}return AssignerApp}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.AssignerController=function(superClass){function AssignerController(){return AssignerController.__super__.constructor.apply(this,arguments)}return extend(AssignerController,superClass),AssignerController.prototype.template="assigner",AssignerController.prototype.events={"click .bcp-issue__action-button":"toggle","click .bcp-issue__assigner-dropdown-link":"clicked_name"},AssignerController.prototype.helper_methods=["experts"],AssignerController.prototype.initialize=function(options){return null==options&&(options={}),AssignerController.__super__.initialize.apply(this,arguments),this.issue=options.issue,this.experts=options.experts,$(document).click(function(_this){return function(e){return _this.hide(e)}}(this)),this},AssignerController.prototype.render=function(template_name,context){return null==template_name&&(template_name=this.template),null==context&&(context={}),this.$("#bcp-issue__assigner-dropdown-cont").html(this.view(template_name,context)),this.delegateEvents(),this.applyBindings(),this},AssignerController.prototype.toggle=function(e){return e.preventDefault(),e.stopPropagation(),this.render(),this.$("#bcp-issue__assigner-dropdown-cont").toggle()},AssignerController.prototype.hide=function(e){return this.$("#bcp-issue__assigner-dropdown-cont").hide()},AssignerController.prototype.clicked_name=function(e){var user_id;return e.stopPropagation(),user_id=$(e.currentTarget).data("id"),this.issue.save({assignee_id:user_id},{success:function(_this){return function(){return $(".bcp-issue__assignee").html(_this.view("statement",{user:_this.experts.get(user_id)})),_this.hide()}}(this),error:function(_this){return function(){return alert("There was an error assigning this issue")}}(this)})},AssignerController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["assigner/views/assigner"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<ul class='bcp-issue__assigner-dropdown scroll-lock'>"),this.experts.each(function(expert){return $o.push("  <li class='bcp-issue__assigner-dropdown-item'>\n    <a class='bcp-issue__assigner-dropdown-link' data-id='"+$e($c(expert.id))+"'>"+$c(expert.get("name"))+"</a>\n  </li>"),""}),$o.push("</ul>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["assigner/views/statement"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("and assigned to\n<a href='"+$e($c(this.user.get("path")))+"'>"+$c(this.user.get("name"))+"</a>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Boundless.ConflictResolver||(Boundless.ConflictResolver={}),Boundless.ConflictResolver.App=function(){function App(approve_url,conflicts){this.on_accept_question_conflicts=bind(this.on_accept_question_conflicts,this),this.on_accept_conflicts=bind(this.on_accept_conflicts,this),this.change_clicked=bind(this.change_clicked,this),this.$el=$(".content-edit__conflicts"),this.approve_url=approve_url,this.conflicts=conflicts,$(".content-edit__conflict__field",this.$el).click(this.change_clicked),$(".content-edit__conflicts__trigger").click(this.on_accept_conflicts),$(".content-edit__question-conflicts__trigger").click(this.on_accept_question_conflicts)}return App.prototype.change_clicked=function(e){var $target;return $target=$(e.currentTarget),$target.siblings().removeClass("selected"),$target.addClass("selected")},App.prototype.on_accept_conflicts=function(e){var $cont,$target,conflict,conflicts,field,i,index,len,ref,resolutions,value;if(e.preventDefault(),$target=$(e.currentTarget),!$target.attr("disabled")){$target.disable_button(),resolutions={},ref=this.conflicts;for(field in ref)for(conflicts=ref[field],$cont=this.$el.find("[data-field-name='"+field+"']"),resolutions[field]="",index=i=0,len=conflicts.length;len>i;index=++i)if(conflict=conflicts[index],"conflict"===conflict.type){if(value=conflict[$cont.find("[data-conflict-index="+index+"].selected .content-edit__conflict__field__value").data("type")],null==value)throw alert("There was a problem getting the values to merge. Please show this proposed change to engineering."),"Received undefined value to merge";resolutions[field]+=value}else resolutions[field]+=conflict.text;return $.page_post(this.approve_url,{resolutions:JSON.stringify(resolutions)})}},App.prototype.on_accept_question_conflicts=function(e){var $target,resolutions,side;return e.preventDefault(),$target=$(e.currentTarget),$target.attr("disabled")?void 0:($target.disable_button(),side=$(".content-edit__conflict__field.selected .content-edit__conflict__field__value").data("side"),resolutions={learnosity_widget:this.conflicts[side]},$.page_post(this.approve_url,{resolutions:JSON.stringify(resolutions)}))},App}()}.call(this),function(){Boundless.PowerpointPuller||(Boundless.PowerpointPuller={}),Boundless.PowerpointPuller.App=function(){function App(el){var channel,pusher;Pusher.channel_auth_endpoint=session.current_user.pusher_channel_auth_endpoint(),pusher=new Pusher(Boundless.pusher_key),channel=pusher.subscribe("private-"+session.current_user.id+"-powerpoints"),channel.bind("powerpoint_ready",function(_this){return function(data){return $(el).data("id")===data.id?($(el).removeClass("processing-powerpoint"),el.href=data.url):void 0}}(this))}return App}(),Boundless.PowerpointPuller.bind_elements=function(){return $("a[data-type=ppt-bind]").each(function(index,el){return new Boundless.PowerpointPuller.App(el)})}}.call(this);var DIFF_DELETE=-1,DIFF_INSERT=1,DIFF_EQUAL=0;diff_match_patch.Diff,diff_match_patch.prototype.diff_main=function(text1,text2,opt_checklines,opt_deadline){"undefined"==typeof opt_deadline&&(opt_deadline=this.Diff_Timeout<=0?Number.MAX_VALUE:(new Date).getTime()+1e3*this.Diff_Timeout);var deadline=opt_deadline;if(null==text1||null==text2)throw new Error("Null input. (diff_main)");
if(text1==text2)return text1?[[DIFF_EQUAL,text1]]:[];"undefined"==typeof opt_checklines&&(opt_checklines=!0);var checklines=opt_checklines,commonlength=this.diff_commonPrefix(text1,text2),commonprefix=text1.substring(0,commonlength);text1=text1.substring(commonlength),text2=text2.substring(commonlength),commonlength=this.diff_commonSuffix(text1,text2);var commonsuffix=text1.substring(text1.length-commonlength);text1=text1.substring(0,text1.length-commonlength),text2=text2.substring(0,text2.length-commonlength);var diffs=this.diff_compute_(text1,text2,checklines,deadline);return commonprefix&&diffs.unshift([DIFF_EQUAL,commonprefix]),commonsuffix&&diffs.push([DIFF_EQUAL,commonsuffix]),this.diff_cleanupMerge(diffs),diffs},diff_match_patch.prototype.diff_compute_=function(text1,text2,checklines,deadline){var diffs;if(!text1)return[[DIFF_INSERT,text2]];if(!text2)return[[DIFF_DELETE,text1]];var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1,i=longtext.indexOf(shorttext);if(-1!=i)return diffs=[[DIFF_INSERT,longtext.substring(0,i)],[DIFF_EQUAL,shorttext],[DIFF_INSERT,longtext.substring(i+shorttext.length)]],text1.length>text2.length&&(diffs[0][0]=diffs[2][0]=DIFF_DELETE),diffs;if(1==shorttext.length)return[[DIFF_DELETE,text1],[DIFF_INSERT,text2]];var hm=this.diff_halfMatch_(text1,text2);if(hm){var text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3],mid_common=hm[4],diffs_a=this.diff_main(text1_a,text2_a,checklines,deadline),diffs_b=this.diff_main(text1_b,text2_b,checklines,deadline);return diffs_a.concat([[DIFF_EQUAL,mid_common]],diffs_b)}return checklines&&text1.length>100&&text2.length>100?this.diff_lineMode_(text1,text2,deadline):this.diff_bisect_(text1,text2,deadline)},diff_match_patch.prototype.diff_lineMode_=function(text1,text2,deadline){var a=this.diff_linesToChars_(text1,text2);text1=a.chars1,text2=a.chars2;var linearray=a.lineArray,diffs=this.diff_main(text1,text2,!1,deadline);this.diff_charsToLines_(diffs,linearray),this.diff_cleanupSemantic(diffs),diffs.push([DIFF_EQUAL,""]);for(var pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";pointer<diffs.length;){switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++,text_insert+=diffs[pointer][1];break;case DIFF_DELETE:count_delete++,text_delete+=diffs[pointer][1];break;case DIFF_EQUAL:if(count_delete>=1&&count_insert>=1){diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert),pointer=pointer-count_delete-count_insert;for(var a=this.diff_main(text_delete,text_insert,!1,deadline),j=a.length-1;j>=0;j--)diffs.splice(pointer,0,a[j]);pointer+=a.length}count_insert=0,count_delete=0,text_delete="",text_insert=""}pointer++}return diffs.pop(),diffs},diff_match_patch.prototype.diff_bisect_=function(text1,text2,deadline){for(var text1_length=text1.length,text2_length=text2.length,max_d=Math.ceil((text1_length+text2_length)/2),v_offset=max_d,v_length=2*max_d,v1=new Array(v_length),v2=new Array(v_length),x=0;v_length>x;x++)v1[x]=-1,v2[x]=-1;v1[v_offset+1]=0,v2[v_offset+1]=0;for(var delta=text1_length-text2_length,front=delta%2!=0,k1start=0,k1end=0,k2start=0,k2end=0,d=0;max_d>d&&!((new Date).getTime()>deadline);d++){for(var k1=-d+k1start;d-k1end>=k1;k1+=2){var x1,k1_offset=v_offset+k1;x1=k1==-d||k1!=d&&v1[k1_offset-1]<v1[k1_offset+1]?v1[k1_offset+1]:v1[k1_offset-1]+1;for(var y1=x1-k1;text1_length>x1&&text2_length>y1&&text1.charAt(x1)==text2.charAt(y1);)x1++,y1++;if(v1[k1_offset]=x1,x1>text1_length)k1end+=2;else if(y1>text2_length)k1start+=2;else if(front){var k2_offset=v_offset+delta-k1;if(k2_offset>=0&&v_length>k2_offset&&-1!=v2[k2_offset]){var x2=text1_length-v2[k2_offset];if(x1>=x2)return this.diff_bisectSplit_(text1,text2,x1,y1,deadline)}}}for(var k2=-d+k2start;d-k2end>=k2;k2+=2){var x2,k2_offset=v_offset+k2;x2=k2==-d||k2!=d&&v2[k2_offset-1]<v2[k2_offset+1]?v2[k2_offset+1]:v2[k2_offset-1]+1;for(var y2=x2-k2;text1_length>x2&&text2_length>y2&&text1.charAt(text1_length-x2-1)==text2.charAt(text2_length-y2-1);)x2++,y2++;if(v2[k2_offset]=x2,x2>text1_length)k2end+=2;else if(y2>text2_length)k2start+=2;else if(!front){var k1_offset=v_offset+delta-k2;if(k1_offset>=0&&v_length>k1_offset&&-1!=v1[k1_offset]){var x1=v1[k1_offset],y1=v_offset+x1-k1_offset;if(x2=text1_length-x2,x1>=x2)return this.diff_bisectSplit_(text1,text2,x1,y1,deadline)}}}}return[[DIFF_DELETE,text1],[DIFF_INSERT,text2]]},diff_match_patch.prototype.diff_bisectSplit_=function(text1,text2,x,y,deadline){var text1a=text1.substring(0,x),text2a=text2.substring(0,y),text1b=text1.substring(x),text2b=text2.substring(y),diffs=this.diff_main(text1a,text2a,!1,deadline),diffsb=this.diff_main(text1b,text2b,!1,deadline);return diffs.concat(diffsb)},diff_match_patch.prototype.diff_linesToChars_=function(text1,text2){function diff_linesToCharsMunge_(text){for(var chars="",lineStart=0,lineEnd=-1,lineArrayLength=lineArray.length;lineEnd<text.length-1;){lineEnd=text.indexOf("\n",lineStart),-1==lineEnd&&(lineEnd=text.length-1);var line=text.substring(lineStart,lineEnd+1);lineStart=lineEnd+1,(lineHash.hasOwnProperty?lineHash.hasOwnProperty(line):void 0!==lineHash[line])?chars+=String.fromCharCode(lineHash[line]):(chars+=String.fromCharCode(lineArrayLength),lineHash[line]=lineArrayLength,lineArray[lineArrayLength++]=line)}return chars}var lineArray=[],lineHash={};lineArray[0]="";var chars1=diff_linesToCharsMunge_(text1),chars2=diff_linesToCharsMunge_(text2);return{chars1:chars1,chars2:chars2,lineArray:lineArray}},diff_match_patch.prototype.diff_charsToLines_=function(diffs,lineArray){for(var x=0;x<diffs.length;x++){for(var chars=diffs[x][1],text=[],y=0;y<chars.length;y++)text[y]=lineArray[chars.charCodeAt(y)];diffs[x][1]=text.join("")}},diff_match_patch.prototype.diff_commonPrefix=function(text1,text2){if(!text1||!text2||text1.charAt(0)!=text2.charAt(0))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerstart=0;pointermid>pointermin;)text1.substring(pointerstart,pointermid)==text2.substring(pointerstart,pointermid)?(pointermin=pointermid,pointerstart=pointermin):pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return pointermid},diff_match_patch.prototype.diff_commonSuffix=function(text1,text2){if(!text1||!text2||text1.charAt(text1.length-1)!=text2.charAt(text2.length-1))return 0;for(var pointermin=0,pointermax=Math.min(text1.length,text2.length),pointermid=pointermax,pointerend=0;pointermid>pointermin;)text1.substring(text1.length-pointermid,text1.length-pointerend)==text2.substring(text2.length-pointermid,text2.length-pointerend)?(pointermin=pointermid,pointerend=pointermin):pointermax=pointermid,pointermid=Math.floor((pointermax-pointermin)/2+pointermin);return pointermid},diff_match_patch.prototype.diff_commonOverlap_=function(text1,text2){var text1_length=text1.length,text2_length=text2.length;if(0==text1_length||0==text2_length)return 0;text1_length>text2_length?text1=text1.substring(text1_length-text2_length):text2_length>text1_length&&(text2=text2.substring(0,text1_length));var text_length=Math.min(text1_length,text2_length);if(text1==text2)return text_length;for(var best=0,length=1;;){var pattern=text1.substring(text_length-length),found=text2.indexOf(pattern);if(-1==found)return best;length+=found,(0==found||text1.substring(text_length-length)==text2.substring(0,length))&&(best=length,length++)}},diff_match_patch.prototype.diff_halfMatch_=function(text1,text2){function diff_halfMatchI_(longtext,shorttext,i){for(var best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,seed=longtext.substring(i,i+Math.floor(longtext.length/4)),j=-1,best_common="";-1!=(j=shorttext.indexOf(seed,j+1));){var prefixLength=dmp.diff_commonPrefix(longtext.substring(i),shorttext.substring(j)),suffixLength=dmp.diff_commonSuffix(longtext.substring(0,i),shorttext.substring(0,j));best_common.length<suffixLength+prefixLength&&(best_common=shorttext.substring(j-suffixLength,j)+shorttext.substring(j,j+prefixLength),best_longtext_a=longtext.substring(0,i-suffixLength),best_longtext_b=longtext.substring(i+prefixLength),best_shorttext_a=shorttext.substring(0,j-suffixLength),best_shorttext_b=shorttext.substring(j+prefixLength))}return 2*best_common.length>=longtext.length?[best_longtext_a,best_longtext_b,best_shorttext_a,best_shorttext_b,best_common]:null}if(this.Diff_Timeout<=0)return null;var longtext=text1.length>text2.length?text1:text2,shorttext=text1.length>text2.length?text2:text1;if(longtext.length<4||2*shorttext.length<longtext.length)return null;var hm,dmp=this,hm1=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/4)),hm2=diff_halfMatchI_(longtext,shorttext,Math.ceil(longtext.length/2));if(!hm1&&!hm2)return null;hm=hm2?hm1&&hm1[4].length>hm2[4].length?hm1:hm2:hm1;var text1_a,text1_b,text2_a,text2_b;text1.length>text2.length?(text1_a=hm[0],text1_b=hm[1],text2_a=hm[2],text2_b=hm[3]):(text2_a=hm[0],text2_b=hm[1],text1_a=hm[2],text1_b=hm[3]);var mid_common=hm[4];return[text1_a,text1_b,text2_a,text2_b,mid_common]},diff_match_patch.prototype.diff_cleanupSemantic=function(diffs){for(var changes=!1,equalities=[],equalitiesLength=0,lastequality=null,pointer=0,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0;pointer<diffs.length;)diffs[pointer][0]==DIFF_EQUAL?(equalities[equalitiesLength++]=pointer,length_insertions1=length_insertions2,length_deletions1=length_deletions2,length_insertions2=0,length_deletions2=0,lastequality=diffs[pointer][1]):(diffs[pointer][0]==DIFF_INSERT?length_insertions2+=diffs[pointer][1].length:length_deletions2+=diffs[pointer][1].length,lastequality&&lastequality.length<=Math.max(length_insertions1,length_deletions1)&&lastequality.length<=Math.max(length_insertions2,length_deletions2)&&(diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]),diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT,equalitiesLength--,equalitiesLength--,pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1,length_insertions1=0,length_deletions1=0,length_insertions2=0,length_deletions2=0,lastequality=null,changes=!0)),pointer++;for(changes&&this.diff_cleanupMerge(diffs),this.diff_cleanupSemanticLossless(diffs),pointer=1;pointer<diffs.length;){if(diffs[pointer-1][0]==DIFF_DELETE&&diffs[pointer][0]==DIFF_INSERT){var deletion=diffs[pointer-1][1],insertion=diffs[pointer][1],overlap_length1=this.diff_commonOverlap_(deletion,insertion),overlap_length2=this.diff_commonOverlap_(insertion,deletion);overlap_length1>=overlap_length2?(overlap_length1>=deletion.length/2||overlap_length1>=insertion.length/2)&&(diffs.splice(pointer,0,[DIFF_EQUAL,insertion.substring(0,overlap_length1)]),diffs[pointer-1][1]=deletion.substring(0,deletion.length-overlap_length1),diffs[pointer+1][1]=insertion.substring(overlap_length1),pointer++):(overlap_length2>=deletion.length/2||overlap_length2>=insertion.length/2)&&(diffs.splice(pointer,0,[DIFF_EQUAL,deletion.substring(0,overlap_length2)]),diffs[pointer-1][0]=DIFF_INSERT,diffs[pointer-1][1]=insertion.substring(0,insertion.length-overlap_length2),diffs[pointer+1][0]=DIFF_DELETE,diffs[pointer+1][1]=deletion.substring(overlap_length2),pointer++),pointer++}pointer++}},diff_match_patch.prototype.diff_cleanupSemanticLossless=function(diffs){function diff_cleanupSemanticScore_(one,two){if(!one||!two)return 6;var char1=one.charAt(one.length-1),char2=two.charAt(0),nonAlphaNumeric1=char1.match(diff_match_patch.nonAlphaNumericRegex_),nonAlphaNumeric2=char2.match(diff_match_patch.nonAlphaNumericRegex_),whitespace1=nonAlphaNumeric1&&char1.match(diff_match_patch.whitespaceRegex_),whitespace2=nonAlphaNumeric2&&char2.match(diff_match_patch.whitespaceRegex_),lineBreak1=whitespace1&&char1.match(diff_match_patch.linebreakRegex_),lineBreak2=whitespace2&&char2.match(diff_match_patch.linebreakRegex_),blankLine1=lineBreak1&&one.match(diff_match_patch.blanklineEndRegex_),blankLine2=lineBreak2&&two.match(diff_match_patch.blanklineStartRegex_);return blankLine1||blankLine2?5:lineBreak1||lineBreak2?4:nonAlphaNumeric1&&!whitespace1&&whitespace2?3:whitespace1||whitespace2?2:nonAlphaNumeric1||nonAlphaNumeric2?1:0}for(var pointer=1;pointer<diffs.length-1;){if(diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL){var equality1=diffs[pointer-1][1],edit=diffs[pointer][1],equality2=diffs[pointer+1][1],commonOffset=this.diff_commonSuffix(equality1,edit);if(commonOffset){var commonString=edit.substring(edit.length-commonOffset);equality1=equality1.substring(0,equality1.length-commonOffset),edit=commonString+edit.substring(0,edit.length-commonOffset),equality2=commonString+equality2}for(var bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2,bestScore=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);edit.charAt(0)===equality2.charAt(0);){equality1+=edit.charAt(0),edit=edit.substring(1)+equality2.charAt(0),equality2=equality2.substring(1);var score=diff_cleanupSemanticScore_(equality1,edit)+diff_cleanupSemanticScore_(edit,equality2);score>=bestScore&&(bestScore=score,bestEquality1=equality1,bestEdit=edit,bestEquality2=equality2)}diffs[pointer-1][1]!=bestEquality1&&(bestEquality1?diffs[pointer-1][1]=bestEquality1:(diffs.splice(pointer-1,1),pointer--),diffs[pointer][1]=bestEdit,bestEquality2?diffs[pointer+1][1]=bestEquality2:(diffs.splice(pointer+1,1),pointer--))}pointer++}},diff_match_patch.nonAlphaNumericRegex_=/[^a-zA-Z0-9]/,diff_match_patch.whitespaceRegex_=/\s/,diff_match_patch.linebreakRegex_=/[\r\n]/,diff_match_patch.blanklineEndRegex_=/\n\r?\n$/,diff_match_patch.blanklineStartRegex_=/^\r?\n\r?\n/,diff_match_patch.prototype.diff_cleanupEfficiency=function(diffs){for(var changes=!1,equalities=[],equalitiesLength=0,lastequality=null,pointer=0,pre_ins=!1,pre_del=!1,post_ins=!1,post_del=!1;pointer<diffs.length;)diffs[pointer][0]==DIFF_EQUAL?(diffs[pointer][1].length<this.Diff_EditCost&&(post_ins||post_del)?(equalities[equalitiesLength++]=pointer,pre_ins=post_ins,pre_del=post_del,lastequality=diffs[pointer][1]):(equalitiesLength=0,lastequality=null),post_ins=post_del=!1):(diffs[pointer][0]==DIFF_DELETE?post_del=!0:post_ins=!0,lastequality&&(pre_ins&&pre_del&&post_ins&&post_del||lastequality.length<this.Diff_EditCost/2&&pre_ins+pre_del+post_ins+post_del==3)&&(diffs.splice(equalities[equalitiesLength-1],0,[DIFF_DELETE,lastequality]),diffs[equalities[equalitiesLength-1]+1][0]=DIFF_INSERT,equalitiesLength--,lastequality=null,pre_ins&&pre_del?(post_ins=post_del=!0,equalitiesLength=0):(equalitiesLength--,pointer=equalitiesLength>0?equalities[equalitiesLength-1]:-1,post_ins=post_del=!1),changes=!0)),pointer++;changes&&this.diff_cleanupMerge(diffs)},diff_match_patch.prototype.diff_cleanupMerge=function(diffs){diffs.push([DIFF_EQUAL,""]);for(var commonlength,pointer=0,count_delete=0,count_insert=0,text_delete="",text_insert="";pointer<diffs.length;)switch(diffs[pointer][0]){case DIFF_INSERT:count_insert++,text_insert+=diffs[pointer][1],pointer++;break;case DIFF_DELETE:count_delete++,text_delete+=diffs[pointer][1],pointer++;break;case DIFF_EQUAL:count_delete+count_insert>1?(0!==count_delete&&0!==count_insert&&(commonlength=this.diff_commonPrefix(text_insert,text_delete),0!==commonlength&&(pointer-count_delete-count_insert>0&&diffs[pointer-count_delete-count_insert-1][0]==DIFF_EQUAL?diffs[pointer-count_delete-count_insert-1][1]+=text_insert.substring(0,commonlength):(diffs.splice(0,0,[DIFF_EQUAL,text_insert.substring(0,commonlength)]),pointer++),text_insert=text_insert.substring(commonlength),text_delete=text_delete.substring(commonlength)),commonlength=this.diff_commonSuffix(text_insert,text_delete),0!==commonlength&&(diffs[pointer][1]=text_insert.substring(text_insert.length-commonlength)+diffs[pointer][1],text_insert=text_insert.substring(0,text_insert.length-commonlength),text_delete=text_delete.substring(0,text_delete.length-commonlength))),0===count_delete?diffs.splice(pointer-count_insert,count_delete+count_insert,[DIFF_INSERT,text_insert]):0===count_insert?diffs.splice(pointer-count_delete,count_delete+count_insert,[DIFF_DELETE,text_delete]):diffs.splice(pointer-count_delete-count_insert,count_delete+count_insert,[DIFF_DELETE,text_delete],[DIFF_INSERT,text_insert]),pointer=pointer-count_delete-count_insert+(count_delete?1:0)+(count_insert?1:0)+1):0!==pointer&&diffs[pointer-1][0]==DIFF_EQUAL?(diffs[pointer-1][1]+=diffs[pointer][1],diffs.splice(pointer,1)):pointer++,count_insert=0,count_delete=0,text_delete="",text_insert=""}""===diffs[diffs.length-1][1]&&diffs.pop();var changes=!1;for(pointer=1;pointer<diffs.length-1;)diffs[pointer-1][0]==DIFF_EQUAL&&diffs[pointer+1][0]==DIFF_EQUAL&&(diffs[pointer][1].substring(diffs[pointer][1].length-diffs[pointer-1][1].length)==diffs[pointer-1][1]?(diffs[pointer][1]=diffs[pointer-1][1]+diffs[pointer][1].substring(0,diffs[pointer][1].length-diffs[pointer-1][1].length),diffs[pointer+1][1]=diffs[pointer-1][1]+diffs[pointer+1][1],diffs.splice(pointer-1,1),changes=!0):diffs[pointer][1].substring(0,diffs[pointer+1][1].length)==diffs[pointer+1][1]&&(diffs[pointer-1][1]+=diffs[pointer+1][1],diffs[pointer][1]=diffs[pointer][1].substring(diffs[pointer+1][1].length)+diffs[pointer+1][1],diffs.splice(pointer+1,1),changes=!0)),pointer++;changes&&this.diff_cleanupMerge(diffs)},diff_match_patch.prototype.diff_xIndex=function(diffs,loc){var x,chars1=0,chars2=0,last_chars1=0,last_chars2=0;for(x=0;x<diffs.length&&(diffs[x][0]!==DIFF_INSERT&&(chars1+=diffs[x][1].length),diffs[x][0]!==DIFF_DELETE&&(chars2+=diffs[x][1].length),!(chars1>loc));x++)last_chars1=chars1,last_chars2=chars2;return diffs.length!=x&&diffs[x][0]===DIFF_DELETE?last_chars2:last_chars2+(loc-last_chars1)},diff_match_patch.prototype.diff_prettyHtml=function(diffs){for(var html=[],pattern_amp=/&/g,pattern_lt=/</g,pattern_gt=/>/g,pattern_para=/\n/g,x=0;x<diffs.length;x++){var op=diffs[x][0],data=diffs[x][1],text=data.replace(pattern_amp,"&amp;").replace(pattern_lt,"&lt;").replace(pattern_gt,"&gt;").replace(pattern_para,"&para;<br>");switch(op){case DIFF_INSERT:html[x]='<ins style="background:#e6ffe6;">'+text+"</ins>";break;case DIFF_DELETE:html[x]='<del style="background:#ffe6e6;">'+text+"</del>";break;case DIFF_EQUAL:html[x]="<span>"+text+"</span>"}}return html.join("")},diff_match_patch.prototype.diff_text1=function(diffs){for(var text=[],x=0;x<diffs.length;x++)diffs[x][0]!==DIFF_INSERT&&(text[x]=diffs[x][1]);return text.join("")},diff_match_patch.prototype.diff_text2=function(diffs){for(var text=[],x=0;x<diffs.length;x++)diffs[x][0]!==DIFF_DELETE&&(text[x]=diffs[x][1]);return text.join("")},diff_match_patch.prototype.diff_levenshtein=function(diffs){for(var levenshtein=0,insertions=0,deletions=0,x=0;x<diffs.length;x++){var op=diffs[x][0],data=diffs[x][1];switch(op){case DIFF_INSERT:insertions+=data.length;break;case DIFF_DELETE:deletions+=data.length;break;case DIFF_EQUAL:levenshtein+=Math.max(insertions,deletions),insertions=0,deletions=0}}return levenshtein+=Math.max(insertions,deletions)},diff_match_patch.prototype.diff_toDelta=function(diffs){for(var text=[],x=0;x<diffs.length;x++)switch(diffs[x][0]){case DIFF_INSERT:text[x]="+"+encodeURI(diffs[x][1]);break;case DIFF_DELETE:text[x]="-"+diffs[x][1].length;break;case DIFF_EQUAL:text[x]="="+diffs[x][1].length}return text.join("	").replace(/%20/g," ")},diff_match_patch.prototype.diff_fromDelta=function(text1,delta){for(var diffs=[],diffsLength=0,pointer=0,tokens=delta.split(/\t/g),x=0;x<tokens.length;x++){var param=tokens[x].substring(1);switch(tokens[x].charAt(0)){case"+":try{diffs[diffsLength++]=[DIFF_INSERT,decodeURI(param)]}catch(ex){throw new Error("Illegal escape in diff_fromDelta: "+param)}break;case"-":case"=":var n=parseInt(param,10);if(isNaN(n)||0>n)throw new Error("Invalid number in diff_fromDelta: "+param);var text=text1.substring(pointer,pointer+=n);"="==tokens[x].charAt(0)?diffs[diffsLength++]=[DIFF_EQUAL,text]:diffs[diffsLength++]=[DIFF_DELETE,text];break;default:if(tokens[x])throw new Error("Invalid diff operation in diff_fromDelta: "+tokens[x])}}if(pointer!=text1.length)throw new Error("Delta length ("+pointer+") does not equal source text length ("+text1.length+").");return diffs},diff_match_patch.prototype.match_main=function(text,pattern,loc){if(null==text||null==pattern||null==loc)throw new Error("Null input. (match_main)");return loc=Math.max(0,Math.min(loc,text.length)),text==pattern?0:text.length?text.substring(loc,loc+pattern.length)==pattern?loc:this.match_bitap_(text,pattern,loc):-1},diff_match_patch.prototype.match_bitap_=function(text,pattern,loc){function match_bitapScore_(e,x){var accuracy=e/pattern.length,proximity=Math.abs(loc-x);return dmp.Match_Distance?accuracy+proximity/dmp.Match_Distance:proximity?1:accuracy}if(pattern.length>this.Match_MaxBits)throw new Error("Pattern too long for this browser.");var s=this.match_alphabet_(pattern),dmp=this,score_threshold=this.Match_Threshold,best_loc=text.indexOf(pattern,loc);-1!=best_loc&&(score_threshold=Math.min(match_bitapScore_(0,best_loc),score_threshold),best_loc=text.lastIndexOf(pattern,loc+pattern.length),-1!=best_loc&&(score_threshold=Math.min(match_bitapScore_(0,best_loc),score_threshold)));var matchmask=1<<pattern.length-1;best_loc=-1;for(var bin_min,bin_mid,last_rd,bin_max=pattern.length+text.length,d=0;d<pattern.length;d++){for(bin_min=0,bin_mid=bin_max;bin_mid>bin_min;)match_bitapScore_(d,loc+bin_mid)<=score_threshold?bin_min=bin_mid:bin_max=bin_mid,bin_mid=Math.floor((bin_max-bin_min)/2+bin_min);bin_max=bin_mid;var start=Math.max(1,loc-bin_mid+1),finish=Math.min(loc+bin_mid,text.length)+pattern.length,rd=Array(finish+2);rd[finish+1]=(1<<d)-1;for(var j=finish;j>=start;j--){var charMatch=s[text.charAt(j-1)];if(0===d?rd[j]=(rd[j+1]<<1|1)&charMatch:rd[j]=(rd[j+1]<<1|1)&charMatch|((last_rd[j+1]|last_rd[j])<<1|1)|last_rd[j+1],rd[j]&matchmask){var score=match_bitapScore_(d,j-1);if(score_threshold>=score){if(score_threshold=score,best_loc=j-1,!(best_loc>loc))break;start=Math.max(1,2*loc-best_loc)}}}if(match_bitapScore_(d+1,loc)>score_threshold)break;last_rd=rd}return best_loc},diff_match_patch.prototype.match_alphabet_=function(pattern){for(var s={},i=0;i<pattern.length;i++)s[pattern.charAt(i)]=0;for(var i=0;i<pattern.length;i++)s[pattern.charAt(i)]|=1<<pattern.length-i-1;return s},diff_match_patch.prototype.patch_addContext_=function(patch,text){if(0!=text.length){for(var pattern=text.substring(patch.start2,patch.start2+patch.length1),padding=0;text.indexOf(pattern)!=text.lastIndexOf(pattern)&&pattern.length<this.Match_MaxBits-this.Patch_Margin-this.Patch_Margin;)padding+=this.Patch_Margin,pattern=text.substring(patch.start2-padding,patch.start2+patch.length1+padding);padding+=this.Patch_Margin;var prefix=text.substring(patch.start2-padding,patch.start2);prefix&&patch.diffs.unshift([DIFF_EQUAL,prefix]);var suffix=text.substring(patch.start2+patch.length1,patch.start2+patch.length1+padding);suffix&&patch.diffs.push([DIFF_EQUAL,suffix]),patch.start1-=prefix.length,patch.start2-=prefix.length,patch.length1+=prefix.length+suffix.length,patch.length2+=prefix.length+suffix.length}},diff_match_patch.prototype.patch_make=function(a,opt_b,opt_c){var text1,diffs;if("string"==typeof a&&"string"==typeof opt_b&&"undefined"==typeof opt_c)text1=a,diffs=this.diff_main(text1,opt_b,!0),diffs.length>2&&(this.diff_cleanupSemantic(diffs),this.diff_cleanupEfficiency(diffs));else if(a&&"object"==typeof a&&"undefined"==typeof opt_b&&"undefined"==typeof opt_c)diffs=a,text1=this.diff_text1(diffs);else if("string"==typeof a&&opt_b&&"object"==typeof opt_b&&"undefined"==typeof opt_c)text1=a,diffs=opt_b;else{if("string"!=typeof a||"string"!=typeof opt_b||!opt_c||"object"!=typeof opt_c)throw new Error("Unknown call format to patch_make.");text1=a,diffs=opt_c}if(0===diffs.length)return[];for(var patches=[],patch=new diff_match_patch.patch_obj,patchDiffLength=0,char_count1=0,char_count2=0,prepatch_text=text1,postpatch_text=text1,x=0;x<diffs.length;x++){var diff_type=diffs[x][0],diff_text=diffs[x][1];switch(patchDiffLength||diff_type===DIFF_EQUAL||(patch.start1=char_count1,patch.start2=char_count2),diff_type){case DIFF_INSERT:patch.diffs[patchDiffLength++]=diffs[x],patch.length2+=diff_text.length,postpatch_text=postpatch_text.substring(0,char_count2)+diff_text+postpatch_text.substring(char_count2);break;case DIFF_DELETE:patch.length1+=diff_text.length,patch.diffs[patchDiffLength++]=diffs[x],postpatch_text=postpatch_text.substring(0,char_count2)+postpatch_text.substring(char_count2+diff_text.length);break;case DIFF_EQUAL:diff_text.length<=2*this.Patch_Margin&&patchDiffLength&&diffs.length!=x+1?(patch.diffs[patchDiffLength++]=diffs[x],patch.length1+=diff_text.length,patch.length2+=diff_text.length):diff_text.length>=2*this.Patch_Margin&&patchDiffLength&&(this.patch_addContext_(patch,prepatch_text),patches.push(patch),patch=new diff_match_patch.patch_obj,patchDiffLength=0,prepatch_text=postpatch_text,char_count1=char_count2)}diff_type!==DIFF_INSERT&&(char_count1+=diff_text.length),diff_type!==DIFF_DELETE&&(char_count2+=diff_text.length)}return patchDiffLength&&(this.patch_addContext_(patch,prepatch_text),patches.push(patch)),patches},diff_match_patch.prototype.patch_deepCopy=function(patches){for(var patchesCopy=[],x=0;x<patches.length;x++){var patch=patches[x],patchCopy=new diff_match_patch.patch_obj;patchCopy.diffs=[];for(var y=0;y<patch.diffs.length;y++)patchCopy.diffs[y]=patch.diffs[y].slice();patchCopy.start1=patch.start1,patchCopy.start2=patch.start2,patchCopy.length1=patch.length1,patchCopy.length2=patch.length2,patchesCopy[x]=patchCopy}return patchesCopy},diff_match_patch.prototype.patch_apply=function(patches,text){if(0==patches.length)return[text,[]];patches=this.patch_deepCopy(patches);var nullPadding=this.patch_addPadding(patches);text=nullPadding+text+nullPadding,this.patch_splitMax(patches);for(var delta=0,results=[],x=0;x<patches.length;x++){var start_loc,expected_loc=patches[x].start2+delta,text1=this.diff_text1(patches[x].diffs),end_loc=-1;if(text1.length>this.Match_MaxBits?(start_loc=this.match_main(text,text1.substring(0,this.Match_MaxBits),expected_loc),-1!=start_loc&&(end_loc=this.match_main(text,text1.substring(text1.length-this.Match_MaxBits),expected_loc+text1.length-this.Match_MaxBits),(-1==end_loc||start_loc>=end_loc)&&(start_loc=-1))):start_loc=this.match_main(text,text1,expected_loc),-1==start_loc)results[x]=!1,delta-=patches[x].length2-patches[x].length1;else{results[x]=!0,delta=start_loc-expected_loc;var text2;if(text2=-1==end_loc?text.substring(start_loc,start_loc+text1.length):text.substring(start_loc,end_loc+this.Match_MaxBits),text1==text2)text=text.substring(0,start_loc)+this.diff_text2(patches[x].diffs)+text.substring(start_loc+text1.length);else{var diffs=this.diff_main(text1,text2,!1);if(text1.length>this.Match_MaxBits&&this.diff_levenshtein(diffs)/text1.length>this.Patch_DeleteThreshold)results[x]=!1;else{this.diff_cleanupSemanticLossless(diffs);for(var index2,index1=0,y=0;y<patches[x].diffs.length;y++){var mod=patches[x].diffs[y];mod[0]!==DIFF_EQUAL&&(index2=this.diff_xIndex(diffs,index1)),mod[0]===DIFF_INSERT?text=text.substring(0,start_loc+index2)+mod[1]+text.substring(start_loc+index2):mod[0]===DIFF_DELETE&&(text=text.substring(0,start_loc+index2)+text.substring(start_loc+this.diff_xIndex(diffs,index1+mod[1].length))),mod[0]!==DIFF_DELETE&&(index1+=mod[1].length)}}}}}return text=text.substring(nullPadding.length,text.length-nullPadding.length),[text,results]},diff_match_patch.prototype.patch_addPadding=function(patches){for(var paddingLength=this.Patch_Margin,nullPadding="",x=1;paddingLength>=x;x++)nullPadding+=String.fromCharCode(x);for(var x=0;x<patches.length;x++)patches[x].start1+=paddingLength,patches[x].start2+=paddingLength;var patch=patches[0],diffs=patch.diffs;if(0==diffs.length||diffs[0][0]!=DIFF_EQUAL)diffs.unshift([DIFF_EQUAL,nullPadding]),patch.start1-=paddingLength,patch.start2-=paddingLength,patch.length1+=paddingLength,patch.length2+=paddingLength;else if(paddingLength>diffs[0][1].length){var extraLength=paddingLength-diffs[0][1].length;diffs[0][1]=nullPadding.substring(diffs[0][1].length)+diffs[0][1],patch.start1-=extraLength,patch.start2-=extraLength,patch.length1+=extraLength,patch.length2+=extraLength}if(patch=patches[patches.length-1],diffs=patch.diffs,0==diffs.length||diffs[diffs.length-1][0]!=DIFF_EQUAL)diffs.push([DIFF_EQUAL,nullPadding]),patch.length1+=paddingLength,patch.length2+=paddingLength;else if(paddingLength>diffs[diffs.length-1][1].length){var extraLength=paddingLength-diffs[diffs.length-1][1].length;diffs[diffs.length-1][1]+=nullPadding.substring(0,extraLength),patch.length1+=extraLength,patch.length2+=extraLength}return nullPadding},diff_match_patch.prototype.patch_splitMax=function(patches){for(var patch_size=this.Match_MaxBits,x=0;x<patches.length;x++)if(!(patches[x].length1<=patch_size)){var bigpatch=patches[x];patches.splice(x--,1);for(var start1=bigpatch.start1,start2=bigpatch.start2,precontext="";0!==bigpatch.diffs.length;){var patch=new diff_match_patch.patch_obj,empty=!0;for(patch.start1=start1-precontext.length,patch.start2=start2-precontext.length,""!==precontext&&(patch.length1=patch.length2=precontext.length,patch.diffs.push([DIFF_EQUAL,precontext]));0!==bigpatch.diffs.length&&patch.length1<patch_size-this.Patch_Margin;){var diff_type=bigpatch.diffs[0][0],diff_text=bigpatch.diffs[0][1];diff_type===DIFF_INSERT?(patch.length2+=diff_text.length,start2+=diff_text.length,patch.diffs.push(bigpatch.diffs.shift()),empty=!1):diff_type===DIFF_DELETE&&1==patch.diffs.length&&patch.diffs[0][0]==DIFF_EQUAL&&diff_text.length>2*patch_size?(patch.length1+=diff_text.length,start1+=diff_text.length,empty=!1,patch.diffs.push([diff_type,diff_text]),bigpatch.diffs.shift()):(diff_text=diff_text.substring(0,patch_size-patch.length1-this.Patch_Margin),patch.length1+=diff_text.length,start1+=diff_text.length,diff_type===DIFF_EQUAL?(patch.length2+=diff_text.length,start2+=diff_text.length):empty=!1,patch.diffs.push([diff_type,diff_text]),diff_text==bigpatch.diffs[0][1]?bigpatch.diffs.shift():bigpatch.diffs[0][1]=bigpatch.diffs[0][1].substring(diff_text.length))}precontext=this.diff_text2(patch.diffs),precontext=precontext.substring(precontext.length-this.Patch_Margin);var postcontext=this.diff_text1(bigpatch.diffs).substring(0,this.Patch_Margin);""!==postcontext&&(patch.length1+=postcontext.length,patch.length2+=postcontext.length,0!==patch.diffs.length&&patch.diffs[patch.diffs.length-1][0]===DIFF_EQUAL?patch.diffs[patch.diffs.length-1][1]+=postcontext:patch.diffs.push([DIFF_EQUAL,postcontext])),empty||patches.splice(++x,0,patch)}}},diff_match_patch.prototype.patch_toText=function(patches){for(var text=[],x=0;x<patches.length;x++)text[x]=patches[x];return text.join("")},diff_match_patch.prototype.patch_fromText=function(textline){var patches=[];if(!textline)return patches;for(var text=textline.split("\n"),textPointer=0,patchHeader=/^@@ -(\d+),?(\d*) \+(\d+),?(\d*) @@$/;textPointer<text.length;){var m=text[textPointer].match(patchHeader);if(!m)throw new Error("Invalid patch string: "+text[textPointer]);var patch=new diff_match_patch.patch_obj;for(patches.push(patch),patch.start1=parseInt(m[1],10),""===m[2]?(patch.start1--,patch.length1=1):"0"==m[2]?patch.length1=0:(patch.start1--,patch.length1=parseInt(m[2],10)),patch.start2=parseInt(m[3],10),""===m[4]?(patch.start2--,patch.length2=1):"0"==m[4]?patch.length2=0:(patch.start2--,patch.length2=parseInt(m[4],10)),textPointer++;textPointer<text.length;){var sign=text[textPointer].charAt(0);try{var line=decodeURI(text[textPointer].substring(1))}catch(ex){throw new Error("Illegal escape in patch_fromText: "+line)}if("-"==sign)patch.diffs.push([DIFF_DELETE,line]);else if("+"==sign)patch.diffs.push([DIFF_INSERT,line]);else if(" "==sign)patch.diffs.push([DIFF_EQUAL,line]);else{if("@"==sign)break;if(""!==sign)throw new Error('Invalid patch mode "'+sign+'" in: '+line)}textPointer++}}return patches},diff_match_patch.patch_obj=function(){this.diffs=[],this.start1=null,this.start2=null,this.length1=0,this.length2=0},diff_match_patch.patch_obj.prototype.toString=function(){var coords1,coords2;coords1=0===this.length1?this.start1+",0":1==this.length1?this.start1+1:this.start1+1+","+this.length1,coords2=0===this.length2?this.start2+",0":1==this.length2?this.start2+1:this.start2+1+","+this.length2;for(var op,text=["@@ -"+coords1+" +"+coords2+" @@\n"],x=0;x<this.diffs.length;x++){switch(this.diffs[x][0]){case DIFF_INSERT:op="+";break;case DIFF_DELETE:op="-";break;case DIFF_EQUAL:op=" "}text[x+1]=op+encodeURI(this.diffs[x][1])+"\n"}return text.join("").replace(/%20/g," ")},this.diff_match_patch=diff_match_patch,this.DIFF_DELETE=DIFF_DELETE,this.DIFF_INSERT=DIFF_INSERT,this.DIFF_EQUAL=DIFF_EQUAL,function(){boundless_module("Boundless"),
Boundless.DiffProcessor=function(){function DiffProcessor(){}return DiffProcessor.diff=function(source_text,target_text){var diff,dmp;return dmp=new diff_match_patch,dmp.Diff_EditCost=8,diff=dmp.diff_main(source_text,target_text),dmp.diff_cleanupEfficiency(diff),dmp.diff_prettyHtml(diff)},DiffProcessor}()}.call(this),function(){Boundless.append_view_path("book_editor/views"),Boundless.BookEditor||(Boundless.BookEditor={}),Boundless.BookEditor.App=function(){function App(book_attributes){Boundless.BookEditor.instance=this,this.book=new Boundless.Book(book_attributes),this.structure_controller=new Boundless.BookEditor.StructureController({el:$(".book__editor__structure-cont"),book:this.book}),this.search_controller=new Boundless.BookEditor.SearchController({el:$(".book__editor__search-cont"),book:this.book})}return App.prototype.save=function(options){return events.trigger("save:book",options)},App.prototype.contentChangedSinceLoad=function(){return!0},App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookEditor.SearchController=function(superClass){function SearchController(){return SearchController.__super__.constructor.apply(this,arguments)}return extend(SearchController,superClass),SearchController.prototype.template="search",SearchController.prototype.initialize=function(params){return null==params&&(params={}),SearchController.__super__.initialize.apply(this,arguments),this.model_view=new Boundless.BookEditor.BookSearchViewModel(params.book),this.render(),this},SearchController.prototype.render=function(){return SearchController.__super__.render.apply(this,arguments),ko.applyBindings(this.model_view,this.el)},SearchController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookEditor.StructureController=function(superClass){function StructureController(){return StructureController.__super__.constructor.apply(this,arguments)}return extend(StructureController,superClass),StructureController.prototype.template="structure",StructureController.prototype.initialize=function(params){return null==params&&(params={}),StructureController.__super__.initialize.apply(this,arguments),this.book=params.book,this.model_view=new Boundless.BookEditor.BookStructureViewModel(this.book),events.on("save:book",function(_this){return function(options){return _this.model_view.save_book(options)}}(this)),this.render(),this},StructureController.prototype.render=function(){return StructureController.__super__.render.apply(this,arguments),ko.applyBindings(this.model_view,this.el)},StructureController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ObservableContainer=function(){function ObservableContainer(json){this.remove_child=bind(this.remove_child,this),this.as_search_result=ko.observable(json.as_search_result||!1),this.editable=ko.observable(null!=json.editable?json.editable:!0),this.editing=ko.observable(!1),this.showing_children=ko.observable(!1),this.path=ko.observable(json.path),this.title=ko.observable(json.title),this.unique_id=ko.observable(json.unique_id),this.book_title=ko.observable(json.book_title),this.attribution=ko.observable(json.attribution),this.subject_tag_name=ko.observable(json.subject_tag_name),this.subject_tag_slug=ko.observable(json.subject_tag_slug)}return ObservableContainer.prototype.toggle_children=function(){return this.showing_children(!this.showing_children())},ObservableContainer.prototype.toggle_editing=function(){return this.editable()?this.editing(!this.editing()):void 0},ObservableContainer.prototype.enter_check=function(d,e){return e.keyCode===KeyCode.ENTER?this.toggle_editing():!0},ObservableContainer.prototype.remove_child=function(child){return this.children.remove(child)},ObservableContainer.prototype.remove_from_search=function(){return this.editable(!0),this.as_search_result(!1),null!=this.children?_.each(this.children(),function(child){return child.remove_from_search()}):void 0},ObservableContainer}(),Boundless.ObservableChapter=function(superClass){function ObservableChapter(chapter_json){ObservableChapter.__super__.constructor.apply(this,arguments),this.children=ko.observableArray(_.map(chapter_json.sections,function(_this){return function(section_json){return new Boundless.ObservableSection(_.extend({editable:_this.editable()},section_json))}}(this)))}return extend(ObservableChapter,superClass),ObservableChapter.prototype.add_section=function(){var section;return section=new Boundless.ObservableSection({title:"New Section",concepts:[]}),this.children.push(section)},ObservableChapter.prototype.from_json=function(json){return this.title(json.title),this.unique_id(json.unique_id),_.each(json.sections,function(_this){return function(section_json,index){return _this.children()[index].from_json(section_json)}}(this))},ObservableChapter.prototype.to_json=function(){return{title:this.title(),unique_id:this.unique_id(),sections:_.map(this.children(),function(section){return section.to_json()})}},ObservableChapter.prototype.class_name=function(){return"chapter"},ObservableChapter}(Boundless.ObservableContainer),Boundless.ObservableSection=function(superClass){function ObservableSection(section_json){ObservableSection.__super__.constructor.apply(this,arguments),this.children=ko.observableArray(_.map(section_json.concepts,function(_this){return function(concept_json){return new Boundless.ObservableConcept(_.extend({editable:_this.editable()},concept_json))}}(this)))}return extend(ObservableSection,superClass),ObservableSection.prototype.add_concept=function(){var opts;return opts=Object.create(null),opts.on_complete=function(_this){return function(atom){var concept;return concept=new Boundless.ObservableConcept({title:atom.get("title"),atom_id:atom.id}),_this.children.push(concept)}}(this),Boundless.CreateAtom.trigger(opts)},ObservableSection.prototype.from_json=function(json){return this.title(json.title),this.unique_id(json.unique_id),_.each(json.concepts,function(_this){return function(concept_json,index){return _this.children()[index].from_json(concept_json)}}(this))},ObservableSection.prototype.to_json=function(){return{title:this.title(),unique_id:this.unique_id(),concepts:_.map(this.children(),function(concept){return concept.to_json()})}},ObservableSection.prototype.class_name=function(){return"section"},ObservableSection}(Boundless.ObservableContainer),Boundless.ObservableConcept=function(superClass){function ObservableConcept(concept_json){ObservableConcept.__super__.constructor.apply(this,arguments),this.atom_id=ko.observable(concept_json.atom_id||null),this.highlight=ko.observable(concept_json.highlight),null==concept_json.path&&null!=concept_json.atom_id&&(this.path=ko.observable("/atoms/"+concept_json.atom_id))}return extend(ObservableConcept,superClass),ObservableConcept.prototype.from_json=function(json){return this.title(json.title),this.unique_id(json.unique_id),this.atom_id(json.atom_id)},ObservableConcept.prototype.to_json=function(){return{title:this.title(),unique_id:this.unique_id(),atom_id:this.atom_id()}},ObservableConcept.prototype.class_name=function(){return"concept"},ObservableConcept}(Boundless.ObservableContainer)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Boundless.BookEditor.BookSearchViewModel=function(){function BookSearchViewModel(book){this.set_search_type=bind(this.set_search_type,this),this.set_subject=bind(this.set_subject,this),this.subject_list=bind(this.subject_list,this),this.search_types=ko.observableArray([{name:"Any Type",type:"chapter,section,concept"},{name:"Chapters",type:"chapter"},{name:"Sections",type:"section"},{name:"Concepts",type:"concept"}]),this.search_type=ko.observable(this.search_types()[0]),this.subjects=ko.observableArray(this.subject_list(book)),this.subjects.unshift({name:"All Subjects"}),this.subject=ko.observable({name:"All Subjects"}),book.get("subject_tag_id")&&this.subject(_.findWhere(this.subjects(),{id:book.get("subject_tag_id")})),this.locked_atoms=book.get("locked_atoms"),this.instant_search_term=ko.observable(""),this.searching=ko.observable(!1),this.instant_search_term.subscribe(function(_this){return function(val){return _this.searching(!_this.search_is_empty())}}(this)),this.search_term=ko.pureComputed(this.instant_search_term).extend({rateLimit:{method:"notifyWhenChangesStop",timeout:400}}),this.search_term.subscribe(function(_this){return function(val){return _this.search_is_empty()?_this.searching(!1):_this.update_search()}}(this)),this.search_results=ko.observableArray([]),this.latest_callback_timestamp=null}return BookSearchViewModel.prototype.subject_list=function(book){var bookSubject,ref,subjects;return subjects=_.map(PageData.subjects,function(_this){return function(x){return _.omit(x,"chegg")}}(this)),(null!=(ref=book.get("subject_tag"))?ref.id:void 0)?(bookSubject=_.pick(book.get("subject_tag").attributes,"id","name","permalink"),_.chain(_.union(subjects,[bookSubject])).uniq(function(_this){return function(subject){return subject.id}}(this)).sortBy(function(_this){return function(subject){return subject.name}}(this)).value()):subjects},BookSearchViewModel.prototype.set_subject=function(subject){return this.subject(subject),this.search_is_empty()?void 0:this.update_search()},BookSearchViewModel.prototype.set_search_type=function(search_type){return this.search_type(search_type),this.search_is_empty()?void 0:this.update_search()},BookSearchViewModel.prototype.update_search=function(){var timestamp;return timestamp=Number(new Date),this.latest_callback_timestamp=timestamp,$.get(Boundless.API+"/books/part_search/",{query:this.search_term(),search_type:this.search_type().type,subject_tag_id:this.subject().id},function(_this){return function(results){return timestamp===_this.latest_callback_timestamp&&""!==_this.instant_search_term()?(_this.searching(!1),_this.parse_search_results(results)):void 0}}(this))},BookSearchViewModel.prototype.parse_search_results=function(results_array){return this.search_results(_.map(results_array,function(_this){return function(result){return _this.wrap_result(result)}}(this)))},BookSearchViewModel.prototype.reset_search=function(){return this.instant_search_term(""),this.search_results([]),$(".book__editor__search-input").focus()},BookSearchViewModel.prototype.search_is_empty=function(){return""===this.instant_search_term()},BookSearchViewModel.prototype.wrap_result=function(result){var result_klass;return result_klass="atom"===result.type?Boundless.ObservableConcept:eval("Boundless.Observable"+(result.type.charAt(0).toUpperCase()+result.type.slice(1))),"atom"===result.type&&(result.atom_id=result.id),new result_klass(_.extend({as_search_result:!0,editable:!1},result))},BookSearchViewModel}()}.call(this),function(){var arrays_equal,objects_equal,bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookEditor.BookStructureViewModel=function(superClass){function BookStructureViewModel(model){this.remove_child=bind(this.remove_child,this),BookStructureViewModel.__super__.constructor.call(this,model),this.chapters=ko.observableArray(_.map(model.get("chapters_json"),function(chapter_json){return new Boundless.ObservableChapter(chapter_json)})),this.last_clean_state=ko.observable(this.chapters_to_json()),this.dirty=ko.pureComputed(function(_this){return function(){return!arrays_equal(_this.chapters_to_json(),_this.last_clean_state())}}(this)),this.save_timeout_func=null,this.dirty.subscribe(function(_this){return function(dirty){return dirty?_this.save_timeout_func||(_this.save_timeout_func=setTimeout(function(){return _this.save_timeout_func=null,_this.save_book()},3e4)):void 0}}(this))}return extend(BookStructureViewModel,superClass),BookStructureViewModel.prototype.collapse_all=function(){return _.each(this.chapters(),function(chapter){return chapter.showing_children(!1)})},BookStructureViewModel.prototype.expand_all=function(){return _.each(this.chapters(),function(chapter){return chapter.showing_children(!0)})},BookStructureViewModel.prototype.remove_child=function(chapter){return this.chapters.remove(chapter)},BookStructureViewModel.prototype.add_chapter=function(){var chapter;return chapter=new Boundless.ObservableChapter({title:"New Chapter",sections:[]}),this.chapters.push(chapter)},BookStructureViewModel.prototype.save_book=function(options){return this.dirty()||(null!=options?options.force:void 0)?(events.trigger("editor:prevent_saving"),events.trigger("editor:status","<i class='icon-spinner icon-spin'></i> Saving..."),this.chapters_json(this.chapters_to_json()),this.model().save({},{success:function(_this){return function(model){return _.each(model.get("chapters_json"),function(chapter_json,index){return _this.chapters()[index].from_json(chapter_json)}),_this.clear_dirty_flag(),null!=options&&"function"==typeof options.success&&options.success(),events.trigger("editor:status","<i class='icon-ok'></i> Saved!",1e3),events.trigger("editor:prevent_saving",!1)}}(this),error:function(_this){return function(model){return null!=options&&"function"==typeof options.error&&options.error(),events.trigger("editor:save_error")}}(this)})):null!=options&&"function"==typeof options.success?options.success():void 0},BookStructureViewModel.prototype.finish_drop=function(arg){return arg.item.remove_from_search()},BookStructureViewModel.prototype.chapters_to_json=function(){return _.map(this.chapters(),function(chapter){return chapter.to_json()})},BookStructureViewModel.prototype.clear_dirty_flag=function(){return this.last_clean_state(this.chapters_to_json())},BookStructureViewModel}(kb.ViewModel),arrays_equal=function(left,right){var i,item,j,len;if(!right)return!1;if(left.length!==right.length)return!1;for(i=j=0,len=left.length;len>j;i=++j)if(item=left[i],item instanceof Array&&right[i]instanceof Array){if(!arrays_equal(item,right[i]))return!1}else if(item instanceof Object&&right[i]instanceof Object){if(!objects_equal(item,right[i]))return!1}else if(item!==right[i])return!1;return!0},objects_equal=function(left,right){var key,value;if(!right)return!1;for(key in left)if(value=left[key],value instanceof Array&&right[key]instanceof Array){if(!arrays_equal(value,right[key]))return!1}else if(value instanceof Object&&right[key]instanceof Object){if(!objects_equal(value,right[key]))return!1}else if(value!==right[key])return!1;return!0}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_editor/views/chapter"]=function(context){return function(){var $o,$p,$r;return $p=window.HAML.preserve,$r=window.HAML.reference,$o=[],$o.push("<li class='book__editor__chapter' data-bind=\"attr: { 'data-id': unique_id }\">\n  <div class='book__editor__chapter-container'>\n    <i class='icon-remove' data-bind='click: $parent.remove_child'></i>\n    <div class='book__editor__pill'>\n      <i class='icon-caret-right' data-bind='click: toggle_children, css: {expanded: showing_children}'></i>\n      <span class='book__editor__title' data-bind='click: toggle_editing, visible: !editing()'>\n        <span class='book__editor__number' data-bind=\"text: as_search_result() ? 'Chapter:' : 'Ch ' + ($index() + 1) + '.'\"></span>\n        <span data-bind='text: title'></span>\n      </span>\n      <input class='book__editor__title-editor' data-bind='value: title, visible: editing, hasFocus: editing, event: { keypress: enter_check }'>\n      <a class='book__editor__preview-link' data-bind=\"attr: { 'href': path }, visible: as_search_result()\" target='_blank'>\n        <i class='icon-eye-open'></i>\n      </a>\n    </div>\n  </div>\n  <div class='book__editor__origin' data-bind='visible: as_search_result() && book_title'>\n    <i data-bind=\"attr: { 'class': 'bicon-tiny bicon-color-' + subject_tag_slug() } \"></i>\n    <span class='book__editor__origin__title' data-bind='text: book_title'></span>\n    <span class='book__editor__origin__attribution' data-bind='text: attribution'></span>\n  </div>\n  <ul class='book__editor__sections' data-bind=\"visible: showing_children, sortable: { data: children, template: 'book_editor/views/section', connectClass: 'book__editor__sections', afterMove: $root.finish_drop, isEnabled: showing_children, allowDrop: !as_search_result() }\"></ul>\n  <a class='book__editor__new-button book__editor__new-section-button' data-bind='visible: showing_children() && editable(), click: add_section'>\n    <i class='icon-plus'></i>\n    New Section\n  </a>\n</li>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_editor/views/concept"]=function(context){return function(){var $o,$p;return $p=window.HAML.preserve,$o=[],$o.push("<li class='book__editor__concept' data-bind=\"attr: { 'data-id': unique_id, 'data-atom-id': atom_id }\">\n  <div class='book__editor__concept-container'>\n    <i class='icon-remove' data-bind='click: $parent.remove_child'></i>\n    <div class='book__editor__pill'>\n      <span class='book__editor__title no_edit'>\n        <span class='book__editor__number' data-bind=\"text: as_search_result() ? 'Concept:' : ($index() + 1) + '.'\"></span>\n        <span data-bind='text: title'></span>\n      </span>\n      <a class='book__editor__preview-link' data-bind=\"attr: { 'href': path }, visible: path()\" target='_blank'>\n        <i class='icon-eye-open'></i>\n      </a>\n    </div>\n  </div>\n  <div class='book__editor__origin' data-bind='visible: as_search_result() && attribution'>\n    <i data-bind=\"attr: { 'class': 'bicon-tiny bicon-color-' + subject_tag_slug() } \"></i>\n    <span class='book__editor__origin__highlight' data-bind=\"html: highlight() ? '...' + highlight() + '...' : '(empty)'\"></span>\n    <span class='book__editor__origin__attribution' data-bind='html: attribution'></span>\n  </div>\n</li>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_editor/views/search"]=function(context){return function(){var $o,$p;return $p=window.HAML.preserve,$o=[],$o.push("<div class='book__editor__search'>\n  <div class='book__editor__search-input-cont'>\n    <input class='book__editor__search-input' type='text' placeholder='Search for anything' data-bind=\"value: instant_search_term, valueUpdate: ['input', 'afterkeydown']\">\n    <i class='icon-remove-sign' data-bind=\"visible: (!searching() && instant_search_term() != ''), click: reset_search\"></i>\n    <i class='icon-spin icon-spinner' data-bind='visible: searching'></i>\n  </div>\n  <div class='book__editor__search-controls'>\n    <div class='btn-group'>\n      <a class='btn dropdown-toggle' id='subject_select' data-toggle='dropdown' data-bind='text: subject().name'></a>\n      <ul class='dropdown dropdown-menu' id='search_subjects' data-bind='foreach: subjects'>\n        <li>\n          <a class='dropdown-link' data-bind='click: $parent.set_subject, text: name'></a>\n        </li>\n      </ul>\n    </div>\n    <div class='btn-group'>\n      <a class='btn dropdown-toggle' id='type_select' data-toggle='dropdown' data-bind='text: search_type().name'></a>\n      <ul class='dropdown dropdown-menu' id='search_types' data-bind='foreach: search_types'>\n        <li>\n          <a class='dropdown-link' data-bind='text: name, click: $parent.set_search_type'></a>\n        </li>\n      </ul>\n    </div>\n  </div>\n  <div class='book__editor__search__results' data-bind=\"template: { name: 'book_editor/views/search_result', foreach: search_results }\"></div>\n</div>\n<div class='book__editor__orientation'>\n  <ul>\n    <li>\n      <i class='icon-align-justify'></i>\n      Your book outline is on the right.\n    </li>\n    <li>\n      <i class='icon-indent-right'></i>\n      Click on chapters, sections and concepts to expand them.\n    </li>\n    <li>\n      <i class='icon-hand-up'></i>\n      Drag items to rearrange them.\n    </li>\n    <li>\n      <i class='icon-font'></i>\n      Click item titles to re-name them.\n    </li>\n    <li>\n      <i class='icon-search'></i>\n      Search the content library above to find new content to put in your book.\n    </li>\n    <li>\n      <i class='icon-cloud-upload'></i>\n      Your changes save automatically as you edit.\n    </li>\n  </ul>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_editor/views/search_result"]=function(context){return function(){var $o;return $o=[],$o.push('<ul class=\'book__editor__search__result-cont\' data-bind=\'sortable: { template: function(result) { return "book_editor/views/" + result.class_name(); }, data: ko.observableArray([$data]), connectClass: "book__editor__" + $data.class_name() + "s", allowDrop: false }\'></ul>'),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_editor/views/section"]=function(context){return function(){var $o,$p,$r;return $p=window.HAML.preserve,$r=window.HAML.reference,$o=[],$o.push("<li class='book__editor__section' data-bind=\"attr: { 'data-id': unique_id }\">\n  <div class='book__editor__section-container'>\n    <i class='icon-remove' data-bind='click: $parent.remove_child'></i>\n    <div class='book__editor__pill'>\n      <i class='icon-caret-right' data-bind='click: toggle_children, css: {expanded: showing_children}'></i>\n      <span class='book__editor__title' data-bind='click: toggle_editing, visible: !editing()'>\n        <span class='book__editor__number' data-bind=\"text: as_search_result() ? 'Section:' : 'Sec ' + ($index() + 1) + '.'\"></span>\n        <span data-bind='text: title'></span>\n      </span>\n      <input class='book__editor__title-editor' data-bind='value: title, visible: editing, hasFocus: editing, event: { keypress: enter_check }'>\n      <a class='book__editor__preview-link' data-bind=\"attr: { 'href': path }, visible: as_search_result()\" target='_blank'>\n        <i class='icon-eye-open'></i>\n      </a>\n    </div>\n  </div>\n  <div class='book__editor__origin' data-bind='visible: as_search_result() && book_title'>\n    <i data-bind=\"attr: { 'class': 'bicon-tiny bicon-color-' + subject_tag_slug() } \"></i>\n    <span class='book__editor__origin__title' data-bind='text: book_title'></span>\n    <span class='book__editor__origin__attribution' data-bind='text: attribution'></span>\n  </div>\n  <ul class='book__editor__concepts' data-bind=\"visible: showing_children, sortable: { data: children, template: 'book_editor/views/concept', connectClass: 'book__editor__concepts', afterMove: $root.finish_drop, isEnabled: showing_children, allowDrop: !as_search_result() }\"></ul>\n  <a class='book__editor__new-button book__editor__new-concept-button' data-bind='visible: showing_children() && editable(), click: add_concept'>\n    <i class='icon-plus'></i>\n    New Concept\n  </a>\n</li>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_editor/views/structure"]=function(context){return function(){var $o,$r;return $r=window.HAML.reference,$o=[],$o.push("<div class='book__editor__structure-controls'>\n  <div class='btn-group'>\n    <div class='btn collapse-level' id='collapse_button' data-bind='click: collapse_all'>\n      Collapse\n      <span class='mq__fixed'>all</span>\n    </div>\n    <div class='btn expand-level' id='expand_button' data-bind='click: expand_all'>\n      Expand\n      <span class='mq__fixed'>all</span>\n    </div>\n  </div>\n</div>\n<ul class='book__editor__chapters' data-bind=\"sortable: { template: 'book_editor/views/chapter', data: chapters, connectClass: 'book__editor__chapters', afterMove: $root.finish_drop }\"></ul>\n<a class='book__editor__new-button' id='new_chapter_button' data-bind='click: add_chapter'>\n  <i class='icon-plus'></i>\n  New Chapter\n</a>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.BookDiffer||(Boundless.BookDiffer={}),Boundless.BookDiffer.App=function(){function App(options){this.controller=new Boundless.BookDiffer.Controller({book_differ:this})}return App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookDiffer.Controller=function(superClass){function Controller(){return Controller.__super__.constructor.apply(this,arguments)}return extend(Controller,superClass),Controller.prototype.el=".diff__book",Controller.prototype.events={"click .diff__book__expandable":"toggle_expanded"},Controller.prototype.initialize=function(params){return null==params&&(params={}),Controller.__super__.initialize.apply(this,arguments),this.book_differ=params.book_differ,this.auto_expand_changes(),$(".submitr__editor-curtain").hide(),this},Controller.prototype.toggle_expanded=function(e){return e.stopPropagation(),$(e.currentTarget).toggleClass("diff__book__expandable--collapsed")},Controller.prototype.auto_expand_changes=function(){return $(".diff__book__expandable").addClass("diff__book__expandable--collapsed"),$(".diff__book__expandable").each(function(_this){return function(index,element){return $(element).hasClass("unchanged")?void 0:$(element).parents(".diff__book__expandable").removeClass("diff__book__expandable--collapsed")}}(this))},Controller}(Boundless.Base.View)}.call(this),function(){Boundless.append_view_path("profile_editor/views"),Boundless.ProfileEditor||(Boundless.ProfileEditor={}),Boundless.ProfileEditor.App=function(){function App(){this.general_info=new Boundless.ProfileEditorGeneral,this.education_info=new Boundless.ProfileEditorEducation}return App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ProfileEditorEducation=function(superClass){function ProfileEditorEducation(){return ProfileEditorEducation.__super__.constructor.apply(this,arguments)}return extend(ProfileEditorEducation,superClass),ProfileEditorEducation.prototype.template="education_info",ProfileEditorEducation.prototype.el=$('<div class="profile_editor profile_editor_education"></div>'),ProfileEditorEducation.prototype.helper_methods=["user"],ProfileEditorEducation.prototype.events={"click  a.profile_editor__add-degrees":"add_degree","click  a.profile_editor__degree__remove":"remove_degree","submit #profile_editor__form":"save_changes"},ProfileEditorEducation.prototype.initialize=function(){return ProfileEditorEducation.__super__.initialize.apply(this,arguments),this.user=session.current_user},ProfileEditorEducation.prototype.show=function(){return 0===this.user.get("degrees").length&&this.user.get("degrees").add({concentration:""}),this.modal=new Boundless.Modal(this.el,520),this.modal.show(),this.modal.controller.on("modal:hide",function(_this){return function(){var empty_degrees;return empty_degrees=_this.user.get("degrees").where({concentration:""}),_this.user.get("degrees").remove(empty_degrees)}}(this)),this.render()},ProfileEditorEducation.prototype.add_degree=function(e){return this.set_values_from_form(),this.user.get("degrees").add({concentration:""}),this.render()},ProfileEditorEducation.prototype.remove_degree=function(e){var degree;return this.set_values_from_form(),degree=this.user.get("degrees").get($(e.currentTarget).data("id")),degree.destroy(),this.render()},ProfileEditorEducation.prototype.save_changes=function(e){return e.preventDefault(),this.set_values_from_form(),this.$("#profile_editor__form").disable_form(),this.user.get("degrees").every(function(_this){return function(degree){return degree.isValid()}}(this))?this.user.save({},{success:function(_this){return function(){return _this.modal.hide(),"undefined"!=typeof wiselinks&&null!==wiselinks?wiselinks.reload():window.location=window.location.href}}(this),error:function(_this){return function(){return _this.render()}}(this)}):(this.render(),this.display_errors()),!1},ProfileEditorEducation.prototype.display_errors=function(){return $(".profile_editor__error-msg").remove(),$(".help-inline").each(function(index,element){return $(element).closest(".profile_editor__degree").append(element),$(element).show().addClass("profile_editor__error-msg")})},ProfileEditorEducation.prototype.set_values_from_form=function(){var degree_values;return degree_values=this.$("#profile_editor__form").fields_for("user").degrees,this.user.get("degrees").set_from_form_values(degree_values)},ProfileEditorEducation}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ProfileEditorGeneral=function(superClass){function ProfileEditorGeneral(){return this.save_changes=bind(this.save_changes,this),ProfileEditorGeneral.__super__.constructor.apply(this,arguments)}return extend(ProfileEditorGeneral,superClass),ProfileEditorGeneral.prototype.template="general_info",ProfileEditorGeneral.prototype.el=$('<div class="profile_editor profile_editor_general"></div>'),ProfileEditorGeneral.prototype.helper_methods=["user"],ProfileEditorGeneral.prototype.events={"keyup #user-bio-input":"profile_bio_changed","submit #profile_editor__form":"save_changes"},ProfileEditorGeneral.prototype.initialize=function(){return ProfileEditorGeneral.__super__.initialize.apply(this,arguments),this.user=session.current_user},ProfileEditorGeneral.prototype.render=function(){return ProfileEditorGeneral.__super__.render.apply(this,arguments),this.$bio=this.$("#user-bio-input").autoResize(),this.$bio_help=this.$(".user-bio-wrapper .help-block"),this.set_profile_bio_help(this.$bio.val().length),this},ProfileEditorGeneral.prototype.show=function(){return this.modal=new Boundless.Modal(this.el,520),this.modal.show(),this.render()},ProfileEditorGeneral.prototype.profile_bio_changed=function(e){return this.set_profile_bio_help(this.$bio.val().length)},ProfileEditorGeneral.prototype.set_profile_bio_help=function(length){return this.$bio_help.text(length+" of 300 characters remaining")},ProfileEditorGeneral.prototype.save_changes=function(e){var $form,bio_text,user_params;return e.preventDefault(),$form=$("#profile_editor__form"),user_params=$("#profile_editor__form").fields_for("user"),bio_text=this.$bio.val(),$form.disable_form(),this.user.save(user_params,{success:function(_this){return function(){return _this.modal.hide(),"undefined"!=typeof wiselinks&&null!==wiselinks?wiselinks.reload():window.location=window.location.href}}(this),error:function(_this){return function(){return _this.render()}}(this)}),!1},ProfileEditorGeneral}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["profile_editor/views/degree_fields"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,
$o=[],$o.push("<div class='clearfix profile_editor__degree'>\n  <a class='profile_editor__degree__remove' data-id='"+$e($c(this.degree_form.object.id||this.degree_form.object.cid))+"'>\n    <i class='icon-remove'></i>\n  </a>"),$o.push("  "+$c(this.degree_form.input("school_id",{placeholder:"School name",input_class:"profile-data-input",as:"school",label:"What school is your degree from?",wrapper_class:"profile_editor__input-group"}))),$o.push("  <div class='form-inputs_inline'>"),$o.push("    "+$c(this.degree_form.input("degree",{placeholder:"BS",input_class:"profile-data-input",as:"string",wrapper_class:"profile_editor__input-group profile_editor__degree-type"}))),$o.push("    "+$c(this.degree_form.input("concentration",{placeholder:"Biology",input_class:"profile-data-input",as:"string",wrapper_class:"profile_editor__input-group profile_editor__concentration"}))),$o.push("    "+$c(this.degree_form.input("year",{placeholder:"year",input_class:"profile-data-input",as:"string",label:"Optional",wrapper_class:"profile_editor__input-group profile_editor__year"}))),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["profile_editor/views/education_info"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='bcp-sans-copy profile_editor'>\n  <div class='profile_editor__header'>\n    Education\n  </div>\n  <div class='profile_editor__degrees'>"),$o.push("    "+$c(this.form_for(this.user,{id:"profile_editor__form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("    "+$c(form.fields_for("degrees",function(degree_form){var $o2;return $o2=[],$o2.push("    "+$c(_this.partial("degree_fields",_.extend({},_this,{degree_form:degree_form})))),$o2.join("\n")}))),$o1.push("    <a class='btn btn-block btn-medium profile_editor__add-degrees'>\n      Add another degree\n    </a>\n    <div class='profile_editor__form__submit'>"),$o1.push("      "+$c(form.action("submit",{label:"Save",action_class:"btn btn-large btn-block btn-green"}))),$o1.push("    </div>"),$o1.join("\n")}}(this)))),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["profile_editor/views/general_info"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='bcp-sans-copy profile_editor'>\n  <div class='profile_editor__header'>\n    General Information\n  </div>"),$o.push("  "+$c(this.form_for(this.user,{id:"profile_editor__form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("  "+$c(form.input("first_name",{label:"First Name",wrapper_class:"profile_editor__input-wrap--half",placeholder:"(required)"}))),$o1.push("  "+$c(form.input("last_name",{label:"Last Name",wrapper_class:"profile_editor__input-wrap--half",placeholder:"(required)"}))),$o1.push("  "+$c(form.input("bio",{label:"Bio",as:"text",hint:"...",placeholder:"Let the community know more about you. What is your profession? Do you teach? If so, where? Also, what subject matter interests you the most?",maxlength:300}))),$o1.push("  <div class='control-group'>\n    <label class='control-label'>How would you describe yourself?</label>\n    <div class='controls'>\n      <label class='checkbox'>\n        Student\n        <input type='hidden' value='false' name='user[student]'>\n        <input type='checkbox' value='true' checked='"+$e($c(_this.user.get("student")?"checked":!1))+"' name='user[student]'>\n      </label>\n      <label class='checkbox'>\n        Educator\n        <input type='hidden' value='false' name='user[educator]'>\n        <input type='checkbox' value='true' checked='"+$e($c(_this.user.get("educator")?"checked":!1))+"' name='user[educator]'>\n      </label>\n      <label class='checkbox'>\n        Expert\n        <input type='hidden' value='false' name='user[expert]'>\n        <input type='checkbox' value='true' checked='"+$e($c(_this.user.get("expert")?"checked":!1))+"' name='user[expert]'>\n      </label>\n    </div>\n  </div>\n  <div class='profile_editor__form__submit'>"),$o1.push("    "+$c(form.action("submit",{label:"Save",action_class:"btn btn-large btn-block btn-green"}))),$o1.push("  </div>"),$o1.join("\n")}}(this)))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}};Boundless.AvatarUploader||(Boundless.AvatarUploader={}),Boundless.AvatarUploader.App=function(){function App(options){this._show_error=bind(this._show_error,this),this._save_to_current_user=bind(this._save_to_current_user,this),this._update_avatar_processing=bind(this._update_avatar_processing,this),this._update_avatar_preview=bind(this._update_avatar_preview,this),this._crop_file=bind(this._crop_file,this),this._pick_and_crop_file=bind(this._pick_and_crop_file,this),this._save_to_s3=bind(this._save_to_s3,this),this.bind_avatar_upload(),this.bind_avatar_save()}return App.prototype.bind_avatar_save=function(){return $(document).off("click",".profile__avatar-save-btn:not(.disabled)"),$(document).on("click",".profile__avatar-save-btn:not(.disabled)",function(_this){return function(evt){return evt.preventDefault(),$(".profile__avatar-save-btn").addClass("disabled").text("Saving..."),_this._save_to_s3()}}(this))},App.prototype.bind_avatar_upload=function(){return $(document).off("click",".profile__avatar-filepicker-btn:not(.disabled)"),$(document).on("click",".profile__avatar-filepicker-btn:not(.disabled)",function(_this){return function(evt){return evt.preventDefault(),filepicker.setKey("AArS0ISe9QVecggwgwC40z"),_this._pick_and_crop_file()}}(this))},App.prototype._save_to_s3=function(){var filename;if(this.inkblob)return filename=this.inkblob.filename.replace(/[^a-z0-9\.]/gi,"_"),filepicker.store(this.inkblob,{filename:filename,path:"/user_avatars/original/"+session.current_user.id+"/",access:"public"},this._save_to_current_user)},App.prototype._pick_and_crop_file=function(evt){return null!=evt&&evt.preventDefault(),filepicker.pickAndStore({mimetype:"image/*",container:"modal",service:"COMPUTER",multiple:!1},{path:"/uploads/user_avatars/"+session.current_user.id+"/",access:"public"},this._crop_file,this._show_error)},App.prototype._crop_file=function(inkblobs){var inkblob;return inkblob=inkblobs[0],filepicker.convert(inkblob,{width:1024,height:1024,fit:"crop",align:"faces"},{path:"/uploads/user_avatars/"+session.current_user.id+"/",access:"public"},function(_this){return function(new_inkblob){return _this.inkblob=new_inkblob,_this._update_avatar_preview()}}(this),this._show_error,this._update_avatar_processing)},App.prototype._update_avatar_preview=function(){return $(".profile__avatar-preview img").attr("src",this.inkblob.url),setTimeout(function(){return $(".profile__avatar-preview .processing").hide(),$(".profile__avatar-save-btn").removeClass("disabled")},300)},App.prototype._update_avatar_processing=function(percent){return $(".profile__avatar-preview .processing").text("Processing: "+percent+"%"),$(".profile__avatar-preview .processing").css("opacity",percent/100+.5),$(".profile__avatar-preview .processing").css("padding-top",percent/2+"%"),$(".profile__avatar-preview .processing").css("padding-bottom",percent/2+"%")},App.prototype._save_to_current_user=function(new_inkblob){return session.current_user.save({avatar_key:new_inkblob.key,avatar_content_type:new_inkblob.mimetype,avatar_file_size:new_inkblob.size},{patch:!0,success:function(_this){return function(model,resp){return location.reload()}}(this)})},App.prototype._show_error=function(error){return console.error(error.toString())},App}()}.call(this),function(){Boundless.append_view_path("submitr/views")}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.FeedbackSubmitrController=function(superClass){function FeedbackSubmitrController(){return this._autosave_if_enabled=bind(this._autosave_if_enabled,this),this.disable_save_buttons=bind(this.disable_save_buttons,this),this.disable_edits=bind(this.disable_edits,this),this.enable_edits=bind(this.enable_edits,this),this.show_save_error=bind(this.show_save_error,this),this.show_saved=bind(this.show_saved,this),this.show_saving=bind(this.show_saving,this),this.clear_status=bind(this.clear_status,this),this.show_status=bind(this.show_status,this),FeedbackSubmitrController.__super__.constructor.apply(this,arguments)}return extend(FeedbackSubmitrController,superClass),FeedbackSubmitrController.prototype.template="submitr_feedback",FeedbackSubmitrController.prototype.events={"click .submitr__revert":"clicked_revert","click .submitr__submit-feedback":"clicked_submit_feedback","click .submitr__user-type-educator":"toggle_educator","click .submitr__user-type-expert":"toggle_expert","click .submitr__user-type-student":"toggle_student"},FeedbackSubmitrController.prototype.helper_methods=["issue"],FeedbackSubmitrController.prototype.initialize=function(params){return null==params&&(params={}),this.content_object_type=params.content_object_type,this.content_object_id=params.content_object_id,this.save_manager=params.save_manager,this.revert_endpoint=params.revert_endpoint,this.issue=new Boundless.Issue({content_object_type:this.content_object_type,content_object_id:this.content_object_id,issue_type:"other",title:""}),this.render(),Modernizr.editorsupported?this.enable_edits():(this.$(".content-editor__feedback-instructions").html('<h2>Propose edits (disabled)</h2>\n<p>Our editor is only supported in <a href="https://www.google.com/chrome/browser" target="_blank">Chrome</a>, Firefox, and Safari, but please don\'t let that deter you from leaving us feedback in the form above.</p>\n<p>Tell us how you think this content can be improved and you\'ll help us continue to make quality educational content universally accessible.</p>'),$(".content-edit-gutter").hide(),this.disable_edits(!0),this.clear_status(),this.$(".content-edit__chin").css("position","relative")),events.on("editor:status",this.show_status),events.on("editor:clear_status",this.clear_status),events.on("editor:saving",this.show_saving),events.on("editor:saved",this.show_saved),events.on("editor:save_error",this.show_save_error),events.on("editor:prevent_saving",this.disable_save_buttons),events.on("editor:disable_editor",this.disable_edits),events.on("editor:_autosave",this._autosave_if_enabled),FeedbackSubmitrController.__super__.initialize.apply(this,arguments)},FeedbackSubmitrController.prototype.render=function(){return FeedbackSubmitrController.__super__.render.apply(this,arguments),this.$status=this.$(".submitr__status-message"),this.$version_note=this.$(".submitr__version-note"),this.$change_note=this.$(".submitr__change-note"),Modernizr.editorsupported&&Boundless.Editor.refresh_container(),this},FeedbackSubmitrController.prototype.toggle_educator=function(evt){var $target;return evt.preventDefault(),$target=$(evt.currentTarget),$target.toggleClass("selected"),CookieMonster.set("user_type_educator",$target.hasClass("selected"))},FeedbackSubmitrController.prototype.toggle_expert=function(evt){var $target;return evt.preventDefault(),$target=$(evt.currentTarget),$target.toggleClass("selected"),CookieMonster.set("user_type_expert",$target.hasClass("selected"))},FeedbackSubmitrController.prototype.toggle_student=function(evt){var $target;return evt.preventDefault(),$target=$(evt.currentTarget),$target.toggleClass("selected"),CookieMonster.set("user_type_student",$target.hasClass("selected"))},FeedbackSubmitrController.prototype.redirect_to_community=function(){return location.href=location.origin+"/issues/open/"},FeedbackSubmitrController.prototype.redirect_to_content_show=function(){return location.href=location.href.match(/(.+)issues\/new\/?/)[1]},FeedbackSubmitrController.prototype.redirect_to_issue=function(){var content_url;return content_url=location.href.match(/(.+)issues\/new\/?/)[1],location.href=content_url+"issues/"+this.issue.id+"/"},FeedbackSubmitrController.prototype.redirect_to_proposed_change=function(proposed_change){var content_url;return content_url=location.href.match(/(.+)issues\/new\/?/)[1],location.href=content_url+"issues/"+this.issue.id+"/proposed_changes/"+this.issue.get("proposed_changes").first().id+"/"},FeedbackSubmitrController.prototype.show_status=function(message,hide_after,is_error){return null==hide_after&&(hide_after=null),null==is_error&&(is_error=!1),this.$status.html(message),this.$status.removeClass("hide"),this.$status.toggleClass("error",is_error),null!=hide_after?setTimeout(function(_this){return function(){return _this.clear_status()}}(this),hide_after):void 0},FeedbackSubmitrController.prototype.clear_status=function(){return this.$status.addClass("hide"),this.$status.removeClass("error")},FeedbackSubmitrController.prototype.show_saving=function(){return this.potential_error_timeout=setTimeout(function(_this){return function(){return _this.show_potential_error()}}(this),1e4),this.show_status("<i class='icon-spinner icon-spin'></i> Saving..."),this.disable_save_buttons()},FeedbackSubmitrController.prototype.show_saved=function(){return this.clear_potential_error(),this.show_status("<i class='icon-ok'></i> Saved!",3e3),this.disable_save_buttons(!1)},FeedbackSubmitrController.prototype.show_save_error=function(message){return this.clear_potential_error(),message||(message="<i class='icon-remove'></i> Error saving."),this.show_status(message,null,!0),this.disable_save_buttons(),this.disable_edits(!0,"Error Saving","Please refresh the page and try your edits again."),$(".submitr__editor-curtain").off("click")},FeedbackSubmitrController.prototype.show_potential_error=function(){return this.disable_edits(!0,"Saving...","Saving is taking longer than usual. Please standby."),this.show_error_timeout=setTimeout(function(_this){return function(){return _this.show_save_error()}}(this),2e4),this},FeedbackSubmitrController.prototype.clear_potential_error=function(){return clearTimeout(this.potential_error_timeout),clearTimeout(this.show_error_timeout),this.enable_edits()},FeedbackSubmitrController.prototype.enable_edits=function(){return Boundless.Editor.enable_edits(),this.disable_edits(!1)},FeedbackSubmitrController.prototype.disable_edits=function(state,header,body){return null==state&&(state=!0),null==header&&(header=""),null==body&&(body=""),state&&$("body").focus(),$(".submitr__editor-curtain__header").html(header),$(".submitr__editor-curtain__body").html(body),$(".submitr__editor-curtain").toggle(state)},FeedbackSubmitrController.prototype.disable_save_buttons=function(state){return null==state&&(state=!0),$(".submitr__revert, .submitr__submit-feedback").toggleClass("disabled",state)},FeedbackSubmitrController.prototype.clicked_revert=function(evt){return evt.preventDefault(),this.disable_edits(),$(evt.currentTarget).disable_button(),this.revert()},FeedbackSubmitrController.prototype.clicked_submit_feedback=function(evt){var fields;return evt.preventDefault(),this.disable_save_buttons(),$(evt.currentTarget).disable_button(),fields=this.$("#issue-form").fields_for("issue"),this.issue.set(fields),Boundless.Events.Sisyphus.track("clicked_submit_feedback",{identify_anonymous:!0,once:!0},function(_this){return function(){return session.current_user||Boundless.Analytics.set_initial_values_cookie(),_this._submit_feedback()}}(this))},FeedbackSubmitrController.prototype._autosave_if_enabled=function(callback){return null==callback&&(callback=null),null!=this.save_manager?this.save_manager.save({force:!0,success:callback,error:this.show_save_error}):"function"==typeof callback?callback(null,null):void 0},FeedbackSubmitrController.prototype._submit_feedback=function(){return this._autosave_if_enabled(function(_this){return function(model,resp){return _this.issue.save({},{success:function(model,resp){return Boundless.Events.Sisyphus.track("created_an_issue",function(){return _this.issue.get("proposed_changes").length?Boundless.Events.Sisyphus.track("created_a_proposed_change",function(){return _this.redirect_to_community()}):_this.redirect_to_community()})},error:function(model,resp){return model.errors?(_this.render(),Boundless.Editor.setup_container()):(_this.show_save_error(),Boundless.Logger.error(resp),$.globalMessenger().post({message:"There was an error saving this issue.",type:"error",showCloseButton:!0}))}})}}(this))},FeedbackSubmitrController.prototype.revert=function(callback){return this.disable_save_buttons(),$.ajax({url:this.revert_endpoint,type:"POST"}).done(function(_this){return function(data){return _this.redirect_to_content_show()}}(this)).fail(function(_this){return function(data){return events.trigger("editor:clear_status"),alert("There was a problem reverting this content.")}}(this))},FeedbackSubmitrController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Boundless.SubmitrController=function(superClass){function SubmitrController(){return this._autosave=bind(this._autosave,this),this.disable_save_buttons=bind(this.disable_save_buttons,this),this.disable_edits=bind(this.disable_edits,this),this.enable_edits=bind(this.enable_edits,this),this.show_save_error=bind(this.show_save_error,this),this.show_saved=bind(this.show_saved,this),this.show_saving=bind(this.show_saving,this),this.clear_status=bind(this.clear_status,this),this.show_status=bind(this.show_status,this),SubmitrController.__super__.constructor.apply(this,arguments)}return extend(SubmitrController,superClass),SubmitrController.prototype.template="submitr_default",SubmitrController.prototype.events={"click .submitr__cancel-action":"show_default","click .submitr__revert":"clicked_cancel_and_close","click .submitr__propose-change":"clicked_propose_change","click .submitr__submit-proposed-change":"clicked_submit_proposed_change","click .submitr__propose-change-with-issue":"clicked_propose_change_with_issue","click .submitr__submit-proposed-change-with-issue":"clicked_submit_proposed_change_with_issue","click .submitr__save-version":"clicked_save_version","click .submitr__submit-saved-version":"clicked_submit_saved_version","click .submitr__update-proposed-change":"clicked_update_proposed_change","click .submitr__submit-updated-proposed-change":"clicked_submit_updated_proposed_change"},SubmitrController.prototype.helper_methods=["mode","issue"],SubmitrController.prototype.MODES=["update proposed change","propose change","propose change and create issue","save version","admin"],SubmitrController.prototype.initialize=function(params){var ref;if(null==params&&(params={}),this.mode=params.mode,this.content_object_type=params.content_object_type,this.content_object_id=params.content_object_id,this.save_version_endpoint=params.save_version_endpoint,this.revert_endpoint=params.revert_endpoint,this.save_manager=params.save_manager,PageData.proposed_change&&(this.proposed_change=new Boundless.ProposedChange(PageData.proposed_change)),ref=this.mode,indexOf.call(this.MODES,ref)<0)throw"Invalid mode '"+this.mode+"' for content submission controller.";return this.render(),events.on("editor:status",this.show_status),events.on("editor:clear_status",this.clear_status),events.on("editor:saving",this.show_saving),events.on("editor:saved",this.show_saved),events.on("editor:save_error",this.show_save_error),events.on("editor:prevent_saving",this.disable_save_buttons),events.on("editor:disable_editor",this.disable_edits),events.on("editor:_autosave",this._autosave),this.enable_edits(),SubmitrController.__super__.initialize.apply(this,arguments)},SubmitrController.prototype.render=function(){return SubmitrController.__super__.render.apply(this,arguments),this.$status=this.$(".submitr__status-message"),this.$version_note=this.$(".submitr__version-note"),this.$change_note=this.$(".submitr__change-note"),Boundless.Editor.refresh_container(),this},SubmitrController.prototype.show_default=function(){return $(".submitr__editor-curtain").off("click"),this.disable_edits(!1),this.render()},SubmitrController.prototype.show_new_issue_followup=function(){return this.issue||(this.issue=new Boundless.Issue({content_object_type:this.content_object_type,content_object_id:this.content_object_id,issue_type:"",title:""})),this.render("new_issue_followup"),$(".submitr__editor-curtain").one("click",function(_this){return function(){return _this.show_default()}}(this))},SubmitrController.prototype.show_save_version_followup=function(){return this.render("save_version_followup"),$(".submitr__editor-curtain").one("click",function(_this){return function(){return _this.show_default()}}(this))},SubmitrController.prototype.show_proposed_change_followup=function(){return this.issue||(this.issue=new Boundless.Issue({issue_id:this.proposed_change.issue_id})),this.render("proposed_change_followup")},SubmitrController.prototype.show_update_proposed_change_followup=function(){return this.issue||(this.issue=new Boundless.Issue({issue_id:this.proposed_change.issue_id})),this.render("update_proposed_change_followup")},SubmitrController.prototype.redirect_to_content_show=function(){var match;return match=location.href.match(/(.+)edit\/$/)||location.href.match(/(.+)issues\/new\/?$/),location.href=match[1]},SubmitrController.prototype.redirect_to_issue=function(issue){return this.proposed_change?location.href=location.href.match(/(.+issues\/\d+)\/proposed_changes\/\d+\/edit\/?$/)[1]:location.href=location.href.match(/(.+)edit\/?$/)[1]+("issues/"+issue.id+"/")},SubmitrController.prototype.redirect_to_proposed_change=function(proposed_change){return this.proposed_change?location.href=location.href.match(/(.+\/proposed_changes\/\d+\/)edit\/?$/)[1]:location.href=location.href.match(/(.+)edit\/?$/)[1]+("issues/"+proposed_change.get("issue_id")+"/proposed_changes/"+proposed_change.id+"/")},SubmitrController.prototype.redirect_back=function(){return $.queryParam.referring_url?location.href=$.queryParam.referring_url:this.redirect_to_issue()},SubmitrController.prototype.show_status=function(message,hide_after,is_error){return null==hide_after&&(hide_after=null),null==is_error&&(is_error=!1),this.$status.html(message),this.$status.removeClass("hide"),this.$status.toggleClass("error",is_error),null!=hide_after?setTimeout(function(_this){return function(){return _this.clear_status()}}(this),hide_after):void 0},SubmitrController.prototype.clear_status=function(){return this.$status.addClass("hide"),this.$status.removeClass("error")},SubmitrController.prototype.show_saving=function(){return this.potential_error_timeout=setTimeout(function(_this){return function(){return _this.show_potential_error()}}(this),1e4),this.show_status("<i class='icon-spinner icon-spin'></i> Saving..."),this.disable_save_buttons()},SubmitrController.prototype.show_saved=function(){return this.clear_potential_error(),this.show_status("<i class='icon-ok'></i> Saved!",3e3),this.disable_save_buttons(!1)},SubmitrController.prototype.show_save_error=function(message){return this.clear_potential_error(),message||(message="<i class='icon-remove'></i> Error saving."),this.show_status(message,null,!0),this.disable_save_buttons(),this.disable_edits(!0,"Error Saving","Please refresh the page and try your edits again."),$(".submitr__editor-curtain").off("click")},SubmitrController.prototype.show_potential_error=function(){return this.disable_edits(!0,"Saving...","Saving is taking longer than usual. Please standby."),this.show_error_timeout=setTimeout(function(_this){return function(){return _this.show_save_error()}}(this),2e4),this},SubmitrController.prototype.clear_potential_error=function(){return clearTimeout(this.potential_error_timeout),clearTimeout(this.show_error_timeout),this.enable_edits()},SubmitrController.prototype.enable_edits=function(){return Boundless.Editor.enable_edits(),this.disable_edits(!1)},SubmitrController.prototype.disable_edits=function(state,header,body){return null==state&&(state=!0),null==header&&(header=""),null==body&&(body=""),state&&$("body").focus(),$(".submitr__editor-curtain__header").html(header),$(".submitr__editor-curtain__body").html(body),$(".submitr__editor-curtain").toggle(state)},SubmitrController.prototype.disable_save_buttons=function(state){return null==state&&(state=!0),$(".submitr__submit-proposed-change-with-issue, .submitr__submit-proposed-change, .submitr__submit-saved-version, .submitr__propose-change-with-issue, .submitr__propose-change, .submitr__save-version, .submitr__revert, .submitr__update-proposed-change, .submitr__submit-updated-proposed-change").toggleClass("disabled",state)},SubmitrController.prototype._autosave=function(callback){return null==callback&&(callback=null),this.save_manager.save({force:!0,success:callback,error:this.show_save_error})},SubmitrController.prototype.clicked_cancel_and_close=function(evt){return evt.preventDefault(),this.disable_edits(),$(evt.currentTarget).disable_button(),"propose change"===this.mode&&this.proposed_change?this.destroy_proposed_change():this.revert()},SubmitrController.prototype.clicked_propose_change=function(evt){return evt.preventDefault(),this.disable_edits(),Boundless.Events.Sisyphus.track("clicked_propose_change",{once:!0}),this.save_manager.save({force:!0,success:function(_this){return function(){return _this.show_proposed_change_followup()}}(this),error:this.show_save_error})},SubmitrController.prototype.clicked_submit_proposed_change=function(evt){var note;return evt.preventDefault(),this.disable_save_buttons(),$(evt.currentTarget).disable_button(),note=this.$change_note.val(),Boundless.Events.Sisyphus.track("clicked_submit_propose_change",{identify_anonymous:!0,once:!0},function(_this){return function(){return _this.update_proposed_change(note)}}(this))},SubmitrController.prototype.clicked_propose_change_with_issue=function(evt){return evt.preventDefault(),this.disable_edits(),Boundless.Events.Sisyphus.track("clicked_propose_change",{once:!0}),this.save_manager.save({force:!0,success:function(_this){return function(){return _this.show_new_issue_followup()}}(this),error:this.show_save_error})},SubmitrController.prototype.clicked_submit_proposed_change_with_issue=function(evt){var fields;return evt.preventDefault(),this.disable_save_buttons(),Boundless.Events.Sisyphus.track("clicked_submit_propose_change",{once:!0}),$(evt.currentTarget).disable_button(),fields=this.$("#create_issue_form").fields_for("issue"),this.issue.set(fields),this.create_issue_and_propose_change(this.issue)},SubmitrController.prototype.clicked_update_proposed_change=function(evt){return evt.preventDefault(),this.disable_edits(),Boundless.Events.Editor.track("clicked_update_proposal",{once:!0}),this.save_manager.save({force:!0,success:function(_this){return function(){return _this.show_update_proposed_change_followup()}}(this),error:this.show_save_error})},SubmitrController.prototype.clicked_submit_updated_proposed_change=function(evt){var note;return evt.preventDefault(),this.disable_save_buttons(),$(evt.currentTarget).disable_button(),note=this.$change_note.val(),Boundless.Events.Editor.track("clicked_submit_updated_proposed_change",{identify_anonymous:!0,once:!0},function(_this){return function(){return _this.update_proposed_change(note)}}(this))},SubmitrController.prototype.clicked_save_version=function(evt){return evt.preventDefault(),this.disable_edits(),this.save_manager.save({force:!0,success:function(_this){return function(){return _this.show_save_version_followup()}}(this),error:function(_this){return function(message){return _this.enable_edits(),events.trigger("editor:status","<i class='icon-remove'></i> "+message)}}(this)})},SubmitrController.prototype.clicked_submit_saved_version=function(evt){var note;return evt.preventDefault(),this.disable_save_buttons(),$(evt.currentTarget).disable_button(),note=this.$version_note.val(),this.save_version(note)},SubmitrController.prototype.destroy_proposed_change=function(callback){return this.disable_save_buttons(),this.proposed_change.destroy({success:function(_this){return function(){return _this.redirect_back()}}(this),error:function(_this){return function(){return events.trigger("editor:clear_status"),alert("There was a problem reverting this content.")}}(this)})},SubmitrController.prototype.revert=function(callback){return this.disable_save_buttons(),$.ajax({url:this.revert_endpoint,type:"POST"}).done(function(_this){return function(data){return _this.proposed_change?"atom"===_this.content_object_type?_this.redirect_to_issue():_this.redirect_to_proposed_change():_this.redirect_to_content_show()}}(this)).fail(function(_this){return function(data){return events.trigger("editor:clear_status"),alert("There was a problem reverting this content.")}}(this))},SubmitrController.prototype.save_version=function(note){return this.disable_save_buttons(),$.page_post(this.save_version_endpoint,{change_note:note})},SubmitrController.prototype.create_issue_and_propose_change=function(issue){return this.disable_save_buttons(),issue.save({},{success:function(_this){return function(model,resp){var proposed_change;return(proposed_change=model.get("proposed_changes").first())?Boundless.Events.Sisyphus.track("proposed_change_submitted",function(){return _this.redirect_to_proposed_change(proposed_change)}):_this.redirect_to_issue(issue)}}(this),error:function(_this){return function(model,resp){return model.errors?_this.show_new_issue_followup():(_this.show_save_error(),Boundless.Logger.error(resp),$.globalMessenger().post({message:"There was an error saving this issue.",type:"error",showCloseButton:!0}))}}(this)})},SubmitrController.prototype.update_proposed_change=function(change_note){return $.ajax({url:this.proposed_change.url()+"/submit",type:"POST",data:{change_note:change_note}}).done(function(_this){return function(data){return Boundless.Events.Editor.track("updated_proposed_change",function(){return events.trigger("editor:status","<i class='icon-ok'></i> Changes saved!",3e3),_this.redirect_to_proposed_change(_this.proposed_change)})}}(this)).fail(function(_this){return function(data){return _this.show_save_error(),$.globalMessenger().post({message:"There was a problem submitting these changes.",type:"error",showCloseButton:!0})}}(this))},SubmitrController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/content_submission_update_proposed_change"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='submitr'>\n  <div class='submitr__left'>\n    <div class='hide submitr__status-message'></div>\n  </div>\n  <div class='submitr__right'>\n    <a class='btn submitr__revert'>\n      <i class='icon-remove'></i>\n      Cancel\n    </a>\n    <a class='btn btn-success submitr__update-proposed-change'>\n      <i class='icon-mail-forward'></i>\n      Update proposal\n    </a>\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/new_issue_followup"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='submitr'>\n  <h2>Final Step</h2>\n  <p>Before your proposed change can be submitted for review, we need to know what kind of issue you were trying to fix with the content.</p>\n  <div class='propose-change-followup'>"),$o.push("    "+$c(this.form_for(this.issue,{id:"create_issue_form","class":"bcp-form"},function(_this){return function(form){var $o1;return $o1=[],$o1.push("    "+$c(form.input("issue_type",{label:!1,
as:"select",collection:Boundless.Issue.VALID_ISSUE_TYPES,input_class:"submitr__issue-type-selector",value:_this.issue.get("issue_type")}))),$o1.push("    "+$c(form.input("title",{label:!1,as:"text",placeholder:"Describe the change you made...",input_class:""}))),$o1.push("    <a class='btn btn-block btn-green submitr__submit-proposed-change-with-issue'>\n      <i class='icon-mail-forward'></i>\n      Create issue\n    </a>"),$o1.join("\n")}}(this)))),$o.push("  </div>\n  <a class='submitr__cancel-action'>\n    <i class='icon-remove'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/proposed_change_followup"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='submitr'>\n  <h2>Final Step</h2>\n  <p>Briefly describe what you changed in this proposed edit.</p>\n  <div class='propose-change-followup'>\n    <textarea class='submitr__change-note' type='text' placeholder='Describe the changes you made...'></textarea>\n    <a class='btn btn-block btn-green submitr__submit-proposed-change'>\n      <i class='icon-copy'></i>\n      Submit Proposed Edit\n    </a>\n  </div>\n  <a class='submitr__cancel-action'>\n    <i class='icon-remove'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/save_version_followup"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='submitr'>\n  <h2>Final Step</h2>\n  <p>Before saving a new version of this content, describe the changes you made so it's easier for reader and other contributors to understand how this version is different from the previous one.</p>\n  <div class='propose-change-followup'>\n    <textarea class='submitr__version-note' name='' type='text' placeholder='Describe the changes you made...'></textarea>\n    <a class='btn btn-block btn-green submitr__submit-saved-version'>\n      <i class='icon-copy'></i>\n      Continue and save new version\n    </a>\n  </div>\n  <a class='submitr__cancel-action'>\n    <i class='icon-remove'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/submitr_buttons"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='submitr'>\n  <div class='submitr__left'>\n    <div class='submitr__status-message'>\n      All edits are reviewed before being published.\n    </div>\n  </div>\n  <div class='submitr__right'>\n    <a class='atom-editor__revert-trigger btn submitr__revert'>\n      <i class='icon-remove'></i>\n      Cancel\n      <span class='mq__fixed'>and Close</span>\n    </a>\n    <a class='btn btn-success submitr__submit-feedback'>\n      <i class='boundless-icon-feedback-negative'></i>\n      Submit\n      <span class='mq__no-phone'>Feedback</span>\n    </a>\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/submitr_default"]=function(context){return function(){var $o,ref,ref1,ref2;return $o=[],$o.push("<div class='submitr'>\n  <div class='submitr__left'>\n    <div class='hide submitr__status-message'></div>\n  </div>\n  <div class='submitr__right'>\n    <a class='atom-editor__revert-trigger btn submitr__revert'>\n      <i class='icon-remove'></i>\n      Cancel\n      <span class='mq__fixed'>and Close</span>\n    </a>"),"propose change"===(ref=this.mode)&&$o.push("    <a class='btn btn-success submitr__propose-change'>\n      <i class='icon-mail-forward'></i>\n      Propose Edit\n    </a>"),"update proposed change"===this.mode&&$o.push("    <a class='btn btn-success submitr__update-proposed-change'>\n      <i class='icon-mail-forward'></i>\n      Update proposal\n    </a>"),("propose change and create issue"===(ref1=this.mode)||"admin"===ref1)&&$o.push("    <a class='btn btn-success submitr__propose-change-with-issue'>\n      <i class='icon-mail-forward'></i>\n      Propose Edit\n    </a>"),"save version"===(ref2=this.mode)&&$o.push("    <a class='btn btn-success submitr__save-version'>\n      <i class='icon-copy'></i>\n      Save new version\n    </a>"),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/submitr_feedback"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='content-editor__forehead'>\n  <div class='bcp-form content-editor__feedback-form'>\n    <h2>Leave Feedback</h2>"),$o.push("    "+$c(this.form_for(this.issue,function(form){var $o1,selected;return $o1=[],$o1.push("    "+$c(form.input("issue_type",{as:"hidden"}))),$o1.push("    "+$c(form.input("title",{as:"text",label:!1,placeholder:"Describe how this content can be improved here...",input_class:"submitr__feedback-title-input"}))),null==session.current_user&&$o1.push("    <p>How would you describe yourself? (select all that apply)</p>"),null==session.current_user&&($o1.push("    <div class='clearfix submitr__user-types'>"),selected=CookieMonster.get("user_type_educator")?"selected":"",$o1.push("      <div class='"+["submitr__user-type","submitr__user-type-educator",""+$e($c(selected))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-user-type='educator'>\n        <div class='nowrap'>\n          <i class='boundless-icon-educator'></i>\n          <span class='lbl'>Educator</span>\n        </div>\n        <div class='submitr__user-type__check-box-cont'>\n          <div class='submitr__user-type__check-box'></div>\n        </div>\n      </div>"),selected=CookieMonster.get("user_type_expert")?"selected":"",$o1.push("      <div class='"+["submitr__user-type","submitr__user-type-expert",""+$e($c(selected))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-user-type='expert'>\n        <div class='nowrap'>\n          <i class='icon-pencil'></i>\n          <span class='lbl'>Expert</span>\n        </div>\n        <div class='submitr__user-type__check-box-cont'>\n          <div class='submitr__user-type__check-box'></div>\n        </div>\n      </div>"),selected=CookieMonster.get("user_type_student")?"selected":"",$o1.push("      <div class='"+["submitr__user-type","submitr__user-type-student",""+$e($c(selected))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' data-user-type='student'>\n        <div class='nowrap'>\n          <i class='boundless-icon-user'></i>\n          <span class='lbl'>Student</span>\n        </div>\n        <div class='submitr__user-type__check-box-cont'>\n          <div class='submitr__user-type__check-box'></div>\n        </div>\n      </div>\n    </div>")),$o1.join("\n")}))),Modernizr.editorsupported||$o.push("    "+$c(this.partial("submitr_buttons",this))),$o.push("  </div>\n  <div class='content-editor__feedback-instructions'>\n    <h2>Make proposed edits below (optional)</h2>\n  </div>\n</div>\n<div class='atom-save-manager__container content-edit__chin'>"),Modernizr.editorsupported&&$o.push("  "+$c(this.partial("submitr_buttons",this))),$o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["submitr/views/update_proposed_change_followup"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='submitr'>\n  <h2>Final Step</h2>\n  <p>Briefly describe what you changed in your proposal.</p>\n  <div class='propose-change-followup'>\n    <textarea class='submitr__change-note' type='text' placeholder='Describe the changes you made...'></textarea>\n    <a class='btn btn-block btn-green submitr__submit-updated-proposed-change'>\n      <i class='icon-copy'></i>\n      Submit Updated Edit\n    </a>\n  </div>\n  <a class='submitr__cancel-action'>\n    <i class='icon-remove'></i>\n  </a>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("quiz_editor/views"),Boundless.QuizEditor||(Boundless.QuizEditor={}),Boundless.QuizEditor.App=function(){function App(quiz_attributes){var questions;Boundless.QuizEditor.instance=this,this.quiz=new Boundless.Lesson(quiz_attributes),questions=new Boundless.QuestionCollection(PageData.questions),this.quiz.set("questions",questions),this.controller=new Boundless.QuizEditor.QuizController({el:$(".quiz__editor__container"),quiz:this.quiz})}return App.prototype.save=function(options){return events.trigger("save:quiz",options)},App.prototype.contentChangedSinceLoad=function(){return!0},App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuizEditor.QuizController=function(superClass){function QuizController(){return QuizController.__super__.constructor.apply(this,arguments)}return extend(QuizController,superClass),QuizController.prototype.template="quiz",QuizController.prototype.initialize=function(params){return null==params&&(params={}),QuizController.__super__.initialize.apply(this,arguments),this.quiz=params.quiz,this.view_model=new Boundless.QuizEditor.QuizViewModel(this.quiz,{factories:{"questions.models":Boundless.QuizEditor.QuestionViewModel}}),this.render(),this},QuizController.prototype.render=function(){return QuizController.__super__.render.apply(this,arguments),ko.applyBindings(this.view_model,this.el)},QuizController}(Boundless.Base.View)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuizEditor.QuestionViewModel=function(superClass){function QuestionViewModel(model,options){null==options&&(options={}),this.clone_and_replace_question=bind(this.clone_and_replace_question,this),this.save_question=bind(this.save_question,this),this.save_new_question=bind(this.save_new_question,this),QuestionViewModel.__super__.constructor.apply(this,arguments),this.QuestionEditModal=boundless.require("boundless.shared").QuestionEditModal,this.is_new=ko.observable(!1),this.inserting_after=ko.observable(!1),this.disable_question_actions=ko.observable(!1),this.show_copy_prompt=ko.observable(!1),this.learnosity_placeholder_html=ko.observable("<div class='learnosity-response question-"+this.id()+"'></div>"),this.is_directly_editable=ko.pureComputed(function(_this){return function(){return null==_this.creator_id()&&session.current_user.is_admin()||session.current_user.id===_this.creator_id()}}(this)),this.question_creator=ko.pureComputed(function(_this){return function(){return null==_this.creator_id()?"boundless":session.current_user.id===_this.creator_id()?"current_user":null!=_this.creator_id()}}(this)),this.avatar_tag=ko.pureComputed(function(_this){return function(){return null!=_this.creator_id()?_this.model().creator_avatar_tag(22):void 0}}(this)),this.show_avatar=ko.pureComputed(function(_this){return function(){return null!=_this.creator_id()}}(this)),this.attribution=ko.pureComputed(function(_this){return function(){switch(_this.question_creator()){case"boundless":return"Created by Boundless";case"current_user":return"You created this";default:return _this.creator_name()+" created this"}}}(this)),this.ownership_class=ko.pureComputed(function(_this){return function(){switch(_this.question_creator()){case"boundless":return"bcp-quiz-question bcp-quiz-question__no-creator";case"current_user":return"bcp-quiz-question bcp-quiz-question__user-created";default:return"bcp-quiz-question bcp-quiz-question__other-creator"}}}(this))}return extend(QuestionViewModel,superClass),QuestionViewModel.prototype.render_question=function(question){return Boundless.Learnosity.init_app(question.get("learnosity_show_json"))},QuestionViewModel.prototype.rerender_question=function(question){return this.learnosity_placeholder_html.valueHasMutated(),this.render_question(question)},QuestionViewModel.prototype.add_blank_question=function(){var question;return question=Boundless.Question.createEmptyMCQ(),question.save({learnosity_widget:question.get("learnosity_edit_json").widget_json,attributions_attributes:[]},{success:function(_this){return function(question){return _this.question_edit_modal=_this.QuestionEditModal.render({question:question,handleSave:_this.save_new_question.bind(_this,question)})}}(this),error:function(_this){return function(){return _this.fatal_error("Error creating question",arguments)}}(this)})},QuestionViewModel.prototype.show_question_search_modal=function(){var question_search_app,question_search_modal,wrapper;return wrapper=$("<div class='bcp-quiz-question__search-modal'></div>"),question_search_modal=new Boundless.Modal(wrapper,700),question_search_app=new Boundless.QuestionSearch.App({el:wrapper,modal:question_search_modal,lesson:this.quiz_vm().model()}),question_search_app.controller.on("question_selected",function(_this){return function(question,_question_el){var collection,index,new_question_vm;return collection=_this.model().collection,collection.get(parseInt(question.id))?events.trigger("editor:status","<i class='icon-remove'></i> Question already added.",3e3,!0):(index=_this.model().collection_index(),collection.add(question,{at:index+1}),new_question_vm=_this.quiz_vm().questions()[index+1],new_question_vm.is_new(!0),_this.render_question(question),events.trigger("editor:status","<i class='icon-ok'></i> Question added",3e3))}}(this)),question_search_app.controller.on("create_blank_question",function(_this){return function(){return _this.add_blank_question()}}(this))},QuestionViewModel.prototype.quiz_vm=function(){return ko.dataFor($(".bcp__quiz__questions")[0])},QuestionViewModel.prototype.delete_question=function(vm,evt){var question_el;return this.disable_question_actions(!0),question_el=$(".bcp-quiz-question").has(evt.currentTarget),$(question_el).velocity("slideUp",300,function(_this){return function(){return _this.model().collection.remove(_this.model()),_this.destroy()}}(this))},QuestionViewModel.prototype.move_question_up=function(vm,evt){return 0!==this.model().collection_index()?(this.disable_question_actions(!0),this.move_question_animate($(".bcp-quiz-question").has(evt.currentTarget),"up",function(_this){return function(learnosity_html){var collection,index,model;return collection=_this.model().collection,index=_this.model().collection_index(),_this.quiz_vm().disable_saving(),model=collection.remove(_this.model()),_this.quiz_vm().enable_saving(),collection.add(model,{at:index-1}),$(".question-"+_this.model().id).replaceWith(learnosity_html),_this.disable_question_actions(!1)}}(this))):void 0},QuestionViewModel.prototype.move_question_down=function(vm,evt){return this.model().collection_index()!==this.model().collection.length-1?(this.disable_question_actions(!0),this.move_question_animate($(".bcp-quiz-question").has(evt.currentTarget),"down",function(_this){return function(learnosity_html){var collection,index,model;return collection=_this.model().collection,index=_this.model().collection_index(),_this.quiz_vm().disable_saving(),model=collection.remove(_this.model()),_this.quiz_vm().enable_saving(),collection.add(model,{at:index+1}),$(".question-"+_this.model().id).replaceWith(learnosity_html),_this.disable_question_actions(!1)}}(this))):void 0},QuestionViewModel.prototype.save_and_publish_question=function(question,question_fields,options){return events.trigger("editor:status","<i class='icon-spinner icon-spin'></i> Saving question"),question.save(question_fields,{patch:!0,wait:!0,success:function(){return events.trigger("editor:status","<i class='icon-spinner icon-spin'></i> Publishing question"),question.publish({success:function(){return events.trigger("editor:status","<i class='icon-ok'></i> Saved question",3e3),"function"==typeof options.success?options.success(arguments):void 0},error:function(_this){return function(){return _this.fatal_error("Error publishing question",arguments),"function"==typeof options.error?options.error(arguments):void 0}}(this)})},error:function(_this){return function(){return _this.fatal_error("Error saving question",arguments),"function"==typeof options.error?options.error(arguments):void 0}}(this)})},QuestionViewModel.prototype.fatal_error=function(message,errors){return events.trigger("editor:disable_editor"),events.trigger("editor:prevent_saving"),events.trigger("editor:status","<i class='icon-exclamation-sign'></i> "+message),$.globalMessenger().post({message:message+". Please contact support@boundless.com if this happens again.<br/>Details: "+JSON.stringify(errors),type:"error",hideAfter:null,showCloseButton:!0}),console.error(errors)},QuestionViewModel.prototype.save_new_question=function(question,question_fields){return this.save_and_publish_question(question,question_fields,{success:function(_this){return function(){var collection,index;return _this.question_edit_modal.dismiss(),collection=_this.model().collection,index=_this.model().collection_index(),collection.add(question,{at:index+1}),_this.quiz_vm().questions()[index+1].is_new(!0),_this.render_question(question)}}(this)})},QuestionViewModel.prototype.save_question=function(question,question_fields){return this.save_and_publish_question(question,question_fields,{success:function(_this){return function(){return _this.question_edit_modal.dismiss(),_this.rerender_question(question)}}(this)})},QuestionViewModel.prototype.clone_and_replace_question=function(question,question_fields){return events.trigger("editor:status","<i class='icon-spinner icon-spin'></i> Cloning question"),question.post_clone({success:function(_this){return function(model){var new_question;return new_question=new Boundless.Question(model),_this.save_and_publish_question(new_question,question_fields,{success:function(){var collection,index;return _this.question_edit_modal.dismiss(),collection=question.collection,index=question.collection_index(),collection.add(new_question,{at:index+1}),question.collection.remove(question),_this.render_question(new_question),_this.destroy()}})}}(this),error:function(_this){return function(){return _this.fatal_error("Error cloning question",arguments)}}(this)})},QuestionViewModel.prototype.show_question_editor=function(){return this.question_edit_modal=this.QuestionEditModal.render({question:this.model(),handleCloneAndSave:this.clone_and_replace_question.bind(this,this.model()),handleSave:this.save_question.bind(this,this.model())})},QuestionViewModel.prototype.show_copy_prompt_or_clone_and_edit=function(){return"true"===$.cookie("hide_question_clone_prompt")?this.clone_and_edit():this.show_copy_prompt(!0)},QuestionViewModel.prototype.toggle_question_clone_prompt=function(vm,evt){return $.cookie("hide_question_clone_prompt",evt.currentTarget.checked),!0},QuestionViewModel.prototype.clone_and_edit=function(){return this.show_copy_prompt(!1),this.model().post_clone({success:function(_this){return function(model){var question;return question=new Boundless.Question(model),_this.question_edit_modal=_this.QuestionEditModal.render({question:question,handleSave:_this.save_new_question.bind(_this,question)})}}(this),error:function(_this){return function(){return _this.fatal_error("Error cloning question",arguments)}}(this)})},QuestionViewModel.prototype.show_insert_after=function(){return this.inserting_after(!0),setTimeout(function(_this){return function(){return $("#main").one("click",function(){return _this.hide_insert_after()})}}(this),10)},QuestionViewModel.prototype.hide_insert_after=function(){return this.inserting_after(!1)},QuestionViewModel.prototype.move_question_animate=function(question_el,direction,cback){var $question_el,question_clone,replace_question_el;return $question_el=$(question_el),replace_question_el="up"===direction?$(".bcp-quiz-question").eq($question_el.index(".bcp-quiz-question")-1):$(".bcp-quiz-question").eq($question_el.index(".bcp-quiz-question")+1),question_clone=$question_el.css("opacity",0).clone().css("position","absolute"),question_clone.insertAfter(replace_question_el).css({opacity:1,"z-index":1,width:$question_el.outerWidth(),top:$question_el.position().top,left:$question_el.position().left}).velocity({scale:"1.05 1.05"},300,"easeOutCubic").promise().done(function(_this){return function(){return question_clone.velocity({top:$(replace_question_el).position().top,left:$(replace_question_el).position().left},300,"easeOutCubic").promise().done(function(){var replace_question_clone;return replace_question_clone=$(replace_question_el).css("opacity",0).clone(),replace_question_clone.css({position:"absolute",opacity:1,width:$(replace_question_el).outerWidth(),top:$(replace_question_el).position().top,left:$(replace_question_el).position().left}).insertBefore(replace_question_el).velocity({top:$question_el.position().top,left:$question_el.position().left},300,"easeOutCubic").promise().done(function(){return replace_question_clone.remove(),replace_question_el.css({position:"relative",opacity:1,"z-index":0,top:0,left:0,width:"auto"}),question_clone.velocity({scale:"1 1"},400),question_clone.remove(),cback($question_el.find(".question-wrapper").html())})})}}(this))},QuestionViewModel}(kb.ViewModel)}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.QuizEditor.QuizViewModel=function(superClass){function QuizViewModel(model,options){null==options&&(options={}),this.save=bind(this.save,this),QuizViewModel.__super__.constructor.apply(this,arguments),this.enable_saving(),this.questions_in_quiz=ko.pureComputed(function(_this){return function(){return _this.questions().length+" question"+(1!==_this.questions().length?"s":"")+" in this Quiz:"}}(this)),this.questions.subscribe(function(_this){return function(){return _this.question_ids(_.map(_this.questions(),function(question_vm){return question_vm.model().id})),_this._saving_enabled?_this.save():void 0}}(this)),events.on("save:quiz",this.save)}return extend(QuizViewModel,superClass),QuizViewModel.prototype.disable_saving=function(){return this._saving_enabled=!1},QuizViewModel.prototype.enable_saving=function(){return this._saving_enabled=!0},QuizViewModel.prototype.save=function(options){return events.trigger("editor:status","<i class='icon-spinner icon-spin'></i> Saving quiz..."),this.model().save({},{success:function(_this){return function(model){return null!=options&&"function"==typeof options.success&&options.success(),events.trigger("editor:saved")}}(this),error:function(_this){return function(model){return null!=options&&"function"==typeof options.error?options.error("Error saving quiz."):void 0}}(this)})},QuizViewModel}(kb.ViewModel)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["quiz_editor/views/quiz"]=function(context){return function(){var $o,$p;return $p=window.HAML.preserve,$o=[],$o.push("<div class='content-object__header' data-bind='text: questions_in_quiz'></div>\n<div class='bcp__quiz--edit bcp__quiz__questions' data-bind='foreach: questions'>\n  <div class='bcp-quiz-question' data-bind=\"newQuestionAnimate: is_new, attr: {'class': ownership_class}\">\n    <div class='bcp-quiz-question__inner'>\n      <div class='bcp-quiz-question__creator-header'>\n        <div class='bcp-quiz-question__corner-num' data-bind='text: $index() + 1'></div>\n        <div class='bcp-quiz-question__creator'>\n          <div class='avatar-holder avatar-holder--22 bcp-quiz-question__creator__avatar' data-bind='html: avatar_tag, visible: show_avatar'></div>\n          <div class='bcp-quiz-question__creator__avatar--boundless' data-bind='visible: !show_avatar()'>\n            <img src='https://boundless-production.boundless-cdn.com/assets/favicon-4a432199dda8883f2ac18bc6f93aa300.png'>\n          </div>\n          <div class='bcp-quiz-question__creator__body' data-bind='text: attribution'></div>\n        </div>\n      </div>\n      <div class='question-wrapper' data-bind='html: learnosity_placeholder_html'></div>\n      <div class='bcp-quiz-question__edit-icon-bar'>\n        <div class='bcp-quiz-question__edit-icon bcp-quiz-question__edit-icon__edit' data-bind='click: show_question_editor, visible: is_directly_editable(), attr: {disabled: disable_question_actions}'>\n          <i class='boundless-icon-edit'></i>\n        </div>\n        <div class='bcp-quiz-question__edit-icon bcp-quiz-question__edit-icon__copy' data-bind='click: show_copy_prompt_or_clone_and_edit, visible: !is_directly_editable(), attr: {disabled: disable_question_actions}'>\n          <i class='boundless-icon-dup_and_edit'></i>\n        </div>\n        <div class='bcp-quiz-question__edit-icon bcp-quiz-question__edit-icon__move-up' data-bind='click: move_question_up, attr: {disabled: disable_question_actions() || $index() == 0}'>\n          <i class='boundless-icon-triangle'></i>\n        </div>\n        <div class='bcp-quiz-question__edit-icon bcp-quiz-question__edit-icon__move-down' data-bind='click: move_question_down, attr: {disabled: disable_question_actions() || $index() == $parent.questions().length - 1}'>\n          <i class='boundless-icon-triangle'></i>\n        </div>\n        <div class='bcp-quiz-question__edit-icon bcp-quiz-question__edit-icon__delete' data-bind='click: delete_question, attr: {disabled: disable_question_actions}'>\n          <i class='icon-trash'></i>\n        </div>\n        <div class='bcp-quiz-question__copy-prompt' data-bind='fadeToggle: show_copy_prompt'>\n          <div class='bcp-quiz-question__copy-prompt__header'></div>\n          <div class='bcp-quiz-question__copy-prompt__body'>\n            You can create a clone of this question, then edit it.\n          </div>\n          <i class='boundless-icon-triangle'></i>\n          <div class='bcp-quiz-question__copy-prompt__hide'>\n            <input class='bcp-quiz-question__copy-prompt__hide__check' type='checkbox' data-bind='click: toggle_question_clone_prompt'>\n            <span>Okay, don't show me this again.</span>\n          </div>\n          <div class='bcp-quiz-question__copy-prompt__ctas'>\n            <div class='bcp-quiz-question__copy-prompt__cta bcp-quiz-question__copy-prompt__ctas__cancel' data-bind='click: show_copy_prompt'>\n              Cancel\n            </div>\n            <div class='bcp-quiz-question__copy-prompt__cta bcp-quiz-question__copy-prompt__ctas__confirm' data-bind='click: clone_and_edit'>\n              <span>\n                <i class='boundless-icon-dup_and_edit'></i>\n                <span>Clone and Edit</span>\n              </span>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class='bcp-quiz-question__edit-error'>\n      <span class='bcp-quiz-question__edit-error__icon'>\n        <i class='boundless-icon-error'></i>\n      </span>\n      <span class='bcp-quiz-question__edit-error__body'>\n        There is an error with your question.\n      </span>\n    </div>\n    <div class='bcp-quiz-question__new'>\n      <div class='bcp-quiz-question__new__button--outer clearfix' data-bind='click: show_insert_after'>\n        <div class='bcp-quiz-question__edit-icon bcp-quiz-question__new__button'>\n          <div class='boundless-icon-plus'></div>\n        </div>\n        <div class='bcp-quiz-question__new__button-label'>\n          Add Question\n        </div>\n      </div>\n    </div>\n  </div>\n  <div class='bcp-quiz-question__new__prompt' data-bind='slideToggle: inserting_after'>\n    <div class='bcp-quiz-question__new__prompt__header'>\n      How would you like to add a question?\n    </div>\n    <div class='bcp-quiz-question__new__prompt__choices clearfix'>\n      <div class='bcp-quiz-question__new__prompt__choice bcp-quiz-question__new__prompt__choice--search' data-bind='click: show_question_search_modal'>\n        <div class='bcp-quiz-question__new__prompt__choice__icon'>\n          <div class='boundless-icon-search'></div>\n        </div>\n        <div class='bcp-quiz-question__new__prompt__choice__header'>\n          Browse or Search\n        </div>\n        <div class='bcp-quiz-question__new__prompt__choice__body'>\n          Browse existing questions on Boundless.\n        </div>\n      </div>\n      <div class='bcp-quiz-question__new__prompt__choice bcp-quiz-question__new__prompt__choice--create' data-bind='click: add_blank_question'>\n        <div class='bcp-quiz-question__new__prompt__choice__icon'>\n          <div class='boundless-icon-proposechange'></div>\n        </div>\n        <div class='bcp-quiz-question__new__prompt__choice__header'>\n          Create your own\n        </div>\n        <div class='bcp-quiz-question__new__prompt__choice__body'>\n          Write your own question from scratch.\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("reader_frame/views"),Boundless.ReaderFrame||(Boundless.ReaderFrame={}),Boundless.ReaderFrame.App=function(target_url){return this.controller=new Boundless.ReaderFrame.Controller({reader_frame:this,target_url:target_url})},$(function(){return $(document).on("click","a[data-reader-frame=true]",function(e){var href,target;return e.preventDefault(),target=$(e.currentTarget),href=target.data("redirect-destination")||target.attr("href"),session.logged_in()?Boundless.ReaderFrame.App(href):(events.off("register:complete"),events.on("register:complete",function(_this){return function(){return Boundless.ReaderFrame.App(href)}}(this)))})})}.call(this),!function(e){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=e();else if("function"==typeof define&&define.amd)define([],e);else{var f;"undefined"!=typeof window?f=window:"undefined"!=typeof global?f=global:"undefined"!=typeof self&&(f=self),f.Reflux=e()}}(function(){var define;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function(event){if(!this._events||!this._events[event])return[];for(var i=0,l=this._events[event].length,ee=[];l>i;i++)ee.push(this._events[event][i].fn);return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){if(!this._events||!this._events[event])return!1;var args,i,j,listeners=this._events[event],length=listeners.length,len=arguments.length,ee=listeners[0];if(1===length){switch(ee.once&&this.removeListener(event,ee.fn,!0),len){case 1:return ee.fn.call(ee.context),!0;case 2:return ee.fn.call(ee.context,a1),!0;case 3:return ee.fn.call(ee.context,a1,a2),!0;case 4:return ee.fn.call(ee.context,a1,a2,a3),!0;case 5:return ee.fn.call(ee.context,a1,a2,a3,a4),!0;case 6:return ee.fn.call(ee.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);len>i;i++)args[i-1]=arguments[i];ee.fn.apply(ee.context,args)}else for(i=0;length>i;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:
if(!args)for(j=1,args=new Array(len-1);len>j;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}return!0},EventEmitter.prototype.on=function(event,fn,context){return this._events||(this._events={}),this._events[event]||(this._events[event]=[]),this._events[event].push(new EE(fn,context||this)),this},EventEmitter.prototype.once=function(event,fn,context){return this._events||(this._events={}),this._events[event]||(this._events[event]=[]),this._events[event].push(new EE(fn,context||this,!0)),this},EventEmitter.prototype.removeListener=function(event,fn,once){if(!this._events||!this._events[event])return this;var listeners=this._events[event],events=[];if(fn)for(var i=0,length=listeners.length;length>i;i++)listeners[i].fn!==fn&&listeners[i].once!==once&&events.push(listeners[i]);return events.length?this._events[event]=events:this._events[event]=null,this},EventEmitter.prototype.removeAllListeners=function(event){return this._events?(event?this._events[event]=null:this._events={},this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.EventEmitter=EventEmitter,EventEmitter.EventEmitter2=EventEmitter,EventEmitter.EventEmitter3=EventEmitter,"object"==typeof module&&module.exports&&(module.exports=EventEmitter)},{}],2:[function(_dereq_,module,exports){(function(global){/*! Native Promise Only
    v0.7.6-a (c) Kyle Simpson
    MIT License: http://getify.mit-license.org
*/
!function(t,n,e){n[t]=n[t]||e(),"undefined"!=typeof module&&module.exports?module.exports=n[t]:"function"==typeof define&&define.amd&&define(function(){return n[t]})}("Promise","undefined"!=typeof global?global:this,function(){"use strict";function t(t,n){l.add(t,n),h||(h=y(l.drain))}function n(t){var n,e=typeof t;return null==t||"object"!=e&&"function"!=e||(n=t.then),"function"==typeof n?n:!1}function e(){for(var t=0;t<this.chain.length;t++)o(this,1===this.state?this.chain[t].success:this.chain[t].failure,this.chain[t]);this.chain.length=0}function o(t,e,o){var r,i;try{e===!1?o.reject(t.msg):(r=e===!0?t.msg:e.call(void 0,t.msg),r===o.promise?o.reject(TypeError("Promise-chain cycle")):(i=n(r))?i.call(r,o.resolve,o.reject):o.resolve(r))}catch(c){o.reject(c)}}function r(o){var c,u,a=this;if(!a.triggered){a.triggered=!0,a.def&&(a=a.def);try{(c=n(o))?(u=new f(a),c.call(o,function(){r.apply(u,arguments)},function(){i.apply(u,arguments)})):(a.msg=o,a.state=1,a.chain.length>0&&t(e,a))}catch(s){i.call(u||new f(a),s)}}}function i(n){var o=this;o.triggered||(o.triggered=!0,o.def&&(o=o.def),o.msg=n,o.state=2,o.chain.length>0&&t(e,o))}function c(t,n,e,o){for(var r=0;r<n.length;r++)!function(r){t.resolve(n[r]).then(function(t){e(r,t)},o)}(r)}function f(t){this.def=t,this.triggered=!1}function u(t){this.promise=t,this.state=0,this.triggered=!1,this.chain=[],this.msg=void 0}function a(n){if("function"!=typeof n)throw TypeError("Not a function");if(0!==this.__NPO__)throw TypeError("Not a promise");this.__NPO__=1;var o=new u(this);this.then=function(n,r){var i={success:"function"==typeof n?n:!0,failure:"function"==typeof r?r:!1};return i.promise=new this.constructor(function(t,n){if("function"!=typeof t||"function"!=typeof n)throw TypeError("Not a function");i.resolve=t,i.reject=n}),o.chain.push(i),0!==o.state&&t(e,o),i.promise},this["catch"]=function(t){return this.then(void 0,t)};try{n.call(void 0,function(t){r.call(o,t)},function(t){i.call(o,t)})}catch(c){i.call(o,c)}}var s,h,l,p=Object.prototype.toString,y="undefined"!=typeof setImmediate?function(t){return setImmediate(t)}:setTimeout;try{Object.defineProperty({},"x",{}),s=function(t,n,e,o){return Object.defineProperty(t,n,{value:e,writable:!0,configurable:o!==!1})}}catch(d){s=function(t,n,e){return t[n]=e,t}}l=function(){function t(t,n){this.fn=t,this.self=n,this.next=void 0}var n,e,o;return{add:function(r,i){o=new t(r,i),e?e.next=o:n=o,e=o,o=void 0},drain:function(){var t=n;for(n=e=h=void 0;t;)t.fn.call(t.self),t=t.next}}}();var g=s({},"constructor",a,!1);return s(a,"prototype",g,!1),s(g,"__NPO__",0,!1),s(a,"resolve",function(t){var n=this;return t&&"object"==typeof t&&1===t.__NPO__?t:new n(function(n,e){if("function"!=typeof n||"function"!=typeof e)throw TypeError("Not a function");n(t)})}),s(a,"reject",function(t){return new this(function(n,e){if("function"!=typeof n||"function"!=typeof e)throw TypeError("Not a function");e(t)})}),s(a,"all",function(t){var n=this;return"[object Array]"!=p.call(t)?n.reject(TypeError("Not an array")):0===t.length?n.resolve([]):new n(function(e,o){if("function"!=typeof e||"function"!=typeof o)throw TypeError("Not a function");var r=t.length,i=Array(r),f=0;c(n,t,function(t,n){i[t]=n,++f===r&&e(i)},o)})}),s(a,"race",function(t){var n=this;return"[object Array]"!=p.call(t)?n.reject(TypeError("Not an array")):new n(function(e,o){if("function"!=typeof e||"function"!=typeof o)throw TypeError("Not a function");c(n,t,function(t,n){e(n)},o)})}),a})}).call(this,"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}],3:[function(_dereq_,module,exports){module.exports={}},{}],4:[function(_dereq_,module,exports){exports.createdStores=[],exports.createdActions=[],exports.reset=function(){for(;exports.createdStores.length;)exports.createdStores.pop();for(;exports.createdActions.length;)exports.createdActions.pop()}},{}],5:[function(_dereq_,module,exports){var _=_dereq_("./utils"),maker=_dereq_("./joins").instanceJoinCreator,mapChildListenables=function(listenable){for(var childName,i=0,children={};i<(listenable.children||[]).length;++i)childName=listenable.children[i],listenable[childName]&&(children[childName]=listenable[childName]);return children},flattenListenables=function(listenables){var flattened={};for(var key in listenables){var listenable=listenables[key],childMap=mapChildListenables(listenable),children=flattenListenables(childMap);flattened[key]=listenable;for(var childKey in children){var childListenable=children[childKey];flattened[key+_.capitalize(childKey)]=childListenable}}return flattened};module.exports={hasListener:function(listenable){for(var j,listener,listenables,i=0;i<(this.subscriptions||[]).length;++i)for(listenables=[].concat(this.subscriptions[i].listenable),j=0;j<listenables.length;j++)if(listener=listenables[j],listener===listenable||listener.hasListener&&listener.hasListener(listenable))return!0;return!1},listenToMany:function(listenables){var allListenables=flattenListenables(listenables);for(var key in allListenables){var cbname=_.callbackName(key),localname=this[cbname]?cbname:this[key]?key:void 0;localname&&this.listenTo(allListenables[key],localname,this[cbname+"Default"]||this[localname+"Default"]||localname)}},validateListening:function(listenable){return listenable===this?"Listener is not able to listen to itself":_.isFunction(listenable.listen)?listenable.hasListener&&listenable.hasListener(this)?"Listener cannot listen to this listenable because of circular loop":void 0:listenable+" is missing a listen method"},listenTo:function(listenable,callback,defaultCallback){var desub,unsubscriber,subscriptionobj,subs=this.subscriptions=this.subscriptions||[];return _.throwIf(this.validateListening(listenable)),this.fetchInitialState(listenable,defaultCallback),desub=listenable.listen(this[callback]||callback,this),unsubscriber=function(){var index=subs.indexOf(subscriptionobj);_.throwIf(-1===index,"Tried to remove listen already gone from subscriptions list!"),subs.splice(index,1),desub()},subscriptionobj={stop:unsubscriber,listenable:listenable},subs.push(subscriptionobj),subscriptionobj},stopListeningTo:function(listenable){for(var sub,i=0,subs=this.subscriptions||[];i<subs.length;i++)if(sub=subs[i],sub.listenable===listenable)return sub.stop(),_.throwIf(-1!==subs.indexOf(sub),"Failed to remove listen from subscriptions list!"),!0;return!1},stopListeningToAll:function(){for(var remaining,subs=this.subscriptions||[];remaining=subs.length;)subs[0].stop(),_.throwIf(subs.length!==remaining-1,"Failed to remove listen from subscriptions list!")},fetchInitialState:function(listenable,defaultCallback){defaultCallback=defaultCallback&&this[defaultCallback]||defaultCallback;var me=this;if(_.isFunction(defaultCallback)&&_.isFunction(listenable.getInitialState)){var data=listenable.getInitialState();data&&_.isFunction(data.then)?data.then(function(){defaultCallback.apply(me,arguments)}):defaultCallback.call(this,data)}},joinTrailing:maker("last"),joinLeading:maker("first"),joinConcat:maker("all"),joinStrict:maker("strict")}},{"./joins":15,"./utils":19}],6:[function(_dereq_,module,exports){var _=_dereq_("./utils"),ListenerMethods=_dereq_("./ListenerMethods");module.exports=_.extend({componentWillUnmount:ListenerMethods.stopListeningToAll},ListenerMethods)},{"./ListenerMethods":5,"./utils":19}],7:[function(_dereq_,module,exports){var _=_dereq_("./utils");module.exports={preEmit:function(){},shouldEmit:function(){return!0},listen:function(callback,bindContext){bindContext=bindContext||this;var eventHandler=function(args){aborted||callback.apply(bindContext,args)},me=this,aborted=!1;return this.emitter.addListener(this.eventLabel,eventHandler),function(){aborted=!0,me.emitter.removeListener(me.eventLabel,eventHandler)}},promise:function(promise){var me=this,canHandlePromise=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0;if(!canHandlePromise)throw new Error('Publisher must have "completed" and "failed" child publishers');promise.then(function(response){return me.completed(response)},function(error){return me.failed(error)})},listenAndPromise:function(callback,bindContext){var me=this;bindContext=bindContext||this,this.willCallPromise=(this.willCallPromise||0)+1;var removeListen=this.listen(function(){if(!callback)throw new Error("Expected a function returning a promise but got "+callback);var args=arguments,promise=callback.apply(bindContext,args);return me.promise.call(me,promise)},bindContext);return function(){me.willCallPromise--,removeListen.call(me)}},trigger:function(){var args=arguments,pre=this.preEmit.apply(this,args);args=void 0===pre?args:_.isArguments(pre)?pre:[].concat(pre),this.shouldEmit.apply(this,args)&&this.emitter.emit(this.eventLabel,args)},triggerAsync:function(){var args=arguments,me=this;_.nextTick(function(){me.trigger.apply(me,args)})},triggerPromise:function(){var me=this,args=arguments,canHandlePromise=this.children.indexOf("completed")>=0&&this.children.indexOf("failed")>=0,promise=_.createPromise(function(resolve,reject){if(me.willCallPromise)return void _.nextTick(function(){var old_promise_method=me.promise;me.promise=function(promise){return promise.then(resolve,reject),me.promise=old_promise_method,me.promise.apply(me,arguments)},me.trigger.apply(me,args)});if(canHandlePromise)var removeSuccess=me.completed.listen(function(args){removeSuccess(),removeFailed(),resolve(args)}),removeFailed=me.failed.listen(function(args){removeSuccess(),removeFailed(),reject(args)});me.triggerAsync.apply(me,args),canHandlePromise||resolve()});return promise}}},{"./utils":19}],8:[function(_dereq_,module,exports){module.exports={}},{}],9:[function(_dereq_,module,exports){module.exports=function(store,definition){for(var name in definition)if(Object.getOwnPropertyDescriptor&&Object.defineProperty){var propertyDescriptor=Object.getOwnPropertyDescriptor(definition,name);if(!propertyDescriptor.value||"function"!=typeof propertyDescriptor.value||!definition.hasOwnProperty(name))continue;store[name]=definition[name].bind(store)}else{var property=definition[name];if("function"!=typeof property||!definition.hasOwnProperty(name))continue;store[name]=property.bind(store)}return store}},{}],10:[function(_dereq_,module,exports){var Reflux=_dereq_("./index"),_=_dereq_("./utils");module.exports=function(listenable,key){return{getInitialState:function(){return _.isFunction(listenable.getInitialState)?void 0===key?listenable.getInitialState():_.object([key],[listenable.getInitialState()]):{}},componentDidMount:function(){_.extend(this,Reflux.ListenerMethods);var me=this,cb=void 0===key?this.setState:function(v){me.setState(_.object([key],[v]))};this.listenTo(listenable,cb)},componentWillUnmount:Reflux.ListenerMixin.componentWillUnmount}}},{"./index":14,"./utils":19}],11:[function(_dereq_,module,exports){var Reflux=_dereq_("./index"),_=_dereq_("./utils");module.exports=function(listenable,key,filterFunc){return filterFunc=_.isFunction(key)?key:filterFunc,{getInitialState:function(){if(_.isFunction(listenable.getInitialState)){if(_.isFunction(key))return filterFunc.call(this,listenable.getInitialState());var result=filterFunc.call(this,listenable.getInitialState());return result?_.object([key],[result]):{}}return{}},componentDidMount:function(){_.extend(this,Reflux.ListenerMethods);var me=this,cb=function(value){if(_.isFunction(key))me.setState(filterFunc.call(me,value));else{var result=filterFunc.call(me,value);me.setState(_.object([key],[result]))}};this.listenTo(listenable,cb)},componentWillUnmount:Reflux.ListenerMixin.componentWillUnmount}}},{"./index":14,"./utils":19}],12:[function(_dereq_,module,exports){var _=_dereq_("./utils"),Reflux=_dereq_("./index"),Keep=_dereq_("./Keep"),allowed={preEmit:1,shouldEmit:1},createAction=function(definition){definition=definition||{},_.isObject(definition)||(definition={actionName:definition});for(var a in Reflux.ActionMethods)if(!allowed[a]&&Reflux.PublisherMethods[a])throw new Error("Cannot override API method "+a+" in Reflux.ActionMethods. Use another method name or override it on Reflux.PublisherMethods instead.");for(var d in definition)if(!allowed[d]&&Reflux.PublisherMethods[d])throw new Error("Cannot override API method "+d+" in action creation. Use another method name or override it on Reflux.PublisherMethods instead.");definition.children=definition.children||[],definition.asyncResult&&(definition.children=definition.children.concat(["completed","failed"]));for(var i=0,childActions={};i<definition.children.length;i++){var name=definition.children[i];childActions[name]=createAction(name)}var context=_.extend({eventLabel:"action",emitter:new _.EventEmitter,_isAction:!0},Reflux.PublisherMethods,Reflux.ActionMethods,definition),functor=function(){return functor[functor.sync?"trigger":"triggerPromise"].apply(functor,arguments)};return _.extend(functor,childActions,context),Keep.createdActions.push(functor),functor};module.exports=createAction},{"./Keep":4,"./index":14,"./utils":19}],13:[function(_dereq_,module,exports){var _=_dereq_("./utils"),Reflux=_dereq_("./index"),Keep=_dereq_("./Keep"),mixer=_dereq_("./mixer"),allowed={preEmit:1,shouldEmit:1},bindMethods=_dereq_("./bindMethods");module.exports=function(definition){function Store(){var arr,i=0;if(this.subscriptions=[],this.emitter=new _.EventEmitter,this.eventLabel="change",bindMethods(this,definition),this.init&&_.isFunction(this.init)&&this.init(),this.listenables)for(arr=[].concat(this.listenables);i<arr.length;i++)this.listenToMany(arr[i])}definition=definition||{};for(var a in Reflux.StoreMethods)if(!allowed[a]&&(Reflux.PublisherMethods[a]||Reflux.ListenerMethods[a]))throw new Error("Cannot override API method "+a+" in Reflux.StoreMethods. Use another method name or override it on Reflux.PublisherMethods / Reflux.ListenerMethods instead.");for(var d in definition)if(!allowed[d]&&(Reflux.PublisherMethods[d]||Reflux.ListenerMethods[d]))throw new Error("Cannot override API method "+d+" in store creation. Use another method name or override it on Reflux.PublisherMethods / Reflux.ListenerMethods instead.");definition=mixer(definition),_.extend(Store.prototype,Reflux.ListenerMethods,Reflux.PublisherMethods,Reflux.StoreMethods,definition);var store=new Store;return Keep.createdStores.push(store),store}},{"./Keep":4,"./bindMethods":9,"./index":14,"./mixer":18,"./utils":19}],14:[function(_dereq_,module,exports){exports.ActionMethods=_dereq_("./ActionMethods"),exports.ListenerMethods=_dereq_("./ListenerMethods"),exports.PublisherMethods=_dereq_("./PublisherMethods"),exports.StoreMethods=_dereq_("./StoreMethods"),exports.createAction=_dereq_("./createAction"),exports.createStore=_dereq_("./createStore"),exports.connect=_dereq_("./connect"),exports.connectFilter=_dereq_("./connectFilter"),exports.ListenerMixin=_dereq_("./ListenerMixin"),exports.listenTo=_dereq_("./listenTo"),exports.listenToMany=_dereq_("./listenToMany");var maker=_dereq_("./joins").staticJoinCreator;exports.joinTrailing=exports.all=maker("last"),exports.joinLeading=maker("first"),exports.joinStrict=maker("strict"),exports.joinConcat=maker("all");var _=_dereq_("./utils");exports.EventEmitter=_.EventEmitter,exports.Promise=_.Promise,exports.createActions=function(definitions){var actions={};for(var k in definitions)if(definitions.hasOwnProperty(k)){var val=definitions[k],actionName=_.isObject(val)?k:val;actions[actionName]=exports.createAction(val)}return actions},exports.setEventEmitter=function(ctx){var _=_dereq_("./utils");exports.EventEmitter=_.EventEmitter=ctx},exports.setPromise=function(ctx){var _=_dereq_("./utils");exports.Promise=_.Promise=ctx},exports.setPromiseFactory=function(factory){var _=_dereq_("./utils");_.createPromise=factory},exports.nextTick=function(nextTick){var _=_dereq_("./utils");_.nextTick=nextTick},exports.__keep=_dereq_("./Keep"),Function.prototype.bind||console.error("Function.prototype.bind not available. ES5 shim required. https://github.com/spoike/refluxjs#es5")},{"./ActionMethods":3,"./Keep":4,"./ListenerMethods":5,"./ListenerMixin":6,"./PublisherMethods":7,"./StoreMethods":8,"./connect":10,"./connectFilter":11,"./createAction":12,"./createStore":13,"./joins":15,"./listenTo":16,"./listenToMany":17,"./utils":19}],15:[function(_dereq_,module,exports){function makeStopper(subobj,cancels,context){return function(){var i,subs=context.subscriptions,index=subs?subs.indexOf(subobj):-1;for(_.throwIf(-1===index,"Tried to remove join already gone from subscriptions list!"),i=0;i<cancels.length;i++)cancels[i]();subs.splice(index,1)}}function reset(join){join.listenablesEmitted=new Array(join.numberOfListenables),join.args=new Array(join.numberOfListenables)}function newListener(i,join){return function(){var callargs=slice.call(arguments);if(join.listenablesEmitted[i])switch(join.strategy){case"strict":throw new Error("Strict join failed because listener triggered twice.");case"last":join.args[i]=callargs;break;case"all":join.args[i].push(callargs)}else join.listenablesEmitted[i]=!0,join.args[i]="all"===join.strategy?[callargs]:callargs;emitIfAllListenablesEmitted(join)}}function emitIfAllListenablesEmitted(join){for(var i=0;i<join.numberOfListenables;i++)if(!join.listenablesEmitted[i])return;join.callback.apply(join.listener,join.args),reset(join)}var slice=Array.prototype.slice,_=_dereq_("./utils"),createStore=_dereq_("./createStore"),strategyMethodNames={strict:"joinStrict",first:"joinLeading",last:"joinTrailing",all:"joinConcat"};exports.staticJoinCreator=function(strategy){return function(){var listenables=slice.call(arguments);return createStore({init:function(){this[strategyMethodNames[strategy]].apply(this,listenables.concat("triggerAsync"))}})}},exports.instanceJoinCreator=function(strategy){return function(){_.throwIf(arguments.length<3,"Cannot create a join with less than 2 listenables!");var i,subobj,listenables=slice.call(arguments),callback=listenables.pop(),numberOfListenables=listenables.length,join={numberOfListenables:numberOfListenables,callback:this[callback]||callback,listener:this,strategy:strategy},cancels=[];for(i=0;numberOfListenables>i;i++)_.throwIf(this.validateListening(listenables[i]));for(i=0;numberOfListenables>i;i++)cancels.push(listenables[i].listen(newListener(i,join),this));return reset(join),subobj={listenable:listenables},subobj.stop=makeStopper(subobj,cancels,this),this.subscriptions=(this.subscriptions||[]).concat(subobj),subobj}}},{"./createStore":13,"./utils":19}],16:[function(_dereq_,module,exports){var Reflux=_dereq_("./index");module.exports=function(listenable,callback,initial){return{componentDidMount:function(){for(var m in Reflux.ListenerMethods)if(this[m]!==Reflux.ListenerMethods[m]){if(this[m])throw"Can't have other property '"+m+"' when using Reflux.listenTo!";this[m]=Reflux.ListenerMethods[m]}this.listenTo(listenable,callback,initial)},componentWillUnmount:Reflux.ListenerMethods.stopListeningToAll}}},{"./index":14}],17:[function(_dereq_,module,exports){var Reflux=_dereq_("./index");module.exports=function(listenables){return{componentDidMount:function(){for(var m in Reflux.ListenerMethods)if(this[m]!==Reflux.ListenerMethods[m]){if(this[m])throw"Can't have other property '"+m+"' when using Reflux.listenToMany!";this[m]=Reflux.ListenerMethods[m]}this.listenToMany(listenables)},componentWillUnmount:Reflux.ListenerMethods.stopListeningToAll}}},{"./index":14}],18:[function(_dereq_,module,exports){var _=_dereq_("./utils");module.exports=function(def){var composed={init:[],preEmit:[],shouldEmit:[]},updated=function mixDef(mixin){var mixed={};return mixin.mixins&&mixin.mixins.forEach(function(subMixin){_.extend(mixed,mixDef(subMixin))}),_.extend(mixed,mixin),Object.keys(composed).forEach(function(composable){mixin.hasOwnProperty(composable)&&composed[composable].push(mixin[composable])}),mixed}(def);return composed.init.length>1&&(updated.init=function(){var args=arguments;composed.init.forEach(function(init){init.apply(this,args)},this)}),composed.preEmit.length>1&&(updated.preEmit=function(){return composed.preEmit.reduce(function(args,preEmit){var newValue=preEmit.apply(this,args);return void 0===newValue?args:[newValue]}.bind(this),arguments)}),composed.shouldEmit.length>1&&(updated.shouldEmit=function(){var args=arguments;return!composed.shouldEmit.some(function(shouldEmit){return!shouldEmit.apply(this,args)},this)}),Object.keys(composed).forEach(function(composable){1===composed[composable].length&&(updated[composable]=composed[composable][0])}),updated}},{"./utils":19}],19:[function(_dereq_,module,exports){var isObject=exports.isObject=function(obj){var type=typeof obj;return"function"===type||"object"===type&&!!obj};exports.extend=function(obj){if(!isObject(obj))return obj;for(var source,prop,i=1,length=arguments.length;length>i;i++){source=arguments[i];for(prop in source)if(Object.getOwnPropertyDescriptor&&Object.defineProperty){var propertyDescriptor=Object.getOwnPropertyDescriptor(source,prop);Object.defineProperty(obj,prop,propertyDescriptor)}else obj[prop]=source[prop]}return obj},exports.isFunction=function(value){return"function"==typeof value},exports.EventEmitter=_dereq_("eventemitter3"),exports.nextTick=function(callback){setTimeout(callback,0)},exports.capitalize=function(string){return string.charAt(0).toUpperCase()+string.slice(1)},exports.callbackName=function(string){return"on"+exports.capitalize(string)},exports.object=function(keys,vals){for(var o={},i=0;i<keys.length;i++)o[keys[i]]=vals[i];return o},exports.Promise=_dereq_("native-promise-only"),exports.createPromise=function(resolver){return new exports.Promise(resolver)},exports.isArguments=function(value){return"object"==typeof value&&"callee"in value&&"number"==typeof value.length},exports.throwIf=function(val,msg){if(val)throw Error(msg||val)}},{eventemitter3:1,"native-promise-only":2}]},{},[14])(14)}),function(){var m,v,y,z,A,r,w,B,F,C,G,H,p,s,q,o,t,D,I,E={}.hasOwnProperty,j=[].indexOf||function(a){for(var c=0,b=this.length;b>c;c++)if(c in this&&this[c]===a)return c;return-1};r={is_unordered:!1,is_counting:!1,is_exclusive:!1,is_solitary:!1,prevent_default:!1,prevent_repeat:!1},D="meta alt option ctrl shift cmd".split(" "),o="ctrl",m={debug:!1};var x=function(a){var c,b;for(c in a)E.call(a,c)&&(b=a[c],!1!==b&&(this[c]=b));this.keys=this.keys||[],this.count=this.count||0};x.prototype.allows_key_repeat=function(){return!this.prevent_repeat&&"function"==typeof this.on_keydown},x.prototype.reset=function(){return this.count=0,this.keyup_fired=null};var g=function(a,c){var b,d;this.should_force_event_defaults=this.should_suppress_event_defaults=!1,this.sequence_delay=800,this._registered_combos=[],this._keys_down=[],this._active_combos=[],this._sequence=[],this._sequence_timer=null,this._prevent_capture=!1,this._defaults=c||{};for(b in r)E.call(r,b)&&(d=r[b],this._defaults[b]=this._defaults[b]||d);this.element=a||document.body,b=function(a,b,c){return a.addEventListener?a.addEventListener(b,c):a.attachEvent&&a.attachEvent("on"+b,c),c};var e=this;this.keydown_event=b(this.element,"keydown",function(a){return a=a||window.event,e._receive_input(a,!0),e._bug_catcher(a)});var f=this;this.keyup_event=b(this.element,"keyup",function(a){return a=a||window.event,f._receive_input(a,!1)});var h=this;this.blur_event=b(window,"blur",function(){var a,b,c,d;for(d=h._keys_down,b=0,c=d.length;c>b;b++)a=d[b],h._key_up(a,{});return h._keys_down=[]})};g.prototype.destroy=function(){var a;return a=function(a,b,d){return null!=a.removeEventListener?a.removeEventListener(b,d):null!=a.removeEvent?a.removeEvent("on"+b,d):void 0},a(this.element,"keydown",this.keydown_event),a(this.element,"keyup",this.keyup_event),a(window,"blur",this.blur_event)},g.prototype._bug_catcher=function(a){var c;return"cmd"===o&&0<=j.call(this._keys_down,"cmd")&&"cmd"!==(c=z(a.keyCode))&&"shift"!==c&&"alt"!==c&&"caps"!==c&&"tab"!==c?this._receive_input(a,!1):void 0},g.prototype._cmd_bug_check=function(a){return"cmd"===o&&0<=j.call(this._keys_down,"cmd")&&0>j.call(a,"cmd")?!1:!0},g.prototype._prevent_default=function(a,c){return(c||this.should_suppress_event_defaults)&&!this.should_force_event_defaults&&(a.preventDefault?a.preventDefault():a.returnValue=!1,a.stopPropagation)?a.stopPropagation():void 0},g.prototype._get_active_combos=function(a){var c,b;return c=[],b=w(this._keys_down,function(b){return b!==a}),b.push(a),this._match_combo_arrays(b,function(a){return function(b){return a._cmd_bug_check(b.keys)?c.push(b):void 0}}(this)),this._fuzzy_match_combo_arrays(b,function(a){return function(b){return 0<=j.call(c,b)||b.is_solitary||!a._cmd_bug_check(b.keys)?void 0:c.push(b)}}(this)),c},g.prototype._get_potential_combos=function(a){var c,b,d,e,f;for(b=[],f=this._registered_combos,d=0,e=f.length;e>d;d++)c=f[d],c.is_sequence||0<=j.call(c.keys,a)&&this._cmd_bug_check(c.keys)&&b.push(c);return b},g.prototype._add_to_active_combos=function(a){var c,b,d,e,f,h,i,g,n,k,l;if(h=!1,f=!0,d=!1,0<=j.call(this._active_combos,a))return!0;if(this._active_combos.length)for(e=i=0,k=this._active_combos.length;k>=0?k>i:i>k;e=k>=0?++i:--i)if((c=this._active_combos[e])&&c.is_exclusive&&a.is_exclusive){if(c=c.keys,!h)for(g=0,n=c.length;n>g;g++)if(b=c[g],h=!0,0>j.call(a.keys,b)){h=!1;break}if(f&&!h)for(l=a.keys,g=0,n=l.length;n>g;g++)if(b=l[g],f=!1,0>j.call(c,b)){f=!0;break}h&&(d?(c=this._active_combos.splice(e,1)[0],null!=c&&c.reset()):(c=this._active_combos.splice(e,1,a)[0],null!=c&&c.reset(),d=!0),f=!1)}return f&&this._active_combos.unshift(a),h||f},g.prototype._remove_from_active_combos=function(a){var c,b,d,e;for(b=d=0,e=this._active_combos.length;e>=0?e>d:d>e;b=e>=0?++d:--d)if(c=this._active_combos[b],c===a){a=this._active_combos.splice(b,1)[0],a.reset();break}},g.prototype._get_possible_sequences=function(){var a,c,b,d,e,f,h,i,g,n,k,l;for(d=[],n=this._registered_combos,f=0,g=n.length;g>f;f++)for(a=n[f],c=h=1,k=this._sequence.length;k>=1?k>=h:h>=k;c=k>=1?++h:--h)if(e=this._sequence.slice(-c),a.is_sequence){if(0>j.call(a.keys,"shift")&&(e=w(e,function(a){return"shift"!==a}),!e.length))continue;for(c=i=0,l=e.length;l>=0?l>i:i>l;c=l>=0?++i:--i){if(a.keys[c]!==e[c]){b=!1;break}b=!0}b&&d.push(a)}return d},g.prototype._add_key_to_sequence=function(a,c){var b,d,e,f;if(this._sequence.push(a),d=this._get_possible_sequences(),d.length){for(e=0,f=d.length;f>e;e++)b=d[e],this._prevent_default(c,b.prevent_default);this._sequence_timer&&clearTimeout(this._sequence_timer),-1<this.sequence_delay&&(this._sequence_timer=setTimeout(function(){return this._sequence=[]},this.sequence_delay))}else this._sequence=[]},g.prototype._get_sequence=function(a){var c,b,d,e,f,h,i,g,n,k,l,u;for(k=this._registered_combos,h=0,n=k.length;n>h;h++)if(c=k[h],c.is_sequence){for(b=i=1,l=this._sequence.length;l>=1?l>=i:i>=l;b=l>=1?++i:--i)if(f=w(this._sequence,function(a){return 0<=j.call(c.keys,"shift")?!0:"shift"!==a}).slice(-b),c.keys.length===f.length)for(b=g=0,u=f.length;u>=0?u>g:g>u;b=u>=0?++g:--g)if(e=f[b],!(0>j.call(c.keys,"shift")&&"shift"===e||"shift"===a&&0>j.call(c.keys,"shift"))){if(c.keys[b]!==e){d=!1;break}d=!0}if(d)return c}return!1},g.prototype._receive_input=function(a,c){var b;if(this._prevent_capture)this._keys_down.length&&(this._keys_down=[]);else if(b=z(a.keyCode),(c||this._keys_down.length||!("alt"===b||b===o))&&b)return c?this._key_down(b,a):this._key_up(b,a)},g.prototype._fire=function(a,c,b,d){return"function"==typeof c["on_"+a]&&this._prevent_default(b,!0!==c["on_"+a].call(c["this"],b,c.count,d)),"release"===a&&(c.count=0),"keyup"===a?c.keyup_fired=!0:void 0},g.prototype._match_combo_arrays=function(a,c){var b,d,e,f;for(f=this._registered_combos,d=0,e=f.length;e>d;d++)b=f[d],(!b.is_unordered&&y(a,b.keys)||b.is_unordered&&v(a,b.keys))&&c(b)},g.prototype._fuzzy_match_combo_arrays=function(a,c){var b,d,e,f;for(f=this._registered_combos,d=0,e=f.length;e>d;d++)b=f[d],(!b.is_unordered&&C(b.keys,a)||b.is_unordered&&F(b.keys,a))&&c(b)},g.prototype._keys_remain=function(a){var c,b,d,e;for(e=a.keys,b=0,d=e.length;d>b;b++)if(a=e[b],0<=j.call(this._keys_down,a)){c=!0;break}return c},g.prototype._key_down=function(a,c){var b,d,e,f,h;(b=A(a,c))&&(a=b),this._add_key_to_sequence(a,c),(b=this._get_sequence(a))&&this._fire("keydown",b,c);for(e in t)b=t[e],c[b]&&(e===a||0<=j.call(this._keys_down,e)||this._keys_down.push(e));for(e in t)if(b=t[e],e!==a&&0<=j.call(this._keys_down,e)&&!c[b]&&!("cmd"===e&&"cmd"!==o))for(b=d=0,f=this._keys_down.length;f>=0?f>d:d>f;b=f>=0?++d:--d)this._keys_down[b]===e&&this._keys_down.splice(b,1);for(d=this._get_active_combos(a),e=this._get_potential_combos(a),f=0,h=d.length;h>f;f++)b=d[f],this._handle_combo_down(b,e,a,c);if(e.length)for(d=0,f=e.length;f>d;d++)b=e[d],this._prevent_default(c,b.prevent_default);0>j.call(this._keys_down,a)&&this._keys_down.push(a)},g.prototype._handle_combo_down=function(a,c,b,d){var e,f,h,g,m;if(0>j.call(a.keys,b))return!1;if(this._prevent_default(d,a&&a.prevent_default),e=!1,0<=j.call(this._keys_down,b)&&(e=!0,!a.allows_key_repeat()))return!1;if(h=this._add_to_active_combos(a,b),b=a.keyup_fired=!1,a.is_exclusive)for(g=0,m=c.length;m>g;g++)if(f=c[g],f.is_exclusive&&f.keys.length>a.keys.length){b=!0;break}return!b&&(a.is_counting&&"function"==typeof a.on_keydown&&(a.count+=1),h)?this._fire("keydown",a,d,e):void 0},g.prototype._key_up=function(a,c){var b,d,e,f,h,g;if(b=a,(e=A(a,c))&&(a=e),e=s[b],c.shiftKey?e&&0<=j.call(this._keys_down,e)||(a=b):b&&0<=j.call(this._keys_down,b)||(a=e),(f=this._get_sequence(a))&&this._fire("keyup",f,c),0>j.call(this._keys_down,a))return!1;for(f=h=0,g=this._keys_down.length;g>=0?g>h:h>g;f=g>=0?++h:--h)if((d=this._keys_down[f])===a||d===e||d===b){this._keys_down.splice(f,1);break}for(d=this._active_combos.length,e=[],g=this._active_combos,f=0,h=g.length;h>f;f++)b=g[f],0<=j.call(b.keys,a)&&e.push(b);for(f=0,h=e.length;h>f;f++)b=e[f],this._handle_combo_up(b,c,a);if(d>1)for(h=this._active_combos,d=0,f=h.length;f>d;d++)b=h[d],void 0===b||0<=j.call(e,b)||this._keys_remain(b)||this._remove_from_active_combos(b)},g.prototype._handle_combo_up=function(a,c,b){var d,e;this._prevent_default(c,a&&a.prevent_default),e=this._keys_remain(a),a.keyup_fired||(d=this._keys_down.slice(),d.push(b),a.is_solitary&&!v(d,a.keys))||(this._fire("keyup",a,c),a.is_counting&&"function"==typeof a.on_keyup&&"function"!=typeof a.on_keydown&&(a.count+=1)),e||(this._fire("release",a,c),this._remove_from_active_combos(a))},g.prototype.simple_combo=function(a,c){return this.register_combo({keys:a,on_keydown:c})},g.prototype.counting_combo=function(a,c){return this.register_combo({keys:a,is_counting:!0,is_unordered:!1,on_keydown:c})},g.prototype.sequence_combo=function(a,c){return this.register_combo({keys:a,on_keydown:c,is_sequence:!0})},g.prototype.register_combo=function(a){var c,b,d;"string"==typeof a.keys&&(a.keys=a.keys.split(" ")),d=this._defaults;for(c in d)E.call(d,c)&&(b=d[c],void 0===a[c]&&(a[c]=b));return a=new x(a),I(a)?(this._registered_combos.push(a),a):void 0},g.prototype.register_many=function(a){var c,b,d,e;for(e=[],b=0,d=a.length;d>b;b++)c=a[b],e.push(this.register_combo(c));return e},g.prototype.unregister_combo=function(a){var c,b,d,e,f,g;if(!a)return!1;var i=this;if(b=function(a){var b,c,d,e;for(e=[],b=c=0,d=i._registered_combos.length;d>=0?d>c:c>d;b=d>=0?++c:--c){if(a===i._registered_combos[b]){i._registered_combos.splice(b,1);break}e.push(void 0)}return e},a instanceof x)return b(a);for("string"==typeof a&&(a=a.split(" ")),f=this._registered_combos,g=[],d=0,e=f.length;e>d;d++)c=f[d],null!=c&&(c.is_unordered&&v(a,c.keys)||!c.is_unordered&&y(a,c.keys)?g.push(b(c)):g.push(void 0));return g},g.prototype.unregister_many=function(a){var c,b,d,e;for(e=[],b=0,d=a.length;d>b;b++)c=a[b],e.push(this.unregister_combo(c));return e},g.prototype.get_registered_combos=function(){return this._registered_combos},g.prototype.reset=function(){return this._registered_combos=[]},g.prototype.listen=function(){return this._prevent_capture=!1},g.prototype.stop_listening=function(){return this._prevent_capture=!0},g.prototype.get_meta_key=function(){return o},m.Listener=g,z=function(a){return p[a]},w=function(a,c){var b;if(a.filter)return a.filter(c);var d,e,f;for(f=[],d=0,e=a.length;e>d;d++)b=a[d],c(b)&&f.push(b);return f},v=function(a,c){var b,d,e;if(a.length!==c.length)return!1;for(d=0,e=a.length;e>d;d++)if(b=a[d],!(0<=j.call(c,b)))return!1;return!0},y=function(a,c){var b,d,e;if(a.length!==c.length)return!1;for(b=d=0,e=a.length;e>=0?e>d:d>e;b=e>=0?++d:--d)if(a[b]!==c[b])return!1;return!0},F=function(a,c){var b,d,e;for(d=0,e=a.length;e>d;d++)if(b=a[d],0>j.call(c,b))return!1;return!0},B=Array.prototype.indexOf||function(a,c){var b,d,e;for(b=d=0,e=a.length;e>=0?e>=d:d>=e;b=e>=0?++d:--d)if(a[b]===c)return b;return-1},C=function(a,c){var b,d,e,f;for(e=d=0,f=a.length;f>e;e++){
if(b=a[e],b=B.call(c,b),!(b>=d))return!1;d=b}return!0},q=function(){return m.debug?console.log.apply(console,arguments):void 0},G=function(a){var c,b,d;c=!1;for(d in p)if(b=p[d],a===b){c=!0;break}if(!c)for(d in s)if(b=s[d],a===b){c=!0;break}return c},I=function(a){var c,b,d,e,f,g,i;for(f=!0,a.keys.length||q("You're trying to bind a combo with no keys:",a),b=g=0,i=a.keys.length;i>=0?i>g:g>i;b=i>=0?++g:--g)d=a.keys[b],(c=H[d])&&(d=a.keys[b]=c),"meta"===d&&a.keys.splice(b,1,o),"cmd"===d&&q('Warning: use the "meta" key rather than "cmd" for Windows compatibility');for(i=a.keys,c=0,g=i.length;g>c;c++)d=i[c],G(d)||(q('Do not recognize the key "'+d+'"'),f=!1);if(0<=j.call(a.keys,"meta")||0<=j.call(a.keys,"cmd")){for(c=a.keys.slice(),g=0,i=D.length;i>g;g++)d=D[g],-1<(b=B.call(c,d))&&c.splice(b,1);1<c.length&&(q("META and CMD key combos cannot have more than 1 non-modifier keys",a,c),f=!1)}for(e in a)"undefined"===r[e]&&q("The property "+e+" is not a valid combo property. Your combo has still been registered.");return f},A=function(a,c){var b;return c.shiftKey?(b=s[a],null!=b?b:!1):!1},t={cmd:"metaKey",ctrl:"ctrlKey",shift:"shiftKey",alt:"altKey"},H={escape:"esc",control:"ctrl",command:"cmd","break":"pause",windows:"cmd",option:"alt",caps_lock:"caps",apostrophe:"'",semicolon:";",tilde:"~",accent:"`",scroll_lock:"scroll",num_lock:"num"},s={"/":"?",".":">",",":"<","'":'"',";":":","[":"{","]":"}","\\":"|","`":"~","=":"+","-":"_",1:"!",2:"@",3:"#",4:"$",5:"%",6:"^",7:"&",8:"*",9:"(",0:")"},p={0:"\\",8:"backspace",9:"tab",12:"num",13:"enter",16:"shift",17:"ctrl",18:"alt",19:"pause",20:"caps",27:"esc",32:"space",33:"pageup",34:"pagedown",35:"end",36:"home",37:"left",38:"up",39:"right",40:"down",44:"print",45:"insert",46:"delete",48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",91:"cmd",92:"cmd",93:"cmd",96:"num_0",97:"num_1",98:"num_2",99:"num_3",100:"num_4",101:"num_5",102:"num_6",103:"num_7",104:"num_8",105:"num_9",106:"num_multiply",107:"num_add",108:"num_enter",109:"num_subtract",110:"num_decimal",111:"num_divide",112:"f1",113:"f2",114:"f3",115:"f4",116:"f5",117:"f6",118:"f7",119:"f8",120:"f9",121:"f10",122:"f11",123:"f12",124:"print",144:"num",145:"scroll",186:";",187:"=",188:",",189:"-",190:".",191:"/",192:"`",219:"[",220:"\\",221:"]",222:"'",223:"`",224:"cmd",225:"alt",57392:"ctrl",63289:"num",59:";",61:"-",173:"="},m._keycode_dictionary=p,m._is_array_in_array_sorted=C,-1!==navigator.userAgent.indexOf("Mac OS X")&&(o="cmd"),-1!==navigator.userAgent.indexOf("Opera")&&(p[17]="cmd"),"function"==typeof define&&define.amd?define([],function(){return m}):"undefined"!=typeof exports&&null!==exports?exports.keypress=m:window.keypress=m}.call(this),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.AutosizeInput=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React="undefined"!=typeof window?window.React:"undefined"!=typeof global?global.React:null,sizerStyle={position:"absolute",visibility:"hidden",height:0,width:0,overflow:"scroll",whiteSpace:"nowrap"},AutosizeInput=React.createClass({displayName:"AutosizeInput",propTypes:{value:React.PropTypes.any,defaultValue:React.PropTypes.any,onChange:React.PropTypes.func,style:React.PropTypes.object,className:React.PropTypes.string,minWidth:React.PropTypes.oneOfType([React.PropTypes.number,React.PropTypes.string]),inputStyle:React.PropTypes.object,inputClassName:React.PropTypes.string},getDefaultProps:function(){return{minWidth:1}},getInitialState:function(){return{inputWidth:this.props.minWidth}},componentDidMount:function(){this.copyInputStyles(),this.updateInputWidth()},componentDidUpdate:function(){this.updateInputWidth()},copyInputStyles:function(){if(this.isMounted()&&window.getComputedStyle){var inputStyle=window.getComputedStyle(this.refs.input.getDOMNode()),widthNode=this.refs.sizer.getDOMNode();if(widthNode.style.fontSize=inputStyle.fontSize,widthNode.style.fontFamily=inputStyle.fontFamily,this.props.placeholder){var placeholderNode=this.refs.placeholderSizer.getDOMNode();placeholderNode.style.fontSize=inputStyle.fontSize,placeholderNode.style.fontFamily=inputStyle.fontFamily}}},updateInputWidth:function(){if(this.isMounted()&&"undefined"!=typeof this.refs.sizer.getDOMNode().scrollWidth){var newInputWidth;newInputWidth=this.props.placeholder?Math.max(this.refs.sizer.getDOMNode().scrollWidth,this.refs.placeholderSizer.getDOMNode().scrollWidth)+2:this.refs.sizer.getDOMNode().scrollWidth+2,newInputWidth<this.props.minWidth&&(newInputWidth=this.props.minWidth),newInputWidth!==this.state.inputWidth&&this.setState({inputWidth:newInputWidth})}},getInput:function(){return this.refs.input},focus:function(){this.refs.input.getDOMNode().focus()},select:function(){this.refs.input.getDOMNode().select()},render:function(){var escapedValue=(this.props.value||"").replace(/\&/g,"&amp;").replace(/ /g,"&nbsp;").replace(/\</g,"&lt;").replace(/\>/g,"&gt;"),wrapperStyle=this.props.style||{};wrapperStyle.display="inline-block";var inputStyle=this.props.inputStyle||{};inputStyle.width=this.state.inputWidth;var placeholder=this.props.placeholder?React.createElement("div",{ref:"placeholderSizer",style:sizerStyle},this.props.placeholder):null;return React.createElement("div",{className:this.props.className,style:wrapperStyle},React.createElement("input",_extends({},this.props,{ref:"input",className:this.props.inputClassName,style:inputStyle})),React.createElement("div",{ref:"sizer",style:sizerStyle,dangerouslySetInnerHTML:{__html:escapedValue}}),placeholder)}});module.exports=AutosizeInput}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}),/*!
  Copyright (c) 2015 Jed Watson.
  Licensed under the MIT License (MIT), see
  http://jedwatson.github.io/classnames
*/
function(){"use strict";function classNames(){for(var classes="",i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes+=" "+arg;else if(Array.isArray(arg))classes+=" "+classNames.apply(null,arg);else if("object"===argType)for(var key in arg)arg.hasOwnProperty(key)&&arg[key]&&(classes+=" "+key)}}return classes.substr(1)}"undefined"!=typeof module&&module.exports?module.exports=classNames:"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return classNames}):window.classNames=classNames}(),function(f){if("object"==typeof exports&&"undefined"!=typeof module)module.exports=f();else if("function"==typeof define&&define.amd)define([],f);else{var g;g="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:this,g.Select=f()}}(function(){return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof require&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof require&&require,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){(function(global){"use strict";var _extends=Object.assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},React="undefined"!=typeof window?window.React:"undefined"!=typeof global?global.React:null,Input="undefined"!=typeof window?window.AutosizeInput:"undefined"!=typeof global?global.AutosizeInput:null,classes="undefined"!=typeof window?window.classNames:"undefined"!=typeof global?global.classNames:null,Value=require("./Value"),requestId=0,Select=React.createClass({displayName:"Select",propTypes:{allowCreate:React.PropTypes.bool,asyncOptions:React.PropTypes.func,autoload:React.PropTypes.bool,className:React.PropTypes.string,clearable:React.PropTypes.bool,clearAllText:React.PropTypes.string,clearValueText:React.PropTypes.string,delimiter:React.PropTypes.string,disabled:React.PropTypes.bool,filterOption:React.PropTypes.func,filterOptions:React.PropTypes.func,ignoreCase:React.PropTypes.bool,inputProps:React.PropTypes.object,matchPos:React.PropTypes.string,matchProp:React.PropTypes.string,multi:React.PropTypes.bool,name:React.PropTypes.string,addLabelText:React.PropTypes.string,noResultsText:React.PropTypes.string,onBlur:React.PropTypes.func,onChange:React.PropTypes.func,onFocus:React.PropTypes.func,onOptionLabelClick:React.PropTypes.func,optionRenderer:React.PropTypes.func,options:React.PropTypes.array,placeholder:React.PropTypes.string,searchable:React.PropTypes.bool,searchPromptText:React.PropTypes.string,value:React.PropTypes.any,valueRenderer:React.PropTypes.func},getDefaultProps:function(){return{allowCreate:!1,asyncOptions:void 0,autoload:!0,className:void 0,clearable:!0,clearAllText:"Clear all",clearValueText:"Clear value",delimiter:",",disabled:!1,ignoreCase:!0,inputProps:{},matchPos:"any",matchProp:"any",name:void 0,addLabelText:"Add {label} ?",noResultsText:"No results found",onChange:void 0,onOptionLabelClick:void 0,options:void 0,placeholder:"Select...",searchable:!0,searchPromptText:"Type to search",value:void 0}},getInitialState:function(){return{isFocused:!1,isLoading:!1,isOpen:!1,options:this.props.options}},componentWillMount:function(){this._optionsCache={},this._optionsFilterString="";var self=this;this._closeMenuIfClickedOutside=function(event){if(self.state.isOpen){var menuElem=self.refs.selectMenuContainer.getDOMNode(),controlElem=self.refs.control.getDOMNode(),eventOccuredOutsideMenu=self.clickedOutsideElement(menuElem,event),eventOccuredOutsideControl=self.clickedOutsideElement(controlElem,event);eventOccuredOutsideMenu&&eventOccuredOutsideControl&&self.setState({isOpen:!1},self._unbindCloseMenuIfClickedOutside)}},this._bindCloseMenuIfClickedOutside=function(){!document.addEventListener&&document.attachEvent?document.attachEvent("onclick",this._closeMenuIfClickedOutside):document.addEventListener("click",this._closeMenuIfClickedOutside)},this._unbindCloseMenuIfClickedOutside=function(){!document.removeEventListener&&document.detachEvent?document.detachEvent("onclick",this._closeMenuIfClickedOutside):document.removeEventListener("click",this._closeMenuIfClickedOutside)},this.setState(this.getStateFromValue(this.props.value))},componentDidMount:function(){this.props.asyncOptions&&this.props.autoload&&this.autoloadAsyncOptions()},componentWillUnmount:function(){clearTimeout(this._blurTimeout),clearTimeout(this._focusTimeout),this.state.isOpen&&this._unbindCloseMenuIfClickedOutside()},componentWillReceiveProps:function(newProps){JSON.stringify(newProps.options)!==JSON.stringify(this.props.options)&&this.setState({options:newProps.options,filteredOptions:this.filterOptions(newProps.options)}),newProps.value!==this.state.value&&this.setState(this.getStateFromValue(newProps.value,newProps.options))},componentDidUpdate:function(){var self=this;if(!this.props.disabled&&this._focusAfterUpdate&&(clearTimeout(this._blurTimeout),this._focusTimeout=setTimeout(function(){self.getInputNode().focus(),self._focusAfterUpdate=!1},50)),this._focusedOptionReveal){if(this.refs.focused&&this.refs.menu){var focusedDOM=this.refs.focused.getDOMNode(),menuDOM=this.refs.menu.getDOMNode(),focusedRect=focusedDOM.getBoundingClientRect(),menuRect=menuDOM.getBoundingClientRect();(focusedRect.bottom>menuRect.bottom||focusedRect.top<menuRect.top)&&(menuDOM.scrollTop=focusedDOM.offsetTop+focusedDOM.clientHeight-menuDOM.offsetHeight)}this._focusedOptionReveal=!1}},focus:function(){this.getInputNode().focus()},clickedOutsideElement:function(element,event){for(var eventTarget=event.target?event.target:event.srcElement;null!=eventTarget;){if(eventTarget===element)return!1;eventTarget=eventTarget.offsetParent}return!0},getStateFromValue:function(value,options){options||(options=this.state.options),this._optionsFilterString="";var values=this.initValuesArray(value,options),filteredOptions=this.filterOptions(options,values);return{value:values.map(function(v){return v.value}).join(this.props.delimiter),values:values,inputValue:"",filteredOptions:filteredOptions,placeholder:!this.props.multi&&values.length?values[0].label:this.props.placeholder,focusedOption:!this.props.multi&&values.length?values[0]:filteredOptions[0]}},initValuesArray:function(values,options){return Array.isArray(values)||(values="string"==typeof values?""===values?[]:values.split(this.props.delimiter):values?[values]:[]),values.map(function(val){if("string"==typeof val){for(var key in options)if(options.hasOwnProperty(key)&&options[key]&&options[key].value===val)return options[key];return{value:val,label:val}}return val})},setValue:function(value,focusAfterUpdate){(focusAfterUpdate||void 0===focusAfterUpdate)&&(this._focusAfterUpdate=!0);var newState=this.getStateFromValue(value);newState.isOpen=!1,this.fireChangeEvent(newState),this.setState(newState)},selectValue:function(value){this.props.multi?value&&this.addValue(value):this.setValue(value),this._unbindCloseMenuIfClickedOutside()},addValue:function(value){this.setValue(this.state.values.concat(value))},popValue:function(){this.setValue(this.state.values.slice(0,this.state.values.length-1))},removeValue:function(valueToRemove){this.setValue(this.state.values.filter(function(value){return value!==valueToRemove}))},clearValue:function(event){event&&"mousedown"===event.type&&0!==event.button||(event.stopPropagation(),event.preventDefault(),this.setValue(null))},resetValue:function(){this.setValue(""===this.state.value?null:this.state.value)},getInputNode:function(){var input=this.refs.input;return this.props.searchable?input:input.getDOMNode()},fireChangeEvent:function(newState){newState.value!==this.state.value&&this.props.onChange&&this.props.onChange(newState.value,newState.values)},handleMouseDown:function(event){this.props.disabled||"mousedown"===event.type&&0!==event.button||(event.stopPropagation(),event.preventDefault(),this.state.isFocused?this.setState({isOpen:!0},this._bindCloseMenuIfClickedOutside):(this._openAfterFocus=!0,this.getInputNode().focus()))},handleMouseDownOnArrow:function(event){this.props.disabled||"mousedown"===event.type&&0!==event.button||this.state.isOpen&&(event.stopPropagation(),event.preventDefault(),this.setState({isOpen:!1},this._unbindCloseMenuIfClickedOutside))},handleInputFocus:function(event){var newIsOpen=this.state.isOpen||this._openAfterFocus;this.setState({isFocused:!0,isOpen:newIsOpen},function(){newIsOpen?this._bindCloseMenuIfClickedOutside():this._unbindCloseMenuIfClickedOutside()}),this._openAfterFocus=!1,this.props.onFocus&&this.props.onFocus(event)},handleInputBlur:function(event){var self=this;this._blurTimeout=setTimeout(function(){self._focusAfterUpdate||self.setState({isFocused:!1})},50),this.props.onBlur&&this.props.onBlur(event)},handleKeyDown:function(event){if(!this.state.disabled){switch(event.keyCode){case 8:return void(this.state.inputValue||this.popValue());case 9:if(event.shiftKey||!this.state.isOpen||!this.state.focusedOption)return;this.selectFocusedOption();break;case 13:if(!this.state.isOpen)return;this.selectFocusedOption();break;case 27:this.state.isOpen?this.resetValue():this.clearValue();break;case 38:this.focusPreviousOption();break;case 40:this.focusNextOption();break;case 188:if(!this.props.allowCreate)return;event.preventDefault(),event.stopPropagation(),this.selectFocusedOption();break;default:return}event.preventDefault()}},_getNewFocusedOption:function(filteredOptions){for(var key in filteredOptions)if(filteredOptions.hasOwnProperty(key)&&filteredOptions[key]===this.state.focusedOption)return filteredOptions[key];return filteredOptions[0]},handleInputChange:function(event){if(this._optionsFilterString=event.target.value,this.props.asyncOptions)this.setState({isLoading:!0,inputValue:event.target.value}),this.loadAsyncOptions(event.target.value,{isLoading:!1,isOpen:!0},this._bindCloseMenuIfClickedOutside);else{var filteredOptions=this.filterOptions(this.state.options);this.setState({isOpen:!0,inputValue:event.target.value,filteredOptions:filteredOptions,focusedOption:this._getNewFocusedOption(filteredOptions)},this._bindCloseMenuIfClickedOutside)}},autoloadAsyncOptions:function(){var self=this;this.loadAsyncOptions(this.props.value||"",{},function(){self.setValue(self.props.value,!1)})},loadAsyncOptions:function(input,state,callback){for(var thisRequestId=this._currentRequestId=requestId++,i=0;i<=input.length;i++){var cacheKey=input.slice(0,i);if(this._optionsCache[cacheKey]&&(input===cacheKey||this._optionsCache[cacheKey].complete)){var options=this._optionsCache[cacheKey].options,filteredOptions=this.filterOptions(options),newState={options:options,filteredOptions:filteredOptions,focusedOption:this._getNewFocusedOption(filteredOptions)};for(var key in state)state.hasOwnProperty(key)&&(newState[key]=state[key]);return this.setState(newState),void(callback&&callback.call(this,{}))}}var self=this;this.props.asyncOptions(input,function(err,data){if(err)throw err;if(self._optionsCache[input]=data,thisRequestId===self._currentRequestId){var filteredOptions=self.filterOptions(data.options),newState={options:data.options,filteredOptions:filteredOptions,focusedOption:self._getNewFocusedOption(filteredOptions)};for(var key in state)state.hasOwnProperty(key)&&(newState[key]=state[key]);self.setState(newState),callback&&callback.call(self,{})}})},filterOptions:function(options,values){if(!this.props.searchable)return options;var filterValue=this._optionsFilterString,exclude=(values||this.state.values).map(function(i){return i.value});if(this.props.filterOptions)return this.props.filterOptions.call(this,options,filterValue,exclude);var filterOption=function(op){if(this.props.multi&&exclude.indexOf(op.value)>-1)return!1;if(this.props.filterOption)return this.props.filterOption.call(this,op,filterValue);var valueTest=String(op.value),labelTest=String(op.label);return this.props.ignoreCase&&(valueTest=valueTest.toLowerCase(),labelTest=labelTest.toLowerCase(),filterValue=filterValue.toLowerCase()),filterValue&&"start"!==this.props.matchPos?"label"!==this.props.matchProp&&valueTest.indexOf(filterValue)>=0||"value"!==this.props.matchProp&&labelTest.indexOf(filterValue)>=0:"label"!==this.props.matchProp&&valueTest.substr(0,filterValue.length)===filterValue||"value"!==this.props.matchProp&&labelTest.substr(0,filterValue.length)===filterValue};return(options||[]).filter(filterOption,this)},selectFocusedOption:function(){return this.props.allowCreate&&!this.state.focusedOption?this.selectValue(this.state.inputValue):this.selectValue(this.state.focusedOption)},focusOption:function(op){this.setState({focusedOption:op})},focusNextOption:function(){this.focusAdjacentOption("next")},focusPreviousOption:function(){this.focusAdjacentOption("previous")},focusAdjacentOption:function(dir){this._focusedOptionReveal=!0;var ops=this.state.filteredOptions;if(!this.state.isOpen)return void this.setState({isOpen:!0,inputValue:"",focusedOption:this.state.focusedOption||ops["next"===dir?0:ops.length-1]},this._bindCloseMenuIfClickedOutside);if(ops.length){for(var focusedIndex=-1,i=0;i<ops.length;i++)if(this.state.focusedOption===ops[i]){focusedIndex=i;break}var focusedOption=ops[0];"next"===dir&&focusedIndex>-1&&focusedIndex<ops.length-1?focusedOption=ops[focusedIndex+1]:"previous"===dir&&(focusedOption=focusedIndex>0?ops[focusedIndex-1]:ops[ops.length-1]),this.setState({focusedOption:focusedOption})}},unfocusOption:function(op){this.state.focusedOption===op&&this.setState({focusedOption:null})},buildMenu:function(){var focusedValue=this.state.focusedOption?this.state.focusedOption.value:null,renderLabel=this.props.optionRenderer||function(op){return op.label};if(this.state.filteredOptions.length>0&&(focusedValue=null==focusedValue?this.state.filteredOptions[0]:focusedValue),this.props.allowCreate&&this.state.inputValue.trim()){var inputValue=this.state.inputValue;this.state.filteredOptions.unshift({value:inputValue,label:inputValue,create:!0})}var ops=Object.keys(this.state.filteredOptions).map(function(key){var op=this.state.filteredOptions[key],isSelected=this.state.value===op.value,isFocused=focusedValue===op.value,optionClass=classes({"Select-option":!0,"is-selected":isSelected,"is-focused":isFocused,"is-disabled":op.disabled}),ref=isFocused?"focused":null,mouseEnter=this.focusOption.bind(this,op),mouseLeave=this.unfocusOption.bind(this,op),mouseDown=this.selectValue.bind(this,op),renderedLabel=renderLabel(op);return op.disabled?React.createElement("div",{ref:ref,key:"option-"+op.value,className:optionClass},renderedLabel):React.createElement("div",{ref:ref,key:"option-"+op.value,className:optionClass,onMouseEnter:mouseEnter,onMouseLeave:mouseLeave,onMouseDown:mouseDown,onClick:mouseDown},op.create?this.props.addLabelText.replace("{label}",op.label):renderedLabel)},this);return ops.length?ops:React.createElement("div",{className:"Select-noresults"},this.props.asyncOptions&&!this.state.inputValue?this.props.searchPromptText:this.props.noResultsText)},handleOptionLabelClick:function(value,event){this.props.onOptionLabelClick&&this.props.onOptionLabelClick(value,event)},render:function(){var selectClass=classes("Select",this.props.className,{"is-multi":this.props.multi,"is-searchable":this.props.searchable,"is-open":this.state.isOpen,"is-focused":this.state.isFocused,"is-loading":this.state.isLoading,"is-disabled":this.props.disabled,"has-value":this.state.value}),value=[];this.props.multi&&this.state.values.forEach(function(val){value.push(React.createElement(Value,{key:val.value,option:val,renderer:this.props.valueRenderer,optionLabelClick:!!this.props.onOptionLabelClick,onOptionLabelClick:this.handleOptionLabelClick.bind(this,val),onRemove:this.removeValue.bind(this,val),disabled:this.props.disabled}))},this),this.state.inputValue||this.props.multi&&value.length||value.push(React.createElement("div",{className:"Select-placeholder",key:"placeholder"},this.state.placeholder));var menu,menuProps,loading=this.state.isLoading?React.createElement("span",{className:"Select-loading","aria-hidden":"true"}):null,clear=this.props.clearable&&this.state.value&&!this.props.disabled?React.createElement("span",{className:"Select-clear",title:this.props.multi?this.props.clearAllText:this.props.clearValueText,"aria-label":this.props.multi?this.props.clearAllText:this.props.clearValueText,onMouseDown:this.clearValue,onClick:this.clearValue,dangerouslySetInnerHTML:{__html:"&times;"}}):null;this.state.isOpen&&(menuProps={ref:"menu",className:"Select-menu"},this.props.multi&&(menuProps.onMouseDown=this.handleMouseDown),menu=React.createElement("div",{ref:"selectMenuContainer",className:"Select-menu-outer"},React.createElement("div",menuProps,this.buildMenu())));var input,inputProps={ref:"input",className:"Select-input",tabIndex:this.props.tabIndex||0,onFocus:this.handleInputFocus,onBlur:this.handleInputBlur};for(var key in this.props.inputProps)this.props.inputProps.hasOwnProperty(key)&&(inputProps[key]=this.props.inputProps[key]);return this.props.disabled?this.props.multi&&this.state.values.length||(input=React.createElement("div",{className:"Select-input"}," ")):input=this.props.searchable?React.createElement(Input,_extends({value:this.state.inputValue,onChange:this.handleInputChange,minWidth:"5"},inputProps)):React.createElement("div",inputProps," "),React.createElement("div",{ref:"wrapper",className:selectClass},React.createElement("input",{type:"hidden",ref:"value",name:this.props.name,value:this.state.value,disabled:this.props.disabled}),React.createElement("div",{className:"Select-control",ref:"control",onKeyDown:this.handleKeyDown,onMouseDown:this.handleMouseDown,onTouchEnd:this.handleMouseDown},value,input,React.createElement("span",{className:"Select-arrow-zone",onMouseDown:this.handleMouseDownOnArrow}),React.createElement("span",{className:"Select-arrow",onMouseDown:this.handleMouseDownOnArrow}),loading,clear),menu)}});module.exports=Select}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{"./Value":2}],2:[function(require,module,exports){(function(global){"use strict";var React="undefined"!=typeof window?window.React:"undefined"!=typeof global?global.React:null,Value=React.createClass({displayName:"Value",propTypes:{disabled:React.PropTypes.bool,onOptionLabelClick:React.PropTypes.func,onRemove:React.PropTypes.func,option:React.PropTypes.object.isRequired,optionLabelClick:React.PropTypes.bool,renderer:React.PropTypes.func},blockEvent:function(event){event.stopPropagation()},handleOnRemove:function(event){this.props.disabled||this.props.onRemove(event)},render:function(){var label=this.props.option.label;return this.props.renderer&&(label=this.props.renderer(this.props.option)),this.props.optionLabelClick&&(label=React.createElement("a",{className:"Select-item-label__a",onMouseDown:this.blockEvent,onTouchEnd:this.props.onOptionLabelClick,onClick:this.props.onOptionLabelClick},label)),React.createElement("div",{className:"Select-item"},React.createElement("span",{className:"Select-item-icon",onMouseDown:this.blockEvent,onClick:this.handleOnRemove,onTouchEnd:this.handleOnRemove},"\xd7"),React.createElement("span",{className:"Select-item-label"},label))}});module.exports=Value}).call(this,"undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{})},{}]},{},[1])(1)}),function(root,factory){if("object"==typeof exports&&"object"==typeof module)module.exports=factory(require("_"),require("React"),require("Reflux"),require("rangy"),require("keypress"));else if("function"==typeof define&&define.amd)define(["_","React","Reflux","rangy","keypress"],factory);else{var a="object"==typeof exports?factory(require("_"),require("React"),require("Reflux"),require("rangy"),require("keypress")):factory(root._,root.React,root.Reflux,root.rangy,root.keypress);for(var i in a)("object"==typeof exports?exports:root)[i]=a[i]}}(this,function(__WEBPACK_EXTERNAL_MODULE_17__,__WEBPACK_EXTERNAL_MODULE_18__,__WEBPACK_EXTERNAL_MODULE_82__,__WEBPACK_EXTERNAL_MODULE_115__,__WEBPACK_EXTERNAL_MODULE_149__){return function(modules){function __webpack_require__(moduleId){if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]={exports:{},id:moduleId,loaded:!1};return modules[moduleId].call(module.exports,module,module.exports,__webpack_require__),module.loaded=!0,module.exports}var installedModules={};return __webpack_require__.m=modules,__webpack_require__.c=installedModules,__webpack_require__.p="",__webpack_require__(0)}([function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_eventemitter3=__webpack_require__(19),_eventemitter32=_interopRequireDefault(_eventemitter3),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleStore=__webpack_require__(81),_fusibleStore2=_interopRequireDefault(_fusibleStore),_fusibleComponentsDocument_container=__webpack_require__(123),_fusibleComponentsDocument_container2=_interopRequireDefault(_fusibleComponentsDocument_container),_fusibleComponentsDocument=__webpack_require__(124),_fusibleComponentsDocument2=_interopRequireDefault(_fusibleComponentsDocument),_fusibleUtilDom_helper=__webpack_require__(125),_fusibleUtilDom_helper2=_interopRequireDefault(_fusibleUtilDom_helper),_fusibleUtilDocument_model_helper=__webpack_require__(108),_fusibleUtilDocument_model_helper2=_interopRequireDefault(_fusibleUtilDocument_model_helper),_styleIcons=__webpack_require__(48),_styleIcons2=_interopRequireDefault(_styleIcons),Fusible=function(_EventEmitter){function Fusible(name,container){var model=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],config=arguments.length<=3||void 0===arguments[3]?null:arguments[3],childProps=arguments.length<=4||void 0===arguments[4]?{}:arguments[4];_classCallCheck(this,Fusible),_get(Object.getPrototypeOf(Fusible.prototype),"constructor",this).call(this),this.name=name,this.container=container,this.config=config||_fusibleConfig2["default"]["default"](),this.childProps=childProps,_lodash2["default"].isString(model)&&(model=_fusibleUtilDom_helper2["default"].htmlStringToDocumentModel(model,this.config)),this.render(model)}return _inherits(Fusible,_EventEmitter),_createClass(Fusible,[{key:"render",value:function(model){this.documentContainer=_reactAddons2["default"].render(_reactAddons2["default"].createElement(_fusibleComponentsDocument_container2["default"],{model:model,config:this.config,childProps:this.childProps,onChange:this._emitChange.bind(this)}),this.container)}},{key:"destroy",value:function(){_reactAddons2["default"].unmountComponentAtNode(this.container)}},{key:"getDocumentModel",value:function(){return _fusibleStore2["default"].documentModelsCursor().cursor(this.documentContainer.id).deref().toJS()}},{key:"setDocumentModel",value:function(model){this.render(model)}},{key:"setDocumentModelFromHtml",value:function(htmlText){var model=_fusibleUtilDom_helper2["default"].htmlStringToDocumentModel(htmlText,this.config);this.setDocumentModel(model)}},{key:"focus",value:function(){this.documentContainer.focus()}},{key:"_emitChange",value:function(documentModel){this.emit("change",documentModel)}}],[{key:"htmlToDocumentModel",value:function(htmlText,config){var documentModel=_fusibleUtilDom_helper2["default"].htmlStringToDocumentModel(htmlText,config);return documentModel=_fusibleUtilDocument_model_helper2["default"].prepAndValidateDocumentModel(documentModel,config),documentModel.toJS()}},{key:"prepAndValidateDocumentModel",value:function(documentModel,config){if("function"==typeof documentModel.toJS&&(documentModel=documentModel.toJS()),!_lodash2["default"].isArray(documentModel))throw new Error("A document model must be an array of objects.");return documentModel=_fusibleUtilDocument_model_helper2["default"].prepAndValidateDocumentModel(_immutable2["default"].fromJS(documentModel),config),documentModel.toJS()}},{key:"renderToString",value:function(documentModel,config){var childProps=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return _reactAddons2["default"].renderToString(_reactAddons2["default"].createElement(_fusibleComponentsDocument_container2["default"],{model:documentModel,config:config,childProps:childProps}))}},{key:"renderToStaticMarkup",value:function(documentModel,config){var childProps=arguments.length<=2||void 0===arguments[2]?{}:arguments[2];return _reactAddons2["default"].renderToStaticMarkup(_reactAddons2["default"].createElement(_fusibleComponentsDocument_container2["default"],{model:documentModel,config:config,childProps:childProps}))}}]),Fusible}(_eventemitter32["default"]);exports["default"]=Fusible,Fusible.Config=_fusibleConfig2["default"],Fusible.Store=_fusibleStore2["default"],Fusible.DocumentContainer=_fusibleComponentsDocument_container2["default"],Fusible.Document=_fusibleComponentsDocument2["default"],Fusible.iconClasses=_styleIcons2["default"],"undefined"!=typeof window&&(window.Fusible=Fusible,window.Immutable=_immutable2["default"],window.EventEmitter=_eventemitter32["default"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _Object$getOwnPropertyDescriptor=__webpack_require__(2)["default"];exports["default"]=function(_x,_x2,_x3){for(var _again=!0;_again;){var object=_x,property=_x2,receiver=_x3;desc=parent=getter=void 0,_again=!1,null===object&&(object=Function.prototype);var desc=_Object$getOwnPropertyDescriptor(object,property);if(void 0!==desc){if("value"in desc)return desc.value;var getter=desc.get;return void 0===getter?void 0:getter.call(receiver)}var parent=Object.getPrototypeOf(object);if(null===parent)return void 0;_x=parent,_x2=property,_x3=receiver,_again=!0}},exports.__esModule=!0},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(3),__esModule:!0}},function(module,exports,__webpack_require__){var $=__webpack_require__(4);__webpack_require__(6),module.exports=function(it,key){return $.getDesc(it,key)}},function(module,exports,__webpack_require__){"use strict";function toInteger(it){return isNaN(it=+it)?0:(it>0?floor:ceil)(it)}function desc(bitmap,value){return{enumerable:!(1&bitmap),configurable:!(2&bitmap),writable:!(4&bitmap),value:value}}function simpleSet(object,key,value){return object[key]=value,object}function createDefiner(bitmap){return DESC?function(object,key,value){return $.setDesc(object,key,desc(bitmap,value))}:simpleSet}function isObject(it){return null!==it&&("object"==typeof it||"function"==typeof it)}function isFunction(it){return"function"==typeof it}function assertDefined(it){if(void 0==it)throw TypeError("Can't call method on  "+it);return it}var global="undefined"!=typeof self?self:Function("return this")(),core={},defineProperty=Object.defineProperty,hasOwnProperty={}.hasOwnProperty,ceil=Math.ceil,floor=Math.floor,max=Math.max,min=Math.min,DESC=!!function(){try{return 2==defineProperty({},"a",{get:function(){return 2}}).a}catch(e){}}(),hide=createDefiner(1),$=module.exports=__webpack_require__(5)({g:global,core:core,html:global.document&&document.documentElement,isObject:isObject,isFunction:isFunction,that:function(){return this},toInteger:toInteger,toLength:function(it){return it>0?min(toInteger(it),9007199254740991):0},toIndex:function(index,length){return index=toInteger(index),0>index?max(index+length,0):min(index,length)},has:function(it,key){return hasOwnProperty.call(it,key)},create:Object.create,getProto:Object.getPrototypeOf,DESC:DESC,desc:desc,getDesc:Object.getOwnPropertyDescriptor,setDesc:defineProperty,setDescs:Object.defineProperties,getKeys:Object.keys,getNames:Object.getOwnPropertyNames,getSymbols:Object.getOwnPropertySymbols,assertDefined:assertDefined,ES5Object:Object,toObject:function(it){return $.ES5Object(assertDefined(it))},hide:hide,def:createDefiner(0),set:global.Symbol?simpleSet:hide,each:[].forEach});"undefined"!=typeof __e&&(__e=core),"undefined"!=typeof __g&&(__g=global)},function(module,exports){module.exports=function($){return $.FW=!1,$.path=$.core,$}},function(module,exports,__webpack_require__){var $=__webpack_require__(4),$def=__webpack_require__(7),isObject=$.isObject,toObject=$.toObject;$.each.call("freeze,seal,preventExtensions,isFrozen,isSealed,isExtensible,getOwnPropertyDescriptor,getPrototypeOf,keys,getOwnPropertyNames".split(","),function(KEY,ID){var fn=($.core.Object||{})[KEY]||Object[KEY],forced=0,method={};method[KEY]=0==ID?function(it){return isObject(it)?fn(it):it}:1==ID?function(it){return isObject(it)?fn(it):it}:2==ID?function(it){return isObject(it)?fn(it):it}:3==ID?function(it){return isObject(it)?fn(it):!0}:4==ID?function(it){return isObject(it)?fn(it):!0}:5==ID?function(it){return isObject(it)?fn(it):!1}:6==ID?function(it,key){return fn(toObject(it),key)}:7==ID?function(it){return fn(Object($.assertDefined(it)))}:8==ID?function(it){return fn(toObject(it))}:__webpack_require__(8).get;try{fn("z")}catch(e){forced=1}$def($def.S+$def.F*forced,"Object",method)})},function(module,exports,__webpack_require__){function ctx(fn,that){return function(){return fn.apply(that,arguments)}}function $def(type,name,source){var key,own,out,exp,isGlobal=type&$def.G,isProto=type&$def.P,target=isGlobal?global:type&$def.S?global[name]:(global[name]||{}).prototype,exports=isGlobal?core:core[name]||(core[name]={});isGlobal&&(source=name);for(key in source)own=!(type&$def.F)&&target&&key in target,own&&key in exports||(out=own?target[key]:source[key],isGlobal&&!isFunction(target[key])?exp=source[key]:type&$def.B&&own?exp=ctx(out,global):type&$def.W&&target[key]==out?!function(C){exp=function(param){return this instanceof C?new C(param):C(param)},exp.prototype=C.prototype}(out):exp=isProto&&isFunction(out)?ctx(Function.call,out):out,exports[key]=exp,isProto&&((exports.prototype||(exports.prototype={}))[key]=out))}var $=__webpack_require__(4),global=$.g,core=$.core,isFunction=$.isFunction;$def.F=1,$def.G=2,$def.S=4,$def.P=8,$def.B=16,$def.W=32,module.exports=$def},function(module,exports,__webpack_require__){function getWindowNames(it){try{return getNames(it)}catch(e){return windowNames.slice()}}var $=__webpack_require__(4),toString={}.toString,getNames=$.getNames,windowNames="object"==typeof window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];module.exports.get=function(it){return windowNames&&"[object Window]"==toString.call(it)?getWindowNames(it):getNames($.toObject(it))}},function(module,exports,__webpack_require__){"use strict";var _Object$create=__webpack_require__(10)["default"];exports["default"]=function(subClass,superClass){if("function"!=typeof superClass&&null!==superClass)throw new TypeError("Super expression must either be null or a function, not "+typeof superClass);subClass.prototype=_Object$create(superClass&&superClass.prototype,{constructor:{value:subClass,enumerable:!1,writable:!0,configurable:!0}}),superClass&&(subClass.__proto__=superClass)},exports.__esModule=!0},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(11),__esModule:!0}},function(module,exports,__webpack_require__){var $=__webpack_require__(4);module.exports=function(P,D){return $.create(P,D)}},function(module,exports,__webpack_require__){"use strict";var _Object$defineProperty=__webpack_require__(13)["default"];exports["default"]=function(){function defineProperties(target,props){for(var i=0;i<props.length;i++){var descriptor=props[i];descriptor.enumerable=descriptor.enumerable||!1,descriptor.configurable=!0,"value"in descriptor&&(descriptor.writable=!0),_Object$defineProperty(target,descriptor.key,descriptor)}}return function(Constructor,protoProps,staticProps){return protoProps&&defineProperties(Constructor.prototype,protoProps),staticProps&&defineProperties(Constructor,staticProps),Constructor}}(),exports.__esModule=!0;
},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(14),__esModule:!0}},function(module,exports,__webpack_require__){var $=__webpack_require__(4);module.exports=function(it,key,desc){return $.setDesc(it,key,desc)}},function(module,exports){"use strict";exports["default"]=function(instance,Constructor){if(!(instance instanceof Constructor))throw new TypeError("Cannot call a class as a function")},exports.__esModule=!0},function(module,exports){"use strict";exports["default"]=function(obj){return obj&&obj.__esModule?obj:{"default":obj}},exports.__esModule=!0},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_17__},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_18__},function(module,exports){"use strict";function EE(fn,context,once){this.fn=fn,this.context=context,this.once=once||!1}function EventEmitter(){}EventEmitter.prototype._events=void 0,EventEmitter.prototype.listeners=function(event){if(!this._events||!this._events[event])return[];if(this._events[event].fn)return[this._events[event].fn];for(var i=0,l=this._events[event].length,ee=new Array(l);l>i;i++)ee[i]=this._events[event][i].fn;return ee},EventEmitter.prototype.emit=function(event,a1,a2,a3,a4,a5){if(!this._events||!this._events[event])return!1;var args,i,listeners=this._events[event],len=arguments.length;if("function"==typeof listeners.fn){switch(listeners.once&&this.removeListener(event,listeners.fn,!0),len){case 1:return listeners.fn.call(listeners.context),!0;case 2:return listeners.fn.call(listeners.context,a1),!0;case 3:return listeners.fn.call(listeners.context,a1,a2),!0;case 4:return listeners.fn.call(listeners.context,a1,a2,a3),!0;case 5:return listeners.fn.call(listeners.context,a1,a2,a3,a4),!0;case 6:return listeners.fn.call(listeners.context,a1,a2,a3,a4,a5),!0}for(i=1,args=new Array(len-1);len>i;i++)args[i-1]=arguments[i];listeners.fn.apply(listeners.context,args)}else{var j,length=listeners.length;for(i=0;length>i;i++)switch(listeners[i].once&&this.removeListener(event,listeners[i].fn,!0),len){case 1:listeners[i].fn.call(listeners[i].context);break;case 2:listeners[i].fn.call(listeners[i].context,a1);break;case 3:listeners[i].fn.call(listeners[i].context,a1,a2);break;default:if(!args)for(j=1,args=new Array(len-1);len>j;j++)args[j-1]=arguments[j];listeners[i].fn.apply(listeners[i].context,args)}}return!0},EventEmitter.prototype.on=function(event,fn,context){var listener=new EE(fn,context||this);return this._events||(this._events={}),this._events[event]?this._events[event].fn?this._events[event]=[this._events[event],listener]:this._events[event].push(listener):this._events[event]=listener,this},EventEmitter.prototype.once=function(event,fn,context){var listener=new EE(fn,context||this,!0);return this._events||(this._events={}),this._events[event]?this._events[event].fn?this._events[event]=[this._events[event],listener]:this._events[event].push(listener):this._events[event]=listener,this},EventEmitter.prototype.removeListener=function(event,fn,once){if(!this._events||!this._events[event])return this;var listeners=this._events[event],events=[];if(fn&&(listeners.fn&&(listeners.fn!==fn||once&&!listeners.once)&&events.push(listeners),!listeners.fn))for(var i=0,length=listeners.length;length>i;i++)(listeners[i].fn!==fn||once&&!listeners[i].once)&&events.push(listeners[i]);return events.length?this._events[event]=1===events.length?events[0]:events:delete this._events[event],this},EventEmitter.prototype.removeAllListeners=function(event){return this._events?(event?delete this._events[event]:this._events={},this):this},EventEmitter.prototype.off=EventEmitter.prototype.removeListener,EventEmitter.prototype.addListener=EventEmitter.prototype.on,EventEmitter.prototype.setMaxListeners=function(){return this},EventEmitter.EventEmitter=EventEmitter,EventEmitter.EventEmitter2=EventEmitter,EventEmitter.EventEmitter3=EventEmitter,module.exports=EventEmitter},function(module,exports,__webpack_require__){/**
	 *  Copyright (c) 2014, Facebook, Inc.
	 *  All rights reserved.
	 *
	 *  This source code is licensed under the BSD-style license found in the
	 *  LICENSE file in the root directory of this source tree. An additional grant
	 *  of patent rights can be found in the PATENTS file in the same directory.
	 */
function universalModule(){function createClass(ctor,methods,staticMethods,superClass){var proto;if(superClass){var superProto=superClass.prototype;proto=$Object.create(superProto)}else proto=ctor.prototype;return $Object.keys(methods).forEach(function(key){proto[key]=methods[key]}),$Object.keys(staticMethods).forEach(function(key){ctor[key]=staticMethods[key]}),proto.constructor=ctor,ctor.prototype=proto,ctor}function superCall(self,proto,name,args){return $Object.getPrototypeOf(proto)[name].apply(self,args)}function defaultSuperCall(self,proto,args){superCall(self,proto,"constructor",args)}function is(valueA,valueB){return valueA===valueB||valueA!==valueA&&valueB!==valueB?!0:valueA&&valueB?("function"==typeof valueA.valueOf&&"function"==typeof valueB.valueOf&&(valueA=valueA.valueOf(),valueB=valueB.valueOf()),"function"==typeof valueA.equals&&"function"==typeof valueB.equals?valueA.equals(valueB):valueA===valueB||valueA!==valueA&&valueB!==valueB):!1}function invariant(condition,error){if(!condition)throw new Error(error)}function MakeRef(ref){return ref.value=!1,ref}function SetRef(ref){ref&&(ref.value=!0)}function OwnerID(){}function arrCopy(arr,offset){offset=offset||0;for(var len=Math.max(0,arr.length-offset),newArr=new Array(len),ii=0;len>ii;ii++)newArr[ii]=arr[ii+offset];return newArr}function assertNotInfinite(size){invariant(size!==1/0,"Cannot perform this action with an infinite size.")}function ensureSize(iter){return void 0===iter.size&&(iter.size=iter.__iterate(returnTrue)),iter.size}function wrapIndex(iter,index){return index>=0?+index:ensureSize(iter)+ +index}function returnTrue(){return!0}function wholeSlice(begin,end,size){return(0===begin||void 0!==size&&-size>=begin)&&(void 0===end||void 0!==size&&end>=size)}function resolveBegin(begin,size){return resolveIndex(begin,size,0)}function resolveEnd(end,size){return resolveIndex(end,size,size)}function resolveIndex(index,size,defaultIndex){return void 0===index?defaultIndex:0>index?Math.max(0,size+index):void 0===size?index:Math.min(size,index)}function smi(i32){return i32>>>1&1073741824|3221225471&i32}function hash(o){if(o===!1||null===o||void 0===o)return 0;if("function"==typeof o.valueOf&&(o=o.valueOf(),o===!1||null===o||void 0===o))return 0;if(o===!0)return 1;var type=typeof o;if("number"===type){for(var h=0|o;o>4294967295;)o/=4294967295,h^=o;return smi(h)}return"string"===type?o.length>STRING_HASH_CACHE_MIN_STRLEN?cachedHashString(o):hashString(o):"function"==typeof o.hashCode?o.hashCode():hashJSObj(o)}function cachedHashString(string){var hash=stringHashCache[string];return void 0===hash&&(hash=hashString(string),STRING_HASH_CACHE_SIZE===STRING_HASH_CACHE_MAX_SIZE&&(STRING_HASH_CACHE_SIZE=0,stringHashCache={}),STRING_HASH_CACHE_SIZE++,stringHashCache[string]=hash),hash}function hashString(string){for(var hash=0,ii=0;ii<string.length;ii++)hash=31*hash+string.charCodeAt(ii)|0;return smi(hash)}function hashJSObj(obj){var hash=weakMap&&weakMap.get(obj);if(hash)return hash;if(hash=obj[UID_HASH_KEY])return hash;if(!canDefineProperty){if(hash=obj.propertyIsEnumerable&&obj.propertyIsEnumerable[UID_HASH_KEY])return hash;if(hash=getIENodeHash(obj))return hash}if(Object.isExtensible&&!Object.isExtensible(obj))throw new Error("Non-extensible objects are not allowed as keys.");if(hash=++objHashUID,1073741824&objHashUID&&(objHashUID=0),weakMap)weakMap.set(obj,hash);else if(canDefineProperty)Object.defineProperty(obj,UID_HASH_KEY,{enumerable:!1,configurable:!1,writable:!1,value:hash});else if(obj.propertyIsEnumerable&&obj.propertyIsEnumerable===obj.constructor.prototype.propertyIsEnumerable)obj.propertyIsEnumerable=function(){return this.constructor.prototype.propertyIsEnumerable.apply(this,arguments)},obj.propertyIsEnumerable[UID_HASH_KEY]=hash;else{if(!obj.nodeType)throw new Error("Unable to set a non-enumerable property on object.");obj[UID_HASH_KEY]=hash}return hash}function getIENodeHash(node){if(node&&node.nodeType>0)switch(node.nodeType){case 1:return node.uniqueID;case 9:return node.documentElement&&node.documentElement.uniqueID}}function iteratorValue(type,k,v,iteratorResult){var value=0===type?k:1===type?v:[k,v];return iteratorResult?iteratorResult.value=value:iteratorResult={value:value,done:!1},iteratorResult}function iteratorDone(){return{value:void 0,done:!0}}function hasIterator(maybeIterable){return!!_iteratorFn(maybeIterable)}function isIterator(maybeIterator){return maybeIterator&&"function"==typeof maybeIterator.next}function getIterator(iterable){var iteratorFn=_iteratorFn(iterable);return iteratorFn&&iteratorFn.call(iterable)}function _iteratorFn(iterable){var iteratorFn=iterable&&(REAL_ITERATOR_SYMBOL&&iterable[REAL_ITERATOR_SYMBOL]||iterable[FAUX_ITERATOR_SYMBOL]);return"function"==typeof iteratorFn?iteratorFn:void 0}function isIterable(maybeIterable){return!(!maybeIterable||!maybeIterable[IS_ITERABLE_SENTINEL])}function isKeyed(maybeKeyed){return!(!maybeKeyed||!maybeKeyed[IS_KEYED_SENTINEL])}function isIndexed(maybeIndexed){return!(!maybeIndexed||!maybeIndexed[IS_INDEXED_SENTINEL])}function isAssociative(maybeAssociative){return isKeyed(maybeAssociative)||isIndexed(maybeAssociative)}function isOrdered(maybeOrdered){return!(!maybeOrdered||!maybeOrdered[IS_ORDERED_SENTINEL])}function keyMapper(v,k){return k}function entryMapper(v,k){return[k,v]}function not(predicate){return function(){return!predicate.apply(this,arguments)}}function neg(predicate){return function(){return-predicate.apply(this,arguments)}}function quoteString(value){return"string"==typeof value?JSON.stringify(value):value}function defaultNegComparator(a,b){return b>a?1:a>b?-1:0}function deepEqual(a,b){if(a===b)return!0;if(!isIterable(b)||void 0!==a.size&&void 0!==b.size&&a.size!==b.size||void 0!==a.__hash&&void 0!==b.__hash&&a.__hash!==b.__hash||isKeyed(a)!==isKeyed(b)||isIndexed(a)!==isIndexed(b)||isOrdered(a)!==isOrdered(b))return!1;if(0===a.size&&0===b.size)return!0;var notAssociative=!isAssociative(a);if(isOrdered(a)){var entries=a.entries();return b.every(function(v,k){var entry=entries.next().value;return entry&&is(entry[1],v)&&(notAssociative||is(entry[0],k))})&&entries.next().done}var flipped=!1;if(void 0===a.size)if(void 0===b.size)a.cacheResult();else{flipped=!0;var _=a;a=b,b=_}var allEqual=!0,bSize=b.__iterate(function(v,k){return(notAssociative?a.has(v):flipped?is(v,a.get(k,NOT_SET)):is(a.get(k,NOT_SET),v))?void 0:(allEqual=!1,!1)});return allEqual&&a.size===bSize}function hashIterable(iterable){if(iterable.size===1/0)return 0;var ordered=isOrdered(iterable),keyed=isKeyed(iterable),h=ordered?1:0,size=iterable.__iterate(keyed?ordered?function(v,k){h=31*h+hashMerge(hash(v),hash(k))|0}:function(v,k){h=h+hashMerge(hash(v),hash(k))|0}:ordered?function(v){h=31*h+hash(v)|0}:function(v){h=h+hash(v)|0});return murmurHashOfSize(size,h)}function murmurHashOfSize(size,h){return h=imul(h,3432918353),h=imul(h<<15|h>>>-15,461845907),h=imul(h<<13|h>>>-13,5),h=(h+3864292196|0)^size,h=imul(h^h>>>16,2246822507),h=imul(h^h>>>13,3266489909),h=smi(h^h>>>16)}function hashMerge(a,b){return a^b+2654435769+(a<<6)+(a>>2)|0}function mixin(ctor,methods){var proto=ctor.prototype,keyCopier=function(key){proto[key]=methods[key]};return Object.keys(methods).forEach(keyCopier),Object.getOwnPropertySymbols&&Object.getOwnPropertySymbols(methods).forEach(keyCopier),ctor}function isSeq(maybeSeq){return!(!maybeSeq||!maybeSeq[IS_SEQ_SENTINEL])}function emptySequence(){return EMPTY_SEQ||(EMPTY_SEQ=new ArraySeq([]))}function keyedSeqFromValue(value){var seq=Array.isArray(value)?new ArraySeq(value).fromEntrySeq():isIterator(value)?new IteratorSeq(value).fromEntrySeq():hasIterator(value)?new IterableSeq(value).fromEntrySeq():"object"==typeof value?new ObjectSeq(value):void 0;if(!seq)throw new TypeError("Expected Array or iterable object of [k, v] entries, or keyed object: "+value);return seq}function indexedSeqFromValue(value){var seq=maybeIndexedSeqFromValue(value);if(!seq)throw new TypeError("Expected Array or iterable object of values: "+value);return seq}function seqFromValue(value){var seq=maybeIndexedSeqFromValue(value)||"object"==typeof value&&new ObjectSeq(value);if(!seq)throw new TypeError("Expected Array or iterable object of values, or keyed object: "+value);return seq}function maybeIndexedSeqFromValue(value){return isArrayLike(value)?new ArraySeq(value):isIterator(value)?new IteratorSeq(value):hasIterator(value)?new IterableSeq(value):void 0}function isArrayLike(value){return value&&"number"==typeof value.length}function seqIterate(seq,fn,reverse,useKeys){var cache=seq._cache;if(cache){for(var maxIndex=cache.length-1,ii=0;maxIndex>=ii;ii++){var entry=cache[reverse?maxIndex-ii:ii];if(fn(entry[1],useKeys?entry[0]:ii,seq)===!1)return ii+1}return ii}return seq.__iterateUncached(fn,reverse)}function seqIterator(seq,type,reverse,useKeys){var cache=seq._cache;if(cache){var maxIndex=cache.length-1,ii=0;return new Iterator(function(){var entry=cache[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,useKeys?entry[0]:ii-1,entry[1])})}return seq.__iteratorUncached(type,reverse)}function fromJS(json,converter){return converter?_fromJSWith(converter,json,"",{"":json}):_fromJSDefault(json)}function _fromJSWith(converter,json,key,parentJSON){return Array.isArray(json)?converter.call(parentJSON,key,IndexedSeq(json).map(function(v,k){return _fromJSWith(converter,v,k,json)})):isPlainObj(json)?converter.call(parentJSON,key,KeyedSeq(json).map(function(v,k){return _fromJSWith(converter,v,k,json)})):json}function _fromJSDefault(json){return Array.isArray(json)?IndexedSeq(json).map(_fromJSDefault).toList():isPlainObj(json)?KeyedSeq(json).map(_fromJSDefault).toMap():json}function isPlainObj(value){return value&&value.constructor===Object}function isMap(maybeMap){return!(!maybeMap||!maybeMap[IS_MAP_SENTINEL])}function mapIteratorValue(type,entry){return iteratorValue(type,entry[0],entry[1])}function mapIteratorFrame(node,prev){return{node:node,index:0,__prev:prev}}function makeMap(size,root,ownerID,hash){var map=Object.create(MapPrototype);return map.size=size,map._root=root,map.__ownerID=ownerID,map.__hash=hash,map.__altered=!1,map}function emptyMap(){return EMPTY_MAP||(EMPTY_MAP=makeMap(0))}function updateMap(map,k,v){var newRoot,newSize;if(map._root){var didChangeSize=MakeRef(CHANGE_LENGTH),didAlter=MakeRef(DID_ALTER);if(newRoot=updateNode(map._root,map.__ownerID,0,void 0,k,v,didChangeSize,didAlter),!didAlter.value)return map;newSize=map.size+(didChangeSize.value?v===NOT_SET?-1:1:0)}else{if(v===NOT_SET)return map;newSize=1,newRoot=new ArrayMapNode(map.__ownerID,[[k,v]])}return map.__ownerID?(map.size=newSize,map._root=newRoot,map.__hash=void 0,map.__altered=!0,map):newRoot?makeMap(newSize,newRoot):emptyMap()}function updateNode(node,ownerID,shift,keyHash,key,value,didChangeSize,didAlter){return node?node.update(ownerID,shift,keyHash,key,value,didChangeSize,didAlter):value===NOT_SET?node:(SetRef(didAlter),SetRef(didChangeSize),new ValueNode(ownerID,keyHash,[key,value]))}function isLeafNode(node){return node.constructor===ValueNode||node.constructor===HashCollisionNode}function mergeIntoNode(node,ownerID,shift,keyHash,entry){if(node.keyHash===keyHash)return new HashCollisionNode(ownerID,keyHash,[node.entry,entry]);var newNode,idx1=(0===shift?node.keyHash:node.keyHash>>>shift)&MASK,idx2=(0===shift?keyHash:keyHash>>>shift)&MASK,nodes=idx1===idx2?[mergeIntoNode(node,ownerID,shift+SHIFT,keyHash,entry)]:(newNode=new ValueNode(ownerID,keyHash,entry),idx2>idx1?[node,newNode]:[newNode,node]);return new BitmapIndexedNode(ownerID,1<<idx1|1<<idx2,nodes)}function createNodes(ownerID,entries,key,value){ownerID||(ownerID=new OwnerID);for(var node=new ValueNode(ownerID,hash(key),[key,value]),ii=0;ii<entries.length;ii++){var entry=entries[ii];node=node.update(ownerID,0,void 0,entry[0],entry[1])}return node}function packNodes(ownerID,nodes,count,excluding){for(var bitmap=0,packedII=0,packedNodes=new Array(count),ii=0,bit=1,len=nodes.length;len>ii;ii++,bit<<=1){var node=nodes[ii];void 0!==node&&ii!==excluding&&(bitmap|=bit,packedNodes[packedII++]=node)}return new BitmapIndexedNode(ownerID,bitmap,packedNodes)}function expandNodes(ownerID,nodes,bitmap,including,node){for(var count=0,expandedNodes=new Array(SIZE),ii=0;0!==bitmap;ii++,bitmap>>>=1)expandedNodes[ii]=1&bitmap?nodes[count++]:void 0;return expandedNodes[including]=node,new HashArrayMapNode(ownerID,count+1,expandedNodes)}function mergeIntoMapWith(map,merger,iterables){for(var iters=[],ii=0;ii<iterables.length;ii++){var value=iterables[ii],iter=KeyedIterable(value);isIterable(value)||(iter=iter.map(function(v){return fromJS(v)})),iters.push(iter)}return mergeIntoCollectionWith(map,merger,iters)}function deepMerger(merger){return function(existing,value){return existing&&existing.mergeDeepWith&&isIterable(value)?existing.mergeDeepWith(merger,value):merger?merger(existing,value):value}}function mergeIntoCollectionWith(collection,merger,iters){return iters=iters.filter(function(x){return 0!==x.size}),0===iters.length?collection:0===collection.size&&1===iters.length?collection.constructor(iters[0]):collection.withMutations(function(collection){for(var mergeIntoMap=merger?function(value,key){collection.update(key,NOT_SET,function(existing){return existing===NOT_SET?value:merger(existing,value)})}:function(value,key){collection.set(key,value)},ii=0;ii<iters.length;ii++)iters[ii].forEach(mergeIntoMap)})}function updateInDeepMap(existing,keyPathIter,notSetValue,updater){var isNotSet=existing===NOT_SET,step=keyPathIter.next();if(step.done){var existingValue=isNotSet?notSetValue:existing,newValue=updater(existingValue);return newValue===existingValue?existing:newValue}invariant(isNotSet||existing&&existing.set,"invalid keyPath");var key=step.value,nextExisting=isNotSet?NOT_SET:existing.get(key,NOT_SET),nextUpdated=updateInDeepMap(nextExisting,keyPathIter,notSetValue,updater);return nextUpdated===nextExisting?existing:nextUpdated===NOT_SET?existing.remove(key):(isNotSet?emptyMap():existing).set(key,nextUpdated)}function popCount(x){return x-=x>>1&1431655765,x=(858993459&x)+(x>>2&858993459),x=x+(x>>4)&252645135,x+=x>>8,x+=x>>16,127&x}function setIn(array,idx,val,canEdit){var newArray=canEdit?array:arrCopy(array);return newArray[idx]=val,newArray}function spliceIn(array,idx,val,canEdit){var newLen=array.length+1;if(canEdit&&idx+1===newLen)return array[idx]=val,array;for(var newArray=new Array(newLen),after=0,ii=0;newLen>ii;ii++)ii===idx?(newArray[ii]=val,after=-1):newArray[ii]=array[ii+after];return newArray}function spliceOut(array,idx,canEdit){var newLen=array.length-1;if(canEdit&&idx===newLen)return array.pop(),array;for(var newArray=new Array(newLen),after=0,ii=0;newLen>ii;ii++)ii===idx&&(after=1),newArray[ii]=array[ii+after];return newArray}function flipFactory(iterable){var flipSequence=makeSequence(iterable);return flipSequence._iter=iterable,flipSequence.size=iterable.size,flipSequence.flip=function(){return iterable},flipSequence.reverse=function(){var reversedSequence=iterable.reverse.apply(this);return reversedSequence.flip=function(){return iterable.reverse()},reversedSequence},flipSequence.has=function(key){return iterable.contains(key)},flipSequence.contains=function(key){return iterable.has(key)},flipSequence.cacheResult=cacheResultThrough,flipSequence.__iterateUncached=function(fn,reverse){var $__0=this;return iterable.__iterate(function(v,k){return fn(k,v,$__0)!==!1},reverse)},flipSequence.__iteratorUncached=function(type,reverse){if(type===ITERATE_ENTRIES){var iterator=iterable.__iterator(type,reverse);return new Iterator(function(){var step=iterator.next();if(!step.done){var k=step.value[0];step.value[0]=step.value[1],step.value[1]=k}return step})}return iterable.__iterator(type===ITERATE_VALUES?ITERATE_KEYS:ITERATE_VALUES,reverse)},flipSequence}function mapFactory(iterable,mapper,context){var mappedSequence=makeSequence(iterable);return mappedSequence.size=iterable.size,mappedSequence.has=function(key){return iterable.has(key)},mappedSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v===NOT_SET?notSetValue:mapper.call(context,v,key,iterable)},mappedSequence.__iterateUncached=function(fn,reverse){var $__0=this;return iterable.__iterate(function(v,k,c){return fn(mapper.call(context,v,k,c),k,$__0)!==!1},reverse)},mappedSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse);return new Iterator(function(){var step=iterator.next();if(step.done)return step;var entry=step.value,key=entry[0];return iteratorValue(type,key,mapper.call(context,entry[1],key,iterable),step)})},mappedSequence}function reverseFactory(iterable,useKeys){var reversedSequence=makeSequence(iterable);return reversedSequence._iter=iterable,reversedSequence.size=iterable.size,reversedSequence.reverse=function(){return iterable},iterable.flip&&(reversedSequence.flip=function(){var flipSequence=flipFactory(iterable);return flipSequence.reverse=function(){return iterable.flip()},flipSequence}),reversedSequence.get=function(key,notSetValue){return iterable.get(useKeys?key:-1-key,notSetValue)},reversedSequence.has=function(key){return iterable.has(useKeys?key:-1-key)},reversedSequence.contains=function(value){return iterable.contains(value)},reversedSequence.cacheResult=cacheResultThrough,reversedSequence.__iterate=function(fn,reverse){var $__0=this;return iterable.__iterate(function(v,k){return fn(v,k,$__0)},!reverse)},reversedSequence.__iterator=function(type,reverse){return iterable.__iterator(type,!reverse)},reversedSequence}function filterFactory(iterable,predicate,context,useKeys){var filterSequence=makeSequence(iterable);return useKeys&&(filterSequence.has=function(key){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&!!predicate.call(context,v,key,iterable)},filterSequence.get=function(key,notSetValue){var v=iterable.get(key,NOT_SET);return v!==NOT_SET&&predicate.call(context,v,key,iterable)?v:notSetValue}),filterSequence.__iterateUncached=function(fn,reverse){var $__0=this,iterations=0;return iterable.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?(iterations++,fn(v,useKeys?k:iterations-1,$__0)):void 0},reverse),iterations},filterSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse),iterations=0;return new Iterator(function(){for(;;){var step=iterator.next();if(step.done)return step;var entry=step.value,key=entry[0],value=entry[1];if(predicate.call(context,value,key,iterable))return iteratorValue(type,useKeys?key:iterations++,value,step)}})},filterSequence}function countByFactory(iterable,grouper,context){var groups=Map().asMutable();return iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),0,function(a){return a+1})}),groups.asImmutable()}function groupByFactory(iterable,grouper,context){var isKeyedIter=isKeyed(iterable),groups=Map().asMutable();iterable.__iterate(function(v,k){groups.update(grouper.call(context,v,k,iterable),function(a){return a=a||[],a.push(isKeyedIter?[k,v]:v),a})});var coerce=iterableClass(iterable);return groups.map(function(arr){return reify(iterable,coerce(arr))})}function takeFactory(iterable,amount){if(amount>iterable.size)return iterable;0>amount&&(amount=0);var takeSequence=makeSequence(iterable);return takeSequence.size=iterable.size&&Math.min(iterable.size,amount),takeSequence.__iterateUncached=function(fn,reverse){var $__0=this;if(0===amount)return 0;if(reverse)return this.cacheResult().__iterate(fn,reverse);var iterations=0;return iterable.__iterate(function(v,k){return++iterations&&fn(v,k,$__0)!==!1&&amount>iterations}),iterations},takeSequence.__iteratorUncached=function(type,reverse){if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=amount&&iterable.__iterator(type,reverse),iterations=0;return new Iterator(function(){return iterations++>amount?iteratorDone():iterator.next()})},takeSequence}function takeWhileFactory(iterable,predicate,context){var takeSequence=makeSequence(iterable);return takeSequence.__iterateUncached=function(fn,reverse){var $__0=this;if(reverse)return this.cacheResult().__iterate(fn,reverse);var iterations=0;return iterable.__iterate(function(v,k,c){return predicate.call(context,v,k,c)&&++iterations&&fn(v,k,$__0)}),iterations},takeSequence.__iteratorUncached=function(type,reverse){var $__0=this;if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse),iterating=!0;return new Iterator(function(){if(!iterating)return iteratorDone();var step=iterator.next();if(step.done)return step;var entry=step.value,k=entry[0],v=entry[1];return predicate.call(context,v,k,$__0)?type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step):(iterating=!1,iteratorDone())})},takeSequence}function skipFactory(iterable,amount,useKeys){if(0>=amount)return iterable;var skipSequence=makeSequence(iterable);return skipSequence.size=iterable.size&&Math.max(0,iterable.size-amount),skipSequence.__iterateUncached=function(fn,reverse){var $__0=this;if(reverse)return this.cacheResult().__iterate(fn,reverse);var skipped=0,isSkipping=!0,iterations=0;return iterable.__iterate(function(v,k){return isSkipping&&(isSkipping=skipped++<amount)?void 0:(iterations++,fn(v,useKeys?k:iterations-1,$__0))}),iterations},skipSequence.__iteratorUncached=function(type,reverse){if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=amount&&iterable.__iterator(type,reverse),skipped=0,iterations=0;return new Iterator(function(){for(;amount>skipped;)skipped++,iterator.next();var step=iterator.next();return useKeys||type===ITERATE_VALUES?step:type===ITERATE_KEYS?iteratorValue(type,iterations++,void 0,step):iteratorValue(type,iterations++,step.value[1],step)})},skipSequence}function skipWhileFactory(iterable,predicate,context,useKeys){var skipSequence=makeSequence(iterable);return skipSequence.__iterateUncached=function(fn,reverse){var $__0=this;if(reverse)return this.cacheResult().__iterate(fn,reverse);var isSkipping=!0,iterations=0;return iterable.__iterate(function(v,k,c){return isSkipping&&(isSkipping=predicate.call(context,v,k,c))?void 0:(iterations++,fn(v,useKeys?k:iterations-1,$__0))}),iterations},skipSequence.__iteratorUncached=function(type,reverse){var $__0=this;if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=iterable.__iterator(ITERATE_ENTRIES,reverse),skipping=!0,iterations=0;return new Iterator(function(){var step,k,v;do{if(step=iterator.next(),step.done)return useKeys||type===ITERATE_VALUES?step:type===ITERATE_KEYS?iteratorValue(type,iterations++,void 0,step):iteratorValue(type,iterations++,step.value[1],step);var entry=step.value;k=entry[0],v=entry[1],skipping&&(skipping=predicate.call(context,v,k,$__0))}while(skipping);return type===ITERATE_ENTRIES?step:iteratorValue(type,k,v,step)})},skipSequence}function concatFactory(iterable,values){var isKeyedIterable=isKeyed(iterable),iters=[iterable].concat(values).map(function(v){return isIterable(v)?isKeyedIterable&&(v=KeyedIterable(v)):v=isKeyedIterable?keyedSeqFromValue(v):indexedSeqFromValue(Array.isArray(v)?v:[v]),v}).filter(function(v){return 0!==v.size});if(0===iters.length)return iterable;if(1===iters.length){var singleton=iters[0];if(singleton===iterable||isKeyedIterable&&isKeyed(singleton)||isIndexed(iterable)&&isIndexed(singleton))return singleton}var concatSeq=new ArraySeq(iters);return isKeyedIterable?concatSeq=concatSeq.toKeyedSeq():isIndexed(iterable)||(concatSeq=concatSeq.toSetSeq()),concatSeq=concatSeq.flatten(!0),concatSeq.size=iters.reduce(function(sum,seq){if(void 0!==sum){var size=seq.size;if(void 0!==size)return sum+size}},0),concatSeq}function flattenFactory(iterable,depth,useKeys){var flatSequence=makeSequence(iterable);return flatSequence.__iterateUncached=function(fn,reverse){function flatDeep(iter,currentDepth){var $__0=this;iter.__iterate(function(v,k){return(!depth||depth>currentDepth)&&isIterable(v)?flatDeep(v,currentDepth+1):fn(v,useKeys?k:iterations++,$__0)===!1&&(stopped=!0),!stopped},reverse)}var iterations=0,stopped=!1;return flatDeep(iterable,0),iterations},flatSequence.__iteratorUncached=function(type,reverse){var iterator=iterable.__iterator(type,reverse),stack=[],iterations=0;return new Iterator(function(){for(;iterator;){var step=iterator.next();if(step.done===!1){var v=step.value;if(type===ITERATE_ENTRIES&&(v=v[1]),depth&&!(stack.length<depth)||!isIterable(v))return useKeys?step:iteratorValue(type,iterations++,v,step);stack.push(iterator),iterator=v.__iterator(type,reverse)}else iterator=stack.pop()}return iteratorDone()})},flatSequence}function flatMapFactory(iterable,mapper,context){var coerce=iterableClass(iterable);return iterable.toSeq().map(function(v,k){return coerce(mapper.call(context,v,k,iterable))}).flatten(!0)}function interposeFactory(iterable,separator){var interposedSequence=makeSequence(iterable);return interposedSequence.size=iterable.size&&2*iterable.size-1,interposedSequence.__iterateUncached=function(fn,reverse){var $__0=this,iterations=0;return iterable.__iterate(function(v,k){return(!iterations||fn(separator,iterations++,$__0)!==!1)&&fn(v,iterations++,$__0)!==!1},reverse),iterations},interposedSequence.__iteratorUncached=function(type,reverse){var step,iterator=iterable.__iterator(ITERATE_VALUES,reverse),iterations=0;return new Iterator(function(){return(!step||iterations%2)&&(step=iterator.next(),step.done)?step:iterations%2?iteratorValue(type,iterations++,separator):iteratorValue(type,iterations++,step.value,step)})},interposedSequence}function sortFactory(iterable,comparator,mapper){comparator||(comparator=defaultComparator);var isKeyedIterable=isKeyed(iterable),index=0,entries=iterable.toSeq().map(function(v,k){return[k,v,index++,mapper?mapper(v,k,iterable):v]}).toArray();return entries.sort(function(a,b){return comparator(a[3],b[3])||a[2]-b[2]}).forEach(isKeyedIterable?function(v,i){entries[i].length=2}:function(v,i){entries[i]=v[1]}),isKeyedIterable?KeyedSeq(entries):isIndexed(iterable)?IndexedSeq(entries):SetSeq(entries)}function maxFactory(iterable,comparator,mapper){if(comparator||(comparator=defaultComparator),mapper){var entry=iterable.toSeq().map(function(v,k){return[v,mapper(v,k,iterable)]}).reduce(function(a,b){return _maxCompare(comparator,a[1],b[1])?b:a});return entry&&entry[0]}return iterable.reduce(function(a,b){return _maxCompare(comparator,a,b)?b:a})}function _maxCompare(comparator,a,b){var comp=comparator(b,a);return 0===comp&&b!==a&&(void 0===b||null===b||b!==b)||comp>0}function reify(iter,seq){return isSeq(iter)?seq:iter.constructor(seq)}function validateEntry(entry){if(entry!==Object(entry))throw new TypeError("Expected [K, V] tuple: "+entry)}function resolveSize(iter){return assertNotInfinite(iter.size),ensureSize(iter)}function iterableClass(iterable){return isKeyed(iterable)?KeyedIterable:isIndexed(iterable)?IndexedIterable:SetIterable}function makeSequence(iterable){return Object.create((isKeyed(iterable)?KeyedSeq:isIndexed(iterable)?IndexedSeq:SetSeq).prototype)}function cacheResultThrough(){return this._iter.cacheResult?(this._iter.cacheResult(),this.size=this._iter.size,this):Seq.prototype.cacheResult.call(this)}function defaultComparator(a,b){return a>b?1:b>a?-1:0}function isList(maybeList){return!(!maybeList||!maybeList[IS_LIST_SENTINEL])}function iterateList(list,reverse){function iterateNodeOrLeaf(node,level,offset){return 0===level?iterateLeaf(node,offset):iterateNode(node,level,offset)}function iterateLeaf(node,offset){var array=offset===tailPos?tail&&tail.array:node&&node.array,from=offset>left?0:left-offset,to=right-offset;return to>SIZE&&(to=SIZE),function(){if(from===to)return DONE;var idx=reverse?--to:from++;return array&&array[idx]}}function iterateNode(node,level,offset){var values,array=node&&node.array,from=offset>left?0:left-offset>>level,to=(right-offset>>level)+1;return to>SIZE&&(to=SIZE),function(){for(;;){if(values){var value=values();if(value!==DONE)return value;values=null}if(from===to)return DONE;var idx=reverse?--to:from++;values=iterateNodeOrLeaf(array&&array[idx],level-SHIFT,offset+(idx<<level))}}}var left=list._origin,right=list._capacity,tailPos=getTailOffset(right),tail=list._tail;return iterateNodeOrLeaf(list._root,list._level,0)}function makeList(origin,capacity,level,root,tail,ownerID,hash){var list=Object.create(ListPrototype);return list.size=capacity-origin,list._origin=origin,list._capacity=capacity,list._level=level,list._root=root,list._tail=tail,list.__ownerID=ownerID,list.__hash=hash,list.__altered=!1,list}function emptyList(){return EMPTY_LIST||(EMPTY_LIST=makeList(0,0,SHIFT))}function updateList(list,index,value){if(index=wrapIndex(list,index),index>=list.size||0>index)return list.withMutations(function(list){0>index?setListBounds(list,index).set(0,value):setListBounds(list,0,index+1).set(index,value)});index+=list._origin;var newTail=list._tail,newRoot=list._root,didAlter=MakeRef(DID_ALTER);return index>=getTailOffset(list._capacity)?newTail=updateVNode(newTail,list.__ownerID,0,index,value,didAlter):newRoot=updateVNode(newRoot,list.__ownerID,list._level,index,value,didAlter),didAlter.value?list.__ownerID?(list._root=newRoot,list._tail=newTail,list.__hash=void 0,list.__altered=!0,list):makeList(list._origin,list._capacity,list._level,newRoot,newTail):list}function updateVNode(node,ownerID,level,index,value,didAlter){var idx=index>>>level&MASK,nodeHas=node&&idx<node.array.length;if(!nodeHas&&void 0===value)return node;var newNode;if(level>0){var lowerNode=node&&node.array[idx],newLowerNode=updateVNode(lowerNode,ownerID,level-SHIFT,index,value,didAlter);return newLowerNode===lowerNode?node:(newNode=editableVNode(node,ownerID),newNode.array[idx]=newLowerNode,newNode)}return nodeHas&&node.array[idx]===value?node:(SetRef(didAlter),newNode=editableVNode(node,ownerID),void 0===value&&idx===newNode.array.length-1?newNode.array.pop():newNode.array[idx]=value,newNode)}function editableVNode(node,ownerID){return ownerID&&node&&ownerID===node.ownerID?node:new VNode(node?node.array.slice():[],ownerID)}function listNodeFor(list,rawIndex){if(rawIndex>=getTailOffset(list._capacity))return list._tail;if(rawIndex<1<<list._level+SHIFT){for(var node=list._root,level=list._level;node&&level>0;)node=node.array[rawIndex>>>level&MASK],level-=SHIFT;return node}}function setListBounds(list,begin,end){var owner=list.__ownerID||new OwnerID,oldOrigin=list._origin,oldCapacity=list._capacity,newOrigin=oldOrigin+begin,newCapacity=void 0===end?oldCapacity:0>end?oldCapacity+end:oldOrigin+end;if(newOrigin===oldOrigin&&newCapacity===oldCapacity)return list;if(newOrigin>=newCapacity)return list.clear();for(var newLevel=list._level,newRoot=list._root,offsetShift=0;0>newOrigin+offsetShift;)newRoot=new VNode(newRoot&&newRoot.array.length?[void 0,newRoot]:[],owner),newLevel+=SHIFT,offsetShift+=1<<newLevel;offsetShift&&(newOrigin+=offsetShift,oldOrigin+=offsetShift,newCapacity+=offsetShift,oldCapacity+=offsetShift);for(var oldTailOffset=getTailOffset(oldCapacity),newTailOffset=getTailOffset(newCapacity);newTailOffset>=1<<newLevel+SHIFT;)newRoot=new VNode(newRoot&&newRoot.array.length?[newRoot]:[],owner),newLevel+=SHIFT;var oldTail=list._tail,newTail=oldTailOffset>newTailOffset?listNodeFor(list,newCapacity-1):newTailOffset>oldTailOffset?new VNode([],owner):oldTail;if(oldTail&&newTailOffset>oldTailOffset&&oldCapacity>newOrigin&&oldTail.array.length){newRoot=editableVNode(newRoot,owner);for(var node=newRoot,level=newLevel;level>SHIFT;level-=SHIFT){var idx=oldTailOffset>>>level&MASK;node=node.array[idx]=editableVNode(node.array[idx],owner)}node.array[oldTailOffset>>>SHIFT&MASK]=oldTail}if(oldCapacity>newCapacity&&(newTail=newTail&&newTail.removeAfter(owner,0,newCapacity)),newOrigin>=newTailOffset)newOrigin-=newTailOffset,newCapacity-=newTailOffset,newLevel=SHIFT,newRoot=null,newTail=newTail&&newTail.removeBefore(owner,0,newOrigin);else if(newOrigin>oldOrigin||oldTailOffset>newTailOffset){for(offsetShift=0;newRoot;){var beginIndex=newOrigin>>>newLevel&MASK;if(beginIndex!==newTailOffset>>>newLevel&MASK)break;beginIndex&&(offsetShift+=(1<<newLevel)*beginIndex),newLevel-=SHIFT,newRoot=newRoot.array[beginIndex]}newRoot&&newOrigin>oldOrigin&&(newRoot=newRoot.removeBefore(owner,newLevel,newOrigin-offsetShift)),newRoot&&oldTailOffset>newTailOffset&&(newRoot=newRoot.removeAfter(owner,newLevel,newTailOffset-offsetShift)),offsetShift&&(newOrigin-=offsetShift,newCapacity-=offsetShift)}return list.__ownerID?(list.size=newCapacity-newOrigin,list._origin=newOrigin,list._capacity=newCapacity,list._level=newLevel,list._root=newRoot,list._tail=newTail,list.__hash=void 0,list.__altered=!0,list):makeList(newOrigin,newCapacity,newLevel,newRoot,newTail)}function mergeIntoListWith(list,merger,iterables){
for(var iters=[],maxSize=0,ii=0;ii<iterables.length;ii++){var value=iterables[ii],iter=IndexedIterable(value);iter.size>maxSize&&(maxSize=iter.size),isIterable(value)||(iter=iter.map(function(v){return fromJS(v)})),iters.push(iter)}return maxSize>list.size&&(list=list.setSize(maxSize)),mergeIntoCollectionWith(list,merger,iters)}function getTailOffset(size){return SIZE>size?0:size-1>>>SHIFT<<SHIFT}function isOrderedMap(maybeOrderedMap){return isMap(maybeOrderedMap)&&isOrdered(maybeOrderedMap)}function makeOrderedMap(map,list,ownerID,hash){var omap=Object.create(OrderedMap.prototype);return omap.size=map?map.size:0,omap._map=map,omap._list=list,omap.__ownerID=ownerID,omap.__hash=hash,omap}function emptyOrderedMap(){return EMPTY_ORDERED_MAP||(EMPTY_ORDERED_MAP=makeOrderedMap(emptyMap(),emptyList()))}function updateOrderedMap(omap,k,v){var newMap,newList,map=omap._map,list=omap._list,i=map.get(k),has=void 0!==i;if(v===NOT_SET){if(!has)return omap;list.size>=SIZE&&list.size>=2*map.size?(newList=list.filter(function(entry,idx){return void 0!==entry&&i!==idx}),newMap=newList.toKeyedSeq().map(function(entry){return entry[0]}).flip().toMap(),omap.__ownerID&&(newMap.__ownerID=newList.__ownerID=omap.__ownerID)):(newMap=map.remove(k),newList=i===list.size-1?list.pop():list.set(i,void 0))}else if(has){if(v===list.get(i)[1])return omap;newMap=map,newList=list.set(i,[k,v])}else newMap=map.set(k,list.size),newList=list.set(list.size,[k,v]);return omap.__ownerID?(omap.size=newMap.size,omap._map=newMap,omap._list=newList,omap.__hash=void 0,omap):makeOrderedMap(newMap,newList)}function isStack(maybeStack){return!(!maybeStack||!maybeStack[IS_STACK_SENTINEL])}function makeStack(size,head,ownerID,hash){var map=Object.create(StackPrototype);return map.size=size,map._head=head,map.__ownerID=ownerID,map.__hash=hash,map.__altered=!1,map}function emptyStack(){return EMPTY_STACK||(EMPTY_STACK=makeStack(0))}function isSet(maybeSet){return!(!maybeSet||!maybeSet[IS_SET_SENTINEL])}function updateSet(set,newMap){return set.__ownerID?(set.size=newMap.size,set._map=newMap,set):newMap===set._map?set:0===newMap.size?set.__empty():set.__make(newMap)}function makeSet(map,ownerID){var set=Object.create(SetPrototype);return set.size=map?map.size:0,set._map=map,set.__ownerID=ownerID,set}function emptySet(){return EMPTY_SET||(EMPTY_SET=makeSet(emptyMap()))}function isOrderedSet(maybeOrderedSet){return isSet(maybeOrderedSet)&&isOrdered(maybeOrderedSet)}function makeOrderedSet(map,ownerID){var set=Object.create(OrderedSetPrototype);return set.size=map?map.size:0,set._map=map,set.__ownerID=ownerID,set}function emptyOrderedSet(){return EMPTY_ORDERED_SET||(EMPTY_ORDERED_SET=makeOrderedSet(emptyOrderedMap()))}function makeRecord(likeRecord,map,ownerID){var record=Object.create(Object.getPrototypeOf(likeRecord));return record._map=map,record.__ownerID=ownerID,record}function recordName(record){return record._name||record.constructor.name}var $Object=Object,$traceurRuntime={};$traceurRuntime.createClass=createClass,$traceurRuntime.superCall=superCall,$traceurRuntime.defaultSuperCall=defaultSuperCall;var DELETE="delete",SHIFT=5,SIZE=1<<SHIFT,MASK=SIZE-1,NOT_SET={},CHANGE_LENGTH={value:!1},DID_ALTER={value:!1},imul="function"==typeof Math.imul&&-2===Math.imul(4294967295,2)?Math.imul:function(a,b){a=0|a,b=0|b;var c=65535&a,d=65535&b;return c*d+((a>>>16)*d+c*(b>>>16)<<16>>>0)|0},canDefineProperty=function(){try{return Object.defineProperty({},"x",{}),!0}catch(e){return!1}}(),weakMap="function"==typeof WeakMap&&new WeakMap,objHashUID=0,UID_HASH_KEY="__immutablehash__";"function"==typeof Symbol&&(UID_HASH_KEY=Symbol(UID_HASH_KEY));var STRING_HASH_CACHE_MIN_STRLEN=16,STRING_HASH_CACHE_MAX_SIZE=255,STRING_HASH_CACHE_SIZE=0,stringHashCache={},ITERATE_KEYS=0,ITERATE_VALUES=1,ITERATE_ENTRIES=2,FAUX_ITERATOR_SYMBOL="@@iterator",REAL_ITERATOR_SYMBOL="function"==typeof Symbol&&Symbol.iterator,ITERATOR_SYMBOL=REAL_ITERATOR_SYMBOL||FAUX_ITERATOR_SYMBOL,Iterator=function(next){this.next=next};$traceurRuntime.createClass(Iterator,{toString:function(){return"[Iterator]"}},{}),Iterator.KEYS=ITERATE_KEYS,Iterator.VALUES=ITERATE_VALUES,Iterator.ENTRIES=ITERATE_ENTRIES;var IteratorPrototype=Iterator.prototype;IteratorPrototype.inspect=IteratorPrototype.toSource=function(){return this.toString()},IteratorPrototype[ITERATOR_SYMBOL]=function(){return this};var Iterable=function(value){return isIterable(value)?value:Seq(value)},$Iterable=Iterable;$traceurRuntime.createClass(Iterable,{toArray:function(){assertNotInfinite(this.size);var array=new Array(this.size||0);return this.valueSeq().__iterate(function(v,i){array[i]=v}),array},toIndexedSeq:function(){return new ToIndexedSequence(this)},toJS:function(){return this.toSeq().map(function(value){return value&&"function"==typeof value.toJS?value.toJS():value}).__toJS()},toKeyedSeq:function(){return new ToKeyedSequence(this,!0)},toMap:function(){return Map(this.toKeyedSeq())},toObject:function(){assertNotInfinite(this.size);var object={};return this.__iterate(function(v,k){object[k]=v}),object},toOrderedMap:function(){return OrderedMap(this.toKeyedSeq())},toOrderedSet:function(){return OrderedSet(isKeyed(this)?this.valueSeq():this)},toSet:function(){return Set(isKeyed(this)?this.valueSeq():this)},toSetSeq:function(){return new ToSetSequence(this)},toSeq:function(){return isIndexed(this)?this.toIndexedSeq():isKeyed(this)?this.toKeyedSeq():this.toSetSeq()},toStack:function(){return Stack(isKeyed(this)?this.valueSeq():this)},toList:function(){return List(isKeyed(this)?this.valueSeq():this)},toString:function(){return"[Iterable]"},__toString:function(head,tail){return 0===this.size?head+tail:head+" "+this.toSeq().map(this.__toStringMapper).join(", ")+" "+tail},concat:function(){for(var values=[],$__2=0;$__2<arguments.length;$__2++)values[$__2]=arguments[$__2];return reify(this,concatFactory(this,values))},contains:function(searchValue){return this.some(function(value){return is(value,searchValue)})},entries:function(){return this.__iterator(ITERATE_ENTRIES)},every:function(predicate,context){assertNotInfinite(this.size);var returnValue=!0;return this.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?void 0:(returnValue=!1,!1)}),returnValue},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,!0))},find:function(predicate,context,notSetValue){var foundValue=notSetValue;return this.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?(foundValue=v,!1):void 0}),foundValue},forEach:function(sideEffect,context){return assertNotInfinite(this.size),this.__iterate(context?sideEffect.bind(context):sideEffect)},join:function(separator){assertNotInfinite(this.size),separator=void 0!==separator?""+separator:",";var joined="",isFirst=!0;return this.__iterate(function(v){isFirst?isFirst=!1:joined+=separator,joined+=null!==v&&void 0!==v?v:""}),joined},keys:function(){return this.__iterator(ITERATE_KEYS)},map:function(mapper,context){return reify(this,mapFactory(this,mapper,context))},reduce:function(reducer,initialReduction,context){assertNotInfinite(this.size);var reduction,useFirst;return arguments.length<2?useFirst=!0:reduction=initialReduction,this.__iterate(function(v,k,c){useFirst?(useFirst=!1,reduction=v):reduction=reducer.call(context,reduction,v,k,c)}),reduction},reduceRight:function(reducer,initialReduction,context){var reversed=this.toKeyedSeq().reverse();return reversed.reduce.apply(reversed,arguments)},reverse:function(){return reify(this,reverseFactory(this,!0))},slice:function(begin,end){if(wholeSlice(begin,end,this.size))return this;var resolvedBegin=resolveBegin(begin,this.size),resolvedEnd=resolveEnd(end,this.size);if(resolvedBegin!==resolvedBegin||resolvedEnd!==resolvedEnd)return this.toSeq().cacheResult().slice(begin,end);var skipped=0===resolvedBegin?this:this.skip(resolvedBegin);return reify(this,void 0===resolvedEnd||resolvedEnd===this.size?skipped:skipped.take(resolvedEnd-resolvedBegin))},some:function(predicate,context){return!this.every(not(predicate),context)},sort:function(comparator){return reify(this,sortFactory(this,comparator))},values:function(){return this.__iterator(ITERATE_VALUES)},butLast:function(){return this.slice(0,-1)},count:function(predicate,context){return ensureSize(predicate?this.toSeq().filter(predicate,context):this)},countBy:function(grouper,context){return countByFactory(this,grouper,context)},equals:function(other){return deepEqual(this,other)},entrySeq:function(){var iterable=this;if(iterable._cache)return new ArraySeq(iterable._cache);var entriesSequence=iterable.toSeq().map(entryMapper).toIndexedSeq();return entriesSequence.fromEntrySeq=function(){return iterable.toSeq()},entriesSequence},filterNot:function(predicate,context){return this.filter(not(predicate),context)},findLast:function(predicate,context,notSetValue){return this.toKeyedSeq().reverse().find(predicate,context,notSetValue)},first:function(){return this.find(returnTrue)},flatMap:function(mapper,context){return reify(this,flatMapFactory(this,mapper,context))},flatten:function(depth){return reify(this,flattenFactory(this,depth,!0))},fromEntrySeq:function(){return new FromEntriesSequence(this)},get:function(searchKey,notSetValue){return this.find(function(_,key){return is(key,searchKey)},void 0,notSetValue)},getIn:function(searchKeyPath,notSetValue){var nested=this;if(searchKeyPath)for(var step,iter=getIterator(searchKeyPath)||getIterator($Iterable(searchKeyPath));!(step=iter.next()).done;){var key=step.value;if(nested=nested&&nested.get?nested.get(key,NOT_SET):NOT_SET,nested===NOT_SET)return notSetValue}return nested},groupBy:function(grouper,context){return groupByFactory(this,grouper,context)},has:function(searchKey){return this.get(searchKey,NOT_SET)!==NOT_SET},hasIn:function(searchKeyPath){return this.getIn(searchKeyPath,NOT_SET)!==NOT_SET},isSubset:function(iter){return iter="function"==typeof iter.contains?iter:$Iterable(iter),this.every(function(value){return iter.contains(value)})},isSuperset:function(iter){return iter.isSubset(this)},keySeq:function(){return this.toSeq().map(keyMapper).toIndexedSeq()},last:function(){return this.toSeq().reverse().first()},max:function(comparator){return maxFactory(this,comparator)},maxBy:function(mapper,comparator){return maxFactory(this,comparator,mapper)},min:function(comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator)},minBy:function(mapper,comparator){return maxFactory(this,comparator?neg(comparator):defaultNegComparator,mapper)},rest:function(){return this.slice(1)},skip:function(amount){return reify(this,skipFactory(this,amount,!0))},skipLast:function(amount){return reify(this,this.toSeq().reverse().skip(amount).reverse())},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,!0))},skipUntil:function(predicate,context){return this.skipWhile(not(predicate),context)},sortBy:function(mapper,comparator){return reify(this,sortFactory(this,comparator,mapper))},take:function(amount){return reify(this,takeFactory(this,amount))},takeLast:function(amount){return reify(this,this.toSeq().reverse().take(amount).reverse())},takeWhile:function(predicate,context){return reify(this,takeWhileFactory(this,predicate,context))},takeUntil:function(predicate,context){return this.takeWhile(not(predicate),context)},valueSeq:function(){return this.toIndexedSeq()},hashCode:function(){return this.__hash||(this.__hash=hashIterable(this))}},{});var IS_ITERABLE_SENTINEL="@@__IMMUTABLE_ITERABLE__@@",IS_KEYED_SENTINEL="@@__IMMUTABLE_KEYED__@@",IS_INDEXED_SENTINEL="@@__IMMUTABLE_INDEXED__@@",IS_ORDERED_SENTINEL="@@__IMMUTABLE_ORDERED__@@",IterablePrototype=Iterable.prototype;IterablePrototype[IS_ITERABLE_SENTINEL]=!0,IterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.values,IterablePrototype.toJSON=IterablePrototype.toJS,IterablePrototype.__toJS=IterablePrototype.toArray,IterablePrototype.__toStringMapper=quoteString,IterablePrototype.inspect=IterablePrototype.toSource=function(){return this.toString()},IterablePrototype.chain=IterablePrototype.flatMap,function(){try{Object.defineProperty(IterablePrototype,"length",{get:function(){if(!Iterable.noLengthWarning){var stack;try{throw new Error}catch(error){stack=error.stack}if(-1===stack.indexOf("_wrapObject"))return console&&console.warn&&console.warn("iterable.length has been deprecated, use iterable.size or iterable.count(). This warning will become a silent error in a future version. "+stack),this.size}}})}catch(e){}}();var KeyedIterable=function(value){return isKeyed(value)?value:KeyedSeq(value)};$traceurRuntime.createClass(KeyedIterable,{flip:function(){return reify(this,flipFactory(this))},findKey:function(predicate,context){var foundKey;return this.__iterate(function(v,k,c){return predicate.call(context,v,k,c)?(foundKey=k,!1):void 0}),foundKey},findLastKey:function(predicate,context){return this.toSeq().reverse().findKey(predicate,context)},keyOf:function(searchValue){return this.findKey(function(value){return is(value,searchValue)})},lastKeyOf:function(searchValue){return this.toSeq().reverse().keyOf(searchValue)},mapEntries:function(mapper,context){var $__0=this,iterations=0;return reify(this,this.toSeq().map(function(v,k){return mapper.call(context,[k,v],iterations++,$__0)}).fromEntrySeq())},mapKeys:function(mapper,context){var $__0=this;return reify(this,this.toSeq().flip().map(function(k,v){return mapper.call(context,k,v,$__0)}).flip())}},{},Iterable);var KeyedIterablePrototype=KeyedIterable.prototype;KeyedIterablePrototype[IS_KEYED_SENTINEL]=!0,KeyedIterablePrototype[ITERATOR_SYMBOL]=IterablePrototype.entries,KeyedIterablePrototype.__toJS=IterablePrototype.toObject,KeyedIterablePrototype.__toStringMapper=function(v,k){return k+": "+quoteString(v)};var IndexedIterable=function(value){return isIndexed(value)?value:IndexedSeq(value)};$traceurRuntime.createClass(IndexedIterable,{toKeyedSeq:function(){return new ToKeyedSequence(this,!1)},filter:function(predicate,context){return reify(this,filterFactory(this,predicate,context,!1))},findIndex:function(predicate,context){var key=this.toKeyedSeq().findKey(predicate,context);return void 0===key?-1:key},indexOf:function(searchValue){var key=this.toKeyedSeq().keyOf(searchValue);return void 0===key?-1:key},lastIndexOf:function(searchValue){var key=this.toKeyedSeq().lastKeyOf(searchValue);return void 0===key?-1:key},reverse:function(){return reify(this,reverseFactory(this,!1))},splice:function(index,removeNum){var numArgs=arguments.length;if(removeNum=Math.max(0|removeNum,0),0===numArgs||2===numArgs&&!removeNum)return this;index=resolveBegin(index,this.size);var spliced=this.slice(0,index);return reify(this,1===numArgs?spliced:spliced.concat(arrCopy(arguments,2),this.slice(index+removeNum)))},findLastIndex:function(predicate,context){var key=this.toKeyedSeq().findLastKey(predicate,context);return void 0===key?-1:key},first:function(){return this.get(0)},flatten:function(depth){return reify(this,flattenFactory(this,depth,!1))},get:function(index,notSetValue){return index=wrapIndex(this,index),0>index||this.size===1/0||void 0!==this.size&&index>this.size?notSetValue:this.find(function(_,key){return key===index},void 0,notSetValue)},has:function(index){return index=wrapIndex(this,index),index>=0&&(void 0!==this.size?this.size===1/0||index<this.size:-1!==this.indexOf(index))},interpose:function(separator){return reify(this,interposeFactory(this,separator))},last:function(){return this.get(-1)},skip:function(amount){var iter=this,skipSeq=skipFactory(iter,amount,!1);return isSeq(iter)&&skipSeq!==iter&&(skipSeq.get=function(index,notSetValue){return index=wrapIndex(this,index),index>=0?iter.get(index+amount,notSetValue):notSetValue}),reify(this,skipSeq)},skipWhile:function(predicate,context){return reify(this,skipWhileFactory(this,predicate,context,!1))},take:function(amount){var iter=this,takeSeq=takeFactory(iter,amount);return isSeq(iter)&&takeSeq!==iter&&(takeSeq.get=function(index,notSetValue){return index=wrapIndex(this,index),index>=0&&amount>index?iter.get(index,notSetValue):notSetValue}),reify(this,takeSeq)}},{},Iterable),IndexedIterable.prototype[IS_INDEXED_SENTINEL]=!0,IndexedIterable.prototype[IS_ORDERED_SENTINEL]=!0;var SetIterable=function(value){return isIterable(value)&&!isAssociative(value)?value:SetSeq(value)};$traceurRuntime.createClass(SetIterable,{get:function(value,notSetValue){return this.has(value)?value:notSetValue},contains:function(value){return this.has(value)},keySeq:function(){return this.valueSeq()}},{},Iterable),SetIterable.prototype.has=IterablePrototype.contains,Iterable.isIterable=isIterable,Iterable.isKeyed=isKeyed,Iterable.isIndexed=isIndexed,Iterable.isAssociative=isAssociative,Iterable.isOrdered=isOrdered,Iterable.Keyed=KeyedIterable,Iterable.Indexed=IndexedIterable,Iterable.Set=SetIterable,Iterable.Iterator=Iterator;var Seq=function(value){return null===value||void 0===value?emptySequence():isIterable(value)?value.toSeq():seqFromValue(value)},$Seq=Seq;$traceurRuntime.createClass(Seq,{toSeq:function(){return this},toString:function(){return this.__toString("Seq {","}")},cacheResult:function(){return!this._cache&&this.__iterateUncached&&(this._cache=this.entrySeq().toArray(),this.size=this._cache.length),this},__iterate:function(fn,reverse){return seqIterate(this,fn,reverse,!0)},__iterator:function(type,reverse){return seqIterator(this,type,reverse,!0)}},{of:function(){return $Seq(arguments)}},Iterable);var KeyedSeq=function(value){return null===value||void 0===value?emptySequence().toKeyedSeq():isIterable(value)?isKeyed(value)?value.toSeq():value.fromEntrySeq():keyedSeqFromValue(value)},$KeyedSeq=KeyedSeq;$traceurRuntime.createClass(KeyedSeq,{toKeyedSeq:function(){return this},toSeq:function(){return this}},{of:function(){return $KeyedSeq(arguments)}},Seq),mixin(KeyedSeq,KeyedIterable.prototype);var IndexedSeq=function(value){return null===value||void 0===value?emptySequence():isIterable(value)?isKeyed(value)?value.entrySeq():value.toIndexedSeq():indexedSeqFromValue(value)},$IndexedSeq=IndexedSeq;$traceurRuntime.createClass(IndexedSeq,{toIndexedSeq:function(){return this},toString:function(){return this.__toString("Seq [","]")},__iterate:function(fn,reverse){return seqIterate(this,fn,reverse,!1)},__iterator:function(type,reverse){return seqIterator(this,type,reverse,!1)}},{of:function(){return $IndexedSeq(arguments)}},Seq),mixin(IndexedSeq,IndexedIterable.prototype);var SetSeq=function(value){return(null===value||void 0===value?emptySequence():isIterable(value)?isKeyed(value)?value.entrySeq():value:indexedSeqFromValue(value)).toSetSeq()},$SetSeq=SetSeq;$traceurRuntime.createClass(SetSeq,{toSetSeq:function(){return this}},{of:function(){return $SetSeq(arguments)}},Seq),mixin(SetSeq,SetIterable.prototype),Seq.isSeq=isSeq,Seq.Keyed=KeyedSeq,Seq.Set=SetSeq,Seq.Indexed=IndexedSeq;var IS_SEQ_SENTINEL="@@__IMMUTABLE_SEQ__@@";Seq.prototype[IS_SEQ_SENTINEL]=!0;var ArraySeq=function(array){this._array=array,this.size=array.length};$traceurRuntime.createClass(ArraySeq,{get:function(index,notSetValue){return this.has(index)?this._array[wrapIndex(this,index)]:notSetValue},__iterate:function(fn,reverse){for(var array=this._array,maxIndex=array.length-1,ii=0;maxIndex>=ii;ii++)if(fn(array[reverse?maxIndex-ii:ii],ii,this)===!1)return ii+1;return ii},__iterator:function(type,reverse){var array=this._array,maxIndex=array.length-1,ii=0;return new Iterator(function(){return ii>maxIndex?iteratorDone():iteratorValue(type,ii,array[reverse?maxIndex-ii++:ii++])})}},{},IndexedSeq);var ObjectSeq=function(object){var keys=Object.keys(object);this._object=object,this._keys=keys,this.size=keys.length};$traceurRuntime.createClass(ObjectSeq,{get:function(key,notSetValue){return void 0===notSetValue||this.has(key)?this._object[key]:notSetValue},has:function(key){return this._object.hasOwnProperty(key)},__iterate:function(fn,reverse){for(var object=this._object,keys=this._keys,maxIndex=keys.length-1,ii=0;maxIndex>=ii;ii++){var key=keys[reverse?maxIndex-ii:ii];if(fn(object[key],key,this)===!1)return ii+1}return ii},__iterator:function(type,reverse){var object=this._object,keys=this._keys,maxIndex=keys.length-1,ii=0;return new Iterator(function(){var key=keys[reverse?maxIndex-ii:ii];return ii++>maxIndex?iteratorDone():iteratorValue(type,key,object[key])})}},{},KeyedSeq),ObjectSeq.prototype[IS_ORDERED_SENTINEL]=!0;var IterableSeq=function(iterable){this._iterable=iterable,this.size=iterable.length||iterable.size};$traceurRuntime.createClass(IterableSeq,{__iterateUncached:function(fn,reverse){if(reverse)return this.cacheResult().__iterate(fn,reverse);var iterable=this._iterable,iterator=getIterator(iterable),iterations=0;if(isIterator(iterator))for(var step;!(step=iterator.next()).done&&fn(step.value,iterations++,this)!==!1;);return iterations},__iteratorUncached:function(type,reverse){if(reverse)return this.cacheResult().__iterator(type,reverse);var iterable=this._iterable,iterator=getIterator(iterable);if(!isIterator(iterator))return new Iterator(iteratorDone);var iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value)})}},{},IndexedSeq);var IteratorSeq=function(iterator){this._iterator=iterator,this._iteratorCache=[]};$traceurRuntime.createClass(IteratorSeq,{__iterateUncached:function(fn,reverse){if(reverse)return this.cacheResult().__iterate(fn,reverse);for(var iterator=this._iterator,cache=this._iteratorCache,iterations=0;iterations<cache.length;)if(fn(cache[iterations],iterations++,this)===!1)return iterations;for(var step;!(step=iterator.next()).done;){var val=step.value;if(cache[iterations]=val,fn(val,iterations++,this)===!1)break}return iterations},__iteratorUncached:function(type,reverse){if(reverse)return this.cacheResult().__iterator(type,reverse);var iterator=this._iterator,cache=this._iteratorCache,iterations=0;return new Iterator(function(){if(iterations>=cache.length){var step=iterator.next();if(step.done)return step;cache[iterations]=step.value}return iteratorValue(type,iterations,cache[iterations++])})}},{},IndexedSeq);var EMPTY_SEQ,Collection=function(){throw TypeError("Abstract")};$traceurRuntime.createClass(Collection,{},{},Iterable);var KeyedCollection=function(){$traceurRuntime.defaultSuperCall(this,$KeyedCollection.prototype,arguments)},$KeyedCollection=KeyedCollection;$traceurRuntime.createClass(KeyedCollection,{},{},Collection),mixin(KeyedCollection,KeyedIterable.prototype);var IndexedCollection=function(){$traceurRuntime.defaultSuperCall(this,$IndexedCollection.prototype,arguments)},$IndexedCollection=IndexedCollection;$traceurRuntime.createClass(IndexedCollection,{},{},Collection),mixin(IndexedCollection,IndexedIterable.prototype);var SetCollection=function(){$traceurRuntime.defaultSuperCall(this,$SetCollection.prototype,arguments)},$SetCollection=SetCollection;$traceurRuntime.createClass(SetCollection,{},{},Collection),mixin(SetCollection,SetIterable.prototype),Collection.Keyed=KeyedCollection,Collection.Indexed=IndexedCollection,Collection.Set=SetCollection;var Map=function(value){return null===value||void 0===value?emptyMap():isMap(value)?value:emptyMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v,k){return map.set(k,v)})})};$traceurRuntime.createClass(Map,{toString:function(){return this.__toString("Map {","}")},get:function(k,notSetValue){return this._root?this._root.get(0,void 0,k,notSetValue):notSetValue},set:function(k,v){return updateMap(this,k,v)},setIn:function(keyPath,v){return this.updateIn(keyPath,NOT_SET,function(){return v})},remove:function(k){return updateMap(this,k,NOT_SET)},deleteIn:function(keyPath){return this.updateIn(keyPath,function(){return NOT_SET})},update:function(k,notSetValue,updater){return 1===arguments.length?k(this):this.updateIn([k],notSetValue,updater)},updateIn:function(keyPath,notSetValue,updater){updater||(updater=notSetValue,notSetValue=void 0);var updatedValue=updateInDeepMap(this,getIterator(keyPath)||getIterator(Iterable(keyPath)),notSetValue,updater);return updatedValue===NOT_SET?void 0:updatedValue},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._root=null,this.__hash=void 0,this.__altered=!0,this):emptyMap()},merge:function(){return mergeIntoMapWith(this,void 0,arguments)},mergeWith:function(merger){for(var iters=[],$__3=1;$__3<arguments.length;$__3++)iters[$__3-1]=arguments[$__3];return mergeIntoMapWith(this,merger,iters)},mergeIn:function(keyPath){for(var iters=[],$__4=1;$__4<arguments.length;$__4++)iters[$__4-1]=arguments[$__4];return this.updateIn(keyPath,emptyMap(),function(m){return m.merge.apply(m,iters)})},mergeDeep:function(){return mergeIntoMapWith(this,deepMerger(void 0),arguments)},mergeDeepWith:function(merger){for(var iters=[],$__5=1;$__5<arguments.length;$__5++)iters[$__5-1]=arguments[$__5];return mergeIntoMapWith(this,deepMerger(merger),iters)},mergeDeepIn:function(keyPath){for(var iters=[],$__6=1;$__6<arguments.length;$__6++)iters[$__6-1]=arguments[$__6];return this.updateIn(keyPath,emptyMap(),function(m){return m.mergeDeep.apply(m,iters)})},sort:function(comparator){return OrderedMap(sortFactory(this,comparator))},sortBy:function(mapper,comparator){return OrderedMap(sortFactory(this,comparator,mapper))},withMutations:function(fn){var mutable=this.asMutable();return fn(mutable),mutable.wasAltered()?mutable.__ensureOwner(this.__ownerID):this},asMutable:function(){return this.__ownerID?this:this.__ensureOwner(new OwnerID)},asImmutable:function(){return this.__ensureOwner()},wasAltered:function(){return this.__altered},__iterator:function(type,reverse){return new MapIterator(this,type,reverse)},__iterate:function(fn,reverse){var $__0=this,iterations=0;return this._root&&this._root.iterate(function(entry){return iterations++,fn(entry[1],entry[0],$__0)},reverse),iterations},__ensureOwner:function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeMap(this.size,this._root,ownerID,this.__hash):(this.__ownerID=ownerID,this.__altered=!1,this)}},{},KeyedCollection),Map.isMap=isMap;var IS_MAP_SENTINEL="@@__IMMUTABLE_MAP__@@",MapPrototype=Map.prototype;MapPrototype[IS_MAP_SENTINEL]=!0,MapPrototype[DELETE]=MapPrototype.remove,MapPrototype.removeIn=MapPrototype.deleteIn;var ArrayMapNode=function(ownerID,entries){this.ownerID=ownerID,this.entries=entries},$ArrayMapNode=ArrayMapNode;$traceurRuntime.createClass(ArrayMapNode,{get:function(shift,keyHash,key,notSetValue){for(var entries=this.entries,ii=0,len=entries.length;len>ii;ii++)if(is(key,entries[ii][0]))return entries[ii][1];return notSetValue},update:function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){for(var removed=value===NOT_SET,entries=this.entries,idx=0,len=entries.length;len>idx&&!is(key,entries[idx][0]);idx++);var exists=len>idx;if(exists?entries[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),!removed||1!==entries.length){if(!exists&&!removed&&entries.length>=MAX_ARRAY_MAP_SIZE)return createNodes(ownerID,entries,key,value);var isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries:arrCopy(entries);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new $ArrayMapNode(ownerID,newEntries)}}},{});var BitmapIndexedNode=function(ownerID,bitmap,nodes){this.ownerID=ownerID,this.bitmap=bitmap,this.nodes=nodes},$BitmapIndexedNode=BitmapIndexedNode;$traceurRuntime.createClass(BitmapIndexedNode,{get:function(shift,keyHash,key,notSetValue){void 0===keyHash&&(keyHash=hash(key));var bit=1<<((0===shift?keyHash:keyHash>>>shift)&MASK),bitmap=this.bitmap;return 0===(bitmap&bit)?notSetValue:this.nodes[popCount(bitmap&bit-1)].get(shift+SHIFT,keyHash,key,notSetValue)},update:function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));var keyHashFrag=(0===shift?keyHash:keyHash>>>shift)&MASK,bit=1<<keyHashFrag,bitmap=this.bitmap,exists=0!==(bitmap&bit);if(!exists&&value===NOT_SET)return this;var idx=popCount(bitmap&bit-1),nodes=this.nodes,node=exists?nodes[idx]:void 0,newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node)return this;if(!exists&&newNode&&nodes.length>=MAX_BITMAP_INDEXED_SIZE)return expandNodes(ownerID,nodes,bitmap,keyHashFrag,newNode);if(exists&&!newNode&&2===nodes.length&&isLeafNode(nodes[1^idx]))return nodes[1^idx];if(exists&&newNode&&1===nodes.length&&isLeafNode(newNode))return newNode;var isEditable=ownerID&&ownerID===this.ownerID,newBitmap=exists?newNode?bitmap:bitmap^bit:bitmap|bit,newNodes=exists?newNode?setIn(nodes,idx,newNode,isEditable):spliceOut(nodes,idx,isEditable):spliceIn(nodes,idx,newNode,isEditable);return isEditable?(this.bitmap=newBitmap,this.nodes=newNodes,this):new $BitmapIndexedNode(ownerID,newBitmap,newNodes)}},{});var HashArrayMapNode=function(ownerID,count,nodes){this.ownerID=ownerID,this.count=count,this.nodes=nodes},$HashArrayMapNode=HashArrayMapNode;$traceurRuntime.createClass(HashArrayMapNode,{get:function(shift,keyHash,key,notSetValue){void 0===keyHash&&(keyHash=hash(key));var idx=(0===shift?keyHash:keyHash>>>shift)&MASK,node=this.nodes[idx];return node?node.get(shift+SHIFT,keyHash,key,notSetValue):notSetValue},update:function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));var idx=(0===shift?keyHash:keyHash>>>shift)&MASK,removed=value===NOT_SET,nodes=this.nodes,node=nodes[idx];if(removed&&!node)return this;var newNode=updateNode(node,ownerID,shift+SHIFT,keyHash,key,value,didChangeSize,didAlter);if(newNode===node)return this;var newCount=this.count;if(node){if(!newNode&&(newCount--,MIN_HASH_ARRAY_MAP_SIZE>newCount))return packNodes(ownerID,nodes,newCount,idx)}else newCount++;var isEditable=ownerID&&ownerID===this.ownerID,newNodes=setIn(nodes,idx,newNode,isEditable);return isEditable?(this.count=newCount,this.nodes=newNodes,this):new $HashArrayMapNode(ownerID,newCount,newNodes)}},{});var HashCollisionNode=function(ownerID,keyHash,entries){this.ownerID=ownerID,this.keyHash=keyHash,this.entries=entries},$HashCollisionNode=HashCollisionNode;$traceurRuntime.createClass(HashCollisionNode,{get:function(shift,keyHash,key,notSetValue){for(var entries=this.entries,ii=0,len=entries.length;len>ii;ii++)if(is(key,entries[ii][0]))return entries[ii][1];return notSetValue},update:function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){void 0===keyHash&&(keyHash=hash(key));var removed=value===NOT_SET;if(keyHash!==this.keyHash)return removed?this:(SetRef(didAlter),SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,keyHash,[key,value]));for(var entries=this.entries,idx=0,len=entries.length;len>idx&&!is(key,entries[idx][0]);idx++);var exists=len>idx;if(exists?entries[idx][1]===value:removed)return this;if(SetRef(didAlter),(removed||!exists)&&SetRef(didChangeSize),removed&&2===len)return new ValueNode(ownerID,this.keyHash,entries[1^idx]);var isEditable=ownerID&&ownerID===this.ownerID,newEntries=isEditable?entries:arrCopy(entries);return exists?removed?idx===len-1?newEntries.pop():newEntries[idx]=newEntries.pop():newEntries[idx]=[key,value]:newEntries.push([key,value]),isEditable?(this.entries=newEntries,this):new $HashCollisionNode(ownerID,this.keyHash,newEntries)}},{});var ValueNode=function(ownerID,keyHash,entry){this.ownerID=ownerID,this.keyHash=keyHash,this.entry=entry},$ValueNode=ValueNode;$traceurRuntime.createClass(ValueNode,{get:function(shift,keyHash,key,notSetValue){return is(key,this.entry[0])?this.entry[1]:notSetValue},update:function(ownerID,shift,keyHash,key,value,didChangeSize,didAlter){var removed=value===NOT_SET,keyMatch=is(key,this.entry[0]);return(keyMatch?value===this.entry[1]:removed)?this:(SetRef(didAlter),removed?void SetRef(didChangeSize):keyMatch?ownerID&&ownerID===this.ownerID?(this.entry[1]=value,this):new $ValueNode(ownerID,this.keyHash,[key,value]):(SetRef(didChangeSize),mergeIntoNode(this,ownerID,shift,hash(key),[key,value])))}},{}),ArrayMapNode.prototype.iterate=HashCollisionNode.prototype.iterate=function(fn,reverse){for(var entries=this.entries,ii=0,maxIndex=entries.length-1;maxIndex>=ii;ii++)if(fn(entries[reverse?maxIndex-ii:ii])===!1)return!1},BitmapIndexedNode.prototype.iterate=HashArrayMapNode.prototype.iterate=function(fn,reverse){for(var nodes=this.nodes,ii=0,maxIndex=nodes.length-1;maxIndex>=ii;ii++){var node=nodes[reverse?maxIndex-ii:ii];if(node&&node.iterate(fn,reverse)===!1)return!1}},ValueNode.prototype.iterate=function(fn,reverse){return fn(this.entry)};var MapIterator=function(map,type,reverse){this._type=type,
this._reverse=reverse,this._stack=map._root&&mapIteratorFrame(map._root)};$traceurRuntime.createClass(MapIterator,{next:function(){for(var type=this._type,stack=this._stack;stack;){var maxIndex,node=stack.node,index=stack.index++;if(node.entry){if(0===index)return mapIteratorValue(type,node.entry)}else if(node.entries){if(maxIndex=node.entries.length-1,maxIndex>=index)return mapIteratorValue(type,node.entries[this._reverse?maxIndex-index:index])}else if(maxIndex=node.nodes.length-1,maxIndex>=index){var subNode=node.nodes[this._reverse?maxIndex-index:index];if(subNode){if(subNode.entry)return mapIteratorValue(type,subNode.entry);stack=this._stack=mapIteratorFrame(subNode,stack)}continue}stack=this._stack=this._stack.__prev}return iteratorDone()}},{},Iterator);var EMPTY_MAP,MAX_ARRAY_MAP_SIZE=SIZE/4,MAX_BITMAP_INDEXED_SIZE=SIZE/2,MIN_HASH_ARRAY_MAP_SIZE=SIZE/4,ToKeyedSequence=function(indexed,useKeys){this._iter=indexed,this._useKeys=useKeys,this.size=indexed.size};$traceurRuntime.createClass(ToKeyedSequence,{get:function(key,notSetValue){return this._iter.get(key,notSetValue)},has:function(key){return this._iter.has(key)},valueSeq:function(){return this._iter.valueSeq()},reverse:function(){var $__0=this,reversedSequence=reverseFactory(this,!0);return this._useKeys||(reversedSequence.valueSeq=function(){return $__0._iter.toSeq().reverse()}),reversedSequence},map:function(mapper,context){var $__0=this,mappedSequence=mapFactory(this,mapper,context);return this._useKeys||(mappedSequence.valueSeq=function(){return $__0._iter.toSeq().map(mapper,context)}),mappedSequence},__iterate:function(fn,reverse){var ii,$__0=this;return this._iter.__iterate(this._useKeys?function(v,k){return fn(v,k,$__0)}:(ii=reverse?resolveSize(this):0,function(v){return fn(v,reverse?--ii:ii++,$__0)}),reverse)},__iterator:function(type,reverse){if(this._useKeys)return this._iter.__iterator(type,reverse);var iterator=this._iter.__iterator(ITERATE_VALUES,reverse),ii=reverse?resolveSize(this):0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,reverse?--ii:ii++,step.value,step)})}},{},KeyedSeq),ToKeyedSequence.prototype[IS_ORDERED_SENTINEL]=!0;var ToIndexedSequence=function(iter){this._iter=iter,this.size=iter.size};$traceurRuntime.createClass(ToIndexedSequence,{contains:function(value){return this._iter.contains(value)},__iterate:function(fn,reverse){var $__0=this,iterations=0;return this._iter.__iterate(function(v){return fn(v,iterations++,$__0)},reverse)},__iterator:function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse),iterations=0;return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,iterations++,step.value,step)})}},{},IndexedSeq);var ToSetSequence=function(iter){this._iter=iter,this.size=iter.size};$traceurRuntime.createClass(ToSetSequence,{has:function(key){return this._iter.contains(key)},__iterate:function(fn,reverse){var $__0=this;return this._iter.__iterate(function(v){return fn(v,v,$__0)},reverse)},__iterator:function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){var step=iterator.next();return step.done?step:iteratorValue(type,step.value,step.value,step)})}},{},SetSeq);var FromEntriesSequence=function(entries){this._iter=entries,this.size=entries.size};$traceurRuntime.createClass(FromEntriesSequence,{entrySeq:function(){return this._iter.toSeq()},__iterate:function(fn,reverse){var $__0=this;return this._iter.__iterate(function(entry){return entry?(validateEntry(entry),fn(entry[1],entry[0],$__0)):void 0},reverse)},__iterator:function(type,reverse){var iterator=this._iter.__iterator(ITERATE_VALUES,reverse);return new Iterator(function(){for(;;){var step=iterator.next();if(step.done)return step;var entry=step.value;if(entry)return validateEntry(entry),type===ITERATE_ENTRIES?step:iteratorValue(type,entry[0],entry[1],step)}})}},{},KeyedSeq),ToIndexedSequence.prototype.cacheResult=ToKeyedSequence.prototype.cacheResult=ToSetSequence.prototype.cacheResult=FromEntriesSequence.prototype.cacheResult=cacheResultThrough;var List=function(value){var empty=emptyList();if(null===value||void 0===value)return empty;if(isList(value))return value;var iter=IndexedIterable(value),size=iter.size;return 0===size?empty:(assertNotInfinite(size),size>0&&SIZE>size?makeList(0,size,SHIFT,null,new VNode(iter.toArray())):empty.withMutations(function(list){list.setSize(size),iter.forEach(function(v,i){return list.set(i,v)})}))};$traceurRuntime.createClass(List,{toString:function(){return this.__toString("List [","]")},get:function(index,notSetValue){if(index=wrapIndex(this,index),0>index||index>=this.size)return notSetValue;index+=this._origin;var node=listNodeFor(this,index);return node&&node.array[index&MASK]},set:function(index,value){return updateList(this,index,value)},remove:function(index){return this.has(index)?0===index?this.shift():index===this.size-1?this.pop():this.splice(index,1):this},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=this._origin=this._capacity=0,this._level=SHIFT,this._root=this._tail=null,this.__hash=void 0,this.__altered=!0,this):emptyList()},push:function(){var values=arguments,oldSize=this.size;return this.withMutations(function(list){setListBounds(list,0,oldSize+values.length);for(var ii=0;ii<values.length;ii++)list.set(oldSize+ii,values[ii])})},pop:function(){return setListBounds(this,0,-1)},unshift:function(){var values=arguments;return this.withMutations(function(list){setListBounds(list,-values.length);for(var ii=0;ii<values.length;ii++)list.set(ii,values[ii])})},shift:function(){return setListBounds(this,1)},merge:function(){return mergeIntoListWith(this,void 0,arguments)},mergeWith:function(merger){for(var iters=[],$__7=1;$__7<arguments.length;$__7++)iters[$__7-1]=arguments[$__7];return mergeIntoListWith(this,merger,iters)},mergeDeep:function(){return mergeIntoListWith(this,deepMerger(void 0),arguments)},mergeDeepWith:function(merger){for(var iters=[],$__8=1;$__8<arguments.length;$__8++)iters[$__8-1]=arguments[$__8];return mergeIntoListWith(this,deepMerger(merger),iters)},setSize:function(size){return setListBounds(this,0,size)},slice:function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:setListBounds(this,resolveBegin(begin,size),resolveEnd(end,size))},__iterator:function(type,reverse){var index=0,values=iterateList(this,reverse);return new Iterator(function(){var value=values();return value===DONE?iteratorDone():iteratorValue(type,index++,value)})},__iterate:function(fn,reverse){for(var value,index=0,values=iterateList(this,reverse);(value=values())!==DONE&&fn(value,index++,this)!==!1;);return index},__ensureOwner:function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeList(this._origin,this._capacity,this._level,this._root,this._tail,ownerID,this.__hash):(this.__ownerID=ownerID,this)}},{of:function(){return this(arguments)}},IndexedCollection),List.isList=isList;var IS_LIST_SENTINEL="@@__IMMUTABLE_LIST__@@",ListPrototype=List.prototype;ListPrototype[IS_LIST_SENTINEL]=!0,ListPrototype[DELETE]=ListPrototype.remove,ListPrototype.setIn=MapPrototype.setIn,ListPrototype.deleteIn=ListPrototype.removeIn=MapPrototype.removeIn,ListPrototype.update=MapPrototype.update,ListPrototype.updateIn=MapPrototype.updateIn,ListPrototype.mergeIn=MapPrototype.mergeIn,ListPrototype.mergeDeepIn=MapPrototype.mergeDeepIn,ListPrototype.withMutations=MapPrototype.withMutations,ListPrototype.asMutable=MapPrototype.asMutable,ListPrototype.asImmutable=MapPrototype.asImmutable,ListPrototype.wasAltered=MapPrototype.wasAltered;var VNode=function(array,ownerID){this.array=array,this.ownerID=ownerID},$VNode=VNode;$traceurRuntime.createClass(VNode,{removeBefore:function(ownerID,level,index){if(index===level?1<<level:0===this.array.length)return this;var originIndex=index>>>level&MASK;if(originIndex>=this.array.length)return new $VNode([],ownerID);var newChild,removingFirst=0===originIndex;if(level>0){var oldChild=this.array[originIndex];if(newChild=oldChild&&oldChild.removeBefore(ownerID,level-SHIFT,index),newChild===oldChild&&removingFirst)return this}if(removingFirst&&!newChild)return this;var editable=editableVNode(this,ownerID);if(!removingFirst)for(var ii=0;originIndex>ii;ii++)editable.array[ii]=void 0;return newChild&&(editable.array[originIndex]=newChild),editable},removeAfter:function(ownerID,level,index){if(index===level?1<<level:0===this.array.length)return this;var sizeIndex=index-1>>>level&MASK;if(sizeIndex>=this.array.length)return this;var newChild,removingLast=sizeIndex===this.array.length-1;if(level>0){var oldChild=this.array[sizeIndex];if(newChild=oldChild&&oldChild.removeAfter(ownerID,level-SHIFT,index),newChild===oldChild&&removingLast)return this}if(removingLast&&!newChild)return this;var editable=editableVNode(this,ownerID);return removingLast||editable.array.pop(),newChild&&(editable.array[sizeIndex]=newChild),editable}},{});var EMPTY_LIST,DONE={},OrderedMap=function(value){return null===value||void 0===value?emptyOrderedMap():isOrderedMap(value)?value:emptyOrderedMap().withMutations(function(map){var iter=KeyedIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v,k){return map.set(k,v)})})};$traceurRuntime.createClass(OrderedMap,{toString:function(){return this.__toString("OrderedMap {","}")},get:function(k,notSetValue){var index=this._map.get(k);return void 0!==index?this._list.get(index)[1]:notSetValue},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._map.clear(),this._list.clear(),this):emptyOrderedMap()},set:function(k,v){return updateOrderedMap(this,k,v)},remove:function(k){return updateOrderedMap(this,k,NOT_SET)},wasAltered:function(){return this._map.wasAltered()||this._list.wasAltered()},__iterate:function(fn,reverse){var $__0=this;return this._list.__iterate(function(entry){return entry&&fn(entry[1],entry[0],$__0)},reverse)},__iterator:function(type,reverse){return this._list.fromEntrySeq().__iterator(type,reverse)},__ensureOwner:function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map.__ensureOwner(ownerID),newList=this._list.__ensureOwner(ownerID);return ownerID?makeOrderedMap(newMap,newList,ownerID,this.__hash):(this.__ownerID=ownerID,this._map=newMap,this._list=newList,this)}},{of:function(){return this(arguments)}},Map),OrderedMap.isOrderedMap=isOrderedMap,OrderedMap.prototype[IS_ORDERED_SENTINEL]=!0,OrderedMap.prototype[DELETE]=OrderedMap.prototype.remove;var EMPTY_ORDERED_MAP,Stack=function(value){return null===value||void 0===value?emptyStack():isStack(value)?value:emptyStack().unshiftAll(value)},$Stack=Stack;$traceurRuntime.createClass(Stack,{toString:function(){return this.__toString("Stack [","]")},get:function(index,notSetValue){for(var head=this._head;head&&index--;)head=head.next;return head?head.value:notSetValue},peek:function(){return this._head&&this._head.value},push:function(){if(0===arguments.length)return this;for(var newSize=this.size+arguments.length,head=this._head,ii=arguments.length-1;ii>=0;ii--)head={value:arguments[ii],next:head};return this.__ownerID?(this.size=newSize,this._head=head,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head)},pushAll:function(iter){if(iter=IndexedIterable(iter),0===iter.size)return this;assertNotInfinite(iter.size);var newSize=this.size,head=this._head;return iter.reverse().forEach(function(value){newSize++,head={value:value,next:head}}),this.__ownerID?(this.size=newSize,this._head=head,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head)},pop:function(){return this.slice(1)},unshift:function(){return this.push.apply(this,arguments)},unshiftAll:function(iter){return this.pushAll(iter)},shift:function(){return this.pop.apply(this,arguments)},clear:function(){return 0===this.size?this:this.__ownerID?(this.size=0,this._head=void 0,this.__hash=void 0,this.__altered=!0,this):emptyStack()},slice:function(begin,end){if(wholeSlice(begin,end,this.size))return this;var resolvedBegin=resolveBegin(begin,this.size),resolvedEnd=resolveEnd(end,this.size);if(resolvedEnd!==this.size)return $traceurRuntime.superCall(this,$Stack.prototype,"slice",[begin,end]);for(var newSize=this.size-resolvedBegin,head=this._head;resolvedBegin--;)head=head.next;return this.__ownerID?(this.size=newSize,this._head=head,this.__hash=void 0,this.__altered=!0,this):makeStack(newSize,head)},__ensureOwner:function(ownerID){return ownerID===this.__ownerID?this:ownerID?makeStack(this.size,this._head,ownerID,this.__hash):(this.__ownerID=ownerID,this.__altered=!1,this)},__iterate:function(fn,reverse){if(reverse)return this.toSeq().cacheResult.__iterate(fn,reverse);for(var iterations=0,node=this._head;node&&fn(node.value,iterations++,this)!==!1;)node=node.next;return iterations},__iterator:function(type,reverse){if(reverse)return this.toSeq().cacheResult().__iterator(type,reverse);var iterations=0,node=this._head;return new Iterator(function(){if(node){var value=node.value;return node=node.next,iteratorValue(type,iterations++,value)}return iteratorDone()})}},{of:function(){return this(arguments)}},IndexedCollection),Stack.isStack=isStack;var IS_STACK_SENTINEL="@@__IMMUTABLE_STACK__@@",StackPrototype=Stack.prototype;StackPrototype[IS_STACK_SENTINEL]=!0,StackPrototype.withMutations=MapPrototype.withMutations,StackPrototype.asMutable=MapPrototype.asMutable,StackPrototype.asImmutable=MapPrototype.asImmutable,StackPrototype.wasAltered=MapPrototype.wasAltered;var EMPTY_STACK,Set=function(value){return null===value||void 0===value?emptySet():isSet(value)?value:emptySet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v){return set.add(v)})})};$traceurRuntime.createClass(Set,{toString:function(){return this.__toString("Set {","}")},has:function(value){return this._map.has(value)},add:function(value){return updateSet(this,this._map.set(value,!0))},remove:function(value){return updateSet(this,this._map.remove(value))},clear:function(){return updateSet(this,this._map.clear())},union:function(){for(var iters=[],$__9=0;$__9<arguments.length;$__9++)iters[$__9]=arguments[$__9];return iters=iters.filter(function(x){return 0!==x.size}),0===iters.length?this:0===this.size&&1===iters.length?this.constructor(iters[0]):this.withMutations(function(set){for(var ii=0;ii<iters.length;ii++)SetIterable(iters[ii]).forEach(function(value){return set.add(value)})})},intersect:function(){for(var iters=[],$__10=0;$__10<arguments.length;$__10++)iters[$__10]=arguments[$__10];if(0===iters.length)return this;iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){iters.every(function(iter){return iter.contains(value)})||set.remove(value)})})},subtract:function(){for(var iters=[],$__11=0;$__11<arguments.length;$__11++)iters[$__11]=arguments[$__11];if(0===iters.length)return this;iters=iters.map(function(iter){return SetIterable(iter)});var originalSet=this;return this.withMutations(function(set){originalSet.forEach(function(value){iters.some(function(iter){return iter.contains(value)})&&set.remove(value)})})},merge:function(){return this.union.apply(this,arguments)},mergeWith:function(merger){for(var iters=[],$__12=1;$__12<arguments.length;$__12++)iters[$__12-1]=arguments[$__12];return this.union.apply(this,iters)},sort:function(comparator){return OrderedSet(sortFactory(this,comparator))},sortBy:function(mapper,comparator){return OrderedSet(sortFactory(this,comparator,mapper))},wasAltered:function(){return this._map.wasAltered()},__iterate:function(fn,reverse){var $__0=this;return this._map.__iterate(function(_,k){return fn(k,k,$__0)},reverse)},__iterator:function(type,reverse){return this._map.map(function(_,k){return k}).__iterator(type,reverse)},__ensureOwner:function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map.__ensureOwner(ownerID);return ownerID?this.__make(newMap,ownerID):(this.__ownerID=ownerID,this._map=newMap,this)}},{of:function(){return this(arguments)},fromKeys:function(value){return this(KeyedIterable(value).keySeq())}},SetCollection),Set.isSet=isSet;var IS_SET_SENTINEL="@@__IMMUTABLE_SET__@@",SetPrototype=Set.prototype;SetPrototype[IS_SET_SENTINEL]=!0,SetPrototype[DELETE]=SetPrototype.remove,SetPrototype.mergeDeep=SetPrototype.merge,SetPrototype.mergeDeepWith=SetPrototype.mergeWith,SetPrototype.withMutations=MapPrototype.withMutations,SetPrototype.asMutable=MapPrototype.asMutable,SetPrototype.asImmutable=MapPrototype.asImmutable,SetPrototype.__empty=emptySet,SetPrototype.__make=makeSet;var EMPTY_SET,OrderedSet=function(value){return null===value||void 0===value?emptyOrderedSet():isOrderedSet(value)?value:emptyOrderedSet().withMutations(function(set){var iter=SetIterable(value);assertNotInfinite(iter.size),iter.forEach(function(v){return set.add(v)})})};$traceurRuntime.createClass(OrderedSet,{toString:function(){return this.__toString("OrderedSet {","}")}},{of:function(){return this(arguments)},fromKeys:function(value){return this(KeyedIterable(value).keySeq())}},Set),OrderedSet.isOrderedSet=isOrderedSet;var OrderedSetPrototype=OrderedSet.prototype;OrderedSetPrototype[IS_ORDERED_SENTINEL]=!0,OrderedSetPrototype.__empty=emptyOrderedSet,OrderedSetPrototype.__make=makeOrderedSet;var EMPTY_ORDERED_SET,Record=function(defaultValues,name){var RecordType=function(values){return this instanceof RecordType?void(this._map=Map(values)):new RecordType(values)},keys=Object.keys(defaultValues),RecordTypePrototype=RecordType.prototype=Object.create(RecordPrototype);RecordTypePrototype.constructor=RecordType,name&&(RecordTypePrototype._name=name),RecordTypePrototype._defaultValues=defaultValues,RecordTypePrototype._keys=keys,RecordTypePrototype.size=keys.length;try{keys.forEach(function(key){Object.defineProperty(RecordType.prototype,key,{get:function(){return this.get(key)},set:function(value){invariant(this.__ownerID,"Cannot set on an immutable record."),this.set(key,value)}})})}catch(error){}return RecordType};$traceurRuntime.createClass(Record,{toString:function(){return this.__toString(recordName(this)+" {","}")},has:function(k){return this._defaultValues.hasOwnProperty(k)},get:function(k,notSetValue){if(!this.has(k))return notSetValue;var defaultVal=this._defaultValues[k];return this._map?this._map.get(k,defaultVal):defaultVal},clear:function(){if(this.__ownerID)return this._map&&this._map.clear(),this;var SuperRecord=Object.getPrototypeOf(this).constructor;return SuperRecord._empty||(SuperRecord._empty=makeRecord(this,emptyMap()))},set:function(k,v){if(!this.has(k))throw new Error('Cannot set unknown key "'+k+'" on '+recordName(this));var newMap=this._map&&this._map.set(k,v);return this.__ownerID||newMap===this._map?this:makeRecord(this,newMap)},remove:function(k){if(!this.has(k))return this;var newMap=this._map&&this._map.remove(k);return this.__ownerID||newMap===this._map?this:makeRecord(this,newMap)},wasAltered:function(){return this._map.wasAltered()},__iterator:function(type,reverse){var $__0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return $__0.get(k)}).__iterator(type,reverse)},__iterate:function(fn,reverse){var $__0=this;return KeyedIterable(this._defaultValues).map(function(_,k){return $__0.get(k)}).__iterate(fn,reverse)},__ensureOwner:function(ownerID){if(ownerID===this.__ownerID)return this;var newMap=this._map&&this._map.__ensureOwner(ownerID);return ownerID?makeRecord(this,newMap,ownerID):(this.__ownerID=ownerID,this._map=newMap,this)}},{},KeyedCollection);var RecordPrototype=Record.prototype;RecordPrototype[DELETE]=RecordPrototype.remove,RecordPrototype.deleteIn=RecordPrototype.removeIn=MapPrototype.removeIn,RecordPrototype.merge=MapPrototype.merge,RecordPrototype.mergeWith=MapPrototype.mergeWith,RecordPrototype.mergeIn=MapPrototype.mergeIn,RecordPrototype.mergeDeep=MapPrototype.mergeDeep,RecordPrototype.mergeDeepWith=MapPrototype.mergeDeepWith,RecordPrototype.mergeDeepIn=MapPrototype.mergeDeepIn,RecordPrototype.setIn=MapPrototype.setIn,RecordPrototype.update=MapPrototype.update,RecordPrototype.updateIn=MapPrototype.updateIn,RecordPrototype.withMutations=MapPrototype.withMutations,RecordPrototype.asMutable=MapPrototype.asMutable,RecordPrototype.asImmutable=MapPrototype.asImmutable;var Range=function(start,end,step){return this instanceof $Range?(invariant(0!==step,"Cannot step a Range by 0"),start=start||0,void 0===end&&(end=1/0),start===end&&__EMPTY_RANGE?__EMPTY_RANGE:(step=void 0===step?1:Math.abs(step),start>end&&(step=-step),this._start=start,this._end=end,this._step=step,void(this.size=Math.max(0,Math.ceil((end-start)/step-1)+1)))):new $Range(start,end,step)},$Range=Range;$traceurRuntime.createClass(Range,{toString:function(){return 0===this.size?"Range []":"Range [ "+this._start+"..."+this._end+(this._step>1?" by "+this._step:"")+" ]"},get:function(index,notSetValue){return this.has(index)?this._start+wrapIndex(this,index)*this._step:notSetValue},contains:function(searchValue){var possibleIndex=(searchValue-this._start)/this._step;return possibleIndex>=0&&possibleIndex<this.size&&possibleIndex===Math.floor(possibleIndex)},slice:function(begin,end){return wholeSlice(begin,end,this.size)?this:(begin=resolveBegin(begin,this.size),end=resolveEnd(end,this.size),begin>=end?__EMPTY_RANGE:new $Range(this.get(begin,this._end),this.get(end,this._end),this._step))},indexOf:function(searchValue){var offsetValue=searchValue-this._start;if(offsetValue%this._step===0){var index=offsetValue/this._step;if(index>=0&&index<this.size)return index}return-1},lastIndexOf:function(searchValue){return this.indexOf(searchValue)},take:function(amount){return this.slice(0,Math.max(0,amount))},skip:function(amount){return this.slice(Math.max(0,amount))},__iterate:function(fn,reverse){for(var maxIndex=this.size-1,step=this._step,value=reverse?this._start+maxIndex*step:this._start,ii=0;maxIndex>=ii;ii++){if(fn(value,ii,this)===!1)return ii+1;value+=reverse?-step:step}return ii},__iterator:function(type,reverse){var maxIndex=this.size-1,step=this._step,value=reverse?this._start+maxIndex*step:this._start,ii=0;return new Iterator(function(){var v=value;return value+=reverse?-step:step,ii>maxIndex?iteratorDone():iteratorValue(type,ii++,v)})},equals:function(other){return other instanceof $Range?this._start===other._start&&this._end===other._end&&this._step===other._step:deepEqual(this,other)}},{},IndexedSeq);var RangePrototype=Range.prototype;RangePrototype.__toJS=RangePrototype.toArray,RangePrototype.first=ListPrototype.first,RangePrototype.last=ListPrototype.last;var __EMPTY_RANGE=Range(0,0),Repeat=function(value,times){return 0>=times&&EMPTY_REPEAT?EMPTY_REPEAT:this instanceof $Repeat?(this._value=value,this.size=void 0===times?1/0:Math.max(0,times),void(0===this.size&&(EMPTY_REPEAT=this))):new $Repeat(value,times)},$Repeat=Repeat;$traceurRuntime.createClass(Repeat,{toString:function(){return 0===this.size?"Repeat []":"Repeat [ "+this._value+" "+this.size+" times ]"},get:function(index,notSetValue){return this.has(index)?this._value:notSetValue},contains:function(searchValue){return is(this._value,searchValue)},slice:function(begin,end){var size=this.size;return wholeSlice(begin,end,size)?this:new $Repeat(this._value,resolveEnd(end,size)-resolveBegin(begin,size))},reverse:function(){return this},indexOf:function(searchValue){return is(this._value,searchValue)?0:-1},lastIndexOf:function(searchValue){return is(this._value,searchValue)?this.size:-1},__iterate:function(fn,reverse){for(var ii=0;ii<this.size;ii++)if(fn(this._value,ii,this)===!1)return ii+1;return ii},__iterator:function(type,reverse){var $__0=this,ii=0;return new Iterator(function(){return ii<$__0.size?iteratorValue(type,ii++,$__0._value):iteratorDone()})},equals:function(other){return other instanceof $Repeat?is(this._value,other._value):deepEqual(other)}},{},IndexedSeq);var RepeatPrototype=Repeat.prototype;RepeatPrototype.last=RepeatPrototype.first,RepeatPrototype.has=RangePrototype.has,RepeatPrototype.take=RangePrototype.take,RepeatPrototype.skip=RangePrototype.skip,RepeatPrototype.__toJS=RangePrototype.__toJS;var EMPTY_REPEAT,Immutable={Iterable:Iterable,Seq:Seq,Collection:Collection,Map:Map,OrderedMap:OrderedMap,List:List,Stack:Stack,Set:Set,OrderedSet:OrderedSet,Record:Record,Range:Range,Repeat:Repeat,is:is,fromJS:fromJS};return Immutable}module.exports=universalModule()},function(module,exports,__webpack_require__){"use strict";var _createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_extends=__webpack_require__(22)["default"],_slicedToArray=__webpack_require__(28)["default"],_getIterator=__webpack_require__(29)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_fusibleDefaultsText_tags=__webpack_require__(47),_fusibleDefaultsText_tags2=_interopRequireDefault(_fusibleDefaultsText_tags),_fusibleDefaultsText_blocks=__webpack_require__(53),_fusibleDefaultsText_blocks2=_interopRequireDefault(_fusibleDefaultsText_blocks),_fusibleUtilHelpers=__webpack_require__(54),Config=function(){function Config(){_classCallCheck(this,Config),this.textTags={},this.textBlocks={},this.customTags={},this.customBlocks={},this.customActions={},this.renderMode=Config.RENDER_MODES.VIEWING,this.allowBlockMutation=!0,this.startingEmptyPlaceholder=null,this.defaultTextBlockType=null,this.importableBlockTagNames=new _immutable.List,this.nestedElementParentTagNames=new _immutable.List,this.textTagOrder=new _immutable.List,this.textTagsWrappingCustomTags=new _immutable.List}return _createClass(Config,null,[{key:"RENDER_MODES",value:{EDITING:"edit",VIEWING:"view"},enumerable:!0},{key:"defaultTextTags",value:_fusibleDefaultsText_tags2["default"],enumerable:!0},{key:"defaultTextBlocks",value:_fusibleDefaultsText_blocks2["default"],enumerable:!0}]),_createClass(Config,[{key:"clone",value:function(){var newConfig=new Config,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_getIterator(_fusibleUtilHelpers.entries(this.properties()));!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),key=_step$value[0],value=_step$value[1];if(_lodash2["default"].isObject(value)){newConfig[key]={};var _iteratorNormalCompletion2=!0,_didIteratorError2=!1,_iteratorError2=void 0;try{for(var _step2,_iterator2=_getIterator(_fusibleUtilHelpers.entries(value));!(_iteratorNormalCompletion2=(_step2=_iterator2.next()).done);_iteratorNormalCompletion2=!0){var _step2$value=_slicedToArray(_step2.value,2),subkey=_step2$value[0],subvalue=_step2$value[1];newConfig[key][subkey]=_lodash2["default"].clone(subvalue)}}catch(err){_didIteratorError2=!0,_iteratorError2=err}finally{try{!_iteratorNormalCompletion2&&_iterator2["return"]&&_iterator2["return"]()}finally{if(_didIteratorError2)throw _iteratorError2}}}else newConfig[key]=_lodash2["default"].clone(value)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return newConfig.cacheCalculatedValues(),newConfig}},{key:"properties",value:function(){return _lodash2["default"].pick(this,function(value,_key){return!_lodash2["default"].isFunction(value)})}},{key:"registerTextTag",value:function(name,options){this.textTags[name]=_extends({name:name},options),this.cacheCalculatedValues()}},{key:"registerCustomTag",value:function(name,options){this.customTags[name]=_extends({name:name},options),this.cacheCalculatedValues()}},{key:"registerTextBlock",value:function(name,options){this.textBlocks[name]=_extends({name:name},options),this.cacheCalculatedValues()}},{key:"registerCustomBlock",value:function(name,options){this.customBlocks[name]=_extends({name:name},options),this.cacheCalculatedValues()}},{key:"registerCustomAction",value:function(name,options){this.customActions[name]=_extends({name:name},options),this.cacheCalculatedValues()}},{key:"cacheCalculatedValues",value:function(){this.calculateDefaultTextBlockType(),this.calculateImportableBlockTagNames(),this.calculateNestedElementParentTagNames(),this.calculateTextTagOrder(),this.calculateTextTagsWrappingCustomTags()}},{key:"calculateDefaultTextBlockType",value:function(){this.defaultTextBlockType=_lodash2["default"].keys(_lodash2["default"].pick(this.textBlocks,function(value,_key){return value["default"]}))[0]}},{key:"calculateImportableBlockTagNames",value:function(){this.importableBlockTagNames=_immutable2["default"].fromJS(this.textBlocks).reduce(function(list,blockConfig){var tagsToImport=blockConfig.get("tagsToImport",new _immutable.List).map(function(importableTagName){return importableTagName.toUpperCase()});return list.concat(tagsToImport)},new _immutable.List)}},{key:"calculateNestedElementParentTagNames",value:function(){this.nestedElementParentTagNames=_immutable2["default"].fromJS(this.textBlocks).filter(function(blockConfig){return null!=blockConfig.get("sharedParentElement")}).map(function(blockConfig){return blockConfig.get("sharedParentElement").toUpperCase()}).toSetSeq().toList()}},{key:"calculateTextTagOrder",value:function(){var textTags=_immutable2["default"].fromJS(this.textTags),orderedTagTypes=_fusibleUtilHelpers.alphabetize(_lodash2["default"].uniq(textTags.map(function(textTag){return textTag.get("name")}).toArray()));this.textTagOrder=textTags.sortBy(function(tagConfig){var canWrapCustomTags=tagConfig.get("wrapsCustomTags")?0:1e6,hasAttributesValue=tagConfig.get("hasAttributes")?0:1e4;return canWrapCustomTags+hasAttributesValue+_lodash2["default"].indexOf(orderedTagTypes,tagConfig.get("name"))}).map(function(tagConfig){return tagConfig.get("name")}).toSetSeq().toList()}},{key:"calculateTextTagsWrappingCustomTags",value:function(){var textTags=_immutable2["default"].fromJS(this.textTags);this.textTagsWrappingCustomTags=textTags.filter(function(tagConfig){return tagConfig.get("wrapsCustomTags")}).map(function(tagConfig){return tagConfig.get("name")}).toSetSeq().toList()}}],[{key:"default",value:function(){var config=_lodash2["default"].reduce(this.defaultTextTags,this.addConfig.bind(this,"textTags"),new Config);return config=_lodash2["default"].reduce(this.defaultTextBlocks,this.addConfig.bind(this,"textBlocks"),config),config.cacheCalculatedValues(),config}},{key:"addConfig",value:function(field,config,tagDefinition){return config=config.clone(),config[field][tagDefinition.name]=tagDefinition,config}}]),Config}();exports["default"]=Config,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _Object$assign=__webpack_require__(23)["default"];exports["default"]=_Object$assign||function(target){for(var i=1;i<arguments.length;i++){var source=arguments[i];for(var key in source)Object.prototype.hasOwnProperty.call(source,key)&&(target[key]=source[key])}return target},exports.__esModule=!0},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(24),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(25),module.exports=__webpack_require__(4).core.Object.assign},function(module,exports,__webpack_require__){var $def=__webpack_require__(7);$def($def.S,"Object",{assign:__webpack_require__(26)})},function(module,exports,__webpack_require__){var $=__webpack_require__(4),enumKeys=__webpack_require__(27);module.exports=Object.assign||function(target,source){for(var T=Object($.assertDefined(target)),l=arguments.length,i=1;l>i;)for(var key,S=$.ES5Object(arguments[i++]),keys=enumKeys(S),length=keys.length,j=0;length>j;)T[key=keys[j++]]=S[key];return T}},function(module,exports,__webpack_require__){var $=__webpack_require__(4);module.exports=function(it){var keys=$.getKeys(it),getDesc=$.getDesc,getSymbols=$.getSymbols;return getSymbols&&$.each.call(getSymbols(it),function(key){getDesc(it,key).enumerable&&keys.push(key)}),keys}},function(module,exports,__webpack_require__){"use strict";var _getIterator=__webpack_require__(29)["default"],_isIterable=__webpack_require__(45)["default"];exports["default"]=function(){function sliceIterator(arr,i){var _arr=[],_n=!0,_d=!1,_e=void 0;try{for(var _s,_i=_getIterator(arr);!(_n=(_s=_i.next()).done)&&(_arr.push(_s.value),!i||_arr.length!==i);_n=!0);}catch(err){_d=!0,_e=err}finally{try{!_n&&_i["return"]&&_i["return"]()}finally{if(_d)throw _e}}return _arr}return function(arr,i){if(Array.isArray(arr))return arr;
if(_isIterable(Object(arr)))return sliceIterator(arr,i);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),exports.__esModule=!0},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(30),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(31),__webpack_require__(42),__webpack_require__(44),module.exports=__webpack_require__(4).core.getIterator},function(module,exports,__webpack_require__){__webpack_require__(32);var $=__webpack_require__(4),Iterators=__webpack_require__(35).Iterators,ITERATOR=__webpack_require__(37)("iterator"),ArrayValues=Iterators.Array,NL=$.g.NodeList,HTC=$.g.HTMLCollection,NLProto=NL&&NL.prototype,HTCProto=HTC&&HTC.prototype;$.FW&&(!NL||ITERATOR in NLProto||$.hide(NLProto,ITERATOR,ArrayValues),!HTC||ITERATOR in HTCProto||$.hide(HTCProto,ITERATOR,ArrayValues)),Iterators.NodeList=Iterators.HTMLCollection=ArrayValues},function(module,exports,__webpack_require__){var $=__webpack_require__(4),setUnscope=__webpack_require__(33),ITER=__webpack_require__(34).safe("iter"),$iter=__webpack_require__(35),step=$iter.step,Iterators=$iter.Iterators;__webpack_require__(40)(Array,"Array",function(iterated,kind){$.set(this,ITER,{o:$.toObject(iterated),i:0,k:kind})},function(){var iter=this[ITER],O=iter.o,kind=iter.k,index=iter.i++;return!O||index>=O.length?(iter.o=void 0,step(1)):"keys"==kind?step(0,index):"values"==kind?step(0,O[index]):step(0,[index,O[index]])},"values"),Iterators.Arguments=Iterators.Array,setUnscope("keys"),setUnscope("values"),setUnscope("entries")},function(module,exports){module.exports=function(){}},function(module,exports,__webpack_require__){function uid(key){return"Symbol(".concat(void 0===key?"":key,")_",(++sid+Math.random()).toString(36))}var sid=0;uid.safe=__webpack_require__(4).g.Symbol||uid,module.exports=uid},function(module,exports,__webpack_require__){"use strict";function setIterator(O,value){$.hide(O,SYMBOL_ITERATOR,value),FF_ITERATOR in[]&&$.hide(O,FF_ITERATOR,value)}var $=__webpack_require__(4),cof=__webpack_require__(36),classof=cof.classof,assert=__webpack_require__(39),assertObject=assert.obj,SYMBOL_ITERATOR=__webpack_require__(37)("iterator"),FF_ITERATOR="@@iterator",Iterators=__webpack_require__(38)("iterators"),IteratorPrototype={};setIterator(IteratorPrototype,$.that),module.exports={BUGGY:"keys"in[]&&!("next"in[].keys()),Iterators:Iterators,step:function(done,value){return{value:value,done:!!done}},is:function(it){var O=Object(it),Symbol=$.g.Symbol;return(Symbol&&Symbol.iterator||FF_ITERATOR)in O||SYMBOL_ITERATOR in O||$.has(Iterators,classof(O))},get:function(it){var getIter,Symbol=$.g.Symbol;return void 0!=it&&(getIter=it[Symbol&&Symbol.iterator||FF_ITERATOR]||it[SYMBOL_ITERATOR]||Iterators[classof(it)]),assert($.isFunction(getIter),it," is not iterable!"),assertObject(getIter.call(it))},set:setIterator,create:function(Constructor,NAME,next,proto){Constructor.prototype=$.create(proto||IteratorPrototype,{next:$.desc(1,next)}),cof.set(Constructor,NAME+" Iterator")}}},function(module,exports,__webpack_require__){function cof(it){return toString.call(it).slice(8,-1)}var $=__webpack_require__(4),TAG=__webpack_require__(37)("toStringTag"),toString={}.toString;cof.classof=function(it){var O,T;return void 0==it?void 0===it?"Undefined":"Null":"string"==typeof(T=(O=Object(it))[TAG])?T:cof(O)},cof.set=function(it,tag,stat){it&&!$.has(it=stat?it:it.prototype,TAG)&&$.hide(it,TAG,tag)},module.exports=cof},function(module,exports,__webpack_require__){var global=__webpack_require__(4).g,store=__webpack_require__(38)("wks");module.exports=function(name){return store[name]||(store[name]=global.Symbol&&global.Symbol[name]||__webpack_require__(34).safe("Symbol."+name))}},function(module,exports,__webpack_require__){var $=__webpack_require__(4),SHARED="__core-js_shared__",store=$.g[SHARED]||($.g[SHARED]={});module.exports=function(key){return store[key]||(store[key]={})}},function(module,exports,__webpack_require__){function assert(condition,msg1,msg2){if(!condition)throw TypeError(msg2?msg1+msg2:msg1)}var $=__webpack_require__(4);assert.def=$.assertDefined,assert.fn=function(it){if(!$.isFunction(it))throw TypeError(it+" is not a function!");return it},assert.obj=function(it){if(!$.isObject(it))throw TypeError(it+" is not an object!");return it},assert.inst=function(it,Constructor,name){if(!(it instanceof Constructor))throw TypeError(name+": use the 'new' operator!");return it},module.exports=assert},function(module,exports,__webpack_require__){var $def=__webpack_require__(7),$redef=__webpack_require__(41),$=__webpack_require__(4),cof=__webpack_require__(36),$iter=__webpack_require__(35),SYMBOL_ITERATOR=__webpack_require__(37)("iterator"),FF_ITERATOR="@@iterator",KEYS="keys",VALUES="values",Iterators=$iter.Iterators;module.exports=function(Base,NAME,Constructor,next,DEFAULT,IS_SET,FORCE){function createMethod(kind){function $$(that){return new Constructor(that,kind)}switch(kind){case KEYS:return function(){return $$(this)};case VALUES:return function(){return $$(this)}}return function(){return $$(this)}}$iter.create(Constructor,NAME,next);var methods,key,TAG=NAME+" Iterator",proto=Base.prototype,_native=proto[SYMBOL_ITERATOR]||proto[FF_ITERATOR]||DEFAULT&&proto[DEFAULT],_default=_native||createMethod(DEFAULT);if(_native){var IteratorPrototype=$.getProto(_default.call(new Base));cof.set(IteratorPrototype,TAG,!0),$.FW&&$.has(proto,FF_ITERATOR)&&$iter.set(IteratorPrototype,$.that)}if(($.FW||FORCE)&&$iter.set(proto,_default),Iterators[NAME]=_default,Iterators[TAG]=$.that,DEFAULT)if(methods={keys:IS_SET?_default:createMethod(KEYS),values:DEFAULT==VALUES?_default:createMethod(VALUES),entries:DEFAULT!=VALUES?_default:createMethod("entries")},FORCE)for(key in methods)key in proto||$redef(proto,key,methods[key]);else $def($def.P+$def.F*$iter.BUGGY,NAME,methods)}},function(module,exports,__webpack_require__){module.exports=__webpack_require__(4).hide},function(module,exports,__webpack_require__){var set=__webpack_require__(4).set,$at=__webpack_require__(43)(!0),ITER=__webpack_require__(34).safe("iter"),$iter=__webpack_require__(35),step=$iter.step;__webpack_require__(40)(String,"String",function(iterated){set(this,ITER,{o:String(iterated),i:0})},function(){var point,iter=this[ITER],O=iter.o,index=iter.i;return index>=O.length?step(1):(point=$at(O,index),iter.i+=point.length,step(0,point))})},function(module,exports,__webpack_require__){var $=__webpack_require__(4);module.exports=function(TO_STRING){return function(that,pos){var a,b,s=String($.assertDefined(that)),i=$.toInteger(pos),l=s.length;return 0>i||i>=l?TO_STRING?"":void 0:(a=s.charCodeAt(i),55296>a||a>56319||i+1===l||(b=s.charCodeAt(i+1))<56320||b>57343?TO_STRING?s.charAt(i):a:TO_STRING?s.slice(i,i+2):(a-55296<<10)+(b-56320)+65536)}}},function(module,exports,__webpack_require__){var core=__webpack_require__(4).core,$iter=__webpack_require__(35);core.isIterable=$iter.is,core.getIterator=$iter.get},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(46),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(31),__webpack_require__(42),__webpack_require__(44),module.exports=__webpack_require__(4).core.isIterable},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _styleIcons=__webpack_require__(48),_styleIcons2=_interopRequireDefault(_styleIcons);exports["default"]=[{name:"link",component:"a",tooltip:"Link",tagsToImport:["a"],incompatibleTags:[],iconClass:_styleIcons2["default"].link,wrapsCustomTags:!1,hasAttributes:!0},{name:"strong",component:"strong",keyCombo:"meta b",tooltip:"Bold",tagsToImport:["strong","b"],incompatibleTags:[],iconClass:_styleIcons2["default"].bold,wrapsCustomTags:!1,hasAttributes:!1},{name:"em",component:"em",keyCombo:"meta i",tooltip:"Italics",tagsToImport:["em","i"],incompatibleTags:[],iconClass:_styleIcons2["default"].italic,wrapsCustomTags:!1,hasAttributes:!1},{name:"underline",component:"u",keyCombo:"meta u",tooltip:"Underline",tagsToImport:["u"],incompatibleTags:["superscript","subscript"],iconClass:_styleIcons2["default"].underline,wrapsCustomTags:!1,hasAttributes:!1},{name:"superscript",component:"sup",tooltip:"Superscript",tagsToImport:["sup"],incompatibleTags:["subscript","underline"],iconClass:_styleIcons2["default"].superscript,wrapsCustomTags:!1,hasAttributes:!1},{name:"subscript",component:"sub",tooltip:"Subscript",tagsToImport:["sub"],incompatibleTags:["superscript","underline"],iconClass:_styleIcons2["default"].subscript,wrapsCustomTags:!1,hasAttributes:!1}],module.exports=exports["default"]},function(module,exports){module.exports={"arrow-down":"fusible__icons__arrow-down","arrow-down-filled":"fusible__icons__arrow-down-filled","arrow-up":"fusible__icons__arrow-up","arrow-up-filled":"fusible__icons__arrow-up-filled",blockquote:"fusible__icons__blockquote",bold:"fusible__icons__bold","bold-filled":"fusible__icons__bold-filled","delete":"fusible__icons__delete","delete-filled":"fusible__icons__delete-filled",edit:"fusible__icons__edit",embed:"fusible__icons__embed","embed-filled":"fusible__icons__embed-filled",h1:"fusible__icons__h1","h1-filled":"fusible__icons__h1-filled",h2:"fusible__icons__h2","h2-filled":"fusible__icons__h2-filled","insert-code":"fusible__icons__insert-code","insert-code-filled":"fusible__icons__insert-code-filled","insert-equation":"fusible__icons__insert-equation","insert-equation-filled":"fusible__icons__insert-equation-filled","insert-graph":"fusible__icons__insert-graph","insert-graph-filled":"fusible__icons__insert-graph-filled","insert-image":"fusible__icons__insert-image","insert-table":"fusible__icons__insert-table","insert-table-filled":"fusible__icons__insert-table-filled",italic:"fusible__icons__italic","italic-filled":"fusible__icons__italic-filled",keyterm:"fusible__icons__keyterm","keyterm-filled":"fusible__icons__keyterm-filled",link:"fusible__icons__link","link-filled":"fusible__icons__link-filled","list-bulleted":"fusible__icons__list-bulleted","list-bulleted-filled":"fusible__icons__list-bulleted-filled","list-numbered":"fusible__icons__list-numbered","list-numbered-filled":"fusible__icons__list-numbered-filled",plus:"fusible__icons__plus","plus-filled":"fusible__icons__plus-filled",subscript:"fusible__icons__subscript","subscript-filled":"fusible__icons__subscript-filled",superscript:"fusible__icons__superscript","superscript-filled":"fusible__icons__superscript-filled",underline:"fusible__icons__underline","underline-filled":"fusible__icons__underline-filled"}},,,,,function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _styleIcons=__webpack_require__(48),_styleIcons2=_interopRequireDefault(_styleIcons);exports["default"]=[{name:"h1",component:"h1",nextBlockType:"p",tooltip:"Header",tagsToImport:["h1"],iconClass:_styleIcons2["default"].h1,incompatibleTags:["strong"],sharedParentElement:null},{name:"h2",component:"h2",tooltip:"Subheader",nextBlockType:"p",tagsToImport:["h2","h3","h4","h5","h6"],iconClass:_styleIcons2["default"].h2,incompatibleTags:["strong"],sharedParentElement:null},{name:"p",component:"p",tooltip:"Paragraph",nextBlockType:"p",tagsToImport:["p"],incompatibleTags:[],sharedParentElement:null,"default":!0},{name:"blockquote",component:"blockquote",tooltip:"Blockquote",nextBlockType:"p",tagsToImport:["blockquote"],iconClass:_styleIcons2["default"].blockquote,incompatibleTags:[],sharedParentElement:null},{name:"ul_li",component:"li",tooltip:"Bulleted List",nextBlockType:"ul_li",tagsToImport:["li"],iconClass:_styleIcons2["default"]["list-bulleted"],incompatibleTags:[],sharedParentElement:"ul",resetKeyCombo:"shift tab"},{name:"ol_li",component:"li",tooltip:"Numbered List",nextBlockType:"ol_li",tagsToImport:["li"],iconClass:_styleIcons2["default"]["list-numbered"],incompatibleTags:[],sharedParentElement:"ol",resetKeyCombo:"shift tab"}],module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";function alphabetize(array){return array.sort(function(first,second){return first.toLowerCase()<second.toLowerCase()?-1:first.toLowerCase()>second.toLowerCase()?1:0})}function entries(obj){var _iteratorNormalCompletion,_didIteratorError,_iteratorError,_iterator,_step,key;return _regeneratorRuntime.wrap(function(context$1$0){for(;;)switch(context$1$0.prev=context$1$0.next){case 0:_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0,context$1$0.prev=3,_iterator=_getIterator(_Object$keys(obj));case 5:if(_iteratorNormalCompletion=(_step=_iterator.next()).done){context$1$0.next=12;break}return key=_step.value,context$1$0.next=9,[key,obj[key]];case 9:_iteratorNormalCompletion=!0,context$1$0.next=5;break;case 12:context$1$0.next=18;break;case 14:context$1$0.prev=14,context$1$0.t0=context$1$0["catch"](3),_didIteratorError=!0,_iteratorError=context$1$0.t0;case 18:context$1$0.prev=18,context$1$0.prev=19,!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]();case 21:if(context$1$0.prev=21,!_didIteratorError){context$1$0.next=24;break}throw _iteratorError;case 24:return context$1$0.finish(21);case 25:return context$1$0.finish(18);case 26:case"end":return context$1$0.stop()}},marked0$0[0],this,[[3,14,18,26],[19,,21,25]])}var _regeneratorRuntime=__webpack_require__(55)["default"],_getIterator=__webpack_require__(29)["default"],_Object$keys=__webpack_require__(79)["default"];Object.defineProperty(exports,"__esModule",{value:!0}),exports.alphabetize=alphabetize,exports.entries=entries;var marked0$0=[entries].map(_regeneratorRuntime.mark)},function(module,exports,__webpack_require__){(function(global){var g="object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:this,hadRuntime=g.regeneratorRuntime&&Object.getOwnPropertyNames(g).indexOf("regeneratorRuntime")>=0,oldRuntime=hadRuntime&&g.regeneratorRuntime;g.regeneratorRuntime=void 0,module.exports=__webpack_require__(56),hadRuntime?g.regeneratorRuntime=oldRuntime:delete g.regeneratorRuntime,module.exports={"default":module.exports,__esModule:!0}}).call(exports,function(){return this}())},function(module,exports,__webpack_require__){(function(global,process){"use strict";var _Symbol=__webpack_require__(58)["default"],_Symbol$iterator=__webpack_require__(62)["default"],_Object$create=__webpack_require__(10)["default"],_Promise=__webpack_require__(64)["default"];!function(global){function wrap(innerFn,outerFn,self,tryLocsList){var generator=_Object$create((outerFn||Generator).prototype);return generator._invoke=makeInvokeMethod(innerFn,self||null,new Context(tryLocsList||[])),generator}function tryCatch(fn,obj,arg){try{return{type:"normal",arg:fn.call(obj,arg)}}catch(err){return{type:"throw",arg:err}}}function Generator(){}function GeneratorFunction(){}function GeneratorFunctionPrototype(){}function defineIteratorMethods(prototype){["next","throw","return"].forEach(function(method){prototype[method]=function(arg){return this._invoke(method,arg)}})}function AwaitArgument(arg){this.arg=arg}function AsyncIterator(generator){function invoke(method,arg){var result=generator[method](arg),value=result.value;return value instanceof AwaitArgument?_Promise.resolve(value.arg).then(invokeNext,invokeThrow):_Promise.resolve(value).then(function(unwrapped){return result.value=unwrapped,result})}function enqueue(method,arg){var enqueueResult=previousPromise?previousPromise.then(function(){return invoke(method,arg)}):new _Promise(function(resolve){resolve(invoke(method,arg))});return previousPromise=enqueueResult["catch"](function(ignored){}),enqueueResult}"object"==typeof process&&process.domain&&(invoke=process.domain.bind(invoke));var previousPromise,invokeNext=invoke.bind(generator,"next"),invokeThrow=invoke.bind(generator,"throw");invoke.bind(generator,"return");this._invoke=enqueue}function makeInvokeMethod(innerFn,self,context){var state=GenStateSuspendedStart;return function(method,arg){if(state===GenStateExecuting)throw new Error("Generator is already running");if(state===GenStateCompleted){if("throw"===method)throw arg;return doneResult()}for(;;){var delegate=context.delegate;if(delegate){if("return"===method||"throw"===method&&delegate.iterator[method]===undefined){context.delegate=null;var returnMethod=delegate.iterator["return"];if(returnMethod){var record=tryCatch(returnMethod,delegate.iterator,arg);if("throw"===record.type){method="throw",arg=record.arg;continue}}if("return"===method)continue}var record=tryCatch(delegate.iterator[method],delegate.iterator,arg);if("throw"===record.type){context.delegate=null,method="throw",arg=record.arg;continue}method="next",arg=undefined;var info=record.arg;if(!info.done)return state=GenStateSuspendedYield,info;context[delegate.resultName]=info.value,context.next=delegate.nextLoc,context.delegate=null}if("next"===method)state===GenStateSuspendedYield?context.sent=arg:context.sent=undefined;else if("throw"===method){if(state===GenStateSuspendedStart)throw state=GenStateCompleted,arg;context.dispatchException(arg)&&(method="next",arg=undefined)}else"return"===method&&context.abrupt("return",arg);state=GenStateExecuting;var record=tryCatch(innerFn,self,context);if("normal"===record.type){state=context.done?GenStateCompleted:GenStateSuspendedYield;var info={value:record.arg,done:context.done};if(record.arg!==ContinueSentinel)return info;context.delegate&&"next"===method&&(arg=undefined)}else"throw"===record.type&&(state=GenStateCompleted,method="throw",arg=record.arg)}}}function pushTryEntry(locs){var entry={tryLoc:locs[0]};1 in locs&&(entry.catchLoc=locs[1]),2 in locs&&(entry.finallyLoc=locs[2],entry.afterLoc=locs[3]),this.tryEntries.push(entry)}function resetTryEntry(entry){var record=entry.completion||{};record.type="normal",delete record.arg,entry.completion=record}function Context(tryLocsList){this.tryEntries=[{tryLoc:"root"}],tryLocsList.forEach(pushTryEntry,this),this.reset(!0)}function values(iterable){if(iterable){var iteratorMethod=iterable[iteratorSymbol];if(iteratorMethod)return iteratorMethod.call(iterable);if("function"==typeof iterable.next)return iterable;if(!isNaN(iterable.length)){var i=-1,next=function next(){for(;++i<iterable.length;)if(hasOwn.call(iterable,i))return next.value=iterable[i],next.done=!1,next;return next.value=undefined,next.done=!0,next};return next.next=next}}return{next:doneResult}}function doneResult(){return{value:undefined,done:!0}}var undefined,hasOwn=Object.prototype.hasOwnProperty,iteratorSymbol="function"==typeof _Symbol&&_Symbol$iterator||"@@iterator",inModule="object"==typeof module,runtime=global.regeneratorRuntime;if(runtime)return void(inModule&&(module.exports=runtime));runtime=global.regeneratorRuntime=inModule?module.exports:{},runtime.wrap=wrap;var GenStateSuspendedStart="suspendedStart",GenStateSuspendedYield="suspendedYield",GenStateExecuting="executing",GenStateCompleted="completed",ContinueSentinel={},Gp=GeneratorFunctionPrototype.prototype=Generator.prototype;GeneratorFunction.prototype=Gp.constructor=GeneratorFunctionPrototype,GeneratorFunctionPrototype.constructor=GeneratorFunction,GeneratorFunction.displayName="GeneratorFunction",runtime.isGeneratorFunction=function(genFun){var ctor="function"==typeof genFun&&genFun.constructor;return ctor?ctor===GeneratorFunction||"GeneratorFunction"===(ctor.displayName||ctor.name):!1},runtime.mark=function(genFun){return genFun.__proto__=GeneratorFunctionPrototype,genFun.prototype=_Object$create(Gp),genFun},runtime.awrap=function(arg){return new AwaitArgument(arg)},defineIteratorMethods(AsyncIterator.prototype),runtime.async=function(innerFn,outerFn,self,tryLocsList){var iter=new AsyncIterator(wrap(innerFn,outerFn,self,tryLocsList));return runtime.isGeneratorFunction(outerFn)?iter:iter.next().then(function(result){return result.done?result.value:iter.next()})},defineIteratorMethods(Gp),Gp[iteratorSymbol]=function(){return this},Gp.toString=function(){return"[object Generator]"},runtime.keys=function(object){var keys=[];for(var key in object)keys.push(key);return keys.reverse(),function next(){for(;keys.length;){var key=keys.pop();if(key in object)return next.value=key,next.done=!1,next}return next.done=!0,next}},runtime.values=values,Context.prototype={constructor:Context,reset:function(skipTempReset){if(this.prev=0,this.next=0,this.sent=undefined,this.done=!1,this.delegate=null,this.tryEntries.forEach(resetTryEntry),!skipTempReset)for(var name in this)"t"===name.charAt(0)&&hasOwn.call(this,name)&&!isNaN(+name.slice(1))&&(this[name]=undefined)},stop:function(){this.done=!0;var rootEntry=this.tryEntries[0],rootRecord=rootEntry.completion;if("throw"===rootRecord.type)throw rootRecord.arg;return this.rval},dispatchException:function(exception){function handle(loc,caught){return record.type="throw",record.arg=exception,context.next=loc,!!caught}if(this.done)throw exception;for(var context=this,i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i],record=entry.completion;if("root"===entry.tryLoc)return handle("end");if(entry.tryLoc<=this.prev){var hasCatch=hasOwn.call(entry,"catchLoc"),hasFinally=hasOwn.call(entry,"finallyLoc");if(hasCatch&&hasFinally){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0);if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}else if(hasCatch){if(this.prev<entry.catchLoc)return handle(entry.catchLoc,!0)}else{if(!hasFinally)throw new Error("try statement without catch or finally");if(this.prev<entry.finallyLoc)return handle(entry.finallyLoc)}}}},abrupt:function(type,arg){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc<=this.prev&&hasOwn.call(entry,"finallyLoc")&&this.prev<entry.finallyLoc){var finallyEntry=entry;break}}finallyEntry&&("break"===type||"continue"===type)&&finallyEntry.tryLoc<=arg&&arg<=finallyEntry.finallyLoc&&(finallyEntry=null);var record=finallyEntry?finallyEntry.completion:{};return record.type=type,record.arg=arg,finallyEntry?this.next=finallyEntry.finallyLoc:this.complete(record),ContinueSentinel},complete:function(record,afterLoc){if("throw"===record.type)throw record.arg;"break"===record.type||"continue"===record.type?this.next=record.arg:"return"===record.type?(this.rval=record.arg,this.next="end"):"normal"===record.type&&afterLoc&&(this.next=afterLoc)},finish:function(finallyLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.finallyLoc===finallyLoc)return this.complete(entry.completion,entry.afterLoc),resetTryEntry(entry),ContinueSentinel}},"catch":function(tryLoc){for(var i=this.tryEntries.length-1;i>=0;--i){var entry=this.tryEntries[i];if(entry.tryLoc===tryLoc){var record=entry.completion;if("throw"===record.type){var thrown=record.arg;resetTryEntry(entry)}return thrown}}throw new Error("illegal catch attempt")},delegateYield:function(iterable,resultName,nextLoc){return this.delegate={iterator:values(iterable),resultName:resultName,nextLoc:nextLoc},ContinueSentinel}}}("object"==typeof global?global:"object"==typeof window?window:"object"==typeof self?self:void 0)}).call(exports,function(){return this}(),__webpack_require__(57))},function(module,exports){function cleanUpNextTick(){draining&&currentQueue&&(draining=!1,currentQueue.length?queue=currentQueue.concat(queue):queueIndex=-1,queue.length&&drainQueue())}function drainQueue(){if(!draining){var timeout=cachedSetTimeout(cleanUpNextTick);draining=!0;for(var len=queue.length;len;){for(currentQueue=queue,queue=[];++queueIndex<len;)currentQueue&&currentQueue[queueIndex].run();queueIndex=-1,len=queue.length}currentQueue=null,draining=!1,cachedClearTimeout(timeout)}}function Item(fun,array){this.fun=fun,this.array=array}function noop(){}var cachedSetTimeout,cachedClearTimeout,process=module.exports={};!function(){try{cachedSetTimeout=setTimeout}catch(e){cachedSetTimeout=function(){throw new Error("setTimeout is not defined")}}try{cachedClearTimeout=clearTimeout}catch(e){cachedClearTimeout=function(){throw new Error("clearTimeout is not defined")}}}();var currentQueue,queue=[],draining=!1,queueIndex=-1;process.nextTick=function(fun){var args=new Array(arguments.length-1);if(arguments.length>1)for(var i=1;i<arguments.length;i++)args[i-1]=arguments[i];queue.push(new Item(fun,args)),1!==queue.length||draining||cachedSetTimeout(drainQueue,0)},Item.prototype.run=function(){this.fun.apply(null,this.array)},process.title="browser",process.browser=!0,process.env={},process.argv=[],process.version="",process.versions={},process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")},process.umask=function(){return 0}},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(59),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(60),module.exports=__webpack_require__(4).core.Symbol},function(module,exports,__webpack_require__){"use strict";function wrap(tag){var sym=AllSymbols[tag]=$.set($create($Symbol.prototype),TAG,tag);return DESC&&setter&&setSymbolDesc(ObjectProto,tag,{configurable:!0,set:function(value){has(this,HIDDEN)&&has(this[HIDDEN],tag)&&(this[HIDDEN][tag]=!1),setSymbolDesc(this,tag,desc(1,value))}}),sym}function defineProperty(it,key,D){return D&&has(AllSymbols,key)?(D.enumerable?(has(it,HIDDEN)&&it[HIDDEN][key]&&(it[HIDDEN][key]=!1),D=$create(D,{enumerable:desc(0,!1)})):(has(it,HIDDEN)||setDesc(it,HIDDEN,desc(1,{})),it[HIDDEN][key]=!0),setSymbolDesc(it,key,D)):setDesc(it,key,D)}function defineProperties(it,P){assertObject(it);for(var key,keys=enumKeys(P=toObject(P)),i=0,l=keys.length;l>i;)defineProperty(it,key=keys[i++],P[key]);return it}function create(it,P){return void 0===P?$create(it):defineProperties($create(it),P)}function propertyIsEnumerable(key){var E=_propertyIsEnumerable.call(this,key);return E||!has(this,key)||!has(AllSymbols,key)||has(this,HIDDEN)&&this[HIDDEN][key]?E:!0}function getOwnPropertyDescriptor(it,key){var D=getDesc(it=toObject(it),key);return!D||!has(AllSymbols,key)||has(it,HIDDEN)&&it[HIDDEN][key]||(D.enumerable=!0),D}function getOwnPropertyNames(it){for(var key,names=getNames(toObject(it)),result=[],i=0;names.length>i;)has(AllSymbols,key=names[i++])||key==HIDDEN||result.push(key);return result}function getOwnPropertySymbols(it){for(var key,names=getNames(toObject(it)),result=[],i=0;names.length>i;)has(AllSymbols,key=names[i++])&&result.push(AllSymbols[key]);return result}var $=__webpack_require__(4),setTag=__webpack_require__(36).set,uid=__webpack_require__(34),shared=__webpack_require__(38),$def=__webpack_require__(7),$redef=__webpack_require__(41),keyOf=__webpack_require__(61),enumKeys=__webpack_require__(27),assertObject=__webpack_require__(39).obj,ObjectProto=Object.prototype,DESC=$.DESC,has=$.has,$create=$.create,getDesc=$.getDesc,setDesc=$.setDesc,desc=$.desc,$names=__webpack_require__(8),getNames=$names.get,toObject=$.toObject,$Symbol=$.g.Symbol,setter=!1,TAG=uid("tag"),HIDDEN=uid("hidden"),_propertyIsEnumerable={}.propertyIsEnumerable,SymbolRegistry=shared("symbol-registry"),AllSymbols=shared("symbols"),useNative=$.isFunction($Symbol),setSymbolDesc=DESC?function(){try{return $create(setDesc({},HIDDEN,{get:function(){return setDesc(this,HIDDEN,{value:!1})[HIDDEN]}}))[HIDDEN]||setDesc}catch(e){return function(it,key,D){var protoDesc=getDesc(ObjectProto,key);protoDesc&&delete ObjectProto[key],setDesc(it,key,D),protoDesc&&it!==ObjectProto&&setDesc(ObjectProto,key,protoDesc)}}}():setDesc;useNative||($Symbol=function(){if(this instanceof $Symbol)throw TypeError("Symbol is not a constructor");return wrap(uid(arguments[0]))},$redef($Symbol.prototype,"toString",function(){return this[TAG]}),$.create=create,$.setDesc=defineProperty,$.getDesc=getOwnPropertyDescriptor,$.setDescs=defineProperties,$.getNames=$names.get=getOwnPropertyNames,$.getSymbols=getOwnPropertySymbols,$.DESC&&$.FW&&$redef(ObjectProto,"propertyIsEnumerable",propertyIsEnumerable,!0));var symbolStatics={"for":function(key){return has(SymbolRegistry,key+="")?SymbolRegistry[key]:SymbolRegistry[key]=$Symbol(key)},keyFor:function(key){return keyOf(SymbolRegistry,key)},useSetter:function(){setter=!0},useSimple:function(){setter=!1}};$.each.call("hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),function(it){var sym=__webpack_require__(37)(it);symbolStatics[it]=useNative?sym:wrap(sym)}),setter=!0,$def($def.G+$def.W,{Symbol:$Symbol}),$def($def.S,"Symbol",symbolStatics),$def($def.S+$def.F*!useNative,"Object",{create:create,defineProperty:defineProperty,defineProperties:defineProperties,getOwnPropertyDescriptor:getOwnPropertyDescriptor,getOwnPropertyNames:getOwnPropertyNames,getOwnPropertySymbols:getOwnPropertySymbols}),setTag($Symbol,"Symbol"),setTag(Math,"Math",!0),setTag($.g.JSON,"JSON",!0)},function(module,exports,__webpack_require__){var $=__webpack_require__(4);module.exports=function(object,el){for(var key,O=$.toObject(object),keys=$.getKeys(O),length=keys.length,index=0;length>index;)if(O[key=keys[index++]]===el)return key}},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(63),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(42),__webpack_require__(31),module.exports=__webpack_require__(37)("iterator")},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(65),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(66),__webpack_require__(42),__webpack_require__(31),__webpack_require__(67),module.exports=__webpack_require__(4).core.Promise},function(module,exports,__webpack_require__){"use strict";var cof=__webpack_require__(36),tmp={};tmp[__webpack_require__(37)("toStringTag")]="z",__webpack_require__(4).FW&&"z"!=cof(tmp)&&__webpack_require__(41)(Object.prototype,"toString",function(){return"[object "+cof.classof(this)+"]"},!0)},function(module,exports,__webpack_require__){"use strict";function testResolve(sub){var test=new P(function(){});return sub&&(test.constructor=Object),P.resolve(test)===test}function isPromise(it){return isObject(it)&&(useNative?"Promise"==cof.classof(it):RECORD in it)}function sameConstructor(a,b){return $.FW||a!==P||b!==Wrapper?same(a,b):!0}function getConstructor(C){var S=assertObject(C)[SPECIES];return void 0!=S?S:C}function isThenable(it){var then;return isObject(it)&&(then=it.then),isFunction(then)?then:!1}function notify(record){var chain=record.c;chain.length&&asap.call(global,function(){function run(react){var ret,then,cb=ok?react.ok:react.fail;try{cb?(ok||(record.h=!0),ret=cb===!0?value:cb(value),ret===react.P?react.rej(TypeError("Promise-chain cycle")):(then=isThenable(ret))?then.call(ret,react.res,react.rej):react.res(ret)):react.rej(value)}catch(err){react.rej(err)}}for(var value=record.v,ok=1==record.s,i=0;chain.length>i;)run(chain[i++]);chain.length=0})}function isUnhandled(promise){var react,record=promise[RECORD],chain=record.a||record.c,i=0;if(record.h)return!1;for(;chain.length>i;)if(react=chain[i++],react.fail||!isUnhandled(react.P))return!1;return!0}function $reject(value){var promise,record=this;record.d||(record.d=!0,record=record.r||record,record.v=value,record.s=2,record.a=record.c.slice(),setTimeout(function(){asap.call(global,function(){isUnhandled(promise=record.p)&&(isNode?process.emit("unhandledRejection",value,promise):global.console&&console.error&&console.error("Unhandled promise rejection",value)),record.a=void 0})},1),notify(record))}function $resolve(value){var then,record=this;if(!record.d){record.d=!0,record=record.r||record;try{(then=isThenable(value))?asap.call(global,function(){var wrapper={r:record,d:!1};try{then.call(value,ctx($resolve,wrapper,1),ctx($reject,wrapper,1))}catch(e){$reject.call(wrapper,e)}}):(record.v=value,record.s=1,notify(record))}catch(e){$reject.call({r:record,d:!1},e)}}}var Wrapper,$=__webpack_require__(4),ctx=__webpack_require__(68),cof=__webpack_require__(36),$def=__webpack_require__(7),assert=__webpack_require__(39),forOf=__webpack_require__(69),setProto=__webpack_require__(71).set,same=__webpack_require__(72),species=__webpack_require__(73),SPECIES=__webpack_require__(37)("species"),RECORD=__webpack_require__(34).safe("record"),PROMISE="Promise",global=$.g,process=global.process,isNode="process"==cof(process),asap=process&&process.nextTick||__webpack_require__(74).set,P=global[PROMISE],isFunction=$.isFunction,isObject=$.isObject,assertFunction=assert.fn,assertObject=assert.obj,useNative=function(){
function P2(x){var self=new P(x);return setProto(self,P2.prototype),self}var works=!1;try{if(works=isFunction(P)&&isFunction(P.resolve)&&testResolve(),setProto(P2,P),P2.prototype=$.create(P.prototype,{constructor:{value:P2}}),P2.resolve(5).then(function(){})instanceof P2||(works=!1),works&&$.DESC){var thenableThenGotten=!1;P.resolve($.setDesc({},"then",{get:function(){thenableThenGotten=!0}})),works=thenableThenGotten}}catch(e){works=!1}return works}();useNative||(P=function(executor){assertFunction(executor);var record={p:assert.inst(this,P,PROMISE),c:[],a:void 0,s:0,d:!1,v:void 0,h:!1};$.hide(this,RECORD,record);try{executor(ctx($resolve,record,1),ctx($reject,record,1))}catch(err){$reject.call(record,err)}},__webpack_require__(77)(P.prototype,{then:function(onFulfilled,onRejected){var S=assertObject(assertObject(this).constructor)[SPECIES],react={ok:isFunction(onFulfilled)?onFulfilled:!0,fail:isFunction(onRejected)?onRejected:!1},promise=react.P=new(void 0!=S?S:P)(function(res,rej){react.res=assertFunction(res),react.rej=assertFunction(rej)}),record=this[RECORD];return record.c.push(react),record.a&&record.a.push(react),record.s&&notify(record),promise},"catch":function(onRejected){return this.then(void 0,onRejected)}})),$def($def.G+$def.W+$def.F*!useNative,{Promise:P}),cof.set(P,PROMISE),species(P),species(Wrapper=$.core[PROMISE]),$def($def.S+$def.F*!useNative,PROMISE,{reject:function(r){return new(getConstructor(this))(function(res,rej){rej(r)})}}),$def($def.S+$def.F*(!useNative||testResolve(!0)),PROMISE,{resolve:function(x){return isPromise(x)&&sameConstructor(x.constructor,this)?x:new this(function(res){res(x)})}}),$def($def.S+$def.F*!(useNative&&__webpack_require__(78)(function(iter){P.all(iter)["catch"](function(){})})),PROMISE,{all:function(iterable){var C=getConstructor(this),values=[];return new C(function(res,rej){forOf(iterable,!1,values.push,values);var remaining=values.length,results=Array(remaining);remaining?$.each.call(values,function(promise,index){C.resolve(promise).then(function(value){results[index]=value,--remaining||res(results)},rej)}):res(results)})},race:function(iterable){var C=getConstructor(this);return new C(function(res,rej){forOf(iterable,!1,function(promise){C.resolve(promise).then(res,rej)})})}})},function(module,exports,__webpack_require__){var assertFunction=__webpack_require__(39).fn;module.exports=function(fn,that,length){if(assertFunction(fn),~length&&void 0===that)return fn;switch(length){case 1:return function(a){return fn.call(that,a)};case 2:return function(a,b){return fn.call(that,a,b)};case 3:return function(a,b,c){return fn.call(that,a,b,c)}}return function(){return fn.apply(that,arguments)}}},function(module,exports,__webpack_require__){var ctx=__webpack_require__(68),get=__webpack_require__(35).get,call=__webpack_require__(70);module.exports=function(iterable,entries,fn,that){for(var step,iterator=get(iterable),f=ctx(fn,that,entries?2:1);!(step=iterator.next()).done;)if(call(iterator,f,step.value,entries)===!1)return call.close(iterator)}},function(module,exports,__webpack_require__){function close(iterator){var ret=iterator["return"];void 0!==ret&&assertObject(ret.call(iterator))}function call(iterator,fn,value,entries){try{return entries?fn(assertObject(value)[0],value[1]):fn(value)}catch(e){throw close(iterator),e}}var assertObject=__webpack_require__(39).obj;call.close=close,module.exports=call},function(module,exports,__webpack_require__){function check(O,proto){assert.obj(O),assert(null===proto||$.isObject(proto),proto,": can't set as prototype!")}var $=__webpack_require__(4),assert=__webpack_require__(39);module.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(buggy,set){try{set=__webpack_require__(68)(Function.call,$.getDesc(Object.prototype,"__proto__").set,2),set({},[])}catch(e){buggy=!0}return function(O,proto){return check(O,proto),buggy?O.__proto__=proto:set(O,proto),O}}():void 0),check:check}},function(module,exports){module.exports=Object.is||function(x,y){return x===y?0!==x||1/x===1/y:x!=x&&y!=y}},function(module,exports,__webpack_require__){var $=__webpack_require__(4),SPECIES=__webpack_require__(37)("species");module.exports=function(C){!$.DESC||SPECIES in C||$.setDesc(C,SPECIES,{configurable:!0,get:$.that})}},function(module,exports,__webpack_require__){"use strict";function run(){var id=+this;if($.has(queue,id)){var fn=queue[id];delete queue[id],fn()}}function listner(event){run.call(event.data)}var defer,channel,port,$=__webpack_require__(4),ctx=__webpack_require__(68),cof=__webpack_require__(36),invoke=__webpack_require__(75),cel=__webpack_require__(76),global=$.g,isFunction=$.isFunction,html=$.html,process=global.process,setTask=global.setImmediate,clearTask=global.clearImmediate,MessageChannel=global.MessageChannel,counter=0,queue={},ONREADYSTATECHANGE="onreadystatechange";isFunction(setTask)&&isFunction(clearTask)||(setTask=function(fn){for(var args=[],i=1;arguments.length>i;)args.push(arguments[i++]);return queue[++counter]=function(){invoke(isFunction(fn)?fn:Function(fn),args)},defer(counter),counter},clearTask=function(id){delete queue[id]},"process"==cof(process)?defer=function(id){process.nextTick(ctx(run,id,1))}:global.addEventListener&&isFunction(global.postMessage)&&!global.importScripts?(defer=function(id){global.postMessage(id,"*")},global.addEventListener("message",listner,!1)):isFunction(MessageChannel)?(channel=new MessageChannel,port=channel.port2,channel.port1.onmessage=listner,defer=ctx(port.postMessage,port,1)):defer=ONREADYSTATECHANGE in cel("script")?function(id){html.appendChild(cel("script"))[ONREADYSTATECHANGE]=function(){html.removeChild(this),run.call(id)}}:function(id){setTimeout(ctx(run,id,1),0)}),module.exports={set:setTask,clear:clearTask}},function(module,exports){module.exports=function(fn,args,that){var un=void 0===that;switch(args.length){case 0:return un?fn():fn.call(that);case 1:return un?fn(args[0]):fn.call(that,args[0]);case 2:return un?fn(args[0],args[1]):fn.call(that,args[0],args[1]);case 3:return un?fn(args[0],args[1],args[2]):fn.call(that,args[0],args[1],args[2]);case 4:return un?fn(args[0],args[1],args[2],args[3]):fn.call(that,args[0],args[1],args[2],args[3]);case 5:return un?fn(args[0],args[1],args[2],args[3],args[4]):fn.call(that,args[0],args[1],args[2],args[3],args[4])}return fn.apply(that,args)}},function(module,exports,__webpack_require__){var $=__webpack_require__(4),document=$.g.document,isObject=$.isObject,is=isObject(document)&&isObject(document.createElement);module.exports=function(it){return is?document.createElement(it):{}}},function(module,exports,__webpack_require__){var $redef=__webpack_require__(41);module.exports=function(target,src){for(var key in src)$redef(target,key,src[key]);return target}},function(module,exports,__webpack_require__){var SYMBOL_ITERATOR=__webpack_require__(37)("iterator"),SAFE_CLOSING=!1;try{var riter=[7][SYMBOL_ITERATOR]();riter["return"]=function(){SAFE_CLOSING=!0},Array.from(riter,function(){throw 2})}catch(e){}module.exports=function(exec){if(!SAFE_CLOSING)return!1;var safe=!1;try{var arr=[7],iter=arr[SYMBOL_ITERATOR]();iter.next=function(){safe=!0},arr[SYMBOL_ITERATOR]=function(){return iter},exec(arr)}catch(e){}return safe}},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(80),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(6),module.exports=__webpack_require__(4).core.Object.keys},function(module,exports,__webpack_require__){"use strict";var _slicedToArray=__webpack_require__(28)["default"],_getIterator=__webpack_require__(29)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reflux=(_interopRequireDefault(_reactAddons),__webpack_require__(82)),_reflux2=_interopRequireDefault(_reflux),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_immstruct=__webpack_require__(83),_immstruct2=_interopRequireDefault(_immstruct),_selectionchange=__webpack_require__(88),_selectionchange2=_interopRequireDefault(_selectionchange),_promiseQueue=__webpack_require__(95),_promiseQueue2=_interopRequireDefault(_promiseQueue),_bluebird=__webpack_require__(96),_bluebird2=_interopRequireDefault(_bluebird),_fusibleUtilHelpers=__webpack_require__(54),_fusibleActionsCustom_block_actions=__webpack_require__(99),_fusibleActionsCustom_block_actions2=_interopRequireDefault(_fusibleActionsCustom_block_actions),_fusibleActionsCustom_tag_actions=__webpack_require__(100),_fusibleActionsCustom_tag_actions2=_interopRequireDefault(_fusibleActionsCustom_tag_actions),_fusibleActionsDocument_actions=__webpack_require__(101),_fusibleActionsDocument_actions2=_interopRequireDefault(_fusibleActionsDocument_actions),_fusibleActionsKey_combo_actions=__webpack_require__(102),_fusibleActionsKey_combo_actions2=_interopRequireDefault(_fusibleActionsKey_combo_actions),_fusibleActionsText_edit_actions=__webpack_require__(103),_fusibleActionsText_edit_actions2=_interopRequireDefault(_fusibleActionsText_edit_actions),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_fusibleActionsTyping_actions=__webpack_require__(105),_fusibleActionsTyping_actions2=_interopRequireDefault(_fusibleActionsTyping_actions),_fusibleRespondersCustom_block_responders=__webpack_require__(106),_fusibleRespondersCustom_block_responders2=_interopRequireDefault(_fusibleRespondersCustom_block_responders),_fusibleRespondersCustom_tag_responders=__webpack_require__(109),_fusibleRespondersCustom_tag_responders2=_interopRequireDefault(_fusibleRespondersCustom_tag_responders),_fusibleRespondersDocument_responders=__webpack_require__(110),_fusibleRespondersDocument_responders2=_interopRequireDefault(_fusibleRespondersDocument_responders),_fusibleRespondersKey_combo_responders=__webpack_require__(111),_fusibleRespondersKey_combo_responders2=_interopRequireDefault(_fusibleRespondersKey_combo_responders),_fusibleRespondersText_edit_responders=__webpack_require__(112),_fusibleRespondersText_edit_responders2=_interopRequireDefault(_fusibleRespondersText_edit_responders),_fusibleRespondersSelection_responders=__webpack_require__(113),_fusibleRespondersSelection_responders2=_interopRequireDefault(_fusibleRespondersSelection_responders),_fusibleRespondersTyping_responders=__webpack_require__(116),_fusibleRespondersTyping_responders2=_interopRequireDefault(_fusibleRespondersTyping_responders),_fusibleUtilUndo_manager=__webpack_require__(117),_fusibleUtilUndo_manager2=_interopRequireDefault(_fusibleUtilUndo_manager),_fusibleModelsSelection=__webpack_require__(122),_fusibleModelsSelection2=_interopRequireDefault(_fusibleModelsSelection);_promiseQueue2["default"].configure(_bluebird2["default"]),_bluebird2["default"].longStackTraces(),_selectionchange2["default"].start();var Store=_reflux2["default"].createStore({userActions:new _immutable.List(["Resize Window","Cursor Mouse Modification","Cursor Keyboard Modification","Cut","Paste","Undo","Redo","Insert Character","Insert Character Over","Delete Character","Delete Selection","Enter Over","Enter","Add Text Tag","Delete Text Tag","Add Custom Tag","Modify Custom Tag","Modify Text Block","Add Custom Block","Modify Custom Block","Delete Custom Block"]),init:function(){var _this=this;this.structure=_immstruct2["default"]("fusible",{documentModels:{},lastAction:{}}),this.selection=new _fusibleModelsSelection2["default"],this.documentContainers=new _immutable.Map,"undefined"!=typeof document&&(this.watchForClicks(),this.watchForSelectionChanges(),this.watchForWindowEvents()),this.undoManager=new _fusibleUtilUndo_manager2["default"],this.inClick=!1,this.deleteHalted=!1,this.currentlyTyping=!1,this.restoringHistory=!1,this.lastIntentWasTyping=!1,this.deletedDuringTyping=!1,this.documentComponents=new _immutable.List,this.keyOperationQueue=new _promiseQueue2["default"](1,1/0),this.selection.on("swap",function(){_this.restoringHistory||_this.undoManager.replaceIn(["selection"],_this.selection.deref())})},registerActionResponder:function(actions,responder){_lodash2["default"].extend(this,responder);var _iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_getIterator(_fusibleUtilHelpers.entries(responder));!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var _step$value=_slicedToArray(_step.value,2),_name=_step$value[0],property=_step$value[1];_lodash2["default"].isFunction(property)&&responder.hasOwnProperty(_name)&&(this[_name]=property.bind(this))}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}this.listenToMany(actions)},watchForSelectionChanges:function(){this.selectionWatchTimeout=setTimeout(function(){document.addEventListener("selectionchange",_fusibleActionsSelection_actions2["default"].updateSelection)},5)},ignoreSelectionChanges:function(){clearTimeout(this.selectionWatchTimeout),document.removeEventListener("selectionchange",_fusibleActionsSelection_actions2["default"].updateSelection)},watchForWindowEvents:function(){window.addEventListener("resize",_fusibleActionsSelection_actions2["default"].updateDimensions)},ignoreWindowEvents:function(){window.removeEventListener("resize",_fusibleActionsSelection_actions2["default"].updateDimensions)},watchForClicks:function(){var _this2=this;document.addEventListener("mousedown",function(){_this2.inClick=!0}),document.addEventListener("mouseup",function(){return _this2.inClick=!1,!0})},documentModelsCursor:function(){return this.structure.cursor("documentModels")},lastActionCursor:function(){return this.structure.cursor("lastAction")},registerDocumentContainer:function(editorComponent,model){this.unregisterDocumentContainer(editorComponent),this.documentModelsCursor().update(editorComponent.id,function(){return _immutable2["default"].fromJS(model)}),this.updateHistoryState(!0),this.documentContainers=this.documentContainers.set(editorComponent.id,new _immutable.Map({component:editorComponent,documents:new _immutable.Map})),this._refreshDocumentComponents()},unregisterDocumentContainer:function(editorComponent){this.documentModelsCursor()["delete"](editorComponent.id),this.documentContainers.has(editorComponent.id)&&(this.documentContainers=this.documentContainers["delete"](editorComponent.id)),this._refreshDocumentComponents()},flushUpdates:function(documentContainerId){var _this3=this,callback=arguments.length<=1||void 0===arguments[1]?null:arguments[1];this.currentlyTyping||this.updateHistoryState(),_lodash2["default"].isFunction(documentContainerId)?!function(){var callback=documentContainerId,promises=[];_this3.documentContainers.forEach(function(documentContainer){promises.push(new _bluebird2["default"](function(resolve){return documentContainer.get("component").triggerUpdate(resolve)}))}),_bluebird2["default"].all(promises).then(function(){"function"==typeof callback&&callback()})}():this.documentContainers.get(documentContainerId).get("component").triggerUpdate(callback)},updateHistoryState:function(){var replace=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(!this.restoringHistory){var newState=new _immutable.Map({structure:this.structure.current,selection:this.selection.deref()});this.undoManager.addState(newState,replace)}},updateLastAction:function(actionName){if(!this.userActions.contains(actionName))throw new Error("Unknown user action #{actionName}.");this.lastActionCursor().update(function(action){return action.set("name",actionName)})},_getCurrentDocumentInfo:function(){var currentDocumentContainerId=this.selection.get("documentContainerId"),currentDocumentId=this.selection.get("documentId");return currentDocumentContainerId&&currentDocumentId?this.documentContainers.getIn([currentDocumentContainerId,"documents",currentDocumentId]):void 0},_refreshDocumentComponents:function(){this.documentComponents=this.documentContainers.toList().map(function(editorInfo){return editorInfo.get("documents").toList().map(function(documentInfo){return documentInfo.document})}).flatten()}});Store.registerActionResponder(_fusibleActionsCustom_block_actions2["default"],_fusibleRespondersCustom_block_responders2["default"]),Store.registerActionResponder(_fusibleActionsCustom_tag_actions2["default"],_fusibleRespondersCustom_tag_responders2["default"]),Store.registerActionResponder(_fusibleActionsDocument_actions2["default"],_fusibleRespondersDocument_responders2["default"]),Store.registerActionResponder(_fusibleActionsKey_combo_actions2["default"],_fusibleRespondersKey_combo_responders2["default"]),Store.registerActionResponder(_fusibleActionsText_edit_actions2["default"],_fusibleRespondersText_edit_responders2["default"]),Store.registerActionResponder(_fusibleActionsSelection_actions2["default"],_fusibleRespondersSelection_responders2["default"]),Store.registerActionResponder(_fusibleActionsTyping_actions2["default"],_fusibleRespondersTyping_responders2["default"]),exports["default"]=Store,module.exports=exports["default"]},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_82__},function(module,exports,__webpack_require__){"use strict";function Immstruct(){return this instanceof Immstruct?void(this.instances={}):new Immstruct}function getInstance(obj,options){if("object"==typeof options.key&&(options.data=options.key,options.key=void 0),options.key&&obj.instances[options.key])return obj.instances[options.key];var newInstance=new Structure(options);return obj.instances[newInstance.key]=newInstance,newInstance}var Structure=__webpack_require__(84);Immstruct.prototype.get=function(key,data){return getInstance(this,{key:key,data:data})},Immstruct.prototype.clear=function(){this.instances={}},Immstruct.prototype.remove=function(key){return delete this.instances[key]},Immstruct.prototype.withHistory=function(key,data){return getInstance(this,{key:key,data:data,history:!0})};var inst=new Immstruct;module.exports=function(key,data){return getInstance(inst,{key:key,data:data})},module.exports.withHistory=function(key,data){return getInstance(inst,{key:key,data:data,history:!0})},module.exports.Structure=Structure,module.exports.Immstruct=Immstruct,module.exports.clear=inst.clear.bind(inst),module.exports.remove=inst.remove.bind(inst),Object.defineProperty(module.exports,"instances",{get:function(){return inst.instances},enumerable:!0,configurable:!0})},function(module,exports,__webpack_require__){"use strict";function Structure(options){var self=this;return options=options||{},this instanceof Structure?(this.key=options.key||utils.generateRandomKey(),this.current=options.data,isImmutableStructure(this.current)&&this.current||(this.current=Immutable.fromJS(this.current||{})),options.history&&(this.history=Immutable.List.of(this.current),this._currentRevision=0),this._pathListeners=[],this.on("swap",function(newData,oldData,keyPath){listListenerMatching(self._pathListeners,pathString(keyPath)).forEach(function(fns){fns.forEach(function(fn){"function"==typeof fn&&fn(newData,oldData,keyPath)})})}),void EventEmitter.call(this,arguments)):new Structure(options)}function handleHistory(emitter,fn){return function(newData,oldData,path){var newStructure=fn.apply(fn,arguments);return emitter.history&&newData!==oldData?(emitter.history=emitter.history.take(++emitter._currentRevision).push(emitter.current),newStructure):newStructure}}function handleSwap(emitter,fn){return function(newData,oldData,keyPath){var newStructure=fn.apply(fn,arguments);return newData===oldData?newStructure:(emitter.emit("swap",newStructure,oldData,keyPath),possiblyEmitAnimationFrameEvent(emitter,newStructure,oldData,keyPath),newStructure)}}function handlePersisting(emitter,fn){return function(newData,oldData,path){var newStructure=fn.apply(fn,arguments);if(newData===oldData)return newStructure;var info=analyze(newData,oldData,path);return info.eventName&&emitter.emit.apply(emitter,[info.eventName].concat(info.args)),newStructure}}function removeAllListenersBut(self,pathId,listeners,except){listeners&&listeners.forEach(function(fn){if(!except||fn!==except){var index=self._pathListeners[pathId].indexOf(fn);self._pathListeners[pathId].splice(index,1)}})}function analyze(newData,oldData,path){var args,eventName,oldObject=oldData&&oldData.getIn(path),newObject=newData&&newData.getIn(path),inOld=oldData&&hasIn(oldData,path),inNew=newData&&hasIn(newData,path);return inOld&&!inNew?(eventName="delete",args=[path,oldObject]):inOld&&inNew?(eventName="change",args=[path,newObject,oldObject]):!inOld&&inNew&&(eventName="add",args=[path,newObject]),{eventName:eventName,args:args}}function hasIn(cursor,path){return cursor.hasIn?cursor.hasIn(path):cursor.getIn(path,NOT_SET)!==NOT_SET}function pathString(path){var topLevel="global";return path&&path.length?[topLevel].concat(path).join("|"):topLevel}function listListenerMatching(listeners,basePath){var newListeners=[];for(var key in listeners)listeners.hasOwnProperty(key)&&0===basePath.indexOf(key)&&newListeners.push(listeners[key]);return newListeners}function onlyOnEvent(eventName,fn){return function(newData,oldData,keyPath){var info=analyze(newData,oldData,keyPath);if(info.eventName===eventName)return fn(newData,oldData,keyPath)}}function isCursor(potential){return potential&&"function"==typeof potential.deref}function isImmutableStructure(data){return immutableSafeCheck("Iterable","isIterable",data)||immutableSafeCheck("Seq","isSeq",data)||immutableSafeCheck("Map","isMap",data)||immutableSafeCheck("OrderedMap","isOrderedMap",data)||immutableSafeCheck("List","isList",data)||immutableSafeCheck("Stack","isStack",data)||immutableSafeCheck("Set","isSet",data)}function immutableSafeCheck(ns,method,data){return Immutable[ns]&&Immutable[ns][method]&&Immutable[ns][method](data)}var Immutable=__webpack_require__(20),Cursor=__webpack_require__(85),EventEmitter=__webpack_require__(19).EventEmitter,inherits=__webpack_require__(86),utils=__webpack_require__(87);inherits(Structure,EventEmitter),module.exports=Structure,Structure.prototype.cursor=function(path){var self=this;if(path=path||[],!this.current)throw new Error("No structure loaded.");var changeListener=function(newRoot,oldRoot,path){return self.current===oldRoot?self.current=newRoot:hasIn(newRoot,path)?self.current=self.current.setIn(path,newRoot.getIn(path)):self.current=self.current.removeIn(path),self.current};return changeListener=handleHistory(this,changeListener),changeListener=handleSwap(this,changeListener),changeListener=handlePersisting(this,changeListener),Cursor.from(self.current,path,changeListener)},Structure.prototype.reference=function(path){isCursor(path)&&path._keyPath&&(path=path._keyPath);var self=this,pathId=pathString(path),listenerNs=self._pathListeners[pathId],cursor=this.cursor(path),changeListener=function(newRoot,oldRoot,changedPath){cursor=self.cursor(path)},referenceListeners=[changeListener];return this._pathListeners[pathId]=listenerNs?listenerNs.concat(changeListener):referenceListeners,{observe:function(eventName,newFn){return"function"==typeof eventName&&(newFn=eventName,eventName=void 0),this._dead||"function"!=typeof newFn?void 0:(eventName&&"swap"!==eventName&&(newFn=onlyOnEvent(eventName,newFn)),self._pathListeners[pathId]=self._pathListeners[pathId].concat(newFn),referenceListeners=referenceListeners.concat(newFn),function(){var fnIndex=self._pathListeners[pathId].indexOf(newFn),localListenerIndex=referenceListeners.indexOf(newFn);referenceListeners[localListenerIndex]===newFn&&referenceListeners.splice(localListenerIndex,1),self._pathListeners[pathId]&&self._pathListeners[pathId][fnIndex]===newFn&&self._pathListeners[pathId].splice(fnIndex,1)})},cursor:function(subPath){return subPath?cursor.cursor(subPath):cursor},unobserveAll:function(){removeAllListenersBut(self,pathId,referenceListeners,changeListener),referenceListeners=[changeListener]},destroy:function(){removeAllListenersBut(self,pathId,referenceListeners),referenceListeners=void 0,cursor=void 0,this._dead=!0,this.observe=void 0,this.unobserveAll=void 0,this.cursor=void 0,this.destroy=void 0}}},Structure.prototype.forceHasSwapped=function(newData,oldData,keyPath){this.emit("swap",newData||this.current,oldData,keyPath),possiblyEmitAnimationFrameEvent(this,newData||this.current,oldData,keyPath)},Structure.prototype.undo=function(back){return this._currentRevision-=back||1,this._currentRevision<0&&(this._currentRevision=0),this.current=this.history.get(this._currentRevision),this.current},Structure.prototype.redo=function(head){return this._currentRevision+=head||1,this._currentRevision>this.history.count()-1&&(this._currentRevision=this.history.count()-1),this.current=this.history.get(this._currentRevision),this.current},Structure.prototype.undoUntil=function(structure){return this._currentRevision=this.history.indexOf(structure),this.current=structure,structure};var possiblyEmitAnimationFrameEvent=function(){var queuedChange=!1;return"function"!=typeof requestAnimationFrame?function(){}:function(emitter,newStructure,oldData){queuedChange||(queuedChange=!0,requestAnimationFrame(function(){queuedChange=!1,emitter.emit("next-animation-frame",newStructure,oldData)}))}}(),NOT_SET={}},function(module,exports,__webpack_require__){function cursorFrom(rootData,keyPath,onChange){return 1===arguments.length?keyPath=[]:"function"==typeof keyPath?(onChange=keyPath,keyPath=[]):Array.isArray(keyPath)||(keyPath=[keyPath]),makeCursor(rootData,keyPath,onChange)}function KeyedCursor(rootData,keyPath,onChange,size){this.size=size,this._rootData=rootData,this._keyPath=keyPath,this._onChange=onChange}function IndexedCursor(rootData,keyPath,onChange,size){this.size=size,this._rootData=rootData,this._keyPath=keyPath,this._onChange=onChange}function makeCursor(rootData,keyPath,onChange,value){arguments.length<4&&(value=rootData.getIn(keyPath));var size=value&&value.size,CursorClass=Iterable.isIndexed(value)?IndexedCursor:KeyedCursor;return new CursorClass(rootData,keyPath,onChange,size)}function wrappedValue(cursor,key,value){return Iterable.isIterable(value)?subCursor(cursor,key,value):value}function subCursor(cursor,key,value){return makeCursor(cursor._rootData,cursor._keyPath.concat(key),cursor._onChange,value)}function updateCursor(cursor,changeFn,changeKey){var newRootData=cursor._rootData.updateIn(cursor._keyPath,changeKey?Map():void 0,changeFn),keyPath=cursor._keyPath||[],result=cursor._onChange&&cursor._onChange.call(void 0,newRootData,cursor._rootData,changeKey?keyPath.concat(changeKey):keyPath);return void 0!==result&&(newRootData=result),makeCursor(newRootData,cursor._keyPath,cursor._onChange)}/**
	 *  Copyright (c) 2014, Facebook, Inc.
	 *  All rights reserved.
	 *
	 *  This source code is licensed under the BSD-style license found in the
	 *  LICENSE file in the root directory of this source tree. An additional grant
	 *  of patent rights can be found in the PATENTS file in the same directory.
	 */
var Immutable=__webpack_require__(20),Iterable=Immutable.Iterable,Iterator=Iterable.Iterator,Seq=Immutable.Seq,Map=Immutable.Map,KeyedCursorPrototype=Object.create(Seq.Keyed.prototype),IndexedCursorPrototype=Object.create(Seq.Indexed.prototype);KeyedCursorPrototype.constructor=KeyedCursor,IndexedCursorPrototype.constructor=IndexedCursor,KeyedCursorPrototype.toString=function(){return this.__toString("Cursor {","}")},IndexedCursorPrototype.toString=function(){return this.__toString("Cursor [","]")},KeyedCursorPrototype.deref=KeyedCursorPrototype.valueOf=IndexedCursorPrototype.deref=IndexedCursorPrototype.valueOf=function(notSetValue){return this._rootData.getIn(this._keyPath,notSetValue)},KeyedCursorPrototype.get=IndexedCursorPrototype.get=function(key,notSetValue){return this.getIn([key],notSetValue)},KeyedCursorPrototype.getIn=IndexedCursorPrototype.getIn=function(key,notSetValue){if(Array.isArray(key)||(key=Immutable.Iterable(key).toArray()),0===key.length)return this;var value=this._rootData.getIn(this._keyPath.concat(key),NOT_SET);return value===NOT_SET?notSetValue:wrappedValue(this,key,value)},IndexedCursorPrototype.set=KeyedCursorPrototype.set=function(key,value){return updateCursor(this,function(m){return m.set(key,value)},key)},KeyedCursorPrototype.remove=KeyedCursorPrototype["delete"]=IndexedCursorPrototype.remove=IndexedCursorPrototype["delete"]=function(key){return updateCursor(this,function(m){return m.remove(key)},key)},KeyedCursorPrototype.clear=IndexedCursorPrototype.clear=function(){return updateCursor(this,function(m){return m.clear()})},IndexedCursorPrototype.update=KeyedCursorPrototype.update=function(keyOrFn,notSetValue,updater){return 1===arguments.length?updateCursor(this,keyOrFn):updateCursor(this,function(map){return map.update(keyOrFn,notSetValue,updater)},keyOrFn)},KeyedCursorPrototype.withMutations=IndexedCursorPrototype.withMutations=function(fn){return updateCursor(this,function(m){return(m||Map()).withMutations(fn)})},KeyedCursorPrototype.cursor=IndexedCursorPrototype.cursor=function(subKey){return Array.isArray(subKey)&&0===subKey.length?this:subCursor(this,subKey)},KeyedCursorPrototype.__iterate=IndexedCursorPrototype.__iterate=function(fn,reverse){var cursor=this,deref=cursor.deref();return deref&&deref.__iterate?deref.__iterate(function(v,k){return fn(wrappedValue(cursor,k,v),k,cursor)},reverse):0},KeyedCursorPrototype.__iterator=IndexedCursorPrototype.__iterator=function(type,reverse){var deref=this.deref(),cursor=this,iterator=deref&&deref.__iterator&&deref.__iterator(Iterator.ENTRIES,reverse);return new Iterator(function(){if(!iterator)return{value:void 0,done:!0};var step=iterator.next();if(step.done)return step;var entry=step.value,k=entry[0],v=wrappedValue(cursor,k,entry[1]);return{value:type===Iterator.KEYS?k:type===Iterator.VALUES?v:[k,v],done:!1}})},KeyedCursor.prototype=KeyedCursorPrototype,IndexedCursor.prototype=IndexedCursorPrototype;var NOT_SET={};exports.from=cursorFrom},function(module,exports){"function"==typeof Object.create?module.exports=function(ctor,superCtor){ctor.super_=superCtor,ctor.prototype=Object.create(superCtor.prototype,{constructor:{value:ctor,enumerable:!1,writable:!0,configurable:!0}})}:module.exports=function(ctor,superCtor){ctor.super_=superCtor;var TempCtor=function(){};TempCtor.prototype=superCtor.prototype,ctor.prototype=new TempCtor,ctor.prototype.constructor=ctor}},function(module,exports){"use strict";module.exports.generateRandomKey=function(len){return len=len||10,Math.random().toString(36).substring(2).substring(0,len)}},function(module,exports,__webpack_require__){"use strict";var _WeakMap=__webpack_require__(89)["default"];module.exports=function(undefined){if("undefined"==typeof navigator)return{start:function(){},stop:function(){},trigger:function(){}};var SELECT_ALL_MODIFIER,RANGE_PROPS,ranges,_ret=function(){var hasNativeSupport=function(doc){var osc=doc.onselectionchange;if(osc!==undefined)try{return doc.onselectionchange=0,null===doc.onselectionchange}catch(e){}finally{doc.onselectionchange=osc}return!1},newWeakMap=function(){return"undefined"!=typeof _WeakMap?new _WeakMap:(console.error("selectionchange: WeakMap not supported"),null)},getSelectionRange=function(doc){var s=doc.getSelection();return s.rangeCount?s.getRangeAt(0):null},on=function(el,eventType,handler){el.addEventListener(eventType,handler,!0)},off=function(el,eventType,handler){el.removeEventListener(eventType,handler,!0)},onKeyDown=function(e){var code=e.keyCode;(65===code&&e[SELECT_ALL_MODIFIER]&&!e.shiftKey&&!e.altKey||40>=code&&code>=37&&e.shiftKey)&&setTimeout(dispatchIfChanged.bind(null,this),0)},onMouseDown=function(e){0===e.button&&(on(this,"mousemove",onMouseMove),setTimeout(dispatchIfChanged.bind(null,this),0))},onMouseMove=function onMouseMove(e){1&e.buttons?dispatchIfChanged(this):off(this,"mousemove",onMouseMove)},onMouseUp=function(e){0===e.button?setTimeout(dispatchIfChanged.bind(null,this),0):off(this,"mousemove",onMouseMove)},onFocus=function(){setTimeout(dispatchIfChanged.bind(null,this.document),0)},dispatchIfChanged=function(doc){var rOld=ranges.get(doc),rNew=getSelectionRange(doc);sameRange(rNew,rOld)||(ranges.set(doc,rNew),setTimeout(doc.dispatchEvent.bind(doc,new Event("selectionchange")),0))},sameRange=function(r1,r2){return r1===r2||r1&&r2&&RANGE_PROPS.every(function(prop){return r1[prop]===r2[prop]})};return SELECT_ALL_MODIFIER=/^Mac/.test(navigator.platform)?"metaKey":"ctrlKey",RANGE_PROPS=["startContainer","startOffset","endContainer","endOffset"],{v:{start:function(doc){var d=doc||document;(ranges||!hasNativeSupport(d)&&(ranges=newWeakMap()))&&(ranges.has(d)||(ranges.set(d,getSelectionRange(d)),on(d,"keydown",onKeyDown),on(d,"mousedown",onMouseDown),on(d,"mousemove",onMouseMove),on(d,"mouseup",onMouseUp),on(d.defaultView,"focus",onFocus)))},stop:function(doc){var d=doc||document;ranges&&ranges.has(d)&&(ranges["delete"](d),off(d,"keydown",onKeyDown),off(d,"mousedown",onMouseDown),off(d,"mousemove",onMouseMove),off(d,"mouseup",onMouseUp),off(d.defaultView,"focus",onFocus))},trigger:function(doc){var d=doc||document;hasNativeSupport(d)||dispatchIfChanged(d)}}}}();return"object"==typeof _ret?_ret.v:void 0}()},function(module,exports,__webpack_require__){module.exports={"default":__webpack_require__(90),__esModule:!0}},function(module,exports,__webpack_require__){__webpack_require__(66),__webpack_require__(32),__webpack_require__(91),module.exports=__webpack_require__(4).core.WeakMap},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(4),weak=__webpack_require__(92),leakStore=weak.leakStore,ID=weak.ID,WEAK=weak.WEAK,has=$.has,isObject=$.isObject,isExtensible=Object.isExtensible||isObject,tmp={},$WeakMap=__webpack_require__(94)("WeakMap",function(get){return function(){return get(this,arguments[0])}},{get:function(key){if(isObject(key)){if(!isExtensible(key))return leakStore(this).get(key);if(has(key,WEAK))return key[WEAK][this[ID]]}},set:function(key,value){return weak.def(this,key,value)}},weak,!0,!0);7!=(new $WeakMap).set((Object.freeze||Object)(tmp),7).get(tmp)&&$.each.call(["delete","has","get","set"],function(key){var proto=$WeakMap.prototype,method=proto[key];__webpack_require__(41)(proto,key,function(a,b){if(isObject(a)&&!isExtensible(a)){var result=leakStore(this)[key](a,b);return"set"==key?this:result}return method.call(this,a,b)})})},function(module,exports,__webpack_require__){"use strict";function findFrozen(store,key){return find(store.array,function(it){return it[0]===key})}function leakStore(that){return that[LEAK]||hide(that,LEAK,{array:[],get:function(key){var entry=findFrozen(this,key);return entry?entry[1]:void 0},has:function(key){return!!findFrozen(this,key)},set:function(key,value){var entry=findFrozen(this,key);entry?entry[1]=value:this.array.push([key,value])},"delete":function(key){var index=findIndex(this.array,function(it){return it[0]===key});return~index&&this.array.splice(index,1),!!~index}})[LEAK]}var $=__webpack_require__(4),safe=__webpack_require__(34).safe,assert=__webpack_require__(39),forOf=__webpack_require__(69),$has=$.has,isObject=$.isObject,hide=$.hide,isExtensible=Object.isExtensible||isObject,id=0,ID=safe("id"),WEAK=safe("weak"),LEAK=safe("leak"),method=__webpack_require__(93),find=method(5),findIndex=method(6);module.exports={getConstructor:function(wrapper,NAME,IS_MAP,ADDER){var C=wrapper(function(that,iterable){$.set(assert.inst(that,C,NAME),ID,id++),void 0!=iterable&&forOf(iterable,IS_MAP,that[ADDER],that)});return __webpack_require__(77)(C.prototype,{"delete":function(key){return isObject(key)?isExtensible(key)?$has(key,WEAK)&&$has(key[WEAK],this[ID])&&delete key[WEAK][this[ID]]:leakStore(this)["delete"](key):!1},has:function(key){return isObject(key)?isExtensible(key)?$has(key,WEAK)&&$has(key[WEAK],this[ID]):leakStore(this).has(key):!1}}),C},def:function(that,key,value){return isExtensible(assert.obj(key))?($has(key,WEAK)||hide(key,WEAK,{}),key[WEAK][that[ID]]=value):leakStore(that).set(key,value),that},leakStore:leakStore,WEAK:WEAK,ID:ID}},function(module,exports,__webpack_require__){var $=__webpack_require__(4),ctx=__webpack_require__(68);module.exports=function(TYPE){var IS_MAP=1==TYPE,IS_FILTER=2==TYPE,IS_SOME=3==TYPE,IS_EVERY=4==TYPE,IS_FIND_INDEX=6==TYPE,NO_HOLES=5==TYPE||IS_FIND_INDEX;return function($this,callbackfn,that){for(var val,res,O=Object($.assertDefined($this)),self=$.ES5Object(O),f=ctx(callbackfn,that,3),length=$.toLength(self.length),index=0,result=IS_MAP?Array(length):IS_FILTER?[]:void 0;length>index;index++)if((NO_HOLES||index in self)&&(val=self[index],res=f(val,index,O),TYPE))if(IS_MAP)result[index]=res;else if(res)switch(TYPE){case 3:return!0;case 5:return val;case 6:return index;case 2:result.push(val)}else if(IS_EVERY)return!1;return IS_FIND_INDEX?-1:IS_SOME||IS_EVERY?IS_EVERY:result}}},function(module,exports,__webpack_require__){"use strict";var $=__webpack_require__(4),$def=__webpack_require__(7),$iter=__webpack_require__(35),BUGGY=$iter.BUGGY,forOf=__webpack_require__(69),assertInstance=__webpack_require__(39).inst,INTERNAL=__webpack_require__(34).safe("internal");module.exports=function(NAME,wrapper,methods,common,IS_MAP,IS_WEAK){var Base=$.g[NAME],C=Base,ADDER=IS_MAP?"set":"add",proto=C&&C.prototype,O={};return $.DESC&&$.isFunction(C)&&(IS_WEAK||!BUGGY&&proto.forEach&&proto.entries)?(C=wrapper(function(target,iterable){assertInstance(target,C,NAME),target[INTERNAL]=new Base,void 0!=iterable&&forOf(iterable,IS_MAP,target[ADDER],target)}),$.each.call("add,clear,delete,forEach,get,has,set,keys,values,entries".split(","),function(KEY){var chain="add"==KEY||"set"==KEY;KEY in proto&&$.hide(C.prototype,KEY,function(a,b){var result=this[INTERNAL][KEY](0===a?0:a,b);return chain?this:result})}),"size"in proto&&$.setDesc(C.prototype,"size",{get:function(){return this[INTERNAL].size}})):(C=common.getConstructor(wrapper,NAME,IS_MAP,ADDER),__webpack_require__(77)(C.prototype,methods)),__webpack_require__(36).set(C,NAME),O[NAME]=C,$def($def.G+$def.W+$def.F,O),__webpack_require__(73)(C),IS_WEAK||common.setIter(C,NAME,IS_MAP),C}},function(module,exports,__webpack_require__){"use strict";var _Promise=__webpack_require__(64)["default"];!function(root,factory){module.exports=factory()}(void 0,function(){function Queue(maxPendingPromises,maxQueuedPromises){this.pendingPromises=0,this.maxPendingPromises="undefined"!=typeof maxPendingPromises?maxPendingPromises:1/0,this.maxQueuedPromises="undefined"!=typeof maxQueuedPromises?maxQueuedPromises:1/0,this.queue=[]}var LocalPromise="undefined"!=typeof _Promise?_Promise:function(){return{then:function(){throw new Error("Queue.configure() before use Queue")}}},noop=function(){},resolveWith=function(value){return value&&"function"==typeof value.then?value:new LocalPromise(function(resolve){resolve(value)})};return Queue.configure=function(GlobalPromise){LocalPromise=GlobalPromise},Queue.prototype.add=function(promiseGenerator){var self=this;return new LocalPromise(function(resolve,reject,notify){return self.queue.length>=self.maxQueuedPromises?void reject(new Error("Queue limit reached")):(self.queue.push({promiseGenerator:promiseGenerator,resolve:resolve,reject:reject,notify:notify||noop}),void self._dequeue())})},Queue.prototype.getPendingLength=function(){return this.pendingPromises},Queue.prototype.getQueueLength=function(){return this.queue.length},Queue.prototype._dequeue=function(){var self=this;if(this.pendingPromises>=this.maxPendingPromises)return!1;var item=this.queue.shift();return item?(this.pendingPromises++,resolveWith(item.promiseGenerator()).then(function(value){self.pendingPromises--,self._dequeue(),item.resolve(value)},function(err){self.pendingPromises--,self._dequeue(),item.reject(err)},function(message){item.notify(message)}),!0):!1},Queue})},function(module,exports,__webpack_require__){(function(process,global,setImmediate){/* @preserve
	 * The MIT License (MIT)
	 * 
	 * Copyright (c) 2013-2015 Petka Antonov
	 * 
	 * Permission is hereby granted, free of charge, to any person obtaining a copy
	 * of this software and associated documentation files (the "Software"), to deal
	 * in the Software without restriction, including without limitation the rights
	 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
	 * copies of the Software, and to permit persons to whom the Software is
	 * furnished to do so, subject to the following conditions:
	 * 
	 * The above copyright notice and this permission notice shall be included in
	 * all copies or substantial portions of the Software.
	 * 
	 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
	 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
	 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE
	 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
	 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
	 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN
	 * THE SOFTWARE.
	 * 
	 */
!function(e){module.exports=e()}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a="function"==typeof _dereq_&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error("Cannot find module '"+o+"'");throw f.code="MODULE_NOT_FOUND",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}for(var i="function"==typeof _dereq_&&_dereq_,o=0;o<r.length;o++)s(r[o]);return s}({1:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function any(promises){var ret=new SomePromiseArray(promises),promise=ret.promise();return ret.setHowMany(1),ret.setUnwrap(),ret.init(),promise}var SomePromiseArray=Promise._SomePromiseArray;Promise.any=function(promises){return any(promises)},Promise.prototype.any=function(){return any(this)}}},{}],2:[function(_dereq_,module,exports){"use strict";function Async(){this._isTickUsed=!1,this._lateQueue=new Queue(16),this._normalQueue=new Queue(16),this._trampolineEnabled=!0;var self=this;this.drainQueues=function(){self._drainQueues()},this._schedule=schedule.isStatic?schedule(this.drainQueues):schedule}function AsyncInvokeLater(fn,receiver,arg){this._lateQueue.push(fn,receiver,arg),this._queueTick()}function AsyncInvoke(fn,receiver,arg){this._normalQueue.push(fn,receiver,arg),this._queueTick()}function AsyncSettlePromises(promise){this._normalQueue._pushOne(promise),this._queueTick()}var firstLineError;try{throw new Error}catch(e){firstLineError=e}var schedule=_dereq_("./schedule.js"),Queue=_dereq_("./queue.js"),util=_dereq_("./util.js");Async.prototype.disableTrampolineIfNecessary=function(){util.hasDevTools&&(this._trampolineEnabled=!1)},Async.prototype.enableTrampoline=function(){this._trampolineEnabled||(this._trampolineEnabled=!0,this._schedule=function(fn){setTimeout(fn,0)})},Async.prototype.haveItemsQueued=function(){return this._normalQueue.length()>0},Async.prototype.throwLater=function(fn,arg){if(1===arguments.length&&(arg=fn,fn=function(){throw arg}),"undefined"!=typeof setTimeout)setTimeout(function(){fn(arg)},0);else try{this._schedule(function(){fn(arg)})}catch(e){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")}},util.hasDevTools?(schedule.isStatic&&(schedule=function(fn){setTimeout(fn,0)}),Async.prototype.invokeLater=function(fn,receiver,arg){this._trampolineEnabled?AsyncInvokeLater.call(this,fn,receiver,arg):this._schedule(function(){setTimeout(function(){fn.call(receiver,arg)},100)})},Async.prototype.invoke=function(fn,receiver,arg){this._trampolineEnabled?AsyncInvoke.call(this,fn,receiver,arg):this._schedule(function(){fn.call(receiver,arg)})},Async.prototype.settlePromises=function(promise){this._trampolineEnabled?AsyncSettlePromises.call(this,promise):this._schedule(function(){promise._settlePromises()})}):(Async.prototype.invokeLater=AsyncInvokeLater,Async.prototype.invoke=AsyncInvoke,Async.prototype.settlePromises=AsyncSettlePromises),Async.prototype.invokeFirst=function(fn,receiver,arg){this._normalQueue.unshift(fn,receiver,arg),this._queueTick()},Async.prototype._drainQueue=function(queue){for(;queue.length()>0;){var fn=queue.shift();if("function"==typeof fn){var receiver=queue.shift(),arg=queue.shift();fn.call(receiver,arg)}else fn._settlePromises()}},Async.prototype._drainQueues=function(){this._drainQueue(this._normalQueue),this._reset(),this._drainQueue(this._lateQueue)},Async.prototype._queueTick=function(){this._isTickUsed||(this._isTickUsed=!0,this._schedule(this.drainQueues))},Async.prototype._reset=function(){this._isTickUsed=!1},module.exports=new Async,module.exports.firstLineError=firstLineError},{"./queue.js":28,"./schedule.js":31,"./util.js":38}],3:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise){var rejectThis=function(_,e){this._reject(e)},targetRejected=function(e,context){context.promiseRejectionQueued=!0,context.bindingPromise._then(rejectThis,rejectThis,null,this,e)},bindingResolved=function(thisArg,context){this._isPending()&&this._resolveCallback(context.target)},bindingRejected=function(e,context){context.promiseRejectionQueued||this._reject(e)};Promise.prototype.bind=function(thisArg){var maybePromise=tryConvertToPromise(thisArg),ret=new Promise(INTERNAL);ret._propagateFrom(this,1);var target=this._target();if(ret._setBoundTo(maybePromise),maybePromise instanceof Promise){var context={promiseRejectionQueued:!1,promise:ret,target:target,bindingPromise:maybePromise};target._then(INTERNAL,targetRejected,ret._progress,ret,context),maybePromise._then(bindingResolved,bindingRejected,ret._progress,ret,context)}else ret._resolveCallback(target);return ret},Promise.prototype._setBoundTo=function(obj){void 0!==obj?(this._bitField=131072|this._bitField,this._boundTo=obj):this._bitField=-131073&this._bitField},Promise.prototype._isBound=function(){return 131072===(131072&this._bitField)},Promise.bind=function(thisArg,value){var maybePromise=tryConvertToPromise(thisArg),ret=new Promise(INTERNAL);return ret._setBoundTo(maybePromise),maybePromise instanceof Promise?maybePromise._then(function(){ret._resolveCallback(value)},ret._reject,ret._progress,ret,null):ret._resolveCallback(value),ret}}},{}],4:[function(_dereq_,module,exports){"use strict";function noConflict(){try{Promise===bluebird&&(Promise=old)}catch(e){}return bluebird}var old;"undefined"!=typeof Promise&&(old=Promise);var bluebird=_dereq_("./promise.js")();bluebird.noConflict=noConflict,module.exports=bluebird},{"./promise.js":23}],5:[function(_dereq_,module,exports){"use strict";var cr=Object.create;if(cr){var callerCache=cr(null),getterCache=cr(null);callerCache[" size"]=getterCache[" size"]=0}module.exports=function(Promise){function ensureMethod(obj,methodName){var fn;if(null!=obj&&(fn=obj[methodName]),"function"!=typeof fn){var message="Object "+util.classString(obj)+" has no method '"+util.toString(methodName)+"'";throw new Promise.TypeError(message)}return fn}function caller(obj){var methodName=this.pop(),fn=ensureMethod(obj,methodName);return fn.apply(obj,this)}function namedGetter(obj){return obj[this]}function indexedGetter(obj){var index=+this;return 0>index&&(index=Math.max(0,index+obj.length)),obj[index]}var getGetter,util=_dereq_("./util.js"),canEvaluate=util.canEvaluate;util.isIdentifier;Promise.prototype.call=function(methodName){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];return args.push(methodName),this._then(caller,void 0,void 0,args,void 0)},Promise.prototype.get=function(propertyName){var getter,isIndex="number"==typeof propertyName;if(isIndex)getter=indexedGetter;else if(canEvaluate){var maybeGetter=getGetter(propertyName);getter=null!==maybeGetter?maybeGetter:namedGetter}else getter=namedGetter;return this._then(getter,void 0,void 0,propertyName,void 0)}}},{"./util.js":38}],6:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){var errors=_dereq_("./errors.js"),async=_dereq_("./async.js"),CancellationError=errors.CancellationError;Promise.prototype._cancel=function(reason){if(!this.isCancellable())return this;for(var parent,promiseToReject=this;void 0!==(parent=promiseToReject._cancellationParent)&&parent.isCancellable();)promiseToReject=parent;this._unsetCancellable(),promiseToReject._target()._rejectCallback(reason,!1,!0)},Promise.prototype.cancel=function(reason){return this.isCancellable()?(void 0===reason&&(reason=new CancellationError),async.invokeLater(this._cancel,this,reason),this):this},Promise.prototype.cancellable=function(){return this._cancellable()?this:(async.enableTrampoline(),this._setCancellable(),this._cancellationParent=void 0,this)},Promise.prototype.uncancellable=function(){var ret=this.then();return ret._unsetCancellable(),ret},Promise.prototype.fork=function(didFulfill,didReject,didProgress){var ret=this._then(didFulfill,didReject,didProgress,void 0,void 0);return ret._setCancellable(),ret._cancellationParent=void 0,ret}}},{"./async.js":2,"./errors.js":13}],7:[function(_dereq_,module,exports){"use strict";module.exports=function(){function CapturedTrace(parent){this._parent=parent;var length=this._length=1+(void 0===parent?0:parent._length);captureStackTrace(this,CapturedTrace),length>32&&this.uncycle()}function reconstructStack(message,stacks){for(var i=0;i<stacks.length-1;++i)stacks[i].push("From previous event:"),stacks[i]=stacks[i].join("\n");return i<stacks.length&&(stacks[i]=stacks[i].join("\n")),message+"\n"+stacks.join("\n")}function removeDuplicateOrEmptyJumps(stacks){for(var i=0;i<stacks.length;++i)(0===stacks[i].length||i+1<stacks.length&&stacks[i][0]===stacks[i+1][0])&&(stacks.splice(i,1),i--)}function removeCommonRoots(stacks){for(var current=stacks[0],i=1;i<stacks.length;++i){for(var prev=stacks[i],currentLastIndex=current.length-1,currentLastLine=current[currentLastIndex],commonRootMeetPoint=-1,j=prev.length-1;j>=0;--j)if(prev[j]===currentLastLine){commonRootMeetPoint=j;break}for(var j=commonRootMeetPoint;j>=0;--j){var line=prev[j];if(current[currentLastIndex]!==line)break;current.pop(),currentLastIndex--}current=prev}}function cleanStack(stack){for(var ret=[],i=0;i<stack.length;++i){var line=stack[i],isTraceLine=stackFramePattern.test(line)||"    (No stack trace)"===line,isInternalFrame=isTraceLine&&shouldIgnore(line);isTraceLine&&!isInternalFrame&&(indentStackFrames&&" "!==line.charAt(0)&&(line="    "+line),ret.push(line))}return ret}function stackFramesAsArray(error){for(var stack=error.stack.replace(/\s+$/g,"").split("\n"),i=0;i<stack.length;++i){var line=stack[i];if("    (No stack trace)"===line||stackFramePattern.test(line))break}return i>0&&(stack=stack.slice(i)),stack}function formatNonError(obj){var str;if("function"==typeof obj)str="[function "+(obj.name||"anonymous")+"]";else{str=obj.toString();var ruselessToString=/\[object [a-zA-Z0-9$_]+\]/;if(ruselessToString.test(str))try{var newStr=JSON.stringify(obj);str=newStr}catch(e){}0===str.length&&(str="(empty array)")}return"(<"+snip(str)+">, no stack trace)"}function snip(str){var maxChars=41;return str.length<maxChars?str:str.substr(0,maxChars-3)+"..."}function parseLineInfo(line){var matches=line.match(parseLineInfoRegex);return matches?{fileName:matches[1],line:parseInt(matches[2],10)}:void 0}var warn,async=_dereq_("./async.js"),util=_dereq_("./util.js"),bluebirdFramePattern=/[\\\/]bluebird[\\\/]js[\\\/](main|debug|zalgo|instrumented)/,stackFramePattern=null,formatStack=null,indentStackFrames=!1;util.inherits(CapturedTrace,Error),CapturedTrace.prototype.uncycle=function(){var length=this._length;if(!(2>length)){for(var nodes=[],stackToIndex={},i=0,node=this;void 0!==node;++i)nodes.push(node),node=node._parent;length=this._length=i;for(var i=length-1;i>=0;--i){var stack=nodes[i].stack;void 0===stackToIndex[stack]&&(stackToIndex[stack]=i)}for(var i=0;length>i;++i){var currentStack=nodes[i].stack,index=stackToIndex[currentStack];if(void 0!==index&&index!==i){index>0&&(nodes[index-1]._parent=void 0,nodes[index-1]._length=1),nodes[i]._parent=void 0,nodes[i]._length=1;var cycleEdgeNode=i>0?nodes[i-1]:this;length-1>index?(cycleEdgeNode._parent=nodes[index+1],cycleEdgeNode._parent.uncycle(),cycleEdgeNode._length=cycleEdgeNode._parent._length+1):(cycleEdgeNode._parent=void 0,cycleEdgeNode._length=1);for(var currentChildLength=cycleEdgeNode._length+1,j=i-2;j>=0;--j)nodes[j]._length=currentChildLength,currentChildLength++;return}}}},CapturedTrace.prototype.parent=function(){return this._parent},CapturedTrace.prototype.hasParent=function(){return void 0!==this._parent},CapturedTrace.prototype.attachExtraTrace=function(error){if(!error.__stackCleaned__){this.uncycle();for(var parsed=CapturedTrace.parseStackAndMessage(error),message=parsed.message,stacks=[parsed.stack],trace=this;void 0!==trace;)stacks.push(cleanStack(trace.stack.split("\n"))),trace=trace._parent;removeCommonRoots(stacks),removeDuplicateOrEmptyJumps(stacks),util.notEnumerableProp(error,"stack",reconstructStack(message,stacks)),util.notEnumerableProp(error,"__stackCleaned__",!0)}},CapturedTrace.parseStackAndMessage=function(error){var stack=error.stack,message=error.toString();return stack="string"==typeof stack&&stack.length>0?stackFramesAsArray(error):["    (No stack trace)"],{message:message,stack:cleanStack(stack)}},CapturedTrace.formatAndLogError=function(error,title){if("undefined"!=typeof console){var message;if("object"==typeof error||"function"==typeof error){var stack=error.stack;message=title+formatStack(stack,error)}else message=title+String(error);"function"==typeof warn?warn(message):("function"==typeof console.log||"object"==typeof console.log)&&console.log(message)}},CapturedTrace.unhandledRejection=function(reason){CapturedTrace.formatAndLogError(reason,"^--- With additional stack trace: ")},CapturedTrace.isSupported=function(){return"function"==typeof captureStackTrace},CapturedTrace.fireRejectionEvent=function(name,localHandler,reason,promise){var localEventFired=!1;try{"function"==typeof localHandler&&(localEventFired=!0,"rejectionHandled"===name?localHandler(promise):localHandler(reason,promise))}catch(e){async.throwLater(e)}var globalEventFired=!1;try{globalEventFired=fireGlobalEvent(name,reason,promise)}catch(e){globalEventFired=!0,async.throwLater(e)}var domEventFired=!1;if(fireDomEvent)try{domEventFired=fireDomEvent(name.toLowerCase(),{reason:reason,promise:promise})}catch(e){domEventFired=!0,async.throwLater(e)}globalEventFired||localEventFired||domEventFired||"unhandledRejection"!==name||CapturedTrace.formatAndLogError(reason,"Unhandled rejection ")};var shouldIgnore=function(){return!1},parseLineInfoRegex=/[\/<\(]([^:\/]+):(\d+):(?:\d+)\)?\s*$/;CapturedTrace.setBounds=function(firstLineError,lastLineError){if(CapturedTrace.isSupported()){for(var firstFileName,lastFileName,firstStackLines=firstLineError.stack.split("\n"),lastStackLines=lastLineError.stack.split("\n"),firstIndex=-1,lastIndex=-1,i=0;i<firstStackLines.length;++i){var result=parseLineInfo(firstStackLines[i]);if(result){firstFileName=result.fileName,firstIndex=result.line;break}}for(var i=0;i<lastStackLines.length;++i){var result=parseLineInfo(lastStackLines[i]);if(result){lastFileName=result.fileName,lastIndex=result.line;break}}0>firstIndex||0>lastIndex||!firstFileName||!lastFileName||firstFileName!==lastFileName||firstIndex>=lastIndex||(shouldIgnore=function(line){if(bluebirdFramePattern.test(line))return!0;var info=parseLineInfo(line);return info&&info.fileName===firstFileName&&firstIndex<=info.line&&info.line<=lastIndex?!0:!1})}};var fireDomEvent,captureStackTrace=function(){var v8stackFramePattern=/^\s*at\s*/,v8stackFormatter=function(stack,error){return"string"==typeof stack?stack:void 0!==error.name&&void 0!==error.message?error.toString():formatNonError(error)};if("number"==typeof Error.stackTraceLimit&&"function"==typeof Error.captureStackTrace){Error.stackTraceLimit=Error.stackTraceLimit+6,stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter;var captureStackTrace=Error.captureStackTrace;return shouldIgnore=function(line){return bluebirdFramePattern.test(line)},function(receiver,ignoreUntil){Error.stackTraceLimit=Error.stackTraceLimit+6,captureStackTrace(receiver,ignoreUntil),Error.stackTraceLimit=Error.stackTraceLimit-6}}var err=new Error;if("string"==typeof err.stack&&err.stack.split("\n")[0].indexOf("stackDetection@")>=0)return stackFramePattern=/@/,formatStack=v8stackFormatter,indentStackFrames=!0,function(o){o.stack=(new Error).stack};var hasStackAfterThrow;try{throw new Error}catch(e){hasStackAfterThrow="stack"in e}return"stack"in err||!hasStackAfterThrow||"number"!=typeof Error.stackTraceLimit?(formatStack=function(stack,error){return"string"==typeof stack?stack:"object"!=typeof error&&"function"!=typeof error||void 0===error.name||void 0===error.message?formatNonError(error):error.toString()},null):(stackFramePattern=v8stackFramePattern,formatStack=v8stackFormatter,function(o){Error.stackTraceLimit=Error.stackTraceLimit+6;try{throw new Error}catch(e){o.stack=e.stack}Error.stackTraceLimit=Error.stackTraceLimit-6})}([]),fireGlobalEvent=function(){if(util.isNode)return function(name,reason,promise){return"rejectionHandled"===name?process.emit(name,promise):process.emit(name,reason,promise)};var customEventWorks=!1,anyEventWorks=!0;try{var ev=new self.CustomEvent("test");customEventWorks=ev instanceof CustomEvent}catch(e){}if(!customEventWorks)try{var event=document.createEvent("CustomEvent");event.initCustomEvent("testingtheevent",!1,!0,{}),self.dispatchEvent(event)}catch(e){anyEventWorks=!1}anyEventWorks&&(fireDomEvent=function(type,detail){var event;return customEventWorks?event=new self.CustomEvent(type,{detail:detail,bubbles:!1,cancelable:!0}):self.dispatchEvent&&(event=document.createEvent("CustomEvent"),event.initCustomEvent(type,!1,!0,detail)),event?!self.dispatchEvent(event):!1});var toWindowMethodNameMap={};return toWindowMethodNameMap.unhandledRejection="onunhandledRejection".toLowerCase(),toWindowMethodNameMap.rejectionHandled="onrejectionHandled".toLowerCase(),function(name,reason,promise){var methodName=toWindowMethodNameMap[name],method=self[methodName];return method?("rejectionHandled"===name?method.call(self,promise):method.call(self,reason,promise),!0):!1}}();return"undefined"!=typeof console&&"undefined"!=typeof console.warn&&(warn=function(message){console.warn(message)},util.isNode&&process.stderr.isTTY?warn=function(message){process.stderr.write("[31m"+message+"[39m\n")}:util.isNode||"string"!=typeof(new Error).stack||(warn=function(message){console.warn("%c"+message,"color: red")})),CapturedTrace}},{"./async.js":2,"./util.js":38}],8:[function(_dereq_,module,exports){"use strict";module.exports=function(NEXT_FILTER){function CatchFilter(instances,callback,promise){this._instances=instances,this._callback=callback,this._promise=promise}function safePredicate(predicate,e){var safeObject={},retfilter=tryCatch(predicate).call(safeObject,e);if(retfilter===errorObj)return retfilter;var safeKeys=keys(safeObject);return safeKeys.length?(errorObj.e=new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"),errorObj):retfilter}var util=_dereq_("./util.js"),errors=_dereq_("./errors.js"),tryCatch=util.tryCatch,errorObj=util.errorObj,keys=_dereq_("./es5.js").keys,TypeError=errors.TypeError;return CatchFilter.prototype.doFilter=function(e){for(var cb=this._callback,promise=this._promise,boundTo=promise._boundValue(),i=0,len=this._instances.length;len>i;++i){var item=this._instances[i],itemIsErrorType=item===Error||null!=item&&item.prototype instanceof Error;if(itemIsErrorType&&e instanceof item){var ret=tryCatch(cb).call(boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}if("function"==typeof item&&!itemIsErrorType){var shouldHandle=safePredicate(item,e);if(shouldHandle===errorObj){e=errorObj.e;break}if(shouldHandle){var ret=tryCatch(cb).call(boundTo,e);return ret===errorObj?(NEXT_FILTER.e=ret.e,NEXT_FILTER):ret}}}return NEXT_FILTER.e=e,NEXT_FILTER},CatchFilter}},{"./errors.js":13,"./es5.js":14,"./util.js":38}],9:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace,isDebugging){function Context(){this._trace=new CapturedTrace(peekContext())}function createContext(){return isDebugging()?new Context:void 0}function peekContext(){var lastIndex=contextStack.length-1;return lastIndex>=0?contextStack[lastIndex]:void 0}var contextStack=[];return Context.prototype._pushContext=function(){isDebugging()&&void 0!==this._trace&&contextStack.push(this._trace)},Context.prototype._popContext=function(){isDebugging()&&void 0!==this._trace&&contextStack.pop()},Promise.prototype._peekContext=peekContext,Promise.prototype._pushContext=Context.prototype._pushContext,Promise.prototype._popContext=Context.prototype._popContext,createContext}},{}],10:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,CapturedTrace){var unhandledRejectionHandled,possiblyUnhandledRejection,getDomain=Promise._getDomain,async=_dereq_("./async.js"),Warning=_dereq_("./errors.js").Warning,util=_dereq_("./util.js"),canAttachTrace=util.canAttachTrace,debugging=util.isNode&&(!!process.env.BLUEBIRD_DEBUG||"development"===process.env.NODE_ENV);return util.isNode&&0==process.env.BLUEBIRD_DEBUG&&(debugging=!1),debugging&&async.disableTrampolineIfNecessary(),Promise.prototype._ignoreRejections=function(){this._unsetRejectionIsUnhandled(),this._bitField=16777216|this._bitField},Promise.prototype._ensurePossibleRejectionHandled=function(){0===(16777216&this._bitField)&&(this._setRejectionIsUnhandled(),async.invokeLater(this._notifyUnhandledRejection,this,void 0))},Promise.prototype._notifyUnhandledRejectionIsHandled=function(){CapturedTrace.fireRejectionEvent("rejectionHandled",unhandledRejectionHandled,void 0,this)},Promise.prototype._notifyUnhandledRejection=function(){if(this._isRejectionUnhandled()){var reason=this._getCarriedStackTrace()||this._settledValue;this._setUnhandledRejectionIsNotified(),CapturedTrace.fireRejectionEvent("unhandledRejection",possiblyUnhandledRejection,reason,this)}},Promise.prototype._setUnhandledRejectionIsNotified=function(){this._bitField=524288|this._bitField},Promise.prototype._unsetUnhandledRejectionIsNotified=function(){this._bitField=-524289&this._bitField},Promise.prototype._isUnhandledRejectionNotified=function(){return(524288&this._bitField)>0},Promise.prototype._setRejectionIsUnhandled=function(){this._bitField=2097152|this._bitField},Promise.prototype._unsetRejectionIsUnhandled=function(){this._bitField=-2097153&this._bitField,this._isUnhandledRejectionNotified()&&(this._unsetUnhandledRejectionIsNotified(),this._notifyUnhandledRejectionIsHandled())},Promise.prototype._isRejectionUnhandled=function(){return(2097152&this._bitField)>0},Promise.prototype._setCarriedStackTrace=function(capturedTrace){this._bitField=1048576|this._bitField,this._fulfillmentHandler0=capturedTrace},Promise.prototype._isCarryingStackTrace=function(){return(1048576&this._bitField)>0},Promise.prototype._getCarriedStackTrace=function(){return this._isCarryingStackTrace()?this._fulfillmentHandler0:void 0},Promise.prototype._captureStackTrace=function(){return debugging&&(this._trace=new CapturedTrace(this._peekContext())),this},Promise.prototype._attachExtraTrace=function(error,ignoreSelf){if(debugging&&canAttachTrace(error)){var trace=this._trace;if(void 0!==trace&&ignoreSelf&&(trace=trace._parent),void 0!==trace)trace.attachExtraTrace(error);else if(!error.__stackCleaned__){var parsed=CapturedTrace.parseStackAndMessage(error);util.notEnumerableProp(error,"stack",parsed.message+"\n"+parsed.stack.join("\n")),util.notEnumerableProp(error,"__stackCleaned__",!0)}}},Promise.prototype._warn=function(message){var warning=new Warning(message),ctx=this._peekContext();if(ctx)ctx.attachExtraTrace(warning);else{var parsed=CapturedTrace.parseStackAndMessage(warning);warning.stack=parsed.message+"\n"+parsed.stack.join("\n")}CapturedTrace.formatAndLogError(warning,"")},Promise.onPossiblyUnhandledRejection=function(fn){var domain=getDomain();possiblyUnhandledRejection="function"==typeof fn?null===domain?fn:domain.bind(fn):void 0},Promise.onUnhandledRejectionHandled=function(fn){var domain=getDomain();unhandledRejectionHandled="function"==typeof fn?null===domain?fn:domain.bind(fn):void 0},Promise.longStackTraces=function(){if(async.haveItemsQueued()&&debugging===!1)throw new Error("cannot enable long stack traces after promises have been created\n\n    See http://goo.gl/DT1qyG\n");debugging=CapturedTrace.isSupported(),debugging&&async.disableTrampolineIfNecessary()},Promise.hasLongStackTraces=function(){return debugging&&CapturedTrace.isSupported()},CapturedTrace.isSupported()||(Promise.longStackTraces=function(){},debugging=!1),function(){return debugging}}},{"./async.js":2,"./errors.js":13,"./util.js":38}],11:[function(_dereq_,module,exports){"use strict";var util=_dereq_("./util.js"),isPrimitive=util.isPrimitive;module.exports=function(Promise){var returner=function(){return this},thrower=function(){throw this},returnUndefined=function(){},throwUndefined=function(){throw void 0},wrapper=function(value,action){return 1===action?function(){throw value}:2===action?function(){return value}:void 0};Promise.prototype["return"]=Promise.prototype.thenReturn=function(value){return void 0===value?this.then(returnUndefined):isPrimitive(value)?this._then(wrapper(value,2),void 0,void 0,void 0,void 0):(value instanceof Promise&&value._ignoreRejections(),this._then(returner,void 0,void 0,value,void 0))},Promise.prototype["throw"]=Promise.prototype.thenThrow=function(reason){return void 0===reason?this.then(throwUndefined):isPrimitive(reason)?this._then(wrapper(reason,1),void 0,void 0,void 0,void 0):this._then(thrower,void 0,void 0,reason,void 0)}}},{"./util.js":38}],12:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseReduce=Promise.reduce;Promise.prototype.each=function(fn){return PromiseReduce(this,fn,null,INTERNAL)},Promise.each=function(promises,fn){return PromiseReduce(promises,fn,null,INTERNAL)}}},{}],13:[function(_dereq_,module,exports){"use strict";function subError(nameProperty,defaultMessage){function SubError(message){return this instanceof SubError?(notEnumerableProp(this,"message","string"==typeof message?message:defaultMessage),notEnumerableProp(this,"name",nameProperty),void(Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):Error.call(this))):new SubError(message)}return inherits(SubError,Error),SubError}function OperationalError(message){return this instanceof OperationalError?(notEnumerableProp(this,"name","OperationalError"),notEnumerableProp(this,"message",message),this.cause=message,this.isOperational=!0,void(message instanceof Error?(notEnumerableProp(this,"message",message.message),notEnumerableProp(this,"stack",message.stack)):Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor))):new OperationalError(message)}var _TypeError,_RangeError,es5=_dereq_("./es5.js"),Objectfreeze=es5.freeze,util=_dereq_("./util.js"),inherits=util.inherits,notEnumerableProp=util.notEnumerableProp,Warning=subError("Warning","warning"),CancellationError=subError("CancellationError","cancellation error"),TimeoutError=subError("TimeoutError","timeout error"),AggregateError=subError("AggregateError","aggregate error");try{_TypeError=TypeError,_RangeError=RangeError}catch(e){_TypeError=subError("TypeError","type error"),_RangeError=subError("RangeError","range error")}for(var methods="join pop push shift unshift slice filter forEach some every map indexOf lastIndexOf reduce reduceRight sort reverse".split(" "),i=0;i<methods.length;++i)"function"==typeof Array.prototype[methods[i]]&&(AggregateError.prototype[methods[i]]=Array.prototype[methods[i]]);es5.defineProperty(AggregateError.prototype,"length",{value:0,configurable:!1,writable:!0,enumerable:!0}),AggregateError.prototype.isOperational=!0;var level=0;AggregateError.prototype.toString=function(){var indent=Array(4*level+1).join(" "),ret="\n"+indent+"AggregateError of:\n";level++,indent=Array(4*level+1).join(" ");for(var i=0;i<this.length;++i){for(var str=this[i]===this?"[Circular AggregateError]":this[i]+"",lines=str.split("\n"),j=0;j<lines.length;++j)lines[j]=indent+lines[j];str=lines.join("\n"),ret+=str+"\n"}return level--,ret},inherits(OperationalError,Error);var errorTypes=Error.__BluebirdErrorTypes__;errorTypes||(errorTypes=Objectfreeze({CancellationError:CancellationError,TimeoutError:TimeoutError,OperationalError:OperationalError,RejectionError:OperationalError,AggregateError:AggregateError}),notEnumerableProp(Error,"__BluebirdErrorTypes__",errorTypes)),module.exports={Error:Error,TypeError:_TypeError,RangeError:_RangeError,CancellationError:errorTypes.CancellationError,OperationalError:errorTypes.OperationalError,TimeoutError:errorTypes.TimeoutError,AggregateError:errorTypes.AggregateError,Warning:Warning}},{"./es5.js":14,"./util.js":38}],14:[function(_dereq_,module,exports){var isES5=function(){"use strict";return void 0===this}();if(isES5)module.exports={freeze:Object.freeze,defineProperty:Object.defineProperty,getDescriptor:Object.getOwnPropertyDescriptor,keys:Object.keys,names:Object.getOwnPropertyNames,getPrototypeOf:Object.getPrototypeOf,isArray:Array.isArray,isES5:isES5,propertyIsWritable:function(obj,prop){var descriptor=Object.getOwnPropertyDescriptor(obj,prop);return!(descriptor&&!descriptor.writable&&!descriptor.set)}};else{var has={}.hasOwnProperty,str={}.toString,proto={}.constructor.prototype,ObjectKeys=function(o){var ret=[];for(var key in o)has.call(o,key)&&ret.push(key);return ret},ObjectGetDescriptor=function(o,key){return{value:o[key]}},ObjectDefineProperty=function(o,key,desc){return o[key]=desc.value,o},ObjectFreeze=function(obj){return obj},ObjectGetPrototypeOf=function(obj){try{return Object(obj).constructor.prototype}catch(e){return proto}},ArrayIsArray=function(obj){try{return"[object Array]"===str.call(obj)}catch(e){return!1}};module.exports={isArray:ArrayIsArray,keys:ObjectKeys,names:ObjectKeys,defineProperty:ObjectDefineProperty,getDescriptor:ObjectGetDescriptor,freeze:ObjectFreeze,getPrototypeOf:ObjectGetPrototypeOf,isES5:isES5,propertyIsWritable:function(){return!0}}}},{}],15:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){var PromiseMap=Promise.map;Promise.prototype.filter=function(fn,options){return PromiseMap(this,fn,options,INTERNAL)},Promise.filter=function(promises,fn,options){return PromiseMap(promises,fn,options,INTERNAL)}}},{}],16:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,NEXT_FILTER,tryConvertToPromise){function returnThis(){return this}function throwThis(){throw this}function return$(r){return function(){return r}}function throw$(r){return function(){throw r}}function promisedFinally(ret,reasonOrValue,isFulfilled){var then;return then=isPrimitive(reasonOrValue)?isFulfilled?return$(reasonOrValue):throw$(reasonOrValue):isFulfilled?returnThis:throwThis,ret._then(then,thrower,void 0,reasonOrValue,void 0)}function finallyHandler(reasonOrValue){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundValue()):handler();if(void 0!==ret){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise)return maybePromise=maybePromise._target(),promisedFinally(maybePromise,reasonOrValue,promise.isFulfilled())}return promise.isRejected()?(NEXT_FILTER.e=reasonOrValue,NEXT_FILTER):reasonOrValue}function tapHandler(value){var promise=this.promise,handler=this.handler,ret=promise._isBound()?handler.call(promise._boundValue(),value):handler(value);if(void 0!==ret){var maybePromise=tryConvertToPromise(ret,promise);if(maybePromise instanceof Promise)return maybePromise=maybePromise._target(),promisedFinally(maybePromise,value,!0)}return value}var util=_dereq_("./util.js"),isPrimitive=util.isPrimitive,thrower=util.thrower;Promise.prototype._passThroughHandler=function(handler,isFinally){if("function"!=typeof handler)return this.then();var promiseAndHandler={promise:this,handler:handler};return this._then(isFinally?finallyHandler:tapHandler,isFinally?finallyHandler:void 0,void 0,promiseAndHandler,void 0)},Promise.prototype.lastly=Promise.prototype["finally"]=function(handler){return this._passThroughHandler(handler,!0)},Promise.prototype.tap=function(handler){return this._passThroughHandler(handler,!1)}}},{"./util.js":38}],17:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,INTERNAL,tryConvertToPromise){function promiseFromYieldHandler(value,yieldHandlers,traceParent){for(var i=0;i<yieldHandlers.length;++i){traceParent._pushContext();var result=tryCatch(yieldHandlers[i])(value);if(traceParent._popContext(),result===errorObj){traceParent._pushContext();var ret=Promise.reject(errorObj.e);return traceParent._popContext(),ret}var maybePromise=tryConvertToPromise(result,traceParent);if(maybePromise instanceof Promise)return maybePromise}return null}function PromiseSpawn(generatorFunction,receiver,yieldHandler,stack){var promise=this._promise=new Promise(INTERNAL);promise._captureStackTrace(),this._stack=stack,this._generatorFunction=generatorFunction,this._receiver=receiver,this._generator=void 0,this._yieldHandlers="function"==typeof yieldHandler?[yieldHandler].concat(yieldHandlers):yieldHandlers}var errors=_dereq_("./errors.js"),TypeError=errors.TypeError,util=_dereq_("./util.js"),errorObj=util.errorObj,tryCatch=util.tryCatch,yieldHandlers=[];PromiseSpawn.prototype.promise=function(){
return this._promise},PromiseSpawn.prototype._run=function(){this._generator=this._generatorFunction.call(this._receiver),this._receiver=this._generatorFunction=void 0,this._next(void 0)},PromiseSpawn.prototype._continue=function(result){if(result===errorObj)return this._promise._rejectCallback(result.e,!1,!0);var value=result.value;if(result.done===!0)this._promise._resolveCallback(value);else{var maybePromise=tryConvertToPromise(value,this._promise);if(!(maybePromise instanceof Promise)&&(maybePromise=promiseFromYieldHandler(maybePromise,this._yieldHandlers,this._promise),null===maybePromise))return void this._throw(new TypeError("A value %s was yielded that could not be treated as a promise\n\n    See http://goo.gl/4Y4pDk\n\n".replace("%s",value)+"From coroutine:\n"+this._stack.split("\n").slice(1,-7).join("\n")));maybePromise._then(this._next,this._throw,void 0,this,null)}},PromiseSpawn.prototype._throw=function(reason){this._promise._attachExtraTrace(reason),this._promise._pushContext();var result=tryCatch(this._generator["throw"]).call(this._generator,reason);this._promise._popContext(),this._continue(result)},PromiseSpawn.prototype._next=function(value){this._promise._pushContext();var result=tryCatch(this._generator.next).call(this._generator,value);this._promise._popContext(),this._continue(result)},Promise.coroutine=function(generatorFunction,options){if("function"!=typeof generatorFunction)throw new TypeError("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var yieldHandler=Object(options).yieldHandler,PromiseSpawn$=PromiseSpawn,stack=(new Error).stack;return function(){var generator=generatorFunction.apply(this,arguments),spawn=new PromiseSpawn$(void 0,void 0,yieldHandler,stack);return spawn._generator=generator,spawn._next(void 0),spawn.promise()}},Promise.coroutine.addYieldHandler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");yieldHandlers.push(fn)},Promise.spawn=function(generatorFunction){if("function"!=typeof generatorFunction)return apiRejection("generatorFunction must be a function\n\n    See http://goo.gl/6Vqhm0\n");var spawn=new PromiseSpawn(generatorFunction,this),ret=spawn.promise();return spawn._run(Promise.spawn),ret}}},{"./errors.js":13,"./util.js":38}],18:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,INTERNAL){var util=_dereq_("./util.js");util.canEvaluate,util.tryCatch,util.errorObj;Promise.join=function(){var fn,last=arguments.length-1;if(last>0&&"function"==typeof arguments[last]){fn=arguments[last];var ret}for(var $_len=arguments.length,args=new Array($_len),$_i=0;$_len>$_i;++$_i)args[$_i]=arguments[$_i];fn&&args.pop();var ret=new PromiseArray(args).promise();return void 0!==fn?ret.spread(fn):ret}}},{"./util.js":38}],19:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){function MappingPromiseArray(promises,fn,limit,_filter){this.constructor$(promises),this._promise._captureStackTrace();var domain=getDomain();this._callback=null===domain?fn:domain.bind(fn),this._preservedValues=_filter===INTERNAL?new Array(this.length()):null,this._limit=limit,this._inFlight=0,this._queue=limit>=1?[]:EMPTY_ARRAY,async.invoke(init,this,void 0)}function init(){this._init$(void 0,-2)}function map(promises,fn,options,_filter){var limit="object"==typeof options&&null!==options?options.concurrency:0;return limit="number"==typeof limit&&isFinite(limit)&&limit>=1?limit:0,new MappingPromiseArray(promises,fn,limit,_filter)}var getDomain=Promise._getDomain,async=_dereq_("./async.js"),util=_dereq_("./util.js"),tryCatch=util.tryCatch,errorObj=util.errorObj,PENDING={},EMPTY_ARRAY=[];util.inherits(MappingPromiseArray,PromiseArray),MappingPromiseArray.prototype._init=function(){},MappingPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values,length=this.length(),preservedValues=this._preservedValues,limit=this._limit;if(values[index]===PENDING){if(values[index]=value,limit>=1&&(this._inFlight--,this._drainQueue(),this._isResolved()))return}else{if(limit>=1&&this._inFlight>=limit)return values[index]=value,void this._queue.push(index);null!==preservedValues&&(preservedValues[index]=value);var callback=this._callback,receiver=this._promise._boundValue();this._promise._pushContext();var ret=tryCatch(callback).call(receiver,value,index,length);if(this._promise._popContext(),ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){if(maybePromise=maybePromise._target(),maybePromise._isPending())return limit>=1&&this._inFlight++,values[index]=PENDING,maybePromise._proxyPromiseArray(this,index);if(!maybePromise._isFulfilled())return this._reject(maybePromise._reason());ret=maybePromise._value()}values[index]=ret}var totalResolved=++this._totalResolved;totalResolved>=length&&(null!==preservedValues?this._filter(values,preservedValues):this._resolve(values))},MappingPromiseArray.prototype._drainQueue=function(){for(var queue=this._queue,limit=this._limit,values=this._values;queue.length>0&&this._inFlight<limit;){if(this._isResolved())return;var index=queue.pop();this._promiseFulfilled(values[index],index)}},MappingPromiseArray.prototype._filter=function(booleans,values){for(var len=values.length,ret=new Array(len),j=0,i=0;len>i;++i)booleans[i]&&(ret[j++]=values[i]);ret.length=j,this._resolve(ret)},MappingPromiseArray.prototype.preservedValues=function(){return this._preservedValues},Promise.prototype.map=function(fn,options){return"function"!=typeof fn?apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):map(this,fn,options,null).promise()},Promise.map=function(promises,fn,options,_filter){return"function"!=typeof fn?apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n"):map(promises,fn,options,_filter).promise()}}},{"./async.js":2,"./util.js":38}],20:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){var util=_dereq_("./util.js"),tryCatch=util.tryCatch;Promise.method=function(fn){if("function"!=typeof fn)throw new Promise.TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");return function(){var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=tryCatch(fn).apply(this,arguments);return ret._popContext(),ret._resolveFromSyncValue(value),ret}},Promise.attempt=Promise["try"]=function(fn,args,ctx){if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var ret=new Promise(INTERNAL);ret._captureStackTrace(),ret._pushContext();var value=util.isArray(args)?tryCatch(fn).apply(ctx,args):tryCatch(fn).call(ctx,args);return ret._popContext(),ret._resolveFromSyncValue(value),ret},Promise.prototype._resolveFromSyncValue=function(value){value===util.errorObj?this._rejectCallback(value.e,!1,!0):this._resolveCallback(value,!0)}}},{"./util.js":38}],21:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function spreadAdapter(val,nodeback){var promise=this;if(!util.isArray(val))return successAdapter.call(promise,val,nodeback);var ret=tryCatch(nodeback).apply(promise._boundValue(),[null].concat(val));ret===errorObj&&async.throwLater(ret.e)}function successAdapter(val,nodeback){var promise=this,receiver=promise._boundValue(),ret=void 0===val?tryCatch(nodeback).call(receiver,null):tryCatch(nodeback).call(receiver,null,val);ret===errorObj&&async.throwLater(ret.e)}function errorAdapter(reason,nodeback){var promise=this;if(!reason){var target=promise._target(),newReason=target._getCarriedStackTrace();newReason.cause=reason,reason=newReason}var ret=tryCatch(nodeback).call(promise._boundValue(),reason);ret===errorObj&&async.throwLater(ret.e)}var util=_dereq_("./util.js"),async=_dereq_("./async.js"),tryCatch=util.tryCatch,errorObj=util.errorObj;Promise.prototype.asCallback=Promise.prototype.nodeify=function(nodeback,options){if("function"==typeof nodeback){var adapter=successAdapter;void 0!==options&&Object(options).spread&&(adapter=spreadAdapter),this._then(adapter,errorAdapter,void 0,this,nodeback)}return this}}},{"./async.js":2,"./util.js":38}],22:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){var util=_dereq_("./util.js"),async=_dereq_("./async.js"),tryCatch=util.tryCatch,errorObj=util.errorObj;Promise.prototype.progressed=function(handler){return this._then(void 0,void 0,handler,void 0,void 0)},Promise.prototype._progress=function(progressValue){this._isFollowingOrFulfilledOrRejected()||this._target()._progressUnchecked(progressValue)},Promise.prototype._progressHandlerAt=function(index){return 0===index?this._progressHandler0:this[(index<<2)+index-5+2]},Promise.prototype._doProgressWith=function(progression){var progressValue=progression.value,handler=progression.handler,promise=progression.promise,receiver=progression.receiver,ret=tryCatch(handler).call(receiver,progressValue);if(ret===errorObj){if(null!=ret.e&&"StopProgressPropagation"!==ret.e.name){var trace=util.canAttachTrace(ret.e)?ret.e:new Error(util.toString(ret.e));promise._attachExtraTrace(trace),promise._progress(ret.e)}}else ret instanceof Promise?ret._then(promise._progress,null,null,promise,void 0):promise._progress(ret)},Promise.prototype._progressUnchecked=function(progressValue){for(var len=this._length(),progress=this._progress,i=0;len>i;i++){var handler=this._progressHandlerAt(i),promise=this._promiseAt(i);if(promise instanceof Promise)"function"==typeof handler?async.invoke(this._doProgressWith,this,{handler:handler,promise:promise,receiver:this._receiverAt(i),value:progressValue}):async.invoke(progress,promise,progressValue);else{var receiver=this._receiverAt(i);"function"==typeof handler?handler.call(receiver,progressValue,promise):receiver instanceof PromiseArray&&!receiver._isResolved()&&receiver._promiseProgressed(progressValue,promise)}}}}},{"./async.js":2,"./util.js":38}],23:[function(_dereq_,module,exports){"use strict";module.exports=function(){function Promise(resolver){if("function"!=typeof resolver)throw new TypeError("the promise constructor requires a resolver function\n\n    See http://goo.gl/EC22Yn\n");if(this.constructor!==Promise)throw new TypeError("the promise constructor cannot be invoked directly\n\n    See http://goo.gl/KsIlge\n");this._bitField=0,this._fulfillmentHandler0=void 0,this._rejectionHandler0=void 0,this._progressHandler0=void 0,this._promise0=void 0,this._receiver0=void 0,this._settledValue=void 0,resolver!==INTERNAL&&this._resolveFromResolver(resolver)}function fillTypes(value){var p=new Promise(INTERNAL);p._fulfillmentHandler0=value,p._rejectionHandler0=value,p._progressHandler0=value,p._promise0=value,p._receiver0=value,p._settledValue=value}var getDomain,makeSelfResolutionError=function(){return new TypeError("circular promise resolution chain\n\n    See http://goo.gl/LhFpo0\n")},reflect=function(){return new Promise.PromiseInspection(this._target())},apiRejection=function(msg){return Promise.reject(new TypeError(msg))},util=_dereq_("./util.js");getDomain=util.isNode?function(){var ret=process.domain;return void 0===ret&&(ret=null),ret}:function(){return null},util.notEnumerableProp(Promise,"_getDomain",getDomain);var UNDEFINED_BINDING={},async=_dereq_("./async.js"),errors=_dereq_("./errors.js"),TypeError=Promise.TypeError=errors.TypeError;Promise.RangeError=errors.RangeError,Promise.CancellationError=errors.CancellationError,Promise.TimeoutError=errors.TimeoutError,Promise.OperationalError=errors.OperationalError,Promise.RejectionError=errors.OperationalError,Promise.AggregateError=errors.AggregateError;var INTERNAL=function(){},APPLY={},NEXT_FILTER={e:null},tryConvertToPromise=_dereq_("./thenables.js")(Promise,INTERNAL),PromiseArray=_dereq_("./promise_array.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),CapturedTrace=_dereq_("./captured_trace.js")(),isDebugging=_dereq_("./debuggability.js")(Promise,CapturedTrace),createContext=_dereq_("./context.js")(Promise,CapturedTrace,isDebugging),CatchFilter=_dereq_("./catch_filter.js")(NEXT_FILTER),PromiseResolver=_dereq_("./promise_resolver.js"),nodebackForPromise=PromiseResolver._nodebackForPromise,errorObj=util.errorObj,tryCatch=util.tryCatch;return Promise.prototype.toString=function(){return"[object Promise]"},Promise.prototype.caught=Promise.prototype["catch"]=function(fn){var len=arguments.length;if(len>1){var i,catchInstances=new Array(len-1),j=0;for(i=0;len-1>i;++i){var item=arguments[i];if("function"!=typeof item)return Promise.reject(new TypeError("Catch filter must inherit from Error or be a simple predicate function\n\n    See http://goo.gl/o84o68\n"));catchInstances[j++]=item}catchInstances.length=j,fn=arguments[i];var catchFilter=new CatchFilter(catchInstances,fn,this);return this._then(void 0,catchFilter.doFilter,void 0,catchFilter,void 0)}return this._then(void 0,fn,void 0,void 0,void 0)},Promise.prototype.reflect=function(){return this._then(reflect,reflect,void 0,this,void 0)},Promise.prototype.then=function(didFulfill,didReject,didProgress){if(isDebugging()&&arguments.length>0&&"function"!=typeof didFulfill&&"function"!=typeof didReject){var msg=".then() only accepts functions but was passed: "+util.classString(didFulfill);arguments.length>1&&(msg+=", "+util.classString(didReject)),this._warn(msg)}return this._then(didFulfill,didReject,didProgress,void 0,void 0)},Promise.prototype.done=function(didFulfill,didReject,didProgress){var promise=this._then(didFulfill,didReject,didProgress,void 0,void 0);promise._setIsFinal()},Promise.prototype.spread=function(didFulfill,didReject){return this.all()._then(didFulfill,didReject,void 0,APPLY,void 0)},Promise.prototype.isCancellable=function(){return!this.isResolved()&&this._cancellable()},Promise.prototype.toJSON=function(){var ret={isFulfilled:!1,isRejected:!1,fulfillmentValue:void 0,rejectionReason:void 0};return this.isFulfilled()?(ret.fulfillmentValue=this.value(),ret.isFulfilled=!0):this.isRejected()&&(ret.rejectionReason=this.reason(),ret.isRejected=!0),ret},Promise.prototype.all=function(){return new PromiseArray(this).promise()},Promise.prototype.error=function(fn){return this.caught(util.originatesFromRejection,fn)},Promise.is=function(val){return val instanceof Promise},Promise.fromNode=function(fn){var ret=new Promise(INTERNAL),result=tryCatch(fn)(nodebackForPromise(ret));return result===errorObj&&ret._rejectCallback(result.e,!0,!0),ret},Promise.all=function(promises){return new PromiseArray(promises).promise()},Promise.defer=Promise.pending=function(){var promise=new Promise(INTERNAL);return new PromiseResolver(promise)},Promise.cast=function(obj){var ret=tryConvertToPromise(obj);if(!(ret instanceof Promise)){var val=ret;ret=new Promise(INTERNAL),ret._fulfillUnchecked(val)}return ret},Promise.resolve=Promise.fulfilled=Promise.cast,Promise.reject=Promise.rejected=function(reason){var ret=new Promise(INTERNAL);return ret._captureStackTrace(),ret._rejectCallback(reason,!0),ret},Promise.setScheduler=function(fn){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var prev=async._schedule;return async._schedule=fn,prev},Promise.prototype._then=function(didFulfill,didReject,didProgress,receiver,internalData){var haveInternalData=void 0!==internalData,ret=haveInternalData?internalData:new Promise(INTERNAL);haveInternalData||(ret._propagateFrom(this,5),ret._captureStackTrace());var target=this._target();target!==this&&(void 0===receiver&&(receiver=this._boundTo),haveInternalData||ret._setIsMigrated());var callbackIndex=target._addCallbacks(didFulfill,didReject,didProgress,ret,receiver,getDomain());return target._isResolved()&&!target._isSettlePromisesQueued()&&async.invoke(target._settlePromiseAtPostResolution,target,callbackIndex),ret},Promise.prototype._settlePromiseAtPostResolution=function(index){this._isRejectionUnhandled()&&this._unsetRejectionIsUnhandled(),this._settlePromiseAt(index)},Promise.prototype._length=function(){return 131071&this._bitField},Promise.prototype._isFollowingOrFulfilledOrRejected=function(){return(939524096&this._bitField)>0},Promise.prototype._isFollowing=function(){return 536870912===(536870912&this._bitField)},Promise.prototype._setLength=function(len){this._bitField=-131072&this._bitField|131071&len},Promise.prototype._setFulfilled=function(){this._bitField=268435456|this._bitField},Promise.prototype._setRejected=function(){this._bitField=134217728|this._bitField},Promise.prototype._setFollowing=function(){this._bitField=536870912|this._bitField},Promise.prototype._setIsFinal=function(){this._bitField=33554432|this._bitField},Promise.prototype._isFinal=function(){return(33554432&this._bitField)>0},Promise.prototype._cancellable=function(){return(67108864&this._bitField)>0},Promise.prototype._setCancellable=function(){this._bitField=67108864|this._bitField},Promise.prototype._unsetCancellable=function(){this._bitField=-67108865&this._bitField},Promise.prototype._setIsMigrated=function(){this._bitField=4194304|this._bitField},Promise.prototype._unsetIsMigrated=function(){this._bitField=-4194305&this._bitField},Promise.prototype._isMigrated=function(){return(4194304&this._bitField)>0},Promise.prototype._receiverAt=function(index){var ret=0===index?this._receiver0:this[5*index-5+4];return ret===UNDEFINED_BINDING?void 0:void 0===ret&&this._isBound()?this._boundValue():ret},Promise.prototype._promiseAt=function(index){return 0===index?this._promise0:this[5*index-5+3]},Promise.prototype._fulfillmentHandlerAt=function(index){return 0===index?this._fulfillmentHandler0:this[5*index-5+0]},Promise.prototype._rejectionHandlerAt=function(index){return 0===index?this._rejectionHandler0:this[5*index-5+1]},Promise.prototype._boundValue=function(){var ret=this._boundTo;return void 0!==ret&&ret instanceof Promise?ret.isFulfilled()?ret.value():void 0:ret},Promise.prototype._migrateCallbacks=function(follower,index){var fulfill=follower._fulfillmentHandlerAt(index),reject=follower._rejectionHandlerAt(index),progress=follower._progressHandlerAt(index),promise=follower._promiseAt(index),receiver=follower._receiverAt(index);promise instanceof Promise&&promise._setIsMigrated(),void 0===receiver&&(receiver=UNDEFINED_BINDING),this._addCallbacks(fulfill,reject,progress,promise,receiver,null)},Promise.prototype._addCallbacks=function(fulfill,reject,progress,promise,receiver,domain){var index=this._length();if(index>=131066&&(index=0,this._setLength(0)),0===index)this._promise0=promise,void 0!==receiver&&(this._receiver0=receiver),"function"!=typeof fulfill||this._isCarryingStackTrace()||(this._fulfillmentHandler0=null===domain?fulfill:domain.bind(fulfill)),"function"==typeof reject&&(this._rejectionHandler0=null===domain?reject:domain.bind(reject)),"function"==typeof progress&&(this._progressHandler0=null===domain?progress:domain.bind(progress));else{var base=5*index-5;this[base+3]=promise,this[base+4]=receiver,"function"==typeof fulfill&&(this[base+0]=null===domain?fulfill:domain.bind(fulfill)),"function"==typeof reject&&(this[base+1]=null===domain?reject:domain.bind(reject)),"function"==typeof progress&&(this[base+2]=null===domain?progress:domain.bind(progress))}return this._setLength(index+1),index},Promise.prototype._setProxyHandlers=function(receiver,promiseSlotValue){var index=this._length();if(index>=131066&&(index=0,this._setLength(0)),0===index)this._promise0=promiseSlotValue,this._receiver0=receiver;else{var base=5*index-5;this[base+3]=promiseSlotValue,this[base+4]=receiver}this._setLength(index+1)},Promise.prototype._proxyPromiseArray=function(promiseArray,index){this._setProxyHandlers(promiseArray,index)},Promise.prototype._resolveCallback=function(value,shouldBind){if(!this._isFollowingOrFulfilledOrRejected()){if(value===this)return this._rejectCallback(makeSelfResolutionError(),!1,!0);var maybePromise=tryConvertToPromise(value,this);if(!(maybePromise instanceof Promise))return this._fulfill(value);var propagationFlags=1|(shouldBind?4:0);this._propagateFrom(maybePromise,propagationFlags);var promise=maybePromise._target();if(promise._isPending()){for(var len=this._length(),i=0;len>i;++i)promise._migrateCallbacks(this,i);this._setFollowing(),this._setLength(0),this._setFollowee(promise)}else promise._isFulfilled()?this._fulfillUnchecked(promise._value()):this._rejectUnchecked(promise._reason(),promise._getCarriedStackTrace())}},Promise.prototype._rejectCallback=function(reason,synchronous,shouldNotMarkOriginatingFromRejection){shouldNotMarkOriginatingFromRejection||util.markAsOriginatingFromRejection(reason);var trace=util.ensureErrorObject(reason),hasStack=trace===reason;this._attachExtraTrace(trace,synchronous?hasStack:!1),this._reject(reason,hasStack?void 0:trace)},Promise.prototype._resolveFromResolver=function(resolver){var promise=this;this._captureStackTrace(),this._pushContext();var synchronous=!0,r=tryCatch(resolver)(function(value){null!==promise&&(promise._resolveCallback(value),promise=null)},function(reason){null!==promise&&(promise._rejectCallback(reason,synchronous),promise=null)});synchronous=!1,this._popContext(),void 0!==r&&r===errorObj&&null!==promise&&(promise._rejectCallback(r.e,!0,!0),promise=null)},Promise.prototype._settlePromiseFromHandler=function(handler,receiver,value,promise){if(!promise._isRejected()){promise._pushContext();var x;if(x=receiver!==APPLY||this._isRejected()?tryCatch(handler).call(receiver,value):tryCatch(handler).apply(this._boundValue(),value),promise._popContext(),x===errorObj||x===promise||x===NEXT_FILTER){var err=x===promise?makeSelfResolutionError():x.e;promise._rejectCallback(err,!1,!0)}else promise._resolveCallback(x)}},Promise.prototype._target=function(){for(var ret=this;ret._isFollowing();)ret=ret._followee();return ret},Promise.prototype._followee=function(){return this._rejectionHandler0},Promise.prototype._setFollowee=function(promise){this._rejectionHandler0=promise},Promise.prototype._cleanValues=function(){this._cancellable()&&(this._cancellationParent=void 0)},Promise.prototype._propagateFrom=function(parent,flags){(1&flags)>0&&parent._cancellable()&&(this._setCancellable(),this._cancellationParent=parent),(4&flags)>0&&parent._isBound()&&this._setBoundTo(parent._boundTo)},Promise.prototype._fulfill=function(value){this._isFollowingOrFulfilledOrRejected()||this._fulfillUnchecked(value)},Promise.prototype._reject=function(reason,carriedStackTrace){this._isFollowingOrFulfilledOrRejected()||this._rejectUnchecked(reason,carriedStackTrace)},Promise.prototype._settlePromiseAt=function(index){var promise=this._promiseAt(index),isPromise=promise instanceof Promise;if(isPromise&&promise._isMigrated())return promise._unsetIsMigrated(),async.invoke(this._settlePromiseAt,this,index);var handler=this._isFulfilled()?this._fulfillmentHandlerAt(index):this._rejectionHandlerAt(index),carriedStackTrace=this._isCarryingStackTrace()?this._getCarriedStackTrace():void 0,value=this._settledValue,receiver=this._receiverAt(index);this._clearCallbackDataAtIndex(index),"function"==typeof handler?isPromise?this._settlePromiseFromHandler(handler,receiver,value,promise):handler.call(receiver,value,promise):receiver instanceof PromiseArray?receiver._isResolved()||(this._isFulfilled()?receiver._promiseFulfilled(value,promise):receiver._promiseRejected(value,promise)):isPromise&&(this._isFulfilled()?promise._fulfill(value):promise._reject(value,carriedStackTrace)),index>=4&&4===(31&index)&&async.invokeLater(this._setLength,this,0)},Promise.prototype._clearCallbackDataAtIndex=function(index){if(0===index)this._isCarryingStackTrace()||(this._fulfillmentHandler0=void 0),this._rejectionHandler0=this._progressHandler0=this._receiver0=this._promise0=void 0;else{var base=5*index-5;this[base+3]=this[base+4]=this[base+0]=this[base+1]=this[base+2]=void 0}},Promise.prototype._isSettlePromisesQueued=function(){return-1073741824===(-1073741824&this._bitField)},Promise.prototype._setSettlePromisesQueued=function(){this._bitField=-1073741824|this._bitField},Promise.prototype._unsetSettlePromisesQueued=function(){this._bitField=1073741823&this._bitField},Promise.prototype._queueSettlePromises=function(){async.settlePromises(this),this._setSettlePromisesQueued()},Promise.prototype._fulfillUnchecked=function(value){if(value===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err,void 0)}this._setFulfilled(),this._settledValue=value,this._cleanValues(),this._length()>0&&this._queueSettlePromises()},Promise.prototype._rejectUncheckedCheckError=function(reason){var trace=util.ensureErrorObject(reason);this._rejectUnchecked(reason,trace===reason?void 0:trace)},Promise.prototype._rejectUnchecked=function(reason,trace){if(reason===this){var err=makeSelfResolutionError();return this._attachExtraTrace(err),this._rejectUnchecked(err)}return this._setRejected(),this._settledValue=reason,this._cleanValues(),this._isFinal()?void async.throwLater(function(e){throw"stack"in e&&async.invokeFirst(CapturedTrace.unhandledRejection,void 0,e),e},void 0===trace?reason:trace):(void 0!==trace&&trace!==reason&&this._setCarriedStackTrace(trace),void(this._length()>0?this._queueSettlePromises():this._ensurePossibleRejectionHandled()))},Promise.prototype._settlePromises=function(){this._unsetSettlePromisesQueued();for(var len=this._length(),i=0;len>i;i++)this._settlePromiseAt(i)},util.notEnumerableProp(Promise,"_makeSelfResolutionError",makeSelfResolutionError),_dereq_("./progress.js")(Promise,PromiseArray),_dereq_("./method.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),_dereq_("./bind.js")(Promise,INTERNAL,tryConvertToPromise),_dereq_("./finally.js")(Promise,NEXT_FILTER,tryConvertToPromise),_dereq_("./direct_resolve.js")(Promise),_dereq_("./synchronous_inspection.js")(Promise),_dereq_("./join.js")(Promise,PromiseArray,tryConvertToPromise,INTERNAL),Promise.Promise=Promise,_dereq_("./map.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL),_dereq_("./cancel.js")(Promise),_dereq_("./using.js")(Promise,apiRejection,tryConvertToPromise,createContext),_dereq_("./generators.js")(Promise,apiRejection,INTERNAL,tryConvertToPromise),_dereq_("./nodeify.js")(Promise),_dereq_("./call_get.js")(Promise),_dereq_("./props.js")(Promise,PromiseArray,tryConvertToPromise,apiRejection),_dereq_("./race.js")(Promise,INTERNAL,tryConvertToPromise,apiRejection),_dereq_("./reduce.js")(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL),_dereq_("./settle.js")(Promise,PromiseArray),_dereq_("./some.js")(Promise,PromiseArray,apiRejection),_dereq_("./promisify.js")(Promise,INTERNAL),_dereq_("./any.js")(Promise),_dereq_("./each.js")(Promise,INTERNAL),_dereq_("./timers.js")(Promise,INTERNAL),_dereq_("./filter.js")(Promise,INTERNAL),util.toFastProperties(Promise),util.toFastProperties(Promise.prototype),fillTypes({a:1}),fillTypes({b:2}),fillTypes({c:3}),fillTypes(1),fillTypes(function(){}),fillTypes(void 0),fillTypes(!1),fillTypes(new Promise(INTERNAL)),CapturedTrace.setBounds(async.firstLineError,util.lastLineError),Promise}},{"./any.js":1,"./async.js":2,"./bind.js":3,"./call_get.js":5,"./cancel.js":6,"./captured_trace.js":7,"./catch_filter.js":8,"./context.js":9,"./debuggability.js":10,"./direct_resolve.js":11,"./each.js":12,"./errors.js":13,"./filter.js":15,"./finally.js":16,"./generators.js":17,"./join.js":18,"./map.js":19,"./method.js":20,"./nodeify.js":21,"./progress.js":22,"./promise_array.js":24,"./promise_resolver.js":25,"./promisify.js":26,"./props.js":27,"./race.js":29,"./reduce.js":30,"./settle.js":32,"./some.js":33,"./synchronous_inspection.js":34,"./thenables.js":35,"./timers.js":36,"./using.js":37,"./util.js":38}],24:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function toResolutionValue(val){switch(val){case-2:return[];case-3:return{}}}function PromiseArray(values){var parent,promise=this._promise=new Promise(INTERNAL);values instanceof Promise&&(parent=values,promise._propagateFrom(parent,5)),this._values=values,this._length=0,this._totalResolved=0,this._init(void 0,-2)}var util=_dereq_("./util.js"),isArray=util.isArray;return PromiseArray.prototype.length=function(){return this._length},PromiseArray.prototype.promise=function(){return this._promise},PromiseArray.prototype._init=function init(_,resolveValueIfEmpty){var values=tryConvertToPromise(this._values,this._promise);if(values instanceof Promise){if(values=values._target(),this._values=values,!values._isFulfilled())return values._isPending()?void values._then(init,this._reject,void 0,this,resolveValueIfEmpty):void this._reject(values._reason());if(values=values._value(),!isArray(values)){var err=new Promise.TypeError("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");return void this.__hardReject__(err)}}else if(!isArray(values))return void this._promise._reject(apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n")._reason());if(0===values.length)return void(-5===resolveValueIfEmpty?this._resolveEmptyArray():this._resolve(toResolutionValue(resolveValueIfEmpty)));var len=this.getActualLength(values.length);this._length=len,this._values=this.shouldCopyValues()?new Array(len):this._values;for(var promise=this._promise,i=0;len>i;++i){var isResolved=this._isResolved(),maybePromise=tryConvertToPromise(values[i],promise);maybePromise instanceof Promise?(maybePromise=maybePromise._target(),isResolved?maybePromise._ignoreRejections():maybePromise._isPending()?maybePromise._proxyPromiseArray(this,i):maybePromise._isFulfilled()?this._promiseFulfilled(maybePromise._value(),i):this._promiseRejected(maybePromise._reason(),i)):isResolved||this._promiseFulfilled(maybePromise,i)}},PromiseArray.prototype._isResolved=function(){return null===this._values},PromiseArray.prototype._resolve=function(value){this._values=null,this._promise._fulfill(value)},PromiseArray.prototype.__hardReject__=PromiseArray.prototype._reject=function(reason){this._values=null,this._promise._rejectCallback(reason,!1,!0)},PromiseArray.prototype._promiseProgressed=function(progressValue,index){this._promise._progress({index:index,value:progressValue})},PromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},PromiseArray.prototype._promiseRejected=function(reason,index){this._totalResolved++,this._reject(reason)},PromiseArray.prototype.shouldCopyValues=function(){return!0},PromiseArray.prototype.getActualLength=function(len){return len},PromiseArray}},{"./util.js":38}],25:[function(_dereq_,module,exports){"use strict";function isUntypedError(obj){return obj instanceof Error&&es5.getPrototypeOf(obj)===Error.prototype}function wrapAsOperationalError(obj){var ret;if(isUntypedError(obj)){ret=new OperationalError(obj),ret.name=obj.name,ret.message=obj.message,ret.stack=obj.stack;for(var keys=es5.keys(obj),i=0;i<keys.length;++i){var key=keys[i];rErrorKey.test(key)||(ret[key]=obj[key])}return ret}return util.markAsOriginatingFromRejection(obj),obj}function nodebackForPromise(promise){return function(err,value){if(null!==promise){if(err){var wrapped=wrapAsOperationalError(maybeWrapAsError(err));promise._attachExtraTrace(wrapped),promise._reject(wrapped)}else if(arguments.length>2){for(var $_len=arguments.length,args=new Array($_len-1),$_i=1;$_len>$_i;++$_i)args[$_i-1]=arguments[$_i];promise._fulfill(args)}else promise._fulfill(value);promise=null}}}var PromiseResolver,util=_dereq_("./util.js"),maybeWrapAsError=util.maybeWrapAsError,errors=_dereq_("./errors.js"),TimeoutError=errors.TimeoutError,OperationalError=errors.OperationalError,haveGetters=util.haveGetters,es5=_dereq_("./es5.js"),rErrorKey=/^(?:name|message|stack|cause)$/;if(PromiseResolver=haveGetters?function(promise){this.promise=promise}:function(promise){this.promise=promise,this.asCallback=nodebackForPromise(promise),this.callback=this.asCallback},haveGetters){var prop={get:function(){return nodebackForPromise(this.promise)}};es5.defineProperty(PromiseResolver.prototype,"asCallback",prop),es5.defineProperty(PromiseResolver.prototype,"callback",prop)}PromiseResolver._nodebackForPromise=nodebackForPromise,PromiseResolver.prototype.toString=function(){return"[object PromiseResolver]"},PromiseResolver.prototype.resolve=PromiseResolver.prototype.fulfill=function(value){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");
this.promise._resolveCallback(value)},PromiseResolver.prototype.reject=function(reason){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._rejectCallback(reason)},PromiseResolver.prototype.progress=function(value){if(!(this instanceof PromiseResolver))throw new TypeError("Illegal invocation, resolver resolve/reject must be called within a resolver context. Consider using the promise constructor instead.\n\n    See http://goo.gl/sdkXL9\n");this.promise._progress(value)},PromiseResolver.prototype.cancel=function(err){this.promise.cancel(err)},PromiseResolver.prototype.timeout=function(){this.reject(new TimeoutError("timeout"))},PromiseResolver.prototype.isResolved=function(){return this.promise.isResolved()},PromiseResolver.prototype.toJSON=function(){return this.promise.toJSON()},module.exports=PromiseResolver},{"./errors.js":13,"./es5.js":14,"./util.js":38}],26:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function propsFilter(key){return!noCopyPropsPattern.test(key)}function isPromisified(fn){try{return fn.__isPromisified__===!0}catch(e){return!1}}function hasPromisified(obj,key,suffix){var val=util.getDataPropertyOrDefault(obj,key+suffix,defaultPromisified);return val?isPromisified(val):!1}function checkValid(ret,suffix,suffixRegexp){for(var i=0;i<ret.length;i+=2){var key=ret[i];if(suffixRegexp.test(key))for(var keyWithoutAsyncSuffix=key.replace(suffixRegexp,""),j=0;j<ret.length;j+=2)if(ret[j]===keyWithoutAsyncSuffix)throw new TypeError("Cannot promisify an API that has normal methods with '%s'-suffix\n\n    See http://goo.gl/iWrZbw\n".replace("%s",suffix))}}function promisifiableMethods(obj,suffix,suffixRegexp,filter){for(var keys=util.inheritedDataKeys(obj),ret=[],i=0;i<keys.length;++i){var key=keys[i],value=obj[key],passesDefaultFilter=filter===defaultFilter?!0:defaultFilter(key,value,obj);"function"!=typeof value||isPromisified(value)||hasPromisified(obj,key,suffix)||!filter(key,value,obj,passesDefaultFilter)||ret.push(key,value)}return checkValid(ret,suffix,suffixRegexp),ret}function makeNodePromisifiedClosure(callback,receiver,_,fn){function promisified(){var _receiver=receiver;receiver===THIS&&(_receiver=this);var promise=new Promise(INTERNAL);promise._captureStackTrace();var cb="string"==typeof method&&this!==defaultThis?this[method]:callback,fn=nodebackForPromise(promise);try{cb.apply(_receiver,withAppended(arguments,fn))}catch(e){promise._rejectCallback(maybeWrapAsError(e),!0,!0)}return promise}var defaultThis=function(){return this}(),method=callback;return"string"==typeof method&&(callback=fn),util.notEnumerableProp(promisified,"__isPromisified__",!0),promisified}function promisifyAll(obj,suffix,filter,promisifier){for(var suffixRegexp=new RegExp(escapeIdentRegex(suffix)+"$"),methods=promisifiableMethods(obj,suffix,suffixRegexp,filter),i=0,len=methods.length;len>i;i+=2){var key=methods[i],fn=methods[i+1],promisifiedKey=key+suffix;if(promisifier===makeNodePromisified)obj[promisifiedKey]=makeNodePromisified(key,THIS,key,fn,suffix);else{var promisified=promisifier(fn,function(){return makeNodePromisified(key,THIS,key,fn,suffix)});util.notEnumerableProp(promisified,"__isPromisified__",!0),obj[promisifiedKey]=promisified}}return util.toFastProperties(obj),obj}function promisify(callback,receiver){return makeNodePromisified(callback,receiver,void 0,callback)}var makeNodePromisifiedEval,THIS={},util=_dereq_("./util.js"),nodebackForPromise=_dereq_("./promise_resolver.js")._nodebackForPromise,withAppended=util.withAppended,maybeWrapAsError=util.maybeWrapAsError,canEvaluate=util.canEvaluate,TypeError=_dereq_("./errors").TypeError,defaultSuffix="Async",defaultPromisified={__isPromisified__:!0},noCopyProps=["arity","length","name","arguments","caller","callee","prototype","__isPromisified__"],noCopyPropsPattern=new RegExp("^(?:"+noCopyProps.join("|")+")$"),defaultFilter=function(name){return util.isIdentifier(name)&&"_"!==name.charAt(0)&&"constructor"!==name},escapeIdentRegex=function(str){return str.replace(/([$])/,"\\$")},makeNodePromisified=canEvaluate?makeNodePromisifiedEval:makeNodePromisifiedClosure;Promise.promisify=function(fn,receiver){if("function"!=typeof fn)throw new TypeError("fn must be a function\n\n    See http://goo.gl/916lJJ\n");if(isPromisified(fn))return fn;var ret=promisify(fn,arguments.length<2?THIS:receiver);return util.copyDescriptors(fn,ret,propsFilter),ret},Promise.promisifyAll=function(target,options){if("function"!=typeof target&&"object"!=typeof target)throw new TypeError("the target of promisifyAll must be an object or a function\n\n    See http://goo.gl/9ITlV0\n");options=Object(options);var suffix=options.suffix;"string"!=typeof suffix&&(suffix=defaultSuffix);var filter=options.filter;"function"!=typeof filter&&(filter=defaultFilter);var promisifier=options.promisifier;if("function"!=typeof promisifier&&(promisifier=makeNodePromisified),!util.isIdentifier(suffix))throw new RangeError("suffix must be a valid identifier\n\n    See http://goo.gl/8FZo5V\n");for(var keys=util.inheritedDataKeys(target),i=0;i<keys.length;++i){var value=target[keys[i]];"constructor"!==keys[i]&&util.isClass(value)&&(promisifyAll(value.prototype,suffix,filter,promisifier),promisifyAll(value,suffix,filter,promisifier))}return promisifyAll(target,suffix,filter,promisifier)}}},{"./errors":13,"./promise_resolver.js":25,"./util.js":38}],27:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,tryConvertToPromise,apiRejection){function PropertiesPromiseArray(obj){for(var keys=es5.keys(obj),len=keys.length,values=new Array(2*len),i=0;len>i;++i){var key=keys[i];values[i]=obj[key],values[i+len]=key}this.constructor$(values)}function props(promises){var ret,castValue=tryConvertToPromise(promises);return isObject(castValue)?(ret=castValue instanceof Promise?castValue._then(Promise.props,void 0,void 0,void 0,void 0):new PropertiesPromiseArray(castValue).promise(),castValue instanceof Promise&&ret._propagateFrom(castValue,4),ret):apiRejection("cannot await properties of a non-object\n\n    See http://goo.gl/OsFKC8\n")}var util=_dereq_("./util.js"),isObject=util.isObject,es5=_dereq_("./es5.js");util.inherits(PropertiesPromiseArray,PromiseArray),PropertiesPromiseArray.prototype._init=function(){this._init$(void 0,-3)},PropertiesPromiseArray.prototype._promiseFulfilled=function(value,index){this._values[index]=value;var totalResolved=++this._totalResolved;if(totalResolved>=this._length){for(var val={},keyOffset=this.length(),i=0,len=this.length();len>i;++i)val[this._values[i+keyOffset]]=this._values[i];this._resolve(val)}},PropertiesPromiseArray.prototype._promiseProgressed=function(value,index){this._promise._progress({key:this._values[index+this.length()],value:value})},PropertiesPromiseArray.prototype.shouldCopyValues=function(){return!1},PropertiesPromiseArray.prototype.getActualLength=function(len){return len>>1},Promise.prototype.props=function(){return props(this)},Promise.props=function(promises){return props(promises)}}},{"./es5.js":14,"./util.js":38}],28:[function(_dereq_,module,exports){"use strict";function arrayMove(src,srcIndex,dst,dstIndex,len){for(var j=0;len>j;++j)dst[j+dstIndex]=src[j+srcIndex],src[j+srcIndex]=void 0}function Queue(capacity){this._capacity=capacity,this._length=0,this._front=0}Queue.prototype._willBeOverCapacity=function(size){return this._capacity<size},Queue.prototype._pushOne=function(arg){var length=this.length();this._checkCapacity(length+1);var i=this._front+length&this._capacity-1;this[i]=arg,this._length=length+1},Queue.prototype._unshiftOne=function(value){var capacity=this._capacity;this._checkCapacity(this.length()+1);var front=this._front,i=(front-1&capacity-1^capacity)-capacity;this[i]=value,this._front=i,this._length=this.length()+1},Queue.prototype.unshift=function(fn,receiver,arg){this._unshiftOne(arg),this._unshiftOne(receiver),this._unshiftOne(fn)},Queue.prototype.push=function(fn,receiver,arg){var length=this.length()+3;if(this._willBeOverCapacity(length))return this._pushOne(fn),this._pushOne(receiver),void this._pushOne(arg);var j=this._front+length-3;this._checkCapacity(length);var wrapMask=this._capacity-1;this[j+0&wrapMask]=fn,this[j+1&wrapMask]=receiver,this[j+2&wrapMask]=arg,this._length=length},Queue.prototype.shift=function(){var front=this._front,ret=this[front];return this[front]=void 0,this._front=front+1&this._capacity-1,this._length--,ret},Queue.prototype.length=function(){return this._length},Queue.prototype._checkCapacity=function(size){this._capacity<size&&this._resizeTo(this._capacity<<1)},Queue.prototype._resizeTo=function(capacity){var oldCapacity=this._capacity;this._capacity=capacity;var front=this._front,length=this._length,moveItemsCount=front+length&oldCapacity-1;arrayMove(this,0,this,oldCapacity,moveItemsCount)},module.exports=Queue},{}],29:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL,tryConvertToPromise,apiRejection){function race(promises,parent){var maybePromise=tryConvertToPromise(promises);if(maybePromise instanceof Promise)return raceLater(maybePromise);if(!isArray(promises))return apiRejection("expecting an array, a promise or a thenable\n\n    See http://goo.gl/s8MMhc\n");var ret=new Promise(INTERNAL);void 0!==parent&&ret._propagateFrom(parent,5);for(var fulfill=ret._fulfill,reject=ret._reject,i=0,len=promises.length;len>i;++i){var val=promises[i];(void 0!==val||i in promises)&&Promise.cast(val)._then(fulfill,reject,void 0,ret,null)}return ret}var isArray=_dereq_("./util.js").isArray,raceLater=function(promise){return promise.then(function(array){return race(array,promise)})};Promise.race=function(promises){return race(promises,void 0)},Promise.prototype.race=function(){return race(this,void 0)}}},{"./util.js":38}],30:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection,tryConvertToPromise,INTERNAL){function ReductionPromiseArray(promises,fn,accum,_each){this.constructor$(promises),this._promise._captureStackTrace(),this._preservedValues=_each===INTERNAL?[]:null,this._zerothIsAccum=void 0===accum,this._gotAccum=!1,this._reducingIndex=this._zerothIsAccum?1:0,this._valuesPhase=void 0;var maybePromise=tryConvertToPromise(accum,this._promise),rejected=!1,isPromise=maybePromise instanceof Promise;isPromise&&(maybePromise=maybePromise._target(),maybePromise._isPending()?maybePromise._proxyPromiseArray(this,-1):maybePromise._isFulfilled()?(accum=maybePromise._value(),this._gotAccum=!0):(this._reject(maybePromise._reason()),rejected=!0)),isPromise||this._zerothIsAccum||(this._gotAccum=!0);var domain=getDomain();this._callback=null===domain?fn:domain.bind(fn),this._accum=accum,rejected||async.invoke(init,this,void 0)}function init(){this._init$(void 0,-5)}function reduce(promises,fn,initialValue,_each){if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var array=new ReductionPromiseArray(promises,fn,initialValue,_each);return array.promise()}var getDomain=Promise._getDomain,async=_dereq_("./async.js"),util=_dereq_("./util.js"),tryCatch=util.tryCatch,errorObj=util.errorObj;util.inherits(ReductionPromiseArray,PromiseArray),ReductionPromiseArray.prototype._init=function(){},ReductionPromiseArray.prototype._resolveEmptyArray=function(){(this._gotAccum||this._zerothIsAccum)&&this._resolve(null!==this._preservedValues?[]:this._accum)},ReductionPromiseArray.prototype._promiseFulfilled=function(value,index){var values=this._values;values[index]=value;var valuesPhaseIndex,length=this.length(),preservedValues=this._preservedValues,isEach=null!==preservedValues,gotAccum=this._gotAccum,valuesPhase=this._valuesPhase;if(!valuesPhase)for(valuesPhase=this._valuesPhase=new Array(length),valuesPhaseIndex=0;length>valuesPhaseIndex;++valuesPhaseIndex)valuesPhase[valuesPhaseIndex]=0;if(valuesPhaseIndex=valuesPhase[index],0===index&&this._zerothIsAccum?(this._accum=value,this._gotAccum=gotAccum=!0,valuesPhase[index]=0===valuesPhaseIndex?1:2):-1===index?(this._accum=value,this._gotAccum=gotAccum=!0):0===valuesPhaseIndex?valuesPhase[index]=1:(valuesPhase[index]=2,this._accum=value),gotAccum){for(var ret,callback=this._callback,receiver=this._promise._boundValue(),i=this._reducingIndex;length>i;++i)if(valuesPhaseIndex=valuesPhase[i],2!==valuesPhaseIndex){if(1!==valuesPhaseIndex)return;if(value=values[i],this._promise._pushContext(),isEach?(preservedValues.push(value),ret=tryCatch(callback).call(receiver,value,i,length)):ret=tryCatch(callback).call(receiver,this._accum,value,i,length),this._promise._popContext(),ret===errorObj)return this._reject(ret.e);var maybePromise=tryConvertToPromise(ret,this._promise);if(maybePromise instanceof Promise){if(maybePromise=maybePromise._target(),maybePromise._isPending())return valuesPhase[i]=4,maybePromise._proxyPromiseArray(this,i);if(!maybePromise._isFulfilled())return this._reject(maybePromise._reason());ret=maybePromise._value()}this._reducingIndex=i+1,this._accum=ret}else this._reducingIndex=i+1;this._resolve(isEach?preservedValues:this._accum)}},Promise.prototype.reduce=function(fn,initialValue){return reduce(this,fn,initialValue,null)},Promise.reduce=function(promises,fn,initialValue,_each){return reduce(promises,fn,initialValue,_each)}}},{"./async.js":2,"./util.js":38}],31:[function(_dereq_,module,exports){"use strict";var schedule,util=_dereq_("./util"),noAsyncScheduler=function(){throw new Error("No async scheduler available\n\n    See http://goo.gl/m3OTXk\n")};if(util.isNode&&"undefined"==typeof MutationObserver){var GlobalSetImmediate=global.setImmediate,ProcessNextTick=process.nextTick;schedule=util.isRecentNode?function(fn){GlobalSetImmediate.call(global,fn)}:function(fn){ProcessNextTick.call(process,fn)}}else"undefined"==typeof MutationObserver||"undefined"!=typeof window&&window.navigator&&window.navigator.standalone?schedule="undefined"!=typeof setImmediate?function(fn){setImmediate(fn)}:"undefined"!=typeof setTimeout?function(fn){setTimeout(fn,0)}:noAsyncScheduler:(schedule=function(fn){var div=document.createElement("div"),observer=new MutationObserver(fn);return observer.observe(div,{attributes:!0}),function(){div.classList.toggle("foo")}},schedule.isStatic=!0);module.exports=schedule},{"./util":38}],32:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray){function SettledPromiseArray(values){this.constructor$(values)}var PromiseInspection=Promise.PromiseInspection,util=_dereq_("./util.js");util.inherits(SettledPromiseArray,PromiseArray),SettledPromiseArray.prototype._promiseResolved=function(index,inspection){this._values[index]=inspection;var totalResolved=++this._totalResolved;totalResolved>=this._length&&this._resolve(this._values)},SettledPromiseArray.prototype._promiseFulfilled=function(value,index){var ret=new PromiseInspection;ret._bitField=268435456,ret._settledValue=value,this._promiseResolved(index,ret)},SettledPromiseArray.prototype._promiseRejected=function(reason,index){var ret=new PromiseInspection;ret._bitField=134217728,ret._settledValue=reason,this._promiseResolved(index,ret)},Promise.settle=function(promises){return new SettledPromiseArray(promises).promise()},Promise.prototype.settle=function(){return new SettledPromiseArray(this).promise()}}},{"./util.js":38}],33:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,PromiseArray,apiRejection){function SomePromiseArray(values){this.constructor$(values),this._howMany=0,this._unwrap=!1,this._initialized=!1}function some(promises,howMany){if((0|howMany)!==howMany||0>howMany)return apiRejection("expecting a positive integer\n\n    See http://goo.gl/1wAmHx\n");var ret=new SomePromiseArray(promises),promise=ret.promise();return ret.setHowMany(howMany),ret.init(),promise}var util=_dereq_("./util.js"),RangeError=_dereq_("./errors.js").RangeError,AggregateError=_dereq_("./errors.js").AggregateError,isArray=util.isArray;util.inherits(SomePromiseArray,PromiseArray),SomePromiseArray.prototype._init=function(){if(this._initialized){if(0===this._howMany)return void this._resolve([]);this._init$(void 0,-5);var isArrayResolved=isArray(this._values);!this._isResolved()&&isArrayResolved&&this._howMany>this._canPossiblyFulfill()&&this._reject(this._getRangeError(this.length()))}},SomePromiseArray.prototype.init=function(){this._initialized=!0,this._init()},SomePromiseArray.prototype.setUnwrap=function(){this._unwrap=!0},SomePromiseArray.prototype.howMany=function(){return this._howMany},SomePromiseArray.prototype.setHowMany=function(count){this._howMany=count},SomePromiseArray.prototype._promiseFulfilled=function(value){this._addFulfilled(value),this._fulfilled()===this.howMany()&&(this._values.length=this.howMany(),1===this.howMany()&&this._unwrap?this._resolve(this._values[0]):this._resolve(this._values))},SomePromiseArray.prototype._promiseRejected=function(reason){if(this._addRejected(reason),this.howMany()>this._canPossiblyFulfill()){for(var e=new AggregateError,i=this.length();i<this._values.length;++i)e.push(this._values[i]);this._reject(e)}},SomePromiseArray.prototype._fulfilled=function(){return this._totalResolved},SomePromiseArray.prototype._rejected=function(){return this._values.length-this.length()},SomePromiseArray.prototype._addRejected=function(reason){this._values.push(reason)},SomePromiseArray.prototype._addFulfilled=function(value){this._values[this._totalResolved++]=value},SomePromiseArray.prototype._canPossiblyFulfill=function(){return this.length()-this._rejected()},SomePromiseArray.prototype._getRangeError=function(count){var message="Input array must contain at least "+this._howMany+" items but contains only "+count+" items";return new RangeError(message)},SomePromiseArray.prototype._resolveEmptyArray=function(){this._reject(this._getRangeError(0))},Promise.some=function(promises,howMany){return some(promises,howMany)},Promise.prototype.some=function(howMany){return some(this,howMany)},Promise._SomePromiseArray=SomePromiseArray}},{"./errors.js":13,"./util.js":38}],34:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise){function PromiseInspection(promise){void 0!==promise?(promise=promise._target(),this._bitField=promise._bitField,this._settledValue=promise._settledValue):(this._bitField=0,this._settledValue=void 0)}PromiseInspection.prototype.value=function(){if(!this.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return this._settledValue},PromiseInspection.prototype.error=PromiseInspection.prototype.reason=function(){if(!this.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return this._settledValue},PromiseInspection.prototype.isFulfilled=Promise.prototype._isFulfilled=function(){return(268435456&this._bitField)>0},PromiseInspection.prototype.isRejected=Promise.prototype._isRejected=function(){return(134217728&this._bitField)>0},PromiseInspection.prototype.isPending=Promise.prototype._isPending=function(){return 0===(402653184&this._bitField)},PromiseInspection.prototype.isResolved=Promise.prototype._isResolved=function(){return(402653184&this._bitField)>0},Promise.prototype.isPending=function(){return this._target()._isPending()},Promise.prototype.isRejected=function(){return this._target()._isRejected()},Promise.prototype.isFulfilled=function(){return this._target()._isFulfilled()},Promise.prototype.isResolved=function(){return this._target()._isResolved()},Promise.prototype._value=function(){return this._settledValue},Promise.prototype._reason=function(){return this._unsetRejectionIsUnhandled(),this._settledValue},Promise.prototype.value=function(){var target=this._target();if(!target.isFulfilled())throw new TypeError("cannot get fulfillment value of a non-fulfilled promise\n\n    See http://goo.gl/hc1DLj\n");return target._settledValue},Promise.prototype.reason=function(){var target=this._target();if(!target.isRejected())throw new TypeError("cannot get rejection reason of a non-rejected promise\n\n    See http://goo.gl/hPuiwB\n");return target._unsetRejectionIsUnhandled(),target._settledValue},Promise.PromiseInspection=PromiseInspection}},{}],35:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function tryConvertToPromise(obj,context){if(isObject(obj)){if(obj instanceof Promise)return obj;if(isAnyBluebirdPromise(obj)){var ret=new Promise(INTERNAL);return obj._then(ret._fulfillUnchecked,ret._rejectUncheckedCheckError,ret._progressUnchecked,ret,null),ret}var then=util.tryCatch(getThen)(obj);if(then===errorObj){context&&context._pushContext();var ret=Promise.reject(then.e);return context&&context._popContext(),ret}if("function"==typeof then)return doThenable(obj,then,context)}return obj}function getThen(obj){return obj.then}function isAnyBluebirdPromise(obj){return hasProp.call(obj,"_promise0")}function doThenable(x,then,context){function resolveFromThenable(value){promise&&(promise._resolveCallback(value),promise=null)}function rejectFromThenable(reason){promise&&(promise._rejectCallback(reason,synchronous,!0),promise=null)}function progressFromThenable(value){promise&&"function"==typeof promise._progress&&promise._progress(value)}var promise=new Promise(INTERNAL),ret=promise;context&&context._pushContext(),promise._captureStackTrace(),context&&context._popContext();var synchronous=!0,result=util.tryCatch(then).call(x,resolveFromThenable,rejectFromThenable,progressFromThenable);return synchronous=!1,promise&&result===errorObj&&(promise._rejectCallback(result.e,!0,!0),promise=null),ret}var util=_dereq_("./util.js"),errorObj=util.errorObj,isObject=util.isObject,hasProp={}.hasOwnProperty;return tryConvertToPromise}},{"./util.js":38}],36:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,INTERNAL){function successClear(value){var handle=this;return handle instanceof Number&&(handle=+handle),clearTimeout(handle),value}function failureClear(reason){var handle=this;throw handle instanceof Number&&(handle=+handle),clearTimeout(handle),reason}var util=_dereq_("./util.js"),TimeoutError=Promise.TimeoutError,afterTimeout=function(promise,message){if(promise.isPending()){var err;!util.isPrimitive(message)&&message instanceof Error?err=message:("string"!=typeof message&&(message="operation timed out"),err=new TimeoutError(message)),util.markAsOriginatingFromRejection(err),promise._attachExtraTrace(err),promise._cancel(err)}},afterValue=function(value){return delay(+this).thenReturn(value)},delay=Promise.delay=function(value,ms){if(void 0===ms){ms=value,value=void 0;var ret=new Promise(INTERNAL);return setTimeout(function(){ret._fulfill()},ms),ret}return ms=+ms,Promise.resolve(value)._then(afterValue,null,null,ms,void 0)};Promise.prototype.delay=function(ms){return delay(this,ms)},Promise.prototype.timeout=function(ms,message){ms=+ms;var ret=this.then().cancellable();ret._cancellationParent=this;var handle=setTimeout(function(){afterTimeout(ret,message)},ms);return ret._then(successClear,failureClear,void 0,handle,void 0)}}},{"./util.js":38}],37:[function(_dereq_,module,exports){"use strict";module.exports=function(Promise,apiRejection,tryConvertToPromise,createContext){function inspectionMapper(inspections){for(var len=inspections.length,i=0;len>i;++i){var inspection=inspections[i];if(inspection.isRejected())return Promise.reject(inspection.error());inspections[i]=inspection._settledValue}return inspections}function thrower(e){setTimeout(function(){throw e},0)}function castPreservingDisposable(thenable){var maybePromise=tryConvertToPromise(thenable);return maybePromise!==thenable&&"function"==typeof thenable._isDisposable&&"function"==typeof thenable._getDisposer&&thenable._isDisposable()&&maybePromise._setDisposable(thenable._getDisposer()),maybePromise}function dispose(resources,inspection){function iterator(){if(i>=len)return ret.resolve();var maybePromise=castPreservingDisposable(resources[i++]);if(maybePromise instanceof Promise&&maybePromise._isDisposable()){try{maybePromise=tryConvertToPromise(maybePromise._getDisposer().tryDispose(inspection),resources.promise)}catch(e){return thrower(e)}if(maybePromise instanceof Promise)return maybePromise._then(iterator,thrower,null,null,null)}iterator()}var i=0,len=resources.length,ret=Promise.defer();return iterator(),ret.promise}function disposerSuccess(value){var inspection=new PromiseInspection;return inspection._settledValue=value,inspection._bitField=268435456,dispose(this,inspection).thenReturn(value)}function disposerFail(reason){var inspection=new PromiseInspection;return inspection._settledValue=reason,inspection._bitField=134217728,dispose(this,inspection).thenThrow(reason)}function Disposer(data,promise,context){this._data=data,this._promise=promise,this._context=context}function FunctionDisposer(fn,promise,context){this.constructor$(fn,promise,context)}function maybeUnwrapDisposer(value){return Disposer.isDisposer(value)?(this.resources[this.index]._setDisposable(value),value.promise()):value}var TypeError=_dereq_("./errors.js").TypeError,inherits=_dereq_("./util.js").inherits,PromiseInspection=Promise.PromiseInspection;Disposer.prototype.data=function(){return this._data},Disposer.prototype.promise=function(){return this._promise},Disposer.prototype.resource=function(){return this.promise().isFulfilled()?this.promise().value():null},Disposer.prototype.tryDispose=function(inspection){var resource=this.resource(),context=this._context;void 0!==context&&context._pushContext();var ret=null!==resource?this.doDispose(resource,inspection):null;return void 0!==context&&context._popContext(),this._promise._unsetDisposable(),this._data=null,ret},Disposer.isDisposer=function(d){return null!=d&&"function"==typeof d.resource&&"function"==typeof d.tryDispose},inherits(FunctionDisposer,Disposer),FunctionDisposer.prototype.doDispose=function(resource,inspection){var fn=this.data();return fn.call(resource,resource,inspection)},Promise.using=function(){var len=arguments.length;if(2>len)return apiRejection("you must pass at least 2 arguments to Promise.using");var fn=arguments[len-1];if("function"!=typeof fn)return apiRejection("fn must be a function\n\n    See http://goo.gl/916lJJ\n");var input,spreadArgs=!0;2===len&&Array.isArray(arguments[0])?(input=arguments[0],len=input.length,spreadArgs=!1):(input=arguments,len--);for(var resources=new Array(len),i=0;len>i;++i){var resource=input[i];if(Disposer.isDisposer(resource)){var disposer=resource;resource=resource.promise(),resource._setDisposable(disposer)}else{var maybePromise=tryConvertToPromise(resource);maybePromise instanceof Promise&&(resource=maybePromise._then(maybeUnwrapDisposer,null,null,{resources:resources,index:i},void 0))}resources[i]=resource}var promise=Promise.settle(resources).then(inspectionMapper).then(function(vals){promise._pushContext();var ret;try{ret=spreadArgs?fn.apply(void 0,vals):fn.call(void 0,vals)}finally{promise._popContext()}return ret})._then(disposerSuccess,disposerFail,void 0,resources,void 0);return resources.promise=promise,promise},Promise.prototype._setDisposable=function(disposer){this._bitField=262144|this._bitField,this._disposer=disposer},Promise.prototype._isDisposable=function(){return(262144&this._bitField)>0},Promise.prototype._getDisposer=function(){return this._disposer},Promise.prototype._unsetDisposable=function(){this._bitField=-262145&this._bitField,this._disposer=void 0},Promise.prototype.disposer=function(fn){if("function"==typeof fn)return new FunctionDisposer(fn,this,createContext());throw new TypeError}}},{"./errors.js":13,"./util.js":38}],38:[function(_dereq_,module,exports){"use strict";function tryCatcher(){try{var target=tryCatchTarget;return tryCatchTarget=null,target.apply(this,arguments)}catch(e){return errorObj.e=e,errorObj}}function tryCatch(fn){return tryCatchTarget=fn,tryCatcher}function isPrimitive(val){return null==val||val===!0||val===!1||"string"==typeof val||"number"==typeof val}function isObject(value){return!isPrimitive(value)}function maybeWrapAsError(maybeError){return isPrimitive(maybeError)?new Error(safeToString(maybeError)):maybeError}function withAppended(target,appendee){var i,len=target.length,ret=new Array(len+1);for(i=0;len>i;++i)ret[i]=target[i];return ret[i]=appendee,ret}function getDataPropertyOrDefault(obj,key,defaultValue){if(!es5.isES5)return{}.hasOwnProperty.call(obj,key)?obj[key]:void 0;var desc=Object.getOwnPropertyDescriptor(obj,key);return null!=desc?null==desc.get&&null==desc.set?desc.value:defaultValue:void 0}function notEnumerableProp(obj,name,value){if(isPrimitive(obj))return obj;var descriptor={value:value,configurable:!0,enumerable:!1,writable:!0};return es5.defineProperty(obj,name,descriptor),obj}function thrower(r){throw r}function isClass(fn){try{if("function"==typeof fn){var keys=es5.names(fn.prototype),hasMethods=es5.isES5&&keys.length>1,hasMethodsOtherThanConstructor=keys.length>0&&!(1===keys.length&&"constructor"===keys[0]),hasThisAssignmentAndStaticMethods=thisAssignmentPattern.test(fn+"")&&es5.names(fn).length>0;if(hasMethods||hasMethodsOtherThanConstructor||hasThisAssignmentAndStaticMethods)return!0}return!1}catch(e){return!1}}function toFastProperties(obj){function f(){}f.prototype=obj;for(var l=8;l--;)new f;return obj}function isIdentifier(str){return rident.test(str)}function filledRange(count,prefix,suffix){for(var ret=new Array(count),i=0;count>i;++i)ret[i]=prefix+i+suffix;return ret}function safeToString(obj){try{return obj+""}catch(e){return"[no string representation]"}}function markAsOriginatingFromRejection(e){try{notEnumerableProp(e,"isOperational",!0)}catch(ignore){}}function originatesFromRejection(e){return null==e?!1:e instanceof Error.__BluebirdErrorTypes__.OperationalError||e.isOperational===!0}function canAttachTrace(obj){return obj instanceof Error&&es5.propertyIsWritable(obj,"stack")}function classString(obj){return{}.toString.call(obj)}function copyDescriptors(from,to,filter){for(var keys=es5.names(from),i=0;i<keys.length;++i){var key=keys[i];if(filter(key))try{es5.defineProperty(to,key,es5.getDescriptor(from,key))}catch(ignore){}}}var es5=_dereq_("./es5.js"),canEvaluate="undefined"==typeof navigator,haveGetters=function(){try{var o={};return es5.defineProperty(o,"f",{get:function(){return 3}}),3===o.f}catch(e){return!1}}(),errorObj={e:{}},tryCatchTarget,inherits=function(Child,Parent){function T(){this.constructor=Child,this.constructor$=Parent;for(var propertyName in Parent.prototype)hasProp.call(Parent.prototype,propertyName)&&"$"!==propertyName.charAt(propertyName.length-1)&&(this[propertyName+"$"]=Parent.prototype[propertyName])}var hasProp={}.hasOwnProperty;return T.prototype=Parent.prototype,Child.prototype=new T,Child.prototype},inheritedDataKeys=function(){var excludedPrototypes=[Array.prototype,Object.prototype,Function.prototype],isExcludedProto=function(val){for(var i=0;i<excludedPrototypes.length;++i)if(excludedPrototypes[i]===val)return!0;return!1};if(es5.isES5){var getKeys=Object.getOwnPropertyNames;return function(obj){for(var ret=[],visitedKeys=Object.create(null);null!=obj&&!isExcludedProto(obj);){var keys;try{keys=getKeys(obj)}catch(e){return ret}for(var i=0;i<keys.length;++i){var key=keys[i];if(!visitedKeys[key]){visitedKeys[key]=!0;var desc=Object.getOwnPropertyDescriptor(obj,key);null!=desc&&null==desc.get&&null==desc.set&&ret.push(key)}}obj=es5.getPrototypeOf(obj)}return ret}}var hasProp={}.hasOwnProperty;return function(obj){if(isExcludedProto(obj))return[];var ret=[];enumeration:for(var key in obj)if(hasProp.call(obj,key))ret.push(key);else{for(var i=0;i<excludedPrototypes.length;++i)if(hasProp.call(excludedPrototypes[i],key))continue enumeration;ret.push(key)}return ret}}(),thisAssignmentPattern=/this\s*\.\s*\S+\s*=/,rident=/^[a-z$_][a-z$_0-9]*$/i,ensureErrorObject=function(){return"stack"in new Error?function(value){return canAttachTrace(value)?value:new Error(safeToString(value))}:function(value){if(canAttachTrace(value))return value;try{throw new Error(safeToString(value))}catch(err){return err}}}(),ret={isClass:isClass,isIdentifier:isIdentifier,inheritedDataKeys:inheritedDataKeys,getDataPropertyOrDefault:getDataPropertyOrDefault,thrower:thrower,isArray:es5.isArray,haveGetters:haveGetters,notEnumerableProp:notEnumerableProp,isPrimitive:isPrimitive,isObject:isObject,canEvaluate:canEvaluate,errorObj:errorObj,tryCatch:tryCatch,inherits:inherits,withAppended:withAppended,maybeWrapAsError:maybeWrapAsError,
toFastProperties:toFastProperties,filledRange:filledRange,toString:safeToString,canAttachTrace:canAttachTrace,ensureErrorObject:ensureErrorObject,originatesFromRejection:originatesFromRejection,markAsOriginatingFromRejection:markAsOriginatingFromRejection,classString:classString,copyDescriptors:copyDescriptors,hasDevTools:"undefined"!=typeof chrome&&chrome&&"function"==typeof chrome.loadTimes,isNode:"undefined"!=typeof process&&"[object process]"===classString(process).toLowerCase()};ret.isRecentNode=ret.isNode&&function(){var version=process.versions.node.split(".").map(Number);return 0===version[0]&&version[1]>10||version[0]>0}(),ret.isNode&&ret.toFastProperties(process);try{throw new Error}catch(e){ret.lastLineError=e}module.exports=ret},{"./es5.js":14}]},{},[4])(4)}),"undefined"!=typeof window&&null!==window?window.P=window.Promise:"undefined"!=typeof self&&null!==self&&(self.P=self.Promise)}).call(exports,__webpack_require__(57),function(){return this}(),__webpack_require__(97).setImmediate)},function(module,exports,__webpack_require__){(function(setImmediate,clearImmediate){function Timeout(id,clearFn){this._id=id,this._clearFn=clearFn}var nextTick=__webpack_require__(98).nextTick,apply=Function.prototype.apply,slice=Array.prototype.slice,immediateIds={},nextImmediateId=0;exports.setTimeout=function(){return new Timeout(apply.call(setTimeout,window,arguments),clearTimeout)},exports.setInterval=function(){return new Timeout(apply.call(setInterval,window,arguments),clearInterval)},exports.clearTimeout=exports.clearInterval=function(timeout){timeout.close()},Timeout.prototype.unref=Timeout.prototype.ref=function(){},Timeout.prototype.close=function(){this._clearFn.call(window,this._id)},exports.enroll=function(item,msecs){clearTimeout(item._idleTimeoutId),item._idleTimeout=msecs},exports.unenroll=function(item){clearTimeout(item._idleTimeoutId),item._idleTimeout=-1},exports._unrefActive=exports.active=function(item){clearTimeout(item._idleTimeoutId);var msecs=item._idleTimeout;msecs>=0&&(item._idleTimeoutId=setTimeout(function(){item._onTimeout&&item._onTimeout()},msecs))},exports.setImmediate="function"==typeof setImmediate?setImmediate:function(fn){var id=nextImmediateId++,args=arguments.length<2?!1:slice.call(arguments,1);return immediateIds[id]=!0,nextTick(function(){immediateIds[id]&&(args?fn.apply(null,args):fn.call(null),exports.clearImmediate(id))}),id},exports.clearImmediate="function"==typeof clearImmediate?clearImmediate:function(id){delete immediateIds[id]}}).call(exports,__webpack_require__(97).setImmediate,__webpack_require__(97).clearImmediate)},function(module,exports){function noop(){}var process=module.exports={};process.nextTick=function(){var canSetImmediate="undefined"!=typeof window&&window.setImmediate,canMutationObserver="undefined"!=typeof window&&window.MutationObserver,canPost="undefined"!=typeof window&&window.postMessage&&window.addEventListener;if(canSetImmediate)return function(f){return window.setImmediate(f)};var queue=[];if(canMutationObserver){var hiddenDiv=document.createElement("div"),observer=new MutationObserver(function(){var queueList=queue.slice();queue.length=0,queueList.forEach(function(fn){fn()})});return observer.observe(hiddenDiv,{attributes:!0}),function(fn){queue.length||hiddenDiv.setAttribute("yes","no"),queue.push(fn)}}return canPost?(window.addEventListener("message",function(ev){var source=ev.source;if((source===window||null===source)&&"process-tick"===ev.data&&(ev.stopPropagation(),queue.length>0)){var fn=queue.shift();fn()}},!0),function(fn){queue.push(fn),window.postMessage("process-tick","*")}):function(fn){setTimeout(fn,0)}}(),process.title="browser",process.browser=!0,process.env={},process.argv=[],process.on=noop,process.addListener=noop,process.once=noop,process.off=noop,process.removeListener=noop,process.removeAllListeners=noop,process.emit=noop,process.binding=function(name){throw new Error("process.binding is not supported")},process.cwd=function(){return"/"},process.chdir=function(dir){throw new Error("process.chdir is not supported")}},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["addCustomBlock","updateCustomBlock","deleteCustomBlock","changeCustomBlockType","moveCustomBlock","createNewBlockAfterCustomBlock","createNewBlockBeforeCustomBlock"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["addCustomTag","editCustomTag"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["registerDocument","unregisterDocument"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["resetTextBlockCombo","paste","undo","redo"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["changeTextBlockType","updateTextTag"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["updateSelection","restoreSelection","updateDimensions","removeSelection","moveSelectionToStartOfBlock","moveSelectionToEndOfBlock","selectCustomTag","triggerCustomAction","focusDocument"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reflux=__webpack_require__(82),_reflux2=_interopRequireDefault(_reflux);exports["default"]=_reflux2["default"].createActions(["typingIntent","documentChangeIntent","enterIntent","backspaceIntent","deleteIntent"]),module.exports=exports["default"]},function(module,exports,__webpack_require__){var BlockModelHelper,DocumentModelHelper,Immutable;Immutable=__webpack_require__(20),BlockModelHelper=__webpack_require__(107),DocumentModelHelper=__webpack_require__(108),module.exports={onAddCustomBlock:function(blockType,initialAttributes){var blockModel,customBlock,documentContainerId,documentInfo,documentModelCursor,startSelection;return null==initialAttributes&&(initialAttributes={}),documentInfo=this._getCurrentDocumentInfo(),startSelection=this.selection.get("start").toJS(),documentModelCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),blockModel=documentModelCursor.deref().get(startSelection.index),customBlock=Immutable.fromJS({id:BlockModelHelper.generateId(),blockType:blockType,attributes:initialAttributes}),BlockModelHelper.blockModelIsEmpty(blockModel)?documentModelCursor.update(function(documentModel){return documentModel.splice(startSelection.index,1,customBlock)}):BlockModelHelper.selectionAtStartOfBlock(blockModel,startSelection)?documentModelCursor.update(function(documentModel){return documentModel.splice(startSelection.index,0,customBlock)}):BlockModelHelper.selectionAtEndOfBlock(blockModel,startSelection)?documentModelCursor.update(function(documentModel){return documentModel.splice(startSelection.index+1,0,customBlock)}):documentModelCursor.update(function(documentModel){return DocumentModelHelper.splitBlock(documentModel,documentInfo.config,startSelection.index,startSelection.offset,startSelection.customTagOffset)}).update(function(documentModel){return documentModel.splice(startSelection.index+1,0,customBlock)}),this.ignoreSelectionChanges(),documentContainerId=this.selection.get("documentContainerId"),this.selection.clear(),this.updateLastAction("Add Custom Block"),this.flushUpdates(documentContainerId,this.watchForSelectionChanges)},onUpdateCustomBlock:function(documentContainerId,documentId,customBlockId,newAttributes){var customBlockIndex,documentCursor,documentInfo;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),customBlockIndex=documentCursor.deref().findIndex(function(blockModel){return blockModel.get("id")===customBlockId}),documentCursor.cursor(customBlockIndex).update(function(customBlock){return customBlock.update("attributes",function(){return Immutable.fromJS(newAttributes)})}),this.updateLastAction("Modify Custom Block"),this.flushUpdates(documentContainerId)},onMoveCustomBlock:function(documentContainerId,documentId,customBlockId,direction){var customBlock,customBlockIndex,documentCursor,documentInfo,lastIndex,newIndex;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),customBlockIndex=documentCursor.deref().findIndex(function(blockModel){return blockModel.get("id")===customBlockId}),lastIndex=documentCursor.deref().size-1,"up"===direction&&customBlockIndex>0||"down"===direction&&lastIndex>customBlockIndex?(customBlock=documentCursor.deref().get(customBlockIndex),newIndex="up"===direction?customBlockIndex-1:customBlockIndex+1,documentCursor.update(function(documentModel){return documentModel["delete"](customBlockIndex).splice(newIndex,0,customBlock)}),this.ignoreSelectionChanges(),this.selection.clear(),this.updateLastAction("Modify Custom Block"),this.flushUpdates(documentContainerId,this.watchForSelectionChanges)):void 0},onDeleteCustomBlock:function(documentContainerId,documentId,customBlockId){var customBlockIndex,documentCursor,documentInfo;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),customBlockIndex=documentCursor.deref().findIndex(function(blockModel){return blockModel.get("id")===customBlockId}),documentCursor.update(function(documentModel){return documentModel["delete"](customBlockIndex)}),this.ignoreSelectionChanges(),this.selection.clear(),this.updateLastAction("Delete Custom Block"),this.flushUpdates(documentContainerId,this.watchForSelectionChanges)},onChangeCustomBlockType:function(documentContainerId,documentId,customBlockId,newBlockType){var customBlockIndex,documentCursor,documentInfo;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),customBlockIndex=documentCursor.deref().findIndex(function(blockModel){return blockModel.get("id")===customBlockId}),documentCursor.update(function(documentModel){return documentModel.updateIn([customBlockIndex,"blockType"],function(){return newBlockType})}),this.ignoreSelectionChanges(),this.selection.clear(),this.updateLastAction("Modify Custom Block"),this.flushUpdates(documentContainerId,this.watchForSelectionChanges)},createNewBlockAfterCustomBlock:function(documentContainerId,documentId,customBlockId){var blockIndex,documentCursor,documentInfo,nextBlockModel,nextIsTextBlock;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),blockIndex=documentCursor.deref().findIndex(function(blockModel){return blockModel.get("id")===customBlockId}),nextBlockModel=documentCursor.deref().get(blockIndex+1),nextIsTextBlock=null!=nextBlockModel&&null!=documentInfo.config.textBlocks[nextBlockModel.get("blockType")],nextIsTextBlock&&BlockModelHelper.blockModelIsEmpty(nextBlockModel)||documentCursor.update(function(documentModel){return DocumentModelHelper.addEmptyBlock(documentModel,documentInfo.config.defaultTextBlockType,blockIndex+1)}),this.updateLastAction("Enter"),this.selection.update(function(currentSelection){return currentSelection.set("documentContainerId",documentContainerId).set("documentId",documentId).set("selectionType","text").set("collapsed",!0).set("start",Immutable.Map({index:blockIndex+1,offset:0,customTagOffset:0,atNodeStart:!0})).set("end",Immutable.Map({index:blockIndex+1,offset:0,customTagOffset:0,atNodeStart:!0}))}),this.flushUpdates(documentContainerId,this._restoreSelection)},createNewBlockBeforeCustomBlock:function(documentContainerId,documentId,customBlockId){var blockIndex,documentCursor,documentInfo,prevBlockModel,previousIsTextBlock;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),blockIndex=documentCursor.deref().findIndex(function(blockModel){return blockModel.get("id")===customBlockId}),prevBlockModel=blockIndex>0?documentCursor.deref().get(blockIndex-1):void 0,previousIsTextBlock=null!=prevBlockModel&&null!=documentInfo.config.textBlocks[prevBlockModel.get("blockType")],previousIsTextBlock&&BlockModelHelper.blockModelIsEmpty(prevBlockModel)?blockIndex-=1:documentCursor.update(function(documentModel){return DocumentModelHelper.addEmptyBlock(documentModel,documentInfo.config.defaultTextBlockType,blockIndex)}),this.updateLastAction("Enter"),this.selection.update(function(currentSelection){return currentSelection.set("documentContainerId",this.documentContainerId).set("documentId",this.documentId).set("collapsed",!0).set("start",Immutable.Map({index:blockIndex,offset:0,customTagOffset:0,atNodeStart:!0})).set("end",Immutable.Map({index:blockIndex,offset:0,customTagOffset:0,atNodeStart:!0}))}),this.flushUpdates(documentContainerId,this._restoreSelection)}}},function(module,exports,__webpack_require__){"use strict";var _getIterator=__webpack_require__(29)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),BlockModelHelper={};BlockModelHelper.blockModelToGroupedTags=function(blockModel,config){var stackList=[];if(!blockModel.get("text").length){var startingCustomTags=_lodash2["default"].filter(blockModel.get("customTags",_immutable2["default"].List()).toJS(),function(tag){return 0==tag.offset});_lodash2["default"].reduce(startingCustomTags,addCustomTag.bind(this,config.textTagsWrappingCustomTags),stackList)}return _lodash2["default"].reduce(blockModel.get("text").split(""),processSingleCharacter.bind(this,blockModel,config.textTagOrder,config.textTagsWrappingCustomTags),stackList),_lodash2["default"].reduce(stackList,processStack,[])},BlockModelHelper.textTagsForOffsets=function(blockModel,startOffset,endOffset){return null==startOffset&&(startOffset=0),null==endOffset&&(endOffset=blockModel.get("text").length),blockModel.get("textTags").filter(function(textTag){return textTag.get("startOffset")<=startOffset&&textTag.get("endOffset")>=endOffset}).map(function(tag){return tag.get("tagType")}).toArray()},BlockModelHelper.customTagsForOffsets=function(blockModel){var startOffset=arguments.length<=1||void 0===arguments[1]?0:arguments[1],startCustomTagOffset=arguments.length<=2||void 0===arguments[2]?0:arguments[2],endOffset=arguments.length<=3||void 0===arguments[3]?null:arguments[3],endCustomTagOffset=arguments.length<=4||void 0===arguments[4]?null:arguments[4],customTags=blockModel.get("customTags");if(null==endOffset&&(endOffset=blockModel.get("text").length),null==endCustomTagOffset&&(endCustomTagOffset=customTags.filter(function(customTag){return customTag.get("offset")==endOffset}).size),startOffset==endOffset)return customTags.filter(function(customTag){return customTag.get("offset")==startOffset}).filter(function(customTag,index){return index>=startCustomTagOffset&&endCustomTagOffset>index}).map(function(customTag){return customTag.get("id")});var startCustomTags=customTags.filter(function(customTag){return customTag.get("offset")==startOffset}).filter(function(customTag,index){return index>=startCustomTagOffset}),middleCustomTags=customTags.filter(function(customTag){return startOffset<customTag.get("offset")&&customTag.get("offset")<endOffset}),endCustomTags=customTags.filter(function(customTag){return customTag.get("offset")==endOffset}).filter(function(customTag,index){return endCustomTagOffset>index});return startCustomTags.concat(middleCustomTags).concat(endCustomTags).map(function(customTag){return customTag.get("id")})},BlockModelHelper.updateBlockType=function(blockModel,config,newBlockType){return this.consolidateTags(blockModel.set("blockType",newBlockType),config)},BlockModelHelper.updateTextTagForOffsets=function(blockModel,config,tagType,removeTag,startOffset,endOffset){return removeTag?this.removeTextTagForOffsets(blockModel,config,tagType,startOffset,endOffset):this.addTextTagForOffsets(blockModel,config,tagType,startOffset,endOffset)},BlockModelHelper.addTextTagForOffsets=function(blockModel,config,tagType,startOffset,endOffset){var _this=this;null==startOffset&&(startOffset=0),null==endOffset&&(endOffset=blockModel.get("text").length);var incompatibleTags=config.textTags[tagType].incompatibleTags,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_getIterator(incompatibleTags);!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var incompatibleTag=_step.value;blockModel=this.removeTextTagForOffsets(blockModel,config,incompatibleTag,startOffset,endOffset)}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return blockModel=blockModel.update("textTags",function(currentTextTags){return currentTextTags.push(_immutable2["default"].Map({id:_this.generateTextTagId(),tagType:tagType,attributes:_immutable2["default"].Map(),startOffset:startOffset,endOffset:endOffset}))}),this.consolidateTags(blockModel,config)},BlockModelHelper.removeTextTagForOffsets=function(blockModel,config,tagType,startOffset,endOffset){var _this2=this;return null==startOffset&&(startOffset=0),null==endOffset&&(endOffset=blockModel.get("text").length),blockModel.update("textTags",function(currentTextTags){return currentTextTags.reduce(checkTextTagForRemoval.bind(_this2,tagType,startOffset,endOffset),_immutable2["default"].List())})},BlockModelHelper.consolidateTags=function(blockModel,config){var unsupportedTextTags=void 0;try{unsupportedTextTags=config.textBlocks[blockModel.get("blockType")].incompatibleTags}catch(err){throw"Couldn't find textBlock config for "+blockModel.get("blockType")}var newTextTags=blockModel.get("textTags").filter(function(textTag){return!_lodash2["default"].contains(unsupportedTextTags,textTag.get("tagType"))});return newTextTags=removeZeroWidthAndWhitespaceTextTags(newTextTags,blockModel.get("text")),newTextTags=combineAdjacentTextTags(newTextTags,config),blockModel.set("textTags",newTextTags)},BlockModelHelper.removeCustomTagAtOffset=function(blockModel,offset,customTagOffset){var firstIndex=blockModel.get("customTags").findIndex(function(customTag){return customTag.get("offset")==offset});if(firstIndex>=0&&customTagOffset>0){var indexToRemove=firstIndex+(customTagOffset-1);return blockModel.deleteIn(["customTags",indexToRemove])}return blockModel},BlockModelHelper.removeDataForOffsets=function(blockModel,config,startOffset,startCustomTagOffset){var endOffset=arguments.length<=4||void 0===arguments[4]?null:arguments[4],endCustomTagOffset=arguments.length<=5||void 0===arguments[5]?null:arguments[5];return null==endOffset&&(endOffset=blockModel.get("text").length),null==endCustomTagOffset&&(endCustomTagOffset=blockModel.get("customTags").filter(function(customTag){return customTag.get("offset")==endOffset}).size),startOffset==endOffset&&startCustomTagOffset==endCustomTagOffset?blockModel:(blockModel=removeTextForOffsets(blockModel,startOffset,endOffset),blockModel=removeTextTagsForOffsets(blockModel,startOffset,endOffset),blockModel=removeCustomTagsForOffsets(blockModel,startOffset,startCustomTagOffset,endOffset,endCustomTagOffset),BlockModelHelper.consolidateTags(blockModel,config))},BlockModelHelper.addCustomTagAtOffsets=function(blockModel,customTagType,attributes,offset,customTagOffset){var newCustomTag={id:this.generateCustomTagId(),tagType:customTagType,offset:offset,attributes:attributes},firstIndex=blockModel.get("customTags").findLastIndex(function(customTag){return customTag.get("offset")<offset})+1,indexToAdd=firstIndex+customTagOffset;return blockModel.update("customTags",function(customTags){return customTags.splice(indexToAdd,0,_immutable2["default"].fromJS(newCustomTag))})},BlockModelHelper.blockModelIsEmpty=function(blockModel){return 0==blockModel.get("customTags").size&&0==blockModel.get("text").length},BlockModelHelper.selectionInsideBlock=function(blockModel,selection){return!this.selectionAtStartOfBlock(blockModel,selection)&&!this.selectionAtEndOfBlock(blockModel,selection)},BlockModelHelper.selectionAtStartOfBlock=function(blockModel,selection){return 0==selection.offset&&0==selection.customTagOffset},BlockModelHelper.selectionAtEndOfBlock=function(blockModel,selection){var textLength=blockModel.get("text").length,customTagsAtEnd=blockModel.get("customTags").filter(function(customTag){return customTag.get("offset")==textLength});return selection.offset==textLength&&selection.customTagOffset==customTagsAtEnd.size},BlockModelHelper.trim=function(blockModel,config){var customTagOffsets=blockModel.get("customTags").map(function(customTag){return customTag.get("offset")}),minCustomTagOffset=void 0,lengthToRemove=void 0,numberOfCustomTags=void 0,maxCustomTagOffset=void 0,startOffsetForTrim=void 0,startMatch=/^([\s]+)/.exec(blockModel.get("text")),endMatch=/([\s]+)$/.exec(blockModel.get("text"));return startMatch&&(minCustomTagOffset=customTagOffsets.size?Math.min.apply(this,customTagOffsets.toArray()):blockModel.get("text").length,lengthToRemove=Math.min(minCustomTagOffset,startMatch[1].length),blockModel=this.removeDataForOffsets(blockModel,config,0,0,lengthToRemove,0),customTagOffsets=blockModel.get("customTags").map(function(customTag){return customTag.get("offset")})),endMatch&&(maxCustomTagOffset=customTagOffsets.size?Math.max.apply(this,customTagOffsets.toArray()):0,startOffsetForTrim=blockModel.get("text").length-endMatch[1].length,lengthToRemove=Math.max(maxCustomTagOffset,startOffsetForTrim),numberOfCustomTags=customTagOffsets.filter(function(offset){return offset==lengthToRemove}),blockModel=this.removeDataForOffsets(blockModel,config,lengthToRemove,numberOfCustomTags.size)),blockModel},BlockModelHelper.generateId=function(){return"fusible_block_"+Math.random().toString(36).substr(2,9)},BlockModelHelper.generateTextTagId=function(){return"fusible_text_tag_"+Math.random().toString(36).substr(2,9)},BlockModelHelper.generateCustomTagId=function(){return"fusible_custom_tag_"+Math.random().toString(36).substr(2,9)};var processSingleCharacter=function(blockModel,textTagOrder,textTagsWrappingCustomTags,characterGroups,letter,index,letters){0==characterGroups.length&&characterGroups.push([]);var currentStack=_lodash2["default"].last(characterGroups),atEnd=index+1==letters.length,tagsToStart=_lodash2["default"].filter(blockModel.get("textTags").toJS(),function(tag){return tag.startOffset==index}),tagIdsToEnd=_lodash2["default"].pluck(_lodash2["default"].filter(blockModel.get("textTags").toJS(),function(tag){return tag.endOffset==index}),"id"),customTags=_lodash2["default"].filter(blockModel.get("customTags",_immutable2["default"].List()).toJS(),function(tag){return tag.offset==index});if(tagsToStart.length||tagIdsToEnd.length||customTags.length){_lodash2["default"].reduce(customTags,addCustomTag.bind(this,textTagsWrappingCustomTags),characterGroups);var existingTagStack=_lodash2["default"].reject(currentStack,function(stackItem){return _lodash2["default"].isString(stackItem)}),newTagStack=_lodash2["default"].chain(existingTagStack).reject(function(tagItem){return _lodash2["default"].contains(tagIdsToEnd,tagItem.model.id)}).concat(_lodash2["default"].map(tagsToStart,function(tag){return{type:"textTag",model:tag}})).uniq(!1,function(tagItem){return tagItem.model.id}).sortBy(function(tagItem){return textTagOrder.indexOf(tagItem.model.tagType)}).value();(customTags.length||!_lodash2["default"].isEqual(existingTagStack,newTagStack))&&(currentStack=newTagStack,characterGroups.push(currentStack))}var characterToAdd=atEnd&&" "==letter?"\xa0":letter,lastStackItemIndex=currentStack.length-1;if(_lodash2["default"].isString(currentStack[lastStackItemIndex])?currentStack[lastStackItemIndex]+=characterToAdd:currentStack.push(characterToAdd),atEnd){var finalCustomTags=_lodash2["default"].filter(blockModel.get("customTags",_immutable2["default"].List()).toJS(),function(tag){return tag.offset==index+1});_lodash2["default"].reduce(finalCustomTags,addCustomTag.bind(this,textTagsWrappingCustomTags),characterGroups)}return characterGroups},addCustomTag=function(allowedTextTags,characterGroups,customTag){var newStack=_lodash2["default"].filter(_lodash2["default"].last(characterGroups)||[],function(stack){return!_lodash2["default"].isString(stack)&&"textTag"==stack.type&&allowedTextTags.contains(stack.model.tagType)});return newStack.push({type:"customTag",model:customTag}),characterGroups.push(newStack),characterGroups},processStack=function(trees,stack,_index){return _lodash2["default"].reduce(stack,treeifyStack,trees)},treeifyStack=function treeifyStack(trees,stackItem,depth){var lastTreeItemIndex=trees.length-1,lastTreeItem=_lodash2["default"].last(trees);return 0==depth?_lodash2["default"].isString(stackItem)&&_lodash2["default"].isString(lastTreeItem)?trees[lastTreeItemIndex]+=stackItem:stackItem&&stackItem.model&&lastTreeItem&&lastTreeItem.model&&stackItem.model.id==lastTreeItem.model.id||trees.push(_lodash2["default"].clone(stackItem)):trees[lastTreeItemIndex].children=treeifyStack(lastTreeItem.children||[],stackItem,depth-1),trees},removeZeroWidthAndWhitespaceTextTags=function(textTags,text){return textTags.filter(function(textTag){return!(text.slice(textTag.get("startOffset"),textTag.get("endOffset")).match(/^[\s]+$/)||textTag.get("startOffset")==textTag.get("endOffset"))})},combineAdjacentTextTags=function(textTags,config){return sortTextTags(textTags,config.textTagOrder).reduce(function(newTextTags,textTag){var previousTag=newTextTags.last();if(previousTag){var tagTypesAreTheSame=previousTag.get("tagType")==textTag.get("tagType"),tagAttributesAreTheSame=_lodash2["default"].isEqual(previousTag.get("attributes").toJS(),textTag.get("attributes").toJS()),tagsOverlap=textTag.get("startOffset")<=previousTag.get("endOffset");if(tagTypesAreTheSame&&tagAttributesAreTheSame&&tagsOverlap)return newTextTags.updateIn([newTextTags.size-1,"endOffset"],function(_currentEndOffset){return Math.max(textTag.get("endOffset"),previousTag.get("endOffset"))})}return newTextTags.push(textTag)},_immutable2["default"].List())},sortTextTags=function(textTags,order){return textTags.sortBy(function(textTag){return 1e4*order.indexOf(textTag.get("tagType"))+textTag.get("startOffset")})},checkTextTagForRemoval=function(tagType,startOffset,endOffset,textTags,textTag){return textTag.get("tagType")==tagType?textTag.get("startOffset")>=startOffset&&textTag.get("endOffset")<=endOffset?textTags:textTag.get("startOffset")<startOffset&&textTag.get("endOffset")>endOffset?(textTags=textTags.push(_immutable2["default"].Map({id:textTag.get("id"),tagType:tagType,startOffset:textTag.get("startOffset"),endOffset:startOffset,attributes:textTag.get("attributes")})),textTags.push(_immutable2["default"].Map({id:BlockModelHelper.generateTextTagId(),tagType:tagType,startOffset:endOffset,endOffset:textTag.get("endOffset"),attributes:textTag.get("attributes")}))):textTag.get("startOffset")<startOffset&&textTag.get("endOffset")>=startOffset?textTags.push(textTag.set("endOffset",startOffset)):textTag.get("endOffset")>endOffset&&textTag.get("startOffset")<=endOffset?textTags.push(textTag.set("startOffset",endOffset)):textTags.push(textTag):textTags.push(textTag)},removeTextForOffsets=function(blockModel,startOffset,endOffset){var text=blockModel.get("text"),textBeforeOffset=0==startOffset?"":text.slice(0,startOffset),textAfterOffset=endOffset==text.length?"":text.slice(endOffset);return blockModel.set("text",textBeforeOffset+textAfterOffset)},removeTextTagsForOffsets=function(blockModel,startOffset,endOffset){var offsetDifference=endOffset-startOffset;return blockModel.update("textTags",_immutable2["default"].List(),function(textTags){return textTags.filterNot(function(textTag){return startOffset<=textTag.get("startOffset")&&textTag.get("endOffset")<=endOffset}).map(function(textTag){var startBeforeStartOffset=textTag.get("startOffset")<=startOffset,endBeforeStartOffset=textTag.get("endOffset")<=startOffset,startAfterEndOffset=textTag.get("startOffset")>=endOffset,endAfterEndOffset=textTag.get("endOffset")>=endOffset;return startBeforeStartOffset&&endBeforeStartOffset?textTag:startAfterEndOffset&&endAfterEndOffset?textTag.set("startOffset",textTag.get("startOffset")-offsetDifference).set("endOffset",textTag.get("endOffset")-offsetDifference):startBeforeStartOffset?endAfterEndOffset?textTag.set("endOffset",textTag.get("endOffset")-offsetDifference):textTag.set("endOffset",startOffset):textTag.set("startOffset",startOffset).set("endOffset",textTag.get("endOffset")-offsetDifference)})})},removeCustomTagsForOffsets=function(blockModel,startOffset,startCustomTagOffset,endOffset,endCustomTagOffset){return blockModel.update("customTags",_immutable2["default"].List(),function(customTags){var startCustomTagsIndex=customTags.findIndex(function(customTag){return customTag.get("offset")==startOffset}),startCustomTagsCount=customTags.filter(function(customTag){return customTag.get("offset")==startOffset}).size,startIndexToRemove=startCustomTagsIndex+startCustomTagOffset,startNumberToRemove=startCustomTagsCount-startCustomTagOffset,endIndexToRemove=customTags.findIndex(function(customTag){return customTag.get("offset")==endOffset});return customTags.splice(endIndexToRemove,endCustomTagOffset).splice(startIndexToRemove,startNumberToRemove).filterNot(function(customTag){return startOffset<customTag.get("offset")&&customTag.get("offset")<endOffset}).map(function(customTag){return customTag.get("offset")>startOffset?customTag.set("offset",customTag.get("offset")-(endOffset-startOffset)):customTag})})};exports["default"]=BlockModelHelper,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_block_model_helper=__webpack_require__(107),_block_model_helper2=_interopRequireDefault(_block_model_helper),DocumentModelHelper={};DocumentModelHelper.prepAndValidateDocumentModel=function(documentModelCursor,config){var _this=this;return documentModelCursor.update(function(documentModel){var textBlockConfig=config.textBlocks,customBlockConfig=config.customBlocks;return documentModel.map(function(blockModel,index){if(!blockModel.has("blockType")){var fullPath=_lodash2["default"].flatten([documentModelCursor._keyPath,index,"blockType"]);throw new Error("A block model was given to a document without a blockType at path '"+_lodash2["default"].without(fullPath,null)+"'. Please ensure that every block has a valid text or custom 'blockType' value.")}if(blockModel.has("id")||(blockModel=blockModel.set("id",_block_model_helper2["default"].generateId())),
textBlockConfig[blockModel.get("blockType")])return _this.prepAndValidateTextBlock(blockModel,config,_lodash2["default"].flatten([documentModelCursor._keyPath,index]));if(customBlockConfig[blockModel.get("blockType")])return _this.prepAndValidateCustomBlock(blockModel,config);var fullPath=_lodash2["default"].flatten([documentModelCursor._keyPath,index,"blockType"]);throw new Error("Can't find a configuration for blockType '"+blockModel.get("blockType")+"' at path '"+_lodash2["default"].without(fullPath,null)+"'. Please ensure that every block has a valid text or custom 'blockType' value.")})})},DocumentModelHelper.prepAndValidateTextBlock=function(blockModel,config){var keyPath=arguments.length<=2||void 0===arguments[2]?[]:arguments[2];blockModel.has("text")||(blockModel=blockModel.set("text","")),blockModel.has("attributes")||(blockModel=blockModel.set("attributes",_immutable2["default"].Map())),blockModel.has("textTags")||(blockModel=blockModel.set("textTags",_immutable2["default"].List()));var textTagConfig=config.textTags;blockModel=blockModel.update("textTags",function(textTags){return textTags.map(function(textTag,textTagIndex){if(textTag.has("id")||(textTag=textTag.set("id",_block_model_helper2["default"].generateTextTagId())),textTag.has("attributes")||(textTag=textTag.set("attributes",_immutable2["default"].Map())),!textTagConfig[textTag.get("tagType")]){var fullPath=_lodash2["default"].flatten([keyPath,"textTags",textTagIndex,"tagType"]);throw new Error("Invalid text tag '"+textTag.get("tagType")+"' found in block model at path '"+_lodash2["default"].without(fullPath,null)+"'. Please either add a config for this tag or remove it from the document.")}if(textTagConfig[textTag.get("tagType")].hasAttributes&&!textTag.has("attributes")&&(textTag=textTag.set("attributes",_immutable2["default"].Map())),!_lodash2["default"].isNumber(textTag.get("startOffset"))){var fullPath=_lodash2["default"].flatten([keyPath,"textTags",textTagIndex,"startOffset"]);throw new Error("Invalid text tag startOffset '"+textTag.get("startOffset")+"' found in block model at path '"+_lodash2["default"].without(fullPath,null)+"'. Please make sure all text tags have valid integer start and end offsets.")}if(!_lodash2["default"].isNumber(textTag.get("endOffset"))){var fullPath=_lodash2["default"].flatten([keyPath,"textTags",textTagIndex,"endOffset"]);throw new Error("Invalid text tag endOffset '"+textTag.get("endOffset")+"' found in block model at path '"+_lodash2["default"].without(fullPath,null)+"'. Please make sure all text tags have valid integer start and end offsets.")}return textTag})}),blockModel.has("customTags")||(blockModel=blockModel.set("customTags",_immutable2["default"].List()));var customTagConfig=config.customTags;return blockModel.update("customTags",function(customTags){return customTags.map(function(customTag,customTagIndex){if(customTag.has("id")||(customTag=customTag.set("id",_block_model_helper2["default"].generateCustomTagId())),customTag.has("attributes")||(customTag=customTag.set("attributes",_immutable2["default"].Map())),!customTagConfig[customTag.get("tagType")]){var fullPath=_lodash2["default"].flatten([keyPath,"customTags",customTagIndex,"tagType"]);throw new Error("Invalid custom tag '"+customTag.get("tagType")+"' found in block model at path '"+_lodash2["default"].without(fullPath,null)+"'. Please either add a config for this tag or remove it from the document.")}if(!_lodash2["default"].isNumber(customTag.get("offset"))){var fullPath=_lodash2["default"].flatten([keyPath,"customTags",customTagIndex,"offset"]);throw new Error("Invalid custom tag offset '"+customTag.get("offset")+"' found in block model at path '"+_lodash2["default"].without(fullPath,null)+"'. Please make sure all custom tags have valid integer offsets.")}return customTag})})},DocumentModelHelper.prepAndValidateCustomBlock=function(blockModel,_config){return blockModel.has("attributes")||(blockModel=blockModel.set("attributes",_immutable2["default"].Map())),blockModel},DocumentModelHelper.documentToNestedGroups=function(documentModel,config){return documentModel.reduce(addBlockModelToGrouping.bind(this,config),_immutable2["default"].List())},DocumentModelHelper.textFromIndexesAndOffsets=function(documentModel,startInfo,endInfo){return documentModel.reduce(accumulateTextForIndexAndOffsets.bind(this,startInfo,endInfo),"")},DocumentModelHelper.supportedTextTagsForSelection=function(documentModel,config,startInfo,endInfo){var blockConfigs=documentModel.slice(startInfo.index,endInfo.index+1).map(function(blockModel){return config.textBlocks[blockModel.get("blockType")]}),unsuportedTags=_lodash2["default"].union.apply(this,blockConfigs.map(function(blockConfig){return blockConfig.incompatibleTags}).toArray());return _lodash2["default"].pick(config.textTags,function(value,key){return!_lodash2["default"].contains(unsuportedTags,key)})},DocumentModelHelper.selectedTextTagsForSelection=function(documentModel,startInfo,endInfo){var selectedTags=documentModel.map(textTagsForIndexAndOffsets.bind(this,startInfo,endInfo)).toArray();return _lodash2["default"].union.apply(this,selectedTags)},DocumentModelHelper.selectedTextBlocksForSelection=function(documentModel,startInfo,endInfo){var startIndex=startInfo.index,endIndex=endInfo.index;endIndex>startIndex&&_block_model_helper2["default"].selectionAtStartOfBlock(documentModel.get(endInfo.index),endInfo)&&(endIndex-=1);var blockTypes=documentModel.slice(startIndex,endIndex+1).map(function(blockModel){return blockModel.get("blockType")}).toArray();return _lodash2["default"].uniq(blockTypes)},DocumentModelHelper.selectedCustomTagsForSelection=function(documentModel,startInfo,endInfo){return documentModel.reduce(function(list,blockModel,index){return startInfo.index<index&&index<endInfo.index?list.concat(_block_model_helper2["default"].customTagsForOffsets(blockModel)):startInfo.index==index&&endInfo.index==index?list.concat(_block_model_helper2["default"].customTagsForOffsets(blockModel,startInfo.offset,startInfo.customTagOffset,endInfo.offset,endInfo.customTagOffset)):startInfo.index==index?list.concat(_block_model_helper2["default"].customTagsForOffsets(blockModel,startInfo.offset,startInfo.customTagOffset)):endInfo.index==index?list.concat(_block_model_helper2["default"].customTagsForOffsets(blockModel,0,0,endInfo.offset,endInfo.customTagOffset)):list},_immutable2["default"].List()).toArray()},DocumentModelHelper.updateBlockTypeForSelection=function(documentModel,config,newBlockType,startindex,endIndex){return documentModel.map(function(blockModel,index){return index>=startindex&&endIndex>=index&&(blockModel=_block_model_helper2["default"].updateBlockType(blockModel,config,newBlockType)),blockModel})},DocumentModelHelper.updateTextTagForSelection=function(documentModel,config,tagType,removeTag,startInfo,endInfo){return documentModel.map(updateTextTagForIndexAndOffsets.bind(this,config,tagType,removeTag,startInfo,endInfo))},DocumentModelHelper.combineBlockWithPreviousBlock=function(documentModel,config,blockIndex){if(!(blockIndex>0))return documentModel;var _ret=function(){var blockModel=documentModel.get(blockIndex),previousBlockModel=documentModel.get(blockIndex-1),previousOffset=previousBlockModel.get("text").length,newBlockModel=previousBlockModel.update("text",function(text){return text+blockModel.get("text")}).update("textTags",function(textTags){return(textTags||_immutable2["default"].List()).concat(addOffsetToTags(blockModel.get("textTags",_immutable2["default"].List()),previousOffset))}).update("customTags",function(customTags){return(customTags||_immutable2["default"].List()).concat(addOffsetToTags(blockModel.get("customTags",_immutable2["default"].List()),previousOffset))});return{v:documentModel.set(blockIndex-1,_block_model_helper2["default"].consolidateTags(newBlockModel,config))["delete"](blockIndex)}}();return"object"==typeof _ret?_ret.v:void 0},DocumentModelHelper.removeDataForOffsets=function(documentModel,config,startSelectionInfo,endSelectionInfo){return startSelectionInfo.index<endSelectionInfo.index?config.allowBlockMutation?(documentModel=documentModel.filterNot(function(blockModel,index){return startSelectionInfo.index<index&&index<endSelectionInfo.index}).update(startSelectionInfo.index,function(blockModel){return _block_model_helper2["default"].removeDataForOffsets(blockModel,config,startSelectionInfo.offset,startSelectionInfo.customTagOffset)}).update(startSelectionInfo.index+1,function(blockModel){return _block_model_helper2["default"].removeDataForOffsets(blockModel,config,0,0,endSelectionInfo.offset,endSelectionInfo.customTagOffset)}),DocumentModelHelper.combineBlockWithPreviousBlock(documentModel,config,startSelectionInfo.index+1)):documentModel.map(function(blockModel,index){return startSelectionInfo.index<=index&&index<endSelectionInfo.index?startSelectionInfo.index==index?_block_model_helper2["default"].removeDataForOffsets(blockModel,config,startSelectionInfo.offset,startSelectionInfo.customTagOffset):_block_model_helper2["default"].removeDataForOffsets(blockModel,config,0,0):index==endSelectionInfo.index?_block_model_helper2["default"].removeDataForOffsets(blockModel,config,0,0,endSelectionInfo.offset,endSelectionInfo.customTagOffset):blockModel}):documentModel.update(startSelectionInfo.index,function(blockModel){return _block_model_helper2["default"].removeDataForOffsets(blockModel,config,startSelectionInfo.offset,startSelectionInfo.customTagOffset,endSelectionInfo.offset,endSelectionInfo.customTagOffset)})},DocumentModelHelper.splitBlock=function(documentModel,config,index,offset,customTagOffset){var newBlockModel=documentModel.get(index).toJS();return newBlockModel.id=_block_model_helper2["default"].generateId(),documentModel.splice(index+1,0,_immutable2["default"].fromJS(newBlockModel)).update(index,function(blockModel){return _block_model_helper2["default"].removeDataForOffsets(blockModel,config,offset,customTagOffset)}).update(index+1,function(blockModel){return _block_model_helper2["default"].removeDataForOffsets(blockModel,config,0,0,offset,customTagOffset)})},DocumentModelHelper.addEmptyBlock=function(documentModel,blockType,index){return documentModel.splice(index,0,_immutable2["default"].fromJS({id:_block_model_helper2["default"].generateId(),blockType:blockType,text:"",textTags:[],customTags:[]}))},DocumentModelHelper.collapseDocument=function(documentModel,config,blockType){for(documentModel=documentModel.filter(function(blockModel){return!!config.textBlocks[blockModel.get("blockType")]}),documentModel=DocumentModelHelper.addEmptyBlock(documentModel,blockType,0);documentModel.size>1;)documentModel=DocumentModelHelper.combineBlockWithPreviousBlock(documentModel,config,1);return documentModel};var addBlockModelToGrouping=function(config,groups,blockModel,index,cursor){var textBlockConfig=config.textBlocks[blockModel.get("blockType")],customBlockConfig=config.customBlocks[blockModel.get("blockType")];if(textBlockConfig)return addTextBlockToGrouping(textBlockConfig,groups,blockModel,index,cursor);if(customBlockConfig)return addCustomBlockToGrouping(customBlockConfig,groups,blockModel,index,cursor);throw"Could not find a configuration for block type: '"+blockModel.get("blockType")+"'"},addTextBlockToGrouping=function(blockConfig,groups,blockModel,index,cursor){return blockConfig.sharedParentElement&&groups.last()&&"text-group"==groups.last().get("groupType")&&groups.last().get("blockType")==blockModel.get("blockType")?groups.updateIn([groups.size-1,"groups"],function(nestedGroups){return nestedGroups.push(_immutable2["default"].Map({groupType:"text",blockModel:cursor.cursor(index),config:blockConfig,index:index}))}):blockConfig.sharedParentElement?groups.push(_immutable2["default"].Map({groupType:"text-group",blockType:blockModel.get("blockType"),groups:_immutable2["default"].List([_immutable2["default"].Map({groupType:"text",blockModel:cursor.cursor(index),config:blockConfig,index:index})]),config:blockConfig})):groups.push(_immutable2["default"].Map({groupType:"text",blockModel:cursor.cursor(index),config:blockConfig,index:index}))},addCustomBlockToGrouping=function(blockConfig,groups,blockModel,index,cursor){return groups.push(_immutable2["default"].Map({groupType:"custom",blockModel:cursor.cursor(index),config:blockConfig,index:index}))},accumulateTextForIndexAndOffsets=function(startInfo,endInfo,text,blockModel,index){return index<startInfo.index||index>endInfo.index?text:startInfo.index==index&&endInfo.index==index?blockModel.get("text").slice(startInfo.offset,endInfo.offset):startInfo.index==index?text+blockModel.get("text").slice(startInfo.offset):endInfo.index==index?text+blockModel.get("text").slice(0,endInfo.offset):text+blockModel.get("text")},textTagsForIndexAndOffsets=function(startInfo,endInfo,blockModel,index){return index<startInfo.index||index>endInfo.index?[]:startInfo.index==index&&endInfo.index==index?_block_model_helper2["default"].textTagsForOffsets(blockModel,startInfo.offset,endInfo.offset):startInfo.index==index?_block_model_helper2["default"].textTagsForOffsets(blockModel,startInfo.offset):endInfo.index==index?_block_model_helper2["default"].textTagsForOffsets(blockModel,0,endInfo.offset):_block_model_helper2["default"].textTagsForOffsets(blockModel)},updateTextTagForIndexAndOffsets=function(config,tagType,removeTag,startInfo,endInfo,blockModel,index){return index<startInfo.index||index>endInfo.index?blockModel:startInfo.index==index&&endInfo.index==index?_block_model_helper2["default"].updateTextTagForOffsets(blockModel,config,tagType,removeTag,startInfo.offset,endInfo.offset):startInfo.index==index?_block_model_helper2["default"].updateTextTagForOffsets(blockModel,config,tagType,removeTag,startInfo.offset):endInfo.index==index?_block_model_helper2["default"].updateTextTagForOffsets(blockModel,config,tagType,removeTag,0,endInfo.offset):_block_model_helper2["default"].updateTextTagForOffsets(blockModel,config,tagType,removeTag)},addOffsetToTags=function(tags,offset){var updater=function(existingOffset){return existingOffset+offset};return tags.map(function(tag){return void 0!=tag.get("offset")?tag.update("offset",updater):tag.update("startOffset",updater).update("endOffset",updater)})};exports["default"]=DocumentModelHelper,module.exports=exports["default"]},function(module,exports,__webpack_require__){var BlockModelHelper,Immutable,_;_=__webpack_require__(17),Immutable=__webpack_require__(20),BlockModelHelper=__webpack_require__(107),module.exports={onAddCustomTag:function(tagType){var newCustomTag;return newCustomTag={tagType:tagType,attributes:{}},this.selection.update(function(currentSelection){return currentSelection.set("selectionType","customTag").set("customTag",Immutable.fromJS(newCustomTag))}),this.updateLastAction("Cursor Mouse Modification"),this.flushUpdates(this.selection.get("documentContainerId"))},onEditCustomTag:function(newAttributes){var customTagId,customTagType,documentInfo,selectionStart;return documentInfo=this._getCurrentDocumentInfo(),selectionStart=this.selection.get("start").toJS(),customTagType=this.selection.getIn(["customTag","tagType"]),customTagId=this.selection.getIn(["customTag","id"]),this.ignoreSelectionChanges(),null!=customTagId?(this.documentModelsCursor().cursor(_.flatten([documentInfo.modelPath,selectionStart.index,"customTags"])).update(function(existingCustomTags){var indexToUpdate;return indexToUpdate=existingCustomTags.findIndex(function(customTag){return customTag.get("id")===customTagId}),existingCustomTags.updateIn([indexToUpdate,"attributes"],function(){return Immutable.fromJS(newAttributes)})}),this.updateLastAction("Modify Custom Tag")):(this.documentModelsCursor().cursor(_.flatten([documentInfo.modelPath,selectionStart.index])).update(function(blockModel){return BlockModelHelper.addCustomTagAtOffsets(blockModel,customTagType,newAttributes,selectionStart.offset,selectionStart.customTagOffset)}),this.updateLastAction("Add Custom Tag")),this.selection.update(function(currentSelection){return currentSelection.set("inContentEditable",!0).set("selectionType","text").set("customTag",null).setIn(["start","customTagOffset"],selectionStart.customTagOffset+1).setIn(["end","customTagOffset"],selectionStart.customTagOffset+1).setIn(["start","atNodeStart"],!0).setIn(["end","atNodeStart"],!0)}),this.flushUpdates(this.selection.get("documentContainerId"),this._restoreSelection)}}},function(module,exports,__webpack_require__){var _;_=__webpack_require__(17),module.exports={onRegisterDocument:function(documentContainerId,document){return this.documentContainers=this.documentContainers.updateIn([documentContainerId,"documents"],function(documents){return documents.set(document.id,{document:document,config:document.props.config,modelPath:_.without(document.props.documentModel._keyPath,"documentModels")})}),this.updateHistoryState(!0),this._refreshDocumentComponents()},onUnregisterDocument:function(documentContainerId,document){return this.documentContainers=this.documentContainers.deleteIn([documentContainerId,"documents",document.id]),this._refreshDocumentComponents()}}},function(module,exports,__webpack_require__){var BlockModelHelper,DocumentModelHelper,_;_=__webpack_require__(17),BlockModelHelper=__webpack_require__(107),DocumentModelHelper=__webpack_require__(108),module.exports={onUndo:function(){var newState;return this.undoManager.canUndo()?(this._flushAfterTyping(),this.restoringHistory=!0,this.updateLastAction("Undo"),newState=this.undoManager.undo(),this.selection.update(function(){return newState.get("selection")}),this.structure.current=newState.get("structure"),this.flushUpdates(function(_this){return function(){return _this._restoreSelection(function(){return _this.restoringHistory=!1})}}(this))):void 0},onRedo:function(){var newState;return this.undoManager.canRedo()?(this._flushAfterTyping(),this.restoringHistory=!0,this.updateLastAction("Redo"),newState=this.undoManager.redo(),this.selection.update(function(){return newState.get("selection")}),this.structure.current=newState.get("structure"),this.flushUpdates(function(_this){return function(){return _this._restoreSelection(function(){return _this.restoringHistory=!1})}}(this))):void 0},onPaste:function(pastedDocumentModel){var currentBlock,currentBlockIsEmpty,customTagsAtEnd,documentInfo,lastPastedBlock,newSelectionIndex,newSelectionOffset,numberOfBlocksPasted,selectionEnd,selectionStart,selectionWasAtEndOfBlock;return documentInfo=this._getCurrentDocumentInfo(),selectionStart=this.selection.get("start").toJS(),selectionEnd=this.selection.get("end").toJS(),this.updateLastAction("Paste"),this.selection.get("collapsed")||this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return DocumentModelHelper.removeDataForOffsets(documentModel,documentInfo.config,selectionStart,selectionEnd)}),currentBlock=this.documentModelsCursor().cursor(documentInfo.modelPath).get(selectionStart.index).deref(),currentBlockIsEmpty=BlockModelHelper.blockModelIsEmpty(currentBlock),selectionWasAtEndOfBlock=currentBlockIsEmpty||BlockModelHelper.selectionAtEndOfBlock(currentBlock,selectionStart),documentInfo.config.allowBlockMutation||(pastedDocumentModel=DocumentModelHelper.collapseDocument(pastedDocumentModel,documentInfo.config,currentBlock.get("blockType"))),numberOfBlocksPasted=pastedDocumentModel.size,selectionWasAtEndOfBlock||this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return DocumentModelHelper.splitBlock(documentModel,documentInfo.config,selectionStart.index,selectionStart.offset,selectionStart.customTagOffset)}),this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return documentModel.splice.apply(documentModel,[selectionStart.index+1,0].concat(pastedDocumentModel.toArray()))}),currentBlockIsEmpty&&currentBlock.get("blockType")===documentInfo.config.defaultTextBlockType?this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return documentModel["delete"](selectionStart.index)}):this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(_this){return function(documentModel){return DocumentModelHelper.combineBlockWithPreviousBlock(documentModel,documentInfo.config,selectionStart.index+1)}}(this)),selectionWasAtEndOfBlock||this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(_this){return function(documentModel){return DocumentModelHelper.combineBlockWithPreviousBlock(documentModel,documentInfo.config,selectionStart.index+numberOfBlocksPasted)}}(this)),this.ignoreSelectionChanges(),lastPastedBlock=pastedDocumentModel.last(),newSelectionIndex=selectionStart.index+numberOfBlocksPasted-1,newSelectionOffset=lastPastedBlock.get("text").length,1===numberOfBlocksPasted&&(newSelectionOffset+=selectionStart.offset),customTagsAtEnd=lastPastedBlock.get("customTags").filter(function(customTag){return customTag.get("offset")===lastPastedBlock.get("text").length}),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this.selection.update(function(currentSelection){return currentSelection.set("collapsed",!0).setIn(["start","index"],newSelectionIndex).setIn(["end","index"],newSelectionIndex).setIn(["start","offset"],newSelectionOffset).setIn(["end","offset"],newSelectionOffset).setIn(["start","customTagOffset"],customTagsAtEnd.size).setIn(["end","customTagOffset"],customTagsAtEnd.size).setIn(["start","atNodeStart"],customTagsAtEnd.size>0).setIn(["end","atNodeStart"],customTagsAtEnd.size>0)}),_this._restoreSelection()}}(this))},onResetTextBlockCombo:function(validBlockTypes){var allSelectedBlocksAreValidForCombo,documentInfo,endInfo,startInfo,textBlocks;return documentInfo=this._getCurrentDocumentInfo(),null!=this.selection.get("start")&&documentInfo.config.allowBlockMutation&&(textBlocks=this.selection.get("textBlocks"),startInfo=this.selection.get("start").toJS(),endInfo=this.selection.get("end").toJS(),allSelectedBlocksAreValidForCombo=this.documentModelsCursor().cursor(documentInfo.modelPath).deref().slice(startInfo.index,endInfo.index+1).every(function(blockModel){return _.contains(validBlockTypes,blockModel.get("blockType"))}))?(this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return documentModel.map(function(blockModel,index){return startInfo.index<=index&&index<=endInfo.index?blockModel.update("blockType",function(){return documentInfo.config.defaultTextBlockType}):blockModel})}),this.updateLastAction("Modify Text Block"),this.flushUpdates(this.selection.get("documentContainerId"),this._restoreSelection)):void 0}}},function(module,exports,__webpack_require__){var BlockModelHelper,DocumentModelHelper;DocumentModelHelper=__webpack_require__(108),BlockModelHelper=__webpack_require__(107),module.exports={onUpdateTextTag:function(textTag){var documentInfo,endInfo,removeTag,startInfo;return documentInfo=this._getCurrentDocumentInfo(),removeTag=this.selection.get("textTags").contains(textTag),startInfo=this.selection.get("start").toJS(),endInfo=this.selection.get("end").toJS(),this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(_this){return function(documentModel){return DocumentModelHelper.updateTextTagForSelection(documentModel,documentInfo.config,textTag,removeTag,startInfo,endInfo)}}(this)),this.selection.update(function(currentSelection){return currentSelection.setIn(["start","atNodeStart"],currentSelection.getIn(["start","customTagOffset"])>0)}),this.updateLastAction(removeTag?"Delete Text Tag":"Add Text Tag"),this.flushUpdates(this.selection.get("documentContainerId"),this._restoreSelection)},onChangeTextBlockType:function(blockType){var documentInfo,endIndex,endInfo,lastBlock,startIndex,startInfo,textBlocks;return documentInfo=this._getCurrentDocumentInfo(),textBlocks=this.selection.get("textBlocks"),startInfo=this.selection.get("start").toJS(),startIndex=startInfo.index,endInfo=this.selection.get("end").toJS(),endIndex=endInfo.index,endIndex>startIndex&&(lastBlock=this.documentModelsCursor().cursor(documentInfo.modelPath).get(endIndex),BlockModelHelper.selectionAtStartOfBlock(lastBlock,endInfo)&&(endIndex-=1)),textBlocks.every(function(textBlockType){return textBlockType===blockType})&&(blockType=documentInfo.config.defaultTextBlockType),this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(_this){return function(documentModel){return DocumentModelHelper.updateBlockTypeForSelection(documentModel,documentInfo.config,blockType,startIndex,endIndex)}}(this)),this.updateLastAction("Modify Text Block"),this.flushUpdates(this.selection.get("documentContainerId"),this._restoreSelection)}}},function(module,exports,__webpack_require__){var DocumentModelHelper,Immutable,React,SelectionHelper,_;_=__webpack_require__(17),React=__webpack_require__(18),Immutable=__webpack_require__(20),SelectionHelper=__webpack_require__(114),DocumentModelHelper=__webpack_require__(108),module.exports={onUpdateSelection:function(){var direction,selection,selectionState;return selection=SelectionHelper.getSelection(),selectionState=this._stateForTextSelection(selection),this.inClick&&this.updateLastAction("Cursor Mouse Modification"),_.isEmpty(selectionState)?this.selection.set("inContentEditable",!1):(null!=selectionState.start&&selection.isCollapsed&&SelectionHelper.selectionAfterZWSP(selection)&&(direction=this._directionForSelectionAfterZWSP(selectionState),selection.nativeSelection.modify("move",direction,"character"),"right"===direction&&(selectionState=this._stateForTextSelection(SelectionHelper.getSelection()))),this.selection.update(function(){return Immutable.fromJS(selectionState)})),this.watchForSelectionChanges()},onRestoreSelection:function(){return this._restoreSelection()},onUpdateDimensions:function(event){var newSelectionPosition,selectedDocumentInfo;return this.documentComponents.forEach(function(document){return document.updateDimensions()}),(selectedDocumentInfo=this._getCurrentDocumentInfo())?(this.ignoreSelectionChanges(),newSelectionPosition=SelectionHelper.selectionPositionWithinNode(SelectionHelper.getSelection(),React.findDOMNode(selectedDocumentInfo.document)),this.selection.set("position",Immutable.fromJS(newSelectionPosition)),this.updateLastAction("Resize Window"),this.watchForSelectionChanges()):void 0},onRemoveSelection:function(){return this.selection.clear()},onMoveSelectionToStartOfBlock:function(){return this.selection.update(function(existingSelection){var newStart;return newStart=Immutable.Map({index:existingSelection.getIn(["start","index"]),offset:0,customTagOffset:0,atNodeStart:!0}),existingSelection.set("start",newStart).set("end",newStart).set("collapsed",!0).set("selectionType","text")}),this.updateLastAction("Cursor Keyboard Modification"),this._restoreSelection()},onMoveSelectionToEndOfBlock:function(){var blockModel,customTagsAtEnd,documentInfo,endIndex,newStart,textLength;return documentInfo=this._getCurrentDocumentInfo(),endIndex=this.selection.getIn(["end","index"]),blockModel=this.documentModelsCursor().cursor(documentInfo.modelPath).get(endIndex),textLength=blockModel.get("text").length,customTagsAtEnd=blockModel.get("customTags").filter(function(customTag){return customTag.get("offset")===textLength}),newStart=Immutable.Map({index:endIndex,offset:textLength,customTagOffset:customTagsAtEnd.count(),atNodeStart:customTagsAtEnd.count()>0}),this.selection.update(function(existingSelection){return existingSelection.set("start",newStart).set("end",newStart).set("collapsed",!0).set("selectionType","text")}),this.updateLastAction("Cursor Keyboard Modification"),this._restoreSelection()},onSelectCustomTag:function(documentContainerId,documentId,blockIndex,customTagIndex,position){var customTagOffset,customTags,customTagsAtOffset,documentInfo,selectedTag,selection,selectionPosition,startAndEnd;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),customTags=this.documentModelsCursor().cursor(documentInfo.modelPath).deref().getIn([blockIndex,"customTags"]),selectedTag=customTags.get(customTagIndex),customTagsAtOffset=customTags.filter(function(customTag){return customTag.get("offset")===selectedTag.get("offset")}),customTagOffset=customTagsAtOffset.indexOf(selectedTag),startAndEnd={index:blockIndex,offset:selectedTag.get("offset"),customTagOffset:customTagOffset,atStart:!1},selectionPosition=SelectionHelper.adjustPositionToNodeFrame(position,React.findDOMNode(documentInfo.document)),this.selection.update(function(){return Immutable.fromJS({documentContainerId:documentContainerId,documentId:documentId,inContentEditable:!0,selectionType:"customTag",customTag:selectedTag.toJS(),start:startAndEnd,end:startAndEnd,position:selectionPosition,collapsed:!0,textBlocks:[],textTags:[],customTags:[selectedTag.get("id")],supportedTextTags:[],supportedTextBlocks:[],supportedCustomBlocks:[]})}),this.updateLastAction("Cursor Mouse Modification"),this.ignoreSelectionChanges(),selection=SelectionHelper.getSelection(),selection.removeAllRanges(),this.watchForSelectionChanges()},onTriggerCustomAction:function(actionName){var customActionConfig,documentInfo,endSelection,selectedText,startSelection;return documentInfo=this._getCurrentDocumentInfo(),startSelection=this.selection.get("start").toJS(),endSelection=this.selection.get("end").toJS(),selectedText=DocumentModelHelper.textFromIndexesAndOffsets(this.documentModelsCursor().cursor(documentInfo.modelPath).deref(),startSelection,endSelection),customActionConfig=documentInfo.config.customActions[actionName],customActionConfig.callback(selectedText)},onFocusDocument:function(documentContainerId,documentId){var blockModel,documentInfo,documentModel,node,selection,selectionState;return documentInfo=this.documentContainers.getIn([documentContainerId,"documents",documentId]),documentModel=this.documentModelsCursor().cursor(documentInfo.modelPath).deref(),blockModel=documentModel.get(0),this.ignoreSelectionChanges(),node=React.findDOMNode(documentInfo.document.refs[blockModel.get("id")]),selection=SelectionHelper.createSelection(node,0,node,0),selectionState=this._stateForTextSelection(selection),this.selection.update(function(){return Immutable.fromJS(selectionState)}),this._ensureSelectionIsInView(),this.watchForSelectionChanges()},_stateForTextSelection:function(selection){var containingDocuments,deepestDocument,selectionState;return this.ignoreSelectionChanges(),containingDocuments=this.documentComponents.filter(function(_this){return function(document){return document.containsSelection(selection)}}(this)),deepestDocument=containingDocuments.find(function(document){var otherDocuments;return otherDocuments=containingDocuments.filterNot(function(otherDocument){return otherDocument===document}),otherDocuments.every(function(otherDocument){return!SelectionHelper.isAncestorOf(document,otherDocument)})}),selectionState=null!=deepestDocument?deepestDocument.textSelectionState(selection):{}},_restoreSelection:function(callback){var documentInfo,selection;return null==callback&&(callback=null),(documentInfo=this._getCurrentDocumentInfo())?(this.ignoreSelectionChanges(),selection=documentInfo.document.restoreSelection(this.selection.get("start").toJS(),this.selection.get("end").toJS()),this.selection.update(function(){return Immutable.fromJS(documentInfo.document.textSelectionState(selection))}),this._ensureSelectionIsInView(),this.watchForSelectionChanges(),"function"==typeof callback?callback():void 0):(selection=SelectionHelper.getSelection(),selection.removeAllRanges(),"function"==typeof callback?callback():void 0)},_directionForSelectionAfterZWSP:function(newSelectionState){var atEndOfBlock,atLastCustomTagOffset,atLastOffset,currentBlock,customTagsAtEnd,documentInfo,nextBlock,nextBlockCanBeSelected,previousInSameBlock,previousSelection,previouslyWasLeftOrEqualCustomTagOffset,previouslyWasLeftOrEqualOffset;return previousSelection=this.selection.toJS(),previousInSameBlock=null!=previousSelection.start&&previousSelection.start.index===newSelectionState.start.index,previouslyWasLeftOrEqualOffset=null!=previousSelection.start&&previousSelection.start.offset<newSelectionState.start.offset,previouslyWasLeftOrEqualCustomTagOffset=null!=previousSelection.start&&previousSelection.start.customTagOffset<=newSelectionState.start.customTagOffset,documentInfo=this.documentContainers.getIn([newSelectionState.documentContainerId,"documents",newSelectionState.documentId]),nextBlock=this.documentModelsCursor().cursor(documentInfo.modelPath).deref().get(newSelectionState.start.index+1),nextBlockCanBeSelected=null!=nextBlock&&null!=documentInfo.config.textBlocks[nextBlock.get("blockType")],currentBlock=this.documentModelsCursor().cursor(documentInfo.modelPath).deref().get(newSelectionState.start.index),
atLastOffset=currentBlock.get("text").length===newSelectionState.start.offset,customTagsAtEnd=(currentBlock.get("customTags")||Immutable.List()).filter(function(customTag){return customTag.get("offset")===newSelectionState.start.offset}),atLastCustomTagOffset=customTagsAtEnd.size===newSelectionState.start.customTagOffset,atEndOfBlock=atLastOffset&&atLastCustomTagOffset,!previousInSameBlock||atEndOfBlock&&!nextBlockCanBeSelected||!previouslyWasLeftOrEqualOffset&&!previouslyWasLeftOrEqualCustomTagOffset?"left":"right"},_ensureSelectionIsInView:function(){var absoluteDocumentTop,documentInfo,documentOffsets,ref,selectionPosition,windowDocumentBottom,windowDocumentTop;if(documentInfo=this._getCurrentDocumentInfo()){if(documentOffsets=React.findDOMNode(documentInfo.document).getBoundingClientRect(),selectionPosition=(null!=(ref=this.selection.get("position"))?ref.toJS():void 0)||{},windowDocumentTop=-1*documentOffsets.top,windowDocumentBottom=windowDocumentTop+window.innerHeight,absoluteDocumentTop=window.scrollY+documentOffsets.top,null!=selectionPosition.top&&selectionPosition.top<windowDocumentTop)return window.scrollTo(0,Math.max(absoluteDocumentTop+selectionPosition.top-100,0));if(null!=selectionPosition.bottom&&selectionPosition.bottom>windowDocumentBottom)return window.scrollTo(0,absoluteDocumentTop+selectionPosition.top-window.innerHeight+300)}}}},function(module,exports,__webpack_require__){"use strict";var _createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_rangy2=__webpack_require__(115),_selectionchange=(_interopRequireDefault(_rangy2),__webpack_require__(88)),_selectionchange2=_interopRequireDefault(_selectionchange);"undefined"!=typeof window&&"undefined"!=typeof window.getSelection&&rangy.init();var SelectionHelper=function(){function SelectionHelper(){_classCallCheck(this,SelectionHelper)}return _createClass(SelectionHelper,null,[{key:"getSelection",value:function(){return rangy.getSelection()}},{key:"selectionIsWithinNode",value:function(selection,node){return this.isAncestorOf(node,selection.anchorNode)&&this.isAncestorOf(node,selection.focusNode)}},{key:"isAncestorOf",value:function(ancestor,decendent){return"undefined"!=typeof decendent&&rangy.dom.isAncestorOf(ancestor,decendent,!0)}},{key:"selectionPositionWithinNode",value:function(selection,node){var basePosition=void 0;return basePosition=selection.isCollapsed?this.selectionIsZWSP(selection)?this.selectionPositionFromParentNode(selection):this.collapsedSelectionPosition(selection):selection.getRangeAt(0).nativeRange.getBoundingClientRect(),this.adjustPositionToNodeFrame(basePosition,node)}},{key:"collapsedSelectionPosition",value:function(selection){var leftRect=this.uncollapseSelectionAndGetPosition(selection,"left"),rightRect=this.uncollapseSelectionAndGetPosition(selection,"right");return 0==leftRect.height?rightRect:0==rightRect.height?leftRect:leftRect.height>rightRect.height?rightRect:rightRect.height>leftRect.height?leftRect:rightRect.top>leftRect.top?rightRect:leftRect}},{key:"uncollapseSelectionAndGetPosition",value:function(selection,direction){var existingRange=selection.getRangeAt(0);selection.nativeSelection.modify("extend",direction,"character"),selection.refresh();var rect=selection.getRangeAt(0).nativeRange.getBoundingClientRect();return selection.setSingleRange(existingRange),{top:rect.top,left:"left"==direction?rect.right:rect.left,bottom:rect.bottom,right:"left"==direction?rect.right:rect.left,height:rect.height,width:rect.width}}},{key:"selectionIsZWSP",value:function(selection){return/^[\u200B-\u200D]$/g.test(selection.anchorNode.textContent)}},{key:"selectionAfterZWSP",value:function(selection){return this.selectionIsZWSP(selection)&&1==selection.anchorOffset}},{key:"selectionPositionFromParentNode",value:function(selection){return selection.anchorNode.parentNode.getBoundingClientRect()}},{key:"adjustPositionToNodeFrame",value:function(position,node){var offsets=node.getBoundingClientRect();return{top:position.top-offsets.top,left:position.left-offsets.left,right:position.right-offsets.left,bottom:position.bottom-offsets.top,height:position.height,width:position.width}}},{key:"selectNode",value:function(node){var findFirstTextNode=function(_x){for(var _again=!0;_again;){var node=_x;_again=!1;{if("undefined"==typeof node.tagName||!node.childNodes.length)return node;_x=node.childNodes[0],_again=!0}}},findLastTextNode=function(_x2){for(var _again2=!0;_again2;){var node=_x2;_again2=!1;{if("undefined"==typeof node.tagName||!node.childNodes.length)return node;_x2=_lodash2["default"].last(node.childNodes),_again2=!0}}},firstNode=findFirstTextNode(node),lastNode=findLastTextNode(node);return this.createSelection(firstNode,0,lastNode,lastNode.textContent.length)}},{key:"createSelection",value:function(startNode,startOffset,endNode,endOffset){var range=rangy.createRange();range.setStart(startNode,startOffset),range.setEnd(endNode,endOffset);var selection=rangy.getSelection();return selection.setSingleRange(range),_selectionchange2["default"].trigger(),selection}}]),SelectionHelper}();exports["default"]=SelectionHelper,module.exports=exports["default"]},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_115__},function(module,exports,__webpack_require__){var BlockModelHelper,DocumentModelHelper,Immutable,SelectionHelper,_,selectionchange;_=__webpack_require__(17),Immutable=__webpack_require__(20),selectionchange=__webpack_require__(88),BlockModelHelper=__webpack_require__(107),DocumentModelHelper=__webpack_require__(108),SelectionHelper=__webpack_require__(114),module.exports={onTypingIntent:function(){var documentInfo,newSelectionState,selection,selectionEnd,selectionStart;return documentInfo=this._getCurrentDocumentInfo(),selectionStart=this.selection.get("start").toJS(),selectionEnd=this.selection.get("end").toJS(),this.currentlyTyping=!0,selectionStart.index<selectionEnd.index?(this.updateLastAction("Insert Character Over"),this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return DocumentModelHelper.removeDataForOffsets(documentModel,documentInfo.config,selectionStart,selectionEnd)}),selection=SelectionHelper.getSelection(),selection.collapseToStart(),newSelectionState=this._stateForTextSelection(selection),this.selection.update(function(){return Immutable.fromJS(newSelectionState)}),this.deletedDuringTyping=!0,this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this._restoreSelection(function(){return selectionchange.trigger()})}}(this))):(this.updateLastAction(this.selection.get("collapsed")?"Insert Character":"Insert Character Over"),selectionchange.trigger())},onDocumentChangeIntent:function(){return this.keyOperationQueue.add(this._documentChangeIntentPromise)},onEnterIntent:function(){return this.keyOperationQueue.add(this._enterIntentPromise)},onBackspaceIntent:function(invalidateDOM){return null==invalidateDOM&&(invalidateDOM=!1),this.deleteHalted?void 0:this.keyOperationQueue.add(this._deleteIntentPromise("left",invalidateDOM))},onDeleteIntent:function(invalidateDOM){return null==invalidateDOM&&(invalidateDOM=!1),this.deleteHalted?void 0:this.keyOperationQueue.add(this._deleteIntentPromise("right",invalidateDOM))},haltDeleteIntent:function(){return this.deleteHalted=!0,setTimeout(function(_this){return function(){return _this.deleteHalted=!1}}(this),0)},_documentChangeIntentPromise:function(){return new Promise(function(_this){return function(resolve){var documentInfo,selectionStart;return _this.currentlyTyping=!1,_this.lastIntentWasTyping=!0,documentInfo=_this._getCurrentDocumentInfo(),selectionStart=_this.selection.get("start").toJS(),_this.documentModelsCursor().cursor(_.flatten([documentInfo.modelPath,selectionStart.index])).update(function(blockModel){return documentInfo.document.refs[blockModel.get("id")].elementsAsModel()}),_this.flushUpdates(_this.selection.get("documentContainerId"),function(){return resolve(),_this.deletedDuringTyping?(_this.deletedDuringTyping=!1,_this.onUpdateSelection()):selectionchange.trigger()})}}(this))},_flushAfterTyping:function(){return this.lastIntentWasTyping?(this.lastIntentWasTyping=!1,this.documentComponents.forEach(function(document){return document.forceRenderBlocks()})):void 0},_enterIntentPromise:function(){return new Promise(function(_this){return function(resolve){var documentInfo,endInfo,selectionCollapsed,startInfo;return _this._flushAfterTyping(),documentInfo=_this._getCurrentDocumentInfo(),selectionCollapsed=_this.selection.get("collapsed"),documentInfo.config.allowBlockMutation?selectionCollapsed?(_this.updateLastAction("Enter"),_this._collapsedEnterIntent(resolve)):(_this.updateLastAction("Enter Over"),startInfo=_this.selection.get("start").toJS(),endInfo=_this.selection.get("end").toJS(),_this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return DocumentModelHelper.removeDataForOffsets(documentModel,documentInfo.config,startInfo,endInfo)}),_this.selection.update(function(currentSelection){return currentSelection.set("end",Immutable.fromJS(currentSelection.get("start").toJS()))}),_this._collapsedEnterIntent(resolve)):selectionCollapsed?_this._fireExternalEnterEvents(resolve):resolve()}}(this))},_deleteIntentPromise:function(direction,invalidateDOM){return function(_this){return function(){return new Promise(function(resolve){var blockModel,documentInfo,documentModel,selectionCollapsed,selectionStart;return _this._flushAfterTyping(),documentInfo=_this._getCurrentDocumentInfo(),selectionStart=_this.selection.get("start").toJS(),selectionCollapsed=_this.selection.get("collapsed"),documentModel=_this.documentModelsCursor().cursor(documentInfo.modelPath).deref(),blockModel=documentModel.get(0),invalidateDOM&&documentInfo.document.invalidateInternalDOM(),selectionCollapsed?"left"===direction&&BlockModelHelper.selectionAtStartOfBlock(blockModel,selectionStart)?0===selectionStart.index&&BlockModelHelper.blockModelIsEmpty(blockModel)?(documentInfo.document.deleteAtEmptyStartIntent(),resolve()):documentInfo.config.allowBlockMutation?(_this.updateLastAction("Delete Character"),_this._combineCurrentBlockWithPreviousBlock(selectionStart,resolve)):resolve():"right"===direction&&BlockModelHelper.selectionAtEndOfBlock(blockModel,selectionStart)?selectionStart.index===documentModel.count()-1&&BlockModelHelper.blockModelIsEmpty(blockModel)?(documentInfo.document.deleteAtEmptyEndIntent(),resolve()):documentInfo.config.allowBlockMutation?(_this.updateLastAction("Delete Character"),_this._combineCurrentBlockWithNextBlock(selectionStart,resolve)):resolve():(_this.updateLastAction("Delete Character"),_this._deleteOneItem(direction,blockModel,selectionStart,resolve)):(_this.updateLastAction(invalidateDOM?"Cut":"Delete Selection"),_this._deleteSelection(selectionStart,resolve))})}}(this)},_collapsedEnterIntent:function(callback){var blockConfig,blockModel,documentInfo,documentModelCursor,nextBlock,nextBlockIsTextBlock,nextBlockType,previousBlock,previousBlockIsTextBlock,startSelection;if(null==callback&&(callback=null),documentInfo=this._getCurrentDocumentInfo(),startSelection=this.selection.get("start").toJS(),documentModelCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),blockModel=documentModelCursor.deref().get(startSelection.index),BlockModelHelper.blockModelIsEmpty(blockModel))return blockConfig=documentInfo.config.textBlocks[blockModel.get("blockType")],null!=blockConfig.sharedParentElement?(this.documentModelsCursor().cursor(_.flatten([documentInfo.modelPath,startSelection.index,"blockType"])).update(function(){return documentInfo.config.defaultTextBlockType}),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this._restoreSelection(callback)}}(this))):("function"==typeof callback&&callback(),!1);if(BlockModelHelper.selectionAtStartOfBlock(blockModel,startSelection)){if(startSelection.index>0&&(previousBlock=documentModelCursor.deref().get(startSelection.index-1),previousBlockIsTextBlock=null!=previousBlock&&null!=documentInfo.config.textBlocks[previousBlock.get("blockType")],null!=previousBlock&&previousBlockIsTextBlock&&BlockModelHelper.blockModelIsEmpty(previousBlock)))return"function"==typeof callback&&callback(),!1;documentModelCursor.update(function(documentModel){return DocumentModelHelper.addEmptyBlock(documentModel,blockModel.get("blockType"),startSelection.index)})}else BlockModelHelper.selectionAtEndOfBlock(blockModel,startSelection)?(nextBlock=documentModelCursor.deref().get(startSelection.index+1),nextBlockIsTextBlock=null!=nextBlock&&null!=documentInfo.config.textBlocks[nextBlock.get("blockType")],nextBlockIsTextBlock&&BlockModelHelper.blockModelIsEmpty(nextBlock)||(nextBlockType=documentInfo.config.textBlocks[blockModel.get("blockType")].nextBlockType,documentModelCursor.update(function(documentModel){return DocumentModelHelper.addEmptyBlock(documentModel,nextBlockType,startSelection.index+1)}))):documentModelCursor.update(function(documentModel){return DocumentModelHelper.splitBlock(documentModel,documentInfo.config,startSelection.index,startSelection.offset,startSelection.customTagOffset)});return this.selection.update(function(currentSelection){return currentSelection.set("start",Immutable.Map({index:startSelection.index+1,offset:0,customTagOffset:0,atNodeStart:!0})).set("end",Immutable.Map({index:startSelection.index+1,offset:0,customTagOffset:0,atNodeStart:!0}))}),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this._restoreSelection(callback)}}(this))},_fireExternalEnterEvents:function(callback){var atEndOfDocument,atStartOfDocument,blockModel,documentInfo,documentModelCursor,startSelection;return null==callback&&(callback=null),documentInfo=this._getCurrentDocumentInfo(),startSelection=this.selection.get("start").toJS(),documentModelCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),blockModel=documentModelCursor.deref().get(startSelection.index),atStartOfDocument=0===startSelection.index,atEndOfDocument=documentModelCursor.count()===startSelection.index+1,atStartOfDocument&&BlockModelHelper.selectionAtStartOfBlock(blockModel,startSelection)&&documentInfo.document.enterAtImmutableStartIntent(),atEndOfDocument&&BlockModelHelper.selectionAtEndOfBlock(blockModel,startSelection)&&documentInfo.document.enterAtImmutableEndIntent(),"function"==typeof callback?callback():void 0},_combineCurrentBlockWithPreviousBlock:function(selectionStart,callback){var blockModel,documentInfo,documentModelCursor,previousBlock,previousBlockCustomTagsAtEnd,previousBlockIndex,previousBlockIsText,previousBlockOffset;return null==callback&&(callback=null),0===selectionStart.index?"function"==typeof callback?callback():void 0:(documentInfo=this._getCurrentDocumentInfo(),documentModelCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),previousBlockIndex=selectionStart.index-1,previousBlock=documentModelCursor.deref().get(previousBlockIndex),(previousBlockIsText=null!=documentInfo.config.textBlocks[previousBlock.get("blockType")])?(previousBlockOffset=previousBlock.get("text").length,previousBlockCustomTagsAtEnd=previousBlock.get("customTags",Immutable.List()).filter(function(customTag){return customTag.get("offset")===previousBlockOffset}),this.ignoreSelectionChanges(),documentModelCursor.update(function(_this){return function(documentModel){return DocumentModelHelper.combineBlockWithPreviousBlock(documentModel,documentInfo.config,selectionStart.index)}}(this)),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this.selection.update(function(currentSelection){return currentSelection.setIn(["start","index"],previousBlockIndex).setIn(["end","index"],previousBlockIndex).setIn(["start","offset"],previousBlockOffset).setIn(["end","offset"],previousBlockOffset).setIn(["start","customTagOffset"],previousBlockCustomTagsAtEnd.count()).setIn(["end","customTagOffset"],previousBlockCustomTagsAtEnd.count()).setIn(["start","atNodeStart"],previousBlockCustomTagsAtEnd.count()>0).setIn(["end","atNodeStart"],previousBlockCustomTagsAtEnd.count()>0)}),_this._restoreSelection(callback)}}(this))):(blockModel=documentModelCursor.deref().get(selectionStart.index),BlockModelHelper.blockModelIsEmpty(blockModel)?(documentModelCursor.update(function(documentModel){return documentModel.splice(selectionStart.index,1)}),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this.selection.clear(),_this._restoreSelection(callback)}}(this))):void("function"==typeof callback&&callback())))},_combineCurrentBlockWithNextBlock:function(selectionStart,callback){var blockModel,documentInfo,documentModelCursor,nextBlock,nextBlockIndex,nextBlockIsText;return null==callback&&(callback=null),documentInfo=this._getCurrentDocumentInfo(),documentModelCursor=this.documentModelsCursor().cursor(documentInfo.modelPath),selectionStart.index<documentModelCursor.count()-1?(nextBlockIndex=selectionStart.index+1,nextBlock=documentModelCursor.deref().get(nextBlockIndex),(nextBlockIsText=null!=documentInfo.config.textBlocks[nextBlock.get("blockType")])?(this.ignoreSelectionChanges(),documentModelCursor.update(function(_this){return function(documentModel){return DocumentModelHelper.combineBlockWithPreviousBlock(documentModel,documentInfo.config,selectionStart.index+1)}}(this)),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this._restoreSelection(callback)}}(this))):(blockModel=documentModelCursor.deref().get(selectionStart.index),BlockModelHelper.blockModelIsEmpty(blockModel)?(documentModelCursor.update(function(documentModel){return documentModel.splice(selectionStart.index,1)}),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this.selection.clear(),_this._restoreSelection(callback)}}(this))):void("function"==typeof callback&&callback()))):"function"==typeof callback?callback():void 0},_deleteOneItem:function(direction,blockModel,selectionStart,callback){var customTagCount;switch(null==callback&&(callback=null),direction){case"left":return selectionStart.customTagOffset>0?this._deleteOneTag(direction,selectionStart,callback):this._deleteOneCharacter(direction,selectionStart,callback);case"right":return customTagCount=blockModel.get("customTags",Immutable.List()).filter(function(customTag){return customTag.get("offset")===selectionStart.offset}).count(),selectionStart.customTagOffset<customTagCount?this._deleteOneTag(direction,selectionStart,callback):this._deleteOneCharacter(direction,selectionStart,callback)}},_deleteSelection:function(selectionStart,callback){var documentInfo,selectionEnd;return null==callback&&(callback=null),documentInfo=this._getCurrentDocumentInfo(),selectionEnd=this.selection.get("end").toJS(),this.ignoreSelectionChanges(),this.documentModelsCursor().cursor(documentInfo.modelPath).update(function(documentModel){return DocumentModelHelper.removeDataForOffsets(documentModel,documentInfo.config,selectionStart,selectionEnd)}),this.selection.update(function(currentSelection){return currentSelection.set("end",Immutable.fromJS(currentSelection.get("start").toJS()))}),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this._restoreSelection(callback)}}(this))},_deleteOneTag:function(direction,selectionStart,callback){var customTagOffsetToRemove,documentInfo;return null==callback&&(callback=null),documentInfo=this._getCurrentDocumentInfo(),this.ignoreSelectionChanges(),customTagOffsetToRemove="left"===direction?selectionStart.customTagOffset:selectionStart.customTagOffset+1,this.documentModelsCursor().cursor(_.flatten([documentInfo.modelPath,selectionStart.index])).update(function(_this){return function(blockModel){return BlockModelHelper.removeCustomTagAtOffset(blockModel,selectionStart.offset,customTagOffsetToRemove)}}(this)),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this.selection.update(function(currentSelection){var newCustomTagOffset;return newCustomTagOffset=customTagOffsetToRemove-1,currentSelection.setIn(["start","customTagOffset"],newCustomTagOffset).setIn(["start","atNodeStart"],newCustomTagOffset>0).setIn(["end","customTagOffset"],newCustomTagOffset).setIn(["end","atNodeStart"],newCustomTagOffset>0)}),_this._restoreSelection(callback)}}(this))},_deleteOneCharacter:function(direction,selectionStart,callback){var customTagCount,documentInfo,newEndOffset,newStartOffset;return null==callback&&(callback=null),documentInfo=this._getCurrentDocumentInfo(),newStartOffset="left"===direction?selectionStart.offset-1:selectionStart.offset,newEndOffset="left"===direction?selectionStart.offset:selectionStart.offset+1,customTagCount=0,this.ignoreSelectionChanges(),this.documentModelsCursor().cursor(_.flatten([documentInfo.modelPath,selectionStart.index])).update(function(_this){return function(blockModel){return customTagCount=blockModel.get("customTags",Immutable.List()).filter(function(customTag){return customTag.get("offset")===newStartOffset}).count(),BlockModelHelper.removeDataForOffsets(blockModel,documentInfo.config,newStartOffset,customTagCount,newEndOffset,0)}}(this)),this.flushUpdates(this.selection.get("documentContainerId"),function(_this){return function(){return _this.selection.update(function(currentSelection){return currentSelection.setIn(["start","offset"],newStartOffset).setIn(["start","customTagOffset"],customTagCount).setIn(["start","atNodeStart"],customTagCount>0).setIn(["end","offset"],newStartOffset).setIn(["end","customTagOffset"],customTagCount).setIn(["end","atNodeStart"],customTagCount>0)}),_this._restoreSelection(callback)}}(this))}}},function(module,exports,__webpack_require__){"use strict";var _createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_immutablediff=__webpack_require__(118),_immutablediff2=_interopRequireDefault(_immutablediff),UndoManager=function(){function UndoManager(){_classCallCheck(this,UndoManager),this.undoStack=new _immutable.List,this.redoStack=new _immutable.List,this.aggregationCount=0,this.timeOflastTextMutation=null,this.typeOflastTextMutation=null}return _createClass(UndoManager,null,[{key:"CollapsableUserActions",value:new _immutable.List(["Insert Character","Delete Character"]),enumerable:!0},{key:"MaxTextChangeForStateCollapse",value:10,enumerable:!0}]),_createClass(UndoManager,[{key:"addState",value:function(nextState){var replace=arguments.length<=1||void 0===arguments[1]?!1:arguments[1];replace?(this.undoStack=this.undoStack.pop(),this.undoStack=this.undoStack.push(nextState)):this.shouldReplaceBecauseOnlySingeTextMutation(nextState)?this.addState(nextState,!0):(this.undoStack=this.undoStack.push(nextState),this.redoStack=new _immutable.List)}},{key:"replaceIn",value:function(keyPath,newValue){var existingState=this.undoStack.last();existingState&&(this.undoStack=this.undoStack.pop(),this.undoStack=this.undoStack.push(existingState.setIn(keyPath,newValue)))}},{key:"undo",value:function(){return this.redoStack=this.redoStack.push(this.undoStack.last()),this.undoStack=this.undoStack.pop(),this.undoStack.last()}},{key:"canUndo",value:function(){return this.undoStack.size>1}},{key:"redo",value:function(){return this.undoStack=this.undoStack.push(this.redoStack.last()),this.redoStack=this.redoStack.pop(),this.undoStack.last()}},{key:"canRedo",value:function(){return this.redoStack.size>0}},{key:"shouldReplaceBecauseOnlySingeTextMutation",value:function(nextState){var _this=this,prevState=this.undoStack.last(),prevUserAction=prevState.getIn(["structure","lastAction","name"]),nextUserAction=nextState.getIn(["structure","lastAction","name"]);if(prevUserAction==nextUserAction&&UndoManager.CollapsableUserActions.contains(nextUserAction)){var _ret=function(){var prevDocuments=prevState.getIn(["structure","documentModels"]),nextDocuments=nextState.getIn(["structure","documentModels"]);if(prevDocuments.size==nextDocuments.size){var _ret2=function(){var textChanges=new _immutable.List;if(prevDocuments.forEach(function(prevDocument,index){var nextDocument=nextDocuments.get(index),textDiff=_immutablediff2["default"](prevDocument,nextDocument).filter(function(change){return"replace"==change.get("op")}).map(function(change){var splitPath=_immutable2["default"].List(change.get("path").split("/")).filter(function(part){return part.length}).map(function(part){return/^[0-9]*$/.test(part)?parseInt(part):part});return change.set("splitPath",splitPath.unshift(index)).set("path","/"+index+change.get("path"))}).filter(function(change){return"text"==change.get("splitPath").last()});textChanges=textChanges.concat(textDiff)}),1==textChanges.size){var path=textChanges.first().get("splitPath"),prevValueLength=prevDocuments.hasIn(path)?prevDocuments.getIn(path).length:0,nextValueLength=nextDocuments.hasIn(path)?nextDocuments.getIn(path).length:0,lengthDifference=nextValueLength-prevValueLength;if(Math.abs(lengthDifference)>0&&(_this.aggregationCount+=1,_this.aggregationCount<UndoManager.MaxTextChangeForStateCollapse))return{v:{v:!0}}}}();if("object"==typeof _ret2)return _ret2.v}}();if("object"==typeof _ret)return _ret.v}return this.aggregationCount=0,!1}}]),UndoManager}();exports["default"]=UndoManager,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var Immutable=__webpack_require__(20),utils=__webpack_require__(119),lcs=__webpack_require__(120),path=__webpack_require__(121),concatPath=path.concat,escape=path.escape,op=utils.op,isMap=utils.isMap,isIndexed=utils.isIndexed,mapDiff=function(a,b,p){var ops=[],path=p||"";if(Immutable.is(a,b)||a==b==null)return ops;var areLists=isIndexed(a)&&isIndexed(b),lastKey=null,removeKey=null;return a.forEach&&a.forEach(function(aValue,aKey){if(b.has(aKey))if(isMap(aValue)&&isMap(b.get(aKey)))ops=ops.concat(mapDiff(aValue,b.get(aKey),concatPath(path,escape(aKey))));else if(isIndexed(b.get(aKey))&&isIndexed(aValue))ops=ops.concat(sequenceDiff(aValue,b.get(aKey),concatPath(path,escape(aKey))));else{var bValue=b.get?b.get(aKey):b,areDifferentValues=aValue!==bValue;areDifferentValues&&ops.push(op("replace",concatPath(path,escape(aKey)),bValue))}else areLists?(removeKey=null!=lastKey&&lastKey+1===aKey?removeKey:aKey,ops.push(op("remove",concatPath(path,escape(removeKey)))),lastKey=aKey):ops.push(op("remove",concatPath(path,escape(aKey))))}),b.forEach(function(bValue,bKey){a.has&&!a.has(bKey)&&ops.push(op("add",concatPath(path,escape(bKey)),bValue))}),ops},sequenceDiff=function(a,b,p){var ops=[],path=p||"";if(Immutable.is(a,b)||a==b==null)return ops;if(b.count()>100)return mapDiff(a,b,p);var lcsDiff=lcs.diff(a,b),pathIndex=0;return lcsDiff.forEach(function(diff){if("="===diff.op)pathIndex++;else if("!="===diff.op){if(isMap(diff.val)&&isMap(diff.newVal)){var mapDiffs=mapDiff(diff.val,diff.newVal,concatPath(path,pathIndex));ops=ops.concat(mapDiffs)}else ops.push(op("replace",concatPath(path,pathIndex),diff.newVal));pathIndex++}else"+"===diff.op?(ops.push(op("add",concatPath(path,pathIndex),diff.val)),pathIndex++):"-"===diff.op&&ops.push(op("remove",concatPath(path,pathIndex)))}),ops},primitiveTypeDiff=function(a,b,p){var path=p||"";return a===b?[]:[op("replace",concatPath(path,""),b)]},diff=function(a,b,p){return a==b||null!=a&&null!=b?isIndexed(a)&&isIndexed(b)?Immutable.fromJS(sequenceDiff(a,b)):isMap(a)&&isMap(b)?Immutable.fromJS(mapDiff(a,b)):Immutable.fromJS(primitiveTypeDiff(a,b,p)):Immutable.fromJS([op("replace","/",b)])};module.exports=diff},function(module,exports,__webpack_require__){"use strict";var Immutable=__webpack_require__(20),isMap=function(obj){return Immutable.Iterable.isKeyed(obj)},isIndexed=function(obj){return Immutable.Iterable.isIndexed(obj)},op=function(operation,path,value){return"remove"===operation?{op:operation,path:path}:{op:operation,path:path,value:value}};module.exports={isMap:isMap,isIndexed:isIndexed,op:op}},function(module,exports,__webpack_require__){"use strict";function computeLcsMatrix(xs,ys){for(var n=xs.size||0,m=ys.size||0,a=makeMatrix(n+1,m+1,0),i=0;n>i;i++)for(var j=0;m>j;j++)Immutable.is(xs.get(i),ys.get(j))?a[i+1][j+1]=a[i][j]+1:a[i+1][j+1]=Math.max(a[i+1][j],a[i][j+1]);return a}var Immutable=__webpack_require__(20),makeMatrix=function(n,m,x){for(var matrix=[],i=0;n>i;i++)if(matrix[i]=new Array(m),null!=x)for(var j=0;m>j;j++)matrix[i][j]=x;return matrix},lcs=function(xs,ys){var matrix=computeLcsMatrix(xs,ys);return backtrackLcs(xs,ys,matrix)},DiffResult=Immutable.Record({op:"=",val:null}),ReplaceResult=Immutable.Record({op:"!=",val:null,newVal:null}),diff=function(xs,ys){var matrix=computeLcsMatrix(xs,ys);return printDiff(matrix,xs,ys,xs.size||0,ys.size||0)},printDiff=function(matrix,xs,ys,i,j){return 0===i&&0===j?[]:i>0&&j>0&&Immutable.is(xs.get(i-1),ys.get(j-1))?printDiff(matrix,xs,ys,i-1,j-1).concat(new DiffResult({op:"=",val:xs.get(i-1)})):i>0&&j>0&&i===j&&!Immutable.is(xs.get(i-1),ys.get(j-1))?printDiff(matrix,xs,ys,i-1,j-1).concat(new ReplaceResult({val:xs.get(i-1),newVal:ys.get(i-1)})):j>0&&(0===i||matrix[i][j-1]>=matrix[i-1][j])?printDiff(matrix,xs,ys,i,j-1).concat(new DiffResult({op:"+",val:ys.get(j-1)})):i>0&&(0===j||matrix[i][j-1]<matrix[i-1][j])?printDiff(matrix,xs,ys,i-1,j).concat(new DiffResult({op:"-",val:xs.get(i-1)})):void 0},backtrackLcs=function(xs,ys,matrix){for(var lcs=[],i=xs.size,j=ys.size;0!==i&&0!==j;)matrix[i][j]===matrix[i-1][j]?i--:matrix[i][j]===matrix[i][j-1]?j--:Immutable.is(xs.get(i-1),ys.get(j-1))&&(lcs.push(xs.get(i-1)),i--,j--);return lcs.reverse()};module.exports={lcs:lcs,computeLcsMatrix:computeLcsMatrix,diff:diff}},function(module,exports){"use strict";var slashRe=new RegExp("/","g"),escapedSlashRe=new RegExp("~1","g"),tildeRe=/~/g,escapedTildeRe=/~0/g,Path={escape:function(str){if("number"==typeof str)return str.toString();if("string"!=typeof str)throw"param str ("+str+") is not a string";return str.replace(tildeRe,"~0").replace(slashRe,"~1")},unescape:function(str){return"string"==typeof str?str.replace(escapedSlashRe,"/").replace(escapedTildeRe,"~"):str},concat:function(path,key){return path+"/"+key}};module.exports=Path},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_immutableContribCursor=__webpack_require__(85),_immutableContribCursor2=_interopRequireDefault(_immutableContribCursor),_eventemitter3=__webpack_require__(19),_eventemitter32=_interopRequireDefault(_eventemitter3),chainableCursorMethods=["update","updateIn","set","setIn","remove","removeIn","delete","deleteIn","clear","merge","mergeIn","mergeWith","mergeDeep","mergeDeepWith","mergeDeepIn"],unchainableCursorMethods=["equals","has","hasIn","get","getIn"],Selection=function(_EventEmitter){function Selection(){var _this=this;_classCallCheck(this,Selection),_get(Object.getPrototypeOf(Selection.prototype),"constructor",this).call(this),this.state=_immutable2["default"].fromJS({selection:{}}),this.inTransaction=!1,_lodash2["default"].each(chainableCursorMethods,function(method){_this[method]=function(){for(var _len=arguments.length,args=Array(_len),_key=0;_len>_key;_key++)args[_key]=arguments[_key];var cursor=_this.cursor();return cursor[method].apply(cursor,args),_this}}),_lodash2["default"].each(unchainableCursorMethods,function(method){_this[method]=function(){for(var _len2=arguments.length,args=Array(_len2),_key2=0;_len2>_key2;_key2++)args[_key2]=arguments[_key2];var cursor=_this.cursor();return cursor[method].apply(cursor,args)}})}return _inherits(Selection,_EventEmitter),_createClass(Selection,[{key:"cursor",value:function(){return _immutableContribCursor2["default"].from(this.state,["selection"],this.cursorChanged.bind(this))}},{key:"cursorChanged",value:function(newRoot,oldRoot,path){
return void(this.inTransaction||(oldRoot==this.state?this.state=newRoot:newRoot.hasIn(path)?this.state=this.state.removeIn(path):this.state=this.state.setIn(path,newRoot.getIn(path)),this.swap(oldRoot)))}},{key:"swap",value:function(oldState){this.emit("swap",this.state.get("selection"),oldState.get("selection"))}},{key:"transaction",value:function(){return this.inTransaction=!0,this}},{key:"commit",value:function(){this.inTransaction=!1;var oldState=this.state;this.state=this.cursor()._rootData,this.swap(oldState)}},{key:"deref",value:function(){return this.cursor().deref()}},{key:"toJS",value:function(){return this.deref().toJS()}}]),Selection}(_eventemitter32["default"]);exports["default"]=Selection,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_immutable=__webpack_require__(20),_fusibleConfig=(_interopRequireDefault(_immutable),__webpack_require__(21)),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleStore=__webpack_require__(81),_fusibleStore2=_interopRequireDefault(_fusibleStore),_document=__webpack_require__(124),_document2=_interopRequireDefault(_document),DocumentContainer=function(_Component){function DocumentContainer(){_classCallCheck(this,DocumentContainer),_get(Object.getPrototypeOf(DocumentContainer.prototype),"constructor",this).apply(this,arguments)}return _inherits(DocumentContainer,_Component),_createClass(DocumentContainer,[{key:"componentWillMount",value:function(){this.id="fusible_editor_"+Math.random().toString(36).substr(2,9),this.invalidateCacheKey(),_fusibleStore2["default"].registerDocumentContainer(this,this.props.model)}},{key:"componentDidMount",value:function(){this.currentDocumentModelCursor=this.documentModelCursor()}},{key:"componentWillUnmount",value:function(){_fusibleStore2["default"].unregisterDocumentContainer(this)}},{key:"componentWillUpdate",value:function(nextProps,_nextState){_lodash2["default"].isEqual(nextProps.model,this.props.model)||(_fusibleStore2["default"].registerDocumentContainer(this,nextProps.model),this.invalidateCacheKey())}},{key:"invalidateCacheKey",value:function(){this.cacheKey=Math.random().toString(36).substr(2,9)}},{key:"render",value:function(){this.currentDocumentModelCursor=this.documentModelCursor();var _props=this.props,config=_props.config,childProps=_props.childProps,onEnterAtStart=_props.onEnterAtStart,onEnterAtEnd=_props.onEnterAtEnd,onDeleteWhenEmpty=_props.onDeleteWhenEmpty,className=_props.className;return _reactAddons2["default"].createElement(_document2["default"],{key:"document_"+this.id+"_"+this.cacheKey,ref:"document",documentContainerId:this.id,documentModel:this.currentDocumentModelCursor,config:config,childProps:childProps,onEnterAtStart:onEnterAtStart,onEnterAtEnd:onEnterAtEnd,onDeleteWhenEmpty:onDeleteWhenEmpty,className:className})}},{key:"documentModelCursor",value:function(){return _fusibleStore2["default"].documentModelsCursor().cursor(this.id)}},{key:"triggerUpdate",value:function(){var callback=arguments.length<=0||void 0===arguments[0]?null:arguments[0];if(this.props.onChange){var updatedDocumentModel=this.documentModelCursor().deref();this.currentDocumentModelCursor.deref().equals(updatedDocumentModel)||this.props.onChange(updatedDocumentModel.toJS())}this.currentDocumentModelCursor=this.documentModelCursor(),this.forceUpdate(callback)}},{key:"focus",value:function(){this.refs.document.focus()}}],[{key:"displayName",value:"DocumentContainer",enumerable:!0},{key:"propTypes",value:{model:_reactAddons.PropTypes.arrayOf(_reactAddons.PropTypes.object).isRequired,config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object,onChange:_reactAddons.PropTypes.func,onEnterAtStart:_reactAddons.PropTypes.func,onEnterAtEnd:_reactAddons.PropTypes.func,onDeleteWhenEmpty:_reactAddons.PropTypes.func},enumerable:!0}]),DocumentContainer}(_reactAddons.Component);exports["default"]=DocumentContainer,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_slicedToArray=__webpack_require__(28)["default"],_getIterator=__webpack_require__(29)["default"],_Object$keys=__webpack_require__(79)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_fusibleStore=__webpack_require__(81),_fusibleStore2=_interopRequireDefault(_fusibleStore),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleUtilDom_helper=__webpack_require__(125),_fusibleUtilDom_helper2=_interopRequireDefault(_fusibleUtilDom_helper),_fusibleUtilSelection_helper=__webpack_require__(114),_fusibleUtilSelection_helper2=_interopRequireDefault(_fusibleUtilSelection_helper),_fusibleUtilDocument_model_helper=__webpack_require__(108),_fusibleUtilDocument_model_helper2=_interopRequireDefault(_fusibleUtilDocument_model_helper),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_fusibleActionsDocument_actions=__webpack_require__(101),_fusibleActionsDocument_actions2=_interopRequireDefault(_fusibleActionsDocument_actions),_block=__webpack_require__(130),_block2=_interopRequireDefault(_block),_text_menu=__webpack_require__(134),_text_menu2=_interopRequireDefault(_text_menu),_custom_menu_container=__webpack_require__(139),_custom_menu_container2=_interopRequireDefault(_custom_menu_container),_custom_tag_edit_menu=__webpack_require__(147),_custom_tag_edit_menu2=_interopRequireDefault(_custom_tag_edit_menu),_text_block_container=__webpack_require__(148),_text_block_container2=_interopRequireDefault(_text_block_container),_custom_block_container=__webpack_require__(152),_custom_block_container2=_interopRequireDefault(_custom_block_container),_styleComponentsDocument=__webpack_require__(153),_styleComponentsDocument2=_interopRequireDefault(_styleComponentsDocument),Document=function(_Component){function Document(props){var _this=this;_classCallCheck(this,Document),_get(Object.getPrototypeOf(Document.prototype),"constructor",this).call(this,props),this.enterAtImmutableStartIntent=function(){_this.props.onEnterAtStart&&_this.props.onEnterAtStart()},this.enterAtImmutableEndIntent=function(){_this.props.onEnterAtEnd&&_this.props.onEnterAtEnd()},this.deleteAtEmptyStartIntent=function(){_this.props.onDeleteWhenEmpty&&_this.props.onDeleteWhenEmpty()},this.deleteAtEmptyEndIntent=function(){_this.props.onDeleteWhenEmpty&&_this.props.onDeleteWhenEmpty()},this.focus=function(){_fusibleActionsSelection_actions2["default"].focusDocument(_this.props.documentContainerId,_this.id)},this._groupTextBlockGroup=function(groups,blockGroup){var newGroups=void 0;return newGroups=groups.last()&&"text-list"==groups.last().get("groupType")&&"custom"!=blockGroup.get("groupType")?groups.updateIn([groups.size-1,"groups"],function(nestedGroups){return nestedGroups.push(blockGroup)}):"custom"!=blockGroup.get("groupType")?groups.push(_immutable2["default"].Map({groupType:"text-list",groups:_immutable2["default"].List([blockGroup])})):groups.push(blockGroup)},this._blockGroupToElement=function(blockGroup,index){switch(blockGroup.get("groupType")){case"text-list":return _this._textGroupToElement(blockGroup,index);case"custom":return _this._customGroupToElement(blockGroup,index);default:throw"Unknown group type encountered when rendering blocks: "+blockGroup.groupType}},this._textGroupToElement=function(blockGroup,index){var element=void 0;switch(blockGroup.get("groupType")){case"text-list":element=_this.viewing()?blockGroup.get("groups").map(_this._textGroupToElement).toArray():_reactAddons2["default"].createElement.apply(_this,_lodash2["default"].flatten([_text_block_container2["default"],{key:"editableContainer_"+index,ref:"editableContainer_"+index,documentContainerId:_this.props.documentContainerId,documentId:_this.id,config:_this.props.config,className:_this.props.className},blockGroup.get("groups").map(_this._textGroupToElement).toArray()]));break;case"text-group":element=_reactAddons2["default"].createElement.apply(_this,_lodash2["default"].flatten([blockGroup.get("config").sharedParentElement,{key:"containing_list_"+index},blockGroup.get("groups").map(_this._textGroupToElement).toArray()]));break;case"text":element=_reactAddons2["default"].createElement(_block2["default"],{blockModel:blockGroup.get("blockModel"),ref:blockGroup.getIn(["blockModel","id"]),key:"fusible_block_"+blockGroup.getIn(["blockModel","id"]),documentContainerId:_this.props.documentContainerId,documentId:_this.id,config:_this.props.config,childProps:_this.props.childProps})}return element},this._customGroupToElement=function(blockGroup){var blockId=blockGroup.getIn(["blockModel","id"]);return _reactAddons2["default"].createElement(_custom_block_container2["default"],{ref:blockId,key:"fusible_block_"+blockId,documentContainerId:_this.props.documentContainerId,documentId:_this.id,blockGroup:blockGroup,config:_this.props.config,childProps:_this.props.childProps})},this.state={containerWidth:10,documentModelReference:_fusibleStore2["default"].structure.reference(props.documentModel)}}return _inherits(Document,_Component),_createClass(Document,null,[{key:"displayName",value:"Document",enumerable:!0},{key:"propTypes",value:{documentModel:function(value){return value instanceof _immutable2["default"].List},config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object},enumerable:!0}]),_createClass(Document,[{key:"componentWillMount",value:function(){this.props.documentModel=_fusibleUtilDocument_model_helper2["default"].prepAndValidateDocumentModel(this.props.documentModel,this.props.config),this.id="fusible_document_"+Math.random().toString(36).substr(2,9),this.cacheKey=""+Math.random().toString(36).substr(2,9),this.editing()&&_fusibleActionsDocument_actions2["default"].registerDocument(this.props.documentContainerId,this),this._keyPath=this.props.documentModel._keyPath}},{key:"componentWillUnmount",value:function(){this.editing()&&_fusibleActionsDocument_actions2["default"].unregisterDocument(this.props.documentContainerId,this)}},{key:"componentDidMount",value:function(){this.updateDimensions()}},{key:"componentDidUpdate",value:function(prevProps,prevState){prevProps.documentModel._keyPath!=this.props.documentModel._keyPath&&this.editing()&&_fusibleActionsDocument_actions2["default"].registerDocument(this.props.documentContainerId,this)}},{key:"componentWillReceiveProps",value:function(nextProps){this.updateDimensions(),this.setState({documentModelReference:_fusibleStore2["default"].structure.reference(nextProps.documentModel)})}},{key:"invalidateInternalDOM",value:function(){this.cacheKey=""+Math.random().toString(36).substr(2,9)}},{key:"selectRefsLike",value:function(regex){return _lodash2["default"].pick(this.refs,function(value,key){return regex.test(key)})}},{key:"viewing",value:function(){return this.props.config.renderMode==_fusibleConfig2["default"].RENDER_MODES.VIEWING}},{key:"editing",value:function(){return this.props.config.renderMode==_fusibleConfig2["default"].RENDER_MODES.EDITING}},{key:"containsSelection",value:function(selection){return _lodash2["default"].some(_lodash2["default"].values(this.containerRefs()),function(editableContainer){return _fusibleUtilSelection_helper2["default"].selectionIsWithinNode(selection,_reactAddons2["default"].findDOMNode(editableContainer))})}},{key:"textSelectionState",value:function(selection){var focusState=this.selectionPointState(selection.nativeSelection.focusNode,selection.nativeSelection.focusOffset),anchorState=void 0;if(anchorState=selection.anchorNode?this.selectionPointState(selection.nativeSelection.anchorNode,selection.nativeSelection.anchorOffset):focusState,!selection.isBackwards()){var _ref=[anchorState,focusState];focusState=_ref[0],anchorState=_ref[1]}var selectedTextTags=_fusibleUtilDocument_model_helper2["default"].selectedTextTagsForSelection(this.props.documentModel.deref(),focusState,anchorState),selectedCustomTags=_fusibleUtilDocument_model_helper2["default"].selectedCustomTagsForSelection(this.props.documentModel.deref(),focusState,anchorState),supportedTextTags=_fusibleUtilDocument_model_helper2["default"].supportedTextTagsForSelection(this.props.documentModel.deref(),this.props.config,focusState,anchorState),selectedTextBlocks=_fusibleUtilDocument_model_helper2["default"].selectedTextBlocksForSelection(this.props.documentModel.deref(),focusState,anchorState),supportedTextBlocks=void 0,supportedCustomBlocks=void 0;supportedTextBlocks=this.props.config.allowBlockMutation?_lodash2["default"].pick(this.props.config.textBlocks,function(value,_key){return!value["default"]}):{},supportedCustomBlocks=this.props.config.allowBlockMutation?this.props.config.customBlocks:{};var selectionState={documentContainerId:this.props.documentContainerId,documentId:this.id,inContentEditable:!0,selectionType:"text",customTag:null,start:focusState,end:anchorState,position:_fusibleUtilSelection_helper2["default"].selectionPositionWithinNode(selection,_reactAddons2["default"].findDOMNode(this)),collapsed:selection.isCollapsed,textBlocks:selectedTextBlocks,textTags:selectedTextTags,customTags:selectedCustomTags,supportedTextTags:supportedTextTags,supportedTextBlocks:supportedTextBlocks,supportedCustomBlocks:supportedCustomBlocks},selectedText=_fusibleUtilDocument_model_helper2["default"].textFromIndexesAndOffsets(this.props.documentModel.deref(),selectionState.start,selectionState.end);return selectionState.strange=!selectionState.collapsed&&_lodash2["default"].isEmpty(selectedText.trim()),selectionState}},{key:"selectionPointState",value:function(node,offset){var nodeBlockKey=_fusibleUtilDom_helper2["default"].findParentReactRefMatching(node,/^fusible_block_.*$/);if(nodeBlockKey){var nodeBlockRef=/^fusible_block_(.*)$/.exec(nodeBlockKey)[1],block=this.refs[nodeBlockRef],_block$modelOffsetForNodeAndOffset=block.modelOffsetForNodeAndOffset(node,offset),_block$modelOffsetForNodeAndOffset2=_slicedToArray(_block$modelOffsetForNodeAndOffset,2),textOffset=_block$modelOffsetForNodeAndOffset2[0],customTagOffset=_block$modelOffsetForNodeAndOffset2[1];return{index:this.indexForBlockRef(nodeBlockRef),offset:textOffset,atNodeStart:0==offset,customTagOffset:customTagOffset}}return{}}},{key:"updateDimensions",value:function(){this.setState({containerWidth:_reactAddons2["default"].findDOMNode(this).offsetWidth})}},{key:"restoreSelection",value:function(startInfo,endInfo){var startBlock=this.blockForIndex(startInfo.index),endBlock=this.blockForIndex(endInfo.index),excludeTags=_lodash2["default"].keys(this.props.config.customTags),_DomHelper$nodeAndOffsetForModelSelection=_fusibleUtilDom_helper2["default"].nodeAndOffsetForModelSelection(_reactAddons2["default"].findDOMNode(startBlock),startInfo,excludeTags),_DomHelper$nodeAndOffsetForModelSelection2=_slicedToArray(_DomHelper$nodeAndOffsetForModelSelection,2),startNode=_DomHelper$nodeAndOffsetForModelSelection2[0],startOffset=_DomHelper$nodeAndOffsetForModelSelection2[1],_DomHelper$nodeAndOffsetForModelSelection3=_fusibleUtilDom_helper2["default"].nodeAndOffsetForModelSelection(_reactAddons2["default"].findDOMNode(endBlock),endInfo,excludeTags),_DomHelper$nodeAndOffsetForModelSelection32=_slicedToArray(_DomHelper$nodeAndOffsetForModelSelection3,2),endNode=_DomHelper$nodeAndOffsetForModelSelection32[0],endOffset=_DomHelper$nodeAndOffsetForModelSelection32[1];if(startNode&&endNode)return _fusibleUtilSelection_helper2["default"].createSelection(startNode,startOffset,endNode,endOffset);throw"Couldn't find appropriate nodes to select while restoring selection."}},{key:"indexForBlockRef",value:function(ref){return this.props.documentModel.deref().findIndex(function(blockModel){return blockModel.get("id")==ref})}},{key:"blockForIndex",value:function(index){return this.refs[this.props.documentModel.getIn([index,"id"])]}},{key:"shouldComponentUpdate",value:function(nextProps,nextState){var stateIsEqual=_lodash2["default"].isEqual(nextState,this.state),propsAreEqual=_lodash2["default"].isEqual(_lodash2["default"].omit(nextProps,"documentModel"),_lodash2["default"].omit(this.props,"documentModel")),documentModelsAreEqual=this.props.documentModel.deref().equals(nextProps.documentModel.deref());return!(documentModelsAreEqual&&propsAreEqual&&stateIsEqual)}},{key:"render",value:function(){var blockElements=_fusibleUtilDocument_model_helper2["default"].documentToNestedGroups(this.state.documentModelReference.cursor(),this.props.config).reduce(this._groupTextBlockGroup,_immutable2["default"].List()).map(this._blockGroupToElement).toArray(),menuProps={documentContainerId:this.props.documentContainerId,documentId:this.id,config:this.props.config,childProps:this.props.childProps,containerWidth:this.state.containerWidth,handleCustomAction:this.handleCustomAction};return this.viewing()?_reactAddons2["default"].createElement("div",{className:this.props.className},blockElements):_reactAddons2["default"].createElement("div",{ref:"elementContainer",key:this.id+"-"+this.cacheKey,className:_styleComponentsDocument2["default"].container},_reactAddons2["default"].createElement(_text_menu2["default"],menuProps),_reactAddons2["default"].createElement(_custom_menu_container2["default"],menuProps),_reactAddons2["default"].createElement(_custom_tag_edit_menu2["default"],menuProps),blockElements)}},{key:"forceRenderBlocks",value:function(){var blockRefs=this.blockRefs(),_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_getIterator(_Object$keys(blockRefs));!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var refName=_step.value,block=blockRefs[refName];block.internalDOMOutOfSync&&block.forceUpdate()}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}}},{key:"containerRefs",value:function(){return this.selectRefsLike(/^editableContainer_[0-9]+$/)}},{key:"blockRefs",value:function(){var ids=this.state.documentModelReference.cursor().map(function(blockModel){return blockModel.get("id")});return _lodash2["default"].pick.apply(this,_lodash2["default"].flatten([this.refs,ids.toJS()]))}}]),Document}(_reactAddons.Component);exports["default"]=Document,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_slicedToArray=__webpack_require__(28)["default"],_getIterator=__webpack_require__(29)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_block_model_helper=__webpack_require__(107),_block_model_helper2=_interopRequireDefault(_block_model_helper),_dom_parser=__webpack_require__(126),_dom_parser2=_interopRequireDefault(_dom_parser),DomHelper=function(){function DomHelper(){_classCallCheck(this,DomHelper)}return _createClass(DomHelper,null,[{key:"findParentReactRefMatching",value:function(node,regex){if(node){if(node.dataset&&node.dataset.reactid){var reactid=_lodash2["default"].last(node.dataset.reactid.split(".")).replace("$","");if(regex.test(reactid))return reactid}return DomHelper.findParentReactRefMatching(node.parentNode,regex)}return null}},{key:"textOffsetFromParent",value:function(parent,targetChild,childOffset){var excludeTags=arguments.length<=3||void 0===arguments[3]?[]:arguments[3],internalFindOffset=function internalFindOffset(parent,targetChild,childOffset,excludeTags){var parentOffset=0,excludeTagOffset=0,foundNode=!1,_iteratorNormalCompletion=!0,_didIteratorError=!1,_iteratorError=void 0;try{for(var _step,_iterator=_getIterator(parent.childNodes);!(_iteratorNormalCompletion=(_step=_iterator.next()).done);_iteratorNormalCompletion=!0){var childNode=_step.value;if(childNode==targetChild){DomHelper.isPlaceholderNode(childNode)||(parentOffset+=childOffset,childOffset>0&&(excludeTagOffset=0)),foundNode=!0;break}if(_lodash2["default"].contains(excludeTags,childNode.tagName&&childNode.tagName.toUpperCase()))excludeTagOffset+=1;else if(DomHelper.isPlaceholderNode(childNode)){if(childNode.childNodes[0]==targetChild){foundNode=!0;break}}else if(0==childNode.childNodes.length)parentOffset+=DomHelper.sanitizeText(childNode.textContent).length,excludeTagOffset=0;else{var internalOffset=void 0,_externalExcludeTagOffset=void 0,_internalFindOffset=internalFindOffset(childNode,targetChild,childOffset,excludeTags),_internalFindOffset2=_slicedToArray(_internalFindOffset,3);if(internalOffset=_internalFindOffset2[0],_externalExcludeTagOffset=_internalFindOffset2[1],foundNode=_internalFindOffset2[2],parentOffset+=internalOffset,internalOffset>0&&(excludeTagOffset=0),foundNode)break}}}catch(err){_didIteratorError=!0,_iteratorError=err}finally{try{!_iteratorNormalCompletion&&_iterator["return"]&&_iterator["return"]()}finally{if(_didIteratorError)throw _iteratorError}}return[parentOffset,excludeTagOffset,foundNode]};return parent==targetChild?[childOffset,0]:(excludeTags=_lodash2["default"].map(excludeTags,function(tagName){return tagName.toUpperCase()}),internalFindOffset(parent,targetChild,childOffset,excludeTags).slice(0,2))}},{key:"nodeAndOffsetForModelSelection",value:function(node,modelSelection){var _this=this,excludeTags=arguments.length<=2||void 0===arguments[2]?[]:arguments[2],internalNodeAndOffsetForModelSelection=function internalNodeAndOffsetForModelSelection(modelSelection,excludeTags,result,node){if(null!=result[0])return result;if(_lodash2["default"].contains(excludeTags,node.tagName&&node.tagName.toUpperCase()))return result[3]+=1,result;if(node.childNodes.length)return _lodash2["default"].reduce(node.childNodes,internalNodeAndOffsetForModelSelection.bind(_this,modelSelection,excludeTags),result);var textLength=DomHelper.sanitizeText(node.textContent).length,currentOffset=result[2]+textLength,atStartOfNodeAndPastOffset=modelSelection.atNodeStart&&currentOffset>modelSelection.offset,notAtStartOfNodeAndOffsetMet=!modelSelection.atNodeStart&&currentOffset>=modelSelection.offset,emptyNodeAndOffsetMet=0==textLength&&modelSelection.offset==currentOffset,currentExcludeTagOffset=DomHelper.isPlaceholderNode(node)||atStartOfNodeAndPastOffset?result[3]:0,excludeTagOffsetMet=modelSelection.customTagOffset==currentExcludeTagOffset;return excludeTagOffsetMet&&(atStartOfNodeAndPastOffset||notAtStartOfNodeAndOffsetMet||emptyNodeAndOffsetMet)?[node,modelSelection.offset-result[2],currentOffset,currentExcludeTagOffset]:[result[0],result[1],currentOffset,currentExcludeTagOffset]};if(0==node.childNodes.length)return[node,modelSelection.offset];excludeTags=_lodash2["default"].map(excludeTags,function(tagName){return tagName.toUpperCase()});var result=_lodash2["default"].reduce(node.childNodes,internalNodeAndOffsetForModelSelection.bind(this,modelSelection,excludeTags),[null,0,0,0]);return result.slice(0,2)}},{key:"internalDomToBlockModel",value:function(node,config,knownTextTags,knownCustomTags){var blockConfig=this.textBlockConfigForNode(config,node),customTagHandler=function(node,blockModel){var fusibleId=_lodash2["default"].last(node.dataset.reactid.split(".")).replace("$",""),existingCustomTag=knownCustomTags.find(function(customTag){return customTag.get("id")==fusibleId}),newCustomTag=existingCustomTag.update("offset",function(){return blockModel.get("text").length});return blockModel.update("customTags",function(customTags){return customTags.push(newCustomTag)})},testForCustomTag=function(node){return"undefined"!=typeof node.dataset&&/fusible_custom_tag/.test(node.dataset.reactid)},textTagAttributes=knownTextTags.reduce(function(mapping,textTag){return mapping.set(textTag.get("id"),textTag.get("attributes"))},new _immutable.Map);return domToBlockModel(node,config,blockConfig,textTagAttributes,testForCustomTag,customTagHandler)}},{key:"externalDomToBlockModel",value:function(node,config,blockConfig){var customTagHandler=function(node,blockModel){var tagConfig=customTagConfigForNode(config,node),customTag=tagConfig.importer(node);return customTag.id=_block_model_helper2["default"].generateCustomTagId(),customTag.offset=blockModel.get("text").length,blockModel.update("customTags",function(customTags){return customTags.push(_immutable2["default"].fromJS(customTag))})},testForCustomTag=function(node){var customTagConfig=customTagConfigForNode(config,node);return customTagConfig&&customTagConfig.importer};return domToBlockModel(node,config,blockConfig,new _immutable.Map,testForCustomTag,customTagHandler)}},{key:"htmlStringToDocumentModel",value:function(htmlText,config){var parser=new _dom_parser2["default"],parsedDocument=parser.parseFromString(htmlText,"text/html"),node=parsedDocument.body||parsedDocument,anyBlockNodes=_lodash2["default"].any(node.childNodes,function(childNode){return DomHelper.textBlockTags.contains(childNode.tagName&&childNode.tagName.toUpperCase())});if(!anyBlockNodes){var blockConfig=config.textBlocks[config.defaultTextBlockType];node=this.wrapNodes(parsedDocument,node,blockConfig.tagsToImport[0])}return _lodash2["default"].reduce(node.childNodes,unconstrainedNodeToBlockModel.bind(this,config,config.nestedElementParentTagNames),new _immutable.List)}},{key:"textBlockConfigForNode",value:function(config,node){return _lodash2["default"].find(config.textBlocks,function(blockConfig){var tagsToImport=_lodash2["default"].map(blockConfig.tagsToImport||[],function(importableTagName){return importableTagName.toUpperCase()});if(_lodash2["default"].contains(tagsToImport,node.tagName&&node.tagName.toUpperCase())){var parentTagName=blockConfig.sharedParentElement&&blockConfig.sharedParentElement.toUpperCase();return parentTagName?node.parentNode.tagName&&node.parentNode.tagName.toUpperCase()==parentTagName:!0}return!1})}},{key:"customBlockConfigForNode",value:function(config,node){var configForNode=_immutable2["default"].fromJS(config.customBlocks).find(function(blockConfig){var tagsToImport=blockConfig.get("tagsToImport").map(function(importableTagName){return importableTagName.toUpperCase()});return tagsToImport.contains(node.tagName&&node.tagName.toUpperCase())});return configForNode&&configForNode.toJS()}},{key:"sanitizeText",value:function(text){return text.replace(/[\u200B-\u200D]/g,"").replace(/\u00A0$/," ").replace(/\u00A0{2,}/,"\xa0")}},{key:"isPlaceholderNode",value:function(node){return/^[\u200B-\u200D]$/g.test(node.textContent)}},{key:"wrapNodes",value:function(fakeDocument,currentParent,tagType){var parentTagType=arguments.length<=3||void 0===arguments[3]?null:arguments[3],newNode=fakeDocument.createElement(tagType),newParentNode=void 0;for(parentTagType?(newParentNode=fakeDocument.createElement(parentTagType),newParentNode.appendChild(newNode)):newParentNode=null;currentParent.firstChild;)newNode.appendChild(currentParent.firstChild);return currentParent.appendChild(newParentNode||newNode),currentParent}},{key:"textBlockTags",value:new _immutable.List(["ADDRESS","ARTICLE","ASIDE","AUDIO","BLOCKQUOTE","CANVAS","DD","DIV","DL","FIELDSET","FIGCAPTION","FIGREF","FIGURE","FOOTER","FORM","H1","H2","H3","H4","H5","H6","HEADER","HGROUP","HR","NOSCRIPT","OL","OUTPUT","P","PRE","SECTION","TABLE","TFOOT","UL","VIDEO"]),enumerable:!0}]),DomHelper}();exports["default"]=DomHelper;var domToBlockModel=function(node,config,blockConfig,textTagAttributes,testForCustomTag,customTagHandler){var blockModel=new _immutable.Map({blockType:blockConfig.name,text:"",textTags:new _immutable.List,customTags:new _immutable.List}),textTagMapping=new _immutable.Map(config.textTags).reduce(function(list,config,tagType){return _lodash2["default"].each(config.tagsToImport,function(tagName){list=list.set(tagName.toUpperCase(),tagType)}),list},new _immutable.Map);return _lodash2["default"].reduce(node.childNodes,addNodeToBlockModel.bind(void 0,textTagMapping,textTagAttributes,testForCustomTag,customTagHandler),blockModel)},addNodeToBlockModel=function addNodeToBlockModel(textTagMapping,textTagAttributes,testForCustomTag,customTagHandler,blockModel,node){var tagType=textTagMapping.get(node.tagName&&node.tagName.toUpperCase());if(!tagType)return testForCustomTag(node)?customTagHandler(node,blockModel):blockModel.update("text",function(existingText){return existingText+DomHelper.sanitizeText(node.textContent)});var _ret=function(){var id=node.dataset.id||_block_model_helper2["default"].generateTextTagId(),attributes=textTagAttributes.get(id)||new _immutable.Map,startOffset=blockModel.get("text").length;return blockModel=_lodash2["default"].reduce(node.childNodes,addNodeToBlockModel.bind(void 0,textTagMapping,textTagAttributes,testForCustomTag,customTagHandler),blockModel),{v:blockModel.update("textTags",function(existingTextTags){return existingTextTags.push(new _immutable.Map({id:id,tagType:tagType,attributes:attributes,startOffset:startOffset,endOffset:blockModel.get("text").length}))})}}();return"object"==typeof _ret?_ret.v:void 0},customTagConfigForNode=function(config,node){var configForCustomTag=_immutable2["default"].fromJS(config.customTags).find(function(tagConfig){var tagsToImport=tagConfig.get("tagsToImport").map(function(importableTagName){return importableTagName.toUpperCase()});return tagsToImport.contains(node.tagName&&node.tagName.toUpperCase())});return configForCustomTag&&configForCustomTag.toJS()},unconstrainedNodeToBlockModel=function unconstrainedNodeToBlockModel(config,sharedParentTagNames,documentModel,node){return sharedParentTagNames.contains(node.tagName&&node.tagName.toUpperCase())?_lodash2["default"].reduce(node.childNodes,unconstrainedNodeToBlockModel.bind(void 0,config,sharedParentTagNames),documentModel):node.tagName?documentModel.push(unconstrainedDomToBlockModel(config,node)):/^[\s]*$/.test(node.textContent)?documentModel:documentModel.push(new _immutable.Map({blockType:config.defaultTextBlockType,attributes:new _immutable.Map,text:node.textContent,textTags:new _immutable.List,customTags:new _immutable.List}))},unconstrainedDomToBlockModel=function(config,node){var customBlockConfig=DomHelper.customBlockConfigForNode(config,node),customBlock=customBlockConfig&&customBlockConfig.importer&&customBlockConfig.importer(node);if(customBlock)return _immutable2["default"].fromJS(customBlock);var blockConfig=DomHelper.textBlockConfigForNode(config,node),blockModel=new _immutable.Map({blockType:blockConfig?blockConfig.name:node.tagName.toLowerCase(),attributes:new _immutable.Map,text:"",textTags:new _immutable.List,customTags:new _immutable.List}),textTagMapping=new _immutable.Map(config.textTags).reduce(function(list,config,tagType){return _lodash2["default"].each(config.tagsToImport,function(tagName){list=list.set(tagName.toUpperCase(),tagType)}),list},new _immutable.Map),customTagHandler=function(node,blockModel){var tagConfig=customTagConfigForNode(config,node),customTag=tagConfig.importer(node);return customTag.offset=blockModel.get("text").length,blockModel.update("customTags",function(customTags){return customTags.push(_immutable2["default"].fromJS(customTag))})},testForCustomTag=function(node){var customTagConfig=customTagConfigForNode(config,node);return customTagConfig&&customTagConfig.importer};return blockModel=_lodash2["default"].reduce(node.childNodes,unconstrainedAddNodeToBlockModel.bind(void 0,textTagMapping,testForCustomTag,customTagHandler),blockModel),_block_model_helper2["default"].trim(blockModel,config)},unconstrainedAddNodeToBlockModel=function unconstrainedAddNodeToBlockModel(textTagMapping,testForCustomTag,customTagHandler,blockModel,node){
if(testForCustomTag(node))return customTagHandler(node,blockModel);if(!node.tagName)return blockModel.update("text",function(existingText){return existingText+DomHelper.sanitizeText(node.textContent).replace(/(\n|\r)+/g," ")});var _ret2=function(){var tagType=textTagMapping.get(node.tagName.toUpperCase())||node.tagName.toLowerCase(),startOffset=blockModel.get("text").length;return blockModel=_lodash2["default"].reduce(node.childNodes,unconstrainedAddNodeToBlockModel.bind(void 0,textTagMapping,testForCustomTag,customTagHandler),blockModel),{v:blockModel.update("textTags",function(existingTextTags){return existingTextTags.push(new _immutable.Map({tagType:tagType,attributes:new _immutable.Map,startOffset:startOffset,endOffset:blockModel.get("text").length}))})}}();return"object"==typeof _ret2?_ret2.v:void 0};module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _arguments=arguments,_xmldom=__webpack_require__(127),_xmldom2=_interopRequireDefault(_xmldom),platformDOMParser=void 0;"undefined"!=typeof window&&"undefined"!=typeof window.DOMParser?!function(){var proto=window.DOMParser.prototype,nativeParse=proto.parseFromString;try{(new DOMParser).parseFromString("","text/html")||(proto.parseFromString=function(markup,type){if(/^\s*text\/html\s*(?:;|$)/i.test(type)){var doc=document.implementation.createHTMLDocument("");return markup.toLowerCase().indexOf("<!doctype")>-1?doc.documentElement.innerHTML=markup:doc.body.innerHTML=markup,doc}return nativeParse.apply(void 0,_arguments)})}catch(ex){}platformDOMParser=window.DOMParser}():platformDOMParser=_xmldom2["default"].DOMParser,exports["default"]=platformDOMParser,module.exports=exports["default"]},function(module,exports,__webpack_require__){function DOMParser(options){this.options=options||{locator:{}}}function buildErrorHandler(errorImpl,domBuilder,locator){function build(key){var fn=errorImpl[key];!fn&&isCallback&&(fn=2==errorImpl.length?function(msg){errorImpl(key,msg)}:errorImpl),errorHandler[key]=fn&&function(msg){fn("[xmldom "+key+"]	"+msg+_locator(locator))}||function(){}}if(!errorImpl){if(domBuilder instanceof DOMHandler)return domBuilder;errorImpl=domBuilder}var errorHandler={},isCallback=errorImpl instanceof Function;return locator=locator||{},build("warning"),build("error"),build("fatalError"),errorHandler}function DOMHandler(){this.cdata=!1}function position(locator,node){node.lineNumber=locator.lineNumber,node.columnNumber=locator.columnNumber}function _locator(l){return l?"\n@"+(l.systemId||"")+"#[line:"+l.lineNumber+",col:"+l.columnNumber+"]":void 0}function _toString(chars,start,length){return"string"==typeof chars?chars.substr(start,length):chars.length>=start+length||start?new java.lang.String(chars,start,length)+"":chars}function appendElement(hander,node){hander.currentElement?hander.currentElement.appendChild(node):hander.document.appendChild(node)}DOMParser.prototype.parseFromString=function(source,mimeType){var options=this.options,sax=new XMLReader,domBuilder=options.domBuilder||new DOMHandler,errorHandler=options.errorHandler,locator=options.locator,defaultNSMap=options.xmlns||{},entityMap={lt:"<",gt:">",amp:"&",quot:'"',apos:"'"};return locator&&domBuilder.setDocumentLocator(locator),sax.errorHandler=buildErrorHandler(errorHandler,domBuilder,locator),sax.domBuilder=options.domBuilder||domBuilder,/\/x?html?$/.test(mimeType)&&(entityMap.nbsp="\xa0",entityMap.copy="\xa9",defaultNSMap[""]="http://www.w3.org/1999/xhtml"),defaultNSMap.xml=defaultNSMap.xml||"http://www.w3.org/XML/1998/namespace",source?sax.parse(source,defaultNSMap,entityMap):sax.errorHandler.error("invalid document source"),domBuilder.document},DOMHandler.prototype={startDocument:function(){this.document=(new DOMImplementation).createDocument(null,null,null),this.locator&&(this.document.documentURI=this.locator.systemId)},startElement:function(namespaceURI,localName,qName,attrs){var doc=this.document,el=doc.createElementNS(namespaceURI,qName||localName),len=attrs.length;appendElement(this,el),this.currentElement=el,this.locator&&position(this.locator,el);for(var i=0;len>i;i++){var namespaceURI=attrs.getURI(i),value=attrs.getValue(i),qName=attrs.getQName(i),attr=doc.createAttributeNS(namespaceURI,qName);attr.getOffset&&position(attr.getOffset(1),attr),attr.value=attr.nodeValue=value,el.setAttributeNode(attr)}},endElement:function(namespaceURI,localName,qName){var current=this.currentElement;current.tagName;this.currentElement=current.parentNode},startPrefixMapping:function(prefix,uri){},endPrefixMapping:function(prefix){},processingInstruction:function(target,data){var ins=this.document.createProcessingInstruction(target,data);this.locator&&position(this.locator,ins),appendElement(this,ins)},ignorableWhitespace:function(ch,start,length){},characters:function(chars,start,length){if(chars=_toString.apply(this,arguments),this.currentElement&&chars){if(this.cdata){var charNode=this.document.createCDATASection(chars);this.currentElement.appendChild(charNode)}else{var charNode=this.document.createTextNode(chars);this.currentElement.appendChild(charNode)}this.locator&&position(this.locator,charNode)}},skippedEntity:function(name){},endDocument:function(){this.document.normalize()},setDocumentLocator:function(locator){(this.locator=locator)&&(locator.lineNumber=0)},comment:function(chars,start,length){chars=_toString.apply(this,arguments);var comm=this.document.createComment(chars);this.locator&&position(this.locator,comm),appendElement(this,comm)},startCDATA:function(){this.cdata=!0},endCDATA:function(){this.cdata=!1},startDTD:function(name,publicId,systemId){var impl=this.document.implementation;if(impl&&impl.createDocumentType){var dt=impl.createDocumentType(name,publicId,systemId);this.locator&&position(this.locator,dt),appendElement(this,dt)}},warning:function(error){console.warn("[xmldom warning]	"+error,_locator(this.locator))},error:function(error){console.error("[xmldom error]	"+error,_locator(this.locator))},fatalError:function(error){throw console.error("[xmldom fatalError]	"+error,_locator(this.locator)),error}},"endDTD,startEntity,endEntity,attributeDecl,elementDecl,externalEntityDecl,internalEntityDecl,resolveEntity,getExternalSubset,notationDecl,unparsedEntityDecl".replace(/\w+/g,function(key){DOMHandler.prototype[key]=function(){return null}});var XMLReader=__webpack_require__(128).XMLReader,DOMImplementation=exports.DOMImplementation=__webpack_require__(129).DOMImplementation;exports.XMLSerializer=__webpack_require__(129).XMLSerializer,exports.DOMParser=DOMParser},function(module,exports,__webpack_require__){function XMLReader(){}function parse(source,defaultNSMapCopy,entityMap,domBuilder,errorHandler){function fixedFromCharCode(code){if(code>65535){code-=65536;var surrogate1=55296+(code>>10),surrogate2=56320+(1023&code);return String.fromCharCode(surrogate1,surrogate2)}return String.fromCharCode(code)}function entityReplacer(a){var k=a.slice(1,-1);return k in entityMap?entityMap[k]:"#"===k.charAt(0)?fixedFromCharCode(parseInt(k.substr(1).replace("x","0x"))):(errorHandler.error("entity not found:"+a),a)}function appendText(end){if(end>start){var xt=source.substring(start,end).replace(/&#?\w+;/g,entityReplacer);locator&&position(start),domBuilder.characters(xt,0,end-start),start=end}}function position(p,m){for(;p>=lineEnd&&(m=linePattern.exec(source));)lineStart=m.index,lineEnd=lineStart+m[0].length,locator.lineNumber++;locator.columnNumber=p-lineStart+1}for(var lineStart=0,lineEnd=0,linePattern=/.+(?:\r\n?|\n)|.*$/g,locator=domBuilder.locator,parseStack=[{currentNSMap:defaultNSMapCopy}],closeMap={},start=0;;){try{var tagStart=source.indexOf("<",start);if(0>tagStart){if(!source.substr(start).match(/^\s*$/)){var doc=domBuilder.document,text=doc.createTextNode(source.substr(start));doc.appendChild(text),domBuilder.currentElement=text}return}switch(tagStart>start&&appendText(tagStart),source.charAt(tagStart+1)){case"/":var end=source.indexOf(">",tagStart+3),tagName=source.substring(tagStart+2,end),config=parseStack.pop(),localNSMap=config.localNSMap;if(config.tagName!=tagName&&errorHandler.fatalError("end tag name: "+tagName+" is not match the current start tagName:"+config.tagName),domBuilder.endElement(config.uri,config.localName,tagName),localNSMap)for(var prefix in localNSMap)domBuilder.endPrefixMapping(prefix);end++;break;case"?":locator&&position(tagStart),end=parseInstruction(source,tagStart,domBuilder);break;case"!":locator&&position(tagStart),end=parseDCC(source,tagStart,domBuilder,errorHandler);break;default:locator&&position(tagStart);var el=new ElementAttributes,end=parseElementStartPart(source,tagStart,el,entityReplacer,errorHandler),len=el.length;if(locator){if(len)for(var i=0;len>i;i++){var a=el[i];position(a.offset),a.offset=copyLocator(locator,{})}position(end)}!el.closed&&fixSelfClosed(source,end,el.tagName,closeMap)&&(el.closed=!0,entityMap.nbsp||errorHandler.warning("unclosed xml attribute")),appendElement(el,domBuilder,parseStack),"http://www.w3.org/1999/xhtml"!==el.uri||el.closed?end++:end=parseHtmlSpecialContent(source,end,el.tagName,entityReplacer,domBuilder)}}catch(e){errorHandler.error("element parse error: "+e),end=-1}end>start?start=end:appendText(Math.max(tagStart,start)+1)}}function copyLocator(f,t){return t.lineNumber=f.lineNumber,t.columnNumber=f.columnNumber,t}function parseElementStartPart(source,start,el,entityReplacer,errorHandler){for(var attrName,value,p=++start,s=S_TAG;;){var c=source.charAt(p);switch(c){case"=":if(s===S_ATTR)attrName=source.slice(start,p),s=S_EQ;else{if(s!==S_ATTR_S)throw new Error("attribute equal must after attrName");s=S_EQ}break;case"'":case'"':if(s===S_EQ){if(start=p+1,p=source.indexOf(c,start),!(p>0))throw new Error("attribute value no end '"+c+"' match");value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer),el.add(attrName,value,start-1),s=S_E}else{if(s!=S_V)throw new Error('attribute value must after "="');value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer),el.add(attrName,value,start),errorHandler.warning('attribute "'+attrName+'" missed start quot('+c+")!!"),start=p+1,s=S_E}break;case"/":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:s=S_C,el.closed=!0;case S_V:case S_ATTR:case S_ATTR_S:break;default:throw new Error("attribute invalid close char('/')")}break;case"":errorHandler.error("unexpected end of input");case">":switch(s){case S_TAG:el.setTagName(source.slice(start,p));case S_E:case S_S:case S_C:break;case S_V:case S_ATTR:value=source.slice(start,p),"/"===value.slice(-1)&&(el.closed=!0,value=value.slice(0,-1));case S_ATTR_S:s===S_ATTR_S&&(value=attrName),s==S_V?(errorHandler.warning('attribute "'+value+'" missed quot(")!!'),el.add(attrName,value.replace(/&#?\w+;/g,entityReplacer),start)):(errorHandler.warning('attribute "'+value+'" missed value!! "'+value+'" instead!!'),el.add(value,value,start));break;case S_EQ:throw new Error("attribute value missed!!")}return p;case"\x80":c=" ";default:if(" ">=c)switch(s){case S_TAG:el.setTagName(source.slice(start,p)),s=S_S;break;case S_ATTR:attrName=source.slice(start,p),s=S_ATTR_S;break;case S_V:var value=source.slice(start,p).replace(/&#?\w+;/g,entityReplacer);errorHandler.warning('attribute "'+value+'" missed quot(")!!'),el.add(attrName,value,start);case S_E:s=S_S}else switch(s){case S_ATTR_S:errorHandler.warning('attribute "'+attrName+'" missed value!! "'+attrName+'" instead!!'),el.add(attrName,attrName,start),start=p,s=S_ATTR;break;case S_E:errorHandler.warning('attribute space is required"'+attrName+'"!!');case S_S:s=S_ATTR,start=p;break;case S_EQ:s=S_V,start=p;break;case S_C:throw new Error("elements closed character '/' and '>' must be connected to")}}p++}}function appendElement(el,domBuilder,parseStack){for(var tagName=el.tagName,localNSMap=null,currentNSMap=parseStack[parseStack.length-1].currentNSMap,i=el.length;i--;){var a=el[i],qName=a.qName,value=a.value,nsp=qName.indexOf(":");if(nsp>0)var prefix=a.prefix=qName.slice(0,nsp),localName=qName.slice(nsp+1),nsPrefix="xmlns"===prefix&&localName;else localName=qName,prefix=null,nsPrefix="xmlns"===qName&&"";a.localName=localName,nsPrefix!==!1&&(null==localNSMap&&(localNSMap={},_copy(currentNSMap,currentNSMap={})),currentNSMap[nsPrefix]=localNSMap[nsPrefix]=value,a.uri="http://www.w3.org/2000/xmlns/",domBuilder.startPrefixMapping(nsPrefix,value))}for(var i=el.length;i--;){a=el[i];var prefix=a.prefix;prefix&&("xml"===prefix&&(a.uri="http://www.w3.org/XML/1998/namespace"),"xmlns"!==prefix&&(a.uri=currentNSMap[prefix]))}var nsp=tagName.indexOf(":");nsp>0?(prefix=el.prefix=tagName.slice(0,nsp),localName=el.localName=tagName.slice(nsp+1)):(prefix=null,localName=el.localName=tagName);var ns=el.uri=currentNSMap[prefix||""];if(domBuilder.startElement(ns,localName,tagName,el),el.closed){if(domBuilder.endElement(ns,localName,tagName),localNSMap)for(prefix in localNSMap)domBuilder.endPrefixMapping(prefix)}else el.currentNSMap=currentNSMap,el.localNSMap=localNSMap,parseStack.push(el)}function parseHtmlSpecialContent(source,elStartEnd,tagName,entityReplacer,domBuilder){if(/^(?:script|textarea)$/i.test(tagName)){var elEndStart=source.indexOf("</"+tagName+">",elStartEnd),text=source.substring(elStartEnd+1,elEndStart);if(/[&<]/.test(text))return/^script$/i.test(tagName)?(domBuilder.characters(text,0,text.length),elEndStart):(text=text.replace(/&#?\w+;/g,entityReplacer),domBuilder.characters(text,0,text.length),elEndStart)}return elStartEnd+1}function fixSelfClosed(source,elStartEnd,tagName,closeMap){var pos=closeMap[tagName];return null==pos&&(pos=closeMap[tagName]=source.lastIndexOf("</"+tagName+">")),elStartEnd>pos}function _copy(source,target){for(var n in source)target[n]=source[n]}function parseDCC(source,start,domBuilder,errorHandler){var next=source.charAt(start+2);switch(next){case"-":if("-"===source.charAt(start+3)){var end=source.indexOf("-->",start+4);return end>start?(domBuilder.comment(source,start+4,end-start-4),end+3):(errorHandler.error("Unclosed comment"),-1)}return-1;default:if("CDATA["==source.substr(start+3,6)){var end=source.indexOf("]]>",start+9);return domBuilder.startCDATA(),domBuilder.characters(source,start+9,end-start-9),domBuilder.endCDATA(),end+3}var matchs=split(source,start),len=matchs.length;if(len>1&&/!doctype/i.test(matchs[0][0])){var name=matchs[1][0],pubid=len>3&&/^public$/i.test(matchs[2][0])&&matchs[3][0],sysid=len>4&&matchs[4][0],lastMatch=matchs[len-1];return domBuilder.startDTD(name,pubid&&pubid.replace(/^(['"])(.*?)\1$/,"$2"),sysid&&sysid.replace(/^(['"])(.*?)\1$/,"$2")),domBuilder.endDTD(),lastMatch.index+lastMatch[0].length}}return-1}function parseInstruction(source,start,domBuilder){var end=source.indexOf("?>",start);if(end){var match=source.substring(start,end).match(/^<\?(\S*)\s*([\s\S]*?)\s*$/);if(match){match[0].length;return domBuilder.processingInstruction(match[1],match[2]),end+2}return-1}return-1}function ElementAttributes(source){}function _set_proto_(thiz,parent){return thiz.__proto__=parent,thiz}function split(source,start){var match,buf=[],reg=/'[^']+'|"[^"]+"|[^\s<>\/=]+=?|(\/?\s*>|<)/g;for(reg.lastIndex=start,reg.exec(source);match=reg.exec(source);)if(buf.push(match),match[1])return buf}var nameStartChar=/[A-Z_a-z\xC0-\xD6\xD8-\xF6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD]/,nameChar=new RegExp("[\\-\\.0-9"+nameStartChar.source.slice(1,-1)+"\xb7\u0300-\u036f\\u203F-\u2040]"),tagNamePattern=new RegExp("^"+nameStartChar.source+nameChar.source+"*(?::"+nameStartChar.source+nameChar.source+"*)?$"),S_TAG=0,S_ATTR=1,S_ATTR_S=2,S_EQ=3,S_V=4,S_E=5,S_S=6,S_C=7;XMLReader.prototype={parse:function(source,defaultNSMap,entityMap){var domBuilder=this.domBuilder;domBuilder.startDocument(),_copy(defaultNSMap,defaultNSMap={}),parse(source,defaultNSMap,entityMap,domBuilder,this.errorHandler),domBuilder.endDocument()}},ElementAttributes.prototype={setTagName:function(tagName){if(!tagNamePattern.test(tagName))throw new Error("invalid tagName:"+tagName);this.tagName=tagName},add:function(qName,value,offset){if(!tagNamePattern.test(qName))throw new Error("invalid attribute:"+qName);this[this.length++]={qName:qName,value:value,offset:offset}},length:0,getLocalName:function(i){return this[i].localName},getOffset:function(i){return this[i].offset},getQName:function(i){return this[i].qName},getURI:function(i){return this[i].uri},getValue:function(i){return this[i].value}},_set_proto_({},_set_proto_.prototype)instanceof _set_proto_||(_set_proto_=function(thiz,parent){function p(){}p.prototype=parent,p=new p;for(parent in thiz)p[parent]=thiz[parent];return p}),exports.XMLReader=XMLReader},function(module,exports,__webpack_require__){function copy(src,dest){for(var p in src)dest[p]=src[p]}function _extends(Class,Super){function t(){}var pt=Class.prototype;if(Object.create){var ppt=Object.create(Super.prototype);pt.__proto__=ppt}pt instanceof Super||(t.prototype=Super.prototype,t=new t,copy(pt,t),Class.prototype=pt=t),pt.constructor!=Class&&("function"!=typeof Class&&console.error("unknow Class:"+Class),pt.constructor=Class)}function DOMException(code,message){if(message instanceof Error)var error=message;else error=this,Error.call(this,ExceptionMessage[code]),this.message=ExceptionMessage[code],Error.captureStackTrace&&Error.captureStackTrace(this,DOMException);return error.code=code,message&&(this.message=this.message+": "+message),error}function NodeList(){}function LiveNodeList(node,refresh){this._node=node,this._refresh=refresh,_updateLiveList(this)}function _updateLiveList(list){var inc=list._node._inc||list._node.ownerDocument._inc;if(list._inc!=inc){var ls=list._refresh(list._node);__set__(list,"length",ls.length),copy(ls,list),list._inc=inc}}function NamedNodeMap(){}function _findNodeIndex(list,node){for(var i=list.length;i--;)if(list[i]===node)return i}function _addNamedNode(el,list,newAttr,oldAttr){if(oldAttr?list[_findNodeIndex(list,oldAttr)]=newAttr:list[list.length++]=newAttr,el){newAttr.ownerElement=el;var doc=el.ownerDocument;doc&&(oldAttr&&_onRemoveAttribute(doc,el,oldAttr),_onAddAttribute(doc,el,newAttr))}}function _removeNamedNode(el,list,attr){var i=_findNodeIndex(list,attr);if(!(i>=0))throw DOMException(NOT_FOUND_ERR,new Error);for(var lastIndex=list.length-1;lastIndex>i;)list[i]=list[++i];if(list.length=lastIndex,el){var doc=el.ownerDocument;doc&&(_onRemoveAttribute(doc,el,attr),attr.ownerElement=null)}}function DOMImplementation(features){if(this._features={},features)for(var feature in features)this._features=features[feature]}function Node(){}function _xmlEncoder(c){return"<"==c&&"&lt;"||">"==c&&"&gt;"||"&"==c&&"&amp;"||'"'==c&&"&quot;"||"&#"+c.charCodeAt()+";"}function _visitNode(node,callback){if(callback(node))return!0;if(node=node.firstChild)do if(_visitNode(node,callback))return!0;while(node=node.nextSibling)}function Document(){}function _onAddAttribute(doc,el,newAttr){doc&&doc._inc++;var ns=newAttr.namespaceURI;"http://www.w3.org/2000/xmlns/"==ns&&(el._nsMap[newAttr.prefix?newAttr.localName:""]=newAttr.value)}function _onRemoveAttribute(doc,el,newAttr,remove){doc&&doc._inc++;var ns=newAttr.namespaceURI;"http://www.w3.org/2000/xmlns/"==ns&&delete el._nsMap[newAttr.prefix?newAttr.localName:""]}function _onUpdateChild(doc,el,newChild){if(doc&&doc._inc){doc._inc++;var cs=el.childNodes;if(newChild)cs[cs.length++]=newChild;else{for(var child=el.firstChild,i=0;child;)cs[i++]=child,child=child.nextSibling;cs.length=i}}}function _removeChild(parentNode,child){var previous=child.previousSibling,next=child.nextSibling;return previous?previous.nextSibling=next:parentNode.firstChild=next,next?next.previousSibling=previous:parentNode.lastChild=previous,_onUpdateChild(parentNode.ownerDocument,parentNode),child}function _insertBefore(parentNode,newChild,nextChild){var cp=newChild.parentNode;if(cp&&cp.removeChild(newChild),newChild.nodeType===DOCUMENT_FRAGMENT_NODE){var newFirst=newChild.firstChild;if(null==newFirst)return newChild;var newLast=newChild.lastChild}else newFirst=newLast=newChild;var pre=nextChild?nextChild.previousSibling:parentNode.lastChild;newFirst.previousSibling=pre,newLast.nextSibling=nextChild,pre?pre.nextSibling=newFirst:parentNode.firstChild=newFirst,null==nextChild?parentNode.lastChild=newLast:nextChild.previousSibling=newLast;do newFirst.parentNode=parentNode;while(newFirst!==newLast&&(newFirst=newFirst.nextSibling));return _onUpdateChild(parentNode.ownerDocument||parentNode,parentNode),newChild.nodeType==DOCUMENT_FRAGMENT_NODE&&(newChild.firstChild=newChild.lastChild=null),newChild}function _appendSingleChild(parentNode,newChild){var cp=newChild.parentNode;if(cp){var pre=parentNode.lastChild;cp.removeChild(newChild);var pre=parentNode.lastChild}var pre=parentNode.lastChild;return newChild.parentNode=parentNode,newChild.previousSibling=pre,newChild.nextSibling=null,pre?pre.nextSibling=newChild:parentNode.firstChild=newChild,parentNode.lastChild=newChild,_onUpdateChild(parentNode.ownerDocument,parentNode,newChild),newChild}function Element(){this._nsMap={}}function Attr(){}function CharacterData(){}function Text(){}function Comment(){}function CDATASection(){}function DocumentType(){}function Notation(){}function Entity(){}function EntityReference(){}function DocumentFragment(){}function ProcessingInstruction(){}function XMLSerializer(){}function serializeToString(node,buf,attributeSorter,isHTML){switch(node.nodeType){case ELEMENT_NODE:var attrs=node.attributes,len=attrs.length,child=node.firstChild,nodeName=node.tagName;isHTML=htmlns===node.namespaceURI||isHTML,buf.push("<",nodeName),attributeSorter&&buf.sort.apply(attrs,attributeSorter);for(var i=0;len>i;i++)serializeToString(attrs.item(i),buf,attributeSorter,isHTML);if(child||isHTML&&!/^(?:meta|link|img|br|hr|input|button)$/i.test(nodeName)){if(buf.push(">"),isHTML&&/^script$/i.test(nodeName))child&&buf.push(child.data);else for(;child;)serializeToString(child,buf,attributeSorter,isHTML),child=child.nextSibling;buf.push("</",nodeName,">")}else buf.push("/>");return;case DOCUMENT_NODE:case DOCUMENT_FRAGMENT_NODE:for(var child=node.firstChild;child;)serializeToString(child,buf,attributeSorter,isHTML),child=child.nextSibling;return;case ATTRIBUTE_NODE:return buf.push(" ",node.name,'="',node.value.replace(/[<&"]/g,_xmlEncoder),'"');case TEXT_NODE:return buf.push(node.data.replace(/[<&]/g,_xmlEncoder));case CDATA_SECTION_NODE:return buf.push("<![CDATA[",node.data,"]]>");case COMMENT_NODE:return buf.push("<!--",node.data,"-->");case DOCUMENT_TYPE_NODE:var pubid=node.publicId,sysid=node.systemId;if(buf.push("<!DOCTYPE ",node.name),pubid)buf.push(' PUBLIC "',pubid),sysid&&"."!=sysid&&buf.push('" "',sysid),buf.push('">');else if(sysid&&"."!=sysid)buf.push(' SYSTEM "',sysid,'">');else{var sub=node.internalSubset;sub&&buf.push(" [",sub,"]"),buf.push(">")}return;case PROCESSING_INSTRUCTION_NODE:return buf.push("<?",node.target," ",node.data,"?>");case ENTITY_REFERENCE_NODE:return buf.push("&",node.nodeName,";");default:buf.push("??",node.nodeName)}}function importNode(doc,node,deep){var node2;switch(node.nodeType){case ELEMENT_NODE:node2=node.cloneNode(!1),node2.ownerDocument=doc;case DOCUMENT_FRAGMENT_NODE:break;case ATTRIBUTE_NODE:deep=!0}if(node2||(node2=node.cloneNode(!1)),node2.ownerDocument=doc,node2.parentNode=null,deep)for(var child=node.firstChild;child;)node2.appendChild(importNode(doc,child,deep)),child=child.nextSibling;return node2}function cloneNode(doc,node,deep){var node2=new node.constructor;for(var n in node){var v=node[n];"object"!=typeof v&&v!=node2[n]&&(node2[n]=v)}switch(node.childNodes&&(node2.childNodes=new NodeList),node2.ownerDocument=doc,node2.nodeType){case ELEMENT_NODE:var attrs=node.attributes,attrs2=node2.attributes=new NamedNodeMap,len=attrs.length;attrs2._ownerElement=node2;for(var i=0;len>i;i++)node2.setAttributeNode(cloneNode(doc,attrs.item(i),!0));break;case ATTRIBUTE_NODE:deep=!0}if(deep)for(var child=node.firstChild;child;)node2.appendChild(cloneNode(doc,child,deep)),child=child.nextSibling;return node2}function __set__(object,key,value){object[key]=value}function getTextContent(node){switch(node.nodeType){case 1:case 11:var buf=[];for(node=node.firstChild;node;)7!==node.nodeType&&8!==node.nodeType&&buf.push(getTextContent(node)),node=node.nextSibling;return buf.join("");default:return node.nodeValue}}var htmlns="http://www.w3.org/1999/xhtml",NodeType={},ELEMENT_NODE=NodeType.ELEMENT_NODE=1,ATTRIBUTE_NODE=NodeType.ATTRIBUTE_NODE=2,TEXT_NODE=NodeType.TEXT_NODE=3,CDATA_SECTION_NODE=NodeType.CDATA_SECTION_NODE=4,ENTITY_REFERENCE_NODE=NodeType.ENTITY_REFERENCE_NODE=5,ENTITY_NODE=NodeType.ENTITY_NODE=6,PROCESSING_INSTRUCTION_NODE=NodeType.PROCESSING_INSTRUCTION_NODE=7,COMMENT_NODE=NodeType.COMMENT_NODE=8,DOCUMENT_NODE=NodeType.DOCUMENT_NODE=9,DOCUMENT_TYPE_NODE=NodeType.DOCUMENT_TYPE_NODE=10,DOCUMENT_FRAGMENT_NODE=NodeType.DOCUMENT_FRAGMENT_NODE=11,NOTATION_NODE=NodeType.NOTATION_NODE=12,ExceptionCode={},ExceptionMessage={},NOT_FOUND_ERR=(ExceptionCode.INDEX_SIZE_ERR=(ExceptionMessage[1]="Index size error",1),ExceptionCode.DOMSTRING_SIZE_ERR=(ExceptionMessage[2]="DOMString size error",2),ExceptionCode.HIERARCHY_REQUEST_ERR=(ExceptionMessage[3]="Hierarchy request error",3),ExceptionCode.WRONG_DOCUMENT_ERR=(ExceptionMessage[4]="Wrong document",4),ExceptionCode.INVALID_CHARACTER_ERR=(ExceptionMessage[5]="Invalid character",5),ExceptionCode.NO_DATA_ALLOWED_ERR=(ExceptionMessage[6]="No data allowed",6),ExceptionCode.NO_MODIFICATION_ALLOWED_ERR=(ExceptionMessage[7]="No modification allowed",7),ExceptionCode.NOT_FOUND_ERR=(ExceptionMessage[8]="Not found",8)),INUSE_ATTRIBUTE_ERR=(ExceptionCode.NOT_SUPPORTED_ERR=(ExceptionMessage[9]="Not supported",9),ExceptionCode.INUSE_ATTRIBUTE_ERR=(ExceptionMessage[10]="Attribute in use",10));ExceptionCode.INVALID_STATE_ERR=(ExceptionMessage[11]="Invalid state",11),ExceptionCode.SYNTAX_ERR=(ExceptionMessage[12]="Syntax error",12),ExceptionCode.INVALID_MODIFICATION_ERR=(ExceptionMessage[13]="Invalid modification",13),ExceptionCode.NAMESPACE_ERR=(ExceptionMessage[14]="Invalid namespace",14),ExceptionCode.INVALID_ACCESS_ERR=(ExceptionMessage[15]="Invalid access",15);DOMException.prototype=Error.prototype,copy(ExceptionCode,DOMException),NodeList.prototype={length:0,item:function(index){return this[index]||null},toString:function(){for(var buf=[],i=0;i<this.length;i++)serializeToString(this[i],buf);return buf.join("")}},LiveNodeList.prototype.item=function(i){return _updateLiveList(this),this[i]},_extends(LiveNodeList,NodeList),NamedNodeMap.prototype={length:0,item:NodeList.prototype.item,getNamedItem:function(key){for(var i=this.length;i--;){var attr=this[i];if(attr.nodeName==key)return attr}},setNamedItem:function(attr){var el=attr.ownerElement;if(el&&el!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);var oldAttr=this.getNamedItem(attr.nodeName);return _addNamedNode(this._ownerElement,this,attr,oldAttr),oldAttr},setNamedItemNS:function(attr){var oldAttr,el=attr.ownerElement;if(el&&el!=this._ownerElement)throw new DOMException(INUSE_ATTRIBUTE_ERR);return oldAttr=this.getNamedItemNS(attr.namespaceURI,attr.localName),_addNamedNode(this._ownerElement,this,attr,oldAttr),oldAttr},removeNamedItem:function(key){var attr=this.getNamedItem(key);return _removeNamedNode(this._ownerElement,this,attr),attr},removeNamedItemNS:function(namespaceURI,localName){var attr=this.getNamedItemNS(namespaceURI,localName);return _removeNamedNode(this._ownerElement,this,attr),attr},getNamedItemNS:function(namespaceURI,localName){for(var i=this.length;i--;){var node=this[i];if(node.localName==localName&&node.namespaceURI==namespaceURI)return node}return null}},DOMImplementation.prototype={hasFeature:function(feature,version){var versions=this._features[feature.toLowerCase()];return versions&&(!version||version in versions)?!0:!1},createDocument:function(namespaceURI,qualifiedName,doctype){var doc=new Document;if(doc.implementation=this,doc.childNodes=new NodeList,doc.doctype=doctype,doctype&&doc.appendChild(doctype),qualifiedName){var root=doc.createElementNS(namespaceURI,qualifiedName);doc.appendChild(root)}return doc},createDocumentType:function(qualifiedName,publicId,systemId){var node=new DocumentType;return node.name=qualifiedName,node.nodeName=qualifiedName,node.publicId=publicId,node.systemId=systemId,node}},Node.prototype={firstChild:null,lastChild:null,previousSibling:null,nextSibling:null,attributes:null,parentNode:null,childNodes:null,ownerDocument:null,nodeValue:null,namespaceURI:null,prefix:null,localName:null,insertBefore:function(newChild,refChild){return _insertBefore(this,newChild,refChild)},replaceChild:function(newChild,oldChild){this.insertBefore(newChild,oldChild),oldChild&&this.removeChild(oldChild)},removeChild:function(oldChild){return _removeChild(this,oldChild)},appendChild:function(newChild){return this.insertBefore(newChild,null)},hasChildNodes:function(){return null!=this.firstChild},cloneNode:function(deep){return cloneNode(this.ownerDocument||this,this,deep)},normalize:function(){for(var child=this.firstChild;child;){var next=child.nextSibling;next&&next.nodeType==TEXT_NODE&&child.nodeType==TEXT_NODE?(this.removeChild(next),child.appendData(next.data)):(child.normalize(),child=next)}},isSupported:function(feature,version){return this.ownerDocument.implementation.hasFeature(feature,version)},hasAttributes:function(){return this.attributes.length>0},lookupPrefix:function(namespaceURI){for(var el=this;el;){var map=el._nsMap;if(map)for(var n in map)if(map[n]==namespaceURI)return n;el=2==el.nodeType?el.ownerDocument:el.parentNode}return null},lookupNamespaceURI:function(prefix){for(var el=this;el;){var map=el._nsMap;if(map&&prefix in map)return map[prefix];el=2==el.nodeType?el.ownerDocument:el.parentNode}return null},isDefaultNamespace:function(namespaceURI){var prefix=this.lookupPrefix(namespaceURI);return null==prefix}},copy(NodeType,Node),copy(NodeType,Node.prototype),Document.prototype={nodeName:"#document",nodeType:DOCUMENT_NODE,doctype:null,documentElement:null,_inc:1,insertBefore:function(newChild,refChild){if(newChild.nodeType==DOCUMENT_FRAGMENT_NODE){for(var child=newChild.firstChild;child;){var next=child.nextSibling;this.insertBefore(child,refChild),child=next}return newChild}return null==this.documentElement&&1==newChild.nodeType&&(this.documentElement=newChild),_insertBefore(this,newChild,refChild),newChild.ownerDocument=this,newChild},removeChild:function(oldChild){return this.documentElement==oldChild&&(this.documentElement=null),_removeChild(this,oldChild)},importNode:function(importedNode,deep){return importNode(this,importedNode,deep)},getElementById:function(id){var rtv=null;return _visitNode(this.documentElement,function(node){return 1==node.nodeType&&node.getAttribute("id")==id?(rtv=node,!0):void 0}),rtv},createElement:function(tagName){var node=new Element;node.ownerDocument=this,node.nodeName=tagName,node.tagName=tagName,node.childNodes=new NodeList;var attrs=node.attributes=new NamedNodeMap;return attrs._ownerElement=node,node},createDocumentFragment:function(){var node=new DocumentFragment;return node.ownerDocument=this,node.childNodes=new NodeList,node},createTextNode:function(data){var node=new Text;return node.ownerDocument=this,node.appendData(data),node},createComment:function(data){var node=new Comment;return node.ownerDocument=this,node.appendData(data),node},createCDATASection:function(data){var node=new CDATASection;return node.ownerDocument=this,node.appendData(data),node},createProcessingInstruction:function(target,data){var node=new ProcessingInstruction;return node.ownerDocument=this,node.tagName=node.target=target,node.nodeValue=node.data=data,node},createAttribute:function(name){var node=new Attr;return node.ownerDocument=this,node.name=name,node.nodeName=name,node.localName=name,node.specified=!0,node},createEntityReference:function(name){var node=new EntityReference;return node.ownerDocument=this,node.nodeName=name,node},createElementNS:function(namespaceURI,qualifiedName){var node=new Element,pl=qualifiedName.split(":"),attrs=node.attributes=new NamedNodeMap;return node.childNodes=new NodeList,node.ownerDocument=this,node.nodeName=qualifiedName,node.tagName=qualifiedName,node.namespaceURI=namespaceURI,2==pl.length?(node.prefix=pl[0],node.localName=pl[1]):node.localName=qualifiedName,attrs._ownerElement=node,node},createAttributeNS:function(namespaceURI,qualifiedName){var node=new Attr,pl=qualifiedName.split(":");return node.ownerDocument=this,node.nodeName=qualifiedName,node.name=qualifiedName,node.namespaceURI=namespaceURI,node.specified=!0,
2==pl.length?(node.prefix=pl[0],node.localName=pl[1]):node.localName=qualifiedName,node}},_extends(Document,Node),Element.prototype={nodeType:ELEMENT_NODE,hasAttribute:function(name){return null!=this.getAttributeNode(name)},getAttribute:function(name){var attr=this.getAttributeNode(name);return attr&&attr.value||""},getAttributeNode:function(name){return this.attributes.getNamedItem(name)},setAttribute:function(name,value){var attr=this.ownerDocument.createAttribute(name);attr.value=attr.nodeValue=""+value,this.setAttributeNode(attr)},removeAttribute:function(name){var attr=this.getAttributeNode(name);attr&&this.removeAttributeNode(attr)},appendChild:function(newChild){return newChild.nodeType===DOCUMENT_FRAGMENT_NODE?this.insertBefore(newChild,null):_appendSingleChild(this,newChild)},setAttributeNode:function(newAttr){return this.attributes.setNamedItem(newAttr)},setAttributeNodeNS:function(newAttr){return this.attributes.setNamedItemNS(newAttr)},removeAttributeNode:function(oldAttr){return this.attributes.removeNamedItem(oldAttr.nodeName)},removeAttributeNS:function(namespaceURI,localName){var old=this.getAttributeNodeNS(namespaceURI,localName);old&&this.removeAttributeNode(old)},hasAttributeNS:function(namespaceURI,localName){return null!=this.getAttributeNodeNS(namespaceURI,localName)},getAttributeNS:function(namespaceURI,localName){var attr=this.getAttributeNodeNS(namespaceURI,localName);return attr&&attr.value||""},setAttributeNS:function(namespaceURI,qualifiedName,value){var attr=this.ownerDocument.createAttributeNS(namespaceURI,qualifiedName);attr.value=attr.nodeValue=""+value,this.setAttributeNode(attr)},getAttributeNodeNS:function(namespaceURI,localName){return this.attributes.getNamedItemNS(namespaceURI,localName)},getElementsByTagName:function(tagName){return new LiveNodeList(this,function(base){var ls=[];return _visitNode(base,function(node){node===base||node.nodeType!=ELEMENT_NODE||"*"!==tagName&&node.tagName!=tagName||ls.push(node)}),ls})},getElementsByTagNameNS:function(namespaceURI,localName){return new LiveNodeList(this,function(base){var ls=[];return _visitNode(base,function(node){node===base||node.nodeType!==ELEMENT_NODE||"*"!==namespaceURI&&node.namespaceURI!==namespaceURI||"*"!==localName&&node.localName!=localName||ls.push(node)}),ls})}},Document.prototype.getElementsByTagName=Element.prototype.getElementsByTagName,Document.prototype.getElementsByTagNameNS=Element.prototype.getElementsByTagNameNS,_extends(Element,Node),Attr.prototype.nodeType=ATTRIBUTE_NODE,_extends(Attr,Node),CharacterData.prototype={data:"",substringData:function(offset,count){return this.data.substring(offset,offset+count)},appendData:function(text){text=this.data+text,this.nodeValue=this.data=text,this.length=text.length},insertData:function(offset,text){this.replaceData(offset,0,text)},appendChild:function(newChild){throw new Error(ExceptionMessage[3])},deleteData:function(offset,count){this.replaceData(offset,count,"")},replaceData:function(offset,count,text){var start=this.data.substring(0,offset),end=this.data.substring(offset+count);text=start+text+end,this.nodeValue=this.data=text,this.length=text.length}},_extends(CharacterData,Node),Text.prototype={nodeName:"#text",nodeType:TEXT_NODE,splitText:function(offset){var text=this.data,newText=text.substring(offset);text=text.substring(0,offset),this.data=this.nodeValue=text,this.length=text.length;var newNode=this.ownerDocument.createTextNode(newText);return this.parentNode&&this.parentNode.insertBefore(newNode,this.nextSibling),newNode}},_extends(Text,CharacterData),Comment.prototype={nodeName:"#comment",nodeType:COMMENT_NODE},_extends(Comment,CharacterData),CDATASection.prototype={nodeName:"#cdata-section",nodeType:CDATA_SECTION_NODE},_extends(CDATASection,CharacterData),DocumentType.prototype.nodeType=DOCUMENT_TYPE_NODE,_extends(DocumentType,Node),Notation.prototype.nodeType=NOTATION_NODE,_extends(Notation,Node),Entity.prototype.nodeType=ENTITY_NODE,_extends(Entity,Node),EntityReference.prototype.nodeType=ENTITY_REFERENCE_NODE,_extends(EntityReference,Node),DocumentFragment.prototype.nodeName="#document-fragment",DocumentFragment.prototype.nodeType=DOCUMENT_FRAGMENT_NODE,_extends(DocumentFragment,Node),ProcessingInstruction.prototype.nodeType=PROCESSING_INSTRUCTION_NODE,_extends(ProcessingInstruction,Node),XMLSerializer.prototype.serializeToString=function(node,attributeSorter){return node.toString(attributeSorter)},Node.prototype.toString=function(attributeSorter){var buf=[];return serializeToString(this,buf,attributeSorter),buf.join("")};try{Object.defineProperty&&(Object.defineProperty(LiveNodeList.prototype,"length",{get:function(){return _updateLiveList(this),this.$$length}}),Object.defineProperty(Node.prototype,"textContent",{get:function(){return getTextContent(this)},set:function(data){switch(this.nodeType){case 1:case 11:for(;this.firstChild;)this.removeChild(this.firstChild);(data||String(data))&&this.appendChild(this.ownerDocument.createTextNode(data));break;default:this.data=data,this.value=value,this.nodeValue=data}}}),__set__=function(object,key,value){object["$$"+key]=value})}catch(e){}exports.DOMImplementation=DOMImplementation,exports.XMLSerializer=XMLSerializer},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleUtilBlock_model_helper=__webpack_require__(107),_fusibleUtilBlock_model_helper2=_interopRequireDefault(_fusibleUtilBlock_model_helper),_fusibleUtilDom_helper=__webpack_require__(125),_fusibleUtilDom_helper2=_interopRequireDefault(_fusibleUtilDom_helper),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_custom_tag_container=__webpack_require__(131),_custom_tag_container2=_interopRequireDefault(_custom_tag_container),_styleComponentsPlaceholder=__webpack_require__(132),_styleComponentsPlaceholder2=_interopRequireDefault(_styleComponentsPlaceholder),ZWSP="\u200b",Block=function(_Component){function Block(props){var _this=this;_classCallCheck(this,Block),_get(Object.getPrototypeOf(Block.prototype),"constructor",this).call(this,props),this.handleCustomTagSelect=function(event){var customTagId=_lodash2["default"].last(event.currentTarget.dataset.reactid.split(".")).replace("$",""),customTagIndex=_this.props.blockModel.deref().get("customTags").findIndex(function(customTag){return customTag.get("id")==customTagId});_fusibleActionsSelection_actions2["default"].selectCustomTag(_this.props.documentContainerId,_this.props.documentId,_lodash2["default"].last(_this.props.blockModel._keyPath),customTagIndex,event.currentTarget.getBoundingClientRect())},this.internalDOMOutOfSync=!1}return _inherits(Block,_Component),_createClass(Block,null,[{key:"displayName",value:"Block",enumerable:!0},{key:"propTypes",value:{blockModel:function(value){return value instanceof _immutable2["default"].Map},config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object,documentContainerId:_reactAddons.PropTypes.string.isRequired,documentId:_reactAddons.PropTypes.string.isRequired},enumerable:!0}]),_createClass(Block,[{key:"shouldComponentUpdate",value:function(nextProps,nextState){var stateIsEqual=_lodash2["default"].isEqual(nextState,this.state),propsAreEqual=_lodash2["default"].isEqual(_lodash2["default"].omit(nextProps,"blockModel"),_lodash2["default"].omit(this.props,"blockModel")),blockModelsAreEqual=_immutable2["default"].is(this.props.blockModel.deref(),nextProps.blockModel.deref()),actualDomIsEqual=!0;if(!blockModelsAreEqual){var result=_immutable2["default"].is(this.elementsAsModel(),nextProps.blockModel.deref());this.internalDOMOutOfSync=result,actualDomIsEqual=result}var shouldRender=!(stateIsEqual&&propsAreEqual&&actualDomIsEqual);if(!shouldRender&&this.refs.placeholder){var textLength=nextProps.blockModel.get("text").length;textLength?_reactAddons2["default"].findDOMNode(this.refs.placeholder).classList.add(_styleComponentsPlaceholder2["default"].hide):_reactAddons2["default"].findDOMNode(this.refs.placeholder).classList.remove(_styleComponentsPlaceholder2["default"].hide)}return shouldRender}},{key:"render",value:function(){var blockConfig=this.props.config.textBlocks[this.props.blockModel.get("blockType")],modelAsElements=this.modelAsElements();this.internalDOMOutOfSync=!1,0==modelAsElements.length&&this.editing()&&modelAsElements.push(_reactAddons2["default"].createElement("span",{className:_styleComponentsPlaceholder2["default"].base,ref:"placeholder","data-placeholder":blockConfig.placeholder||this.props.config.startingEmptyPlaceholder||""},ZWSP));var blockProps={};if(!_lodash2["default"].isString(blockConfig.component)){var blockAttributes=this.props.blockModel.get("attributes");_lodash2["default"].extend(blockProps,{blockId:this.props.blockModel.get("id")},this.props.childProps||{},{attributes:blockAttributes?blockAttributes.toJS():{}})}return _reactAddons2["default"].createElement.apply(this,_lodash2["default"].flatten([blockConfig.component,blockProps,modelAsElements]))}},{key:"modelAsElements",value:function(){var _this2=this,modelGroupAsElement=function modelGroupAsElement(groups,group,index,initialGroups){if(_lodash2["default"].isString(group))groups.push(group);else if("textTag"==group.type){var tagConfig=_this2.props.config.textTags[group.model.tagType],tagProps={"data-id":group.model.id};_lodash2["default"].isString(tagConfig.component)||_lodash2["default"].extend(tagProps,{blockId:_this2.props.blockModel.get("id")},_this2.props.childProps||{},{attributes:group.model.attributes||{}}),groups.push(_reactAddons2["default"].createElement.apply(_this2,_lodash2["default"].flatten([tagConfig.component,tagProps,_lodash2["default"].reduce(group.children,modelGroupAsElement,[])])))}else{if("customTag"!=group.type)throw"Don't know how to render tag: "+group.tagType;var tagConfig=_this2.props.config.customTags[group.model.tagType];addCustomGroupToGroups(tagConfig,groups,group,index,initialGroups)}return groups},addCustomGroupToGroups=function(tagConfig,groups,group,index,initialGroups){if(_this2.editing())if(0==index)groups.push(ZWSP);else{var previousGroup=initialGroups[index-1];"customTag"==previousGroup.type&&groups.push(ZWSP)}var customTagProps=_lodash2["default"].extend({},{key:group.model.id,ref:group.model.id,uniqueId:group.model.id,blockId:_this2.props.blockModel.get("id"),documentId:_this2.props.documentId,documentContainerId:_this2.props.documentContainerId,attributes:group.model.attributes,component:tagConfig.component,childProps:_this2.props.childProps||{},showEditView:_this2.handleCustomTagSelect,renderMode:_this2.props.config.renderMode});return groups.push(_reactAddons2["default"].createElement(_custom_tag_container2["default"],customTagProps)),index+1==initialGroups.length&&_this2.editing()&&groups.push(ZWSP),groups};return _lodash2["default"].reduce(_fusibleUtilBlock_model_helper2["default"].blockModelToGroupedTags(this.props.blockModel.deref(),this.props.config),modelGroupAsElement,[])}},{key:"viewing",value:function(){return this.props.config.renderMode==_fusibleConfig2["default"].RENDER_MODES.VIEWING}},{key:"editing",value:function(){return this.props.config.renderMode==_fusibleConfig2["default"].RENDER_MODES.EDITING}},{key:"elementsAsModel",value:function(){var _props=this.props,config=_props.config,blockModel=_props.blockModel,newBlockModel=_fusibleUtilDom_helper2["default"].internalDomToBlockModel(_reactAddons2["default"].findDOMNode(this),config,blockModel.deref().get("textTags"),blockModel.deref().get("customTags")).set("id",blockModel.get("id")).set("attributes",this.determineAttributes(blockModel));return _fusibleUtilBlock_model_helper2["default"].consolidateTags(newBlockModel,config)}},{key:"determineAttributes",value:function(blockModel){var attrs=blockModel.get("attributes");return attrs&&"function"==typeof attrs.deref?attrs.deref():attrs?attrs:new _immutable2["default"].Map}},{key:"modelOffsetForNodeAndOffset",value:function(node,offset){var excludeTags=_lodash2["default"].keys(this.props.config.customTags);return _fusibleUtilDom_helper2["default"].textOffsetFromParent(_reactAddons2["default"].findDOMNode(this),node,offset,excludeTags)}}]),Block}(_reactAddons.Component);exports["default"]=Block,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_fusibleStore=__webpack_require__(81),_fusibleStore2=_interopRequireDefault(_fusibleStore),CustomTagContainer=function(_Component){function CustomTagContainer(){var _this=this;_classCallCheck(this,CustomTagContainer),_get(Object.getPrototypeOf(CustomTagContainer.prototype),"constructor",this).call(this),this.handleSelectionChange=function(nextSelection){var selected=nextSelection.get("customTags",_immutable2["default"].List()).contains(_this.props.uniqueId);selected!=_this.state.selected&&_this.setState({selected:selected})},this.state={selected:!1}}return _inherits(CustomTagContainer,_Component),_createClass(CustomTagContainer,null,[{key:"displayName",value:"CustomTagContainer",enumerable:!0},{key:"propTypes",value:{documentId:_reactAddons.PropTypes.string.isRequired,documentContainerId:_reactAddons.PropTypes.string.isRequired,uniqueId:_reactAddons.PropTypes.string.isRequired,renderMode:_reactAddons.PropTypes.string.isRequired,attributes:_reactAddons.PropTypes.object.isRequired,showEditView:_reactAddons.PropTypes.func.isRequired,childProps:_reactAddons.PropTypes.object},enumerable:!0}]),_createClass(CustomTagContainer,[{key:"componentDidMount",value:function(){_fusibleStore2["default"].selection.on("swap",this.handleSelectionChange,this)}},{key:"componentWillUnmount",value:function(){_fusibleStore2["default"].selection.off("swap",this.handleSelectionChange,this)}},{key:"shouldComponentUpdate",value:function(nextProps,nextState){var stateIsEqual=_lodash2["default"].isEqual(nextState,this.state),propsAreEqual=_lodash2["default"].isEqual(nextProps,this.props);return!(propsAreEqual&&stateIsEqual)}},{key:"render",value:function(){var tagProps=_lodash2["default"].extend({},this.props.childProps||{},{ref:"tag",attributes:this.props.attributes,showEditView:this.props.showEditView,renderMode:this.props.renderMode,documentId:this.props.documentId,documentContainerId:this.props.documentContainerId,selected:this.state.selected});return _reactAddons2["default"].createElement(this.props.component,tagProps)}}]),CustomTagContainer}(_reactAddons.Component);exports["default"]=CustomTagContainer,module.exports=exports["default"]},function(module,exports){module.exports={base:"fusible__placeholder__base",hide:"fusible__placeholder__hide"}},,function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_slicedToArray=__webpack_require__(28)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleActionsText_edit_actions=__webpack_require__(103),_fusibleActionsText_edit_actions2=_interopRequireDefault(_fusibleActionsText_edit_actions),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_decoratorsMenu_decorator=__webpack_require__(135),_decoratorsMenu_decorator2=_interopRequireDefault(_decoratorsMenu_decorator),_menu_button=__webpack_require__(136),_menu_button2=_interopRequireDefault(_menu_button),_styleComponentsMenu=__webpack_require__(137),_styleComponentsMenu2=_interopRequireDefault(_styleComponentsMenu),CSSTransitionGroup=_reactAddons2["default"].addons.CSSTransitionGroup,TextMenu=function(_Component){function TextMenu(){_classCallCheck(this,_TextMenu),_get(Object.getPrototypeOf(_TextMenu.prototype),"constructor",this).apply(this,arguments)}_inherits(TextMenu,_Component),_createClass(TextMenu,[{key:"render",value:function(){var menu=void 0;if(this.shouldDisplay()){var leftOffsets=this.props.leftOffsets(),inlineStyle={top:this.props.selection.getIn(["position","top"],47)-47,left:leftOffsets.main};menu=_reactAddons2["default"].createElement("div",{style:inlineStyle,className:_styleComponentsMenu2["default"].expanded,key:"text_menu"},_reactAddons2["default"].createElement("div",{className:_styleComponentsMenu2["default"].expanded_contents},_reactAddons2["default"].createElement("ul",null,this.blockButtons(),this.tagButtons(),this.actionButtons())),_reactAddons2["default"].createElement("div",{className:_styleComponentsMenu2["default"].expanded_caret,style:{left:leftOffsets.caret}}))}return _reactAddons2["default"].createElement(CSSTransitionGroup,{transitionName:"fusible__menu"},menu)}},{key:"shouldDisplay",value:function(){var _props=this.props,selection=_props.selection,selectionInEditor=_props.selectionInEditor;return selectionInEditor()&&!selection.get("collapsed")&&!selection.get("strange")&&selection.get("inContentEditable")}},{key:"tagButtons",value:function(){var _this=this;return _lodash2["default"].map(_lodash2["default"].pairs(this.props.selection.get("supportedTextTags").toJS()),function(pair){var _pair=_slicedToArray(pair,2),tagType=_pair[0],tagConfig=_pair[1],active=_this.props.selection.get("textTags").contains(tagType);return _reactAddons2["default"].createElement("li",{key:tagType},_reactAddons2["default"].createElement(_menu_button2["default"],{ref:tagType+"_button",handleClick:_fusibleActionsText_edit_actions2["default"].updateTextTag,config:tagConfig,active:active,action:tagType}))})}},{key:"blockButtons",value:function(){var _this2=this;return _lodash2["default"].map(_lodash2["default"].pairs(this.props.selection.get("supportedTextBlocks").toJS()),function(pair){var _pair2=_slicedToArray(pair,2),blockType=_pair2[0],blockConfig=_pair2[1],active=1==_this2.props.selection.get("textBlocks").size&&_this2.props.selection.getIn(["textBlocks",0])==blockType;return _reactAddons2["default"].createElement("li",{key:blockType},_reactAddons2["default"].createElement(_menu_button2["default"],{ref:blockType+"_button",handleClick:_fusibleActionsText_edit_actions2["default"].changeTextBlockType,config:blockConfig,active:active,action:blockType}))})}},{key:"actionButtons",value:function(){return _lodash2["default"].map(_lodash2["default"].pairs(this.props.config.customActions),function(pair){var _pair3=_slicedToArray(pair,2),actionName=_pair3[0],actionConfig=_pair3[1];return _reactAddons2["default"].createElement("li",{key:actionName},_reactAddons2["default"].createElement(_menu_button2["default"],{ref:actionName+"_button",handleClick:_fusibleActionsSelection_actions2["default"].triggerCustomAction,config:actionConfig,active:!1,action:actionName}))})}},{key:"selectRefsLike",value:function(regex){return _lodash2["default"].pick(this.refs,function(value,key){return regex.test(key)})}}],[{key:"displayName",value:"TextMenu",enumerable:!0},{key:"propTypes",value:{documentId:_reactAddons.PropTypes.string.isRequired,documentContainerId:_reactAddons.PropTypes.string.isRequired,config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object},enumerable:!0}]);var _TextMenu=TextMenu;return TextMenu=_decoratorsMenu_decorator2["default"](TextMenu)||TextMenu}(_reactAddons.Component);exports["default"]=TextMenu,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_extends=__webpack_require__(22)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_fusibleStore=__webpack_require__(81),_fusibleStore2=_interopRequireDefault(_fusibleStore),update=_reactAddons2["default"].addons.update;exports["default"]=function(ComposedComponent){return function(_Component){function AsMenu(){var _this=this;_classCallCheck(this,AsMenu),_get(Object.getPrototypeOf(AsMenu.prototype),"constructor",this).call(this),this.handleSelectionChange=function(newSelection){var nextLastAction=_fusibleStore2["default"].lastActionCursor().deref().get("name"),composedComponent=_this.refs.composed;composedComponent&&composedComponent.componentWillReceiveSelection&&composedComponent.componentWillReceiveSelection(newSelection,nextLastAction),_this.setState({selection:newSelection})},this.leftOffsets=function(){var collapsed=arguments.length<=0||void 0===arguments[0]?!1:arguments[0];if(_this.selectionInEditor()){var selectionWidth=_this.state.selection.getIn(["position","right"])-_this.state.selection.getIn(["position","left"]),halfWidth=_this.state.width/2,selectionMiddle=_this.state.selection.getIn(["position","left"])+selectionWidth/2,parentWidth=_this.props.containerWidth,desiredLeft=selectionMiddle-halfWidth,minCaretSide=collapsed?8:11;return 0>desiredLeft?{main:0,caret:Math.max(minCaretSide,desiredLeft+halfWidth)}:desiredLeft+_this.state.width>parentWidth?{main:parentWidth-_this.state.width,caret:Math.min(_this.state.width-minCaretSide,desiredLeft+halfWidth-(parentWidth-_this.state.width))}:{main:desiredLeft,caret:halfWidth}}return{main:0,caret:0}},this.setWidth=function(width){_this.setState({width:width})},this.selectionInEditor=function(){return _this.state.selection.get("documentId")==_this.props.documentId},this.state={width:500,selection:_fusibleStore2["default"].selection.state,lastAction:_fusibleStore2["default"].lastActionCursor().deref().get("name")}}return _inherits(AsMenu,_Component),_createClass(AsMenu,[{key:"componentDidMount",value:function(){this.updateWidth(),_fusibleStore2["default"].selection.on("swap",this.handleSelectionChange,this)}},{key:"componentDidUpdate",value:function(){this.updateWidth()}},{key:"componentWillUnmount",value:function(){clearTimeout(this.widthTimeout),_fusibleStore2["default"].selection.off("swap",this.handleSelectionChange,this)}},{key:"shouldComponentUpdate",value:function(nextProps,nextState){var stateIsEqual=_lodash2["default"].isEqual(_lodash2["default"].omit(nextState,"selection"),_lodash2["default"].omit(this.state,"selection")),propsAreEqual=_lodash2["default"].isEqual(nextProps,this.props),selectionsAreEqual=this.state.selection.equals(nextState.selection);return!(stateIsEqual&&propsAreEqual&&selectionsAreEqual)}},{key:"updateWidth",value:function(){var _this2=this;clearTimeout(this.widthTimeout),this.widthTimeout=setTimeout(function(){var node=_reactAddons2["default"].findDOMNode(_this2);if(node.childNodes[0]){var newWidth=node.childNodes[0].offsetWidth;if(Math.abs(newWidth-_this2.state.width)>1){var newState=update(_this2.state,{width:{$set:newWidth}});_this2.setState(newState)}}},5)}},{key:"render",value:function(){return _reactAddons2["default"].createElement(ComposedComponent,_extends({},this.props,this.state,{ref:"composed",setWidth:this.setWidth,leftOffsets:this.leftOffsets,selectionInEditor:this.selectionInEditor}))}}]),AsMenu}(_reactAddons.Component)},module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),MenuButton=function(_Component){function MenuButton(){var _this=this;_classCallCheck(this,MenuButton),_get(Object.getPrototypeOf(MenuButton.prototype),"constructor",this).apply(this,arguments),this.handleClick=function(event){event.preventDefault();var _props=_this.props,handleClick=_props.handleClick,action=_props.action;handleClick(action)}}return _inherits(MenuButton,_Component),_createClass(MenuButton,[{key:"render",value:function(){var _props2=this.props,active=_props2.active,config=_props2.config,action=_props2.action;return _reactAddons2["default"].createElement("a",{href:"",onClick:this.handleClick,className:active?"active":"",title:config.tooltip||action},_reactAddons2["default"].createElement("span",{className:config.iconClass}))}}],[{key:"displayName",value:"MenuButton",enumerable:!0},{key:"propTypes",value:{action:_reactAddons.PropTypes.string.isRequired,config:_reactAddons.PropTypes.object.isRequired,active:_reactAddons.PropTypes.bool,handleClick:_reactAddons.PropTypes.func.isRequired},enumerable:!0}]),MenuButton}(_reactAddons.Component);exports["default"]=MenuButton,module.exports=exports["default"]},function(module,exports){module.exports={base:"fusible__menu__base",expanded:"fusible__menu__expanded fusible__menu__base",active:"fusible__menu__active",collapsed:"fusible__menu__collapsed fusible__menu__base",inverted_expanded:"fusible__menu__inverted_expanded fusible__menu__expanded fusible__menu__base",wrapper:"fusible__menu__wrapper",wrapper_hide:"fusible__menu__wrapper_hide",wrapper_fade_in:"fusible__menu__wrapper_fade_in",contents:"fusible__menu__contents",expanded_contents:"fusible__menu__expanded_contents fusible__menu__contents",collapsed_contents:"fusible__menu__collapsed_contents fusible__menu__contents",caret:"fusible__menu__caret",expanded_caret:"fusible__menu__expanded_caret fusible__menu__caret",inverted_caret:"fusible__menu__inverted_caret fusible__menu__caret",collapsed_caret:"fusible__menu__collapsed_caret"}},,function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_defineProperty=__webpack_require__(140)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_classnames=__webpack_require__(141),_classnames2=_interopRequireDefault(_classnames),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_decoratorsMenu_decorator=__webpack_require__(135),_decoratorsMenu_decorator2=_interopRequireDefault(_decoratorsMenu_decorator),_custom_menu=__webpack_require__(145),_custom_menu2=_interopRequireDefault(_custom_menu),_custom_menu_expander=__webpack_require__(146),_custom_menu_expander2=_interopRequireDefault(_custom_menu_expander),_styleComponentsMenu=__webpack_require__(137),_styleComponentsMenu2=_interopRequireDefault(_styleComponentsMenu),CSSTransitionGroup=_reactAddons2["default"].addons.CSSTransitionGroup,CustomMenuContainer=function(_Component){function CustomMenuContainer(){var _this=this;_classCallCheck(this,_CustomMenuContainer),_get(Object.getPrototypeOf(_CustomMenuContainer.prototype),"constructor",this).call(this),this.expandMenu=function(){var customMenuItems=_lodash2["default"].keys(_this.props.config.customTags).length+_this.props.selection.get("supportedCustomBlocks",_immutable2["default"].Map()).size,estimatedWidth=30*customMenuItems+2*(customMenuItems-1)+10;clearTimeout(_this.stateTimeout),_this.setState({menuState:"expanded",showImmediately:!0,showDelayed:!1}),_this.props.setWidth(estimatedWidth),_fusibleActionsSelection_actions2["default"].restoreSelection()},this.state={showImmediately:!0,showDelayed:!1}}_inherits(CustomMenuContainer,_Component),_createClass(CustomMenuContainer,null,[{key:"displayName",value:"CustomMenuContainer",enumerable:!0},{key:"propTypes",value:{documentId:_reactAddons.PropTypes.string.isRequired,documentContainerId:_reactAddons.PropTypes.string.isRequired,config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object},enumerable:!0}]),_createClass(CustomMenuContainer,[{key:"componentWillReceiveSelection",value:function(nextSelection,nextLastAction){var _this2=this,selectionUnchanged=this.props.selection.equals(nextSelection);clearTimeout(this.stateTimeout),selectionUnchanged||this.setState({menuState:"collapsed"}),this.props.selection.get("selectionType")!=nextSelection.get("selectionType")&&this.props.setWidth(12),"collapsed"==this.state.menuState&&("Cursor Mouse Modification"==nextLastAction?this.setState({showImmediately:!0,showDelayed:!1}):(this.setState({showImmediately:!1,showDelayed:!1}),this.stateTimeout=setTimeout(function(){_this2.setState({showDelayed:!0})},250)))}},{key:"componentWillUnmount",value:function(){clearTimeout(this.stateTimeout)}},{key:"render",value:function(){var menu=void 0;if(this.shouldDisplay()){var _classNames,_classNames2,offsets=this.customOffsets(),classes=this.menuCollapsed()?_styleComponentsMenu2["default"].collapsed:_styleComponentsMenu2["default"].inverted_expanded,contentsClasses=this.menuCollapsed()?_styleComponentsMenu2["default"].collapsed_contents:_styleComponentsMenu2["default"].expanded_contents,caretClasses=_classnames2["default"]((_classNames={},_defineProperty(_classNames,_styleComponentsMenu2["default"].inverted_caret,!0),_defineProperty(_classNames,_styleComponentsMenu2["default"].collapsed_caret,this.menuCollapsed()),_defineProperty(_classNames,_styleComponentsMenu2["default"].expanded_caret,this.menuExpanded()),_classNames)),wrapperClasses=_classnames2["default"]((_classNames2={},_defineProperty(_classNames2,_styleComponentsMenu2["default"].wrapper,!0),_defineProperty(_classNames2,_styleComponentsMenu2["default"].wrapper_hide,!this.state.showImmediately),_defineProperty(_classNames2,_styleComponentsMenu2["default"].wrapper_fade_in,this.state.showDelayed),_classNames2)),menuContents=void 0;menuContents=this.menuCollapsed()?_reactAddons2["default"].createElement(_custom_menu_expander2["default"],{ref:"expander",handleClick:this.expandMenu}):_reactAddons2["default"].createElement(_custom_menu2["default"],{documentContainerId:this.props.documentContainerId,documentId:this.props.documentId,selection:this.props.selection,config:this.props.config}),menu=_reactAddons2["default"].createElement("div",{style:offsets.main,className:classes,key:"custom_menu"},_reactAddons2["default"].createElement("div",{className:wrapperClasses},_reactAddons2["default"].createElement("div",{className:contentsClasses},menuContents),_reactAddons2["default"].createElement("div",{className:caretClasses,style:{left:offsets.caret.left}})))}return _reactAddons2["default"].createElement(CSSTransitionGroup,{transitionName:"fusible__menu"},menu)}},{key:"textSelection",value:function(){return"text"==this.props.selection.get("selectionType")}},{key:"menuExpanded",value:function(){return"expanded"==this.state.menuState}},{key:"menuCollapsed",value:function(){return"collapsed"==this.state.menuState;
}},{key:"customOffsets",value:function(){var leftOffsets=this.props.leftOffsets(this.menuCollapsed()),offsets={main:{top:this.props.selection.getIn(["position","bottom"],0),left:leftOffsets.main},caret:{left:leftOffsets.caret+1}};return this.menuExpanded()?offsets.main.top+=4:offsets.main.top+=3,offsets}},{key:"shouldDisplay",value:function(){var menuCollapsedAndCursorGone=this.menuCollapsed()&&!this.props.selection.get("inContentEditable");return this.props.selectionInEditor()&&this.props.selection.get("collapsed")&&this.textSelection()&&!menuCollapsedAndCursorGone}}]);var _CustomMenuContainer=CustomMenuContainer;return CustomMenuContainer=_decoratorsMenu_decorator2["default"](CustomMenuContainer)||CustomMenuContainer}(_reactAddons.Component);exports["default"]=CustomMenuContainer,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _Object$defineProperty=__webpack_require__(13)["default"];exports["default"]=function(obj,key,value){return key in obj?_Object$defineProperty(obj,key,{value:value,enumerable:!0,configurable:!0,writable:!0}):obj[key]=value,obj},exports.__esModule=!0},function(module,exports,__webpack_require__){module.exports=__webpack_require__(142),module.exports=__webpack_require__(143),module.exports=__webpack_require__(144)},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){"use strict";function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(arg);else if(Array.isArray(arg))classes.push(classNames.apply(null,arg));else if("object"===argType)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(key)}}return classes.join(" ")}var hasOwn={}.hasOwnProperty;"undefined"!=typeof module&&module.exports?module.exports=classNames:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){"use strict";function classNames(){for(var classes=[],i=0;i<arguments.length;i++){var arg=arguments[i];if(arg){var argType=typeof arg;if("string"===argType||"number"===argType)classes.push(this&&this[arg]||arg);else if(Array.isArray(arg))classes.push(classNames.apply(this,arg));else if("object"===argType)for(var key in arg)hasOwn.call(arg,key)&&arg[key]&&classes.push(this&&this[key]||key)}}return classes.join(" ")}var hasOwn={}.hasOwnProperty;"undefined"!=typeof module&&module.exports?module.exports=classNames:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()},function(module,exports,__webpack_require__){var __WEBPACK_AMD_DEFINE_ARRAY__,__WEBPACK_AMD_DEFINE_RESULT__;/*!
	  Copyright (c) 2016 Jed Watson.
	  Licensed under the MIT License (MIT), see
	  http://jedwatson.github.io/classnames
	*/
!function(){"use strict";var classNames=function(){function StorageObject(){}function _parseArray(resultSet,array){for(var length=array.length,i=0;length>i;++i)_parse(resultSet,array[i])}function _parseNumber(resultSet,num){resultSet[num]=!0}function _parseObject(resultSet,object){for(var k in object)hasOwn.call(object,k)&&(resultSet[k]=!!object[k])}function _parseString(resultSet,str){for(var array=str.split(SPACE),length=array.length,i=0;length>i;++i)resultSet[array[i]]=!0}function _parse(resultSet,arg){if(arg){var argType=typeof arg;"string"===argType?_parseString(resultSet,arg):Array.isArray(arg)?_parseArray(resultSet,arg):"object"===argType?_parseObject(resultSet,arg):"number"===argType&&_parseNumber(resultSet,arg)}}function _classNames(){for(var len=arguments.length,args=Array(len),i=0;len>i;i++)args[i]=arguments[i];var classSet=new StorageObject;_parseArray(classSet,args);var list=[];for(var k in classSet)classSet[k]&&list.push(k);return list.join(" ")}StorageObject.prototype=Object.create(null);var hasOwn={}.hasOwnProperty,SPACE=/\s+/;return _classNames}();"undefined"!=typeof module&&module.exports?module.exports=classNames:(__WEBPACK_AMD_DEFINE_ARRAY__=[],__WEBPACK_AMD_DEFINE_RESULT__=function(){return classNames}.apply(exports,__WEBPACK_AMD_DEFINE_ARRAY__),!(void 0!==__WEBPACK_AMD_DEFINE_RESULT__&&(module.exports=__WEBPACK_AMD_DEFINE_RESULT__)))}()},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_slicedToArray=__webpack_require__(28)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleActionsCustom_tag_actions=__webpack_require__(100),_fusibleActionsCustom_tag_actions2=_interopRequireDefault(_fusibleActionsCustom_tag_actions),_fusibleActionsCustom_block_actions=__webpack_require__(99),_fusibleActionsCustom_block_actions2=_interopRequireDefault(_fusibleActionsCustom_block_actions),_menu_button=__webpack_require__(136),_menu_button2=_interopRequireDefault(_menu_button),CutomMenu=function(_Component){function CutomMenu(){_classCallCheck(this,CutomMenu),_get(Object.getPrototypeOf(CutomMenu.prototype),"constructor",this).apply(this,arguments),this.handleTagButtonClick=function(action){_fusibleActionsCustom_tag_actions2["default"].addCustomTag(action)}}return _inherits(CutomMenu,_Component),_createClass(CutomMenu,[{key:"render",value:function(){return _reactAddons2["default"].createElement("ul",null,this.tagButtons(),this.blockButtons())}},{key:"tagButtons",value:function(){var _this=this;return _lodash2["default"].map(_lodash2["default"].pairs(this.props.config.customTags),function(pair){var _pair=_slicedToArray(pair,2),tagType=_pair[0],blockConfig=_pair[1];return _reactAddons2["default"].createElement("li",{key:tagType},_reactAddons2["default"].createElement(_menu_button2["default"],{ref:tagType+"_button",handleClick:_this.handleTagButtonClick,config:blockConfig,action:tagType}))})}},{key:"blockButtons",value:function(){return _lodash2["default"].map(_lodash2["default"].pairs(this.props.selection.get("supportedCustomBlocks").toJS()),function(pair){var _pair2=_slicedToArray(pair,2),blockType=_pair2[0],blockConfig=_pair2[1];return _reactAddons2["default"].createElement("li",{key:blockType},_reactAddons2["default"].createElement(_menu_button2["default"],{ref:blockType+"_button",handleClick:_fusibleActionsCustom_block_actions2["default"].addCustomBlock,config:blockConfig,action:blockType}))})}},{key:"selectRefsLike",value:function(regex){return _lodash2["default"].pick(this.refs,function(value,key){return regex.test(key)})}}],[{key:"displayName",value:"CustomMenu",enumerable:!0},{key:"propTypes",value:{documentId:_reactAddons.PropTypes.string.isRequired,documentContainerId:_reactAddons.PropTypes.string.isRequired,config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired},enumerable:!0}]),CutomMenu}(_reactAddons.Component);exports["default"]=CutomMenu,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),CustomMenuExpander=function(_Component){function CustomMenuExpander(){var _this=this;_classCallCheck(this,CustomMenuExpander),_get(Object.getPrototypeOf(CustomMenuExpander.prototype),"constructor",this).apply(this,arguments),this.handleClick=function(event){event.preventDefault(),_this.props.handleClick()}}return _inherits(CustomMenuExpander,_Component),_createClass(CustomMenuExpander,[{key:"render",value:function(){return _reactAddons2["default"].createElement("ul",null,_reactAddons2["default"].createElement("li",null,_reactAddons2["default"].createElement("a",{href:"",onClick:this.handleClick,title:"Expand insert menu"},"+")))}}],[{key:"displayName",value:"CustomMenuExpander",enumerable:!0},{key:"propTypes",value:{handleClick:_reactAddons.PropTypes.func.isRequired},enumerable:!0}]),CustomMenuExpander}(_reactAddons.Component);exports["default"]=CustomMenuExpander,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_defineProperty=__webpack_require__(140)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_classnames=__webpack_require__(141),_classnames2=_interopRequireDefault(_classnames),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleActionsCustom_tag_actions=__webpack_require__(100),_fusibleActionsCustom_tag_actions2=_interopRequireDefault(_fusibleActionsCustom_tag_actions),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_decoratorsMenu_decorator=__webpack_require__(135),_decoratorsMenu_decorator2=_interopRequireDefault(_decoratorsMenu_decorator),_styleComponentsMenu=__webpack_require__(137),_styleComponentsMenu2=_interopRequireDefault(_styleComponentsMenu),CSSTransitionGroup=_reactAddons2["default"].addons.CSSTransitionGroup,CustomTagEditMenu=function(_Component){function CustomTagEditMenu(){_classCallCheck(this,_CustomTagEditMenu),_get(Object.getPrototypeOf(_CustomTagEditMenu.prototype),"constructor",this).apply(this,arguments),this.handleCustomTagEditCommit=function(newAttributes){_fusibleActionsCustom_tag_actions2["default"].editCustomTag(newAttributes)},this.handleCustomTagEditCancel=function(){_fusibleActionsSelection_actions2["default"].removeSelection()}}_inherits(CustomTagEditMenu,_Component),_createClass(CustomTagEditMenu,[{key:"componentWillReceiveSelection",value:function(nextSelection){if("customTag"==nextSelection.get("selectionType")){var customTag=nextSelection.get("customTag").toJS(),customTagConfig=this.props.config.customTags[customTag.tagType],newWidth=void 0;newWidth=customTagConfig.editWidth?customTagConfig.editWidth+10:100,this.props.setWidth(newWidth)}}},{key:"render",value:function(){var menu=void 0;if(this.shouldDisplay()){var _classNames,leftOffsets=this.props.leftOffsets(),offsets={top:this.props.selection.getIn(["position","bottom"],0)+4,left:leftOffsets.main},caretClasses=_classnames2["default"]((_classNames={},_defineProperty(_classNames,_styleComponentsMenu2["default"].inverted_caret,!0),_defineProperty(_classNames,_styleComponentsMenu2["default"].expanded_caret,!0),_classNames)),customTag=this.props.selection.get("customTag").toJS(),customTagConfig=this.props.config.customTags[customTag.tagType],menuProps=_lodash2["default"].extend({},this.props.childProps||{},{ref:"customEditor",key:customTag.id+"_edit_menu",attributes:customTag.attributes,cancelChange:this.handleCustomTagEditCancel,commitChange:this.handleCustomTagEditCommit}),menuContents=_reactAddons2["default"].createElement(customTagConfig.editComponent,menuProps);menu=_reactAddons2["default"].createElement("div",{style:offsets,className:_styleComponentsMenu2["default"].inverted_expanded,key:"custom_tag_edit_menu"},_reactAddons2["default"].createElement("div",{className:_styleComponentsMenu2["default"].expanded_contents},menuContents),_reactAddons2["default"].createElement("div",{className:caretClasses,style:{left:leftOffsets.caret}}))}return _reactAddons2["default"].createElement(CSSTransitionGroup,{transitionName:"fusible__menu"},menu)}},{key:"shouldDisplay",value:function(){return this.props.selectionInEditor()&&"customTag"==this.props.selection.get("selectionType")}}],[{key:"displayName",value:"CustomTagEditMenu",enumerable:!0},{key:"propTypes",value:{documentId:_reactAddons.PropTypes.string.isRequired,documentContainerId:_reactAddons.PropTypes.string.isRequired,selection:function(value){return value instanceof _immutable2["default"].Map},config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object},enumerable:!0}]);var _CustomTagEditMenu=CustomTagEditMenu;return CustomTagEditMenu=_decoratorsMenu_decorator2["default"](CustomTagEditMenu)||CustomTagEditMenu}(_reactAddons.Component);exports["default"]=CustomTagEditMenu,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_Keypress=__webpack_require__(149),_Keypress2=_interopRequireDefault(_Keypress),_selectionchange=__webpack_require__(88),_selectionchange2=_interopRequireDefault(_selectionchange),_fusibleUtilSelection_helper=__webpack_require__(114),_fusibleUtilSelection_helper2=_interopRequireDefault(_fusibleUtilSelection_helper),_fusibleActionsKey_combo_actions=__webpack_require__(102),_fusibleActionsKey_combo_actions2=_interopRequireDefault(_fusibleActionsKey_combo_actions),_fusibleActionsText_edit_actions=__webpack_require__(103),_fusibleActionsText_edit_actions2=_interopRequireDefault(_fusibleActionsText_edit_actions),_fusibleActionsSelection_actions=__webpack_require__(104),_fusibleActionsSelection_actions2=_interopRequireDefault(_fusibleActionsSelection_actions),_fusibleActionsTyping_actions=__webpack_require__(105),_fusibleActionsTyping_actions2=_interopRequireDefault(_fusibleActionsTyping_actions),_fusibleModelsKey=__webpack_require__(150),_fusibleModelsKey2=_interopRequireDefault(_fusibleModelsKey),_fusibleUtilBlock_model_helper=__webpack_require__(107),_fusibleUtilBlock_model_helper2=_interopRequireDefault(_fusibleUtilBlock_model_helper),_fusibleUtilClipboard_helper=__webpack_require__(151),_fusibleUtilClipboard_helper2=_interopRequireDefault(_fusibleUtilClipboard_helper),_fusibleStore=__webpack_require__(81),_fusibleStore2=_interopRequireDefault(_fusibleStore),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),TextBlockContainer=function(_Component){function TextBlockContainer(){var _this=this;_classCallCheck(this,TextBlockContainer),_get(Object.getPrototypeOf(TextBlockContainer.prototype),"constructor",this).apply(this,arguments),this._afterRender=function(){_reactAddons2["default"].findDOMNode(_this).contentEditable=!0},this.handleInput=function(_event){_this._inKeyCombo()||_fusibleActionsTyping_actions2["default"].documentChangeIntent()},this.handleKeyUp=function(event){_this._setCurrentKey(event),(_this.key.isDelete()||_this.key.isBackspace())&&_fusibleStore2["default"].haltDeleteIntent(),_this.key.isArrow()&&_selectionchange2["default"].trigger()},this.handleKeyDown=function(event){_this._setCurrentKey(event),_this.key.isEnter()?(event.preventDefault(),_fusibleActionsTyping_actions2["default"].enterIntent()):_this.key.isBackspace()?(event.preventDefault(),_fusibleActionsTyping_actions2["default"].backspaceIntent()):_this.key.isDelete()?(event.preventDefault(),_fusibleActionsTyping_actions2["default"].deleteIntent()):_this.key.isMutating()&&!_this._inKeyCombo()&&_fusibleStore2["default"].onTypingIntent(),_this.key.isArrow()&&(_fusibleStore2["default"].updateLastAction("Cursor Keyboard Modification"),_selectionchange2["default"].trigger())},this.handlePaste=function(event){event.preventDefault();var config=_this.props.config,pastedDocumentModels=_fusibleUtilClipboard_helper2["default"].pasteDataToDocumentModel(event.clipboardData,config).map(function(blockModel){return blockModel=blockModel.update("id",function(){return _fusibleUtilBlock_model_helper2["default"].generateId()}),_fusibleUtilBlock_model_helper2["default"].consolidateTags(blockModel,config)});_fusibleActionsKey_combo_actions2["default"].paste(pastedDocumentModels)},this.handleCut=function(event){var clonedSelection=_fusibleUtilSelection_helper2["default"].getSelection().getRangeAt(0).cloneContents(),div=document.createElement("div");div.appendChild(clonedSelection.cloneNode(!0)),event.clipboardData.setData("text/html",div.innerHTML),event.clipboardData.setData("text/plain",div.innerText),_fusibleActionsTyping_actions2["default"].deleteIntent(!0),event.preventDefault()},this.cancelEvent=function(event){event.preventDefault()}}return _inherits(TextBlockContainer,_Component),_createClass(TextBlockContainer,[{key:"componentDidMount",value:function(){this.listener=new _Keypress2["default"].Listener(_reactAddons2["default"].findDOMNode(this)),this._registerHistoryCombosOnListener(),this._registerTextTagCombosOnListener(),this._registerTextBlockResetCombosOnListener(),this._ensureNativeCombosAreOverriden(),this.metaKey=navigator&&navigator.userAgent&&navigator.userAgent.indexOf&&-1!=navigator.userAgent.indexOf("Mac OS X")?"cmd":"ctrl",this._afterRender()}},{key:"componentDidUpdate",value:function(){this._afterRender()}},{key:"componentWillUnmount",value:function(){this.listener.destroy()}},{key:"render",value:function(){var _props=this.props,className=_props.className,children=_props.children;return _reactAddons2["default"].createElement("div",{className:"fusible__block-list "+className,onKeyUp:this.handleKeyUp,onKeyDown:this.handleKeyDown,onPaste:this.handlePaste,onCut:this.handleCut,onInput:this.handleInput,onDrag:this.cancelEvent,onDragStart:this.cancelEvent,onDragEnd:this.cancelEvent,onDrop:this.cancelEvent},children)}},{key:"_registerHistoryCombosOnListener",value:function(){this.listener.register_combo({keys:"meta z",is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsKey_combo_actions2["default"].undo()}}),this.listener.register_combo({keys:"meta shift z",is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsKey_combo_actions2["default"].redo()}}),this.listener.register_combo({keys:"meta y",is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsKey_combo_actions2["default"].redo()}})}},{key:"_registerTextTagCombosOnListener",value:function(){var _this2=this;_lodash2["default"].each(this.props.config.textTags,function(tagConfig,tagType){var keyCombos=[];tagConfig.keyCombo&&(keyCombos=_lodash2["default"].isArray(tagConfig.keyCombo)?tagConfig.keyCombo:[tagConfig.keyCombo]),_lodash2["default"].each(keyCombos,function(keyCombo){_this2.listener.register_combo({keys:keyCombo,is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsText_edit_actions2["default"].updateTextTag(tagType)}})})})}},{key:"_registerTextBlockResetCombosOnListener",value:function(){var _this3=this;this.comboBlockTypes={},_lodash2["default"].each(this.props.config.textBlocks,function(blockConfig,blockType){var keyCombo=blockConfig.resetKeyCombo;keyCombo&&(_this3.comboBlockTypes[keyCombo]=_this3.comboBlockTypes[keyCombo]||[],_this3.comboBlockTypes[keyCombo].push(blockType),_this3.listener.register_combo({keys:keyCombo,is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsKey_combo_actions2["default"].resetTextBlockCombo(_this3.comboBlockTypes[keyCombo])}}))})}},{key:"_ensureNativeCombosAreOverriden",value:function(){var _this4=this,registeredCombos=_lodash2["default"].compact(_lodash2["default"].flatten(_lodash2["default"].map(this.props.config.textTags,function(tagConfig,_tagType){return tagConfig.keyCombo}))),textTagCombos=["meta b","meta i","meta u"],combosToOverride=_lodash2["default"].difference(textTagCombos,registeredCombos);_lodash2["default"].each(combosToOverride,function(keyCombo){_this4.listener.register_combo({keys:keyCombo,is_solitary:!0,on_keydown:function(event){event.preventDefault()}})}),_lodash2["default"].contains(registeredCombos,"ctrl m")||this.listener.register_combo({keys:"ctrl m",is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsTyping_actions2["default"].enterIntent()}}),_lodash2["default"].contains(registeredCombos,"ctrl a")||this.listener.register_combo({keys:"ctrl a",is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsSelection_actions2["default"].moveSelectionToStartOfBlock()}}),_lodash2["default"].contains(registeredCombos,"ctrl e")||this.listener.register_combo({keys:"ctrl e",is_solitary:!0,on_keydown:function(event){event.preventDefault(),_fusibleActionsSelection_actions2["default"].moveSelectionToEndOfBlock()}});var cursorMoveCombos=["ctrl n","ctrl f","ctrl p","ctrl b"];_lodash2["default"].each(cursorMoveCombos,function(keyCombo){_lodash2["default"].contains(registeredCombos,keyCombo)||_this4.listener.register_combo({keys:keyCombo,is_solitary:!0,on_keydown:function(_event){_fusibleStore2["default"].updateLastAction("Cursor Keyboard Modification")}})});var obscureCombos=["ctrl d","ctrl h","ctrl k","ctrl t"];_lodash2["default"].each(obscureCombos,function(keyCombo){_lodash2["default"].contains(registeredCombos,keyCombo)||_this4.listener.register_combo({keys:keyCombo,is_solitary:!0,on_keydown:function(event){event.preventDefault()}})})}},{key:"_setCurrentKey",value:function(event){this.key=new _fusibleModelsKey2["default"](event)}},{key:"_inKeyCombo",value:function(){return _lodash2["default"].contains(this.listener._keys_down,this.metaKey)}}],[{key:"displayName",value:"TextBlockContainer",enumerable:!0},{key:"propTypes",value:{documentId:_reactAddons.PropTypes.string.isRequired,documentContainerId:_reactAddons.PropTypes.string.isRequired,config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired},enumerable:!0}]),TextBlockContainer}(_reactAddons.Component);exports["default"]=TextBlockContainer,module.exports=exports["default"]},function(module,exports){module.exports=__WEBPACK_EXTERNAL_MODULE_149__},function(module,exports,__webpack_require__){"use strict";var _createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_Keypress=__webpack_require__(149),_Keypress2=_interopRequireDefault(_Keypress),Key=function(){function Key(event){_classCallCheck(this,Key),this.event=event,this.name=_Keypress2["default"]._keycode_dictionary[this.event.keyCode],this.code=this.event.keyCode}return _createClass(Key,null,[{key:"enterKeys",value:["enter"],enumerable:!0},{key:"backspaceKeys",value:["backspace"],enumerable:!0},{key:"deleteKeys",value:["delete"],enumerable:!0},{key:"controlKeys",value:["ctrl","cmd","alt","shift","esc","caps"],enumerable:!0},{key:"arrowKeys",value:["left","up","right","down"],enumerable:!0},{key:"ignoredKeys",value:["num","caps","pageup","pagedown","end","home","left","up","right","down","print","insert","tab"],enumerable:!0}]),_createClass(Key,[{key:"isIgnored",value:function(){return _lodash2["default"].contains(Key.ignoredKeys,this.name)}},{key:"isEnter",value:function(){return _lodash2["default"].contains(Key.enterKeys,this.name)}},{key:"isDelete",value:function(){return _lodash2["default"].contains(Key.deleteKeys,this.name)}},{key:"isBackspace",value:function(){return _lodash2["default"].contains(Key.backspaceKeys,this.name)}},{key:"isArrow",value:function(){return _lodash2["default"].contains(Key.arrowKeys,this.name)}},{key:"isControl",value:function(){return _lodash2["default"].contains(Key.controlKeys,this.name)}},{key:"isNonMutating",value:function(){return this.isIgnored()||this.isControl()}},{key:"isMutating",value:function(){return!this.isNonMutating()}}]),Key}();exports["default"]=Key,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_immutable=__webpack_require__(20),_dom_helper=__webpack_require__(125),_dom_helper2=_interopRequireDefault(_dom_helper),_document_model_helper=__webpack_require__(108),_document_model_helper2=_interopRequireDefault(_document_model_helper),_dom_parser=__webpack_require__(126),_dom_parser2=_interopRequireDefault(_dom_parser),ClipboardHelper=function(){function ClipboardHelper(){_classCallCheck(this,ClipboardHelper)}return _createClass(ClipboardHelper,null,[{key:"pasteDataToDocumentModel",value:function(clipboardData,config){var htmlText=clipboardData.getData("text/html"),plainText=clipboardData.getData("text/plain");return htmlText&&htmlText.length?(console.debug("HTML Paste: ",htmlText),this._htmlToDocumentModel(htmlText,config)):plainText&&plainText.length?(console.debug("Plain Text Paste: ",plainText),this._textToDocumentModel(plainText,config)):new _immutable.List}},{key:"_htmlToDocumentModel",value:function(htmlText,config){var parser=new _dom_parser2["default"],parsedDocument=parser.parseFromString(htmlText,"text/html"),node=parsedDocument.body,anyBlockNodes=_lodash2["default"].any(node.childNodes,function(childNode){return _dom_helper2["default"].textBlockTags.contains(childNode.tagName)});if(!anyBlockNodes){var blockConfig=config.textBlocks[config.defaultTextBlockType];node=_dom_helper2["default"].wrapNodes(parsedDocument,node,blockConfig.tagsToImport[0],blockConfig.sharedParentElement)}return _lodash2["default"].reduce(node.childNodes,this._nodeToBlockModel.bind(this,config,config.importableBlockTagNames,config.nestedElementParentTagNames),new _immutable.List)}},{key:"_textToDocumentModel",value:function(text,config){var blockConfig=config.textBlocks[config.defaultTextBlockType],textParts=_lodash2["default"].compact(text.split(/[\n\r]/g)),documentModel=new _immutable.List;return _lodash2["default"].map(textParts,function(textPart,index){documentModel=_document_model_helper2["default"].addEmptyBlock(documentModel,blockConfig.name,index).update(index,function(blockModel){return blockModel.set("text",textPart)})}),documentModel}},{key:"_nodeToBlockModel",value:function(config,importableBlockTagNames,sharedParentTagNames,documentModel,node){var tagName=node.tagName;if(importableBlockTagNames.contains(tagName)){var blockConfig=_dom_helper2["default"].textBlockConfigForNode(config,node);return this._appendBlockModel(node,config,blockConfig,documentModel)}if(sharedParentTagNames.contains(tagName))return _lodash2["default"].reduce(node.childNodes,this._nodeToBlockModel.bind(this,config,importableBlockTagNames,sharedParentTagNames),documentModel);if(tagName&&!_dom_helper2["default"].textBlockTags.contains(tagName))return _lodash2["default"].reduce(node.childNodes,this._nodeToBlockModel.bind(this,config,importableBlockTagNames,sharedParentTagNames),documentModel);var blockConfig=config.textBlocks[config.defaultTextBlockType];return this._appendBlockModel({childNodes:[node]},config,blockConfig,documentModel)}},{key:"_appendBlockModel",value:function(node,config,blockConfig,documentModel){return documentModel.push(_dom_helper2["default"].externalDomToBlockModel(node,config,blockConfig))}}]),ClipboardHelper}();exports["default"]=ClipboardHelper,module.exports=exports["default"]},function(module,exports,__webpack_require__){"use strict";var _get=__webpack_require__(1)["default"],_inherits=__webpack_require__(9)["default"],_createClass=__webpack_require__(12)["default"],_classCallCheck=__webpack_require__(15)["default"],_interopRequireDefault=__webpack_require__(16)["default"];Object.defineProperty(exports,"__esModule",{value:!0});var _lodash=__webpack_require__(17),_lodash2=_interopRequireDefault(_lodash),_reactAddons=__webpack_require__(18),_reactAddons2=_interopRequireDefault(_reactAddons),_immutable=__webpack_require__(20),_immutable2=_interopRequireDefault(_immutable),_fusibleConfig=__webpack_require__(21),_fusibleConfig2=_interopRequireDefault(_fusibleConfig),_fusibleActionsCustom_block_actions=__webpack_require__(99),_fusibleActionsCustom_block_actions2=_interopRequireDefault(_fusibleActionsCustom_block_actions),CustomBlockContainer=function(_Component){function CustomBlockContainer(){_classCallCheck(this,CustomBlockContainer),_get(Object.getPrototypeOf(CustomBlockContainer.prototype),"constructor",this).apply(this,arguments)}return _inherits(CustomBlockContainer,_Component),_createClass(CustomBlockContainer,[{key:"shouldComponentUpdate",value:function(nextProps,nextState){var stateIsEqual=_lodash2["default"].isEqual(nextState,this.state),propsAreEqual=_lodash2["default"].isEqual(_lodash2["default"].omit(nextProps,"blockGroup"),_lodash2["default"].omit(this.props,"blockGroup")),documentModelsAreEqual=this.props.blockGroup.get("blockModel").deref().equals(nextProps.blockGroup.get("blockModel").deref());return!(documentModelsAreEqual&&propsAreEqual&&stateIsEqual)}},{key:"render",value:function(){var blockConfig=this.props.blockGroup.get("config"),blockId=this.props.blockGroup.getIn(["blockModel","id"]),blockProps=_lodash2["default"].extend({},this.props.childProps||{},{ref:blockId,config:this.props.config,actions:this.actionsForId(blockId),uniqueId:blockId,blockModel:this.props.blockGroup.get("blockModel"),documentContainerId:this.props.documentContainerId});return _reactAddons2["default"].createElement(blockConfig.component,blockProps)}},{key:"actionsForId",value:function(customBlockId){return{move:this.moveCustomBlock.bind(this,customBlockId),remove:this.deleteCustomBlock.bind(this,customBlockId),changeBlockType:this.changeCustomBlockType.bind(this,customBlockId),updateAttributes:this.updateCustomBlockAttributes.bind(this,customBlockId),createNewDefaultBlockAfter:this.createNewDefaultBlockAfter.bind(this,customBlockId),createNewDefaultBlockBefore:this.createNewDefaultBlockBefore.bind(this,customBlockId)}}},{key:"updateCustomBlockAttributes",value:function(customBlockId,newAttributes){_fusibleActionsCustom_block_actions2["default"].updateCustomBlock(this.props.documentContainerId,this.props.documentId,customBlockId,newAttributes)}},{key:"moveCustomBlock",value:function(customBlockId,direction){_fusibleActionsCustom_block_actions2["default"].moveCustomBlock(this.props.documentContainerId,this.props.documentId,customBlockId,direction)}},{key:"deleteCustomBlock",value:function(customBlockId){_fusibleActionsCustom_block_actions2["default"].deleteCustomBlock(this.props.documentContainerId,this.props.documentId,customBlockId)}},{key:"changeCustomBlockType",value:function(customBlockId,newBlockType){_fusibleActionsCustom_block_actions2["default"].changeCustomBlockType(this.props.documentContainerId,this.props.documentId,customBlockId,newBlockType)}},{key:"createNewDefaultBlockAfter",value:function(customBlockId){_fusibleActionsCustom_block_actions2["default"].createNewBlockAfterCustomBlock(this.props.documentContainerId,this.props.documentId,customBlockId)}},{key:"createNewDefaultBlockBefore",value:function(customBlockId){_fusibleActionsCustom_block_actions2["default"].createNewBlockBeforeCustomBlock(this.props.documentContainerId,this.props.documentId,customBlockId)}}],[{key:"displayName",value:"CustomBlockContainer",enumerable:!0},{key:"propTypes",value:{blockGroup:function(value){return value instanceof _immutable2["default"].Map},config:_reactAddons.PropTypes.instanceOf(_fusibleConfig2["default"]).isRequired,childProps:_reactAddons.PropTypes.object,documentContainerId:_reactAddons.PropTypes.string.isRequired,documentId:_reactAddons.PropTypes.string.isRequired},enumerable:!0}]),CustomBlockContainer}(_reactAddons.Component);exports["default"]=CustomBlockContainer,module.exports=exports["default"]},function(module,exports){module.exports={container:"fusible__document__container"}}])}),function(){var base;(base=this.Boundless).Fusible||(base.Fusible={})}.call(this),function(){Boundless.AtomSaver=function(){function AtomSaver(atom,saveEndpoint){this.atom=atom,this.saveEndpoint=saveEndpoint,this.saveTimeout=null,this.saving=!1,this.queuedSave=!1,this.queuedSaveOptions=null,this.timeoutDuration="test"===Boundless.ENV?500:5e3,this.original_save_attributes=this.atom.save_attributes(),this.last_save_attributes=this.atom.save_attributes(),session.current_user&&events.on("editor:changed",function(_this){return function(){return _this.saveTimeout&&clearTimeout(_this.saveTimeout),_this.saveTimeout=setTimeout(function(){return _this.save()},_this.timeoutDuration)}}(this))}return AtomSaver.prototype.queueSave=function(options){return null==options&&(options={}),this.queuedSave=!0,this.queuedSaveOptions=options},AtomSaver.prototype.checkQueuedSave=function(){return this.queuedSave&&this.internalSave(this.queuedSaveOptions),this.queuedSave=!1,this.queuedSaveOptions=null},AtomSaver.prototype.contentChangedSinceLoad=function(){return!_.isEqual(this.original_save_attributes,this.atom.save_attributes())},AtomSaver.prototype.atomChangedSinceLastSave=function(){return!_.isEqual(this.last_save_attributes,this.atom.save_attributes())},AtomSaver.prototype.save=function(options){return null==options&&(options={}),this.saveTimeout&&clearTimeout(this.saveTimeout),this.saving?this.queueSave(options):this.internalSave(options)},AtomSaver.prototype.internalSave=function(options){return null==options&&(options={}),this.saving=!0,events.trigger("editor:saving"),$.ajax({url:this.saveEndpoint,type:"PUT",dataType:"json",contentType:"application/json; charset=UTF-8",data:JSON.stringify({atom:this.atom.save_attributes()})}).done(function(_this){return function(data){return events.trigger("editor:saved"),_this.saving=!1,_this.last_save_attributes=_this.atom.save_attributes(),_this.checkQueuedSave(),null!=options&&"function"==typeof options.success?options.success(data):void 0}}(this)).fail(function(_this){return function(data){return events.trigger("editor:save_error"),_this.saving=!1,null!=options&&"function"==typeof options.error?options.error():void 0}}(this))},AtomSaver}()}.call(this),function(){Boundless.CSSEvent={_testSupportedProps:function(props){var el,i,j,len;for(el=document.createElement("div"),j=0,len=props.length;len>j;j++)if(i=props[j],props.hasOwnProperty(i)&&void 0!==el.style[i])return props[i]},transitionEndEventName:function(){return this._testSupportedProps({transition:"transitionend",OTransition:"otransitionend",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"})},animationEndEventName:function(){return this._testSupportedProps({animation:"animationend","-o-animation":"oAnimationEnd","-moz-animation":"animationend","-webkit-animation":"webkitAnimationEnd"})},onTransitionEnd:function(el,callback){return Boundless.Fusible.Events.once(el,this.transitionEndEventName(),function(){
return callback()})},onAnimationEnd:function(el,callback){return Boundless.Fusible.Events.once(el,this.animationEndEventName(),function(){return callback()})}}}.call(this),function(){this.Boundless.DesmosLoader={afterLoad:function(callback){return null!=window.Desmos?callback():(null==this.callbacks&&(this.callbacks=[]),this.callbacks.push(callback),this.loadDesmos())},loadDesmos:function(){var scriptNode;return this.loadingDesmos?void 0:(this.loadingDesmos=!0,scriptNode=document.createElement("script"),scriptNode.onload=this.desmosLoaded.bind(this),scriptNode.src="https://www.desmos.com/api/v0.4/calculator.js?apiKey=68ffbe651df5bb2531b8ff3e6bd76995",document.body.appendChild(scriptNode))},desmosLoaded:function(){var callback,i,len,ref,results;for(ref=this.callbacks,results=[],i=0,len=ref.length;len>i;i++)callback=ref[i],results.push(callback());return results}}}.call(this),function(){Boundless.Fusible||(Boundless.Fusible={}),Boundless.Fusible.Events={once:function(el,type,callback){var i,index,recursiveFunction,ref,results,typeArray;for(typeArray=type.split(" "),recursiveFunction=function(e){return e.target.removeEventListener(e.type,recursiveFunction),callback(e)},results=[],index=i=ref=typeArray.length;0>=ref?0>i:i>0;index=0>=ref?++i:--i)results.push(this.on(el,typeArray[index],recursiveFunction));return results},on:function(el,type,callback){return el.addEventListener?el.addEventListener(type,callback):el.attachEvent("on"+type,function(){return callback.call(el)})},off:function(el,type,callback){return el.removeEventListener?el.removeEventListener(type,callback):el.detachEvent("on"+type,callback)}}}.call(this),function(){this.Boundless.Licenses=function(){function Licenses(){}return Licenses.fetch=function(callback){if(this.list)return void callback(this.list);if(null==this.callbacks&&(this.callbacks=[]),this.callbacks.push(callback),!this.pending)return this.pending=!0,$.get(Boundless.API+"/licenses").done(function(_this){return function(response){return _this.license_list_fetched(_.map(response.data.results,function(license){return[license.id,license.name]}))}}(this)).fail(function(_this){return function(error){return _this.license_list_fetched([])}}(this))},Licenses.license_list_fetched=function(list){return this.list=list,_.each(this.callbacks,function(callback){return callback(list)}),this.callbacks=[],this.pending=!1},Licenses}()}.call(this),function(){Boundless.Fusible||(Boundless.Fusible={}),Boundless.Fusible.MidoHelpers={generate_unique_id:function(prefix){return null==prefix&&(prefix=""),""+prefix+Math.random().toString(36).substr(2,9)}}}.call(this),function(){React.Backbone={listenToProps:function(props){return _.each(this.updateOnProps,function(_this){return function(events,propName){switch(events){case"collection":events="add remove reset sort";break;case"model":events="change"}return _.each(events.split(" "),function(event){return _this.listenTo(props[propName],event,function(){return _this.forceUpdate(function(){return"function"==typeof _this.afterBackboneEvent?_this.afterBackboneEvent(event):void 0})})})}}(this))},componentDidMount:function(){return this.listenToProps(this.props)},componentWillReceiveProps:function(nextProps){return this.stopListening(),this.listenToProps(nextProps)},componentWillUnmount:function(){return this.stopListening()}},_.extend(React.Backbone,Backbone.Events)}.call(this),function(){Boundless.Spinner=React.createClass({getDefaultProps:function(){return{type:"spinner"}},render:function(){return React.createElement("i",{className:"icon-"+this.props.type+" icon-spin"})}})}.call(this),function(){var EquationEditor,EquationTag,Importer,classSet,doProcess,needsProcess,pendingScripts,process,timeout,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};classSet=React.addons.classSet,pendingScripts=[],needsProcess=!1,timeout=null,process=function(script,callback){return pendingScripts.push(script),needsProcess?void 0:(needsProcess=!0,timeout=setTimeout(doProcess,0,callback))},doProcess=function(callback){return MathJax.Hub.Queue(function(){var e,error,oldElementScripts;oldElementScripts=MathJax.Hub.elementScripts,MathJax.Hub.elementScripts=function(element){var scripts;return scripts=pendingScripts,pendingScripts=[],needsProcess=!1,scripts};try{return MathJax.Hub.Process(null,callback)}catch(error){throw e=error}finally{MathJax.Hub.elementScripts=oldElementScripts}})},EquationTag=React.createClass({displayName:"EquationTag",getDefaultProps:function(){return{onRender:function(){}}},componentDidMount:function(){return this.props.renderMode===Fusible.Config.RENDER_MODES.EDITING?(this.setScriptText(this.props.attributes.text),process(this.script,this.props.onRender)):ViewHelpers.typeset_equation(this.getDOMNode())},componentWillUnmount:function(){var ref;return null!=this.script&&null!=(ref=MathJax.Hub.getJaxFor(this.script))?ref.Remove():void 0},shouldComponentUpdate:function(nextProps,nextState){return!_.isEqual(nextProps,this.props)},componentDidUpdate:function(prevProps,prevState){return this.props.renderMode===Fusible.Config.RENDER_MODES.EDITING&&prevProps.attributes.text!==this.props.attributes.text?null!=this.script?MathJax.Hub.Queue(function(_this){return function(){var jax;return(jax=MathJax.Hub.getJaxFor(_this.script))?jax.Text(_this.props.attributes.text,_this.props.onRender):(_this.setScriptText(_this.props.attributes.text),process(_this.script,_this.props.onRender))}}(this)):(this.setScriptText(this.props.attributes.text),process(this.script,this.props.onRender)):void 0},render:function(){var classes;return classes=classSet({atom__components__customTag:!0,atom__components__customTag__selected:this.props.selected,atom__components__customTag__added:"add"===this.props.attributes.action,atom__components__customTag__removed:"delete"===this.props.attributes.action,atom__components__customTag__changed:"change"===this.props.attributes.action}),this.props.renderMode===Fusible.Config.RENDER_MODES.EDITING?React.createElement("equation",{className:classes,contentEditable:!1,"data-text":this.props.attributes.text,onMouseDown:this.props.showEditView},React.createElement("span",{ref:"mathjax"})):"diff"===this.props.mode?React.createElement("equation",{className:classes},"$"+this.props.attributes.text+"$"):React.createElement("equation",{},"$"+this.props.attributes.text+"$")},setScriptText:function(text){return null==this.script&&(this.script=document.createElement("script"),this.script.type="math/tex",this.refs.mathjax.getDOMNode().appendChild(this.script)),indexOf.call(this.script,"text")>=0?this.script.text=text:this.script.textContent=text}}),EquationEditor=React.createClass({displayName:"EquationEditor",getInitialState:function(){return{text:this.props.attributes.text||""}},componentDidMount:function(){var textarea;return textarea=this.refs.textarea.getDOMNode(),textarea.focus(),textarea.selectionStart=this.state.text.length,textarea.selectionEnd=this.state.text.length},render:function(){return React.createElement("div",{className:"atom__components__equation__editor"},React.createElement("textarea",{ref:"textarea",value:this.state.text,onChange:this.handleChange,onKeyUp:this.handleKeyUp,placeholder:"Write LaTeX here..."}),React.createElement("div",{className:"atom__components__equation__editor__buttons"},React.createElement("button",{onClick:this.props.cancelChange,className:"cancel"},"Cancel"),React.createElement("button",{onClick:this.handleClick,className:"submit"},"Save")))},handleKeyUp:function(event){switch(event.keyCode){case KeyCode.ESCAPE:return event.preventDefault(),this.props.cancelChange()}},handleClick:function(event){return this.props.commitChange(this.state)},handleChange:function(event){return this.setState({text:event.target.value})}}),Importer=function(node){var equation,match;if(equation=node.getAttribute("data-text"),(null!=equation?equation.length:void 0)||(match=/^[\s]?\${1,2}([\s\S]*)\${1,2}[\s]?$/.exec(node.textContent))&&(equation=match[1]),null!=equation?equation.length:void 0)return{tagType:"equation",attributes:{text:equation}};throw new Error("Could not import equation from node "+node+".\nPlease make sure the importer can import the following node content: '"+node.textContent+"' ")},this.Boundless.Equations={showView:EquationTag,editView:EquationEditor,importer:Importer}}.call(this),function(){this.Boundless||(this.Boundless={}),this.Boundless.LegacyFigureImporter=function(node){return{blockType:"figure",attributes:{mediaId:parseInt(node.getAttribute("id"))}}}}.call(this),function(){this.Boundless.AttributionEditor=React.createClass({displayName:"AttributionEditor",getInitialState:function(){return{typeOptions:[{value:"user_created",label:"This is my own image"},{value:"user_discovered",label:"This is an image from the internet"}],user_created:this.props.attribution.get("user_created"),user_created_agreement:this.props.attribution.get("user_created_agreement"),title:this.props.attribution.get("title"),name:this.props.attribution.get("name"),url:this.props.attribution.get("url"),license_id:this.props.attribution.get("license_id"),licenses:[],textEquivalent:this.props.textEquivalent,errors:{}}},componentDidMount:function(){return Boundless.Licenses.fetch(function(_this){return function(licenses){return _this.setState({licenses:licenses.map(function(license){return{value:""+license[0],label:license[1]}})})}}(this))},render:function(){var attribution_type,userCreatedAgreement,userCreatedSelector;return attribution_type=this.state.user_created?"user_created":"user_discovered",userCreatedSelector=null!=session.current_user?React.createElement(Boundless.RadioGroup,{name:"attribution_type",defaultValue:attribution_type,onChange:this.handleTypeChange,inputOptions:this.state.typeOptions}):void 0,userCreatedAgreement="user_created"===attribution_type?React.createElement("div",{className:"checkbox-group"},React.createElement("input",{id:"user_created_agreement",key:"user_created_agreement",type:"checkbox",name:"user_created_agreement",checked:this.state.user_created_agreement,onChange:this.handleConfirmationChange}),React.createElement("label",{htmlFor:"user_created_agreement"},React.createElement("span",{className:"group__span"}),React.createElement("span",{className:"group__wrapper"},"I verify that this is my own image and I agree to license it under CC BY-SA 4.0"))):React.createElement(Boundless.AttributionForm,{url:this.state.url,title:this.state.title,name:this.state.name,license_id:this.state.license_id,onChange:this.handleAttributionChange,licenses:this.state.licenses,errors:this.state.errors}),React.createElement("div",{key:"edit-attribution",className:"atom__components__attribute-editor"},React.createElement("div",{className:"atom__components__attribute-editor__overlay"}),React.createElement("div",{className:"atom__components__attribute-editor__cont"},React.createElement("h3",null,"Attribution"),React.createElement("p",null,"Proper attribution required for all media. ",React.createElement("span",{className:"atom__components__attribute-editor__subtext"},"You agree that you have permission to share this content.")),userCreatedSelector,userCreatedAgreement,React.createElement("h3",null,"Accessibility"),React.createElement("div",{className:"editor__attribute-editor__form"},React.createElement(Boundless.FormInput,{label:"Text Equivalent",type:"textarea",rows:4,autoComplete:"off",autoCapitalize:"sentences",spellCheck:"true",value:this.state.textEquivalent,error:this.state.errors.textEquivalent,placeholder:"Text-Only Description",inputKey:"textEquivalent-input",onChange:this.handleTextEquivalentChange}),React.createElement("p",null,"This is a text-only image description that includes all of the information necessary to understand the concept presented by the image. It will be surfaced to users navigating the site with a screen reader.")),React.createElement("div",{className:"atom__components__attribute-editor__buttons"},React.createElement("a",{href:"",onClick:this.handleCancel,key:"cancel-btn"},"Cancel"),React.createElement("a",{href:"",onClick:this.handleSave,key:"save-btn"},"Save"))))},handleTypeChange:function(event){return this.setState({user_created:"user_created"===event.target.value})},handleConfirmationChange:function(event){return this.setState({user_created_agreement:!this.state.user_created_agreement})},handleAttributionChange:function(field,value){var fields;return fields={},fields[field]=value,this.setState(fields)},handleCancel:function(event){return event.preventDefault(),this.props.onCancel()},handleTextEquivalentChange:function(event){var textEquivalent;return textEquivalent=event.target.value,textEquivalent=textEquivalent.replace(/\s+/g," "),""===textEquivalent&&(textEquivalent=null),this.setState({textEquivalent:textEquivalent})},handleSave:function(event){var newAttrs,tempAttribution,textEquivalent;return event.preventDefault(),newAttrs=_.pick(this.state,"user_created","user_created_agreement","url","name","title","license_id"),tempAttribution=new Boundless.FigureAttribution(newAttrs),textEquivalent=this.state.textEquivalent,tempAttribution.isValid()?(this.props.attribution.set(newAttrs),this.props.attribution.isNew()?this.props.attribution.save({},{success:function(_this){return function(model){return _this.props.onSave(model,textEquivalent)}}(this),error:function(_this){return function(error){return _this.setState({errors:_this.props.attribution.errors.errors})}}(this)}):this.props.onSave(this.props.attribution,textEquivalent)):this.setState({errors:tempAttribution.errors.errors})}})}.call(this),function(){this.Boundless.BlockControls=React.createClass({displayName:"BlockControls",render:function(){return React.createElement("div",{className:"atom__components__block__controls"},this.removeButton(),this.editButton(),this.moveButton("up"),this.moveButton("down"))},removeButton:function(){return null!=this.props.actions.remove?React.createElement("a",{href:"",className:"atom__components__image__controls-button",onClick:this.handleDelete},React.createElement("span",{className:"fusible__icons__delete"})):void 0},editButton:function(){return null!=this.props.actions.edit?React.createElement("a",{href:"",className:"atom__components__image__controls-button",onClick:this.handleEdit},React.createElement("span",{className:"fusible__icons__edit"})):void 0},moveButton:function(direction){return null!=this.props.actions.move?React.createElement("a",{href:"",className:"atom__components__image__controls-button",onClick:this.handleMove.bind(this,direction)},React.createElement("span",{className:"fusible__icons__arrow-"+direction})):void 0},handleDelete:function(event){return event.preventDefault(),this.props.actions.remove()},handleEdit:function(event){return event.preventDefault(),this.props.actions.edit()},handleMove:function(direction,event){return event.preventDefault(),this.props.actions.move(direction)}})}.call(this),function(){this.Boundless.DesmosGraph=React.createClass({displayName:"DesmosGraph",propTypes:{graph_state:React.PropTypes.string.isRequired,onChange:React.PropTypes.func.isRequired},shouldComponentUpdate:function(){return!1},render:function(){return React.createElement("div",{className:"atom__components__figure__graph-inner","data-graph-state":this.props.graph_state,"data-global-id":this.props.global_id},React.createElement("div",{ref:"loader",className:"atom__components__figure__loading-cont"},React.createElement(Boundless.Spinner,{type:"cog"})))},componentDidMount:function(){return Boundless.DesmosLoader.afterLoad(function(_this){return function(){return _this.refs.loader.getDOMNode().remove(),_this.calculator=Desmos.Calculator(_this.getDOMNode(),{menus:!0}),_this.calculator.setState(JSON.parse(_this.props.graph_state))}}(this)),$(this.getDOMNode()).typing({stop:function(_this){return function(event,$el){return _this.props.onChange(JSON.stringify(_this.calculator.getState()))}}(this)},{delay:2e3})}})}.call(this),function(){this.Boundless.TitleAndCaption=React.createClass({displayName:"TitleCaptionEditor",getInitialState:function(){return{config:Boundless.Fusible.figureTextConfig(this.props.mode)}},render:function(){return this.state.config.renderMode===Fusible.Config.RENDER_MODES.VIEWING?React.createElement(Fusible.DocumentContainer,{config:this.state.config,className:"atom__components__document",model:this.props.document,childProps:{mode:this.props.mode}}):React.createElement(Fusible.DocumentContainer,{config:this.state.config,className:"atom__components__document",model:this.props.document,onChange:this.props.onChange,onEnterAtEnd:this.props.actions.createNewDefaultBlockAfter,childProps:{mode:this.props.mode}})}})}.call(this);var Slider=React.createClass({displayName:"Slider",propTypes:{outerWidth:React.PropTypes.number,width:React.PropTypes.number.isRequired,leftwidth:React.PropTypes.number.isRequired,rightwidth:React.PropTypes.number.isRequired,leftNumber:React.PropTypes.number.isRequired,rightNumber:React.PropTypes.number,initialLeftNumber:React.PropTypes.number,initialRightNumber:React.PropTypes.number,scalingFunction:React.PropTypes.func,inverseScalingFunction:React.PropTypes.func,onSliderUpdate:React.PropTypes.func,onlyUpdateOnRelease:React.PropTypes.bool,unit:React.PropTypes.string,subset:React.PropTypes.bool},getDefaultProps:function(){return{unit:"",leftwidth:0,rightwidth:0,subset:!1,scalingFunction:function(x,constantBase){return Math.pow(x,2)/Math.pow(constantBase,2)},inverseScalingFunction:function(x,constantBase){return Math.sqrt(x)/Math.sqrt(constantBase)},onSliderUpdate:function(){}}},getInitialState:function(){return{left:0,right:0,leftNumber:this.props.leftNumber,rightNumber:this.props.rightNumber,storedState:void 0,storedNumber:this.props.leftNumber,leftActive:!1,rightActive:!1,isTouch:"ontouchstart"in document,sliderStartX:void 0,sliderEndX:void 0}},componentWillReceiveProps:function(nextProps){if(void 0===this.state.rightNumber||void 0===this.state.leftNumber){var stateObject={leftNumber:nextProps.leftNumber,rightNumber:nextProps.rightNumber};this.setState(stateObject)}},getOtherDirection:function(thisDirection){var directions=["left","right"],otherIndex=(directions.indexOf(thisDirection)+1)%2;return directions[otherIndex]},sliderUpdater:function(){this.props.onlyUpdateOnRelease&&(this.state.leftActive||this.state.rightActive)&&this.props.onSliderUpdate({leftNumber:this.state.leftNumber,rightNumber:this.state.rightNumber},!0),this.setState({leftActive:!1,rightActive:!1}),document.removeEventListener("mousemove",this.mouseDownHelper),document.removeEventListener("touchmove",this.mouseDownHelper)},componentDidMount:function(){document.addEventListener("mouseup",this.sliderUpdater),document.addEventListener("touchend",this.sliderUpdater);var stateObject={};stateObject.leftNumber=parseInt(this.props.initialLeftNumber||this.props.leftNumber,10);var setRightNumber;setRightNumber=this.props.initialRightNumber?Math.min(this.props.initialRightNumber,this.props.rightNumber):this.props.rightNumber,stateObject.rightNumber=parseInt(setRightNumber,10);var addedState=this.addPositionsFromNumbers(stateObject,this.props.rightNumber);this.setState(addedState)},componentWillUnmount:function(){document.removeEventListener("mouseup",this.sliderUpdater),document.removeEventListener("touchend",this.sliderUpdater)},moveConditionsMet:function(state){var leftWithinBounds=state.left>=0&&state.left<this.props.width,rightWithinBounds=state.right>=0&&state.right<this.props.width,leftNotCrossing=state.left+this.props.leftwidth<=this.props.width-state.right,rightNotCrossing=this.props.width-state.right-this.props.rightwidth>=state.left;return leftWithinBounds&&rightWithinBounds&&leftNotCrossing&&rightNotCrossing},typedConditionsMet:function(state){return state.leftNumber<=state.rightNumber},handleBlur:function(e){var stateObject={},targetClassName=e.target.className;""===e.target.value.substr(1)&&(stateObject[targetClassName]=this.state.storedNumber),this.setState(stateObject)},addPositionsFromNumbers:function(state,rightNumber){return rightNumber=rightNumber||this.props.rightNumber,state.left=Math.floor(this.props.inverseScalingFunction(state.leftNumber-this.props.leftNumber,rightNumber)*this.props.width),state.right=this.props.width-this.props.inverseScalingFunction(state.rightNumber,rightNumber)*this.props.width,state},buildNextState:function(updateDirection,updateLocation){var nextState={},otherDirection=this.getOtherDirection(updateDirection),updateLocation=Math.max(0,updateLocation),absoluteLocation="left"===updateDirection?updateLocation:this.props.width-updateLocation;return nextState[updateDirection]=updateLocation,nextState[updateDirection+"Number"]=Math.ceil(this.props.scalingFunction(absoluteLocation,this.props.width)*(this.props.rightNumber-this.props.leftNumber)+this.props.leftNumber),nextState[otherDirection]=this.state[otherDirection],nextState[otherDirection+"Number"]=this.state[otherDirection+"Number"],nextState},handleSliderClick:function(re){var clickX=re.clientX,sliderBar=this.refs.sliderBar.getDOMNode(),that=this,stateObject={};if(!this.state.sliderStartX&&!this.state.sliderEndX){var rect=sliderBar.getBoundingClientRect();stateObject.sliderStartX=rect.left,stateObject.sliderEndX=rect.left+rect.width}this.setState(stateObject,function(){var relativeClickX=clickX-that.state.sliderStartX,leftDistance=Math.abs(relativeClickX-that.state.left),rightDistance=Math.abs(relativeClickX-(that.props.width-that.state.right)),closer=rightDistance>leftDistance?"left":"right",updateLocation="left"===closer?relativeClickX:this.props.width-relativeClickX,nextState=that.buildNextState(closer,updateLocation);that.setState(nextState,function(){that.props.onSliderUpdate({leftNumber:nextState.leftNumber,rightNumber:nextState.rightNumber})})})},handleFocus:function(e){var stateObject={},targetClassName=e.target.className;targetClassName.match(/(\w+)Number/)[1],e.target.value;stateObject[targetClassName]="",stateObject.storedNumber=this.state[targetClassName],this.setState(stateObject)},handleChange:function(e){var stateObject={},targetClassName=e.target.className,direction=targetClassName.match(/(\w+)Number/)[1],otherDirection=this.getOtherDirection(direction),inputValue=e.target.value,truncate=this.props.unit.length,targetValue=">"===inputValue.charAt(0)?inputValue.substr(truncate+1):inputValue.substr(truncate);if(!(targetValue.match(/^\d+$/)&&targetValue<=this.props.rightNumber&&targetValue>=this.props.leftNumber))return""===targetValue?(stateObject[targetClassName]="",stateObject.storedNumber=this.state[targetClassName],void this.setState(stateObject)):void 0;stateObject[targetClassName]=parseInt(targetValue);var otherNumber=otherDirection+"Number";stateObject[otherNumber]=this.state[otherNumber],this.typedConditionsMet(stateObject)||(stateObject[otherNumber]=stateObject[targetClassName]),stateObject=this.addPositionsFromNumbers(stateObject),this.setState(stateObject),this.props.onSliderUpdate(stateObject,!0)},handleMouseMove:function(event,targetClass,initialX,originalPosition){var that=this;event.preventDefault();var newX=(that.state.isTouch?event.originalEvent.touches[0]:event).clientX,scaling="left"===targetClass?1:-1,nextState=(that.getOtherDirection(targetClass),that.buildNextState(targetClass,originalPosition+scaling*(newX-initialX)));that.moveConditionsMet(nextState)&&that.setState(nextState,function(){that.props.onlyUpdateOnRelease||that.props.onSliderUpdate({leftNumber:nextState.leftNumber,rightNumber:nextState.rightNumber})})},handleMouseDown:function(re){var targetClass=re.target.className.split(" ")[0],that=this,initialX=(this.state.isTouch?re.touches[0]:re).clientX,originalPosition=this.state[targetClass],activeState={};activeState[targetClass+"Active"]=!0,this.setState(activeState),this.mouseDownHelper=function(event){that.handleMouseMove(event,targetClass,initialX,originalPosition)},document.addEventListener("mousemove",this.mouseDownHelper),document.addEventListener("touchmove",this.mouseDownHelper)},render:function(){var leftActive=this.state.leftActive?"active":"",rightActive=this.state.rightActive?"active":"",rightUnit=this.state.rightNumber>=this.props.rightNumber&&this.props.subset?">"+this.props.unit:this.props.unit;return React.DOM.div({className:"slider-container clearfix",style:{width:this.props.outerWidth}},React.DOM.div({className:"numerical-container"},React.DOM.div({className:"numerical-left"},React.DOM.input({type:"text",className:"leftNumber",onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleChange,value:this.props.unit+this.state.leftNumber}))),React.DOM.div({className:"slider-control-container clearfix",style:{width:this.props.width}},React.DOM.div({className:"full-slider",ref:"sliderBar",onClick:this.handleSliderClick,style:{width:this.props.width}},React.DOM.div({className:"slider",style:{left:this.state.left,width:this.props.width-this.state.left-this.state.right}})),React.DOM.div({className:"handle-container clearfix",style:{width:this.props.width}},React.DOM.div({ref:"leftSlider",className:"left "+leftActive,style:{left:this.state.left},onTouchStart:this.handleMouseDown,onMouseDown:this.handleMouseDown}),React.DOM.div({ref:"rightSlider",className:"right "+rightActive,style:{right:this.state.right},onTouchStart:this.handleMouseDown,onTouchMove:this.handleTouchMove,onMouseDown:this.handleMouseDown}))),React.DOM.div({className:"numerical-container"},React.DOM.div({className:"numerical-right"},React.DOM.input({type:"text",className:"rightNumber",onFocus:this.handleFocus,onBlur:this.handleBlur,onChange:this.handleChange,value:rightUnit+this.state.rightNumber}))))}});(function(){this.Boundless.YouTubeEditor=React.createClass({displayName:"YouTubeEditor",getInitialState:function(){return{video_start:this.props.video_start||0,video_stop:this.props.video_stop||this.props.duration,width:400}},componentDidMount:function(){return this.isMounted()?this.setState({width:this.refs.slider.getDOMNode().offsetWidth-24}):void 0},render:function(){return React.createElement("div",{key:"edit-attribution",className:"atom__components__attribute-editor"},React.createElement("div",{className:"atom__components__attribute-editor__overlay"}),React.createElement("div",{className:"atom__components__attribute-editor__cont"},React.createElement("h3",null,"Set start and end points"),React.createElement(Slider,{ref:"slider",leftNumber:0,initialLeftNumber:this.state.video_start,rightNumber:this.props.duration,initialRightNumber:this.state.video_stop,width:this.state.width,leftwidth:12,rightwidth:12,onSliderUpdate:this.handleUpdate,scalingFunction:function(x,base){return x/base},inverseScalingFunction:function(x,base){return x/base}}),React.createElement("div",{className:"atom__components__attribute-editor__indicators"},React.createElement("span",{className:"atom__components__attribute-editor__indicators-left"},this.timestamp(this.state.video_start)),React.createElement("span",{className:"atom__components__attribute-editor__indicators-right"},this.timestamp(this.state.video_stop))),React.createElement("div",{className:"atom__components__attribute-editor__buttons"},React.createElement("a",{href:"",onClick:this.handleCancel,className:"cancel-btn"},"Cancel"),React.createElement("a",{href:"",onClick:this.handleSave,className:"save-btn"},"Save"))))},timestamp:function(number){var minute,second;return minute=Math.floor(number/60),second=""+number%60,1===second.length&&(second="0"+second),minute+"m "+second+"s"},handleUpdate:function(values){return this.setState({video_start:values.leftNumber,video_stop:values.rightNumber})},handleCancel:function(event){return event.preventDefault(),this.props.onCancel()},handleSave:function(event){return event.preventDefault(),this.props.onSave(_.pick(this.state,"video_start","video_stop"))}})}).call(this),function(){var CSSTransitionGroup,EmbedEditor,EmbedForm,EmbedPreview,EmbedView,base,classSet,ref,indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,(base=this.Boundless).Figures||(base.Figures={}),this.Boundless.Figures.Embed=React.createClass({displayName:"Embed",getInitialState:function(){return{error:null}},componentWillMount:function(){var embed,mediaId;if(mediaId=this.props.blockModel.getIn(["attributes","mediaId"])){if(embed=this.props.atom.get("media").get(mediaId))return this.setState({embed:embed});throw new Error("Could not find media information for figure with id "+mediaId+".\nPlease make sure the figure data is accessible at `window.atomData.media`.")}},render:function(){var childProps,ref1,ref2,ref3;switch(childProps=_.omit(this.props,"blockModel"),childProps.action=this.props.blockModel.getIn(["attributes","action"]),this.props.mode){case"edit":return(null!=(ref1=this.state)&&null!=(ref2=ref1.embed)?ref2.isNew():void 0)?(childProps.embed=this.state.embed,childProps.handleNo=this.handleBadPreview,childProps.handleYes=this.handleGoodPreview,React.createElement(EmbedPreview,React.__spread({},childProps))):null!=(null!=(ref3=this.state)?ref3.embed:void 0)?(childProps.embed=this.state.embed,childProps.onDocumentChange=this.handleDocumentChange,childProps.onAttributesChange=this.handleAttributesChange,React.createElement(EmbedEditor,React.__spread({},childProps))):(childProps.error=this.state.error,childProps.handleCreate=this.handleCreate,React.createElement(EmbedForm,React.__spread({},childProps)));default:return childProps.embed=this.state.embed,React.createElement(EmbedView,React.__spread({},childProps))}},handleCreate:function(embedCode){var embed;return embed=new Boundless.Embed({atom_id:this.props.atom.id}),embedCode.match(/^<.*>$/)?embed.set({embed_code:embedCode}):embed.set({url:embedCode}),embed.save({},{success:function(_this){return function(model){return"Link"===model.get("type")?_this.handleLink(model):_this.handleEmbed(model)}}(this),error:function(_this){return function(model,resp){var $code,errors,src;return errors=(null!=resp?resp.errors:void 0)||{},null!=errors.embed_code&&indexOf.call(errors.embed_code,"must use https")>=0?($code=$(embed.get("embed_code")),src=$code.attr("src").replace(/^http:/,""),$code.attr("src",src),embed.set({embed_code:$code[0].outerHTML}),_this.setState({embed:embed})):null!=errors.embed_code&&indexOf.call(errors.embed_code,"is not valid")>=0?($code=$(embed.get("embed_code")).html(""),embed.set({embed_code:$code[0].outerHTML}),_this.setState({embed:embed})):"photo"===errors.content_type&&"Invalid content type"===errors.message?_this.handleImage(errors):_this.setState({error:"The embed code you supplied either isn't supported or wasn't valid. Please make sure the code is correct or try pasting the url of the content you are trying to embed."})}}(this)})},handleEmbed:function(embed){return embed.set({document_mido:[{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"h2",text:embed.get("title")||""},{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"p",text:embed.get("caption")||""}]}),this.setState({embed:embed}),this.props.addMedia(embed),this.props.actions.updateAttributes({mediaId:embed.id})},handleLink:function(embed){var link;return link=new Boundless.Link(embed.attributes),link.set({document_mido:[{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"h2",text:link.get("title")||""},{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"p",text:link.get("caption")||""}]}),this.props.addMedia(link),this.props.actions.updateAttributes({mediaId:link.id}),this.props.actions.changeBlockType("link")},handleImage:function(errors){var image;return image=new Boundless.Image({atom_id:this.props.atom.id,source_url:errors.content_data.source_url,image_url:errors.content_data.image_url,document_mido:[{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"h2",text:errors.content_data.title},{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"p",text:errors.content_data.caption}],attribution_attributes:{user_created:!1,url:errors.content_data.source_url,name:errors.content_data.provider,title:errors.content_data.title}}),window.pendingImages.push(image),this.props.actions.updateAttributes({mediaCid:image.cid}),this.props.actions.changeBlockType("image")},handleBadPreview:function(){return this.setState({embed:null,error:null})},handleGoodPreview:function(){return this.handleCreate(this.state.embed.get("embed_code"))},handleDocumentChange:function(newDocument){return this.state.embed.set({document_mido:newDocument})},handleAttributesChange:function(newAttrs){return this.state.embed.set(newAttrs)}}),EmbedView=React.createClass({displayName:"EmbedView",
render:function(){var classes,viewerProps;return viewerProps=_.clone(this.props),viewerProps.key="viewer",viewerProps.uniqueId=this.props.embed.id,viewerProps.document=this.props.embed.get("document_mido"),classes=classSet({atom__components__figure__cont:!0,atom__components__added:"add"===this.props.embed.get("action")||"add"===this.props.action,atom__components__removed:"delete"===this.props.embed.get("action")||"delete"===this.props.action}),React.createElement("div",{className:"atom__components__figure embedly-embed","data-global-id":this.props.embed.get("global_id")},React.createElement("div",{className:classes},React.createElement("div",{className:"atom__components__figure__iframe-wrapper"},React.createElement("iframe",{src:this.props.embed.safe_embed_url(),width:"100%",height:this.props.embed.get("embed_height"),allowFullScreen:!0,scrolling:"no"})),React.createElement(Boundless.TitleAndCaption,React.__spread({},viewerProps))))}}),EmbedPreview=React.createClass({displayName:"EmbedPreview",shouldComponentUpdate:function(newProps,newState){return!(_.isEqual(newProps,this.props)&&_.isEqual(newState,this.state))},render:function(){return React.createElement("div",{className:"atom__components__figure atom__components__figure__embed embedly-embed"},React.createElement("div",{className:"atom__components__embed-preview__cont"},React.createElement("p",null,"We had to slightly modify your embed code to work on Boundless.",React.createElement("br",null),"Does the embedded content below look ok?"),React.createElement("p",{className:"atom__components__embed-preview__buttons"},React.createElement("a",{href:"",onClick:this.handleNo,className:"preview__no"},"No"),React.createElement("a",{href:"",onClick:this.handleYes,className:"preview__yes"},"Yes"))),React.createElement("span",{dangerouslySetInnerHTML:{__html:this.props.embed.get("embed_code")}}))},handleNo:function(event){return event.preventDefault(),this.props.handleNo()},handleYes:function(event){return event.preventDefault(),this.props.handleYes()}}),EmbedEditor=React.createClass({displayName:"EmbedEditor",getInitialState:function(){return{editing:!1,deleteRequested:!1}},shouldComponentUpdate:function(newProps,newState){return!(_.isEqual(newProps,this.props)&&_.isEqual(newState,this.state))},render:function(){var blockControlActions,classes,deleteConfirmation,editorProps,youtubeEditor;return editorProps=_.clone(this.props),editorProps.key="editor",editorProps.uniqueId=this.props.embed.cid,editorProps.document=this.props.embed.get("document_mido"),editorProps.onChange=this.props.onDocumentChange,blockControlActions=_.clone(this.props.actions),blockControlActions.remove=this.requestDelete,this.props.embed.is_youtube()&&this.props.embed.has_start_and_end_times()&&(blockControlActions.edit=this.handleEdit),deleteConfirmation=this.state.deleteRequested?React.createElement(Boundless.DeleteConfirmation,{itemName:"embed",onCancel:this.cancelDelete,onDelete:this.handleDelete}):void 0,youtubeEditor=this.state.editing?React.createElement(Boundless.YouTubeEditor,{video_start:this.props.embed.get("video_start"),video_stop:this.props.embed.get("video_stop"),duration:this.props.embed.get("duration"),onCancel:this.cancelEditing,onSave:this.handleEditSave}):void 0,classes=classSet({atom__components__figure__cont:!0,"atom__components__figure__cont-editing":this.state.editing,"atom__components__figure__cont-confirm-delete":this.state.deleteRequested}),React.createElement("div",{className:"atom__components__figure atom__components__figure__embed embedly-embed"},React.createElement("div",{className:classes},React.createElement("div",{className:"atom__components__figure__iframe-wrapper"},React.createElement("iframe",{src:this.props.embed.safe_embed_url(),width:"100%",height:this.props.embed.get("embed_height"),allowFullscreen:!0})),React.createElement(Boundless.TitleAndCaption,React.__spread({},editorProps)),React.createElement(Boundless.BlockControls,{key:"controls",actions:blockControlActions})),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},deleteConfirmation),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},youtubeEditor))},requestDelete:function(){return this.setState({deleteRequested:!0})},cancelDelete:function(){return this.setState({deleteRequested:!1})},handleDelete:function(){return this.props.actions.remove()},handleEdit:function(){return this.setState({editing:!0})},cancelEditing:function(){return this.setState({editing:!1})},handleEditSave:function(attributes){return this.setState({editing:!1}),this.props.onAttributesChange(attributes)}}),EmbedForm=React.createClass({displayName:"ImageForm",getInitialState:function(){return{disabled:!1}},componentWillReceiveProps:function(newProps){return null!=newProps.error?this.setState({disabled:!1}):void 0},render:function(){var buttonClasses,errorDisplay;return buttonClasses=classSet({"atom__components__figure__form-button":!0,"atom__components__figure__form-button__disabled":this.state.disabled}),errorDisplay=null!=this.props.error?React.createElement("div",{className:"atom__components__figure__form__error"},this.props.error):void 0,React.createElement("div",{className:"atom__components__figure__form atom__components__figure__form--embed"},React.createElement("div",{className:"atom__components__customBlock__indicator"},React.createElement("span",{className:"fusible__icons__embed"})),React.createElement("a",{href:"",className:"atom__components__figure__form-remove",onClick:this.handleDelete},"cancel"),React.createElement("div",{ref:"form",className:"atom__components__figure__form-cont"},React.createElement("button",{ref:"embedButton",onClick:this.handleSubmit,className:"atom__components__figure__form-button",disabled:this.state.disabled},"Create Embed"),React.createElement("div",{className:"atom__components__figure__form-input-cont"},React.createElement("input",{ref:"embedField",type:"text",disabled:this.state.disabled,className:"atom__components__figure__form-input",placeholder:"Paste your embed code here...",onKeyDown:this.handleKeyDown}))),errorDisplay)},handleKeyDown:function(event){return event.keyCode===KeyCode.ENTER?this.handleSubmit(event):void 0},handleSubmit:function(event){return this.state.disabled?void 0:(this.setState({disabled:!0,error:null}),event.preventDefault(),this.props.handleCreate(this.refs.embedField.getDOMNode().value.trim()))},handleDelete:function(event){return event.preventDefault(),this.props.actions.remove()}})}.call(this),function(){var CSSTransitionGroup,GraphEditor,GraphView,base,classSet,ref;(base=this.Boundless).Figures||(base.Figures={}),ref=React.addons,CSSTransitionGroup=ref.CSSTransitionGroup,classSet=ref.classSet,this.Boundless.Figures.Graph=React.createClass({displayName:"Graph",componentWillMount:function(){var graph,mediaId;if(mediaId=this.props.blockModel.getIn(["attributes","mediaId"])){if(graph=this.props.atom.get("media").get(mediaId))return this.setState({graph:graph});throw new Error("Could not find media information for graph with id "+mediaId+".\nPlease make sure the figure data is accessible at `window.atom.media`.")}return this.setState({graph:new Boundless.Graph({atom_id:this.props.atom.id,graph_state:"{}",document_mido:[{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"h2"},{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"p"}]})})},render:function(){var childProps;switch(childProps=_.omit(this.props,"blockModel"),childProps.graph=this.state.graph,childProps.action=this.props.blockModel.getIn(["attributes","action"]),this.props.mode){case"edit":return React.createElement(GraphEditor,React.__spread({},childProps));default:return React.createElement(GraphView,React.__spread({},childProps))}}}),GraphView=React.createClass({displayName:"GraphView",render:function(){var classes,viewerProps;return viewerProps=_.clone(this.props),viewerProps.key="viewer",viewerProps.uniqueId=this.props.graph.id,viewerProps.document=this.props.graph.get("document_mido"),classes=classSet({atom__components__figure__cont:!0,atom__components__added:"add"===this.props.graph.get("action")||"add"===this.props.action,atom__components__removed:"delete"===this.props.graph.get("action")||"delete"===this.props.action}),React.createElement("div",{className:"atom__components__figure atom__components__figure__graph","data-global-id":this.props.graph.get("global_id")},React.createElement("div",{className:classes},React.createElement(Boundless.DesmosGraph,{graph_state:this.props.graph.get("graph_state")}),React.createElement(Boundless.TitleAndCaption,React.__spread({},viewerProps))))}}),GraphEditor=React.createClass({displayName:"GraphEditor",getInitialState:function(){return{deleteRequested:!1}},render:function(){var blockControlActions,classes,deleteConfirmation,editorProps;return blockControlActions=_.clone(this.props.actions),blockControlActions.remove=this.requestDelete,editorProps=_.clone(this.props),editorProps.ref="editor",editorProps.key="editor",editorProps.uniqueId=this.props.graph.cid,editorProps.document=this.props.graph.get("document_mido"),editorProps.onChange=this.handleDocumentChange,classes=classSet({atom__components__figure__cont:!0,"atom__components__figure__cont-confirm-delete":this.state.deleteRequested}),deleteConfirmation=this.state.deleteRequested?React.createElement(Boundless.DeleteConfirmation,{itemName:"graph",onCancel:this.cancelDelete,onDelete:this.handleDelete}):void 0,React.createElement("div",{className:"atom__components__figure atom__components__figure__graph"},React.createElement("div",{className:classes},React.createElement(Boundless.DesmosGraph,{graph_state:this.props.graph.get("graph_state"),onChange:this.handleGraphChange}),React.createElement(Boundless.TitleAndCaption,React.__spread({},editorProps)),React.createElement(Boundless.BlockControls,{key:"controls",actions:blockControlActions})),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},deleteConfirmation))},componentDidMount:function(){return this.props.graph.isNew()?this.props.graph.save({},{success:function(_this){return function(model){return _this.props.addMedia(model),_this.props.actions.updateAttributes({mediaId:model.id})}}(this)}):void 0},requestDelete:function(){return this.setState({deleteRequested:!0})},cancelDelete:function(){return this.setState({deleteRequested:!1})},handleDelete:function(){return this.props.actions.remove()},handleGraphChange:function(newGraphState){return this.props.graph.set("graph_state",newGraphState)},handleDocumentChange:function(newDocument){return this.props.graph.set("document_mido",newDocument)}})}.call(this),function(){var CSSTransitionGroup,ImageEditor,ImageForm,ImageView,base,classSet,ref;ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,(base=this.Boundless).Figures||(base.Figures={}),this.Boundless.Figures.Image=React.createClass({displayName:"Image",componentWillMount:function(){var image,mediaCid,mediaId;if(mediaId=this.props.blockModel.getIn(["attributes","mediaId"])){if(image=this.props.atom.get("media").get(mediaId))return this.setState({image:image});throw new Error("Could not find media information for figure with id "+mediaId+".\nPlease make sure the figure data is accessible at `window.atom.media`.")}if(mediaCid=this.props.blockModel.getIn(["attributes","mediaCid"])){if(image=_.find(window.pendingImages,function(_this){return function(media){return media.cid===mediaCid}}(this)))return this.setState({image:image});throw new Error("Could not find media information for figure with cid "+mediaId+".\nPlease make sure the figure data is accessible at `window.atom.media`.")}},render:function(){var childProps,ref1,ref2;switch(childProps=_.omit(this.props,"blockModel"),null!=(null!=(ref1=this.state)?ref1.image:void 0)&&(childProps.image=this.state.image),childProps.action=this.props.blockModel.getIn(["attributes","action"]),this.props.mode){case"edit":return null!=(null!=(ref2=this.state)?ref2.image:void 0)?(childProps.onDocumentChange=this.handleDocumentChange,childProps.onAttributionChange=this.handleAttributionChange,childProps.onTextEquivalentChange=this.handleTextEquivalentChange,React.createElement(ImageEditor,React.__spread({},childProps))):(childProps.handleCreate=this.handleCreate,React.createElement(ImageForm,React.__spread({},childProps)));default:return React.createElement(ImageView,React.__spread({},childProps))}},handleCreate:function(event){return this.setState({image:new Boundless.Image({atom_id:this.props.atom.id,image_url:event.fpfile.url,document_mido:[{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"h2",text:event.fpfile.filename},{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"p",text:""}],attribution_attributes:{user_created:!1,title:event.fpfile.filename}})})},handleDocumentChange:function(newDocument){return this.state.image.set("document_mido",newDocument)},handleAttributionChange:function(attribution){return this.state.image.set("attribution",attribution),this.state.image.isNew()?this.state.image.save({},{success:function(_this){return function(model){return _this.props.addMedia(model),_this.props.actions.updateAttributes({mediaId:model.id})}}(this)}):void 0},handleTextEquivalentChange:function(textEquivalent){return this.state.image.set({text_equivalent:textEquivalent})}}),ImageView=React.createClass({displayName:"ImageView",render:function(){var ariaDescribedById,classes,textEquivalent,textEquivalentClass,viewerProps;return viewerProps=_.clone(this.props),viewerProps.key="viewer",viewerProps.uniqueId=this.props.image.id,viewerProps.document=this.props.image.get("document_mido"),classes=classSet({atom__components__figure__cont:!0,atom__components__added:"add"===this.props.image.get("action")||"add"===this.props.action,atom__components__removed:"delete"===this.props.image.get("action")||"delete"===this.props.action}),ariaDescribedById="image_"+this.props.image.id+"_text_equivalent",textEquivalentClass="atom__components__figure__text_equivalent","diff"===this.props.mode&&(textEquivalentClass+="_diff"),textEquivalent="diff"===this.props.mode?React.createElement("div",{id:ariaDescribedById,className:textEquivalentClass,dangerouslySetInnerHTML:{__html:this.props.image.get("text_equivalent")}}):React.createElement("div",{id:ariaDescribedById,className:textEquivalentClass},this.props.image.get("text_equivalent")),React.createElement("div",{className:"atom__components__figure","data-global-id":this.props.image.get("global_id")},React.createElement("div",{className:classes},React.createElement("img",{className:"atom__components__figure__image",key:"image",src:this.props.image.url_for("large"),"aria-describedby":ariaDescribedById}),React.createElement(Boundless.TitleAndCaption,React.__spread({},viewerProps)),textEquivalent))}}),ImageEditor=React.createClass({displayName:"ImageEditor",getInitialState:function(){return{editing:this.props.image.isNew(),deleteRequested:!1}},shouldComponentUpdate:function(newProps,newState){return!(_.isEqual(newProps,this.props)&&_.isEqual(newState,this.state))},render:function(){var attributionEditor,blockControlActions,classes,deleteConfirmation,editorProps;return editorProps=_.clone(this.props),editorProps.key="editor",editorProps.uniqueId=this.props.image.cid,editorProps.document=this.props.image.get("document_mido"),editorProps.onChange=this.props.onDocumentChange,blockControlActions=_.clone(this.props.actions),blockControlActions.edit=this.showEdit,blockControlActions.remove=this.requestDelete,deleteConfirmation=this.state.deleteRequested?React.createElement(Boundless.DeleteConfirmation,{itemName:"image",onCancel:this.cancelDelete,onDelete:this.handleDelete}):void 0,attributionEditor=this.state.editing?React.createElement(Boundless.AttributionEditor,{key:"attribution-editor",onCancel:this.cancelAttribution,onSave:this.saveAttributionAndTextEquivalent,attribution:this.props.image.get("attribution"),textEquivalent:this.props.image.get("text_equivalent")}):void 0,classes=classSet({atom__components__figure__cont:!0,"atom__components__figure__cont-editing":this.state.editing,"atom__components__figure__cont-confirm-delete":this.state.deleteRequested}),React.createElement("div",{className:"atom__components__figure atom__components__figure__image"},React.createElement("div",{className:classes},React.createElement("img",{key:"image",src:this.props.image.image_preview()}),React.createElement(Boundless.TitleAndCaption,React.__spread({},editorProps)),React.createElement(Boundless.BlockControls,{key:"controls",actions:blockControlActions})),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},deleteConfirmation),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},attributionEditor))},showEdit:function(){return this.setState({editing:!0})},requestDelete:function(){return this.setState({deleteRequested:!0})},cancelDelete:function(){return this.props.image.isNew()?this.setState({editing:!0,deleteRequested:!1}):this.setState({deleteRequested:!1})},handleDelete:function(){return this.props.actions.remove()},cancelAttribution:function(){return this.props.image.isNew()?this.setState({editing:!1,deleteRequested:!0}):this.setState({editing:!1})},saveAttributionAndTextEquivalent:function(attribution,textEquivalent){return this.setState({editing:!1}),this.props.onAttributionChange(attribution),this.props.onTextEquivalentChange(textEquivalent)}}),ImageForm=React.createClass({displayName:"ImageForm",shouldComponentUpdate:function(){return!1},componentDidMount:function(){var input;return input=this.refs.fileinput.getDOMNode(),input.onchange=this.props.handleCreate,filepicker.constructWidget(input)},render:function(){var input;return input=React.createElement("input",{ref:"fileinput",type:"filepicker-dragdrop","data-fp-apikey":"AArS0ISe9QVecggwgwC40z","data-fp-mimetype":"image/*","data-fp-button-text":"Choose An Image","data-fp-button-class":"atom__components__figure__form-fileinput","data-fp-drag-text":"&nbsp;&nbsp;&nbsp;...or drop an image here.","data-fp-drag-class":"atom__components__figure__form-dragdropzone"}),React.createElement("div",{className:"atom__components__figure__form atom__components__figure__form--image"},React.createElement("div",{className:"atom__components__customBlock__indicator"},React.createElement("span",{className:"fusible__icons__insert-image"})),React.createElement("a",{href:"",className:"atom__components__figure__form-remove",onClick:this.handleDelete},"cancel"),React.createElement("div",{ref:"form",className:"atom__components__figure__form-cont"},input))},handleDelete:function(event){return event.preventDefault(),this.props.actions.remove()}})}.call(this),function(){var CSSTransitionGroup,LinkDetailsEditor,LinkEditor,LinkForm,LinkView,base,classSet,ref;ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,(base=this.Boundless).Figures||(base.Figures={}),this.Boundless.Figures.Link=React.createClass({displayName:"Link",getInitialState:function(){return{error:null}},componentWillMount:function(){var link,mediaId;if(mediaId=this.props.blockModel.getIn(["attributes","mediaId"])){if(link=this.props.atom.get("media").get(mediaId))return this.setState({link:link});throw new Error("Could not find media information for figure with id "+mediaId+".\nPlease make sure the figure data is accessible at `window.atom.media`.")}},render:function(){var childProps,ref1,ref2;switch(childProps=_.omit(this.props,"blockModel"),null!=(null!=(ref1=this.state)?ref1.link:void 0)&&(childProps.link=this.state.link),childProps.action=this.props.blockModel.getIn(["attributes","action"]),this.props.mode){case"edit":return null!=(null!=(ref2=this.state)?ref2.link:void 0)?(childProps.onDocumentChange=this.handleDocumentChange,childProps.onAttributesChange=this.handleAttributesChange,React.createElement(LinkDetailsEditor,React.__spread({},childProps))):(childProps.error=this.state.error,childProps.handleCreate=this.handleCreate,React.createElement(LinkForm,React.__spread({},childProps)));default:return React.createElement(LinkView,React.__spread({},childProps))}},handleCreate:function(url){var link;return link=new Boundless.Link({atom_id:this.props.atom.id,url:url}),link.save({},{success:function(_this){return function(model){return link.set({document_mido:[{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"h2",text:link.get("title")||""},{id:Boundless.Fusible.MidoHelpers.generate_unique_id("media_"),blockType:"p",text:link.get("caption")||""}]}),_this.setState({link:link}),_this.props.addMedia(link),_this.props.actions.updateAttributes({mediaId:link.id})}}(this),error:function(_this){return function(model,resp){return _this.setState({error:"The link you supplied wasn't valid. Please make sure the link is correct."})}}(this)})},handleDocumentChange:function(newDocument){return this.state.link.set({document_mido:newDocument})},handleAttributesChange:function(newAttrs){return this.state.link.set(newAttrs)}}),LinkView=React.createClass({displayName:"LinkView",render:function(){var classes,viewerProps;return viewerProps=_.clone(this.props),viewerProps.key="viewer",viewerProps.uniqueId=this.props.link.id,viewerProps.document=this.props.link.get("document_mido"),classes=classSet({atom__components__figure__cont:!0,atom__components__added:"add"===this.props.link.get("action")||"add"===this.props.action,atom__components__removed:"delete"===this.props.link.get("action")||"delete"===this.props.action}),React.createElement("div",{className:"atom__components__figure","data-global-id":this.props.link.get("global_id")},React.createElement("div",{className:classes},React.createElement("a",{className:"embedded-link",href:this.props.link.get("link"),target:"_blank",rel:"nofollow"},React.createElement(Boundless.TitleAndCaption,React.__spread({},viewerProps)),React.createElement("div",{className:"chevron"},React.createElement("i",{className:"icon-angle-right"})))))}}),LinkDetailsEditor=React.createClass({displayName:"LinkDetailsEditor",getInitialState:function(){return{editing:!1,deleteRequested:!1}},shouldComponentUpdate:function(newProps,newState){return!(_.isEqual(newProps,this.props)&&_.isEqual(newState,this.state))},render:function(){var blockControlActions,classes,deleteConfirmation,editor,editorProps;return editorProps=_.clone(this.props),editorProps.key="editor",editorProps.uniqueId=this.props.link.cid,editorProps.document=this.props.link.get("document_mido"),editorProps.onChange=this.props.onDocumentChange,blockControlActions=_.clone(this.props.actions),blockControlActions.remove=this.requestDelete,blockControlActions.edit=this.handleEdit,deleteConfirmation=this.state.deleteRequested?React.createElement(Boundless.DeleteConfirmation,{itemName:"link",onCancel:this.cancelDelete,onDelete:this.handleDelete}):void 0,editor=this.state.editing?React.createElement(LinkEditor,{link:this.props.link,onCancel:this.cancelEditing,onSave:this.handleEditSave}):void 0,classes=classSet({atom__components__figure__cont:!0,"atom__components__figure__cont-editing":this.state.editing,"atom__components__figure__cont-confirm-delete":this.state.deleteRequested}),React.createElement("div",{className:"atom__components__figure atom__components__figure__link"},React.createElement("div",{className:classes},React.createElement(Boundless.TitleAndCaption,React.__spread({},editorProps)),React.createElement("a",{className:"atom__components__figure__link__anchor",href:this.props.link.get("link"),target:"_blank",rel:"nofollow"},React.createElement("i",{className:"icon-angle-right"})),React.createElement(Boundless.BlockControls,{key:"controls",actions:blockControlActions})),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},deleteConfirmation),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},editor))},requestDelete:function(){return this.setState({deleteRequested:!0})},cancelDelete:function(){return this.setState({deleteRequested:!1})},handleDelete:function(){return this.props.actions.remove()},handleEdit:function(){return this.setState({editing:!0})},cancelEditing:function(){return this.setState({editing:!1})},handleEditSave:function(attributes){return this.setState({editing:!1}),this.props.onAttributesChange(attributes)}}),LinkEditor=React.createClass({displayName:"LinkEditor",getInitialState:function(){return{link:this.props.link.get("link"),errors:{}}},render:function(){return React.createElement("div",{key:"edit-attribution",className:"atom__components__attribute-editor"},React.createElement("div",{className:"atom__components__attribute-editor__overlay"}),React.createElement("div",{className:"atom__components__attribute-editor__cont"},React.createElement("div",{className:"atom__components__attribute-editor__form"},React.createElement(Boundless.FormInput,{label:"Link URL",value:this.state.link,error:this.state.errors.link,placeholder:"e.g. http://en.wikipedia.org/Article_Title",onChange:this.handleLinkChange})),React.createElement("div",{className:"atom__components__attribute-editor__buttons"},React.createElement("a",{href:"",onClick:this.handleCancel,key:"cancel-btn"},"Cancel"),React.createElement("a",{href:"",onClick:this.handleSave,key:"save-btn"},"Save"))))},handleLinkChange:function(event){return this.setState({link:event.target.value})},handleCancel:function(event){return event.preventDefault(),this.props.onCancel()},handleSave:function(event){var testLink;return event.preventDefault(),testLink=new Boundless.Link(_.clone(this.props.link.attributes)),testLink.set({link:this.state.link}),testLink.isValid()?this.props.onSave({link:this.state.link}):this.setState({errors:this.props.errors.errors})}}),LinkForm=React.createClass({displayName:"LinkForm",getInitialState:function(){return{disabled:!1}},componentWillReceiveProps:function(newProps){return null!=newProps.error?this.setState({disabled:!1}):void 0},componentDidMount:function(){return this.refs.urlField.getDOMNode().focus()},render:function(){var buttonClasses,errorDisplay;return buttonClasses=classSet({"atom__components__figure__form-button":!0,"atom__components__figure__form-button__disabled":this.state.disabled}),errorDisplay=null!=this.props.error?React.createElement("div",{className:"atom__components__figure__form__error"},this.props.error):void 0,React.createElement("div",{className:"atom__components__figure__form atom__components__figure__form--link"},React.createElement("div",{className:"atom__components__customBlock__indicator"},React.createElement("span",{className:"fusible__icons__link"})),React.createElement("a",{href:"",className:"atom__components__figure__form-remove",onClick:this.handleDelete},"cancel"),React.createElement("div",{ref:"form",className:"atom__components__figure__form-cont"},React.createElement("button",{ref:"embedButton",onClick:this.handleSubmit,className:"atom__components__figure__form-button",disabled:this.state.disabled},"Create Link"),React.createElement("div",{className:"atom__components__figure__form-input-cont"},React.createElement("input",{ref:"urlField",type:"text",disabled:this.state.disabled,className:"atom__components__figure__form-input",placeholder:"Type your link URL here...",onKeyDown:this.handleKeyDown}))),errorDisplay)},handleKeyDown:function(event){return event.keyCode===KeyCode.ENTER?this.handleSubmit(event):void 0},handleSubmit:function(event){return this.state.disabled?void 0:(this.setState({disabled:!0,error:null}),event.preventDefault(),this.props.handleCreate(this.refs.urlField.getDOMNode().value.trim()))},handleDelete:function(event){return event.preventDefault(),this.props.actions.remove()}})}.call(this),function(){this.Boundless||(this.Boundless={}),Boundless.Anchor=React.createClass({displayName:"Anchor",render:function(){var attributes,dataAttributes,ref;return dataAttributes=_.reduce(null!=(ref=this.props.attributes)?ref.data:void 0,function(result,value,key){return result["data-"+key]=value,result},{}),attributes=_.extend(this.props.attributes,dataAttributes),delete attributes.data,React.createElement("a",React.__spread({},attributes),this.props.children)}})}.call(this),function(){var CSSTransitionGroup,findDOMNode;findDOMNode=React.findDOMNode,CSSTransitionGroup=React.addons.CSSTransitionGroup,this.Boundless||(this.Boundless={}),Boundless.KeyTermMention=React.createClass({displayName:"KeyTermMention",getInitialState:function(){return{showPopover:!1}},componentDidMount:function(){var evt,i,len,ref,results;for(ref=["mouseup","touchend"],results=[],i=0,len=ref.length;len>i;i++)evt=ref[i],results.push(document.addEventListener(evt,this.checkClickAway));return results},componentDidUpdate:function(){return"undefined"!=typeof MathJax&&null!==MathJax?MathJax.Hub.Queue(["Typeset",MathJax.Hub]):void 0},componentWillUnmount:function(){var evt,i,len,ref,results;for(ref=["mouseup","touchend"],results=[],i=0,len=ref.length;len>i;i++)evt=ref[i],results.push(document.removeEventListener(evt,this.checkClickAway));return results},render:function(){var atomKeyTermId,classes,definitionHtml,definitionPopover,partOfSpeech;return atomKeyTermId=this.props.attributes.id,definitionHtml=this.props.attributes.definitionHtml,partOfSpeech=this.props.attributes.partOfSpeech,definitionPopover=this.state.showPopover?React.createElement("div",{className:"keyterm__mention__popover"},React.createElement("div",{className:"popover__head"},React.createElement("span",{className:"popover__term"},this.props.children)," ",React.createElement("span",{className:"popover__part-of-speech"},"(",partOfSpeech,")")),React.createElement("div",{className:"process_math",dangerouslySetInnerHTML:{__html:definitionHtml}})):void 0,classes=classNames({keyterm__mention:!0,active:this.state.showPopover}),React.createElement("span",{className:classes,onClick:this.togglePopover},this.props.children,React.createElement(CSSTransitionGroup,{transitionName:"overlay"},definitionPopover))},togglePopover:function(evt){return evt.stopPropagation(),this.setState({showPopover:!this.state.showPopover})},hidePopover:function(){return this.setState({showPopover:!1})},checkClickAway:function(evt){var el;return el=findDOMNode(this),evt.target!==el&&!el.contains(evt.target)&&document.documentElement.contains(evt.target)?this.hidePopover():void 0}})}.call(this),function(){var classSet,diffableTextBlock,diffableTextTag;classSet=React.addons.classSet,diffableTextTag=function(tag,tagType){return React.createClass({displayName:"diffable-"+tag,render:function(){var classes;return classes=classSet({atom__components__textTag__added:"add"===this.props.attributes.action,atom__components__textTag__removed:"delete"===this.props.attributes.action,atom__components__textTag__changed:"change"===this.props.attributes.action}),React.createElement(tag,{className:classes},this.props.children)}})},diffableTextBlock=function(block,blockType){return React.createClass({displayName:"diffable-"+block,render:function(){var blockTypeChange,children,classes,note,oldBlockType,prettyBlockName;return children=this.props.children,blockTypeChange=_.find(this.props.attributes.changes||[],function(change){return"blockType"===change.path}),null!=blockTypeChange&&(oldBlockType=blockTypeChange.was,prettyBlockName=function(_this){return function(uglyBlockType){switch(uglyBlockType){case"ul_li":return"an unordered list item";case"ol_li":return"an ordered list item";case"p":return"a paragraph";default:return"a "+uglyBlockType.toUpperCase()}}}(this),note=React.createElement("div",{className:"change-note-container"},React.createElement("div",{className:"change-note"},"Changed to ",prettyBlockName(blockType)," from ",prettyBlockName(oldBlockType))),children=[].concat(children,[note])),classes=classSet({atom__components__textBlock__changed:null!=blockTypeChange,atom__components__textBlock__added:"add"===this.props.attributes.action,atom__components__textBlock__removed:"delete"===this.props.attributes.action}),React.createElement(block,{className:classes},children)}})},this.Boundless.Fusible.ConfigHelpers={addLegacyFigures:function(config){return config.registerCustomBlock("figure",{tagsToImport:["figref"],importer:Boundless.LegacyFigureImporter})},addEquations:function(config){return config.registerCustomTag("equation",{iconClass:"fusible__icons__insert-equation",tooltip:"Add an Equation",component:Boundless.Equations.showView,editComponent:Boundless.Equations.editView,editWidth:300,tagsToImport:["equation"],importer:Boundless.Equations.importer})},addImages:function(config){return config.registerCustomBlock("image",{tooltip:"Add an Image",nextBlockType:"p",iconClass:"fusible__icons__insert-image",component:Boundless.Figures.Image})},addGraphs:function(config){return config.registerCustomBlock("graph",{tooltip:"Add a Graph",nextBlockType:"p",iconClass:"fusible__icons__insert-graph",
component:Boundless.Figures.Graph})},addEmbeds:function(config){return config.registerCustomBlock("embed",{tooltip:"Embed Anything",nextBlockType:"p",iconClass:"fusible__icons__embed",component:Boundless.Figures.Embed})},addLinks:function(config){return config.registerCustomBlock("link",{tooltip:"Link Anything",nextBlockType:"p",iconClass:"fusible__icons__link",component:Boundless.Figures.Link})},addDiffs:function(config){return _.each(config.textTags,function(value,key){return value.component=diffableTextTag(value.component,value.name)}),_.each(config.textBlocks,function(value,key){return value.component=diffableTextBlock(value.component,value.name)}),config.registerTextTag("ins",{component:"ins",tagsToImport:["ins"]}),config.registerTextTag("del",{component:"del",tagsToImport:["del"]})},addHighlightables:function(config){return config.registerTextTag("highlightable",{component:Boundless.Highlightable,wrapsCustomTags:!0})},addAnchors:function(config){return config.registerTextTag("anchor",{component:Boundless.Anchor,tagsToImport:["a"]})},addKeyTermMentions:function(config,suppressKeyTermMentions){return suppressKeyTermMentions?config.registerTextTag("keyTermMention",{component:"span",wrapsCustomTags:!0}):config.registerTextTag("keyTermMention",{component:Boundless.KeyTermMention,wrapsCustomTags:!0})}}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,delete baseConfig.textBlocks.h1,delete baseConfig.textBlocks.h2,delete baseConfig.textBlocks.ol_li,delete baseConfig.textBlocks.ul_li,delete baseConfig.textBlocks.blockquote,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.briefConfig=function(mode,disableReadKeyTermMentions){var config;switch(null==disableReadKeyTermMentions&&(disableReadKeyTermMentions=!1),config=baseConfig.clone(),mode){case"edit":config.allowBlockMutation=!1,config.startingEmptyPlaceholder="Add a brief...",config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config);break;case"read":Boundless.Fusible.ConfigHelpers.addKeyTermMentions(config,disableReadKeyTermMentions),Boundless.Fusible.ConfigHelpers.addHighlightables(config)}return config}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,delete baseConfig.textBlocks.h1,delete baseConfig.textBlocks.h2,delete baseConfig.textBlocks.ol_li,delete baseConfig.textBlocks.ul_li,delete baseConfig.textBlocks.blockquote,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.definitionConfig=function(mode){var config;switch(config=baseConfig.clone(),mode){case"edit":config.allowBlockMutation=!1,config.startingEmptyPlaceholder="Add a definition...",config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config)}return config}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,delete baseConfig.textBlocks.h1,delete baseConfig.textBlocks.ol_li,delete baseConfig.textBlocks.ul_li,delete baseConfig.textBlocks.blockquote,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.figureTextConfig=function(mode,disableReadKeyTermMentions){var config;switch(null==disableReadKeyTermMentions&&(disableReadKeyTermMentions=!1),config=baseConfig.clone(),mode){case"edit":config.allowBlockMutation=!1,config.textBlocks.h2.placeholder="Add a title...",config.textBlocks.p.placeholder="Add a caption...",config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config);break;case"show":Boundless.Fusible.ConfigHelpers.addAnchors(config);break;case"read":Boundless.Fusible.ConfigHelpers.addKeyTermMentions(config,disableReadKeyTermMentions)}return config}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,delete baseConfig.textBlocks.h1,delete baseConfig.textBlocks.h2,delete baseConfig.textBlocks.ol_li,delete baseConfig.textBlocks.ul_li,delete baseConfig.textBlocks.blockquote,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.learningObjectiveConfig=function(mode,disableReadKeyTermMentions){var config;switch(null==disableReadKeyTermMentions&&(disableReadKeyTermMentions=!1),config=baseConfig.clone(),mode){case"edit":config.allowBlockMutation=!1,config.startingEmptyPlaceholder="Add a learning objective...",config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config);break;case"show":Boundless.Fusible.ConfigHelpers.addAnchors(config);break;case"read":Boundless.Fusible.ConfigHelpers.addKeyTermMentions(config,disableReadKeyTermMentions)}return config}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.ConfigHelpers.addLegacyFigures(baseConfig),Boundless.Fusible.legacyTextConfig=function(mode){var config;switch(config=baseConfig.clone(),mode){case"edit":config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config)}return config}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,delete baseConfig.textBlocks.h1,delete baseConfig.textBlocks.h2,delete baseConfig.textBlocks.p,delete baseConfig.textBlocks.ol_li,delete baseConfig.textBlocks.blockquote,baseConfig.textBlocks.ul_li["default"]=!0,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.listConfig=function(mode,disableReadKeyTermMentions){var config;switch(null==disableReadKeyTermMentions&&(disableReadKeyTermMentions=!1),config=baseConfig.clone(),mode){case"edit":config.startingEmptyPlaceholder="Add a new item...",config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config);break;case"show":Boundless.Fusible.ConfigHelpers.addAnchors(config);break;case"read":Boundless.Fusible.ConfigHelpers.addKeyTermMentions(config,disableReadKeyTermMentions),Boundless.Fusible.ConfigHelpers.addHighlightables(config)}return config}}.call(this),function(){var base,baseConfig;this.Boundless||(this.Boundless={}),(base=this.Boundless).Fusible||(base.Fusible={}),baseConfig=Fusible.Config["default"](),baseConfig.renderMode=Fusible.Config.RENDER_MODES.VIEWING,delete baseConfig.textTags.link,delete baseConfig.textTags.underline,delete baseConfig.textTags.strong,Boundless.Fusible.ConfigHelpers.addEquations(baseConfig),Boundless.Fusible.ConfigHelpers.addImages(baseConfig),Boundless.Fusible.ConfigHelpers.addGraphs(baseConfig),Boundless.Fusible.ConfigHelpers.addEmbeds(baseConfig),Boundless.Fusible.ConfigHelpers.addLinks(baseConfig),Boundless.Fusible.textConfig=function(mode,suppressKeyTermMentions){var config;switch(null==suppressKeyTermMentions&&(suppressKeyTermMentions=!1),config=baseConfig.clone(),mode){case"edit":config.renderMode=Fusible.Config.RENDER_MODES.EDITING;break;case"diff":Boundless.Fusible.ConfigHelpers.addDiffs(config);break;case"show":Boundless.Fusible.ConfigHelpers.addAnchors(config);break;case"read":Boundless.Fusible.ConfigHelpers.addKeyTermMentions(config,suppressKeyTermMentions),Boundless.Fusible.ConfigHelpers.addHighlightables(config)}return config}}.call(this),function(){this.Boundless||(this.Boundless={}),this.Boundless.AtomComponent=React.createClass({displayName:"AtomComponent",propTypes:{atom:React.PropTypes.instanceOf(Boundless.Atom).isRequired,mode:React.PropTypes.oneOf(["show","read","edit","diff"]).isRequired,childProps:React.PropTypes.object,disableReadKeyTermMentions:React.PropTypes.bool},componentWillMount:function(){switch(this.props.mode){case"edit":return this.props.atom.supports_feature("key_points")&&this.props.atom.get("key_points_mido").push({blockType:"ul_li",text:""}),this.props.atom.supports_feature("examples")&&this.props.atom.get("examples_mido").push({blockType:"ul_li",text:""}),this.props.atom.supports_feature("brief")&&0===this.props.atom.get("brief_mido").length&&this.props.atom.get("brief_mido").push({blockType:"p",text:""}),this.props.atom.supports_feature("text")&&0===this.props.atom.get("text_mido").length&&this.props.atom.get("text_mido").push({blockType:"p",text:""}),this.props.atom.get("learning_objectives").each(function(learning_objective){return 0===learning_objective.get("text_mido").length?learning_objective.get("text_mido").push({blockType:"p",text:""}):void 0}),this.props.atom.get("media").on("change add remove",function(_this){return function(){return _this.setDirty()}}(this)),this.props.atom.get("atom_key_terms").on("change add remove",function(_this){return function(){return _this.setDirty()}}(this)),this.props.atom.get("attributions").on("change add remove",function(_this){return function(){return _this.setDirty()}}(this)),this.props.atom.get("learning_objectives").on("change add remove",function(_this){return function(){return _this.setDirty()}}(this));case"read":return this.props.atom.attachHighlights(),this.props.atom.get("highlights").update_notebook_counts_on_change()}},render:function(){var brief,childProps,examples,keyPoints,keyTerms,learningObjectives,sources,text;return childProps=this.props.childProps||{},brief=this.shouldShowMido("brief")?React.createElement(Boundless.AtomPart,{title:"Brief",className:"atom__components__brief",model:this.props.atom.get("brief_mido"),config:this.briefConfig(),onChange:this.update.bind(this,"brief_mido"),childProps:_.extend({mode:this.props.mode,atom:this.props.atom,highlightType:"OneLinerHighlight"},childProps)}):void 0,learningObjectives=this.shouldShowRelation("learning_objectives")?React.createElement(Boundless.AtomPart,{title:"Learning Objective",className:"atom__components__learning-objectives",childProps:childProps},React.createElement(Boundless.LearningObjective.List,{ref:"learningObjectivesList",learningObjectives:this.props.atom.get("learning_objectives"),config:this.learningObjectiveConfig(),mode:this.props.mode,atom:this.props.atom})):void 0,keyPoints=this.shouldShowMido("key_points")?React.createElement(Boundless.AtomPart,{title:"Key Points",className:"atom__components__key-points",model:this.props.atom.get("key_points_mido"),config:this.listConfig(),onChange:this.update.bind(this,"key_points_mido"),childProps:_.extend({mode:this.props.mode,atom:this.props.atom,highlightType:"KeyPointHighlight"},childProps)}):void 0,keyTerms=this.shouldShowRelation("atom_key_terms")?React.createElement(Boundless.AtomPart,{title:"Key Terms",className:"atom__components__key-terms"},React.createElement(Boundless.AtomKeyTerm.List,{ref:"keyTermList",atomKeyTerms:this.props.atom.get("atom_key_terms"),mode:this.props.mode,childProps:childProps,highlightableProps:{atom:this.props.atom,highlightType:"KeyTermHighlight"}})):void 0,examples=this.shouldShowMido("examples")?React.createElement(Boundless.AtomPart,{title:"Examples",className:"atom__components__examples",model:this.props.atom.get("examples_mido"),config:this.listConfig(),onChange:this.update.bind(this,"examples_mido"),childProps:_.extend({mode:this.props.mode,atom:this.props.atom,highlightType:"ExampleHighlight"},childProps)}):void 0,text=this.shouldShowMido("text")?React.createElement(Boundless.AtomPart,{title:"Full Text",className:"atom__components__text",model:this.props.atom.get("text_mido"),config:this.textConfig(),onChange:this.update.bind(this,"text_mido"),childProps:_.extend({mode:this.props.mode,addMedia:this.addMedia,atom:this.props.atom,highlightType:"FullTextHighlight"},childProps)}):void 0,sources=this.shouldShowRelation("attributions")?React.createElement(Boundless.AtomPart,{title:"Sources",className:"atom__components__sources",collapsible:"read"===this.props.mode,startCollapsed:"read"===this.props.mode},React.createElement(Boundless.Sources.List,{sources:this.props.atom.get("attributions"),mode:this.props.mode,atom:this.props.atom,childProps:childProps})):void 0,React.createElement("div",{className:"atom__"+this.props.mode+" atom__components"},brief,learningObjectives,keyPoints,keyTerms,examples,text,sources)},briefConfig:function(){return Boundless.Fusible.briefConfig(this.props.mode,this.props.disableReadKeyTermMentions)},learningObjectiveConfig:function(){return Boundless.Fusible.learningObjectiveConfig(this.props.mode,this.props.disableReadKeyTermMentions)},listConfig:function(){return Boundless.Fusible.listConfig(this.props.mode,this.props.disableReadKeyTermMentions)},shouldShowRelation:function(relation){return this.props.atom.supports_feature(relation)&&!("edit"!==this.props.mode&&0===this.props.atom.get(relation).length)},shouldShowMido:function(name){return this.props.atom.supports_feature(name)&&!("edit"!==this.props.mode&&0===this.props.atom.get(name+"_mido").length)},textConfig:function(){var config;return config=Boundless.Fusible.textConfig(this.props.mode,this.props.disableReadKeyTermMentions),"edit"===this.props.mode&&config.registerCustomAction("add_key_term",{tooltip:"Create a new key term from the selected text",iconClass:"fusible__icons__keyterm",callback:this.addKeyTerm.bind(this)}),config},addKeyTerm:function(text){var keyterm;return keyterm=new Boundless.AtomKeyTerm({atom_id:this.props.atom.id,primary_term:text.trim()}),keyterm.save({},{success:function(_this){return function(model){return _this.props.atom.get("atom_key_terms").add(model),_this.setProps({atom:_this.props.atom},function(){return _this.refs.keyTermList.refs[model.id].refs.definition_editor.focus()})}}(this)})},addMedia:function(media){return this.props.atom.get("media").add(media)},update:function(field,value){return this.props.atom.set(field,value),this.setDirty()},setDirty:function(){return events.trigger("editor:changed")}})}.call(this),function(){var CSSTransitionGroup,base,classSet,ref;this.Boundless||(this.Boundless={}),(base=this.Boundless).AtomKeyTerm||(base.AtomKeyTerm={}),ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,this.Boundless.AtomKeyTerm.Editor=React.createClass({displayName:"KeyTermEditor",mixins:[React.Backbone],updateOnProps:{atomKeyTerm:"model"},getInitialState:function(){var config;return config=Boundless.Fusible.definitionConfig(this.props.mode),{partsOfSpeech:_.map(Boundless.AtomKeyTerm.parts_of_speech(),function(pos){return{value:pos,label:pos}}),deleteRequested:!1,definition_mido:this.props.atomKeyTerm.get("definition_mido")||[{blockType:"p",text:""}],config:config}},render:function(){var classes,definitionEditor,deleteConfirmation;return classes=classSet({"atom__components__key-term__cont":!0,"atom__components__key-term__delete-requested":this.state.deleteRequested}),deleteConfirmation=this.state.deleteRequested?React.createElement(Boundless.DeleteConfirmation,{itemName:"key term",onCancel:this.cancelDelete,onDelete:this.handleDelete}):void 0,definitionEditor=React.createElement(Fusible.DocumentContainer,{key:"editor",ref:"definition_editor",name:"key_term_definition_"+this.props.atomKeyTerm.id,model:this.state.definition_mido,config:this.state.config,onChange:this.attributeChanged.bind(this,"definition_mido"),className:"atom__components__document"}),React.createElement("li",{className:"atom__components__key-term"},React.createElement("div",{className:classes,key:"wrapper"},React.createElement("ul",{className:"atom__components__key-term__first-line"},React.createElement("li",{key:"primary_term",className:"atom__components__key-term__primary-term"},this.props.atomKeyTerm.get("primary_term")),React.createElement("li",{key:"part_of_speech"},React.createElement(Select,{name:"part_of_speech",placeholder:"Part of speech...",value:this.props.atomKeyTerm.get("part_of_speech"),options:this.state.partsOfSpeech,searchable:!0,clearable:!1,onChange:this.attributeChanged.bind(this,"part_of_speech")})),React.createElement("li",{key:"delete",className:"atom__components__key-term__delete"},React.createElement("a",{href:"",onClick:this.requestDelete},"delete"))),definitionEditor),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},deleteConfirmation))},attributeChanged:function(field,value){return this.props.atomKeyTerm.set(field,value)},requestDelete:function(event){return event.preventDefault(),this.setState({deleteRequested:!0})},cancelDelete:function(){return this.setState({deleteRequested:!1})},handleDelete:function(){var domNode;return domNode=this.getDOMNode(),domNode.style.height=domNode.offsetHeight+"px",this.props.handleDelete()}})}.call(this),function(){var CSSTransitionGroup,base;this.Boundless||(this.Boundless={}),(base=this.Boundless).AtomKeyTerm||(base.AtomKeyTerm={}),CSSTransitionGroup=React.addons.CSSTransitionGroup,this.Boundless.AtomKeyTerm.List=React.createClass({displayName:"KeyTermList",mixins:[React.Backbone],updateOnProps:{atomKeyTerms:"collection"},render:function(){var extraLine,keyTermViews;return keyTermViews=this.props.atomKeyTerms.map(function(_this){return function(atomKeyTerm){var atomKeyTermProps;switch(atomKeyTermProps={key:atomKeyTerm.id,ref:atomKeyTerm.id,atomKeyTerm:atomKeyTerm,primaryTerm:atomKeyTerm.get("primary_term"),partOfSpeech:_this.wrapDangerously(atomKeyTerm.get("part_of_speech")),mode:_this.props.mode},_this.props.mode){case"edit":return atomKeyTermProps.handleDelete=_this.handleDelete.bind(_this,atomKeyTerm.id),React.createElement(Boundless.AtomKeyTerm.Editor,React.__spread({},atomKeyTermProps));case"diff":return React.createElement(Boundless.AtomKeyTerm.View,React.__spread({},atomKeyTermProps));case"read":return atomKeyTermProps.highlightableProps=_this.props.highlightableProps,React.createElement(Boundless.AtomKeyTerm.View,React.__spread({},atomKeyTermProps))}}}(this)),extraLine="edit"===this.props.mode?React.createElement("li",{className:"atom__components__key-terms__explanation"},"To add additional key terms, select them in the full text and click the ",React.createElement("span",{className:"fusible__icons__keyterm-filled"})," button."):void 0,React.createElement(CSSTransitionGroup,{transitionName:"list-item-delete",component:"ul"},keyTermViews,extraLine)},handleDelete:function(id){return this.props.atomKeyTerms.remove(this.props.atomKeyTerms.get(id))},wrapDangerously:function(value){return"string"==typeof value?{__html:value}:value}})}.call(this),function(){var CSSTransitionGroup,base,classSet,ref;this.Boundless||(this.Boundless={}),(base=this.Boundless).AtomKeyTerm||(base.AtomKeyTerm={}),ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,this.Boundless.AtomKeyTerm.View=React.createClass({displayName:"KeyTermView",getInitialState:function(){var config;return config=Boundless.Fusible.definitionConfig(this.props.mode),{definition_mido:this.props.atomKeyTerm.get("definition_mido")||[{blockType:"p",text:""}],config:config}},render:function(){var classes,definitionProps,definitionView,keyTermView;return definitionProps={key:"view",ref:"definition_view",name:"key_term_definition_"+this.props.atomKeyTerm.id,model:this.state.definition_mido,config:this.state.config,className:"atom__components__document"},definitionView=React.createElement(Fusible.DocumentContainer,React.__spread({},definitionProps)),classes=classSet({"atom__components__key-term":!0,atom__components__added:"add"===this.props.atomKeyTerm.get("action"),atom__components__removed:"delete"===this.props.atomKeyTerm.get("action")}),keyTermView=React.createElement("li",{className:classes},React.createElement("div",{className:"atom__components__key-term__cont",key:"wrapper"},React.createElement("ul",{className:"atom__components__key-term__first-line"},React.createElement("li",{key:"primary_term",className:"atom__components__key-term__primary-term"},this.props.primaryTerm),React.createElement("li",{key:"part_of_speech",className:"atom__components__key-term__part-of-speech",dangerouslySetInnerHTML:this.props.partOfSpeech})),definitionView)),"read"===this.props.mode?React.createElement(Boundless.Highlightable,React.__spread({},this.props.highlightableProps,{atomKeyTermId:this.props.atomKeyTerm.id,attributes:{highlight:this.props.atomKeyTerm.get("highlight")},blockHighlight:!0}),keyTermView):keyTermView}})}.call(this),function(){var classSet;this.Boundless||(this.Boundless={}),classSet=React.addons.classSet,this.Boundless.AtomPart=React.createClass({displayName:"AtomPart",propTypes:{model:React.PropTypes.arrayOf(React.PropTypes.object),config:React.PropTypes.instanceOf(Fusible.Config),onChange:React.PropTypes.func,childProps:React.PropTypes.object,collapsible:React.PropTypes.bool,startCollapsed:React.PropTypes.bool},getInitialState:function(){return{collapsed:this.props.startCollapsed}},render:function(){var className,contentId,documentProps,innerContent,ref,title,titleClasses;return ref=this.props,title=ref.title,className=ref.className,innerContent=this.props.children?this.props.children:(documentProps=_.omit(this.props,"title","className"),documentProps.className="atom__components__document",React.createElement(Fusible.DocumentContainer,React.__spread({},documentProps))),titleClasses=classSet({atom__components__title:!0,collapsible:this.props.collapsible}),contentId=Math.random().toString(36).slice(2),React.createElement("div",{className:"atom__components__section "+className},React.createElement("h1",{className:titleClasses,onClick:this.toggleCollapsed,onKeyDown:function(_this){return function(e){var ref1;return(ref1=e.keyCode)===KeyCode.ENTER||ref1===KeyCode.SPACE?_this.toggleCollapsed():void 0}}(this),"aria-controls":contentId,"aria-expanded":this.props.collapsible?!this.state.collapsed:null,tabIndex:"0"},this.renderCollapseCaret()," ",title),React.createElement("section",{id:contentId,className:"atom__components__section__contents",ref:"content",role:"region",tabIndex:"0"},innerContent))},componentDidMount:function(){return this.props.startCollapsed?$(this.refs.content.getDOMNode()).hide():void 0},toggleCollapsed:function(){return this.props.collapsible?this.state.collapsed?(this.setState({collapsed:!1}),$(this.refs.content.getDOMNode()).slideDown(200).focus()):(this.setState({collapsed:!0}),$(this.refs.content.getDOMNode()).slideUp(200)):void 0},renderCollapseCaret:function(){var classes;return this.props.collapsible?(classes=classSet({"icon-caret-right":!0,"icon-rotate-90":!this.state.collapsed}),React.createElement("i",{className:classes})):void 0}})}.call(this),function(){this.Boundless.AttributionForm=React.createClass({displayName:"AttributionForm",render:function(){return React.createElement("div",{className:"editor__attribute-editor__form"},React.createElement(Boundless.FormInput,{label:"Source Link",value:this.props.url,error:this.props.errors.url,placeholder:"e.g. http://en.wikipedia.org/Article_Title",inputKey:"link-input",onChange:this.handleFormChange.bind(this,"url")}),React.createElement(Boundless.FormInput,{label:"Source Name",value:this.props.name,error:this.props.errors.name,placeholder:"e.g. Wikipedia",inputKey:"name-input",onChange:this.handleFormChange.bind(this,"name")}),React.createElement(Boundless.FormInput,{label:"Source Title",value:this.props.title,error:this.props.errors.title,placeholder:"e.g. A big blue ox",inputKey:"title-input",onChange:this.handleFormChange.bind(this,"title")}),React.createElement(Boundless.FormInput,{label:"License",type:"select",value:null!=this.props.license_id?""+this.props.license_id:void 0,error:this.props.errors.license_id,options:this.props.licenses,placeholder:"Select a license...",inputKey:"license-select",onChange:this.handleLicenseChange}))},handleFormChange:function(field,event){return this.props.onChange(field,event.target.value)},handleLicenseChange:function(newLicenseId){return this.props.onChange("license_id",parseInt(newLicenseId))}})}.call(this),function(){this.Boundless.DeleteConfirmation=React.createClass({displayName:"DeleteConfirmation",render:function(){return React.createElement("div",{key:"delete-confirm",className:"atom__components__delete-overlay"},React.createElement("div",{className:"atom__components__delete-cont"},React.createElement("p",null,"Are you sure you want to delete this ",this.props.itemName,"?"),React.createElement("div",{className:"atom__components__delete-cont__buttons"},React.createElement("a",{href:"",onClick:this.handleCancel,className:"cancel-delete"},"Cancel"),React.createElement("a",{href:"",onClick:this.handleDelete,className:"confirm-delete"},"Delete"))))},handleCancel:function(event){return event.preventDefault(),this.props.onCancel()},handleDelete:function(event){return event.preventDefault(),this.props.onDelete()}})}.call(this),function(){this.Boundless.FormInput=React.createClass({displayName:"TextInput",getInitialState:function(){return{type:this.props.type||"string"}},render:function(){var basicOptions,error,input;return error=null!=this.props.error?React.createElement("span",{className:"control-error"},React.createElement("span",{className:"fusible__icons__delete"}),this.props.error):void 0,basicOptions=_.pick(this.props,"name","placeholder","onChange","rows","cols","autoComplete","autoCapitalize","spellCheck"),basicOptions.key=this.props.inputKey,input=function(){switch(this.state.type){case"select":return basicOptions.options=this.props.options,this.props.options.length&&(basicOptions.value=this.props.value),React.createElement(Select,React.__spread({},basicOptions));case"string":return basicOptions.type="text",basicOptions.value=this.props.value,basicOptions.className=this.state.type,React.createElement("input",React.__spread({},basicOptions));case"textarea":return basicOptions.value=this.props.value,React.createElement("textarea",React.__spread({},basicOptions))}}.call(this),React.createElement("div",{className:"control-group "+this.state.type},React.createElement("label",{className:"control-label"},this.props.label),React.createElement("div",{className:"controls"},input,error))}})}.call(this),function(){this.Boundless||(this.Boundless={}),this.Boundless.HighlightControls=React.createClass({displayName:"HighlightControls",propTypes:{highlighted:React.PropTypes.bool.isRequired,note:React.PropTypes.string,setHighlight:React.PropTypes.func.isRequired},getInitialState:function(){return{show_note:!_.isEmpty(this.props.note)}},render:function(){var highlight_icon_class,highlight_label,note_control,note_icon_class,note_label;return highlight_icon_class="icon-highlight-action__highlight",highlight_label="Highlight",note_icon_class="icon-highlight-action__add-note",note_label="Add Note",this.props.highlighted&&(highlight_icon_class="icon-highlight-action__unhighlight",highlight_label="Un-highlight"),this.props.note&&(note_icon_class="icon-highlight-action__edit-note",note_label="Edit Note"),this.state.show_note&&(note_control=React.createElement("div",{className:"highlight-note"},React.createElement("div",{className:"highlight-note__form"},React.createElement("textarea",{className:"highlight-note__textarea",onChange:this.onNoteChanged,value:this.props.note}),React.createElement("div",{className:"highlight-note__disclaimer"},"Notes saved automatically. ",Boundless.HUMAN_INPUT_METHOD.capitalize()," anywhere to dismiss.")))),React.createElement("div",{className:"highlight-container "+(this.state.show_note?"editing-note":void 0),style:this.props.style},React.createElement("div",{className:"highlight-container__inner"},React.createElement("div",{className:"highlight-container__actions"},React.createElement("a",{className:"highlight-container__action",onClick:this.toggleHighlight},React.createElement("span",{className:"icon "+highlight_icon_class}),highlight_label),React.createElement("a",{className:"highlight-container__action",onClick:this.showNote},React.createElement("span",{className:"icon "+note_icon_class}),note_label)),note_control))},componentDidUpdate:function(){return this.state.show_note?$(".highlight-note__textarea").focus():void 0},toggleHighlight:function(evt){return this.props.setHighlight(!this.props.highlighted),this.props.hideHighlightTools()},showNote:function(evt){return this.setState({show_note:!0})},onNoteChanged:function(evt){var note_text;return note_text=evt.target.value,this.props.setHighlight(""!==note_text,note_text)}})}.call(this),function(){var CSSTransitionGroup;CSSTransitionGroup=React.addons.CSSTransitionGroup,this.Boundless||(this.Boundless={}),this.Boundless.Highlightable=React.createClass({displayName:"Highlightable",propTypes:{atom:React.PropTypes.instanceOf(Boundless.Atom).isRequired,createHighlight:React.PropTypes.func.isRequired,deleteHighlight:React.PropTypes.func.isRequired,highlightType:React.PropTypes.oneOf(["KeyPointHighlight","ExampleHighlight","KeyTermHighlight","FullTextHighlight","OneLinerHighlight"]).isRequired,blockId:React.PropTypes.string,atomKeyTermId:React.PropTypes.number,attributes:React.PropTypes.shape({highlight:React.PropTypes.instanceOf(Boundless.Highlight),highlightable_index:React.PropTypes.number})},getInitialState:function(){return{highlight:this.props.attributes.highlight,error:!1,show_highlight_controls:!1}},render:function(){var highlight_controls,note_indicator;return highlight_controls=this.state.show_highlight_controls?React.createElement(Boundless.HighlightControls,{setHighlight:this.setHighlight,highlighted:null!=this.state.highlight,hideHighlightTools:this.hideHighlightTools,note:this.getNote()}):void 0,note_indicator=""!==this.getNote()?React.createElement("span",{className:"book-content__highlight-note-indicator"},React.createElement("i",{className:"boundless-icon-blog"})):void 0,React.createElement("span",null,React.createElement("span",{className:this.getClasses(),onClick:this.showHighlightTools},this.props.children,React.createElement(CSSTransitionGroup,{transitionName:"overlay"},note_indicator)),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},highlight_controls))},showHighlightTools:function(evt){return evt.preventDefault(),this.setState({show_highlight_controls:!0}),$body.on("click.highlight",function(_this){return function(evt){return 0===$(".highlight-container").find(evt.target).length?_this.hideHighlightTools():void 0}}(this)),$(document).on("keyup.highlight",function(_this){return function(evt){return evt.keyCode===KeyCode.ESCAPE?_this.hideHighlightTools():void 0}}(this))},hideHighlightTools:function(note){return this.setState({show_highlight_controls:!1}),$body.off("click.highlight"),$body.off("keyup.highlight")},setHighlight:function(highlighted,note_text){var delay_save,highlight;return null==note_text&&(note_text=""),clearTimeout(this.state.delayed_save),highlighted?(delay_save=note_text!==this.getNote(),highlight=this.state.highlight||new Boundless.Highlight,highlight.set({note:note_text,mido_block_id:this.props.blockId,highlightable_index:this.props.attributes.highlightable_index,type:this.props.highlightType,atom_id:this.props.atom.id,commit_id:this.props.atom.get("commit_id"),atom_key_term_id:this.props.atomKeyTermId}),this.setState({highlight:highlight}),delay_save?this.state.delayed_save=setTimeout(function(_this){return function(){return _this.saveHighlight(highlight)}}(this),2e3):this.saveHighlight(highlight)):(this.state.highlight.destroy(),this.setState({highlight:null}))},saveHighlight:function(highlight){var add_after_save;return add_after_save=highlight.isNew(),highlight.save({},{success:function(_this){return function(model,resp){return _this.setState({error:!1}),add_after_save?_this.props.atom.get("highlights").add(model):void 0;
}}(this),error:function(_this){return function(model,resp){return _this.setState({error:!0,highlight:null}),alert("There was an error saving your highlight."),Boundless.Logger.log("Error saving highlight:",model,resp)}}(this)})},getClasses:function(){var classes;return classes="atom__components__highlightable",this.state.show_highlight_controls&&(classes+=" highlighting"),null!=this.state.highlight&&(classes+=" highlighted"),this.state.error&&(classes+=" highlightable--error"),this.props.blockHighlight&&(classes+=" highlightable--block"),classes},getNote:function(){var ref;return(null!=(ref=this.state.highlight)?ref.get("note"):void 0)||""}})}.call(this),function(){var CSSTransitionGroup,base,classSet,ref;this.Boundless||(this.Boundless={}),(base=this.Boundless).LearningObjective||(base.LearningObjective={}),ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,this.Boundless.LearningObjective.Editor=React.createClass({displayName:"LearningObjectiveEditor",mixins:[React.Backbone],updateOnProps:{learningObjective:"model"},getInitialState:function(){var config;return config=Boundless.Fusible.learningObjectiveConfig(this.props.mode),{text_mido:this.props.learningObjective.get("text_mido"),config:config}},render:function(){var textEditor;return textEditor=React.createElement(Fusible.DocumentContainer,{key:"editor",ref:"text_editor",name:"learning_objective_text_"+this.props.learningObjective.id,model:this.state.text_mido,config:this.state.config,onChange:this.handleChange,onDeleteWhenEmpty:this.handleDelete,className:"atom__components__document"}),React.createElement("li",{className:"atom__components__learning-objective"},textEditor)},handleChange:function(value){return this.props.learningObjective.set("text_mido",value)},handleDelete:function(){return this.props.handleDelete(this.props.learningObjective.id)}})}.call(this),function(){var CSSTransitionGroup,base;this.Boundless||(this.Boundless={}),(base=this.Boundless).LearningObjective||(base.LearningObjective={}),CSSTransitionGroup=React.addons.CSSTransitionGroup,this.Boundless.LearningObjective.List=React.createClass({displayName:"LearningObjectiveList",mixins:[React.Backbone],updateOnProps:{learningObjectives:"collection"},afterBackboneEvent:function(event){return"add"===event?this.refs[this.props.learningObjectives.last().id].refs.text_editor.focus():void 0},render:function(){var addLink,learningObjectiveViews;return learningObjectiveViews=this.props.learningObjectives.map(function(_this){return function(learningObjective){var learningObjectiveProps;return learningObjectiveProps={key:learningObjective.id,ref:learningObjective.id,learningObjective:learningObjective,mode:_this.props.mode},"edit"===_this.props.mode?(learningObjectiveProps.handleDelete=_this.handleDelete.bind(_this,learningObjective.id),React.createElement(Boundless.LearningObjective.Editor,React.__spread({},learningObjectiveProps))):React.createElement(Boundless.LearningObjective.View,React.__spread({},learningObjectiveProps))}}(this)),addLink="edit"===this.props.mode&&0===this.props.learningObjectives.size()?React.createElement("li",{key:"add-button",className:"atom__components__learning-objectives__add-button",key:"buttons"},React.createElement("button",{onClick:this.handleAdd},"Add a Learning Objective")):void 0,React.createElement(CSSTransitionGroup,{transitionName:"list-item-delete",component:"ul"},learningObjectiveViews,addLink)},handleDelete:function(id){return this.props.learningObjectives.remove(this.props.learningObjectives.get(id))},handleAdd:function(){var learningObjective;return learningObjective=new Boundless.LearningObjective({atom_id:this.props.atom.id,text_mido:[{blockType:"p",text:""}]}),learningObjective.save({},{success:function(_this){return function(model){return _this.props.learningObjectives.add(model)}}(this)})}})}.call(this),function(){var CSSTransitionGroup,base,classSet,ref;this.Boundless||(this.Boundless={}),(base=this.Boundless).LearningObjective||(base.LearningObjective={}),ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,this.Boundless.LearningObjective.View=React.createClass({displayName:"LearningObjectiveView",getInitialState:function(){var base1,config,text_mido;return config=Boundless.Fusible.learningObjectiveConfig(this.props.mode),text_mido=this.props.learningObjective.get("text_mido")||[],0===text_mido.length&&text_mido.push({blockType:"p",text:""}),(base1=text_mido[0]).textTags||(base1.textTags=[]),"add"===this.props.learningObjective.get("action")?(text_mido[0].textTags.push({tagType:"ins",startOffset:0,endOffset:text_mido[0].text.length}),_.each(text_mido[0].customTags,function(customTag){return customTag.attributes.action="add"})):"delete"===this.props.learningObjective.get("action")&&(text_mido[0].textTags.push({tagType:"del",startOffset:0,endOffset:text_mido[0].text.length}),_.each(text_mido[0].customTags,function(customTag){return customTag.attributes.action="remove"})),{text_mido:text_mido,config:config}},render:function(){var textView;return textView=React.createElement(Fusible.DocumentContainer,{key:"view",ref:"text_view",name:"learning_objective_text_"+this.props.learningObjective.id,model:this.state.text_mido,config:this.state.config,className:"atom__components__document",childProps:{mode:this.props.mode}}),React.createElement("li",{className:"atom__components__learning-objective"},textView)}})}.call(this),function(){this.Boundless.RadioGroup=React.createClass({displayName:"RadioGroup",getInitialState:function(){return{value:null}},render:function(){var defaultValue,inputs;return defaultValue=this.props.value||this.state.value||this.props.defaultValue,inputs=_.map(this.props.inputOptions,function(_this){return function(options){return React.createElement("li",{key:options.value},React.createElement("input",{id:options.value,name:_this.props.name,type:"radio",value:options.value,checked:options.value===defaultValue,onChange:_this.handleChange}),React.createElement("label",{htmlFor:options.value},React.createElement("span",{className:"group__span"},React.createElement("span",null)),options.label))}}(this)),React.createElement("ul",{className:"radio-group",onChange:this.handleChange},inputs)},handleChange:function(event){return this.setState({value:event.target.value}),this.props.onChange(event)},getRadios:function(){return this.getDOMNode().querySelectorAll('input[type="radio"]')},getCheckedValue:function(){var radios;return radios=this.getRadios(),_.each(radios,function(_this){return function(radio){return radio.checked?radio.value:void 0}}(this)),null}})}.call(this),function(){var CSSTransitionGroup,base,classSet,ref;this.Boundless||(this.Boundless={}),(base=this.Boundless).Sources||(base.Sources={}),ref=React.addons,classSet=ref.classSet,CSSTransitionGroup=ref.CSSTransitionGroup,this.Boundless.Sources.Editor=React.createClass({displayName:"SourceEditor",mixins:[React.Backbone],updateOnProps:{source:"model"},getInitialState:function(){return{editing:this.props.source.isNew(),deleteRequested:!1,title:this.props.source.get("title"),name:this.props.source.get("name"),url:this.props.source.get("url"),license_id:this.props.source.get("license_id"),licenses:[],errors:{}}},componentDidMount:function(){return Boundless.Licenses.fetch(function(_this){return function(licenses){return _this.setState({licenses:licenses.map(function(license){return{value:""+license[0],label:license[1]}})})}}(this))},render:function(){var classes,deleteConfirmation,editForm;return classes=classSet({atom__components__source__cont:!0,atom__components__source__editing:this.state.editing,"atom__components__source__delete-requested":this.state.deleteRequested}),deleteConfirmation=this.state.deleteRequested?React.createElement(Boundless.DeleteConfirmation,{itemName:"source",onCancel:this.cancelDelete,onDelete:this.handleDelete}):void 0,editForm=this.state.editing?React.createElement("div",{className:"atom__components__attribute-editor"},React.createElement("div",{className:"atom__components__attribute-editor__cont"},React.createElement(Boundless.AttributionForm,{url:this.state.url,title:this.state.title,name:this.state.name,license_id:this.state.license_id,onChange:this.handleAttributionChange,licenses:this.state.licenses,errors:this.state.errors}),React.createElement("div",{className:"atom__components__attribute-editor__buttons"},React.createElement("a",{href:"",onClick:this.handleEditCancel,key:"cancel-btn"},"Cancel"),React.createElement("a",{href:"",onClick:this.handleEditSave,key:"save-btn"},"Save")))):void 0,React.createElement("li",{className:"atom__components__source","data-source-id":this.props.source.id},React.createElement("div",{className:classes,key:"wrapper"},React.createElement("div",{className:"atom__components__source__first-line"},React.createElement("span",{className:"atom__components__source__title"},this.props.source.get("title"))),React.createElement("div",{className:"atom__components__source__second-line"},React.createElement("a",{className:"atom__components__source__url",href:this.props.source.get("url"),target:"_blank"},this.props.source.get("url"))),React.createElement("div",{className:"atom__components__source__third-line"},React.createElement("span",{className:"atom__components__source__name"},this.props.source.get("name")),React.createElement("span",{className:"atom__components__source__license"},this.licenseName())),React.createElement("div",{key:"buttons",className:"atom__components__source__buttons"},React.createElement("a",{href:"",onClick:this.startEditing,key:"edit-btn"},"edit"),React.createElement("a",{href:"",onClick:this.requestDelete,key:"delete-btn"},"delete"))),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},editForm),React.createElement(CSSTransitionGroup,{transitionName:"overlay"},deleteConfirmation))},licenseName:function(){var license;return license=_.find(this.state.licenses,function(_this){return function(license_info){return license_info.value===""+_this.props.source.get("license_id")}}(this)),null!=license?license.label:void 0},handleAttributionChange:function(field,value){var fields;return fields={},fields[field]=value,this.setState(fields)},handleEditSave:function(event){var newAttrs,tempSource;return event.preventDefault(),newAttrs=_.pick(this.state,"url","name","title","license_id"),tempSource=new Boundless.Attribution(newAttrs),tempSource.isValid()?(this.props.source.set(newAttrs),this.props.source.isNew()?this.props.source.save({},{success:function(_this){return function(model){return _this.props.handleSave(model),_this.setState({editing:!1})}}(this),error:function(_this){return function(error){return _this.setState({errors:_this.props.source.errors.errors})}}(this)}):this.setState({editing:!1})):this.setState({errors:tempSource.errors.errors})},startEditing:function(event){return event.preventDefault(),this.setState({editing:!0})},handleEditCancel:function(event){return event.preventDefault(),this.props.source.isNew()?this.handleDelete():this.setState({editing:!1,title:this.props.source.get("title"),name:this.props.source.get("name"),url:this.props.source.get("url"),license_id:this.props.source.get("license_id")})},requestDelete:function(event){return event.preventDefault(),this.setState({deleteRequested:!0})},cancelDelete:function(){return this.setState({deleteRequested:!1})},handleDelete:function(){var domNode;return domNode=this.getDOMNode(),domNode.style.height=domNode.offsetHeight+"px",this.props.handleDelete()}})}.call(this),function(){var CSSTransitionGroup,base;this.Boundless||(this.Boundless={}),(base=this.Boundless).Sources||(base.Sources={}),CSSTransitionGroup=React.addons.CSSTransitionGroup,this.Boundless.Sources.List=React.createClass({displayName:"SourceList",mixins:[React.Backbone],updateOnProps:{sources:"collection"},getInitialState:function(){return{newSource:null}},render:function(){var addLink,newSourceView,sourceProps,sourceViews;return sourceViews=this.props.sources.map(function(_this){return function(source){var sourceProps,source_url_href;return source_url_href=source.get("changes")&&source.get("changes").url?source.get("changes").url.right:source.get("url"),sourceProps={key:source.id,title:_this.wrapDangerously(source.get("title")),url:_this.wrapDangerously(source.get("url")),urlHref:source_url_href,name:_this.wrapDangerously(source.get("name")),licenseName:_this.wrapDangerously(source.get("license_name")),action:_this.wrapDangerously(source.get("action")),source:source,mode:_this.props.mode},"edit"===_this.props.mode?(sourceProps.handleSave=_this.handleSave,sourceProps.handleDelete=_this.handleDelete.bind(_this,source.id),React.createElement(Boundless.Sources.Editor,React.__spread({},sourceProps))):React.createElement(Boundless.Sources.View,React.__spread({},sourceProps))}}(this)),newSourceView=this.state.newSource?(sourceProps={handleSave:this.handleSave,handleDelete:function(_this){return function(){return _this.setState({newSource:null})}}(this),source:this.state.newSource,mode:this.props.mode},React.createElement(Boundless.Sources.Editor,React.__spread({},sourceProps))):void 0,addLink="edit"===this.props.mode?React.createElement("li",{key:"add-button",className:"atom__components__sources__add-button",key:"buttons"},React.createElement("button",{onClick:this.handleAdd},"Add a Source")):void 0,React.createElement(CSSTransitionGroup,{transitionName:"list-item-delete",component:"ul"},sourceViews,newSourceView,addLink)},wrapDangerously:function(value){return"string"==typeof value?{__html:value}:value},handleAdd:function(){return this.props.question?this.setState({newSource:new Boundless.Attribution({content_object_type:"Question",content_object_id:this.props.question.id})}):this.setState({newSource:new Boundless.Attribution({content_object_type:"Atom",content_object_id:this.props.atom.id})})},handleSave:function(source){return this.setState({newSource:null}),this.props.sources.add(source)},handleDelete:function(id){return this.props.sources.remove(this.props.sources.get(id))}})}.call(this),function(){var base,classSet;this.Boundless||(this.Boundless={}),(base=this.Boundless).Sources||(base.Sources={}),classSet=React.addons.classSet,this.Boundless.Sources.View=React.createClass({displayName:"SourceView",render:function(){var classes,title;return classes=classSet({atom__components__source__cont:!0,atom__components__source__added:"add"===this.props.action,atom__components__source__removed:"delete"===this.props.action}),title=this.props.title.length?React.createElement("div",{className:"atom__components__source__first-line"},React.createElement("span",{className:"atom__components__source__title",dangerouslySetInnerHTML:this.props.title})):void 0,React.createElement("li",{className:"atom__components__source"},React.createElement("div",{className:classes,key:"wrapper"},title,React.createElement("div",{className:"atom__components__source__second-line"},React.createElement("a",{className:"atom__components__source__url",href:this.props.urlHref,dangerouslySetInnerHTML:this.props.url})),React.createElement("div",{className:"atom__components__source__third-line"},React.createElement("span",{className:"atom__components__source__name",dangerouslySetInnerHTML:this.props.name}),React.createElement("span",{className:"atom__components__source__license",dangerouslySetInnerHTML:this.props.licenseName}))))}})}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.ReaderFrame.Controller=function(superClass){function Controller(){return this.on_click_frame_inner_link=bind(this.on_click_frame_inner_link,this),this.on_click_close_frame=bind(this.on_click_close_frame,this),Controller.__super__.constructor.apply(this,arguments)}return extend(Controller,superClass),Controller.prototype.el=".reader-frame",Controller.prototype.events={click:"hide_reader_frame"},Controller.prototype.initialize=function(params){return null==params&&(params={}),Controller.__super__.initialize.apply(this,arguments),this.reader_frame=params.reader_frame,this.target_url=params.target_url,this.frame_scope=$(".reader-frame__iframe")[0].contentWindow,this.show_reader_frame(),$(".reader-frame").off("reader-loaded").on("reader-loaded",function(_this){return function(){return _this.bind_frame_listeners()}}(this)),this},Controller.prototype.show_reader_frame=function(){return $(".reader-frame__iframe").attr("src",this.target_url),$(this.el).fadeIn(600,function(_this){return function(){return $(_this.el).removeClass("reader-frame--hidden").addClass("reader-frame--shown"),$("body").css("overflow","hidden")}}(this))},Controller.prototype.hide_reader_frame=function(){return $(this.el).fadeOut(300,function(_this){return function(){return $(_this.el).removeClass("reader-frame--shown").addClass("reader-frame--hidden"),$(".reader-frame__iframe").attr("src","about:blank"),$("body").css("overflow","visible")}}(this))},Controller.prototype.bind_frame_listeners=function(){return this.unbind_frame_listeners(),this.frame_scope.$("body").on("click",".reader-frame__close-btn",this.on_click_close_frame),this.frame_scope.$("body").on("click","a[parent-link=true]",this.on_click_frame_inner_link)},Controller.prototype.unbind_frame_listeners=function(){return this.frame_scope.$("body").off("click",".reader-frame__close-btn",this.on_click_close_frame),this.frame_scope.$("body").off("click","a[parent-link=true]",this.on_click_frame_inner_link)},Controller.prototype.on_click_close_frame=function(e){return this.hide_reader_frame()},Controller.prototype.on_click_frame_inner_link=function(e){return e.preventDefault(),Boundless.Logger.log("Forwarding reader link to parent frame.",e),this.hide_reader_frame(),window.location=$(e.currentTarget).attr("href")},Controller}(Boundless.Base.View)}.call(this),function(){Boundless.append_view_path("editor_wizzard/views"),Boundless.EditorWizzard={launch:function(link){var wizzard_step_els;return this.controller=new Boundless.EditorWizzard.Controller({editor_wizzard:this,action:link.data("editor-wizzard-action"),type:link.data("editor-wizzard-type"),edit_path:JSON.stringify(link.data("edit-path")),create_from_params:JSON.stringify(link.data("create-from-params")),assign_json:JSON.stringify(link.data("assign-json")),creator_json:JSON.stringify(link.data("creator-json"))}),this.controller.create_or_clone?(wizzard_step_els=[this.controller.$el],null==session.current_user&&(this.register_controller=new Boundless.Register.RegisterController({user_role:"educator",skip_role_selector:!1,conversion_event:!1}),this.register_controller.on("register:complete",function(_this){return function(){return _this.controller.render(),_this.wizzard.goto_step(2)}}(this)),wizzard_step_els.unshift(this.register_controller.$el)),this.wizzard=new Boundless.WizzardController({sidebar_template:this.controller.wizzard_sidebar||"default",step_els:wizzard_step_els}),this.wizzard.render(),null!=session.current_user?this.controller.render():void 0):void this.controller.redirect_to_edit_url()}},$(function(){return $(document).on("click","a[data-popup=editor_wizzard]",function(e){var event_name,event_namespace,finish_callback,link,properties,ref,track;return e.preventDefault(),link=$(e.currentTarget),finish_callback=function(_this){return function(){return Boundless.EditorWizzard.launch(link)}}(this),(track=link.data("editor-wizzard-track"))?(ref=track.split(":"),event_namespace=ref[0],event_name=ref[1],properties=link.data("editor-wizzard-track-properties-json")||{},Boundless.Events[event_namespace].track(event_name,properties,finish_callback)):finish_callback()})})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.EditorWizzard.Controller=function(superClass){function Controller(){return Controller.__super__.constructor.apply(this,arguments)}return extend(Controller,superClass),Controller.prototype.template="editor_wizzard_template",Controller.prototype.helper_methods=["content_label","assign_popup","assign_json","creator"],Controller.prototype.events={"click .editor-wizzard__step__assign-or-customize__ctas__assign":"hide","click .editor-wizzard__step__assign-or-customize__ctas__customize":"clicked_customize","click .editor-wizzard__step__name-custom-edit__body__ctas__cancel":"hide","click .editor-wizzard__step__name-custom-edit__body__ctas__submit":"submit_to_create_endpoint"},Controller.prototype.initialize=function(params){return null==params&&(params={}),Controller.__super__.initialize.apply(this,arguments),this.editor_wizzard=params.editor_wizzard,this.assign_json=params.assign_json,this.edit_path=JSON.parse(params.edit_path),this.create_from_params=JSON.parse(params.create_from_params),this.creator=null,params.creator_json&&(this.creator=new Boundless.User(JSON.parse(params.creator_json))),this.action=params.action,this.establish_action(),this},Controller.prototype.render=function(){return Controller.__super__.render.apply(this,arguments),this.goto_step(this.current_step),this.render_clone_notif()},Controller.prototype.establish_action=function(){switch(this.action){case"assign_quiz":return this.content_label="quiz",this.create_or_clone="clone",this.wizzard_sidebar="assign_quiz",this.current_step="assign-or-customize",this.assign_popup="assign_lesson";case"customize_quiz":return this.content_label="quiz",this.create_or_clone="clone",this.wizzard_sidebar="customize_quiz",this.current_step="name-custom-edit";case"edit_quiz":if(this.content_label="quiz",this.create_or_clone="clone",this.wizzard_sidebar="customize_quiz",this.current_step="name-custom-edit",this.creator&&session.current_user&&this.creator.id===session.current_user.id&&(this.create_or_clone=!1),session.current_user&&(session.current_user.is_super_edcurator()||session.current_user.is_admin()))return this.create_or_clone=!1;break;case"quiz_from_question":return this.content_label="quiz",this.create_or_clone="create",this.wizzard_sidebar="quiz_from_question",this.current_step="name-custom-edit";case"assign_book":return this.content_label="book",this.create_or_clone="clone",this.wizzard_sidebar="assign_book",this.current_step="assign-or-customize",this.assign_popup="course_editor";case"customize_book":return this.content_label="book",this.create_or_clone="clone",this.wizzard_sidebar="customize_book",this.current_step="name-custom-edit";case"edit_book":if(this.content_label="book",this.create_or_clone="clone",this.wizzard_sidebar="customize_book",this.current_step="name-custom-edit",this.creator&&session.current_user&&this.creator.id===session.current_user.id&&(this.create_or_clone=!1),session.current_user&&(session.current_user.is_super_edcurator()||session.current_user.is_admin()))return this.create_or_clone=!1;break;case"assign_book_to_lms_course":return this.content_label="book",this.create_or_clone="clone",this.wizzard_sidebar="assign_book_to_lms_course",this.current_step="assign-or-customize",this.assign_popup="assign_book_to_lms_course";default:return Boundless.Logger.error("Invalid action specified for editor_wizzard")}},Controller.prototype.hide=function(){return this.editor_wizzard.wizzard.hide()},Controller.prototype.goto_step=function(step){return $(".editor-wizzard__step--active",this.el).removeClass("editor-wizzard__step--active"),$(".editor-wizzard__step__"+step,this.el).addClass("editor-wizzard__step--active")},Controller.prototype.clicked_customize=function(){return this.current_step="name-custom-edit",this.goto_step(this.current_step)},Controller.prototype.redirect_to_edit_url=function(){return window.location=this.edit_path},Controller.prototype.submit_to_create_endpoint=function(){var new_name,new_object;return this.validate_input()?($(".editor-wizzard__step__name-custom-edit__body__ctas__submit").addClass("disabled"),new_name=$(".editor-wizzard__step__name-custom-edit__body__title-input").val(),"book"===this.content_label?(this.create_from_params.title=new_name,new_object=new Boundless.Book(this.create_from_params)):(this.create_from_params.name=new_name,new_object=new Boundless.Lesson(this.create_from_params)),new_object.save({},{success:function(_this){return function(model,response,options){return Boundless.Logger.log("New lesson/book created. Redirecting to edit mode."),window.location=response.edit_path}}(this),error:function(_this){return function(model,response,options){return Boundless.Logger.error("Save error: submit_to_create_endpoint")}}(this)})):void 0},Controller.prototype.validate_input=function(){return""!==$(".editor-wizzard__step__name-custom-edit__body__title-input").val()?($(".editor-wizzard__step__name-custom-edit__body__title-input__error").slideUp(100),!0):($(".editor-wizzard__step__name-custom-edit__body__title-input__error").slideDown(100),!1)},Controller.prototype.render_clone_notif=function(){return"clone"===this.create_or_clone&&this.creator.id!==session.current_user.id?($(".editor-wizzard__step__name-custom-edit__body__clone-notif .avatar-holder").html(this.creator.avatar_tag(22)),$(".editor-wizzard__step__name-custom-edit__body__clone-notif .lesson-creator-name").html(this.creator.name()),$(".editor-wizzard__step__name-custom-edit__body__clone-notif").show()):void 0},Controller}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["editor_wizzard/views/editor_wizzard_template"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='editor-wizzard steps__cont'>\n  <!-- /Step 1 -->\n  <div class='editor-wizzard__step editor-wizzard__step__assign-or-customize'>\n    <div class='editor-wizzard__step__assign-or-customize__body'>\n      Would you like to customize this "+this.content_label+" before you assign it?\n    </div>\n    <div class='editor-wizzard__step__assign-or-customize__ctas'>\n      <div class='btn btn-caps editor-wizzard__step__assign-or-customize__ctas__customize'>\n        Customize\n      </div>\n      <div class='editor-wizzard__step__assign-or-customize__ctas__divider'>\n        <div class='divider-hr'></div>\n        <div class='divider-text'>or</div>\n      </div>\n      <a class='btn btn-caps editor-wizzard__step__assign-or-customize__ctas__assign' data-popup='"+$e($c(this.assign_popup))+"' data-json='"+$e($c(this.assign_json))+"'>\n        Assign the "+this.content_label+" as is\n      </a>\n    </div>\n  </div>\n  <!-- /Step 2 -->\n  <div class='editor-wizzard__step editor-wizzard__step__name-custom-edit'>"),this.creator&&$o.push("    <div class='editor-wizzard__step__name-custom-edit__body__clone-notif'>\n      <div class='avatar-holder avatar-holder--22'></div>\n      <span class='lesson-creator-name'></span>\n      created this "+this.content_label+", and only they can edit it. You must first clone and rename it, then you may customize it as your own "+this.content_label+".\n    </div>"),$o.push("    <div class='editor-wizzard__step__name-custom-edit__header'>\n      <div class='content__meta'>\n        <div class='content__meta-icon'>"),"book"===this.content_label?$o.push("          <i class='boundless-icon-book'></i>"):$o.push("          <i class='boundless-icon-quiz'></i>"),$o.push("        </div>\n        <div class='content__meta-inner'>\n          <div class='content__meta-line'>\n            <span class='content__meta__type'>"+$c(this.content_label.capitalize())+"</span>\n            <span class='content__meta__version'>Version 1</span>\n          </div>\n          <div class='content__creator'>\n            <div class='avatar-holder avatar-holder--22'>"),$o.push("              "+$c(session.current_user.avatar_tag(22))),$o.push("            </div>\n            <span>\n              Customized by you\n            </span>\n          </div>\n        </div>\n      </div>\n    </div>\n    <div class='editor-wizzard__step__name-custom-edit__body'>\n      <div class='editor-wizzard__step__name-custom-edit__body__prompt'>\n        Create a name for your customized "+this.content_label+"\n      </div>\n      <input class='editor-wizzard__step__name-custom-edit__body__title-input' type='text' placeholder='Title of "+$e($c(this.content_label))+"...'>\n      <div class='editor-wizzard__step__name-custom-edit__body__title-input__error'>\n        <i class='boundless-icon-error'></i>\n        A new "+this.content_label+" title is required\n      </div>\n      <div class='editor-wizzard__step__name-custom-edit__body__ctas'>\n        <div class='btn editor-wizzard__step__name-custom-edit__body__ctas__cancel'>\n          Cancel\n        </div>\n        <div class='btn btn-green editor-wizzard__step__name-custom-edit__body__ctas__submit'>\n          <i class='icon-spin icon-spinner'></i>\n          Customize your "+this.content_label+"\n        </div>\n      </div>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var SelectionHelper;selectionchange.start(),rangy.init(),$(function(){return document.addEventListener("mousedown",function(evt){var $popup;return $popup=$(".sisyphus__selection-popup"),$popup.find(evt.target).length?void 0:$popup.animate({opacity:0,"margin-top":-15},{duration:100,complete:function(){return $(this).css({top:-9999})}})}),$(document).off("mouseup",".bcp-concept--content-area"),$(document).on("mouseup",".bcp-concept--content-area",function(evt){var $parent,$popup,box,sel;return $popup=$(".sisyphus__selection-popup"),$popup.length?($parent=$popup.parent(),sel=rangy.getSelection(),sel.isCollapsed?$popup.animate({opacity:0,"margin-top":-15},{duration:100,complete:function(){return $(this).css({top:-9999})}}):(box=SelectionHelper.selectionPositionWithinNode(sel,$parent[0]),$popup.css({top:box.top-40,left:(box.left+box.right)/2-$popup.outerWidth()/2}).animate({opacity:1,"margin-top":0},{duration:150}))):void 0})}),SelectionHelper={},SelectionHelper.getSelection=function(){return rangy.getSelection()},SelectionHelper.selectionIsWithinNode=function(selection,node){return this.isAncestorOf(node,selection.anchorNode)&&this.isAncestorOf(node,selection.focusNode)},SelectionHelper.isAncestorOf=function(ancestor,decendent){return null!=decendent&&rangy.dom.isAncestorOf(ancestor,decendent,!0)},SelectionHelper.selectionPositionWithinNode=function(selection,node){var basePosition;return basePosition=selection.isCollapsed?this.collapsedSelectionPosition(selection):selection.getRangeAt(0).nativeRange.getBoundingClientRect(),this.adjustPositionToNodeFrame(basePosition,node)},SelectionHelper.collapsedSelectionPosition=function(selection){var leftRect,rightRect;return leftRect=this.uncollapseSelectionAndGetPosition(selection,"left"),rightRect=this.uncollapseSelectionAndGetPosition(selection,"right"),0===leftRect.height?rightRect:0===rightRect.height?leftRect:leftRect.height>rightRect.height?rightRect:rightRect.height>leftRect.height?leftRect:rightRect.top>leftRect.top?rightRect:leftRect},SelectionHelper.uncollapseSelectionAndGetPosition=function(selection,direction){var existingRange,rect;return existingRange=selection.getRangeAt(0),selection.nativeSelection.modify("extend",direction,"character"),selection.refresh(),rect=selection.getRangeAt(0).nativeRange.getBoundingClientRect(),selection.setSingleRange(existingRange),{top:rect.top,left:"left"===direction?rect.right:rect.left,bottom:rect.bottom,right:"left"===direction?rect.right:rect.left,height:rect.height,width:rect.width}},SelectionHelper.adjustPositionToNodeFrame=function(position,node){var offsets;return offsets=node.getBoundingClientRect(),{top:position.top-offsets.top,left:position.left-offsets.left,right:position.right-offsets.left,bottom:position.bottom-offsets.top}},SelectionHelper.selectNode=function(node){var findFirstTextNode,findLastTextNode,firstNode,lastNode;return findFirstTextNode=function(node){return null!=node.tagName&&node.childNodes.length?findFirstTextNode(node.childNodes[0]):node},findLastTextNode=function(node){return null!=node.tagName&&node.childNodes.length?findLastTextNode(_.last(node.childNodes)):node},firstNode=findFirstTextNode(node),lastNode=findLastTextNode(node),this.createSelection(firstNode,0,lastNode,lastNode.textContent.length)},SelectionHelper.createSelection=function(startNode,startOffset,endNode,endOffset){
var range,selection;return range=rangy.createRange(),range.setStart(startNode,startOffset),range.setEnd(endNode,endOffset),selection=rangy.getSelection(),selection.setSingleRange(range),selectionchange.trigger(),selection}}.call(this),function(){boundless_module("TrackLinks"),TrackLinks.bind_elements=function(){var multiclick_timeout,prevent_multiple_clicks;return prevent_multiple_clicks=!1,multiclick_timeout=0,$(document).on("click","a[data-track]",function(evt){var $link,do_redirect,event_name,event_namespace,openedInNewTab,properties,ref;if(!prevent_multiple_clicks)return prevent_multiple_clicks=!0,clearTimeout(multiclick_timeout),multiclick_timeout=setTimeout(function(){return prevent_multiple_clicks=!1},500),openedInNewTab=evt.metaKey||evt.shiftKey||evt.ctrlKey,openedInNewTab||evt.preventDefault(),$link=$(evt.currentTarget),ref=$link.data("track").split(":"),event_namespace=ref[0],event_name=ref[1],properties=$link.data("track-properties-json")||{},do_redirect="false"!==$link.attr("data-track-do-redirect"),null==session.current_user&&"register"===$link.attr("data-popup")&&(do_redirect=!1),openedInNewTab&&(do_redirect=!1),window.wiselinks&&"true"===$link.attr("data-push")?Boundless.Events[event_namespace].track(event_name,properties):Boundless.Events[event_namespace].track(event_name,properties,function(){return do_redirect?location.href=$link.attr("href"):void 0})})},$(function(){return TrackLinks.bind_elements()})}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.IssueFetcher=function(superClass){function IssueFetcher(){return IssueFetcher.__super__.constructor.apply(this,arguments)}return extend(IssueFetcher,superClass),IssueFetcher.prototype.events={"click [data-subject-tag-id]":"on_select_subject","click [data-all-subjects]":"on_select_all_subjects","change .community__filters__state":"on_select_state","change .community__filters__order":"on_select_order","click .community__filters__creator":"on_select_show_only_my_feedback"},IssueFetcher.prototype.initialize=function(params){return IssueFetcher.__super__.initialize.apply(this,arguments),params.issue_container||alert("issue_container is required"),this.$issue_cont=$(params.issue_container),!this.fetch_local_storage_filters()&&params.filter_params&&this.set_filters(params.filter_params),this.set_page_controls(),this.fetch_issues(function(_this){return function(){return $(".community__content").removeClass("disabled")}}(this))},IssueFetcher.prototype.set_page_controls=function(){return this.update_subject_checkboxes(),this.update_state(),this.update_order(),this.update_my_feedback()},IssueFetcher.prototype.set_issue_filter=function(key,value,track){var filters;return null==track&&(track=!0),filters=this.get_filters(),filters[key]=value,value===!1&&delete filters[key],this.set_filters(filters),track?Boundless.Events.Community.track("applied_filter",{filter:key,filter_value:value}):void 0},IssueFetcher.prototype.fetch_local_storage_filters=function(){return JSON.parse(localStorage.getItem("issue_filters"))},IssueFetcher.prototype.set_filters=function(filters){return localStorage.setItem("issue_filters",JSON.stringify(filters))},IssueFetcher.prototype.get_filters=function(){return this.fetch_local_storage_filters()||{}},IssueFetcher.prototype.on_select_state=function(evt){var $target;return $target=$(evt.currentTarget),this.set_issue_filter("state",$target[0].value),this.fetch_issues()},IssueFetcher.prototype.on_select_order=function(evt){var $target;return $target=$(evt.currentTarget),this.set_issue_filter("order",$target[0].value),this.fetch_issues()},IssueFetcher.prototype.on_select_all_subjects=function(evt){var $target,selected;return $target=$(evt.currentTarget),$target.toggleClass("selected"),selected=$target.hasClass("selected"),this.set_issue_filter("subject_tag_ids",[],!1),this.set_issue_filter("show_all_subjects",selected),this.update_subject_checkboxes(),this.fetch_issues()},IssueFetcher.prototype.on_select_subject=function(evt){var $target,ids;return $target=$(evt.currentTarget),$target.toggleClass("selected"),ids=this.get_checked_subject_ids(),this.set_issue_filter("subject_tag_ids",ids),this.set_issue_filter("show_all_subjects",!1,!1),this.update_subject_checkboxes(),this.fetch_issues()},IssueFetcher.prototype.on_select_show_only_my_feedback=function(evt){var $target;return null==session.current_user&&alert("You must be logged in to use this feature."),$target=$(evt.currentTarget),$target.toggleClass("selected"),$target.hasClass("selected")?this.set_issue_filter("creator_id",session.current_user.id):this.set_issue_filter("creator_id",!1),this.fetch_issues()},IssueFetcher.prototype.get_checked_subject_ids=function(){return _.map(this.$(".selected[data-subject-tag-id]"),function(item){return $(item).data("subject-tag-id")})},IssueFetcher.prototype.update_order=function(){return $("select.community__filters__order").val(this.get_filters().order||"DESC")},IssueFetcher.prototype.update_state=function(){return $("select.community__filters__state").val(this.get_filters().state||"")},IssueFetcher.prototype.update_my_feedback=function(){return null!=this.get_filters().creator_id?this.$(".community__filters__creator").addClass("selected"):this.$(".community__filters__creator").removeClass("selected")},IssueFetcher.prototype.update_subject_checkboxes=function(){var i,id,len,ref,results;if(this.$("[data-subject-tag-id]").removeClass("selected"),this.$("[data-all-subjects]").toggleClass("selected",null!=this.get_filters().show_all_subjects),null!=this.get_filters().subject_tag_ids){for(ref=this.get_filters().subject_tag_ids,results=[],i=0,len=ref.length;len>i;i++)id=ref[i],results.push(this.$("[data-subject-tag-id="+id+"]").addClass("selected"));return results}},IssueFetcher.prototype.toggle_loading=function(state){return this.$issue_cont.toggleClass("loading",state)},IssueFetcher.prototype.fetch_issues=function(callback){return null==callback&&(callback=null),this.toggle_loading(!0),$.ajax({url:Boundless.API+"/issues",type:"GET",dataType:"json",contentType:"application/json",data:{as_html:!0,whitelist:!0,filter_params:this.get_filters()}}).done(function(_this){return function(data){return _this.$issue_cont.html(data.html),_this.toggle_loading(!1),"function"==typeof callback?callback():void 0}}(this))},IssueFetcher}(Backbone.View)}.call(this),function(){Boundless.Oauth||(Boundless.Oauth={}),Boundless.Oauth.authenticate=function(provider,params){var allow_create_user,auth_params,url,user;return null==params&&(params={}),Boundless.Oauth.register_callbacks(params),allow_create_user=params.allow_create_user!==!1,user=params.user,auth_params={},null!=user&&(auth_params=Boundless.Oauth.oauth_params(user)),auth_params.popup=!0,auth_params.allow_create_user=allow_create_user,url=Boundless.Oauth.provider_urls[provider],null==url?void Boundless.Oauth.fire_callback("error","unknown provider"):(url=Boundless.Oauth.add_params_to_url(url,auth_params),Boundless.Oauth.open_popup(provider,url))},Boundless.Oauth.open_popup=function(provider,url){var height,left,top,width;switch(provider){case"google":width=400,height=500;break;case"facebook":width=1e3,height=600;break;default:width=1e3,height=600}return left=screen.width/2-width/2,top=screen.height/2-height/2,window.open(url,"_blank","menubar=no,toolbar=no,status=no,width="+width+",height="+height+",toolbar=no,left="+left+",top="+top)},Boundless.Oauth.add_params_to_url=function(url,params){var url_params;return _.size(params)>0?(url+=url.indexOf("?")>=0?"&":"?",url_params=$.param(params,!0),""+url+url_params):url},Boundless.Oauth.register_callbacks=function(params){var base,error_callback,success_callback;return success_callback=params.success,error_callback=params.error,(base=Boundless.Oauth).callbacks||(base.callbacks={}),Boundless.Oauth.callbacks.success=[],Boundless.Oauth.callbacks.error=[],null!=success_callback&&Boundless.Oauth.callbacks.success.push(success_callback),null!=error_callback?Boundless.Oauth.callbacks.error.push(error_callback):void 0},Boundless.Oauth.successful_auth=function(user_data){var callbacks,ref,user;return user=new Boundless.User(user_data),callbacks=null!=(ref=Boundless.Oauth.callbacks)?ref.success:void 0,Boundless.Oauth.callbacks={},null!=callbacks?_.each(callbacks,function(_this){return function(callback){return callback(user)}}(this)):void 0},Boundless.Oauth.failed_auth=function(errors){var callbacks,ref;return callbacks=null!=(ref=Boundless.Oauth.callbacks)?ref.error:void 0,Boundless.Oauth.callbacks={},null!=callbacks?_.each(callbacks,function(_this){return function(callback){return callback(errors)}}(this)):void 0},Boundless.Oauth.oauth_params=function(user){return _.pick(user.attributes,"student","educator","expert")},Boundless.Oauth.provider_urls={google:"/users/auth/google_oauth2/",facebook:"/users/auth/facebook/"}}.call(this),function(){Boundless.Watcher||(Boundless.Watcher={}),Boundless.Watcher.App=function(){function App(params){var watcher_el,watcher_json;null==params&&(params={}),watcher_json=null!=params.json?params.json:params,watcher_el=null!=params.el?params.el:$(".content__meta__watch-button-container .content-button__wrapper"),params=_.extend({el:watcher_el},watcher_json),window.watch_button=new Boundless.Watcher.ButtonController(params)}return App}()}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Watcher.ButtonController=function(superClass){function ButtonController(){return this.remove_notification_subscription=bind(this.remove_notification_subscription,this),this.create_notification_subscription=bind(this.create_notification_subscription,this),ButtonController.__super__.constructor.apply(this,arguments)}return extend(ButtonController,superClass),ButtonController.prototype.events={"click .content-button":"clicked_watch_button","click .watch-toggle-button":"clicked_watch_button"},ButtonController.prototype.initialize=function(params){return null==params&&(params={}),ButtonController.__super__.initialize.apply(this,arguments),this.resource_id=params.resource_id,this.resource_type=params.resource_type,this.resource_name=params.resource_name,this.watch_count=params.watch_count,params.notification_subscription_id?(this.notification_subscription=new Boundless.NotificationSubscription({id:params.notification_subscription_id}),this.is_watched=!0):(this.notification_subscription=new Boundless.NotificationSubscription({resource_id:this.resource_id,resource_type:this.resource_type}),this.is_watched=!1),this.render(),this},ButtonController.prototype.render=function(){return this.$(".content-button__label").text(this.is_watched?"Unwatch":"Watch"),this.$(".content-button__count").text(numeral(this.watch_count).format("0,0")),this},ButtonController.prototype.create_notification_subscription=function(callback){return null==callback&&(callback=null),this.notification_subscription.save({},{success:function(_this){return function(model){return session.current_user.set_setting("has_watched_something",!0),_this.watch_count++,_this.is_watched=!0,_this.render(),"function"==typeof callback?callback(!0):void 0}}(this)})},ButtonController.prototype.remove_notification_subscription=function(callback){return null==callback&&(callback=null),this.notification_subscription.destroy({success:function(_this){return function(model){return _this.notification_subscription=new Boundless.NotificationSubscription({resource_id:_this.resource_id,resource_type:_this.resource_type}),_this.watch_count--,_this.is_watched=!1,_this.render(),"function"==typeof callback?callback(!1):void 0}}(this)})},ButtonController.prototype.clicked_watch_button=function(e){var ref;return"function"==typeof e.preventDefault&&e.preventDefault(),null!=session.current_user&&this.is_watched||Boundless.Events.Feature.track("clicked_watch",{registered:null!=session.current_user,first_time:null!=(null!=(ref=session.current_user)?ref.get_setting("has_watched_something"):void 0),resource_type:this.resource_name}),session.current_user?this.handle_click_once_registered():this.show_registration()},ButtonController.prototype.handle_click_once_registered=function(callback){return null==callback&&(callback=null),this.is_watched?this.remove_notification_subscription(callback):this.create_notification_subscription(callback)},ButtonController.prototype.show_registration=function(){var wizzard_options;return this.reg_controller=new Boundless.Register.RegisterController({user_role:"expert",skip_role_selector:!1,conversion_event:!1}),this.reg_controller.on("register:complete",function(_this){return function(){return _this.handle_click_once_registered(function(){return _this.wizzard.hide()})}}(this)),wizzard_options={starting_without_session:!0,sidebar_template:"watch_"+this.resource_name,step_els:[this.reg_controller.$el]},this.wizzard=new Boundless.WizzardController(wizzard_options),this.wizzard.render()},ButtonController.prototype.remove=function(){var ref;return ButtonController.__super__.remove.apply(this,arguments),null!=(ref=this.wizzard)?ref.remove():void 0},ButtonController}(Boundless.Base.View)}.call(this),function(){Boundless.append_view_path("favoriter/views"),Boundless.Favoriter||(Boundless.Favoriter={}),Boundless.Favoriter.App=function(){function App(params){null==params&&(params={}),params=_.extend({el:$(".content__meta__favorite-button-container .content-button__wrapper")},params),window.favorite_button_controller=new Boundless.Favoriter.ButtonController(params)}return App}()}.call(this),function(){var bind=function(fn,me){return function(){return fn.apply(me,arguments)}},extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Favoriter.ButtonController=function(superClass){function ButtonController(){return this.remove_favorite=bind(this.remove_favorite,this),this.create_favorite=bind(this.create_favorite,this),ButtonController.__super__.constructor.apply(this,arguments)}return extend(ButtonController,superClass),ButtonController.prototype.events={"click .content-button":"clicked_favorite_button"},ButtonController.prototype.initialize=function(params){return this.resource_id=params.resource_id,this.resource_type=params.resource_type,this.favorite_count=params.favorite_count,params.favorite_id?(this.favorite=new Boundless.Favorite({id:params.favorite_id}),this.is_favorite=!0):(this.favorite=new Boundless.Favorite({resource_id:this.resource_id,resource_type:this.resource_type}),this.is_favorite=!1),this.requires_reg=!session.logged_in(),this.show_onboarding=!session.logged_in()||!session.current_user.get_setting("saved_resource"),this.render(),this},ButtonController.prototype.render=function(){return this.$(".content-button__label").text(this.is_favorite?"Unfavorite":"Favorite"),this.$(".content-button__count").text(numeral(this.favorite_count).format("0,0")),this},ButtonController.prototype.create_favorite=function(callback){return null==callback&&(callback=null),this.favorite.save({},{success:function(_this){return function(model){return session.current_user.set_setting("saved_resource",!0),_this.show_onboarding=!1,_this.favorite_count++,_this.is_favorite=!0,_this.render(),"function"==typeof callback?callback(!0):void 0}}(this)})},ButtonController.prototype.remove_favorite=function(callback){return null==callback&&(callback=null),this.favorite.destroy({success:function(_this){return function(model){return _this.favorite_count--,_this.is_favorite=!1,_this.favorite.id=null,_this.render(),"function"==typeof callback?callback(!1):void 0}}(this)})},ButtonController.prototype.clicked_favorite_button=function(e){var extra_properties,track_properties;return track_properties={registered:null!=session.current_user,first_time:this.show_onboarding,resource_type:this.resource_type},null!=e&&(extra_properties=$(e.currentTarget).data("track-properties-json")||{},_.defaults(extra_properties,track_properties),track_properties=extra_properties),Boundless.Events.Feature.track("clicked_save_resource",track_properties),this.is_favorite?this.remove_favorite():this.show_onboarding?this.show_wizzard():this.create_favorite()},ButtonController.prototype.show_wizzard=function(){var wizzard_options;return wizzard_options={starting_without_session:null==session.current_user},this.requires_reg?(wizzard_options.sidebar_template="favorite_resource",this.reg_controller=new Boundless.Register.RegisterController({user_role:"educator",skip_role_selector:!1,conversion_event:!1}),this.reg_controller.on("register:complete",function(_this){return function(){var is_new_save;return is_new_save=!session.current_user.get_setting("saved_resource"),_this.create_favorite(function(){return is_new_save?(_this.orientation_controller.render(),_this.wizzard.goto_step(2)):_this.wizzard.hide()})}}(this))):wizzard_options.sidebar_template=!1,this.orientation_controller=new Boundless.Favoriter.OrientationController,this.orientation_controller.on("close",function(_this){return function(){return _this.wizzard.hide()}}(this)),this.requires_reg?wizzard_options.step_els=[this.reg_controller.$el,this.orientation_controller.$el]:wizzard_options.step_els=[this.orientation_controller.$el],this.wizzard=new Boundless.WizzardController(wizzard_options),this.requires_reg?this.wizzard.render():this.create_favorite(function(_this){return function(){return _this.wizzard.render()}}(this))},ButtonController.prototype.remove=function(){var ref;return ButtonController.__super__.remove.apply(this,arguments),null!=(ref=this.wizzard)?ref.remove():void 0},ButtonController}(Boundless.Base.View)}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.Favoriter.OrientationController=function(superClass){function OrientationController(){return OrientationController.__super__.constructor.apply(this,arguments)}return extend(OrientationController,superClass),OrientationController.prototype.template="favorite_orientation",OrientationController.prototype.events={"click .save-resource__dismiss-button":"dismiss_clicked"},OrientationController.prototype.initialize=function(options){return OrientationController.__super__.initialize.apply(this,arguments),this.render(),this},OrientationController.prototype.dismiss_clicked=function(e){return e.preventDefault(),this.trigger("close")},OrientationController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["favoriter/views/favorite_orientation"]=function(context){return function(){var $c,$e,$o;return $e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='create-assignment__cont steps__cont' data-step-count='"+$e($c(1))+"' data-current-step='"+$e($c(1))+"'>\n  <div class='steps__inner-cont'>\n    <div class='create-assignment__step-one steps__step'>\n      <div class='save-resource__wrapper'>\n        <h3>You've favorited your first resource</h3>\n        <div class='save-resource__tab-wrapper'>\n          <div class='save-resource__tab-inner-wrapper'>\n            <p>You can access your favorited Resources from the \"Books & Concepts\" and \"Quizzes & Questions\" tabs on your profile page.</p>"),session.current_user&&$o.push("            <a class='create-assignment__assignment-link' href='/users/"+$e($c(session.current_user.id))+"/'>\n              View your profile\n              <i class='icon-chevron-right'></i>\n            </a>"),$o.push("          </div>\n        </div>\n        <hr>\n        <a class='save-resource__dismiss-button'>\n          Continue browsing Boundless content and resources\n          <i class='icon-chevron-right'></i>\n        </a>\n      </div>\n    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.append_view_path("wizzard/views")}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebar_layout"]=function(context){return function(){var $c,$o;return $c=window.HAML.cleanValue,$o=[],$o.push("<div class='wizzard__modal__cont'>\n  <div class='wizzard__sidebar'>"),$o.push("    "+$c(this.sidebar_contents)),$o.push("  </div>\n  <div class='wizzard__main-panel'>"),$o.push("    "+$c(this.partial("wizzard_layout",this))),$o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/assign_book"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-book'></i>\n<hr>"),null!=session.current_user?$o.push("<h2>Assign this book to your class</h2>\n<p>Assigning a reading to your class is incredibly easy. You\u2019ll get a link to share with your students, and you'll be able to assign readings and quizzes that they can take from their own computer, tablet, or smartphone. You\u2019ll see their progress as they work on assignments.</p>"):$o.push("<h2>Sign up to assign this book to your class</h2>\n<p>Assigning a textbook to your class is simple. Once you sign up for Boundless, you\u2019ll receive a link to share with your students so they can access their textbook. You\u2019ll also have the ability to assign readings and quizzes your students can complete from their own computer, tablet, or smartphone. Plus, students\u2019 progress will be noted in your dashboard as they work on assignments.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/assign_book_to_lms_course"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-book'></i>\n<hr>\n  <h2>Assign this book to your class</h2>\n  <p>You can assign this book to any class in your LMS that doesn't already have a book. Once assigned, your students will be able to log in and start reading.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/assign_quiz"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-quiz'></i>\n<hr>"),null!=session.current_user?$o.push("<h2>Assign this quiz to your class</h2>\n<p>Once you assign this quiz it will automatically appear in your students' accounts. They'll be able to take the quiz from their computer, tablet, or smartphone. All quizzes are automatically graded for your ease.</p>"):$o.push("<h2>Sign up to assign this quiz to your class</h2>\n<p>Once you sign up and create a class, you can assign this quiz to your students. It will automatically appear in your students' accounts and they'll be able to take the quiz from their computer, tablet, or smartphone. All quizzes are automatically graded for your ease.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/assign_reading"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-reading'></i>\n<hr>"),null!=session.current_user?$o.push("<h2>Assign this reading to your class</h2>\n<p>Assigning a reading to your class is incredibly easy. You\u2019ll get a link to share with your students, and they\u2019ll be able to easily complete the reading from their own computer, tablet, or smartphone. You\u2019ll see their progress as they work on the assignment, and you\u2019ll be able to easily assign quizzes and readings to the same group of students in the future.</p>"):$o.push("<h2>Sign up to assign this reading to your class</h2>\n<p>Assigning a reading to your class is simple. Once you sign up for Boundless, you\u2019ll receive a link to share with your students so they can complete the reading from their own computers, tablets, or smartphones. You\u2019ll see students\u2019 progress as they work on the assignment, plus you can easily assign quizzes and readings to the same group again through Boundless.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/customize_book"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-book'></i>\n<hr>"),null!=session.current_user?$o.push("<h2>Customize this book</h2>\n<p>Customizing a book is made simple with our easy to use book editor. Simply drag and drop to rearrange chapters and sections or drag and drop content from other subjects to add to your textbook.</p>"):$o.push("<h2>Register to customize this book</h2>\n<p>After registering you\u2019ll be able to customize this book and assign it to your students. All our content is free, openly licensed, and available to everyone. By improving Boundless content you'll be joining a vibrant community of experts already helping us make quality education available to everyone!</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/customize_quiz"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-quiz'></i>\n<hr>"),null!=session.current_user?$o.push("<h2>Customize this quiz</h2>\n<p>Customizing a quiz is made simple with our easy to use quiz editor. Edit existing questions, rearrange or remove questions, or add new questions from scratch.</p>"):$o.push("<h2>Register to customize this quiz</h2>\n<p>After registering you\u2019ll be able to customize this quiz and assign it to your students. All our content is free, openly licensed, and available to everyone. By improving Boundless content you'll be joining a vibrant community of experts already helping us make quality education available to everyone!</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/default"]=function(context){return function(){var $o;return $o=[],$o.push("<h2>Sign Up</h2>\n<p>At Boundless, we believe that access to high-quality education is a right, not a privilege. We\u2019re building a community of educators, experts, and students who share the same belief. Whether you\u2019re a student studying for a test, an educator exploring new teaching resources, or an expert interested in contributing content, we\u2019d love to have you join us!</p>"),$o.join("\n")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/discussion"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-join-discussion'></i>\n<hr>\n<h2>Register to join the discussion and contribute to this content</h2>\n<p>The Boundless community is full of educators and domain experts who believe that access to affordable, high quality, educational content is a right. All proposed changes to the content are reviewed by the community before they are published.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/editing"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-edit'></i>\n<hr>\n<h2>Register to edit this content</h2>\n<p>After registering you\u2019ll be able to edit and propose changes to any piece of content on Boundless. All our content is free, openly licensed, and available to everyone. By improving Boundless content you'll be joining a vibrant community of experts already helping us make quality education available to everyone!</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/editing_quiz"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-edit'></i>\n<hr>\n<h2>Register to edit this quiz</h2>\n<p>After registering you\u2019ll be able to edit and propose changes to any piece of content on Boundless. All our content is free, openly licensed, and available to everyone. By improving Boundless content you'll be joining a vibrant community of experts already helping us make quality education available to everyone!</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/favorite_resource"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-book'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Favorite this resource"):$o.push("  Register to favorite this resource"),$o.push('</h2>\n<p>You can access your favorited resources from the "Books & Concepts" and "Quizzes & Questions" tabs on your profile page. Favoriting a resource ensures you\u2019ll have quick, easy access to it in the future.</p>'),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/flag_content"]=function(context){return function(){var $o;return $o=[],$o.push("<h2>Thanks for the feedback!</h2>\n<p>At Boundless, we believe that access to high-quality education is a right, not a privilege. We\u2019re building a community of educators, experts, and students who share the same belief. Whether you\u2019re a student studying for a test, an educator exploring new teaching resources, or an expert interested in contributing content, we\u2019d love to have you join us!</p>"),$o.join("\n")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/quiz_from_question"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-quiz'></i>\n<hr>"),null!=session.current_user?$o.push("<h2>Create a quiz based on this question</h2>\n<p>Creating a quiz based on this question is made simple with our easy to use quiz editor. Edit the existing question and add new questions from our bank or create them from scratch.</p>"):$o.push("<h2>Register create a quiz based on this question</h2>\n<p>After registering you\u2019ll be able to customize this quiz and assign it to your students. All our content is free, openly licensed, and available to everyone. By improving Boundless content you'll be joining a vibrant community of experts already helping us make quality education available to everyone!</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/save_ppt"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-ppt'></i>\n<hr>\n<h2>\n  Sign up to to download this PowerPoint template\n</h2>\n<p>Boundless has thousands of PowerPoint templates available in more than 20 subjects. By signing up for Boundless, you\u2019ll have unlimited access to all our PowerPoints, as well as additional teaching resources.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/take_quiz"]=function(context){return function(){var $o;return $o=[],
$o.push("<i class='boundless-icon-quiz'></i>\n<hr>\n  <h2>Register to take this quiz</h2>\n  <p>Please create an account to take this quiz. You'll also be able to easily keep track of your future learning from your computer, tablet, or smartphone.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/valore_vip"]=function(context){return function(){var $o;return $o=[],$o.push("<div class='valore-vip__sidebar'>\n  <h2></h2>\n  <p>You are getting free VIP access to our entire library!</p>\n  <div class='subject-library'></div>\n  <p class='coupon-discount price-summary'>\n    <span class='pull-right'>$99+ Value</span>\n    Coupon Applied:\n  </p>\n  <p class='price-summary total'>\n    <span class='pull-right'>$0.00</span>\n    Total\n  </p>\n</div>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_book"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Watch this book"):$o.push("  Register to watch this book"),$o.push("</h2>\n<p>When you watch a book on Boundless, we\u2019ll notify you of any discussions about or changes to any of the structure of that book. If you have expertise in a particular subject and want to start contributing to it, this is the easiest way to get a pulse on what's happening.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_concept"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Watch this concept"):$o.push("  Register to watch this concept"),$o.push("</h2>\n<p>When you watch a concept on Boundless, we\u2019ll notify you of any discussions about or changes to that concept.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_issue"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Watch this issue"):$o.push("  Register to watch this issue"),$o.push("</h2>\n<p>When you watch an issue on Boundless, we'll notify you of any discussions or changes based on that issue. You automatically follow issues that you create. (If you want to be notified of all changes to an entire concept, you should watch the concept instead.)</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_question"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Watch this question"):$o.push("  Register to watch this question"),$o.push("</h2>\n<p>When you watch a question on Boundless, we\u2019ll notify you of any discussions about or changes to that question.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_quiz"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Watch this quiz"):$o.push("  Register to watch this quiz"),$o.push("</h2>\n<p>When you watch a quiz on Boundless, we\u2019ll notify you of any discussions about or changes to that quiz.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_reading"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Watch this reading"):$o.push("  Register to watch this reading"),$o.push("</h2>\n<p>When you watch a reading on Boundless, we\u2019ll notify you of any discussions about or changes to that reading.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/sidebars/watch_user"]=function(context){return function(){var $o;return $o=[],$o.push("<i class='boundless-icon-eye'></i>\n<hr>\n<h2>"),null!=session.current_user?$o.push("  Follow this user"):$o.push("  Register to follow this user"),$o.push("</h2>\n<p>When you follow a user on Boundless, we\u2019ll notify you of any content improvement activities that user is involved in. Whether you want to keep track of the changes a colleague is making or be notified if a particular content expert is active, following that user is the way to go.</p>"),$o.join("\n").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/step_layout"]=function(context){return function(){var $c,$e,$o,i,j,k,len,len1,ref,ref1,step_name;for($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='steps__cont' data-step-count='"+$e($c(this.step_names.length))+"' data-current-step='"+$e($c(this.current_step))+"'>\n  <div class='steps__indicator-cont'>\n    <div>"),ref=this.step_names,j=0,len=ref.length;len>j;j++)step_name=ref[j],$o.push("      <div class='steps__indicator'>\n        <div class='steps__indicator__text'>"+$c(step_name)+"</div>\n      </div>");for($o.push("    </div>\n  </div>\n  <div class='register__steps-cont'>\n    <div class='join-class__steps-cont steps__inner-cont'>"),ref1=this.step_names,i=k=0,len1=ref1.length;len1>k;i=++k)step_name=ref1[i],$o.push("      <div class='"+["steps__step","steps__step-"+$e($c(i+1))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"'></div>");return $o.push("    </div>\n  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["wizzard/views/wizzard_layout"]=function(context){return function(){var $c,$e,$o,i,index,len,ref,step_el;for($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<div class='steps__cont wizzard__cont' data-step-count='"+$e($c(this.step_els.length))+"' data-current-step='"+$e($c(1))+"'>\n  <div class='clearfix steps__inner-cont wizzard__inner-cont'>"),ref=this.step_els,index=i=0,len=ref.length;len>i;index=++i)step_el=ref[index],$o.push("    <div class='steps__step'></div>");return $o.push("  </div>\n</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){var indexOf=[].indexOf||function(item){for(var i=0,l=this.length;l>i;i++)if(i in this&&this[i]===item)return i;return-1};Boundless.Orientation=function(){function Orientation(){}return Orientation.handle_dismiss=function(evt){var $container,orientations,setting_name;return evt.preventDefault(),setting_name=$(evt.currentTarget).data("dismiss-orientation"),session.current_user?(session.current_user.set_setting("orientation/"+setting_name,!0),session.current_user.save()):(orientations=CookieMonster.get("orientations")||[],orientations.push(setting_name),CookieMonster.set("orientations",orientations)),$container=$($(evt.currentTarget).data("orientation-container")),null!=$container?$container.velocity("slideUp",{duration:250,easing:"ease-in-out"}):void 0},Orientation.is_oriented_to=function(setting){return session.current_user?session.current_user.get_setting("orientation/"+setting_name):indexOf.call(CookieMonster.get("orientations"),setting)>=0},Orientation._save_cookied_orientations_to_user=function(){var i,len,ref,setting;for(ref=CookieMonster.get("orientations"),i=0,len=ref.length;len>i;i++)setting=ref[i],session.current_user.set_setting("orientation/"+setting,!0);return session.current_user.save({},{success:function(){return CookieMonster["delete"]("orientations")}})},Orientation}(),$(document).off("click","[data-dismiss-orientation]"),$(document).on("click","[data-dismiss-orientation]",function(_this){return function(evt){return Boundless.Orientation.handle_dismiss(evt)}}(this))}.call(this),function(){Boundless.append_view_path("book_search/views"),Boundless.BookSearch||(Boundless.BookSearch={}),Boundless.BookSearch.App=function(){function App(el){this.book_search_controller=new Boundless.BookSearchController({el:el})}return App}()}.call(this),function(){var extend=function(child,parent){function ctor(){this.constructor=child}for(var key in parent)hasProp.call(parent,key)&&(child[key]=parent[key]);return ctor.prototype=parent.prototype,child.prototype=new ctor,child.__super__=parent.prototype,child},hasProp={}.hasOwnProperty;Boundless.BookSearchController=function(superClass){function BookSearchController(){return BookSearchController.__super__.constructor.apply(this,arguments)}return extend(BookSearchController,superClass),BookSearchController.prototype.template="book_search",BookSearchController.prototype.events={"submit .bcp-hub__search":"try_search","click .bcp-hub__search-btn":"try_search","click .title-search__clear":"clear_search","keyup .bcp-hub__search-input":"search_field_changed"},BookSearchController.prototype.helper_methods=["search_results","search_query"],BookSearchController.prototype.initialize=function(params){return null==params&&(params={}),BookSearchController.__super__.initialize.apply(this,arguments),this.search_results=[],this.search_query||(this.search_query=""),this.render(),this},BookSearchController.prototype.render=function(){return BookSearchController.__super__.render.apply(this,arguments),this.$(".bcp-hub__search-input").val(this.search_query),this.$(".bcp-hub__search-input").focus(),this.$(".bcp-hub__search-input").autocomplete({source:Boundless.API+"/books/suggest",minLength:3,appendTo:"#title-search__autocomplete-wrapper",open:function(e,ui){return $(".ui-autocomplete").css("position","absolute"),$(".ui-autocomplete").css("top","42px"),$(".ui-autocomplete").css("left","10px")},select:function(){return $(".bcp-hub__search-btn").click()}}),$(window).resize(function(){return $(".ui-autocomplete").css("display","none")}),this.update_remove_icon(),this},BookSearchController.prototype.update_remove_icon=function(){return this.$(".bcp-hub__input__wrapper").toggleClass("empty",""===this.$(".bcp-hub__search-input").val())},BookSearchController.prototype.clear_search=function(e){return null!=e&&e.preventDefault(),this.search_query="",this.search_results=[],this.render()},BookSearchController.prototype.search_field_changed=function(e){return null!=e&&e.preventDefault(),this.update_remove_icon()},BookSearchController.prototype.try_search=function(e){var query;return null!=e&&e.preventDefault(),(query=this.$(".bcp-hub__search-input").val().trim())!==this.search_query?(this.search_query=query,this.$(".bcp-hub__search").disable_form(),clearTimeout(this.search_timeout),this.search_timeout=setTimeout(function(_this){return function(){return _this.do_search()}}(this),300)):void 0},BookSearchController.prototype.do_search=function(){var update_search_results;return update_search_results=function(_this){return function(){return _this.render()}}(this),""===this.search_query?(this.search_results=null,void update_search_results()):$.get(Boundless.API+"/books/search",{q:this.search_query},function(_this){return function(results){return _this.search_results=results,_this.render()}}(this),"json")},BookSearchController}(Boundless.Base.View)}.call(this),function(){null==window.HAML&&(window.HAML={}),window.HAML["book_search/views/book_search"]=function(context){return function(){var $c,$e,$o,book,i,len,ref;if($e=window.HAML.escape,$c=window.HAML.cleanValue,$o=[],$o.push("<form class='bcp-hub__search title-search__form'>\n  <div class='title-search__input__wrapper'>\n    <label for='book-search' style='display: none;'>Search textbooks by author, title, or ISBN</label>\n    <input class='bcp-hub__search-input' id='book-search' type='text' placeholder='Search textbooks by author, title, or ISBN'>\n    <i class='bcp-hub__search__icon icon-search'></i>\n    <i class='icon-remove title-search__clear'></i>\n  </div>\n  <a class='bcp-hub__search-btn btn btn btn-green'>\n    <div class='mq__fixed text-label'>Search</div>\n    <div class='mq__fluid text-label'>Go</div>\n  </a>\n</form>\n<div id='title-search__autocomplete-wrapper'></div>\n<div class='bcp-search__results__titles'>"),null!=this.search_query&&this.search_query.length>0)if(this.search_results.length>0)for(ref=this.search_results,i=0,len=ref.length;len>i;i++)book=ref[i],$o.push("  <a class='"+["bcp-textbooks__textbook-list__textbook",""+$e($c("boundless"===book.book_type?"bcp-textbooks__textbook-list__textbook--boundless":void 0))].sort().join(" ").replace(/^\s+|\s+$/g,"")+"' href='"+$e($c(Boundless.APP_URl))+"/"+$e($c(book.subject_tag.permalink))+"/textbooks/"+$e($c(book.permalink))+"'>"),book.subject_tag.permalink&&($o.push("    <div class='bcp-textbooks__textbook-list__textbook__icon'>"),"boundless"===book.book_type?$o.push("      <img class='boundless-book' src='"+$e($c(Boundless.APP_URL))+"/assets/app/icons/tiny-book-covers/"+$e($c(book.subject_tag.permalink))+".png' alt='"+$e($c(book.title))+"'>"):$o.push("      <img class='alternative-book' src='"+$e($c(Boundless.APP_URL))+"/assets/marketing/graphics/book_landing_thumbnails/"+$e($c(book.subject_tag.permalink))+".png' alt='"+$e($c(book.title))+"'>"),$o.push("    </div>")),$o.push("    <div class='bcp-textbooks__textbook-list__textbook-info'>"),book.alignment_edition&&$o.push("      <div class='bcp-textbooks__textbook-list__textbook__edition'>"+$c(book.alignment_edition)+"</div>"),"boundless"!==book.book_type&&$o.push("      <div class='bcp-textbooks__textbook-list__textbook__alternative'>Boundless alternative to:</div>"),$o.push("      <div class='bcp-textbooks__textbook-list__textbook__title'>"),$o.push("        "+$c(book.title)),$o.push("      </div>\n      <div class='bcp-textbooks__textbook-list__textbook__meta'>"),"boundless"===book.book_type?$o.push("        This edition of "+book.title+" is carefully crafted and organized in the way Boundless recommends learning introductory material for this topic.\n        <br>"):book.alignment_authors&&($o.push("        "+$c("By "+book.alignment_authors)),$o.push("        <br>")),(null!=book.isbn_10||null!=book.isbn_13)&&$o.push("        ISBN-10: "+book.isbn_10+"; ISBN-13: "+book.isbn_13),$o.push("      </div>\n    </div>\n    <i class='icon-angle-right'></i>\n  </a>");else $o.push("  <h2 class='title-search__no-results'>No results.</h2>");return $o.push("</div>"),$o.join("\n").replace(/\s([\w-]+)='\x93true'/gm," $1").replace(/\s([\w-]+)='\x93false'/gm,"").replace(/\s(?:id|class)=(['"])(\1)/gm,"")}.call(window.HAML.context(context))}}.call(this),function(){Boundless.SearchPage=function(){function SearchPage(options){this.search_query=options.search_query,$(".search-results-page__filter-box__toggle-list__item__checkbox-all").on("click",function(_this){return function(e){return $(".search-results-page__filter-box__toggle-list__item__checkbox").prop("checked",$(e.currentTarget).prop("checked")),_this.update_targets()}}(this)),$(".search-results-page__filter-box__toggle-list__item__checkbox").on("click",function(_this){return function(e){return $(".search-results-page__filter-box__toggle-list__item__checkbox-all").prop("checked",_.isEqual(_this.selected(),_this.available())),_this.update_targets()}}(this)),$(".search-results-page__filter-box__header").on("click",function(_this){return function(e){return $(".search-results-page__filter-box").toggleClass("search-results-page__filter-box--expanded")}}(this))}return SearchPage.prototype.available=function(){return _.map($(".search-results-page__filter-box__toggle-list__item__checkbox"),function(elem){return elem.dataset.filter})},SearchPage.prototype.selected=function(){return _.map($(".search-results-page__filter-box__toggle-list__item__checkbox:checked"),function(elem){return elem.dataset.filter})},SearchPage.prototype.update_targets=function(){var filter_string;return filter_string=this.selected().join(","),$(".search-results-page__filter-box__submit").attr("href",window.location.pathname+"?q="+encodeURIComponent(this.search_query)+"&filter="+filter_string),$("input#header-search-filter").val(filter_string)},SearchPage}()}.call(this),function(){boundless.define("boundless.dialog.components.Dialog",["React"],function(React){var CSSTransitionGroup,PropTypes,findDOMNode,unmountComponentAtNode;return findDOMNode=React.findDOMNode,PropTypes=React.PropTypes,unmountComponentAtNode=React.unmountComponentAtNode,CSSTransitionGroup=React.addons.CSSTransitionGroup,React.createClass({displayName:"Dialog",propTypes:{cancel:PropTypes.func,cancelText:PropTypes.string,confirm:PropTypes.func.isRequired,confirmText:PropTypes.string,heading:PropTypes.string,message:PropTypes.string.isRequired},getDefaultProps:function(){return{confirmText:"Okay",cancelText:"Cancel",heading:"Notice"}},render:function(){return React.createElement(CSSTransitionGroup,{transitionName:"dialog",transitionAppear:!0},React.createElement("div",{key:this.props.heading,className:"dialog-veil"},React.createElement("div",{className:"dialog"},React.createElement("div",{className:"dialog-heading"},this.props.heading),React.createElement("div",{className:"dialog-body"},React.createElement("div",{className:"text-center"},this.props.message),this.props.children),React.createElement("div",{className:"dialog-actions"},React.createElement("div",{className:"btn btn-primary",onClick:this.handleConfirm},this.props.confirmText),React.createElement("div",{className:"btn btn-default",onClick:this.handleCancel},this.props.cancelText)))))},handleConfirm:function(){return this.props.confirm(),this._unmount()},handleCancel:function(){var base;return"function"==typeof(base=this.props).cancel&&base.cancel(),this._unmount()},_unmount:function(){return unmountComponentAtNode(findDOMNode(this).parentElement)}})})}.call(this),function(){boundless.define("boundless.dialog.components.Popover",["jQuery","React"],function($,React){var PropTypes,findDOMNode;return findDOMNode=React.findDOMNode,PropTypes=React.PropTypes,React.createClass({displayName:"Popover",propTypes:{dismissable:PropTypes.bool,element:PropTypes.object.isRequired,heading:PropTypes.string,message:PropTypes.string,placement:PropTypes.oneOf(["top","bottom","left","right"])},getDefaultProps:function(){return{dismissable:!0,heading:"Notice",placement:"top"}},getInitialState:function(){return{visible:!1}},componentDidMount:function(){return this.props.element.addEventListener("click",function(_this){return function(event){return event.preventDefault(),event.stopPropagation(),_this._toggle()}}(this)),this.props.dismissable&&document.querySelector("html").addEventListener("click",function(_this){return function(){return _this.setState({visible:!1})}}(this)),this._setPosition()},componentDidUpdate:function(){return this._setPosition()},render:function(){return React.createElement("div",{ref:"popover",className:"popover popover-"+this.props.placement+(this.state.visible?" on":"")},React.createElement("div",{className:"popover-heading"},this.props.heading),React.createElement("div",{className:"popover-body"},this.props.message||this.props.children))},_toggle:function(){return this.setState({visible:!this.state.visible})},_getCoordinates:function(){var $el,$popover,centeredOffset,element,pointerHeight,popover;switch($el=$(this.props.element),$popover=$(findDOMNode(this.refs.popover)),element={left:$el.offset().left,top:$el.offset().top,width:$el.outerWidth(),height:$el.outerHeight()},pointerHeight=5,popover={width:$popover.outerWidth(),height:$popover.outerHeight()},centeredOffset={left:element.left+element.width/2-popover.width/2,top:element.top+element.height/2-popover.height/2},this.props.placement){case"top":return[centeredOffset.left,element.top-popover.height-pointerHeight];case"bottom":return[centeredOffset.left,element.top+element.height+pointerHeight];case"left":return[element.left-popover.width-pointerHeight,centeredOffset.top];case"right":return[element.left+element.width+pointerHeight,centeredOffset.top]}},_setPosition:function(){var coordinates,node;return coordinates=this._getCoordinates(),node=findDOMNode(this.refs.popover),node.style.left=(this.state.visible?coordinates[0]:-9999)+"px",node.style.top=(this.state.visible?coordinates[1]:-9999)+"px"}})})}.call(this),function(){boundless.define("boundless.dialog.components.RemoveAdsPopover",["React","Boundless","boundless.dialog.components.Popover"],function(React,Boundless,Popover){var findDOMNode,startRegistration,unmountComponentAtNode;return findDOMNode=React.findDOMNode,unmountComponentAtNode=React.unmountComponentAtNode,startRegistration=Boundless.Register.startRegistration,React.createClass({displayName:"RemoveAdsPopover",render:function(){return React.createElement(Popover,React.__spread({},this.props,{heading:"Unlock your full potential."}),React.createElement("p",null,"Along with removing all ads from your browsing experience, you'll enjoy these FREE features when you sign up."),React.createElement("ul",{className:"list-bulleted"},React.createElement("li",{className:"list-heading"},"For Educators"),React.createElement("li",null,"Create auto-graded assignments"),React.createElement("li",null,"Customize content, books, and quizzes"),React.createElement("li",null,"Unlimited PowerPoint downloads")),React.createElement("ul",{className:"list-bulleted"},React.createElement("li",{className:"list-heading"},"For Students"),React.createElement("li",null,"View in customized e-reader"),React.createElement("li",null,"Save your quiz progress")),React.createElement("div",{className:"btn btn-primary",onClick:this.handleConfirm},"Sign up"),React.createElement("div",{className:"btn btn-default",onClick:this.handleCancel},"No thanks"))},handleConfirm:function(){return startRegistration({skipAdditionalInfo:!0,skipRoleSelector:!0,startEvent:"Sisyphus:clicked_reg_to_hide_ads",startEventPropertiesJson:JSON.stringify({ad_location:"Concept leaderboard"})})}})})}.call(this),function(){boundless.require(["jQuery","React","boundless.dialog.components.Dialog","boundless.dialog.components.Popover","boundless.dialog.components.RemoveAdsPopover"],function($,React,Dialog,Popover,RemoveAdsPopover){var createElement,render;return createElement=React.createElement,render=React.render,$(function(){return $('<div class="dialog-container"></div>').appendTo("body"),$("[data-dialog]").on("click",function(e){var container,props;return e.preventDefault(),container=document.querySelector(".dialog-container"),props=$(this).data(),props.confirm=function(_this){return function(){return window.location=_this.href}}(this),render(createElement(Dialog,props),container)}),$("[data-popover]").each(function(index,element){var Component,container,heading,message,placement,popover,props,ref;return ref=$(element).data(),heading=ref.heading,message=ref.message,placement=ref.placement,popover=ref.popover,props={element:element,heading:heading,message:message,placement:placement,popover:popover},container=document.querySelector("body").appendChild(document.createElement("div")),Component="remove-ads"===props.popover?RemoveAdsPopover:Popover,render(createElement(Component,props),container)})})})}.call(this),function(){$(window).load(function(){return $("body").addClass("site_loaded")})}.call(this),function(){}.call(this);